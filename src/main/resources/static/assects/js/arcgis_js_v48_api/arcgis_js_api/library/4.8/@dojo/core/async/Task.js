//>>built
(function(d){"object"===typeof module&&"object"===typeof module.exports?(d=d(require,exports),void 0!==d&&(module.exports=d)):"function"===typeof define&&define.amd&&define(["require","exports","tslib","@dojo/shim/iterator","./ExtensiblePromise"],d)})(function(d,g){function h(e){return!!(e&&"function"===typeof e.cancel&&Array.isArray(e.children)&&k(e))}function k(e){return e&&"function"===typeof e.then}Object.defineProperty(g,"__esModule",{value:!0});var m=d("tslib"),n=d("@dojo/shim/iterator"),p=
d("./ExtensiblePromise");g.isTask=h;g.isThenable=k;d=function(e){function b(c,f){var a=this,l=function(){},b=function(){},a=e.call(this,function(a,c){l=a;b=c})||this;a._state=1;a.children=[];a.canceler=function(){f&&f();a._cancel()};try{c(function(c){3!==a._state&&(a._state=0,l(c))},function(c){3!==a._state&&(a._state=2,b(c))})}catch(q){a._state=2,b(q)}return a}m.__extends(b,e);b.race=function(c){return new this(function(b,a){Promise.race(p.unwrapPromises(c)).then(b,a)})};b.reject=function(c){return new this(function(b,
a){return a(c)})};b.resolve=function(c){return new this(function(b,a){return b(c)})};b.all=function(c){var f=this;return new b(function(a,b){e.all.call(f,c).then(a,b)},function(){if(n.isArrayLike(c))for(var a=0;a<c.length;a++){var b=c[a];h(b)&&b.cancel()}else if(n.isIterable(c))try{for(var a=m.__values(c),f=a.next();!f.done;f=a.next())b=f.value,h(b)&&b.cancel()}catch(r){e={error:r}}finally{try{f&&!f.done&&(d=a.return)&&d.call(a)}finally{if(e)throw e.error;}}else Object.keys(c).forEach(function(a){a=
c[a];h(a)&&a.cancel()});var e,d})};Object.defineProperty(b.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0});b.prototype._cancel=function(c){var b=this;this._state=3;var a=function(){try{return b._finally&&b._finally()}catch(l){}};this._finally&&(c=k(c)?c.then(a,a):a());this.children.forEach(function(a){a._cancel(c)})};b.prototype.cancel=function(){1===this._state&&this.canceler()};b.prototype.catch=function(c){return this.then(void 0,c)};b.prototype.finally=function(c){if(3===
this._state)return c(),this;var e=this.then(function(a){return b.resolve(c()).then(function(){return a})},function(a){return b.resolve(c()).then(function(){throw a;})});e._finally=c;return e};b.prototype.then=function(c,b){var a=this,d=e.prototype.then.call(this,function(a){if(3!==d._state)return c?c(a):a},function(a){if(3!==d._state){if(b)return b(a);throw a;}});d.canceler=function(){1===a._state?a.cancel():d._cancel()};this.children.push(d);return d};return b}(p.default);g.default=d});