// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../layers/support/ExportImageParameters ./DynamicLayerView3D".split(" "),function(l,m,f,e,c,g,h){return function(d){function a(){var b=null!==d&&d.apply(this,arguments)||this;b._exportImageParameters=null;b._imageVersion=null;return b}f(a,d);a.prototype.initialize=function(){var b=this;this._exportImageParameters=new g({layer:this.layer});this._handles.add(this._exportImageParameters.watch("version",
function(a){b._imageVersion!==a&&(b._imageVersion=a,b.refetch())}))};a.prototype.destroy=function(){this._exportImageParameters&&(this._exportImageParameters.layer=null,this._exportImageParameters.destroy(),this._exportImageParameters=null)};a.prototype.beforeFetch=function(){this._exportImageParameters.scale!==this.view.scale&&(this._exportImageParameters.scale=this.view.scale);this._imageVersion=this._exportImageParameters.version};a.prototype.getPopupData=function(a){var b=this.view.scale;return this.layer.allSublayers.filter(function(a){var k=
0===a.minScale||b<=a.minScale,c=0===a.maxScale||b>=a.maxScale;return a.popupTemplate&&a.popupEnabled&&a.visible&&k&&c}).map(function(b){var c=b.createQuery();c.geometry=a;c.outFields=b.popupTemplate.requiredFields;return b.queryFeatures(c).then(function(a){return a.features})})};e([c.property()],a.prototype,"layer",void 0);return a=e([c.subclass("esri.views.3d.layers.MapImageLayerView3D")],a)}(c.declared(h))});