// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define(["require","exports","./Geometry","./Rect","../../../3d/webgl-engine/lib/Util"],function(B,y,D,E,F){function C(h,a,b){F.packFloatRGBA(h,a,b)}Object.defineProperty(y,"__esModule",{value:!0});y.packFloat=C;B=function(){function h(){}h.checkSDF=function(a){return!0};h.prototype._extractGeometry=function(a){if(!a)return null;a=a.symbolLayers;if(!a||1!==a.length)return null;a=a[0];if(!a)return null;a=a.markerGraphics;if(!a||1!==a.length)return null;a=a[0];if(!a)return null;var b=a.geometry;if(!b||
!b.rings)return null;a=[];for(var e=0,b=b.rings;e<b.length;e++){for(var c=[],g=0,m=b[e];g<m.length;g++){var n=m[g];c.push(new D.Point(n[0],n[1]))}a.push(c)}return a};h.prototype._getEnvelope=function(a){for(var b=Infinity,e=-Infinity,c=Infinity,g=-Infinity,m=0;m<a.length;m++)for(var n=0,k=a[m];n<k.length;n++){var l=k[n];l.x<b&&(b=l.x);l.x>e&&(e=l.x);l.y<c&&(c=l.y);l.y>g&&(g=l.y)}return new E(b,c,e-b,g-c)};h.prototype.buildSDF=function(a){a=this._extractGeometry(a);if(!a)return null;var b=this._getEnvelope(a);
if(0>=b.width||0>=b.height)return null;for(var e=Math.floor(31.5),c=(128-2*(e+0+1))/Math.max(b.width,b.height),g=Math.round(b.width*c),m=Math.round(b.height*c),n=g+2*e,k=m+2*e,l=0;l<a.length;l++)for(var r=0,f=a[l];r<f.length;r++){var d=f[r];d.x-=b.x;d.y-=b.y;d.x*=c;d.y*=c;d.x+=e-.5;d.y+=e-.5}b=this._dist_map(a,n,k,e);this._sign_dist_map(a,n,k,e,b);return[this._encodeDistMap(b,e),n,k,g,m,c]};h.prototype._dist_map=function(a,b,e,c){for(var g=b*e,m=new Float32Array(g),n=c*c+1,k=0;k<g;++k)m[k]=n;for(n=
0;n<a.length;n++)for(var l=a[n],r=l.length,k=1;k<r;++k){var f=l[k-1],d=l[k],t=void 0,p=void 0;f.x<d.x?(t=f.x,p=d.x):(t=d.x,p=f.x);var x=void 0,u=void 0;f.y<d.y?(x=f.y,u=d.y):(x=d.y,u=f.y);var q=Math.floor(t)-c,p=Math.floor(p)+c,x=Math.floor(x)-c,u=Math.floor(u)+c;0>q&&(q=0);p>b&&(p=b);0>x&&(x=0);u>e&&(u=e);for(var t=d.x-f.x,h=d.y-f.y,y=t*t+h*h;q<p;q++)for(var z=x;z<u;z++){var v=(q-f.x)*t+(z-f.y)*h,w=void 0,A=void 0;0>v?(w=f.x,A=f.y):v>y?(w=d.x,A=d.y):(v/=y,w=f.x+v*t,A=f.y+v*h);v=(q-w)*(q-w)+(z-A)*
(z-A);w=(e-z-1)*b+q;v<m[w]&&(m[w]=v)}}for(k=0;k<g;++k)m[k]=Math.sqrt(m[k]);return m};h.prototype._sign_dist_map=function(a,b,e,c,g){for(var m=0;m<a.length;m++)for(var n=a[m],k=n.length,l=1;l<k;++l){var r=n[l-1],f=n[l],d=void 0,t=void 0;r.x<f.x?(d=r.x,t=f.x):(d=f.x,t=r.x);var p=void 0,h=void 0;r.y<f.y?(p=r.y,h=f.y):(p=f.y,h=r.y);d=Math.floor(d);t=Math.floor(t)+1;p=Math.floor(p);h=Math.floor(h)+1;d<c&&(d=c);t>b-c&&(t=b-c);p<c&&(p=c);for(h>e-c&&(h=e-c);p<h;++p)if(r.y>p!==f.y>p){for(var u=(e-p-1)*b,q=
d;q<t;++q)q<(f.x-r.x)*(p-r.y)/(f.y-r.y)+r.x&&(g[u+q]=-g[u+q]);for(q=c;q<d;++q)g[u+q]=-g[u+q]}}};h.prototype._encodeDistMap=function(a,b){b*=2;for(var e=a.length,c=new Uint8Array(4*e),g=0;g<e;++g)C(.5-a[g]/b,c,4*g);return c};return h}();y.SDFHelper=B});