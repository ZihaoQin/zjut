// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define(["require","exports","../lib/glMatrix"],function(ga,W,a){function C(c,b,d,f,e,g){if(!(1E-6>a.vec3d.length2(b)))for(a.vec3d.cross(d,b,X),a.vec3d.cross(f,b,Y),a.vec3d.cross(e,b,Z),t(c,b,h),q[1]=h[0],E[1]=h[1],Q[1]=E[1]-q[1],d=[d,f,e],f=[X,Y,Z],e=0;3>e;++e){t(c,d[e],h);q[0]=h[0];E[0]=h[1];t(c,f[e],h);q[2]=h[0];E[2]=h[1];Q[0]=E[0]-q[0];Q[2]=E[2]-q[2];var r=V(Q);r<g.quality&&(a.vec3d.set(d[e],g.b0),a.vec3d.set(b,g.b1),a.vec3d.set(f[e],g.b2),g.quality=r)}}function t(a,b,d){var c=a.data,e=a.offsetIdx;
a=a.strideIdx;d[0]=Number.POSITIVE_INFINITY;for(d[1]=Number.NEGATIVE_INFINITY;e<c.length;e+=a){var g=c[e]*b[0]+c[e+1]*b[1]+c[e+2]*b[2];d[0]=Math.min(d[0],g);d[1]=Math.max(d[1],g)}}function aa(c,b,d){a.vec3d.set(c,d.center);a.vec3d.scale(b,.5,d.halfSize);a.quat4.identity(d.quaternion)}function ba(a,b,d,f,e,g){t(a,b,h);e[0]=h[0];g[0]=h[1];t(a,d,h);e[1]=h[0];g[1]=h[1];t(a,f,h);e[2]=h[0];g[2]=h[1]}function ca(c,b,d,f,e,g,h){m[0]=c[0];m[3]=c[1];m[6]=c[2];m[1]=b[0];m[4]=b[1];m[7]=b[2];m[2]=d[0];m[5]=d[1];
m[8]=d[2];a.quat4.fromRotationMatrix(m,h.quaternion);a.vec3d.add(f,e,K);a.vec3d.scale(K,.5);a.vec3d.scale(c,K[0],h.center);a.vec3d.scale(b,K[1],R);a.vec3d.add(h.center,R);a.vec3d.scale(d,K[2],R);a.vec3d.add(h.center,R);a.vec3d.scale(g,.5,h.halfSize)}function V(a){return a[0]*a[1]+a[0]*a[2]+a[1]*a[2]}Object.defineProperty(W,"__esModule",{value:!0});var S=a.vec3d.create(),T=a.vec3d.create();W.computeOBB=function(c,b){var d=c.data.length/c.strideIdx;if(!(0>=d)){var f=new ea(c);a.vec3d.add(f.minProj,
f.maxProj,S);a.vec3d.scale(S,.5);a.vec3d.subtract(f.maxProj,f.minProj,T);var e=V(T),g=new fa;g.quality=e;14>d&&(c={data:new Float64Array(f.buffer,112,42),size:3,offsetIdx:0,strideIdx:3});var r=a.vec3d.create(),m=a.vec3d.create(),t=a.vec3d.create(),d=a.vec3d.create(),B=a.vec3d.create(),D=a.vec3d.create(),y=a.vec3d.create(),k;k=c;for(var z=a.vec3d.dist2(f.maxVert[0],f.minVert[0]),n=0,l=1;7>l;++l){var u=a.vec3d.dist2(f.maxVert[l],f.minVert[l]);u>z&&(z=u,n=l)}a.vec3d.set(f.minVert[n],r);a.vec3d.set(f.maxVert[n],
m);if(1E-6>a.vec3d.dist2(r,m))k=1;else{a.vec3d.subtract(r,m,d);a.vec3d.normalize(d);f=k.data;z=k.strideIdx;n=Number.NEGATIVE_INFINITY;l=0;for(u=k.offsetIdx;u<f.length;u+=z){a.vec3d.set3(f[u]-r[0],f[u+1]-r[1],f[u+2]-r[2],L);var p=d[0]*L[0]+d[1]*L[1]+d[2]*L[2],q=a.vec3d.length2(d),p=a.vec3d.length2(L)-p*p/q;p>n&&(n=p,l=u)}a.vec3d.set3(f[l],f[l+1],f[l+2],t);1E-6>n?k=2:(a.vec3d.subtract(m,t,B),a.vec3d.normalize(B),a.vec3d.subtract(t,r,D),a.vec3d.normalize(D),a.vec3d.cross(B,d,y),a.vec3d.normalize(y),
C(k,y,d,B,D,g),k=0)}switch(k){case 1:aa(S,T,b);return;case 2:e=c;a.vec3d.set(d,A);Math.abs(d[0])>Math.abs(d[1])&&Math.abs(d[0])>Math.abs(d[2])?A[0]=0:Math.abs(d[1])>Math.abs(d[2])?A[1]=0:A[2]=0;1E-6>a.vec3d.length2(A)&&(A[0]=A[1]=A[2]=1);a.vec3d.cross(d,A,M);a.vec3d.normalize(M);a.vec3d.cross(d,M,U);a.vec3d.normalize(U);ba(e,d,M,U,F,G);a.vec3d.subtract(G,F,da);ca(d,M,U,F,G,da,b);return}k=c;f=N;z=O;n=h;l=k.data;p=k.offsetIdx;u=k.strideIdx;a.vec3d.set3(l[p],l[p+1],l[p+2],z);a.vec3d.set(z,f);n[0]=a.vec3d.dot(P,
y);n[1]=n[0];for(p+=u;p<l.length;p+=u)a.vec3d.set3(l[p],l[p+1],l[p+2],P),q=a.vec3d.dot(P,y),q<n[0]&&(n[0]=q,a.vec3d.set(P,z)),q>n[1]&&(n[1]=q,a.vec3d.set(P,f));y=a.vec3.dot(r,y);h[1]-1E-6<=y&&(f[0]=void 0);h[0]+1E-6>=y&&(z[0]=void 0);void 0!==N[0]&&(a.vec3d.subtract(N,r,v),a.vec3d.normalize(v),a.vec3d.subtract(N,m,w),a.vec3d.normalize(w),a.vec3d.subtract(N,t,x),a.vec3d.normalize(x),a.vec3d.cross(w,d,H),a.vec3d.normalize(H),a.vec3d.cross(x,B,I),a.vec3d.normalize(I),a.vec3d.cross(v,D,J),a.vec3d.normalize(J),
C(k,H,d,w,v,g),C(k,I,B,x,w,g),C(k,J,D,v,x,g));void 0!==O[0]&&(a.vec3d.subtract(O,r,v),a.vec3d.normalize(v),a.vec3d.subtract(O,m,w),a.vec3d.normalize(w),a.vec3d.subtract(O,t,x),a.vec3d.normalize(x),a.vec3d.cross(w,d,H),a.vec3d.normalize(H),a.vec3d.cross(x,B,I),a.vec3d.normalize(I),a.vec3d.cross(v,D,J),a.vec3d.normalize(J),C(k,H,d,w,v,g),C(k,I,B,x,w,g),C(k,J,D,v,x,g));ba(c,g.b0,g.b1,g.b2,F,G);c=a.vec3d.create();a.vec3d.subtract(G,F,c);g.quality=V(c);g.quality<e?ca(g.b0,g.b1,g.b2,F,G,c,b):aa(S,T,b)}};
var N=a.vec3d.create(),O=a.vec3d.create(),v=a.vec3d.create(),w=a.vec3d.create(),x=a.vec3d.create(),H=a.vec3d.create(),I=a.vec3d.create(),J=a.vec3d.create(),L=a.vec3d.create(),h=a.vec2d.create(),X=a.vec3d.create(),Y=a.vec3d.create(),Z=a.vec3d.create(),E=a.vec3d.create(),q=a.vec3d.create(),Q=a.vec3d.create(),P=a.vec3d.create(),A=a.vec3d.create(),M=a.vec3d.create(),U=a.vec3d.create(),F=a.vec3d.create(),G=a.vec3d.create(),da=a.vec3d.create(),R=a.vec3d.create(),m=a.mat3d.create(),K=a.vec3d.create(),ea=
function(){return function(c){this.minVert=[];this.maxVert=[];this.buffer=new ArrayBuffer(448);var b=0;this.minProj=new Float64Array(this.buffer,b,7);b+=56;this.maxProj=new Float64Array(this.buffer,b,7);for(b+=56;7>this.minVert.length;)this.minVert.push(new Float64Array(this.buffer,b,3)),b+=24;for(;7>this.maxVert.length;)this.maxVert.push(new Float64Array(this.buffer,b,3)),b+=24;for(b=0;7>b;++b)this.minProj[b]=Number.POSITIVE_INFINITY,this.maxProj[b]=Number.NEGATIVE_INFINITY;for(var d=[],f=[],e=c.data,
g=c.strideIdx,b=c.offsetIdx;b<e.length;b+=g)c=e[b],c<this.minProj[0]&&(this.minProj[0]=c,d[0]=b),c>this.maxProj[0]&&(this.maxProj[0]=c,f[0]=b),c=e[b+1],c<this.minProj[1]&&(this.minProj[1]=c,d[1]=b),c>this.maxProj[1]&&(this.maxProj[1]=c,f[1]=b),c=e[b+2],c<this.minProj[2]&&(this.minProj[2]=c,d[2]=b),c>this.maxProj[2]&&(this.maxProj[2]=c,f[2]=b),c=e[b]+e[b+1]+e[b+2],c<this.minProj[3]&&(this.minProj[3]=c,d[3]=b),c>this.maxProj[3]&&(this.maxProj[3]=c,f[3]=b),c=e[b]+e[b+1]-e[b+2],c<this.minProj[4]&&(this.minProj[4]=
c,d[4]=b),c>this.maxProj[4]&&(this.maxProj[4]=c,f[4]=b),c=e[b]-e[b+1]+e[b+2],c<this.minProj[5]&&(this.minProj[5]=c,d[5]=b),c>this.maxProj[5]&&(this.maxProj[5]=c,f[5]=b),c=e[b]-e[b+1]-e[b+2],c<this.minProj[6]&&(this.minProj[6]=c,d[6]=b),c>this.maxProj[6]&&(this.maxProj[6]=c,f[6]=b);for(b=0;7>b;++b)c=d[b],a.vec3d.set3(e[c],e[c+1],e[c+2],this.minVert[b]),c=f[b],a.vec3d.set3(e[c],e[c+1],e[c+2],this.maxVert[b])}}(),fa=function(){return function(){this.b0=a.vec3d.createFrom(1,0,0);this.b1=a.vec3d.createFrom(0,
1,0);this.b2=a.vec3d.createFrom(0,0,1);this.quality=0}}()});