// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../geometry ../../../core/Accessor ../../../core/Error ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../../../geometry/coordinateFormatter ../../../geometry/projection ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils ./coordinateConversionUtils".split(" "),function(v,w,r,f,l,t,m,d,c,k,p,u,q,g){return function(n){function b(){var a=
null!==n&&n.apply(this,arguments)||this;a.conversionInfo=null;a.coordinateSegments=null;a.defaultPattern=null;a.name=null;a.viewModel=null;return a}r(b,n);Object.defineProperty(b.prototype,"currentPattern",{get:function(){return this._get("currentPattern")||this._get("defaultPattern")},set:function(a){this._set("currentPattern",a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hasDisplayProperties",{get:function(){return!(!this.defaultPattern||!this.coordinateSegments)},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"spatialReference",{get:function(){var a=this.get("conversionInfo.spatialReference")||l.SpatialReference.WGS84;return"basemap"===this.name?this._viewSpatialReference:a},set:function(a){void 0===a&&this._clearOverride("spatialReference");this._override("spatialReference",a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"_viewSpatialReference",{get:function(){return this.get("viewModel.view.spatialReference")||l.SpatialReference.WGS84},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"_additionalCharactersPattern",{get:function(){var a=this.get("coordinateSegments");if(!a)return null;a=a.map(function(a){return a.alias});a=this.currentPattern.replace(new RegExp('["nsew'+a.join()+"]","gi"),"").replace(/\ /g,"");return new RegExp("["+a+"]","g")},enumerable:!0,configurable:!0});b.prototype.convert=function(a){var h=this;if(!g.isValidPoint(a))return d.reject(new m("format:invalid-point","Could not convert invalid point.",
{point:a}));var b=this.get("conversionInfo.convert");return b?d.resolve().then(function(){return b(a)}):this._project(a,this.spatialReference).then(function(a){return h._getCoordinate(a).then(function(h){return{location:a,coordinate:h}})})};b.prototype.getConversionStrategy=function(a){a=this._viewSpatialReference;return this.get("conversionInfo.convert")||this.get("viewModel.formatterAvailable")||"xy"===this.name&&(a.isWebMercator||a.isWGS84)||"basemap"===this.name?"client":"server"};b.prototype.getDisplayCoordinate=
function(a){if(!a)return null;if(!this.coordinateSegments||!this.currentPattern)return a;var h=this.currentPattern;a=this._getSegmentMatches(a,!1);for(var b=this.coordinateSegments.length-1;0<=b;b--)h=h.replace(this.coordinateSegments[b].alias,a[b]);return h};b.prototype.parseUserInput=function(a){var b=this.defaultPattern.replace(this._additionalCharactersPattern,"");a=a.replace(this._additionalCharactersPattern,"");a=this._getSegmentMatches(a,!0);for(var d=this.coordinateSegments.length-1;0<=d;d--)b=
b.replace(this.coordinateSegments[d].alias,a[d]);return b};b.prototype._getSegmentMatches=function(a,b){for(var h=[],d=0;d<this.coordinateSegments.length;d++){var e=this.coordinateSegments[d],c=a.match(e.searchPattern);c?(c=c[0],a=a.replace(c,"").trim(),e.substitution&&(e=b?e.substitution.input(c):e.substitution.output(c))&&(c=e),h.push(c)):h.push("")}return h};b.prototype.reverseConvert=function(a){var b=this.parseUserInput(a),c=this.get("conversionInfo.reverseConvert"),f=g.isSupportedNotation(this.name),
e;if(c)e=c(b);else if("xy"===this.name||"basemap"===this.name)e=g.fromXY(b,this.spatialReference);else if(this.viewModel.formatterAvailable)switch(this.name){case "dd":case "ddm":case "dms":e=k.fromLatitudeLongitude(b,this.spatialReference);break;case "mgrs":e=k.fromMgrs(b,this.spatialReference,"automatic");break;case "utm":e=k.fromUtm(b,this.spatialReference,"latitude-band-indicators");break;case "usng":e=k.fromUsng(b,this.spatialReference);break;default:e=null}else if(f)return g.fromGeoCoordinateString({coordinate:b,
spatialReference:this.spatialReference,formatName:this.name,geometryServicePromise:this.get("viewModel.geometryServicePromise")});return e?this._project(e,this._viewSpatialReference):d.reject(new m("format:invalid-input","Could not parse input into point.",{userInput:a}))};b.prototype._getCoordinate=function(a){var b=this.get("viewModel.view.scale");if(!g.isValidPoint(a))return d.reject(new m("format:invalid-point","Could not transform invalid point into coordinate.",{point:a}));if(this.get("viewModel.formatterAvailable")||
"basemap"===this.name||"xy"===this.name)switch(this.name){case "dd":case "ddm":case "dms":return b=g.getDegreePrecision(b),d.resolve(k.toLatitudeLongitude(a,this.name,b));case "mgrs":return d.resolve(k.toMgrs(a,"automatic",5,!1));case "usng":return d.resolve(k.toUsng(a,5,!1));case "utm":return d.resolve(k.toUtm(a,"latitude-band-indicators",!0));default:return d.resolve(g.pointToCoordinate(a,b))}else return g.isSupportedNotation(this.name)?g.toGeoCoordinateString({formatName:this.name,location:a,geometryServicePromise:this.get("viewModel.geometryServicePromise")}):
d.resolve(g.pointToCoordinate(a,b))};b.prototype._project=function(a,b){return u.equals(a.spatialReference,b)||!b?d.resolve(a):this.get("viewModel.formatterAvailable")&&p.isLoaded()?d.resolve(p.project(a,b)):this.get("viewModel.formatterAvailable")?null:q.canProject(a,b)?d.resolve(q.project(a,b)):g.project({location:a,spatialReference:b,geometryServicePromise:this.get("viewModel.geometryServicePromise"),scale:this.get("viewModel.view.scale")}).then(function(a){return a.location})};f([c.property()],
b.prototype,"conversionInfo",void 0);f([c.property()],b.prototype,"coordinateSegments",void 0);f([c.property()],b.prototype,"currentPattern",null);f([c.property()],b.prototype,"defaultPattern",void 0);f([c.property({readOnly:!0,dependsOn:["defaultPattern","coordinateSegments"]})],b.prototype,"hasDisplayProperties",null);f([c.property()],b.prototype,"name",void 0);f([c.property({dependsOn:["_viewSpatialReference","name"],type:l.SpatialReference})],b.prototype,"spatialReference",null);f([c.property()],
b.prototype,"viewModel",void 0);f([c.property({dependsOn:["viewModel.view.spatialReference"],readOnly:!0})],b.prototype,"_viewSpatialReference",null);f([c.property({readOnly:!0,dependsOn:["currentPattern"]})],b.prototype,"_additionalCharactersPattern",null);return b=f([c.subclass("esri.widgets.CoordinateConversion.support.Format")],b)}(c.declared(t))});