// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define(["require","exports","dojo/has","./StyleLayer"],function(m,n,p,k){return function(){function l(b,d){this.styleJSON=b;this.version=parseFloat(b.version);this.sprite=d?d.spriteUrl:b.sprite;this.glyphs=d?d.glyphsUrl:b.glyphs;this.layers=(b.layers||[]).map(l._create);this._identifyRefLayers()}l.prototype._identifyRefLayers=function(){for(var b=[],d=[],e=0,h=0,g=this.layers;h<g.length;h++){var a=g[h];if(1===a.type){var f=a,c=a.sourceLayer,c=c+("|"+JSON.stringify(a.minzoom)),c=c+("|"+JSON.stringify(a.maxzoom)),
c=c+("|"+JSON.stringify(a.filter));if(f.hasDataDrivenFill||f.hasDataDrivenOutline)c+="|"+JSON.stringify(e);b.push({key:c,layer:a})}2===a.type&&(f=a,c=a.sourceLayer,c+="|"+JSON.stringify(a.minzoom),c+="|"+JSON.stringify(a.maxzoom),c+="|"+JSON.stringify(a.filter),c+="|"+JSON.stringify(a.layout&&a.layout["line-cap"]),c+="|"+JSON.stringify(a.layout&&a.layout["line-join"]),f.hasDataDrivenLine&&(c+="|"+JSON.stringify(e)),d.push({key:c,layer:a}));++e}this._assignRefLayers(b);this._assignRefLayers(d)};l.prototype._assignRefLayers=
function(b){b.sort(function(a,b){return a.key<b.key?-1:a.key>b.key?1:0});for(var d,e,h=b.length,g=0;g<h;g++){var a=b[g];if(a.key===d)a.layer.refLayerId=e;else if(d=a.key,e=a.layer.id,1===a.layer.type&&!a.layer.getPaintProperty("fill-outline-color"))for(var f=g+1;f<h;f++){var c=b[f];if(c.key===d){if(c.layer.getPaintProperty("fill-outline-color")){b[g]=c;b[f]=a;e=c.layer.id;break}}else break}}};l._create=function(b,d,e){d=1-1/(e.length+1)*(1+d);switch(b.type){case "background":return new k.BackgroundStyleLayer(0,
b,d);case "fill":return new k.FillStyleLayer(1,b,d);case "line":return new k.LineStyleLayer(2,b,d);case "symbol":return new k.SymbolStyleLayer(3,b,d);case "raster":throw Error("Unsupported vector tile raster layer");case "circle":return new k.CircleStyleLayer(4,b,d)}throw Error("Unknown vector tile layer");};return l}()});