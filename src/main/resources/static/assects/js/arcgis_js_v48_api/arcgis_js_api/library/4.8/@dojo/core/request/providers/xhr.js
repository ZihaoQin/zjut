//>>built
(function(d){"object"===typeof module&&"object"===typeof module.exports?(d=d(require,exports),void 0!==d&&(module.exports=d)):"function"===typeof define&&define.amd&&define("require exports tslib @dojo/shim/global @dojo/shim/WeakMap ../../async/Task ../../has ../../Observable ../../util ../Headers ../Response ../SubscriptionPool ../TimeoutError ../util".split(" "),d)})(function(d,m){function g(c){c=f.get(c);if(c.used)return n.default.reject(new TypeError("Body already read"));c.used=!0;return c.task}
function x(){}function D(c,a){c.addEventListener("error",function(c){a(new TypeError(c.error||"Network request failed"))})}Object.defineProperty(m,"__esModule",{value:!0});var y=d("tslib"),H=d("@dojo/shim/global"),I=d("@dojo/shim/WeakMap"),n=d("../../async/Task"),e=d("../../has"),z=d("../../Observable"),J=d("../../util"),E=d("../Headers"),h=d("../Response"),A=d("../SubscriptionPool"),K=d("../TimeoutError"),L=d("../util"),f=new I.default,p=function(c){function a(a){var b=c.call(this)||this,d=b.headers=
new E.default,l=a.getAllResponseHeaders();if(l)for(var l=l.split(/\r\n/g),k=0;k<l.length;k++){var f=l[k].match(/^(.*?): (.*)$/);f&&d.append(f[1],f[2])}b.status=a.status;b.ok=200<=b.status&&300>b.status;b.statusText=a.statusText||"OK";return b}y.__extends(a,c);Object.defineProperty(a.prototype,"bodyUsed",{get:function(){return f.get(this).used},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"nativeResponse",{get:function(){return f.get(this).nativeResponse},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"requestOptions",{get:function(){return f.get(this).requestOptions},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"url",{get:function(){return f.get(this).url},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"download",{get:function(){return f.get(this).downloadObservable},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"data",{get:function(){return f.get(this).dataObservable},enumerable:!0,configurable:!0});
a.prototype.arrayBuffer=function(){return n.default.reject(Error("ArrayBuffer not supported"))};a.prototype.blob=function(){return n.default.reject(Error("Blob not supported"))};a.prototype.formData=function(){return n.default.reject(Error("FormData not supported"))};a.prototype.text=function(){return g(this).then(function(a){return String(a.responseText)})};a.prototype.xml=function(){var a=this;return this.text().then(function(b){return(new DOMParser).parseFromString(b,a.headers.get("content-type")||
"text/html")})};return a}(h.default);m.XhrResponse=p;e.default("blob")&&(p.prototype.blob=function(){return g(this).then(function(c){return c.response})},p.prototype.text=function(){return this.blob().then(h.getTextFromBlob)},e.default("arraybuffer")&&(p.prototype.arrayBuffer=function(){return this.blob().then(h.getArrayBufferFromBlob)}));e.default("formdata")&&(p.prototype.formData=function(){return this.text().then(function(c){var a=new FormData;c.trim().split("\x26").forEach(function(c){if(c){var b=
c.split("\x3d");c=(b.shift()||"").replace(/\+/," ");b=b.join("\x3d").replace(/\+/," ");a.append(decodeURIComponent(c),decodeURIComponent(b))}});return a})});m.default=function(c,a){function d(){r=!0;b&&(b.abort(),b.onreadystatechange=x)}void 0===a&&(a={});var b=new XMLHttpRequest,m=L.generateRequestUrl(c,a);a=Object.create(a);a.method||(a.method="GET");var r=!1,k,t,u=new n.default(function(c,e){t=e;b.onreadystatechange=function(){if(!r&&2===b.readyState){var e=new p(b),h=new A.default,g=new A.default,
l=new n.default(function(a,c){t=c;b.onprogress=function(a){r||h.next(a.loaded)};b.onreadystatechange=function(){r||4!==b.readyState||(b.onreadystatechange=x,k&&k.destroy(),g.next(b.response),g.complete(),a(b))};D(b,c)},d);f.set(e,{task:l,used:!1,nativeResponse:b,requestOptions:a,url:m,downloadObservable:new z.default(function(a){return h.add(a)}),dataObservable:new z.default(function(a){return g.add(a)})});c(e)}};D(b,e)},d);b.open(a.method,m,!a.blockMainThread,a.user,a.password);e.default("filereader")&&
e.default("blob")&&(b.responseType="blob");a.timeout&&0<a.timeout&&Infinity!==a.timeout&&(k=J.createTimer(function(){t&&t(new K.default("The XMLHttpRequest request timed out"));d()},a.timeout));var h=c=!1,v=a.includeRequestedWithHeader,v=void 0===v?!0:v;if(a.headers){var B=new E.default(a.headers),h=B.has("x-requested-with");c=B.has("content-type");try{for(var w=y.__values(B),q=w.next();!q.done;q=w.next()){var g=y.__read(q.value,2);b.setRequestHeader(g[0],g[1])}}catch(M){C={error:M}}finally{try{q&&
!q.done&&(F=w.return)&&F.call(w)}finally{if(C)throw C.error;}}}!h&&v&&b.setRequestHeader("X-Requested-With","XMLHttpRequest");!c&&e.default("formdata")&&a.body instanceof H.default.FormData&&b.setRequestHeader("Content-Type","application/x-www-form-urlencoded");u.finally(function(){0!==u.state&&(b.onreadystatechange=x,k&&k.destroy())});var G=new A.default;u.upload=new z.default(function(a){return G.add(a)});(e.default("host-browser")||e.default("web-worker-xhr-upload"))&&b.upload.addEventListener("progress",
function(a){G.next(a.loaded)});b.send(a.body||null);return u;var C,F}});