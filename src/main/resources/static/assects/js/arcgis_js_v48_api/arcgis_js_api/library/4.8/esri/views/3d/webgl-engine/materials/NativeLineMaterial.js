// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Logger ../../support/geometryUtils ../lib/ComponentUtils ../lib/DefaultVertexBufferLayouts ../lib/gl-matrix ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/Util ./internal/MaterialUtil ../../../webgl/Util".split(" "),function(E,X,v,L,e,M,N,c,F,O,G,x,z,P){var H=x.VertexAttrConstants,I=N.Pos3,Q=P.getStride(I)/4,R={color:[1,1,1,1]},S=L.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");E=function(m){function a(d,
b){b=m.call(this,b)||this;b.params=z.copyParameters(d,R);b.canBeMerged=!0;return b}v(a,m);a.prototype.setColor=function(d){this.params.color=d;this.notifyDirty("matChanged")};a.prototype.getColor=function(){return this.params.color};a.prototype.getParameterValues=function(){return{color:this.params.color}};a.prototype.getOutputAmount=function(d){return d*Q};a.prototype.getInstanceBufferLayout=function(){};a.prototype.getVertexBufferLayout=function(){return I};a.prototype.fillInterleaved=function(d,
b,c,a,e,g,f){c=d.vertexAttr[H.POSITION].data;if(b)for(f=c,c=T,a=0;a<f.length;a+=3){var h=f[a],r=f[a+1],k=f[a+2];c[a]=b[0]*h+b[4]*r+b[8]*k+b[12];c[a+1]=b[1]*h+b[5]*r+b[9]*k+b[13];c[a+2]=b[2]*h+b[6]*r+b[10]*k+b[14]}d=d.indices[H.POSITION];for(a=0;a<d.length;a++)b=3*d[a],e[g++]=c[b],e[g++]=c[b+1],e[g++]=c[b+2]};a.prototype.intersect=function(d,b,a,m,k,n,v,h){if(m.isSelection&&!M.isAllHidden(b.componentVisibilities,d.data.componentOffsets))if(x.isTranslationMatrix(a)){b=d.getData().getVertexAttr().position.data;
k=m.camera;n=m.point;c.vec3d.set3(n[0]-2,n[1]+2,0,w[0]);c.vec3d.set3(n[0]+2,n[1]+2,0,w[1]);c.vec3d.set3(n[0]+2,n[1]-2,0,w[2]);c.vec3d.set3(n[0]-2,n[1]-2,0,w[3]);for(h=0;4>h;h++)k.unprojectPoint(w[h],q[h]);e.plane.fromPoints(k.eye,q[0],q[1],A);e.plane.fromPoints(k.eye,q[1],q[2],B);e.plane.fromPoints(k.eye,q[2],q[3],C);e.plane.fromPoints(k.eye,q[3],q[0],D);d=Number.MAX_VALUE;for(h=0;h<b.length-5;h+=3)if(g[0]=b[h]+a[12],g[1]=b[h+1]+a[13],g[2]=b[h+2]+a[14],f[0]=b[h+3]+a[12],f[1]=b[h+4]+a[13],f[2]=b[h+
5]+a[14],!(0>e.plane.distance(A,g)&&0>e.plane.distance(A,f)||0>e.plane.distance(B,g)&&0>e.plane.distance(B,f)||0>e.plane.distance(C,g)&&0>e.plane.distance(C,f)||0>e.plane.distance(D,g)&&0>e.plane.distance(D,f))){k.projectPoint(g,t);k.projectPoint(f,u);if(0>t[2]&&0<u[2]){c.vec3d.subtract(g,f,p);var l=k.frustumPlanes,r=-e.plane.distance(l[4],g),l=r/c.vec3d.dot(p,l[4]);c.vec3d.scale(p,l,p);c.vec3d.add(g,p,g);k.projectPoint(g,t)}else if(0<t[2]&&0>u[2])c.vec3d.subtract(f,g,p),l=k.frustumPlanes,r=-e.plane.distance(l[4],
f),l=r/c.vec3d.dot(p,l[4]),c.vec3d.scale(p,l,p),c.vec3d.add(f,p,f),k.projectPoint(f,u);else if(0>t[2]&&0>u[2])continue;l=x.pointLineSegmentDistanceSquared2D(t,u,n);l<d&&(d=l,c.vec3d.set(g,J),c.vec3d.set(f,K))}a=m.p0;m=m.p1;4>d&&(d=x.lineLineDistanceSquared3D(J,K,a,m,U),b=Number.MAX_VALUE,d.success&&(c.vec3d.subtract(d.pa,a,y),d=c.vec3d.length(y),c.vec3d.scale(y,1/d),b=d/c.vec3d.dist(a,m)),v(b,y))}else S.error("intersection assumes a translation-only matrix")};a.prototype.getGLMaterials=function(){return{color:V,
depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:W}};a.prototype.getAllTextureIds=function(){return[]};return a}(O);var V=function(c){function a(d,a,e){d=c.call(this,d,a)||this;d.program=a.get("simple");d.updateParameters();return d}v(a,c);a.prototype.updateParameters=function(){this.params=this.material.getParameterValues()};a.prototype.beginSlot=function(a){return a===G.OPAQUE_MATERIAL};a.prototype.getProgram=function(){return this.program};a.prototype.bind=function(a,b){b=this.program;
var d=this.params;a.bindProgram(b);b.setUniform4fv("color",d.color);a.setBlendingEnabled(1>d.color[3]);a.setBlendFunctionSeparate(a.gl.SRC_ALPHA,a.gl.ONE_MINUS_SRC_ALPHA,a.gl.ONE,a.gl.ONE_MINUS_SRC_ALPHA);a.setDepthTestEnabled(!0)};a.prototype.release=function(a){1>this.params.color[3]&&a.setBlendingEnabled(!1)};a.prototype.bindView=function(a,b){z.bindView(b.origin,b.view,this.program)};a.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};a.prototype.getDrawMode=
function(a){return a.gl.LINES};return a}(F),W=function(c){function a(a,b,e){a=c.call(this,a,b)||this;a.program=b.get("highlight");return a}v(a,c);a.prototype.updateParameters=function(){};a.prototype.beginSlot=function(a){return a===G.OPAQUE_MATERIAL};a.prototype.getProgram=function(){return this.program};a.prototype.bind=function(a,b){a.bindProgram(this.program);a.setDepthTestEnabled(!0)};a.prototype.release=function(a){};a.prototype.bindView=function(a,b){z.bindView(b.origin,b.view,this.program)};
a.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};a.prototype.getDrawMode=function(a){return a.gl.LINES};return a}(F),g=c.vec3d.create(),f=c.vec3d.create(),p=c.vec3d.create(),y=c.vec3d.create(),t=c.vec3d.create(),u=c.vec3d.create(),J=c.vec3d.create(),K=c.vec3d.create(),U={success:!1,dist2:0,pa:c.vec3d.create(),pb:c.vec3d.create()},w=[c.vec3d.create(),c.vec3d.create(),c.vec3d.create(),c.vec3d.create()],q=[c.vec3d.create(),c.vec3d.create(),c.vec3d.create(),
c.vec3d.create()],A=e.plane.create(),B=e.plane.create(),C=e.plane.create(),D=e.plane.create(),T=[];return E});