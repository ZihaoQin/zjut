// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define(["require","exports","dojo/has","../global","./utils"],function(k,m,n,d,f){var l=function(){return function(){var b=this,a=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(function(e){b[e]=function(){for(var c=[],b=0;b<arguments.length;b++)c[b]=arguments[b];return a[e].apply(a,c)}})}}(),g=d.MutationObserver||d.WebKitMutationObserver,h=function(){var b;if(d.process&&d.process.nextTick)b=function(a){d.process.nextTick(a)};else if(d.Promise)b=
function(a){d.Promise.resolve().then(a)};else if(g){var a=[],e=document.createElement("div");(new g(function(){for(;0<a.length;)a.shift()()})).observe(e,{attributes:!0});b=function(b){a.push(b);e.setAttribute("queueStatus","1")}}return b}();return function(){function b(){this._dispatcher=new l;this._isInitialized=!1;this._workerPostMessage({type:f.MessageType.HANDSHAKE})}b.prototype.terminate=function(){};Object.defineProperty(b.prototype,"onmessage",{get:function(){return this._onmessageHandler},
set:function(a){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler);(this._onmessageHandler=a)&&this.addEventListener("message",a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"onerror",{get:function(){return this._onerrorHandler},set:function(a){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler);(this._onerrorHandler=a)&&this.addEventListener("error",a)},enumerable:!0,configurable:!0});b.prototype.postMessage=function(a,
b){var e=this;h(function(){e._workerMessageHandler(new MessageEvent("message",{data:a}))})};b.prototype.dispatchEvent=function(a){return this._dispatcher.dispatchEvent(a)};b.prototype.addEventListener=function(a,b,c){this._dispatcher.addEventListener(a,b,c)};b.prototype.removeEventListener=function(a,b,c){this._dispatcher.removeEventListener(a,b,c)};b.prototype._workerPostMessage=function(a,b){var c=this;h(function(){c.dispatchEvent(new MessageEvent("message",{data:a}))})};b.prototype._workerMessageHandler=
function(a){var b=this;if(a=f.receiveMessage(a)){var c=a.jobId;switch(a.type){case f.MessageType.CONFIGURE:this._isInitialized||this._workerPostMessage({type:f.MessageType.CONFIGURED});break;case f.MessageType.OPEN:k(["esri/core/workers/RemoteClient",a.modulePath],function(a,d){a=a.connect(d);b._workerPostMessage({type:f.MessageType.OPENED,jobId:c,data:a})})}}};return b}()});