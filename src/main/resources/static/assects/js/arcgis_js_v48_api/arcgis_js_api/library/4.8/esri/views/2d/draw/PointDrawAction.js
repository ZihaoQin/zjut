// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Evented ../../../core/Handles ../../../core/accessorSupport/decorators ../../../geometry/ScreenPoint ./DrawAction ./input/Keys ../../input/recognizers/PointerClickHoldAndDrag".split(" "),function(u,v,h,f,k,l,m,e,g,n,p,q){var r=function(){function d(c,a,b){this.view=c;this.native=a;this.coordinates=b;this.defaultPrevented=!1;this.type="cursor-update"}d.prototype.preventDefault=
function(){this.defaultPrevented=!0};return d}(),t=function(){function d(c,a){this.native=c;this.coordinates=a;this.defaultPrevented=!1;this.type="draw-complete"}d.prototype.preventDefault=function(){this.defaultPrevented=!0};return d}();return function(d){function c(a){a=d.call(this,a)||this;a._clickDelay=q.DefaultParameters.maximumClickDelay;a._cursorMoved=!1;a._cursorScreenPoint=null;a._pointerDownEvent=null;a._viewHandles=new m;a.coordinates=[];a.view=null;return a}h(c,d);c.prototype.initialize=
function(){this._addViewHandles()};c.prototype.destroy=function(){this._removeViewHandles();this._viewHandles.destroy();this.emit("destroy")};c.prototype.complete=function(){this._cursorScreenPoint&&(this._set("coordinates",this.getCoordsFromScreenPoint(this._cursorScreenPoint)),this._completeDrawing())};c.prototype._addViewHandles=function(){var a=this;this._removeViewHandles();this._viewHandles.add([this.view.on("click",function(b){b.stopPropagation();a._set("coordinates",a.getCoordsFromScreenPoint(b.screenPoint));
a._drawCompleteHandler(b)}),this.view.on("pointer-down",function(b){a._pointerDownEvent=b;a._cursorMoved=!1}),this.view.on("pointer-move",function(b){a._cursorMoved=!0;a._cursorScreenPoint=new g({x:b.x,y:b.y});a._cursorUpdateHandler(b)}),this.view.on("pointer-up",function(b){a._pointerDownEvent&&!a._cursorMoved&&b.timestamp-a._pointerDownEvent.timestamp>a._clickDelay&&(a._cursorScreenPoint=new g({x:b.x,y:b.y}),a._set("coordinates",a.getCoordsFromScreenPoint(a._cursorScreenPoint)),a._drawCompleteHandler(b))}),
this.view.on("key-down",function(b){b.key===p.KEYS.drawCompleteKey&&a._cursorScreenPoint&&(a._set("coordinates",a.getCoordsFromScreenPoint(a._cursorScreenPoint)),a._drawCompleteHandler(b))})])};c.prototype._removeViewHandles=function(){this._viewHandles.removeAll()};c.prototype._updateCursor=function(a,b){this.emit("cursor-update",new r(this.view,b,a))};c.prototype._completeDrawing=function(a){this._cursorMoved=!1;this._pointerDownEvent=null;a=new t(a,this.coordinates);this.emit("draw-complete",a);
a.defaultPrevented||this._removeViewHandles()};c.prototype._cursorUpdateHandler=function(a){this._updateCursor(this.getCoordsFromScreenPoint(this._cursorScreenPoint),a.native)};c.prototype._drawCompleteHandler=function(a){this._completeDrawing(a.native)};f([e.property({readOnly:!0})],c.prototype,"coordinates",void 0);f([e.property()],c.prototype,"view",void 0);return c=f([e.subclass("esri.views.2d.draw.PointDrawAction")],c)}(e.declared(n,k,l))});