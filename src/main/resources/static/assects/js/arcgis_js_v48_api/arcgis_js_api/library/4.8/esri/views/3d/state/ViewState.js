// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ../../../views/ViewAnimation ../lib/glMatrix ./Constraints ./controllers/AnimationController ./controllers/CameraController ../support/earthUtils ../support/Evented ../support/PropertiesPool ../webgl-engine/lib/Camera".split(" "),function(k,l,r,e,t,c,u,f,v,w,h,m,x,y,g){Object.defineProperty(l,"__esModule",{value:!0});k=function(n){function a(b){b=
n.call(this,b)||this;b.propertiesPool=new y.default({camera:g},b);b.lastSeenCameraProjectionValues=new g;b.events=new x.Evented;b.updateQueue=new z;b.processingUpdates=!1;return b}r(a,n);a.prototype.destroy=function(){this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)};a.prototype.normalizeCtorArgs=function(b){return{camera:this.createInitialCamera(b.viewingMode),mode:b.viewingMode,spatialReference:b.spatialReference,constraints:new v.default({mode:b.viewingMode})}};Object.defineProperty(a.prototype,
"animation",{get:function(){return this.cameraController instanceof w.AnimationController?this.cameraController.viewAnimation:null},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"camera",{get:function(){return this._get("camera")},set:function(b){b!==d&&d.copyFrom(b);d.markViewDirty();d.computeUp(this.mode);p.camera=d;this.events.emit("before-camera-change",p);b=this._get("camera");this.cameraProjectionChanged(this.lastSeenCameraProjectionValues,d)&&(this.lastSeenCameraProjectionValues.copyFrom(d),
q.camera=this.lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",q));b&&b.equivalent(d)||this._set("camera",this.propertiesPool.get("camera").copyFrom(d))},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"isGlobal",{get:function(){return!this.isLocal},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"isLocal",{get:function(){return"local"===this.mode},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"interacting",{get:function(){return!!this.cameraController&&
this.cameraController.isInteractive},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"cameraController",{get:function(){return this._get("cameraController")},set:function(b){var a=this;this.stopActiveCameraController()?(b&&(b.watch("state",function(c){if(c===h.State.Finished||c===h.State.Stopped)a._set("cameraController",null),a.updateCamera(function(a){b.onControllerEnd(a)})},!0),b.onControllerStart(this.camera)),this._set("cameraController",b)):b&&(b.state=h.State.Rejected)},enumerable:!0,
configurable:!0});a.prototype.switchCameraController=function(b){this.cameraController=b;return b.state!==h.State.Rejected};a.prototype.stopActiveCameraController=function(){return this.cameraController&&!this.cameraController.stopController()?!1:!0};a.prototype.cameraChanged=function(){this.updateCamera(function(){})};a.prototype.updateCamera=function(b){this.updateQueue.enqueue(b);this.processUpdateQueue()};a.prototype.processUpdateQueue=function(){if(0!==this.updateQueue.length&&!this.processingUpdates){this.processingUpdates=
!0;var b=this.updateQueue.dequeue();d.copyFrom(this._get("camera"));b(d);this.camera=d;this.processingUpdates=!1;this.processUpdateQueue()}};a.prototype.createInitialCamera=function(b){return"global"===b?new g(f.vec3d.createFrom(4*m.earthRadius,0,0),f.vec3d.createFrom(m.earthRadius,0,0),f.vec3d.createFrom(0,0,1)):new g(f.vec3d.createFrom(0,0,100),f.vec3d.createFrom(0,0,0),f.vec3d.createFrom(0,1,0))};a.prototype.cameraProjectionChanged=function(b,a){return b.fov!==a.fov||b.fullViewport[0]!==a.fullViewport[0]||
b.fullViewport[1]!==a.fullViewport[1]||b.fullViewport[2]!==a.fullViewport[2]||b.fullViewport[3]!==a.fullViewport[3]||b.padding[0]!==a.padding[0]||b.padding[1]!==a.padding[1]||b.padding[2]!==a.padding[2]||b.padding[3]!==a.padding[3]?!0:!1};e([c.property({readOnly:!0,type:u,dependsOn:["cameraController"]})],a.prototype,"animation",null);e([c.property({type:g})],a.prototype,"camera",null);e([c.property({constructOnly:!0})],a.prototype,"constraints",void 0);e([c.property({readOnly:!0})],a.prototype,"events",
void 0);e([c.property({readOnly:!0,dependsOn:["isLocal"]})],a.prototype,"isGlobal",null);e([c.property({readOnly:!0,dependsOn:["mode"]})],a.prototype,"isLocal",null);e([c.property({constructOnly:!0})],a.prototype,"mode",void 0);e([c.property({constructOnly:!0})],a.prototype,"spatialReference",void 0);e([c.property({readOnly:!0,dependsOn:["cameraController"]})],a.prototype,"interacting",null);e([c.property()],a.prototype,"cameraController",null);return a=e([c.subclass()],a)}(c.declared(t));l.ViewState=
k;var d=new g,p={camera:null},q={camera:null},z=function(){function c(){this.data=[];this.length=this.ptr=0}c.prototype.enqueue=function(a){this.data.push(a);this.length++};c.prototype.dequeue=function(){if(0===this.length)return null;var a=this.data[this.ptr++];this.length--;0===this.length&&(this.ptr=this.data.length=0);return a};return c}();l.default=k});