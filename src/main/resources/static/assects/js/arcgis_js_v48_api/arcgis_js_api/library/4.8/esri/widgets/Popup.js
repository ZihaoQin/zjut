// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper dojo/dom-geometry dojo/i18n!./Popup/nls/Popup dojo/keys ../core/Handles ../core/lang ../core/Logger ../core/watchUtils ../core/accessorSupport/decorators ./Feature ./Spinner ./Widget ./Popup/PopupViewModel ../widgets/support/widgetUtils ./support/widget".split(" "),function(R,Z,S,d,z,M,n,m,T,H,U,l,e,V,W,X,N,L,c){function A(c,b){return void 0===b?"esri-popup__"+c:"esri-popup__"+
c+"-"+b}var Y=R.toUrl("./Popup/images/default-action.svg"),P={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},Q=U.getLogger("esri.widgets.Popup");return function(O){function b(a){a=O.call(this)||this;a._blurContainer=!1;a._containerNode=null;a._mainContainerNode=null;a._featureMenuNode=null;a._focusContainer=!1;a._focusDockButton=!1;a._focusFeatureMenuButton=!1;a._focusFirstFeature=!1;a._handles=new T;a._displayActionTextLimit=2;a._pointerOffsetInPx=16;a._spinner=null;a.actions=null;a.alignment=
"auto";a.autoCloseEnabled=null;a.content=null;a.collapsed=!1;a.collapseEnabled=!0;a.dockEnabled=!1;a.featureCount=null;a.features=null;a.featureNavigationEnabled=!0;a.goToOverride=null;a.highlightEnabled=null;a.location=null;a.featureWidgets=[];a.promises=null;a.selectedFeature=null;a.selectedFeatureIndex=null;a.selectedFeatureWidget=null;a.spinnerEnabled=!0;a.title=null;a.updateLocationEnabled=null;a.view=null;a.viewModel=new N;a.visible=null;return a}S(b,O);b.prototype.postInitialize=function(){var a=
this;this._addSelectedFeatureIndexHandle();this.own(l.watch(this,"viewModel.screenLocation",function(){return a._positionContainer()}),l.watch(this,["viewModel.visible","dockEnabled"],function(){return a._toggleScreenLocationEnabled()}),l.watch(this,"viewModel.screenLocation",function(f,b){!!f!==!!b&&a.reposition()}),l.watch(this,"viewModel.features",function(f){return a._createFeatureWidgets(f)}),l.watch(this,"viewModel.view.padding viewModel.view.size viewModel.visible viewModel.waitingForResult viewModel.location alignment".split(" "),
function(){return a.reposition()}),l.watch(this,"spinnerEnabled",function(f){return a._spinnerEnabledChange(f)}),l.watch(this,"viewModel.view.size",function(f,b){return a._updateDockEnabledForViewSize(f,b)}),l.watch(this,"viewModel.view",function(f,b){return a._viewChange(f,b)}),l.watch(this,"viewModel.view.ready",function(f,b){return a._viewReadyChange(f,b)}),l.watch(this,["viewModel.waitingForResult","viewModel.location"],function(){return a._displaySpinner()}),l.watch(this,["featureWidgets","viewModel.selectedFeatureIndex"],
function(){return a._updateFeatureWidget()}),l.watch(this,"selectedFeatureWidget.viewModel.title",function(f){return a._setTitleFromFeatureWidget(f)}),l.watch(this,["selectedFeatureWidget.viewModel.content","selectedFeatureWidget.viewModel.waitingForContent"],function(){return a._setContentFromFeatureWidget()}),l.on(this,"viewModel","trigger-action",function(f){return a._zoomToAction(f)}))};b.prototype.destroy=function(){this._destroyFeatureWidgets();this._destroySpinner();this._handles&&this._handles.destroy();
this._handles=null};Object.defineProperty(b.prototype,"currentAlignment",{get:function(){return this._getCurrentAlignment()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"currentDockPosition",{get:function(){return this._getCurrentDockPosition()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"dockOptions",{get:function(){return this._get("dockOptions")||P},set:function(a){var f=z({},P),b=this.get("viewModel.view.breakpoints"),g={};b&&(g.width=b.xsmall,g.height=
b.xsmall);a=z({},f,a);f=z({},f.breakpoint,g);g=a.breakpoint;!0===g?a.breakpoint=f:"object"===typeof g&&(a.breakpoint=z({},f,g));this._set("dockOptions",a);this._setCurrentDockPosition();this.reposition()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"featureMenuOpen",{get:function(){return this.viewModel.visible?this._get("featureMenuOpen"):!1},set:function(a){this._set("featureMenuOpen",!!a)},enumerable:!0,configurable:!0});b.prototype.blur=function(){this.visible||Q.warn("Popup cannot be blurred while visible is false");
this._blurContainer=!0;this.scheduleRender()};b.prototype.clear=function(){};b.prototype.close=function(){this.visible=!1};b.prototype.focus=function(){this.visible||Q.warn("Popup cannot be focused while visible is false");this._focusContainer=!0;this.scheduleRender()};b.prototype.next=function(){return null};b.prototype.open=function(a){this._handles.remove("selected-index");this.set({featureMenuOpen:a?!!a.featureMenuOpen:!1});this.viewModel.open(a);this._addSelectedFeatureIndexHandle()};b.prototype.previous=
function(){return null};b.prototype.reposition=function(){this.renderNow();this._positionContainer();this._setCurrentAlignment()};b.prototype.triggerAction=function(a){return null};b.prototype.render=function(){var a,f,b,g,D,w,k,d=this.collapsed,e=this.collapseEnabled,p=this.dockEnabled,l=this.featureMenuOpen,x=this.featureNavigationEnabled,m=this.featureWidgets,r=this.visible,u=this.viewModel,t=u.allActions,z=u.content,q=u.featureCount,E=u.pendingPromisesCount,F=u.selectedFeatureIndex,B=u.title,
u=1<q&&x,x=1<q&&l,C=e&&!x&&d,d=t&&t.length,v=u&&this._getPageText(q,F),I=this._renderContent(),y=L.isRtl(),G=this.get("selectedFeatureWidget")?this.get("selectedFeatureWidget.viewModel.waitingForContent")||this.get("selectedFeatureWidget.viewModel.content"):I,K=p?n.undock:n.dock,q=this.currentAlignment,t=this.currentDockPosition,E=E?c.tsx("div",{key:A("loading-container"),role:"presentation",class:"esri-popup__loading-container","aria-label":n.loading,title:n.loading},c.tsx("span",{"aria-hidden":"true",
class:this.classes("esri-popup__icon","esri-icon-loading-indicator","esri-rotating")})):null,J=(a={},a["esri-icon-layer-list"]=!x,a["esri-icon-close"]=x,a);a=c.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon",J)});J=(f={},f["esri-icon-right-triangle-arrow"]=y,f["esri-popup__pagination-previous-icon--rtl"]=y,f["esri-icon-left-triangle-arrow"]=!y,f["esri-popup__pagination-previous-icon"]=!y,f);f=c.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon",J)});J=c.tsx("div",
{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes("esri-popup__button","esri-popup__pagination-previous"),"aria-label":n.previous,title:n.previous},f);f=(b={},b["esri-icon-left-triangle-arrow"]=y,b["esri-popup__pagination-next-icon--rtl"]=y,b["esri-icon-right-triangle-arrow"]=!y,b["esri-popup__pagination-next-icon"]=!y,b);b=c.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon",f)});y=c.tsx("div",{role:"button",tabIndex:0,bind:this,
onclick:this._next,onkeydown:this._next,class:this.classes("esri-popup__button","esri-popup__pagination-next"),"aria-label":n.next,title:n.next},b);f=L.cssTransition("enter","esri-popup--feature-updated");b=this.id+"-feature-menu";l=c.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes("esri-popup__button","esri-popup__feature-menu-button"),
"aria-haspopup":"true","aria-controls":b,"aria-expanded":l,"aria-label":n.menu,title:n.menu},a);v=c.tsx("div",{class:"esri-popup__pagination-page-text"},v);l=u?c.tsx("div",{class:"esri-popup__navigation-buttons",enterAnimation:f},J,v,y,E||l):null;v=this._wouldDockTo();v=(g={},g["esri-icon-minimize"]=p,g["esri-popup__icon--dock-icon"]=!p,g["esri-icon-dock-right"]=!p&&("top-right"===v||"bottom-right"===v),g["esri-icon-dock-left"]=!p&&("top-left"===v||"bottom-left"===v),g["esri-icon-maximize"]=!p&&"top-center"===
v,g["esri-icon-dock-bottom"]=!p&&"bottom-center"===v,g);g=c.tsx("span",{"aria-hidden":"true",class:this.classes(v,"esri-popup__icon")});g=this.get("dockOptions.buttonEnabled")?c.tsx("div",{role:"button","aria-label":K,title:K,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes("esri-popup__button","esri-popup__button--dock")},g):null;e=e&&B&&(G||d||u);K=(D={},D["esri-popup__header-title--button"]=
e,D);v=e?"button":"heading";E=e?C?n.expand:n.collapse:"";D=this.id+"-popup-title";B=B?c.tsx("h2",{class:this.classes("esri-popup__header-title",K),key:B,enterAnimation:f,id:D,role:v,"aria-label":E,title:E,bind:this,tabIndex:e?0:-1,onclick:this._toggleCollapsed,onkeydown:this._toggleCollapsed,innerHTML:B}):null;e=c.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon","esri-icon-close")});e=c.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:"esri-popup__button",
"aria-label":n.close,title:n.close},e);e=c.tsx("header",{class:"esri-popup__header"},B,c.tsx("div",{class:"esri-popup__header-buttons"},g,e));g=this.id+"-popup-content";z=G&&!C?c.tsx("article",{key:z,enterAnimation:f,id:g,class:"esri-popup__content"},I):null;I=!C&&("bottom-left"===q||"bottom-center"===q||"bottom-right"===q||"top-left"===t||"top-center"===t||"top-right"===t);C=!C&&("top-left"===q||"top-center"===q||"top-right"===q||"bottom-left"===t||"bottom-center"===t||"bottom-right"===t);G=x?null:
c.tsx("div",{key:A("actions"),class:"esri-popup__actions"},this._renderActions());f=c.tsx("section",{key:A("navigation"),class:"esri-popup__navigation"},l);u=u||d?c.tsx("div",{key:A("feature-buttons"),class:"esri-popup__feature-buttons"},G,f):null;F=this._renderFeatureMenuNode(m,F,x,b);m=H.substitute({total:m.length},n.selectedFeatures);b=c.tsx("section",{key:A("menu"),class:"esri-popup__feature-menu"},c.tsx("h2",{class:"esri-popup__feature-menu-header"},m),c.tsx("nav",{class:"esri-popup__feature-menu-viewport",
afterCreate:this._featureMenuViewportNodeUpdated,afterUpdate:this._featureMenuViewportNodeUpdated},F));m=p?null:c.tsx("div",{key:A("pointer"),class:"esri-popup__pointer",role:"presentation"},c.tsx("div",{class:this.classes("esri-popup__pointer-direction","esri-popup--shadow")}));F=this.get("selectedFeature.layer.title");d=this.get("selectedFeature.layer.id");G=(w={},w["esri-popup--shadow"]=p,w);w=(k={},k["esri-popup--aligned-top-center"]=r&&"top-center"===q,k["esri-popup--aligned-bottom-center"]=
r&&"bottom-center"===q,k["esri-popup--aligned-top-left"]=r&&"top-left"===q,k["esri-popup--aligned-bottom-left"]=r&&"bottom-left"===q,k["esri-popup--aligned-top-right"]=r&&"top-right"===q,k["esri-popup--aligned-bottom-right"]="bottom-right"===q,k["esri-popup--is-docked"]=r&&p,k["esri-popup--shadow"]=r&&!p,k["esri-popup--is-docked-top-left"]=r&&"top-left"===t,k["esri-popup--is-docked-top-center"]=r&&"top-center"===t,k["esri-popup--is-docked-top-right"]=r&&"top-right"===t,k["esri-popup--is-docked-bottom-left"]=
r&&"bottom-left"===t,k["esri-popup--is-docked-bottom-center"]=r&&"bottom-center"===t,k["esri-popup--is-docked-bottom-right"]=r&&"bottom-right"===t,k["esri-popup--feature-menu-open"]=r&&x,k);k=I?b:null;p=C?b:null;x=I?u:null;q=C?u:null;k=c.tsx("div",{class:this.classes("esri-popup__main-container","esri-widget",G),tabIndex:-1,role:"dialog","aria-labelledby":B?D:"","aria-describedby":z?g:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},
x,k,e,z,q,p);return c.tsx("div",{key:A("base"),class:this.classes("esri-popup",w),role:"presentation","data-layer-title":F,"data-layer-id":d,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},r?[k,m]:null)};b.prototype._featureMenuOpenChanged=function(a){a?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0};b.prototype._setTitleFromFeatureWidget=function(a){this.selectedFeatureWidget&&(this.viewModel.title=a||"")};b.prototype._setContentFromFeatureWidget=function(){var a=
this.selectedFeatureWidget;a&&(this.viewModel.content=a)};b.prototype._handleFeatureMenuKeyup=function(a){a.keyCode===m.ESCAPE&&(a.stopPropagation(),this.featureMenuOpen=!1)};b.prototype._handleFeatureMenuItemKeyup=function(a){var b=a.keyCode,h=this._featureMenuNode,g=this.get("features.length"),c=a.currentTarget["data-feature-index"];h&&(h=h.querySelectorAll("li"),b===m.UP_ARROW?(a.stopPropagation(),h[(c-1+g)%g].focus()):b===m.DOWN_ARROW?(a.stopPropagation(),h[(c+1+g)%g].focus()):b===m.HOME?(a.stopPropagation(),
h[0].focus()):b===m.END&&(a.stopPropagation(),h[h.length-1].focus()))};b.prototype._handleMainKeyup=function(a){var b=a.keyCode;b===m.LEFT_ARROW&&(a.stopPropagation(),this.previous());b===m.RIGHT_ARROW&&(a.stopPropagation(),this.next())};b.prototype._zoomToAction=function(a){a.action&&!a.action.disabled&&"zoom-to"===a.action.id&&this.viewModel.zoomToLocation()};b.prototype._spinnerEnabledChange=function(a){this._destroySpinner();a&&(a=this.get("viewModel.view"),this._createSpinner(a))};b.prototype._displaySpinner=
function(){var a=this._spinner;if(a){var b=this.viewModel,h=b.location;b.waitingForResult?a.show({location:h}):a.hide()}};b.prototype._getIconStyles=function(a){return{"background-image":a?"url("+a+")":""}};b.prototype._renderAction=function(a,b,h,g){var f=this,w,d,e=l.watch(a,"active className disabled id title image visible".split(" "),function(){return f.scheduleRender()});this._handles.add(e,g);e=this.get("selectedFeature.attributes");"zoom-to"===a.id&&(a.title=n.zoom,a.className="esri-icon-zoom-in-magnifying-glass");
g=a.title;var m=a.className,p=a.image||m?a.image:Y;g=g&&e?H.substitute(e,g):g;m=m&&e?H.substitute(e,m):m;e=p&&e?H.substitute(e,p):p;p=(w={},w["esri-icon-loading-indicator"]=a.active,w["esri-rotating"]=a.active,w["esri-popup__action-image"]=!a.active&&!!e,w);m&&(p[m]=!a.active);w=(d={},d["esri-popup__action"]="toggle"!==a.type,d["esri-popup__action-toggle"]="toggle"===a.type,d["esri-popup__action-toggle--on"]="toggle"===a.type&&a.value,d["esri-popup__button--disabled"]=a.disabled,d);h=h<=this._displayActionTextLimit?
c.tsx("span",{key:"text",class:"esri-popup__action-text"},g):null;return a.visible?c.tsx("div",{key:a,role:"button",tabIndex:0,title:g,"aria-label":g,class:this.classes("esri-popup__button",w),bind:this,"data-action-index":b,onclick:this._triggerAction,onkeydown:this._triggerAction},c.tsx("span",{key:"icon","aria-hidden":"true",class:this.classes("esri-popup__icon",p),styles:this._getIconStyles(e)}),h):null};b.prototype._renderActions=function(){var a=this;this._handles.remove("actions");var b=this.viewModel.allActions;
if(b){var h=b.length;return b.map(function(b,f){return a._renderAction(b,f,h,"actions")}).toArray()}};b.prototype._addSelectedFeatureIndexHandle=function(){var a=this,b=l.watch(this,"viewModel.selectedFeatureIndex",function(b,f){return a._selectedFeatureIndexUpdated(b,f)});this._handles.add(b,"selected-index")};b.prototype._selectedFeatureIndexUpdated=function(a,b){var f=this.featureMenuOpen;this.featureCount&&f&&a!==b&&-1!==a&&(this.featureMenuOpen=!1)};b.prototype._updateFeatureWidget=function(){var a=
this.featureWidgets[this.viewModel.selectedFeatureIndex]||null;a&&!a.contentEnabled&&(a.contentEnabled=!0);this._set("selectedFeatureWidget",a)};b.prototype._destroyFeatureWidgets=function(){this.featureWidgets.forEach(function(a){return a.destroy()});this._set("featureWidgets",[])};b.prototype._createFeatureWidgets=function(a){var b=this.featureWidgets.slice(0),c=this.get("viewModel.view"),g=[];a.forEach(function(a,f){if(a){var h=null;b.some(function(f,c){f&&f.graphic===a&&(h=f,b.splice(c,1));return!!h});
g[f]=h||new V({contentEnabled:!1,graphic:a,view:c})}});b.forEach(function(a){return a&&a.destroy()});this._set("featureWidgets",g)};b.prototype._isScreenLocationWithinView=function(a,b){return-1<a.x&&-1<a.y&&a.x<=b.width&&a.y<=b.height};b.prototype._isOutsideView=function(a){var b=a.popupHeight,c=a.popupWidth,g=a.screenLocation,e=a.side;a=a.view;if(isNaN(c)||isNaN(b)||!a||!g)return!1;var d=a.padding;return"right"===e&&g.x+c/2>a.width-d.right||"left"===e&&g.x-c/2<d.left||"top"===e&&g.y-b<d.top||"bottom"===
e&&g.y+b>a.height-d.bottom?!0:!1};b.prototype._determineCurrentAlignment=function(){var a=this._pointerOffsetInPx,b=this._containerNode,c=this._mainContainerNode,g=this.viewModel,e=g.screenLocation,g=g.view;if(!e||!g||!b)return"top-center";if(!this._isScreenLocationWithinView(e,g))return this._get("currentAlignment")||"top-center";var d=c?window.getComputedStyle(c,null):null,c=d?parseInt(d.getPropertyValue("max-height").replace(/[^-\d\.]/g,""),10):0,d=d?parseInt(d.getPropertyValue("height").replace(/[^-\d\.]/g,
""),10):0,k=M.getContentBox(b),b=k.w+a,k=Math.max(k.h,c,d)+a,a=this._isOutsideView({popupHeight:k,popupWidth:b,screenLocation:e,side:"right",view:g}),c=this._isOutsideView({popupHeight:k,popupWidth:b,screenLocation:e,side:"left",view:g}),d=this._isOutsideView({popupHeight:k,popupWidth:b,screenLocation:e,side:"top",view:g}),e=this._isOutsideView({popupHeight:k,popupWidth:b,screenLocation:e,side:"bottom",view:g});return c?d?"bottom-right":"top-right":a?d?"bottom-left":"top-left":d?e?"top-center":"bottom-center":
"top-center"};b.prototype._getCurrentAlignment=function(){var a=this.alignment;return this.dockEnabled?null:"auto"===a?this._determineCurrentAlignment():"function"===typeof a?a.call(this):a};b.prototype._setCurrentAlignment=function(){this._set("currentAlignment",this._getCurrentAlignment())};b.prototype._setCurrentDockPosition=function(){this._set("currentDockPosition",this._getCurrentDockPosition())};b.prototype._getDockPosition=function(){var a=this.get("dockOptions.position");return"auto"===a?
this._determineCurrentDockPosition():"function"===typeof a?a.call(this):a};b.prototype._getCurrentDockPosition=function(){return this.dockEnabled?this._getDockPosition():null};b.prototype._wouldDockTo=function(){return this.dockEnabled?null:this._getDockPosition()};b.prototype._renderFeatureMenuItemNode=function(a,b,e,g){var f,d=b===e;g=(f={},f["esri-popup__feature-menu-item--selected"]=d,f);f=d?c.tsx("span",{key:A("feature-menu-selected-feature-"+e),title:n.selectedFeature,"aria-label":n.selectedFeature,
class:"esri-icon-check-mark"}):null;a=c.tsx("span",{innerHTML:a.title||n.untitled});return c.tsx("li",{role:"menuitem",tabIndex:-1,key:A("feature-menu-feature-"+e),class:this.classes(g,"esri-popup__feature-menu-item"),bind:this,"data-feature-index":b,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature},c.tsx("span",{class:"esri-popup__feature-menu-title"},a,f))};b.prototype._renderFeatureMenuNode=function(a,b,e,d){var f=this;return 1<a.length?c.tsx("ol",
{class:"esri-popup__feature-menu-list",id:d,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},a.map(function(a,c){return f._renderFeatureMenuItemNode(a,c,b,e)})):null};b.prototype._determineCurrentDockPosition=function(){var a=this.get("viewModel.view"),b=L.isRtl()?"top-left":"top-right";if(!a)return b;var c=a.padding||{left:0,right:0,top:0,bottom:0},c=a.width-c.left-c.right;return(a=a.get("breakpoints"))&&
c<=a.xsmall?"bottom-center":b};b.prototype._renderContent=function(){var a=this.get("viewModel.content");if("string"===typeof a)return c.tsx("div",{key:a,innerHTML:a});if(c.isWidget(a))return c.tsx("div",{key:a},a.render());if(a instanceof HTMLElement)return c.tsx("div",{key:a,bind:a,afterCreate:this._attachToNode});if(c.isWidgetBase(a))return c.tsx("div",{key:a,bind:a.domNode,afterCreate:this._attachToNode})};b.prototype._attachToNode=function(a){a.appendChild(this)};b.prototype._positionContainer=
function(a){void 0===a&&(a=this._containerNode);a&&(this._containerNode=a);if(a){var b=this.viewModel.screenLocation,c=M.getContentBox(a);if(b=this._calculatePositionStyle(b,c))a.style.top=b.top,a.style.left=b.left,a.style.bottom=b.bottom,a.style.right=b.right}};b.prototype._calculateFullWidth=function(a){var b=this.currentAlignment,c=this._pointerOffsetInPx;return"top-left"===b||"bottom-left"===b||"top-right"===b||"bottom-right"===b?a+c:a};b.prototype._calculateAlignmentPosition=function(a,b,c,e){var f=
this.currentAlignment,d=this._pointerOffsetInPx;e/=2;var g=c.height-b;c=c.width-a;var h=this.view.padding;if("bottom-center"===f)return{top:b+d-h.top,left:a-e-h.left};if("top-left"===f)return{bottom:g+d-h.bottom,right:c+d-h.right};if("bottom-left"===f)return{top:b+d-h.top,right:c+d-h.right};if("top-right"===f)return{bottom:g+d-h.bottom,left:a+d-h.left};if("bottom-right"===f)return{top:b+d-h.top,left:a+d-h.left};if("top-center"===f)return{bottom:g+d-h.bottom,left:a-e-h.left}};b.prototype._calculatePositionStyle=
function(a,b){var c=this.view;if(c){if(this.dockEnabled)return{left:"",top:"",right:"",bottom:""};if(a&&b&&(b=this._calculateFullWidth(b.w),a=this._calculateAlignmentPosition(a.x,a.y,c,b)))return{top:void 0!==a.top?a.top+"px":"auto",left:void 0!==a.left?a.left+"px":"auto",bottom:void 0!==a.bottom?a.bottom+"px":"auto",right:void 0!==a.right?a.right+"px":"auto"}}};b.prototype._viewChange=function(a,b){a&&b&&(this.close(),this.clear())};b.prototype._viewReadyChange=function(a,b){a?(a=this.get("viewModel.view"),
this._wireUpView(a)):b&&(this.close(),this.clear())};b.prototype._wireUpView=function(a){this._destroySpinner();a&&(this.spinnerEnabled&&this._createSpinner(a),this._setDockEnabledForViewSize(this.dockOptions))};b.prototype._dockingThresholdCrossed=function(a,b,c){var f=a[0];a=a[1];var d=b[0];b=b[1];var e=c.width;c=c.height;return f<=e&&d>e||f>e&&d<=e||a<=c&&b>c||a>c&&b<=c};b.prototype._updateDockEnabledForViewSize=function(a,b){if(a&&b){var c=this.get("viewModel.view.padding")||{left:0,right:0,top:0,
bottom:0},d=c.left+c.right,e=c.top+c.bottom,c=[],f=[];c[0]=a[0]-d;c[1]=a[1]-e;f[0]=b[0]-d;f[1]=b[1]-e;a=this.dockOptions;this._dockingThresholdCrossed(c,f,a.breakpoint)&&this._setDockEnabledForViewSize(a);this._setCurrentDockPosition()}};b.prototype._focusDockButtonNode=function(a){this._focusDockButton&&(this._focusDockButton=!1,a.focus())};b.prototype._mainContainerNodeUpdated=function(a){this._mainContainerNode=a;this._focusContainer?(this._focusContainer=!1,a.focus()):this._blurContainer&&(this._blurContainer=
!1,a.blur())};b.prototype._featureMenuNodeUpdated=function(a){(this._featureMenuNode=a)&&this._focusFirstFeature&&(this._focusFirstFeature=!1,a=a.querySelectorAll("li"),a.length&&a[0].focus())};b.prototype._focusFeatureMenuButtonNode=function(a){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,a.focus())};b.prototype._featureMenuViewportNodeUpdated=function(a){a&&(a.scrollTop=0)};b.prototype._toggleScreenLocationEnabled=function(){var a=this.dockEnabled,b=this.viewModel;b&&(b.screenLocationEnabled=
this.visible&&!a)};b.prototype._shouldDockAtCurrentViewSize=function(a){a=a.breakpoint;var b=this.get("viewModel.view.ui"),c=b.width,b=b.height;if(isNaN(c)||isNaN(b))return!1;c=a.hasOwnProperty("width")&&c<=a.width;a=a.hasOwnProperty("height")&&b<=a.height;return c||a};b.prototype._setDockEnabledForViewSize=function(a){a.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(a))};b.prototype._getPageText=function(a,b){return H.substitute({index:b+1,total:a},n.pageText)};b.prototype._destroySpinner=
function(){var a=this._spinner,b=this.view;a&&(b&&b.ui.remove(this._spinner,"popup-spinner"),a.destroy(),this._spinner=null)};b.prototype._createSpinner=function(a){a&&(this._spinner=new W({view:a}),a.ui.add(this._spinner,{key:"popup-spinner",position:"manual"}))};b.prototype._toggleCollapsed=function(){this.collapsed=!this.collapsed};b.prototype._close=function(){this.close();this.view&&this.view.focus()};b.prototype._toggleDockEnabled=function(){this.dockEnabled=!this.dockEnabled;this._focusDockButton=
!0;this.scheduleRender()};b.prototype._toggleFeatureMenu=function(){var a=!this.featureMenuOpen;this._featureMenuOpenChanged(a);this.featureMenuOpen=a};b.prototype._triggerAction=function(a){a=a.currentTarget["data-action-index"];var b=this.viewModel.allActions.getItemAt(a);b&&"toggle"===b.type&&(b.value=!b.value);this.viewModel.triggerAction(a)};b.prototype._selectFeature=function(a){a=a.currentTarget["data-feature-index"];isNaN(a)||(this.viewModel.selectedFeatureIndex=a)};b.prototype._next=function(){this.next()};
b.prototype._previous=function(){this.previous()};d([e.aliasOf("viewModel.actions"),c.renderable()],b.prototype,"actions",void 0);d([e.property()],b.prototype,"alignment",void 0);d([e.aliasOf("viewModel.autoCloseEnabled")],b.prototype,"autoCloseEnabled",void 0);d([e.aliasOf("viewModel.content"),c.renderable()],b.prototype,"content",void 0);d([e.property(),c.renderable()],b.prototype,"collapsed",void 0);d([e.property(),c.renderable()],b.prototype,"collapseEnabled",void 0);d([e.property({readOnly:!0,
dependsOn:["dockEnabled","alignment"]}),c.renderable()],b.prototype,"currentAlignment",null);d([e.property({readOnly:!0,dependsOn:["viewModel.view.ready","dockEnabled","dockOptions"]}),c.renderable()],b.prototype,"currentDockPosition",null);d([e.property(),c.renderable()],b.prototype,"dockOptions",null);d([e.property(),c.renderable()],b.prototype,"dockEnabled",void 0);d([e.aliasOf("viewModel.featureCount"),c.renderable()],b.prototype,"featureCount",void 0);d([e.property({dependsOn:["viewModel.visible"]}),
c.renderable()],b.prototype,"featureMenuOpen",null);d([e.aliasOf("viewModel.features"),c.renderable()],b.prototype,"features",void 0);d([e.property(),c.renderable()],b.prototype,"featureNavigationEnabled",void 0);d([e.aliasOf("viewModel.goToOverride")],b.prototype,"goToOverride",void 0);d([e.aliasOf("viewModel.highlightEnabled")],b.prototype,"highlightEnabled",void 0);d([e.aliasOf("viewModel.location"),c.renderable()],b.prototype,"location",void 0);d([e.property({readOnly:!0}),c.renderable()],b.prototype,
"featureWidgets",void 0);d([e.aliasOf("viewModel.promises")],b.prototype,"promises",void 0);d([e.aliasOf("viewModel.selectedFeature"),c.renderable()],b.prototype,"selectedFeature",void 0);d([e.aliasOf("viewModel.selectedFeatureIndex"),c.renderable()],b.prototype,"selectedFeatureIndex",void 0);d([e.property({readOnly:!0}),c.renderable()],b.prototype,"selectedFeatureWidget",void 0);d([e.property()],b.prototype,"spinnerEnabled",void 0);d([e.aliasOf("viewModel.title"),c.renderable()],b.prototype,"title",
void 0);d([e.aliasOf("viewModel.updateLocationEnabled")],b.prototype,"updateLocationEnabled",void 0);d([e.aliasOf("viewModel.view")],b.prototype,"view",void 0);d([e.property({type:N}),c.renderable("viewModel.allActions viewModel.screenLocation viewModel.screenLocationEnabled viewModel.state viewModel.pendingPromisesCount viewModel.promiseCount viewModel.waitingForResult".split(" ")),c.vmEvent(["triggerAction","trigger-action"])],b.prototype,"viewModel",void 0);d([e.aliasOf("viewModel.visible"),c.renderable()],
b.prototype,"visible",void 0);d([e.aliasOf("viewModel.clear")],b.prototype,"clear",null);d([e.aliasOf("viewModel.next")],b.prototype,"next",null);d([e.aliasOf("viewModel.previous")],b.prototype,"previous",null);d([e.aliasOf("viewModel.triggerAction")],b.prototype,"triggerAction",null);d([c.accessibleHandler()],b.prototype,"_toggleCollapsed",null);d([c.accessibleHandler()],b.prototype,"_close",null);d([c.accessibleHandler()],b.prototype,"_toggleDockEnabled",null);d([c.accessibleHandler()],b.prototype,
"_toggleFeatureMenu",null);d([c.accessibleHandler()],b.prototype,"_triggerAction",null);d([c.accessibleHandler()],b.prototype,"_selectFeature",null);d([c.accessibleHandler()],b.prototype,"_next",null);d([c.accessibleHandler()],b.prototype,"_previous",null);return b=d([e.subclass("esri.widgets.Popup")],b)}(e.declared(X))});