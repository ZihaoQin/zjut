// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports dojo/sniff dojo/promise/all ../Logger ../promiseUtils ./Connection ./RemoteClient ./WorkerOwner".split(" "),function(p,b,e,q,r,h,d,t,u){function k(){if(f)return f;for(var b=l+m,c=[],e=function(b){var a=u.create(b).then(function(a){return g[b]=a});c.push(a)},d=0;d<b;d++)e(d);return f=q(c).then(function(){})}Object.defineProperty(b,"__esModule",{value:!0});b.Connection=d;b.RemoteClient=t;(d=e("host-browser")?navigator.hardwareConcurrency:0)||(d=e("safari")&&e("mac")||e("trident")?
8:2);var l=e("esri-workers-debug")?1:Math.max(1,Math.ceil(d/2)),m=e("esri-workers-debug")?1:Math.max(1,Math.floor(d/2)),v=r.getLogger("esri.core.workers"),n=0,g=[];b.initialize=function(){k()};b.open=function(a,c,d){void 0===c&&(c={});if(Array.isArray(a))return new b.Connection(a.map(function(a){return new b.RemoteClient(a,c.client)}));if("string"!==typeof a){v.warn("workers-open:signature-deprecated","DEPRECATED: workers.open() changed signature.");var e=a;a=c;c={client:e,strategy:d?"dedicated":
"distributed"}}var f=c.strategy||"distributed";return"local"===f?h.create(function(c){p([a],function(a){c(b.RemoteClient.connect(a))})}).then(function(a){return new b.Connection([new b.RemoteClient(a,c.client)])}):k().then(function(){if("dedicated"===f){var d=l+n++;n%=m;return g[d].open(a).then(function(a){return new b.Connection([new b.RemoteClient(a,c.client)])})}return h.all(g.map(function(b){return b.open(a)})).then(function(a){return new b.Connection(a.map(function(a){return new b.RemoteClient(a,
c.client)}))})})};b.terminate=function(){f&&(f.cancel(),f=null);for(var a=0;a<g.length;a++)g[a]&&g[a].terminate();g.length=0};var f=null});