// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../geometry","../../../core/Logger","../MeshComponent"],function(v,m,p,q,r){function t(a,c,f){if(a.components)for(var d=0,g=a.components;d<g.length;d++){for(var b=g[d],e=b.clone(),b=0;b<e.faces.length;b++)e.faces[b]+=c.position/3;b=e;0<c.normal&&!a.vertexAttributes.normal&&"source"===b.shading&&(b.shading="flat");f.push(e)}else if(a.vertexAttributes&&a.vertexAttributes.position){d=a.vertexAttributes.position.length/3;g=new Uint32Array(d);for(b=0;b<d;b++)g[b]=b+c.position;
d=b=new r({faces:g});0<c.normal&&!a.vertexAttributes.normal&&"source"===d.shading&&(d.shading="flat");f.push(b)}}function l(a,c,f,d){if(c){var g=c.position;if(g)if(c=c[a]){g=0;f=f[a];for(var b=d[a],e=c.length,h=0;h<e;h++)f[b++]=c[g++];d[a]+=c.length}else if(c=f[a],f=d[a],b=k[a],c){for(e=0;e<g.length;e+=3)for(h=0;h<b;h++)c[f++]=0;d[a]=f}}}function u(a){var c,f,d=0,g=0,b=0;c=f=!1;for(var e=0;e<a.length;e++){var h=a[e].vertexAttributes;if(h&&h.position&&(h.uv&&(f=!0),h.normal&&(c=!0),c&&f))break}for(e=
0;e<a.length;e++)(h=a[e].vertexAttributes)&&h.position&&(d+=h.position.length,f&&(g+=h.position.length/k.position*k.uv),c&&(b+=h.position.length/k.position*k.normal));return{position:new Float64Array(d),uv:g?new Float32Array(g):null,normal:b?new Float32Array(b):null}}Object.defineProperty(m,"__esModule",{value:!0});var n=q.getLogger("esri.geometry.support.triangleMeshMerge");m.merge=function(a){if(0===a.length)return n.error("merge()","Must specify one more more geometries to merge"),null;var c=a[0].spatialReference;
if(a.some(function(a){return!a.spatialReference.equals(c)}))return n.error("merge()","Geometries must all be in the same spatial reference"),null;for(var f=u(a),d=[],g={position:0,uv:0,normal:0},b=0;b<a.length;b++){var e=a[b],h=e.vertexAttributes;t(e,g,d);l("position",h,f,g);l("normal",h,f,g);l("uv",h,f,g)}return new p.Mesh({vertexAttributes:f,components:d,spatialReference:c})};var k={position:3,normal:3,uv:2}});