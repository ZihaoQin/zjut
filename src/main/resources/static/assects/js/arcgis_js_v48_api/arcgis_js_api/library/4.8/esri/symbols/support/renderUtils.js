// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports dojox/gfx dojox/gfx/matrix ../../kernel ../../request ../../core/colorUtils ../../core/Error ../../core/lang ../../core/promiseUtils ../../core/sniff".split(" "),function(H,u,A,w,x,B,v,C,D,E,y){function F(a){return a.map(function(c){return c.command+" "+c.values.join(",")}).join(" ").trim()}function G(a,c,e,l){var h=l&&l.node||document.createElement("div"),g=A.createSurface(h,c,e);null!=l.opacity&&(h.style.opacity=l.opacity.toString());try{a.forEach(function(a){var h=g.createGroup(),
d=0;a.forEach(function(b){var a=b.shape,e=b.fill,c=b.stroke;d+=c&&c.width||0;var f=null;a&&("path"===a.type&&"string"!==typeof a.path&&(a.path=F(a.path)),f=h.createShape(a).setFill(e).setStroke(c?c:{width:0}),"text"===a.type&&f.setFont(b.font))});var f=h.getBoundingBox();a=f.width;var q=f.height,m=-(f.x+a/2),b=-(f.y+q/2),k=g.getDimensions(),m={dx:m+k.width/2,dy:b+k.height/2},b=!1;if(l.scale&&0!==f.width&&0!==f.height){var b=f.width/f.height,n=(c>e?c:e)-2*d,p=1,t=1;isNaN(n)||(1<b?(p=n/f.width,t=n/
b/f.height):(t=n/f.height,p=n*b/f.width));h.applyTransform(w.scaleAt(p,t,k.width/2,k.height/2));b=!0}!b&&(a>c||q>e)&&(f=a/c>q/e,f=((f?c:e)-5)/(f?a:q),D.mixin(m,{xx:f,yy:f}));h.applyTransform(m);l.rotation&&h.applyTransform(w.rotategAt(l.rotation,a/2,q/2))})}catch(I){return g.clear(),g.destroy(),null}return h}function z(a,c,e,l){return a?B(a,{responseType:"image",allowImageDataAccess:e}).then(function(a){a=a.data;var g=a.width,h=a.height,r=g/h,d=c;l&&(d=Math.min(d,Math.max(g,h)));return{image:e?a:
null,width:1>=r?Math.ceil(d*r):d,height:1>=r?d:Math.ceil(d/r)}}).catch(function(h){if(e)return z(a,c,!1,l);throw h;}):E.reject(new C("renderUtils: imageDataSize","href not provided."))}Object.defineProperty(u,"__esModule",{value:!0});u.renderSymbol=function(a,c,e){var l=Math.ceil(c[0]);c=Math.ceil(c[1]);return a.some(function(a){return!!a.length})?G(a,l,c,e):null};u.tintImageWithColor=function(a,c,e,l,h){return z(a,c,!!e,h).then(function(g){var h=g.width?g.width:c,r=g.height?g.height:c,d;if(d=g.image)d=
e&&"ignore"!==l?"multiply"===l&&255===e.r&&255===e.g&&255===e.b&&1===e.a?!1:!0:!1;if(d){var f=g.image.width,q=g.image.height;(y("edge")||y("ie"))&&/\.svg$/i.test(a)&&(--f,--q);var m,b;m=Math.ceil(h);b=Math.ceil(r);d=document.createElement("canvas");d.width=m;d.height=b;d.style.width=m+"px";d.style.height=b+"px";d=d.getContext("2d");d.clearRect(0,0,m,b);d.drawImage(g.image,0,0,f,q,0,0,h,r);g=d.getImageData(0,0,h,r);f=[e.r/255,e.g/255,e.b/255,e.a];q=v.toHSV(e);for(m=0;m<g.data.length;m+=4){b=g.data;
var k=m,n=f,p=q;switch(l){case "multiply":b[k+0]*=n[0];b[k+1]*=n[1];b[k+2]*=n[2];b[k+3]*=n[3];break;default:var t=v.toHSV({r:b[k+0],g:b[k+1],b:b[k+2]});t.h=p.h;t.s=p.s;t.v=t.v/100*p.v;p=v.toRGB(t);b[k+0]=p.r;b[k+1]=p.g;b[k+2]=p.b;b[k+3]*=n[3]}}d.putImageData(g,0,0);a=d.canvas.toDataURL("image/png")}else(d=x.id&&x.id.findCredential(a))&&d.token&&(g=-1===a.indexOf("?")?"?":"\x26",a=""+a+g+"token\x3d"+d.token);return{url:a,width:h,height:r}}).catch(function(){return{url:a,width:c,height:c}})}});