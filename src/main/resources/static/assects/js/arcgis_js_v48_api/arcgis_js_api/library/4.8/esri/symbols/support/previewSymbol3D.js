// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports ../../core/Error ../../core/Logger ../../core/promiseUtils ../../core/screenUtils ./gfxUtils ./previewUtils ./renderUtils ./styleUtils ./symbolUtils".split(" "),function(G,B,C,H,w,u,I,v,y,J,D){function x(a){var c=a.outline,b=a.get("material.color"),b=b&&b.toRgba().toString();if(!c)return"fill"===a.type&&"255,255,255,1"===b?{color:"#bdc3c7",width:.75}:null;a=u.pt2px(c.size)||0;return{color:"rgba("+(null!=c.color?c.color.toRgba():"255,255,255,1")+")",width:Math.min(a,80)}}function K(a,
c){var b=c&&c.resource,b=b&&b.href;return a.thumbnail&&a.thumbnail.url?w.resolve(a.thumbnail.url):b&&"object"!==c.type?w.resolve(D.getIconHref(a,c)):a.styleOrigin&&(a.styleOrigin.styleName||a.styleOrigin.styleUrl)?J.resolveWebStyleSymbol(a.styleOrigin,{portal:a.styleOrigin.portal}).always(function(a){return a&&a.thumbnail&&a.thumbnail.url||E}):w.resolve(E)}function f(a,c){void 0===c&&(c=0);if(!a.material||!a.material.color)return a=Math.min(Math.max(I.defaultThematicColor.r+191.25*c,0),255),[a,a,
a,100];for(var b=a.material.color.toRgb(),f=0;3>f;f++)b[f]=Math.min(Math.max(b[f]+191.25*c,0),255);b.push(a.material.color.a);return b}function F(a){return a.outline?x(a):{color:"rgba(0, 0, 0, 1)",width:1.5}}function z(a,c){if(!a.material)return{};for(var b=a.material.color.toRgb(),f="rgba(",m=0;3>m;m++)f+=Math.min(Math.max(b[m]+191.25*c,0),255)+",";f+=a.material.color.a+");";a=a.size?u.pt2px(a.size):.75;return{color:f,width:Math.min(a,80)}}function A(a,c,b){b*=.75;return{type:"linear",x1:b?.25*b:
0,y1:b?.5*b:0,x2:b||4,y2:b?.5*b:4,colors:[{color:a,offset:0},{color:c,offset:1}]}}function L(a){var c=a.depth,b=a.height;return(a=a.width)&&c&&b&&a===c&&a<b}function M(a,c,b,g){var m=a&&a.type,t="object"===m,e=[];if("icon"===m)switch(c){case "circle":e.push({shape:{type:"circle",cx:0,cy:0,r:.5*b},fill:f(a,0),stroke:x(a)});break;case "square":e.push({shape:{type:"path",path:[{command:"M",values:[0,b]},{command:"L",values:[0,0]},{command:"L",values:[b,0]},{command:"L",values:[b,b]},{command:"Z",values:[]}]},
fill:f(a,0),stroke:x(a)});break;case "cross":e.push({shape:{type:"path",path:[{command:"M",values:[.5*b,0]},{command:"L",values:[.5*b,b]},{command:"M",values:[0,.5*b]},{command:"L",values:[b,.5*b]},{command:"E",values:[]}]},stroke:F(a)});break;case "x":e.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[b,b]},{command:"M",values:[b,0]},{command:"L",values:[0,b]},{command:"E",values:[]}]},stroke:F(a)});break;case "kite":e.push({shape:{type:"path",path:[{command:"M",values:[0,
.5*b]},{command:"L",values:[.5*b,0]},{command:"L",values:[b,.5*b]},{command:"L",values:[.5*b,b]},{command:"Z",values:[]}]},fill:f(a,0),stroke:x(a)})}else if(t)switch(c){case "cone":c=f(a,0);a=f(a,-.6);a=A(c,a,g?20:b);b=v.getConeShapes(b,g);e.push({shape:b[0],fill:a});e.push({shape:b[1],fill:a});break;case "inverted-cone":g=f(a,0);a=f(a,-.6);a=A(g,a,b);b=v.getInvertedConeShapes(b);e.push({shape:b[0],fill:a});e.push({shape:b[1],fill:g});break;case "cube":b=v.getCubeShapes(b,g);e.push({shape:b[0],fill:f(a,
0)});e.push({shape:b[1],fill:f(a,-.3)});e.push({shape:b[2],fill:f(a,-.5)});break;case "cylinder":c=f(a,0);m=f(a,-.6);c=A(c,m,g?20:b);b=v.getCylinderShapes(b,g);e.push({shape:b[0],fill:c});e.push({shape:b[1],fill:c});e.push({shape:b[2],fill:f(a,0)});break;case "diamond":b=v.getDiamondShapes(b);e.push({shape:b[0],fill:f(a,-.3)});e.push({shape:b[1],fill:f(a,0)});e.push({shape:b[2],fill:f(a,-.3)});e.push({shape:b[3],fill:f(a,-.7)});break;case "sphere":g=f(a,0);a=f(a,-.6);a=A(g,a);a.x1=0;a.y1=0;a.x2=.25*
b;a.y2=.25*b;e.push({shape:{type:"circle",cx:0,cy:0,r:.5*b},fill:a});break;case "tetrahedron":b=v.getTetrahedronShapes(b),e.push({shape:b[0],fill:f(a,-.3)}),e.push({shape:b[1],fill:f(a,0)}),e.push({shape:b[2],fill:f(a,-.6)})}return e}function N(a,c){var b=c&&c.size?u.pt2px(c.size):null,f=c&&c.maxSize?u.pt2px(c.maxSize):null,m=c&&c.disableUpsampling,t=a.symbolLayers,e=[],h=0,r=0,d=t.getItemAt(t.length-1),q;d&&"icon"===d.type&&(q=d.size&&u.pt2px(d.size));t.forEach(function(d,l){if("icon"===d.type||
"object"===d.type){l="icon"===d.type?d.size&&u.pt2px(d.size):0;var n=b||l?Math.ceil(Math.min(b||l,f||120)):22,k=x(d),p=k?k.width:0;if(d&&d.resource&&d.resource.href)l=K(a,d).then(function(a){var b=d.get("material.color"),c;c="icon"===d.type?"multiply":"tint";return y.tintImageWithColor(a,n,b,c,m)}).then(function(a){var b=a.width,c=a.height;h=Math.max(h,b+2*p);r=Math.max(r,c+2*p);return[{shape:{type:"image",width:b,height:c,src:a.url},fill:null,stroke:null}]}),e.unshift(l);else{(k=d.get("resource.primitive"))||
(k="icon"===d.type?"circle":"sphere");var g=n;"icon"===d.type&&q&&b&&(g=l/q*n);l=c&&"tall"===c.symbolConfig||("object"===d.type?L(d):!1);h=Math.max(h,l?20:g+2*p);r=Math.max(r,g+2*p);e.unshift(w.resolve(M(d,k,g,l)))}}});return w.eachAlways(e).then(function(a){var b=[];a.forEach(function(a){a.value?b.push(a.value):a.error&&O.warn("error while building swatchInfo!",a.error)});return y.renderSymbol(b,[h,r],{node:c&&c.node,scale:!1})})}function P(a,c){var b=a.symbolLayers,g=[];a=D.isVolumetricSymbol(a);
var m=c&&c.size?u.pt2px(c.size):null,t=(c&&c.maxSize?u.pt2px(c.maxSize):null)||80,e=0,h=0,r;b.forEach(function(a,b){var c=a&&a.type,d="line"===c;if(d||"path"===c){var n=z(a,0),k=n&&n.width||0,c=[];d?(0===b&&(r=k),a=Math.min(m||k,t),a=0===b?a:m?k/r*a:a,h=Math.max(h,a),e=Math.max(e,22<a?2*a:40),n.width=a,c.push({shape:{type:"path",path:[{command:"M",values:[0,.5*h]},{command:"L",values:[e,.5*h]},{command:"E",values:[]}]},stroke:n})):(b=Math.min(m||22,t),n=f(a,0),d=f(a,-.2),a=z(a,-.4),a.width=1,c.push({shape:v.shapes.pathSymbol3DLayer[0],
fill:d,stroke:a}),c.push({shape:v.shapes.pathSymbol3DLayer[1],fill:n,stroke:a}),e=h=Math.max(h,b+2));g.push(c)}});return w.resolve(y.renderSymbol(g,[e,h],{node:c&&c.node,scale:a}))}Object.defineProperty(B,"__esModule",{value:!0});var E=G.toUrl("../../images/Legend/legend3dsymboldefault.png"),O=H.getLogger("esri.symbols.support.previewSymbol3D");B.getSymbolLayerFill=f;B.previewSymbol3D=function(a,c){if(0===a.symbolLayers.length)return w.reject(new C("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));
var b=null;switch(a.type){case "point-3d":b=N(a,c);break;case "line-3d":b=P(a,c);break;case "polygon-3d":case "mesh-3d":a:{b="mesh-3d"===a.type;a=a.symbolLayers;for(var g=c&&c.size?u.pt2px(c.size):null,m=c&&c.maxSize?u.pt2px(c.maxSize):null,g=g||22,t=[],e=0,h=0,r=0;r<a.length;r++){var d=a.getItemAt(r),q=d.type,p="fill"===q,l="line"===q,n="extrude"===d.type,q=[];if(b&&!p){b=void 0;break a}var k=v.shapes.fill[0];p?(l=(p=x(d))&&p.width||0,e=Math.max(e,22+l),h=Math.max(h,22+l),q.push({shape:k,fill:f(d,
0),stroke:p})):l?(d=(p=z(d,0))&&p.width||0,k={stroke:p,shape:k},e=Math.max(e,22+d),h=Math.max(h,22+d),q.push(k)):n&&(k=z(d,-.4),p=f(d,0),d=f(d,-.2),l=Math.min(g,m||120),n=v.getExtrudeSymbolShapes(l),k.width=1,q.push({shape:n[0],fill:d,stroke:k}),q.push({shape:n[1],fill:d,stroke:k}),q.push({shape:n[2],fill:p,stroke:k}),d=22*.7+.5*l,e=Math.max(e,22+2*k.width),h=Math.max(h,d+2*k.width));t.push(q)}b=w.resolve(y.renderSymbol(t,[e,h],{node:c&&c.node,scale:!1}))}}return b?b:w.reject(new C("symbolPreview: swatchInfo3D",
"symbol not supported."))}});