// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define(["./global","dojo/date","dojo/number","dojo/date/locale","dojo/i18n!../nls/common"],function(l,r,t,u,v){function m(a,c,b){var d,e,f={};for(d in c){e=c[d];var g=!(d in f)||f[d]!==e;if(!(d in a)||a[d]!==e&&g)a[d]=b?b(e):e}return a}function h(a,c,b){var d=b.match(/([^\(]+)(\([^\)]+\))?/i),e=d[1].trim();b=c[a];var d=JSON.parse((d[2]?d[2].trim():"{}").replace(/^\(/,"{").replace(/\)$/,"}").replace(/([{,])\s*([0-9a-zA-Z\_]+)\s*:/gi,'$1"$2":').replace(/\"\s*:\s*\'/gi,'":"').replace(/\'\s*(,|\})/gi,
'"$1')),f=d.utcOffset;if(-1===w.indexOf(e))e=l[e],"function"===typeof e&&(b=e(b,a,c,d));else if("number"===typeof b||"string"===typeof b&&b&&!isNaN(Number(b)))switch(b=Number(b),e){case "NumberFormat":a=n.mixin({},d);c=parseFloat(a.places);if(isNaN(c)||0>c)a.places=Infinity;return t.format(b,a);case "DateString":b=new Date(b);if(d.local||d.systemLocale)return d.systemLocale?b.toLocaleDateString()+(d.hideTime?"":" "+b.toLocaleTimeString()):b.toDateString()+(d.hideTime?"":" "+b.toTimeString());b=b.toUTCString();
d.hideTime&&(b=b.replace(/\s+\d\d\:\d\d\:\d\d\s+(utc|gmt)/i,""));return b;case "DateFormat":return b=new Date(b),null!=f&&(b=r.add(b,"minute",b.getTimezoneOffset()-f)),u.format(b,d)}return null!=b?b:""}function p(a,c){var b;if(c)for(b in a)a.hasOwnProperty(b)&&(void 0===a[b]?delete a[b]:a[b]instanceof Object&&p(a[b],!0));else for(b in a)a.hasOwnProperty(b)&&void 0===a[b]&&delete a[b];return a}function k(a){return a&&"object"==typeof a&&"function"!==typeof a?a instanceof Int8Array||a instanceof Uint8Array||
a instanceof Uint8ClampedArray||a instanceof Int16Array||a instanceof Int32Array||a instanceof Uint16Array||a instanceof Uint32Array||a instanceof Float32Array||a instanceof Float64Array||a instanceof Date?new a.constructor(a):a instanceof ArrayBuffer?a.slice(0,a.byteLength):"function"===typeof a.clone?a.clone():"function"===typeof a.map&&"function"===typeof a.forEach?a.map(k):"function"===typeof a.notifyChange&&"function"===typeof a.watch?a.clone():m({},a,k):a}var w=["NumberFormat","DateString",
"DateFormat"],q=/<\/?[^>]+>/g,n={equals:function(a,c){return a===c||"number"===typeof a&&isNaN(a)&&"number"===typeof c&&isNaN(c)||"function"===typeof(a||{}).getTime&&"function"===typeof(c||{}).getTime&&a.getTime()==c.getTime()||"function"===typeof(a||{}).equals&&a.equals(c)||"function"===typeof(c||{}).equals&&c.equals(a)||!1},mixin:function(a){a||(a={});for(var c=1,b=arguments.length;c<b;c++)m(a,arguments[c]);return a},valueOf:function(a,c){for(var b in a)if(a[b]==c)return b;return null},stripTags:function(a){if(a){var c=
typeof a;if("string"===c)a=a.replace(q,"");else if("object"===c)for(var b in a)(c=a[b])&&"string"===typeof c&&(c=c.replace(q,"")),a[b]=c}return a},substitute:function(a,c,b){var d,e,f;null!=b&&("object"===typeof b?(d=b.first,e=b.dateFormat,f=b.numberFormat):d=b);if(c&&"{*}"!==c)return c.replace(/\{([^\}]+)\}/g,function(a,b){a=b.split(":");if(1<a.length)return b=a[0],a.shift(),h(b,this.obj,a.join(":"));if(e&&-1!==(e.properties||[]).indexOf(b))return h(b,this.obj,e.formatter||"DateString");if(f&&-1!==
(f.properties||[]).indexOf(b))return h(b,this.obj,f.formatter||"NumberFormat");b=this.obj[b];return null!=b?b:""}.bind({obj:a}));c=[];var g;c.push('\x3ctable class\x3d"esri-widget__table" summary\x3d"'+v.fieldsSummary+'"\x3e\x3ctbody\x3e');for(g in a)if(b=a[g],e&&-1!==(e.properties||[]).indexOf(g)?b=h(g,a,e.formatter||"DateString"):f&&-1!==(f.properties||[]).indexOf(g)&&(b=h(g,a,f.formatter||"NumberFormat")),c.push("\x3ctr\x3e\x3cth\x3e"+g+"\x3c/th\x3e\x3ctd\x3e"+(null!=b?b:"")+"\x3c/td\x3e\x3c/tr\x3e"),
d)break;c.push("\x3c/tbody\x3e\x3c/table\x3e");return c.join("")},filter:function(a,c,b){c=["string"===typeof a?a.split(""):a,b||l,"string"===typeof c?new Function("item","index","array",c):c];b={};var d;a=c[0];for(d in a)c[2].call(c[d],a[d],d,a)&&(b[d]=a[d]);return b},startsWith:function(a,c,b){b=b||0;return a.indexOf(c,b)===b},endsWith:function(a,c,b){if("number"!==typeof b||!isFinite(b)||Math.floor(b)!==b||b>a.length)b=a.length;b-=c.length;a=a.indexOf(c,b);return-1!==a&&a===b},isDefined:function(a){return void 0!==
a&&null!==a},fixJson:p,clone:k};return n});