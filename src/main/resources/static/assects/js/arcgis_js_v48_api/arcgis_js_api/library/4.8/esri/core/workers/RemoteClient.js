// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
require({cache:{"esri/core/workers/utils":function(){define(["require","exports","dojo/has"],function(g,b,h){function k(a){return a&&"object"===typeof a&&("result"in a||"transferList"in a)}function l(a){return a instanceof ArrayBuffer||a&&a.constructor&&"ArrayBuffer"===a.constructor.name}Object.defineProperty(b,"__esModule",{value:!0});(function(a){a[a.HANDSHAKE=0]="HANDSHAKE";a[a.CONFIGURE=1]="CONFIGURE";a[a.CONFIGURED=2]="CONFIGURED";a[a.OPEN=3]="OPEN";a[a.OPENED=4]="OPENED";a[a.RESPONSE=5]="RESPONSE";
a[a.INVOKE=6]="INVOKE";a[a.CANCEL=7]="CANCEL";a[a.CLOSE=8]="CLOSE";a[a.OPEN_PORT=9]="OPEN_PORT"})(b.MessageType||(b.MessageType={}));var d=0;b.newJobId=function(){return d++};b.isTranferableResult=k;b.toInvokeError=function(a){return a?a.toJSON?JSON.stringify(a):JSON.stringify({name:a.name,message:a.message,details:a.details,stack:a.stack}):null};b.postMessage=function(a,e,c,d){2===arguments.length||void 0===c&&void 0===d?a.postMessage(e):(h("esri-workers-supports-transfer-arraybuffer")||(d?(d=d.filter(function(a){return!l(a)}),
d.length||(d=null)):k(c)&&c.transferList&&(c.transferList=c.transferList.filter(function(a){return!l(a)}),c.transferList.length||(c.transferList=null))),d?(e.data=c,a.postMessage(e,d)):k(c)?(e.data=c.result,c.transferList?a.postMessage(e,c.transferList):a.postMessage(e)):(e.data=c,a.postMessage(e)))};b.receiveMessage=function(a){return a?(a=a.data)?"string"===typeof a?JSON.parse(a):a:null:null}})},"esri/core/workers/request":function(){define(["require","exports","../tsSupport/assignHelper","../Error",
"../global"],function(g,b,h,k,l){Object.defineProperty(b,"__esModule",{value:!0});var d;b.execute=function(a,e){void 0===e&&(e={});var c=e.responseType;c?"json"!==c&&"text"!==c&&"blob"!==c&&"array-buffer"!==c&&(c="text"):c="json";return l.invokeStaticMessage("request",{url:a,options:e}).then(function(b){var l=b.data,n,g,m;if(l&&("json"===c||"text"===c||"blob"===c)&&(n=new Blob([l]),"json"===c||"text"===c)&&(d||(d=new FileReaderSync),g=d.readAsText(n),"json"===c)){try{m=JSON.parse(g||null)}catch(f){throw b=
h({},f,{url:a,requestOptions:e}),new k("request:server",f.message,b);}if(m.error)throw b=h({},m.error,{url:a,requestOptions:e}),new k("request:server",m.error.message,b);}switch(c){case "json":break;case "text":m=g;break;case "blob":m=n;break;default:m=l}return{data:m,requestOptions:e,ssl:b.ssl,url:a}})}})},"esri/core/tsSupport/assignHelper":function(){define([],function(){return Object.assign||function(g){for(var b,h=1,k=arguments.length;h<k;h++){b=arguments[h];for(var l in b)Object.prototype.hasOwnProperty.call(b,
l)&&(g[l]=b[l])}return g}})},"*noref":1}});
define("require exports dojo/Deferred ../Error ../promiseUtils ./utils".split(" "),function(g,b,h,k,l,d){function a(a,f){a["delete"](f)}var e=d.MessageType.CLOSE,c=d.MessageType.CANCEL,u=d.MessageType.INVOKE,q=d.MessageType.RESPONSE,n=d.MessageType.OPEN_PORT,v=function(){function a(a){this._timer=null;this._cancelledJobIds=new Set;this._invokeMessages=[];this._invoke=a;this._timer=null;this._process=this._process.bind(this)}a.prototype.push=function(a){a.type===d.MessageType.CANCEL?this._cancelledJobIds.add(a.jobId):
(this._invokeMessages.push(a),null===this._timer&&(this._timer=setTimeout(this._process,0)))};a.prototype.clear=function(){this._invokeMessages.length=0;this._cancelledJobIds.clear();this._timer=null};a.prototype._process=function(){this._timer=null;for(var a=0,c=this._invokeMessages;a<c.length;a++){var d=c[a];this._cancelledJobIds.has(d.jobId)||this._invoke(d)}this._cancelledJobIds.clear();this._invokeMessages.length=0};return a}();return function(){function b(a,b,c){this._outJobs=new Map;this._inJobs=
new Map;this._queue=new v(this._onInvoke.bind(this));this._onMessage=this._onMessage.bind(this);this._client=b;this._port=a;this._port.addEventListener("message",this._onMessage);this._port.start();this._channel=c}b.connect=function(a){var f=new MessageChannel;a="function"===typeof a?new a:"default"in a&&"function"===typeof a.default?new a.default:a;a.remoteClient=new b(f.port1,a,f);return f.port2};b.prototype.close=function(){this._post({type:e});this._close()};b.prototype.isBusy=function(){return 0<
this._outJobs.size};b.prototype.invoke=function(b,r,e){var f=this;if(!this._port)return l.reject(new k("remote-client:port-closed","Can't invoke(), port is closed"));var p=d.newJobId(),g=new h(function(){a(f._outJobs,p);f._post({type:c,jobId:p})});this._outJobs.set(p,g);this._post({type:u,jobId:p,methodName:b},r,e);return g.promise};b.prototype.openPort=function(){var b=this,r=d.newJobId(),p=new h(function(){a(b._outJobs,r);b._post({type:c,jobId:r})});this._outJobs.set(r,p);this._post({type:n,jobId:r});
return p.promise};b.prototype._close=function(){this._channel&&(this._channel=null);this._port.removeEventListener("message",this._onMessage);this._port.close();this._outJobs.forEach(function(a){a.cancel()});this._inJobs.clear();this._outJobs.clear();this._queue.clear();this._port=this._client=null};b.prototype._onMessage=function(a){if(a=d.receiveMessage(a))switch(a.type){case q:this._onResponse(a);break;case u:this._queue.push(a);break;case c:this._onCancel(a);break;case e:this._close();break;case n:this._onOpenPort(a)}};
b.prototype._onCancel=function(b){var c=this._inJobs,d=b.jobId,f=c.get(d);this._queue.push(b);f&&(a(c,d),f.cancel())};b.prototype._onInvoke=function(b){var c=this,f=b.methodName,e=b.jobId;b=b.data;var g=this._inJobs,h=this._client,k=h[f],m;try{if(!k&&f&&-1!==f.indexOf("."))for(var n=f.split("."),t=0;t<n.length-1;t++)h=h[n[t]],k=h[n[t+1]];if("function"!==typeof k)throw new TypeError(f+" is not a function");m=k.call(h,b,this)}catch(w){this._post({type:q,jobId:e,error:d.toInvokeError(w)});return}l.isThenable(m)?
(g.set(e,m),m.then(function(b){g.has(e)&&(a(g,e),c._post({type:q,jobId:e},b))}).catch(function(b){g.has(e)&&(a(g,e),b&&"cancel"===b.dojoType||c._post({type:q,jobId:e,error:d.toInvokeError(b||{message:"Error encountered at method "+f})}))})):this._post({type:q,jobId:e},m)};b.prototype._onOpenPort=function(a){var c=new MessageChannel;new b(c.port1,this._client);this._post({type:q,jobId:a.jobId},c.port2,[c.port2])};b.prototype._onResponse=function(b){var c=b.jobId,d=b.error;b=b.data;var e=this._outJobs;
if(e.has(c)){var f=e.get(c);a(e,c);d?f.reject(k.fromJSON(JSON.parse(d))):f.resolve(b)}};b.prototype._post=function(a,b,c){return d.postMessage(this._port,a,b,c)};return b}()});