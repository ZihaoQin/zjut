// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ../../../layers/support/LOD".split(" "),function(v,w,r,h,t,e,u){return function(k){function a(){var b=null!==k&&k.apply(this,arguments)||this;b._lodByScale={};b._scales=[];b.effectiveLODs=null;b.effectiveMinZoom=-1;b.effectiveMaxZoom=-1;b.effectiveMinScale=0;b.effectiveMaxScale=0;b.enabled=!0;b.lods=null;b.minZoom=-1;b.maxZoom=
-1;b.minScale=0;b.maxScale=0;b.snapToZoom=!0;return b}r(a,k);l=a;a.prototype.initialize=function(){var b=this,c,d,a=this.lods;d=this.minScale;c=this.maxScale;var f=this.minZoom,g=this.maxZoom,e=-1,h=-1,k=!1,l=!1;0!==d&&0!==c&&d<c&&(c=[c,d],d=c[0],c=c[1]);if(a&&a.length){a=a.map(function(b){return b.clone()});a.sort(function(b,c){return c.scale-b.scale});a.forEach(function(b,c){return b.level=c});for(var n,p=0,q=a;p<q.length;p++){var m=q[p];!k&&0<d&&d>=m.scale&&(e=m.level,k=!0);!l&&0<c&&c>=m.scale&&
(h=n?n.level:-1,l=!0);n=m}-1===f&&(f=0===d?0:e);-1===g&&(g=0===c?a.length-1:h);f=Math.max(f,0);f=Math.min(f,a.length-1);g=Math.max(g,0);g=Math.min(g,a.length-1);f>g&&(d=[g,f],f=d[0],g=d[1]);d=a[f].scale;c=a[g].scale;a.splice(0,f);a.splice(g-f+1,a.length);a.forEach(function(c,a){b._lodByScale[c.scale]=c;b._scales[a]=c.scale});this._set("effectiveLODs",a);this._set("effectiveMinZoom",f);this._set("effectiveMaxZoom",g)}this._set("effectiveMinScale",d);this._set("effectiveMaxScale",c)};a.prototype.constrain=
function(b,c){if(!this.enabled||c&&b.scale===c.scale)return b;var a=this.effectiveMinScale,e=this.effectiveMaxScale,f=b.targetGeometry,g=c&&c.targetGeometry,h=0!==a&&b.scale>a;if(0!==e&&b.scale<e||h)a=h?a:e,g&&(c=(a-c.scale)/(b.scale-c.scale),f.x=g.x+(f.x-g.x)*c,f.y=g.y+(f.y-g.y)*c),b.scale=a;this.snapToZoom&&this.effectiveLODs&&(b.scale=this._getClosestScale(b.scale));return b};a.prototype.fit=function(b){if(!this.effectiveLODs)return this.constrain(b,null);var c=b.scale,a=this.scaleToZoom(c);b.scale=
.99<Math.abs(a-Math.round(a))?this.snapToPreviousScale(c):this.zoomToScale(Math.round(a));return b};a.prototype.zoomToScale=function(b){if(!this.effectiveLODs)return 0;b-=this.effectiveMinZoom;b=Math.max(0,b);var a=this._scales;if(0>=b)return a[0];if(b>=a.length)return a[a.length-1];var d=Math.round(b);return a[d]+(d-b)*(a[Math.round(b-.5)]-a[d])};a.prototype.scaleToZoom=function(b){if(!this.effectiveLODs)return-1;var a=this._scales,d=0,e=a.length-1,f,g;for(d;d<e;d++){f=a[d];g=a[d+1];if(f<=b)return d+
this.effectiveMinZoom;if(g===b)return d+1+this.effectiveMinZoom;if(f>b&&g<b)return d+1-(b-g)/(f-g)+this.effectiveMinZoom}return d};a.prototype.snapToClosestScale=function(b){if(!this.effectiveLODs)return b;b=this.scaleToZoom(b);return this.zoomToScale(Math.round(b))};a.prototype.snapToNextScale=function(b,a){void 0===a&&(a=.5);if(!this.effectiveLODs)return b*a;b=Math.round(this.scaleToZoom(b));return this.zoomToScale(b+1)};a.prototype.snapToPreviousScale=function(b,a){void 0===a&&(a=2);if(!this.effectiveLODs)return b*
a;b=Math.round(this.scaleToZoom(b));return this.zoomToScale(b-1)};a.prototype.clone=function(){return new l({enabled:this.enabled,lods:this.lods,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale})};a.prototype._getClosestScale=function(a){if(this._lodByScale[a])return this._lodByScale[a].scale;a=this._scales.reduce(function(b,d,e,f){return Math.abs(d-a)<=Math.abs(b-a)?d:b},this._scales[0]);return this._lodByScale[a].scale};var l;h([e.property({readOnly:!0})],
a.prototype,"effectiveLODs",void 0);h([e.property({readOnly:!0})],a.prototype,"effectiveMinZoom",void 0);h([e.property({readOnly:!0})],a.prototype,"effectiveMaxZoom",void 0);h([e.property({readOnly:!0})],a.prototype,"effectiveMinScale",void 0);h([e.property({readOnly:!0})],a.prototype,"effectiveMaxScale",void 0);h([e.property()],a.prototype,"enabled",void 0);h([e.property({type:[u]})],a.prototype,"lods",void 0);h([e.property()],a.prototype,"minZoom",void 0);h([e.property()],a.prototype,"maxZoom",
void 0);h([e.property()],a.prototype,"minScale",void 0);h([e.property()],a.prototype,"maxScale",void 0);h([e.property()],a.prototype,"snapToZoom",void 0);return a=l=h([e.subclass("esri.views.2d.constraints.ZoomConstraint")],a)}(e.declared(t))});