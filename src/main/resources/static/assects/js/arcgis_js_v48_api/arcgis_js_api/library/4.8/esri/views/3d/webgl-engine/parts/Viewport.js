// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports dojo/has ../../support/geometryUtils ../lib/Camera ../lib/gl-matrix ../lib/PerformanceTimer ../lib/Util ./Visualizer".split(" "),function(J,K,L,d,l,k,M,q,m){var h=[0,0],p=k.mat4d.create(),b=[d.plane.create(),d.plane.create(),d.plane.create(),d.plane.create(),d.plane.create(),d.plane.create()];return function(){function a(c,n,a,b,g){this._content=new Map;this._frustumCullingEnabled=!0;this._maxFarNearRatio=2E4;this._stats={renderGeometriesTotal:0,renderGeometriesVisible:0,visualizerRenderTimer:null,
viewportRenderTimer:null};this._needsRender=!0;this._rctx=g;this._gl=g.gl;this._visualizer=new m(c,n,a,b,this._rctx);this._camera=new l(k.vec3.createFrom(0,100,-100),k.vec3.createFrom(0,0,0))}Object.defineProperty(a.prototype,"isLoadingResources",{get:function(){return this._visualizer.isLoadingResources},enumerable:!0,configurable:!0});a.prototype.getCombinedStats=function(){var c={},a=this._visualizer.getCombinedStats(),b;for(b in a)c[b]=a[b];c.renderGeometriesTotal=this._stats.renderGeometriesTotal;
c.renderGeometriesVisible=this._stats.renderGeometriesVisible;void 0!==this._gl.getUsedTextureMemory&&(c.textureMemory=this._gl.getUsedTextureMemory());void 0!==this._gl.getUsedRenderbufferMemory&&(c.renderbufferMemory=this._gl.getUsedRenderbufferMemory());void 0!==this._gl.getUsedVBOMemory&&(c.VBOMemory=this._gl.getUsedVBOMemory());if(void 0!==this._gl.getUsedTextureMemoryStats){var a=this._gl.getUsedTextureMemoryStats(),e;for(e in a)c["texMem type: "+e]=a[e]}return c};a.prototype.dispose=function(){this._visualizer.dispose();
this._visualizer=null};a.prototype.setLighting=function(c){this._visualizer.setLighting(c)};a.prototype.getViewParams=function(c){var a=this._visualizer.getViewParams(c);if(!c||c.frustumCullingEnabled)a.frustumCullingEnabled=this._frustumCullingEnabled;if(!c||c.maxFarNearRatio)a.maxFarNearRatio=this._maxFarNearRatio;return a};a.prototype.setViewParams=function(c){void 0!==c.frustumCullingEnabled&&(this._frustumCullingEnabled=c.frustumCullingEnabled);void 0!==c.maxFarNearRatio&&(this._maxFarNearRatio=
-1===c.maxFarNearRatio?2E4:c.maxFarNearRatio);this._visualizer.setViewParams(c);this._needsRender=!0};a.prototype.setRenderParams=function(c){this._visualizer.setRenderParams(c)};a.prototype.getRenderParams=function(){return this._visualizer.getRenderParams()};a.prototype.getEdgeView=function(){return this._visualizer.getEdgeView()};a.prototype.modify=function(c,a,b,e){this._visualizer.modify(c,a,b,e);this._content=this._visualizer.getContent()};a.prototype.getContent=function(){return this._content};
a.prototype.setCamera=function(c){this._camera.copyFrom(c);this._updateNearFar();this._needsRender=!0};a.prototype.getCamera=function(){return this._camera};a.prototype.getPickRay=function(c,a,b){return this.pickRayWithBeginPoint(c,void 0,this._camera.viewMatrix,a,b)};a.prototype.pickRayWithBeginPoint=function(c,a,b,e,g){return this._visualizer.getPickRay(c,a,this._camera,b,e,g)};a.prototype.addExternalRenderer=function(c,a){return this._visualizer.addExternalRenderer(c,a)};a.prototype.removeExternalRenderer=
function(a){return this._visualizer.removeExternalRenderer(a)};a.prototype.getExternalRenderers=function(){return this._visualizer.getExternalRenderers()};a.prototype.render=function(a,b){this._updateNearFar();this._visualizer.render(this._camera,a,b)};a.prototype.resetNeedsRender=function(){this._needsRender=!1;this._visualizer.resetNeedsRender()};a.prototype.needsRender=function(){return this._needsRender||this._visualizer.needsRender()};a.prototype._updateNearFar=function(){if(this._frustumCullingEnabled||
0<this._maxFarNearRatio)h[1]=0,this._computeFrustumCullingAndNearFar(this._camera.eye,h),0<this._maxFarNearRatio&&0<h[1]&&(this._camera.far=h[1],this._camera.near=Math.max(h[0],this._camera.far/this._maxFarNearRatio))};a.prototype._computeFrustumCullingAndNearFar=function(a,d){var c=this;k.mat4d.perspective(this._camera.fovY,this._camera.aspect,1,10,p);q.matrixToFrustumPlanes(this._camera.viewMatrix,p,b);this._stats.renderGeometriesTotal=0;this._stats.renderGeometriesVisible=0;var e=-Number.MAX_VALUE,
g=-Number.MAX_VALUE,h=b[0][0],l=b[0][1],m=b[0][2],n=b[0][3],r=b[1][0],t=b[1][1],u=b[1][2],v=b[1][3],w=b[2][0],x=b[2][1],y=b[2][2],z=b[2][3],A=b[3][0],B=b[3][1],C=b[3][2],D=b[3][3],E=b[4][0],F=b[4][1],G=b[4][2];a=b[4][3];var H=b[5][3];this._content.forEach(function(a){c._stats.renderGeometriesTotal++;var b=a.center,d=b[0],f=b[1],b=b[2];a=a.bsRadius;h*d+l*f+m*b+n>a||r*d+t*f+u*b+v>a||w*d+x*f+y*b+z>a||A*d+B*f+C*b+D>a||(f=E*d+F*f+G*b,d=f+a,f=-f+a,d>e&&(e=d),f>g&&(g=f),c._stats.renderGeometriesVisible++)});
var I=e!==-Number.MAX_VALUE,e=e+a,g=g+H;0<this._stats.renderGeometriesVisible&&I&&(d[0]=.99*Math.max(1-e,2),d[1]=1.01*Math.max(10+g,d[0]+1))};return a}()});