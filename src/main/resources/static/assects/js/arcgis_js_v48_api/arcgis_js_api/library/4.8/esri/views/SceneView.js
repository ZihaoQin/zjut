// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/BreakpointsOwner":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper dojo/dom-class ../core/Accessor ../core/ArrayPool ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators ./DOMContainer".split(" "),function(q,h,e,a,d,b,g,c,f,k,n,l){var p={widthBreakpoint:{getValue:function(a){var b=a.viewSize[0];a=a.breakpoints;var c=this.values;return b<=a.xsmall?c.xsmall:b<=a.small?
c.small:b<=a.medium?c.medium:b<=a.large?c.large:c.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",
large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue:function(a){var b=a.viewSize[1];a=a.breakpoints;var c=this.values;return b<=a.xsmall?c.xsmall:b<=a.small?c.small:b<=a.medium?c.medium:
b<=a.large?c.large:c.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",
large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue:function(a){a=a.viewSize;var b=this.values;return a[1]>=a[0]?b.portrait:b.landscape},values:{portrait:"portrait",landscape:"landscape"},
valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},m={xsmall:544,small:768,medium:992,large:1200};return function(g){function l(){var a=null!==g&&g.apply(this,arguments)||this;a._breakpointsHandles=new f;a.breakpoints=m;a.orientation=null;a.widthBreakpoint=null;a.heightBreakpoint=null;return a}e(l,g);l.prototype.initialize=function(){this._breakpointsHandles.add([k.init(this,["breakpoints","size"],this._updateClassNames)])};l.prototype.destroy=
function(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles.destroy(),this._breakpointsHandles=null)};l.prototype._updateClassNames=function(){if(this.container){var a=c.acquire(),b=c.acquire(),v=!1,d,f,g;for(d in p)f=this[d],g=p[d].getValue({viewSize:this.size,breakpoints:this.breakpoints}),f!==g&&(v=!0,this[d]=g,b.push(p[d].valueToClassName[f]),a.push(p[d].valueToClassName[g]));v&&(this._applyClassNameChanges(a,b),c.release(a),c.release(b))}};l.prototype._applyClassNameChanges=
function(a,c){var v=this.container;v&&(b.remove(v,c),b.add(v,a))};l.prototype._removeActiveClassNames=function(){var a=this.container;if(a)for(var c in p)b.remove(a,p[c].valueToClassName[this[c]])};a([n.property({set:function(a){var b=this._get("breakpoints");if(a!==b){b=(b=a)&&b.xsmall<b.small&&b.small<b.medium&&b.medium<b.large;if(!b){var c=JSON.stringify(m,null,2);console.warn("provided breakpoints are not valid, using defaults:"+c)}a=b?a:m;this._set("breakpoints",d({},a))}}})],l.prototype,"breakpoints",
void 0);a([n.property()],l.prototype,"orientation",void 0);a([n.property()],l.prototype,"widthBreakpoint",void 0);a([n.property()],l.prototype,"heightBreakpoint",void 0);return l=a([n.subclass("esri.views.BreakpointsOwner")],l)}(n.declared(g,l))})},"esri/views/DOMContainer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/dom dojo/dom-construct dojo/on ../core/Accessor ../core/Evented ../core/Handles ../core/scheduling ../core/watchUtils ../core/accessorSupport/decorators ./PopupManager ./overlay/ViewOverlay ../widgets/Popup".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t){var u=[0,0];return function(c){function v(){var a=c.call(this)||this;a._domHandles=new k;a._freqInfo={freq:16,time:750};a._overlayRenderTaskHandle=null;a.height=0;a.popup=new t({view:a});a.position=null;a.resizing=!1;a.root=null;a.surface=null;a.suspended=!0;a.ui=null;a.userContent=null;a.width=0;a.watch("cursor",function(b){var c=a.surface;c&&c.setAttribute("data-cursor",b)});a.watch("interacting",function(b){var c=a.surface;c&&c.setAttribute("data-interacting",
b.toString())});a._focusEvent=a._focusEvent.bind(a);a._blurEvent=a._blurEvent.bind(a);return a}e(v,c);v.prototype.initialize=function(){this.watch("ui",this._handleUIChange);this._wireUI(this.ui)};v.prototype.destroy=function(){this.ui.destroy();this.popup&&!this.popup.destroyed&&this.popup.destroy();this.container=null;this._domHandles.destroy()};Object.defineProperty(v.prototype,"container",{set:function(a){var c=this,v=this._get("container");if(v!==a){this._domHandles.remove("dom-size");this._stopMeasuring();
if(v){var f=this.surface;f&&(f.removeEventListener("focus",this._focusEvent),f.removeEventListener("blur",this._blurEvent));v.classList.remove("esri-view");this.popupManager.destroy();this._set("popupManager",null);this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null);this.overlay.destroy();this._set("overlay",null);b.destroy(this.root);this._set("root",null);b.destroy(this.userContent);this._set("userContent",null)}if(a){a.classList.add("esri-view");
v=document.createElement("div");for(v.className="esri-view-user-storage";a.hasChildNodes();)v.appendChild(a.firstChild);a.appendChild(v);v=document.createElement("div");v.className="esri-view-root";a.insertBefore(v,a.firstChild);this._set("root",v);var g=document.createElement("div");g.className="esri-view-surface";g.setAttribute("role","application");g.tabIndex=0;g.addEventListener("focus",this._focusEvent);g.addEventListener("blur",this._blurEvent);d.setSelectable(g,!1);v.appendChild(g);this._set("surface",
g);f=new r;v.appendChild(f.surface);this._set("overlay",f);f.watch("needsRender",function(a){a&&!c._overlayRenderTaskHandle?c._overlayRenderTaskHandle=n.addFrameTask({render:function(){c.overlay.render()}}):c._overlayRenderTaskHandle&&(c._overlayRenderTaskHandle.remove(),c._overlayRenderTaskHandle=null)});this._forceReadyCycle();this._domHandles.add(l.init(this,"size",function(a){var b=a[1];g.classList.toggle("esri-view-surface--inset-outline",a[0]>=document.body.clientWidth||b>=document.body.clientHeight)}),
"dom-size");this._set("container",a);this._startMeasuring();a=new m({enabled:!0,view:this});this._set("popupManager",a)}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}},enumerable:!0,configurable:!0});Object.defineProperty(v.prototype,"focused",{get:function(){return document.activeElement===this.surface},enumerable:!0,configurable:!0});Object.defineProperty(v.prototype,"size",{get:function(){return[this.width,
this.height]},enumerable:!0,configurable:!0});v.prototype.blur=function(){this.surface&&this.surface.blur()};v.prototype.focus=function(){this.surface&&this.surface.focus()};v.prototype.pageToContainer=function(a,b,c){var v=this.position;a-=v[0];b-=v[1];c?(c[0]=a,c[1]=b):c=[a,b];return c};v.prototype.containerToPage=function(a,b,c){var v=this.position;a+=v[0];b+=v[1];c?(c[0]=a,c[1]=b):c=[a,b];return c};v.prototype._handleUIChange=function(a,b){b&&(this._domHandles.remove("ui"),b.destroy());a&&this._wireUI(a);
this._set("ui",a)};v.prototype._wireUI=function(a){this._domHandles.remove("ui");a&&(a.view=this,this._domHandles.add([l.init(this,"root",function(c){a.container=c?b.create("div",null,c):null}),l.init(this,"popup",function(b,c){c&&(a.remove(c,"popup"),c!==b&&c.destroy());b&&(b.view=a.view,a.add(b,{key:"popup",position:"manual"}))})],"ui"))};v.prototype._focusEvent=function(a){this.notifyChange("focused");this.emit("focus",{native:a})};v.prototype._blurEvent=function(a){this.notifyChange("focused");
this.emit("blur",{native:a})};v.prototype._stopMeasuring=function(){this._domHandles.remove("measuring");this._get("resizing")&&this._set("resizing",!1)};v.prototype._startMeasuring=function(){var a=this,b=this._freqInfo;b.freq=16;b.time=750;this._domHandles.add([g(window,"resize",function(){b.freq=16;b.time=750}),n.addFrameTask({prepare:function(b){var c=a._measure(),v=a._freqInfo;v.time+=b.deltaTime;c&&(v.freq=16,a._get("resizing")||a._set("resizing",!0));v.time<v.freq||(v.time=0,a._position()||
c?v.freq=16:v.freq=Math.min(750,2*v.freq),!c&&512<=v.freq&&a._get("resizing")&&a._set("resizing",!1))}})],"measuring");this._measure();this._position()};v.prototype._measure=function(){var a=this.container,b=a?a.clientWidth:0,c=a?a.clientHeight:0;if(0===b||0===c||"hidden"===window.getComputedStyle(a).visibility)return this.suspended||this._set("suspended",!0),!1;var a=this.width,v=this.height;if(b===a&&c===v)return this.suspended&&this._set("suspended",!1),!1;this._set("width",b);this._set("height",
c);this.suspended&&this._set("suspended",!1);this.emit("resize",{oldWidth:a,oldHeight:v,width:b,height:c});return!0};v.prototype._position=function(){var a=this.container,b=this.position,c=(a.ownerDocument||window.document).defaultView,a=a.getBoundingClientRect();u[0]=a.left+c.pageXOffset;u[1]=a.top+c.pageYOffset;return b&&u[0]===b[0]&&u[1]===b[1]?!1:(this._set("position",[u[0],u[1]]),!0)};a([p.property({value:null,cast:function(a){return d.byId(a)}})],v.prototype,"container",null);a([p.property({readOnly:!0,
dependsOn:["surface"]})],v.prototype,"focused",null);a([p.property({readOnly:!0})],v.prototype,"height",void 0);a([p.property({type:t})],v.prototype,"popup",void 0);a([p.property({type:m})],v.prototype,"popupManager",void 0);a([p.property({type:r})],v.prototype,"overlay",void 0);a([p.property({readOnly:!0})],v.prototype,"position",void 0);a([p.property({readOnly:!0})],v.prototype,"resizing",void 0);a([p.property({readOnly:!0})],v.prototype,"root",void 0);a([p.property({value:null,dependsOn:["width",
"height"],readOnly:!0})],v.prototype,"size",null);a([p.property({readOnly:!0})],v.prototype,"surface",void 0);a([p.property({readOnly:!0})],v.prototype,"suspended",void 0);a([p.property()],v.prototype,"ui",void 0);a([p.property({readOnly:!0})],v.prototype,"userContent",void 0);a([p.property({readOnly:!0})],v.prototype,"width",void 0);return v=a([p.subclass("esri.views.DOMContainer")],v)}(p.declared(c,f))})},"esri/views/overlay/ViewOverlay":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/dom ../../core/Accessor ../../core/Collection ../../core/accessorSupport/decorators maquette".split(" "),
function(q,h,e,a,d,b,g,c,f){return function(b){function k(){var a=null!==b&&b.apply(this,arguments)||this;a.items=new g;a._callbacks=new Map;a._projector=f.createProjector();a._hiddenProjector=f.createProjector();return a}e(k,b);Object.defineProperty(k.prototype,"needsRender",{get:function(){return 0<this.items.length},enumerable:!0,configurable:!0});k.prototype.initialize=function(){var a=this,b=document.createElement("div");b.className="esri-overlay-surface";d.setSelectable(b,!1);this._set("surface",
b);this._hiddenSurface=document.createElement("div");this._hiddenSurface.setAttribute("style","visibility: hidden;");b.appendChild(this._hiddenSurface);this._itemsChangeHandle=this.items.on("change",function(b){b.added.map(function(b){var c=function(){return b.render()};a._callbacks.set(b,c);a._projector.append(a.surface,c)});b.removed.map(function(b){var c=a._projector.detach(a._callbacks.get(b));a.surface.removeChild(c.domNode);a._callbacks.delete(b)})})};k.prototype.addItem=function(a){this.items.add(a)};
k.prototype.removeItem=function(a){this.items.remove(a)};k.prototype.destroy=function(){this.items.removeAll();this._itemsChangeHandle.remove();this._projector=this._callbacks=null};k.prototype.render=function(){this._projector.renderNow()};k.prototype.computeBoundingRect=function(a){var b=this._hiddenSurface,c=this._hiddenProjector,d=null,f=function(){return d=a.render()};c.append(b,f);c.renderNow();var g={left:0,top:0,right:0,bottom:0};if(d&&d.domNode){var k=d.domNode.getBoundingClientRect();g.left=
k.left;g.top=k.top;g.right=k.right;g.bottom=k.bottom}for(c.detach(f);b.firstChild;)b.removeChild(b.firstChild);return g};k.prototype.overlaps=function(a,b){a=this.computeBoundingRect(a);b=this.computeBoundingRect(b);return Math.max(a.left,b.left)<=Math.min(a.right,b.right)&&Math.max(a.top,b.top)<=Math.min(a.bottom,b.bottom)};a([c.property({readOnly:!0})],k.prototype,"surface",void 0);a([c.property({readOnly:!0})],k.prototype,"items",void 0);a([c.property({readOnly:!0,dependsOn:["items.length"]})],
k.prototype,"needsRender",null);return k=a([c.subclass("esri.views.overlay.ViewOverlay")],k)}(c.declared(b))})},"esri/widgets/Popup":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper dojo/dom-geometry dojo/i18n!./Popup/nls/Popup dojo/keys ../core/Handles ../core/lang ../core/Logger ../core/watchUtils ../core/accessorSupport/decorators ./Feature ./Spinner ./Widget ./Popup/PopupViewModel ../widgets/support/widgetUtils ./support/widget".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u,x,v){function A(a,b){return void 0===b?"esri-popup__"+a:"esri-popup__"+a+"-"+b}var y=q.toUrl("./Popup/images/default-action.svg"),C={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},B=n.getLogger("esri.widgets.Popup");return function(n){function t(a){a=n.call(this)||this;a._blurContainer=!1;a._containerNode=null;a._mainContainerNode=null;a._featureMenuNode=null;a._focusContainer=!1;a._focusDockButton=!1;a._focusFeatureMenuButton=!1;a._focusFirstFeature=
!1;a._handles=new f;a._displayActionTextLimit=2;a._pointerOffsetInPx=16;a._spinner=null;a.actions=null;a.alignment="auto";a.autoCloseEnabled=null;a.content=null;a.collapsed=!1;a.collapseEnabled=!0;a.dockEnabled=!1;a.featureCount=null;a.features=null;a.featureNavigationEnabled=!0;a.goToOverride=null;a.highlightEnabled=null;a.location=null;a.featureWidgets=[];a.promises=null;a.selectedFeature=null;a.selectedFeatureIndex=null;a.selectedFeatureWidget=null;a.spinnerEnabled=!0;a.title=null;a.updateLocationEnabled=
null;a.view=null;a.viewModel=new u;a.visible=null;return a}e(t,n);t.prototype.postInitialize=function(){var a=this;this._addSelectedFeatureIndexHandle();this.own(l.watch(this,"viewModel.screenLocation",function(){return a._positionContainer()}),l.watch(this,["viewModel.visible","dockEnabled"],function(){return a._toggleScreenLocationEnabled()}),l.watch(this,"viewModel.screenLocation",function(b,c){!!b!==!!c&&a.reposition()}),l.watch(this,"viewModel.features",function(b){return a._createFeatureWidgets(b)}),
l.watch(this,"viewModel.view.padding viewModel.view.size viewModel.visible viewModel.waitingForResult viewModel.location alignment".split(" "),function(){return a.reposition()}),l.watch(this,"spinnerEnabled",function(b){return a._spinnerEnabledChange(b)}),l.watch(this,"viewModel.view.size",function(b,c){return a._updateDockEnabledForViewSize(b,c)}),l.watch(this,"viewModel.view",function(b,c){return a._viewChange(b,c)}),l.watch(this,"viewModel.view.ready",function(b,c){return a._viewReadyChange(b,
c)}),l.watch(this,["viewModel.waitingForResult","viewModel.location"],function(){return a._displaySpinner()}),l.watch(this,["featureWidgets","viewModel.selectedFeatureIndex"],function(){return a._updateFeatureWidget()}),l.watch(this,"selectedFeatureWidget.viewModel.title",function(b){return a._setTitleFromFeatureWidget(b)}),l.watch(this,["selectedFeatureWidget.viewModel.content","selectedFeatureWidget.viewModel.waitingForContent"],function(){return a._setContentFromFeatureWidget()}),l.on(this,"viewModel",
"trigger-action",function(b){return a._zoomToAction(b)}))};t.prototype.destroy=function(){this._destroyFeatureWidgets();this._destroySpinner();this._handles&&this._handles.destroy();this._handles=null};Object.defineProperty(t.prototype,"currentAlignment",{get:function(){return this._getCurrentAlignment()},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"currentDockPosition",{get:function(){return this._getCurrentDockPosition()},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,
"dockOptions",{get:function(){return this._get("dockOptions")||C},set:function(a){var b=d({},C),c=this.get("viewModel.view.breakpoints"),v={};c&&(v.width=c.xsmall,v.height=c.xsmall);a=d({},b,a);b=d({},b.breakpoint,v);v=a.breakpoint;!0===v?a.breakpoint=b:"object"===typeof v&&(a.breakpoint=d({},b,v));this._set("dockOptions",a);this._setCurrentDockPosition();this.reposition()},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"featureMenuOpen",{get:function(){return this.viewModel.visible?
this._get("featureMenuOpen"):!1},set:function(a){this._set("featureMenuOpen",!!a)},enumerable:!0,configurable:!0});t.prototype.blur=function(){this.visible||B.warn("Popup cannot be blurred while visible is false");this._blurContainer=!0;this.scheduleRender()};t.prototype.clear=function(){};t.prototype.close=function(){this.visible=!1};t.prototype.focus=function(){this.visible||B.warn("Popup cannot be focused while visible is false");this._focusContainer=!0;this.scheduleRender()};t.prototype.next=
function(){return null};t.prototype.open=function(a){this._handles.remove("selected-index");this.set({featureMenuOpen:a?!!a.featureMenuOpen:!1});this.viewModel.open(a);this._addSelectedFeatureIndexHandle()};t.prototype.previous=function(){return null};t.prototype.reposition=function(){this.renderNow();this._positionContainer();this._setCurrentAlignment()};t.prototype.triggerAction=function(a){return null};t.prototype.render=function(){var a,b,c,d,f,m,l,n=this.collapsed,e=this.collapseEnabled,p=this.dockEnabled,
u=this.featureMenuOpen,r=this.featureNavigationEnabled,y=this.featureWidgets,t=this.visible,C=this.viewModel,B=C.allActions,h=C.content,D=C.featureCount,E=C.pendingPromisesCount,ea=C.selectedFeatureIndex,fa=C.title,C=1<D&&r,r=1<D&&u,q=e&&!r&&n,n=B&&B.length,da=C&&this._getPageText(D,ea),ba=this._renderContent(),ca=x.isRtl(),ga=this.get("selectedFeatureWidget")?this.get("selectedFeatureWidget.viewModel.waitingForContent")||this.get("selectedFeatureWidget.viewModel.content"):ba,ja=p?g.undock:g.dock,
D=this.currentAlignment,B=this.currentDockPosition,E=E?v.tsx("div",{key:A("loading-container"),role:"presentation",class:"esri-popup__loading-container","aria-label":g.loading,title:g.loading},v.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon","esri-icon-loading-indicator","esri-rotating")})):null,ha=(a={},a["esri-icon-layer-list"]=!r,a["esri-icon-close"]=r,a);a=v.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon",ha)});ha=(b={},b["esri-icon-right-triangle-arrow"]=
ca,b["esri-popup__pagination-previous-icon--rtl"]=ca,b["esri-icon-left-triangle-arrow"]=!ca,b["esri-popup__pagination-previous-icon"]=!ca,b);b=v.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon",ha)});ha=v.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes("esri-popup__button","esri-popup__pagination-previous"),"aria-label":g.previous,title:g.previous},b);b=(c={},c["esri-icon-left-triangle-arrow"]=ca,c["esri-popup__pagination-next-icon--rtl"]=
ca,c["esri-icon-right-triangle-arrow"]=!ca,c["esri-popup__pagination-next-icon"]=!ca,c);c=v.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon",b)});ca=v.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes("esri-popup__button","esri-popup__pagination-next"),"aria-label":g.next,title:g.next},c);b=x.cssTransition("enter","esri-popup--feature-updated");c=this.id+"-feature-menu";u=v.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,
onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes("esri-popup__button","esri-popup__feature-menu-button"),"aria-haspopup":"true","aria-controls":c,"aria-expanded":u,"aria-label":g.menu,title:g.menu},a);da=v.tsx("div",{class:"esri-popup__pagination-page-text"},da);u=C?v.tsx("div",{class:"esri-popup__navigation-buttons",enterAnimation:b},ha,da,ca,E||u):null;da=this._wouldDockTo();da=(d={},d["esri-icon-minimize"]=
p,d["esri-popup__icon--dock-icon"]=!p,d["esri-icon-dock-right"]=!p&&("top-right"===da||"bottom-right"===da),d["esri-icon-dock-left"]=!p&&("top-left"===da||"bottom-left"===da),d["esri-icon-maximize"]=!p&&"top-center"===da,d["esri-icon-dock-bottom"]=!p&&"bottom-center"===da,d);d=v.tsx("span",{"aria-hidden":"true",class:this.classes(da,"esri-popup__icon")});d=this.get("dockOptions.buttonEnabled")?v.tsx("div",{role:"button","aria-label":ja,title:ja,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,
onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes("esri-popup__button","esri-popup__button--dock")},d):null;e=e&&fa&&(ga||n||C);ja=(f={},f["esri-popup__header-title--button"]=e,f);da=e?"button":"heading";E=e?q?g.expand:g.collapse:"";f=this.id+"-popup-title";fa=fa?v.tsx("h2",{class:this.classes("esri-popup__header-title",ja),key:fa,enterAnimation:b,id:f,role:da,"aria-label":E,title:E,bind:this,tabIndex:e?0:-1,onclick:this._toggleCollapsed,
onkeydown:this._toggleCollapsed,innerHTML:fa}):null;e=v.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon","esri-icon-close")});e=v.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:"esri-popup__button","aria-label":g.close,title:g.close},e);e=v.tsx("header",{class:"esri-popup__header"},fa,v.tsx("div",{class:"esri-popup__header-buttons"},d,e));d=this.id+"-popup-content";h=ga&&!q?v.tsx("article",{key:h,enterAnimation:b,id:d,class:"esri-popup__content"},
ba):null;ba=!q&&("bottom-left"===D||"bottom-center"===D||"bottom-right"===D||"top-left"===B||"top-center"===B||"top-right"===B);q=!q&&("top-left"===D||"top-center"===D||"top-right"===D||"bottom-left"===B||"bottom-center"===B||"bottom-right"===B);ga=r?null:v.tsx("div",{key:A("actions"),class:"esri-popup__actions"},this._renderActions());b=v.tsx("section",{key:A("navigation"),class:"esri-popup__navigation"},u);C=C||n?v.tsx("div",{key:A("feature-buttons"),class:"esri-popup__feature-buttons"},ga,b):null;
ea=this._renderFeatureMenuNode(y,ea,r,c);y=k.substitute({total:y.length},g.selectedFeatures);c=v.tsx("section",{key:A("menu"),class:"esri-popup__feature-menu"},v.tsx("h2",{class:"esri-popup__feature-menu-header"},y),v.tsx("nav",{class:"esri-popup__feature-menu-viewport",afterCreate:this._featureMenuViewportNodeUpdated,afterUpdate:this._featureMenuViewportNodeUpdated},ea));y=p?null:v.tsx("div",{key:A("pointer"),class:"esri-popup__pointer",role:"presentation"},v.tsx("div",{class:this.classes("esri-popup__pointer-direction",
"esri-popup--shadow")}));ea=this.get("selectedFeature.layer.title");n=this.get("selectedFeature.layer.id");ga=(m={},m["esri-popup--shadow"]=p,m);m=(l={},l["esri-popup--aligned-top-center"]=t&&"top-center"===D,l["esri-popup--aligned-bottom-center"]=t&&"bottom-center"===D,l["esri-popup--aligned-top-left"]=t&&"top-left"===D,l["esri-popup--aligned-bottom-left"]=t&&"bottom-left"===D,l["esri-popup--aligned-top-right"]=t&&"top-right"===D,l["esri-popup--aligned-bottom-right"]="bottom-right"===D,l["esri-popup--is-docked"]=
t&&p,l["esri-popup--shadow"]=t&&!p,l["esri-popup--is-docked-top-left"]=t&&"top-left"===B,l["esri-popup--is-docked-top-center"]=t&&"top-center"===B,l["esri-popup--is-docked-top-right"]=t&&"top-right"===B,l["esri-popup--is-docked-bottom-left"]=t&&"bottom-left"===B,l["esri-popup--is-docked-bottom-center"]=t&&"bottom-center"===B,l["esri-popup--is-docked-bottom-right"]=t&&"bottom-right"===B,l["esri-popup--feature-menu-open"]=t&&r,l);l=ba?c:null;p=q?c:null;r=ba?C:null;D=q?C:null;l=v.tsx("div",{class:this.classes("esri-popup__main-container",
"esri-widget",ga),tabIndex:-1,role:"dialog","aria-labelledby":fa?f:"","aria-describedby":h?d:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},r,l,e,h,D,p);return v.tsx("div",{key:A("base"),class:this.classes("esri-popup",m),role:"presentation","data-layer-title":ea,"data-layer-id":n,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},t?[l,y]:null)};t.prototype._featureMenuOpenChanged=function(a){a?
this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0};t.prototype._setTitleFromFeatureWidget=function(a){this.selectedFeatureWidget&&(this.viewModel.title=a||"")};t.prototype._setContentFromFeatureWidget=function(){var a=this.selectedFeatureWidget;a&&(this.viewModel.content=a)};t.prototype._handleFeatureMenuKeyup=function(a){a.keyCode===c.ESCAPE&&(a.stopPropagation(),this.featureMenuOpen=!1)};t.prototype._handleFeatureMenuItemKeyup=function(a){var b=a.keyCode,v=this._featureMenuNode,d=this.get("features.length"),
f=a.currentTarget["data-feature-index"];v&&(v=v.querySelectorAll("li"),b===c.UP_ARROW?(a.stopPropagation(),v[(f-1+d)%d].focus()):b===c.DOWN_ARROW?(a.stopPropagation(),v[(f+1+d)%d].focus()):b===c.HOME?(a.stopPropagation(),v[0].focus()):b===c.END&&(a.stopPropagation(),v[v.length-1].focus()))};t.prototype._handleMainKeyup=function(a){var b=a.keyCode;b===c.LEFT_ARROW&&(a.stopPropagation(),this.previous());b===c.RIGHT_ARROW&&(a.stopPropagation(),this.next())};t.prototype._zoomToAction=function(a){a.action&&
!a.action.disabled&&"zoom-to"===a.action.id&&this.viewModel.zoomToLocation()};t.prototype._spinnerEnabledChange=function(a){this._destroySpinner();a&&(a=this.get("viewModel.view"),this._createSpinner(a))};t.prototype._displaySpinner=function(){var a=this._spinner;if(a){var b=this.viewModel,c=b.location;b.waitingForResult?a.show({location:c}):a.hide()}};t.prototype._getIconStyles=function(a){return{"background-image":a?"url("+a+")":""}};t.prototype._renderAction=function(a,b,c,d){var f=this,m,n,A=
l.watch(a,"active className disabled id title image visible".split(" "),function(){return f.scheduleRender()});this._handles.add(A,d);A=this.get("selectedFeature.attributes");"zoom-to"===a.id&&(a.title=g.zoom,a.className="esri-icon-zoom-in-magnifying-glass");d=a.title;var e=a.className,p=a.image||e?a.image:y;d=d&&A?k.substitute(A,d):d;e=e&&A?k.substitute(A,e):e;A=p&&A?k.substitute(A,p):p;p=(m={},m["esri-icon-loading-indicator"]=a.active,m["esri-rotating"]=a.active,m["esri-popup__action-image"]=!a.active&&
!!A,m);e&&(p[e]=!a.active);m=(n={},n["esri-popup__action"]="toggle"!==a.type,n["esri-popup__action-toggle"]="toggle"===a.type,n["esri-popup__action-toggle--on"]="toggle"===a.type&&a.value,n["esri-popup__button--disabled"]=a.disabled,n);c=c<=this._displayActionTextLimit?v.tsx("span",{key:"text",class:"esri-popup__action-text"},d):null;return a.visible?v.tsx("div",{key:a,role:"button",tabIndex:0,title:d,"aria-label":d,class:this.classes("esri-popup__button",m),bind:this,"data-action-index":b,onclick:this._triggerAction,
onkeydown:this._triggerAction},v.tsx("span",{key:"icon","aria-hidden":"true",class:this.classes("esri-popup__icon",p),styles:this._getIconStyles(A)}),c):null};t.prototype._renderActions=function(){var a=this;this._handles.remove("actions");var b=this.viewModel.allActions;if(b){var c=b.length;return b.map(function(b,v){return a._renderAction(b,v,c,"actions")}).toArray()}};t.prototype._addSelectedFeatureIndexHandle=function(){var a=this,b=l.watch(this,"viewModel.selectedFeatureIndex",function(b,c){return a._selectedFeatureIndexUpdated(b,
c)});this._handles.add(b,"selected-index")};t.prototype._selectedFeatureIndexUpdated=function(a,b){var c=this.featureMenuOpen;this.featureCount&&c&&a!==b&&-1!==a&&(this.featureMenuOpen=!1)};t.prototype._updateFeatureWidget=function(){var a=this.featureWidgets[this.viewModel.selectedFeatureIndex]||null;a&&!a.contentEnabled&&(a.contentEnabled=!0);this._set("selectedFeatureWidget",a)};t.prototype._destroyFeatureWidgets=function(){this.featureWidgets.forEach(function(a){return a.destroy()});this._set("featureWidgets",
[])};t.prototype._createFeatureWidgets=function(a){var b=this.featureWidgets.slice(0),c=this.get("viewModel.view"),v=[];a.forEach(function(a,d){if(a){var f=null;b.some(function(c,v){c&&c.graphic===a&&(f=c,b.splice(v,1));return!!f});v[d]=f||new m({contentEnabled:!1,graphic:a,view:c})}});b.forEach(function(a){return a&&a.destroy()});this._set("featureWidgets",v)};t.prototype._isScreenLocationWithinView=function(a,b){return-1<a.x&&-1<a.y&&a.x<=b.width&&a.y<=b.height};t.prototype._isOutsideView=function(a){var b=
a.popupHeight,c=a.popupWidth,v=a.screenLocation,d=a.side;a=a.view;if(isNaN(c)||isNaN(b)||!a||!v)return!1;var f=a.padding;return"right"===d&&v.x+c/2>a.width-f.right||"left"===d&&v.x-c/2<f.left||"top"===d&&v.y-b<f.top||"bottom"===d&&v.y+b>a.height-f.bottom?!0:!1};t.prototype._determineCurrentAlignment=function(){var a=this._pointerOffsetInPx,c=this._containerNode,v=this._mainContainerNode,d=this.viewModel,f=d.screenLocation,d=d.view;if(!f||!d||!c)return"top-center";if(!this._isScreenLocationWithinView(f,
d))return this._get("currentAlignment")||"top-center";var g=v?window.getComputedStyle(v,null):null,v=g?parseInt(g.getPropertyValue("max-height").replace(/[^-\d\.]/g,""),10):0,g=g?parseInt(g.getPropertyValue("height").replace(/[^-\d\.]/g,""),10):0,m=b.getContentBox(c),c=m.w+a,m=Math.max(m.h,v,g)+a,a=this._isOutsideView({popupHeight:m,popupWidth:c,screenLocation:f,side:"right",view:d}),v=this._isOutsideView({popupHeight:m,popupWidth:c,screenLocation:f,side:"left",view:d}),g=this._isOutsideView({popupHeight:m,
popupWidth:c,screenLocation:f,side:"top",view:d}),f=this._isOutsideView({popupHeight:m,popupWidth:c,screenLocation:f,side:"bottom",view:d});return v?g?"bottom-right":"top-right":a?g?"bottom-left":"top-left":g?f?"top-center":"bottom-center":"top-center"};t.prototype._getCurrentAlignment=function(){var a=this.alignment;return this.dockEnabled?null:"auto"===a?this._determineCurrentAlignment():"function"===typeof a?a.call(this):a};t.prototype._setCurrentAlignment=function(){this._set("currentAlignment",
this._getCurrentAlignment())};t.prototype._setCurrentDockPosition=function(){this._set("currentDockPosition",this._getCurrentDockPosition())};t.prototype._getDockPosition=function(){var a=this.get("dockOptions.position");return"auto"===a?this._determineCurrentDockPosition():"function"===typeof a?a.call(this):a};t.prototype._getCurrentDockPosition=function(){return this.dockEnabled?this._getDockPosition():null};t.prototype._wouldDockTo=function(){return this.dockEnabled?null:this._getDockPosition()};
t.prototype._renderFeatureMenuItemNode=function(a,b,c,d){var f,m=b===c;d=(f={},f["esri-popup__feature-menu-item--selected"]=m,f);f=m?v.tsx("span",{key:A("feature-menu-selected-feature-"+c),title:g.selectedFeature,"aria-label":g.selectedFeature,class:"esri-icon-check-mark"}):null;a=v.tsx("span",{innerHTML:a.title||g.untitled});return v.tsx("li",{role:"menuitem",tabIndex:-1,key:A("feature-menu-feature-"+c),class:this.classes(d,"esri-popup__feature-menu-item"),bind:this,"data-feature-index":b,onkeyup:this._handleFeatureMenuItemKeyup,
onclick:this._selectFeature,onkeydown:this._selectFeature},v.tsx("span",{class:"esri-popup__feature-menu-title"},a,f))};t.prototype._renderFeatureMenuNode=function(a,b,c,d){var f=this;return 1<a.length?v.tsx("ol",{class:"esri-popup__feature-menu-list",id:d,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},a.map(function(a,v){return f._renderFeatureMenuItemNode(a,v,b,c)})):null};t.prototype._determineCurrentDockPosition=
function(){var a=this.get("viewModel.view"),b=x.isRtl()?"top-left":"top-right";if(!a)return b;var c=a.padding||{left:0,right:0,top:0,bottom:0},c=a.width-c.left-c.right;return(a=a.get("breakpoints"))&&c<=a.xsmall?"bottom-center":b};t.prototype._renderContent=function(){var a=this.get("viewModel.content");if("string"===typeof a)return v.tsx("div",{key:a,innerHTML:a});if(v.isWidget(a))return v.tsx("div",{key:a},a.render());if(a instanceof HTMLElement)return v.tsx("div",{key:a,bind:a,afterCreate:this._attachToNode});
if(v.isWidgetBase(a))return v.tsx("div",{key:a,bind:a.domNode,afterCreate:this._attachToNode})};t.prototype._attachToNode=function(a){a.appendChild(this)};t.prototype._positionContainer=function(a){void 0===a&&(a=this._containerNode);a&&(this._containerNode=a);if(a){var c=this.viewModel.screenLocation,v=b.getContentBox(a);if(c=this._calculatePositionStyle(c,v))a.style.top=c.top,a.style.left=c.left,a.style.bottom=c.bottom,a.style.right=c.right}};t.prototype._calculateFullWidth=function(a){var b=this.currentAlignment,
c=this._pointerOffsetInPx;return"top-left"===b||"bottom-left"===b||"top-right"===b||"bottom-right"===b?a+c:a};t.prototype._calculateAlignmentPosition=function(a,b,c,v){var d=this.currentAlignment,f=this._pointerOffsetInPx;v/=2;var g=c.height-b;c=c.width-a;var m=this.view.padding;if("bottom-center"===d)return{top:b+f-m.top,left:a-v-m.left};if("top-left"===d)return{bottom:g+f-m.bottom,right:c+f-m.right};if("bottom-left"===d)return{top:b+f-m.top,right:c+f-m.right};if("top-right"===d)return{bottom:g+
f-m.bottom,left:a+f-m.left};if("bottom-right"===d)return{top:b+f-m.top,left:a+f-m.left};if("top-center"===d)return{bottom:g+f-m.bottom,left:a-v-m.left}};t.prototype._calculatePositionStyle=function(a,b){var c=this.view;if(c){if(this.dockEnabled)return{left:"",top:"",right:"",bottom:""};if(a&&b&&(b=this._calculateFullWidth(b.w),a=this._calculateAlignmentPosition(a.x,a.y,c,b)))return{top:void 0!==a.top?a.top+"px":"auto",left:void 0!==a.left?a.left+"px":"auto",bottom:void 0!==a.bottom?a.bottom+"px":
"auto",right:void 0!==a.right?a.right+"px":"auto"}}};t.prototype._viewChange=function(a,b){a&&b&&(this.close(),this.clear())};t.prototype._viewReadyChange=function(a,b){a?(a=this.get("viewModel.view"),this._wireUpView(a)):b&&(this.close(),this.clear())};t.prototype._wireUpView=function(a){this._destroySpinner();a&&(this.spinnerEnabled&&this._createSpinner(a),this._setDockEnabledForViewSize(this.dockOptions))};t.prototype._dockingThresholdCrossed=function(a,b,c){var v=a[0];a=a[1];var d=b[0];b=b[1];
var f=c.width;c=c.height;return v<=f&&d>f||v>f&&d<=f||a<=c&&b>c||a>c&&b<=c};t.prototype._updateDockEnabledForViewSize=function(a,b){if(a&&b){var c=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},v=c.left+c.right,d=c.top+c.bottom,c=[],f=[];c[0]=a[0]-v;c[1]=a[1]-d;f[0]=b[0]-v;f[1]=b[1]-d;a=this.dockOptions;this._dockingThresholdCrossed(c,f,a.breakpoint)&&this._setDockEnabledForViewSize(a);this._setCurrentDockPosition()}};t.prototype._focusDockButtonNode=function(a){this._focusDockButton&&
(this._focusDockButton=!1,a.focus())};t.prototype._mainContainerNodeUpdated=function(a){this._mainContainerNode=a;this._focusContainer?(this._focusContainer=!1,a.focus()):this._blurContainer&&(this._blurContainer=!1,a.blur())};t.prototype._featureMenuNodeUpdated=function(a){(this._featureMenuNode=a)&&this._focusFirstFeature&&(this._focusFirstFeature=!1,a=a.querySelectorAll("li"),a.length&&a[0].focus())};t.prototype._focusFeatureMenuButtonNode=function(a){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=
!1,a.focus())};t.prototype._featureMenuViewportNodeUpdated=function(a){a&&(a.scrollTop=0)};t.prototype._toggleScreenLocationEnabled=function(){var a=this.dockEnabled,b=this.viewModel;b&&(b.screenLocationEnabled=this.visible&&!a)};t.prototype._shouldDockAtCurrentViewSize=function(a){a=a.breakpoint;var b=this.get("viewModel.view.ui"),c=b.width,b=b.height;if(isNaN(c)||isNaN(b))return!1;c=a.hasOwnProperty("width")&&c<=a.width;a=a.hasOwnProperty("height")&&b<=a.height;return c||a};t.prototype._setDockEnabledForViewSize=
function(a){a.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(a))};t.prototype._getPageText=function(a,b){return k.substitute({index:b+1,total:a},g.pageText)};t.prototype._destroySpinner=function(){var a=this._spinner,b=this.view;a&&(b&&b.ui.remove(this._spinner,"popup-spinner"),a.destroy(),this._spinner=null)};t.prototype._createSpinner=function(a){a&&(this._spinner=new r({view:a}),a.ui.add(this._spinner,{key:"popup-spinner",position:"manual"}))};t.prototype._toggleCollapsed=function(){this.collapsed=
!this.collapsed};t.prototype._close=function(){this.close();this.view&&this.view.focus()};t.prototype._toggleDockEnabled=function(){this.dockEnabled=!this.dockEnabled;this._focusDockButton=!0;this.scheduleRender()};t.prototype._toggleFeatureMenu=function(){var a=!this.featureMenuOpen;this._featureMenuOpenChanged(a);this.featureMenuOpen=a};t.prototype._triggerAction=function(a){a=a.currentTarget["data-action-index"];var b=this.viewModel.allActions.getItemAt(a);b&&"toggle"===b.type&&(b.value=!b.value);
this.viewModel.triggerAction(a)};t.prototype._selectFeature=function(a){a=a.currentTarget["data-feature-index"];isNaN(a)||(this.viewModel.selectedFeatureIndex=a)};t.prototype._next=function(){this.next()};t.prototype._previous=function(){this.previous()};a([p.aliasOf("viewModel.actions"),v.renderable()],t.prototype,"actions",void 0);a([p.property()],t.prototype,"alignment",void 0);a([p.aliasOf("viewModel.autoCloseEnabled")],t.prototype,"autoCloseEnabled",void 0);a([p.aliasOf("viewModel.content"),
v.renderable()],t.prototype,"content",void 0);a([p.property(),v.renderable()],t.prototype,"collapsed",void 0);a([p.property(),v.renderable()],t.prototype,"collapseEnabled",void 0);a([p.property({readOnly:!0,dependsOn:["dockEnabled","alignment"]}),v.renderable()],t.prototype,"currentAlignment",null);a([p.property({readOnly:!0,dependsOn:["viewModel.view.ready","dockEnabled","dockOptions"]}),v.renderable()],t.prototype,"currentDockPosition",null);a([p.property(),v.renderable()],t.prototype,"dockOptions",
null);a([p.property(),v.renderable()],t.prototype,"dockEnabled",void 0);a([p.aliasOf("viewModel.featureCount"),v.renderable()],t.prototype,"featureCount",void 0);a([p.property({dependsOn:["viewModel.visible"]}),v.renderable()],t.prototype,"featureMenuOpen",null);a([p.aliasOf("viewModel.features"),v.renderable()],t.prototype,"features",void 0);a([p.property(),v.renderable()],t.prototype,"featureNavigationEnabled",void 0);a([p.aliasOf("viewModel.goToOverride")],t.prototype,"goToOverride",void 0);a([p.aliasOf("viewModel.highlightEnabled")],
t.prototype,"highlightEnabled",void 0);a([p.aliasOf("viewModel.location"),v.renderable()],t.prototype,"location",void 0);a([p.property({readOnly:!0}),v.renderable()],t.prototype,"featureWidgets",void 0);a([p.aliasOf("viewModel.promises")],t.prototype,"promises",void 0);a([p.aliasOf("viewModel.selectedFeature"),v.renderable()],t.prototype,"selectedFeature",void 0);a([p.aliasOf("viewModel.selectedFeatureIndex"),v.renderable()],t.prototype,"selectedFeatureIndex",void 0);a([p.property({readOnly:!0}),
v.renderable()],t.prototype,"selectedFeatureWidget",void 0);a([p.property()],t.prototype,"spinnerEnabled",void 0);a([p.aliasOf("viewModel.title"),v.renderable()],t.prototype,"title",void 0);a([p.aliasOf("viewModel.updateLocationEnabled")],t.prototype,"updateLocationEnabled",void 0);a([p.aliasOf("viewModel.view")],t.prototype,"view",void 0);a([p.property({type:u}),v.renderable("viewModel.allActions viewModel.screenLocation viewModel.screenLocationEnabled viewModel.state viewModel.pendingPromisesCount viewModel.promiseCount viewModel.waitingForResult".split(" ")),
v.vmEvent(["triggerAction","trigger-action"])],t.prototype,"viewModel",void 0);a([p.aliasOf("viewModel.visible"),v.renderable()],t.prototype,"visible",void 0);a([p.aliasOf("viewModel.clear")],t.prototype,"clear",null);a([p.aliasOf("viewModel.next")],t.prototype,"next",null);a([p.aliasOf("viewModel.previous")],t.prototype,"previous",null);a([p.aliasOf("viewModel.triggerAction")],t.prototype,"triggerAction",null);a([v.accessibleHandler()],t.prototype,"_toggleCollapsed",null);a([v.accessibleHandler()],
t.prototype,"_close",null);a([v.accessibleHandler()],t.prototype,"_toggleDockEnabled",null);a([v.accessibleHandler()],t.prototype,"_toggleFeatureMenu",null);a([v.accessibleHandler()],t.prototype,"_triggerAction",null);a([v.accessibleHandler()],t.prototype,"_selectFeature",null);a([v.accessibleHandler()],t.prototype,"_next",null);a([v.accessibleHandler()],t.prototype,"_previous",null);return t=a([p.subclass("esri.widgets.Popup")],t)}(p.declared(t))})},"esri/widgets/Feature":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Feature/nls/Feature dojo/keys ../core/promiseUtils ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./Feature/FeatureViewModel ./Feature/support/attachmentUtils ./support/uriUtils ./support/widget".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m){function r(a,b){return void 0===b?"esri-feature__"+a:"esri-feature__"+a+"-"+b}return function(k){function u(a){a=k.call(this)||this;a._chartMap=new Map;a._activeMediaMap=new Map;a._chartRequirePromise=null;a._refreshTimers=new Map;a._mediaInfo=new Map;a.contentEnabled=null;a.graphic=null;a.title=null;a.view=null;a.viewModel=new n;return a}e(u,k);u.prototype.postInitialize=function(){var a=this;this.own(c.init(this,"viewModel.content",function(){return a._setupMediaRefreshTimers()}))};
u.prototype.destroy=function(){this._clearMediaRefreshTimers();this._activeMediaMap.clear();this._activeMediaMap=null;this._cancelChartModules();this._destroyCharts()};u.prototype.render=function(){var a=m.tsx("div",{key:r("loading-container"),class:"esri-feature__loading-container"},m.tsx("span",{class:this.classes("esri-icon-loading-indicator esri-rotating","esri-feature__loading-spinner")})),a=this.viewModel.waitingForContent?a:this._renderContent();return m.tsx("div",{class:"esri-feature"},m.tsx("div",
{class:"esri-feature__size-container"},m.tsx("div",{class:"esri-feature__main-container"},a)))};u.prototype.goToMedia=function(a,b){this._setContentElementMedia(a,b)};u.prototype.nextMedia=function(a){this._pageContentElementMedia(a,"next")};u.prototype.previousMedia=function(a){this._pageContentElementMedia(a,"previous")};u.prototype._cancelChartModules=function(){var a=this._chartRequirePromise;a&&a.cancel();this._chartRequirePromise=null};u.prototype._destroyChart=function(a){var b=this._chartMap.get(a);
b&&(b.chart.destroy(),b.tooltip.destroy());this._chartMap.delete(a)};u.prototype._destroyCharts=function(){this._chartMap.forEach(function(a){a.chart.destroy();a.tooltip.destroy()});this._chartMap.clear()};u.prototype._renderContent=function(){this._destroyCharts();var a=this.viewModel.content;if("string"===typeof a)return m.tsx("div",{key:r("content-string"),innerHTML:a});if(m.isWidget(a))return m.tsx("div",{key:r("content-widget")},a.render());if(a instanceof HTMLElement)return m.tsx("div",{key:r("content-html-element"),
bind:a,afterCreate:this._attachToNode});if(m.isWidgetBase(a))return m.tsx("div",{key:r("content-dijit"),bind:a.domNode,afterCreate:this._attachToNode});if(Array.isArray(a))return a.length?m.tsx("div",{key:r("content-content-elements")},a.map(this._renderContentElement,this)):null};u.prototype._renderContentElement=function(a,b){switch(a.type){case "attachments":return this._renderAttachments(a,b);case "fields":return this._renderFields(a,b);case "media":return this._renderMedia(a,b);case "text":return this._renderText(a,
b);default:return null}};u.prototype._renderAttachmentInfo=function(a){var b,c,f=a.attachmentInfo,g=a.supportsResizeAttachments,k=f.contentType;a=f.name;var n=f.url,e=g&&l.isSupportedImage(k),p=-1===n.indexOf("?")?"?":"\x26",k=e?""+n+p+"w\x3d48":l.getIconPath(k),e=(b={},b["esri-feature__attachment-item-mask--icon"]=!e,b);b=(c={},c["esri-feature__attachments-image--resizable"]=g,c);return m.tsx("li",{class:"esri-feature__attachments-item",key:f},m.tsx("a",{class:"esri-feature__attachments-item-link",
href:n,target:"_blank"},m.tsx("div",{class:this.classes(e,"esri-feature__attachment-item-mask")},m.tsx("img",{alt:a,class:this.classes(b,"esri-feature__attachments-image"),title:a,src:k}),m.tsx("span",{class:"esri-feature__attachments-image-overlay"},m.tsx("span",{"aria-hidden":"true",class:"esri-feature__attachments-link-icon esri-icon-link-external"}))),m.tsx("span",{class:"esri-feature__attachments-filename"},a||d.noTitle)))};u.prototype._renderAttachments=function(a,b){var c=this,v,f=a.displayType,
g=(b=a.attachmentInfos)&&b.length,k=this.get("graphic.layer.capabilities.operations.supportsResizeAttachments"),f=(v={},v["esri-feature__attachments--list"]="preview"!==f,v["esri-feature__attachments--preview"]="preview"===f,v);return g?m.tsx("div",{key:r("attachments-element"),class:this.classes("esri-feature__attachments","esri-feature__content-element",f)},m.tsx("div",{class:"esri-feature__attachments-title"},d.attach),m.tsx("ul",{class:"esri-feature__attachments-items"},b.map(function(b,v){return c._renderAttachmentInfo({attachmentInfo:b,
attachmentInfoIndex:v,supportsResizeAttachments:k,contentElement:a})}))):null};u.prototype._forceLTR=function(a){return"\x26lrm;"+a};u.prototype._renderFieldInfo=function(a,b){var c,v=this.viewModel.formattedAttributes,d=v?v.content[b]||v.global:null,f=a.fieldName,v=a.label||f,d=d?null==d[f]?"":d[f]:"";a=!(!a.format||!a.format.dateFormat);d="number"!==typeof d||a?p.autoLink(d):this._forceLTR(d);a=(c={},c["esri-feature__field-data--date"]=a,c);return m.tsx("tr",{key:r("fields-element-info-row",b)},
m.tsx("th",{key:r("fields-element-info-row-header",b),class:"esri-feature__field-header",innerHTML:v}),m.tsx("td",{key:r("fields-element-info-row-data",b),class:this.classes("esri-feature__field-data",a),innerHTML:d}))};u.prototype._renderFields=function(a,b){var c=this;return(a=a.fieldInfos)?m.tsx("div",{key:r("fields-element",b),class:this.classes("esri-feature__fields","esri-feature__content-element")},m.tsx("table",{class:"esri-widget__table",summary:d.fieldsSummary,key:r("fields-element-table",
b)},m.tsx("tbody",{key:r("fields-element-table-body",b)},a.map(function(a){return c._renderFieldInfo(a,b)})))):null};u.prototype._shouldOpenInNewTab=function(a){void 0===a&&(a="");return!/^(?:mailto:|tel:)/.test(a.trim().toLowerCase())};u.prototype._clearMediaRefreshTimers=function(){this._refreshTimers.forEach(function(a){return clearTimeout(a)});this._refreshTimers.clear()};u.prototype._clearMediaRefreshTimer=function(a){var b=this._refreshTimers.get(a);b&&(clearTimeout(b),this._refreshTimers.delete(a))};
u.prototype._getImageSource=function(a,b){var c=-1!==a.indexOf("?")?"\x26":"?";a=a.split("#");var v=a[1],v=void 0===v?"":v;return""+a[0]+c+"timestamp\x3d"+b+(v?"#":"")+v};u.prototype._setupMediaRefreshTimer=function(a){var b=this.get("viewModel.content");if(Array.isArray(b)&&(b=b[a])&&"media"===b.type){var c=this._activeMediaMap.get(a);isNaN(c)&&(c=0);(b=b.mediaInfos[c])&&"image"===b.type&&b.refreshInterval&&this._setRefreshTimeout(a,b)}};u.prototype._setupMediaRefreshTimers=function(){var a=this;
this._clearMediaRefreshTimers();var b=this.get("viewModel.content");Array.isArray(b)&&b.forEach(function(b,c){return a._setupMediaRefreshTimer(c)})};u.prototype._updateMediaInfoTimestamp=function(a,b){var c=Date.now();this._mediaInfo.set(b,{timestamp:c,sourceURL:this._getImageSource(a,c)});this.scheduleRender()};u.prototype._setRefreshTimeout=function(a,b){var c=this,d=b.refreshInterval,v=b.value;d&&(b=6E4*d,this._updateMediaInfoTimestamp(v.sourceURL,a),b=setInterval(function(){c._updateMediaInfoTimestamp(v.sourceURL,
a)},b),this._refreshTimers.set(a,b))};u.prototype._renderMediaInfoType=function(a,b){var c=a.value,d=a.title,d=void 0===d?"":d,f=a.type,v=a.refreshInterval,g=c.sourceURL,c=c.linkURL;if("image"===f)return a=this._shouldOpenInNewTab(c)?"_self":"_blank",g=(v=v?this._mediaInfo.get(b):null)?v.sourceURL:g,b=m.tsx("img",{alt:d,key:r("media-image-"+(v?v.timestamp:0),b),src:g}),(d=c?m.tsx("a",{title:d,href:c,target:a},b):null)?d:b;if(-1!==f.indexOf("chart"))return m.tsx("div",{key:r("chart",b),bind:this,"data-media-info":a,
"data-content-element-index":b,class:"esri-feature__media-chart",afterCreate:this._getChartDependencies,afterUpdate:this._getChartDependencies})};u.prototype._getChartDependencies=function(a){var b=this,c=a["data-media-info"],d=a["data-content-element-index"],f=c.value,m=f.theme||"Claro",k=c.type,l=m;"string"===typeof m&&(l=m.replace(/\./g,"/"));this._cancelChartModules();this._chartRequirePromise=g.create(function(a){return q(["dojox/charting/Chart2D","dojox/charting/action2d/Tooltip","dojox/charting/themes/"+
l],function(){for(var b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];return a(b)})}).then(function(c){b._renderChart(a,d,k,f,c[0],c[1],c[2]);b._chartRequirePromise=null})};u.prototype._renderChart=function(a,b,c,d,f,g,m){a=new f(a,{margins:{l:4,t:4,r:4,b:4}});m&&a.setTheme(m);switch(c){case "pie-chart":a.addPlot("default",{type:"Pie",labels:!1});a.addSeries("Series A",d.chartOptions);break;case "line-chart":a.addPlot("default",{type:"Markers"});a.addAxis("x",{min:0,majorTicks:!1,minorTicks:!1,
majorLabels:!1,minorLabels:!1});a.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});d.chartOptions.forEach(function(a,b){a.x=b+1});a.addSeries("Series A",d.chartOptions);break;case "column-chart":a.addPlot("default",{type:"Columns",gap:3});a.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});a.addSeries("Series A",d.chartOptions);break;case "bar-chart":a.addPlot("default",{type:"Bars",gap:3}),a.addAxis("x",{includeZero:!0,fixUpper:"minor",minorLabels:!1}),a.addAxis("y",{vertical:!0,
majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1}),a.addSeries("Series A",d.chartOptions)}c=new g(a);a.render();this._chartMap.set(b,{chart:a,tooltip:c})};u.prototype._renderMediaInfo=function(a,b){this._destroyChart(b);var c=this._renderMediaInfoType(a,b),d=a.title?m.tsx("div",{key:r("media-title",b),class:"esri-feature__media-item-title",innerHTML:a.title}):null;a=a.caption?m.tsx("div",{key:r("media-caption",b),class:"esri-feature__media-item-caption",innerHTML:a.caption}):null;return m.tsx("div",
{key:r("media-container",b),class:"esri-feature__media-item-container"},m.tsx("div",{key:r("media-item-container",b),class:"esri-feature__media-item"},c),d,a)};u.prototype._renderMediaStatsItem=function(a,b,c){c="chart"===c?this.classes("esri-feature__media-chart-icon","esri-icon-chart"):this.classes("esri-feature__media-image-icon","esri-icon-media");return m.tsx("li",{class:"esri-feature__media-image-summary"},m.tsx("span",{"aria-hidden":"true",class:c}),m.tsx("span",{class:"esri-feature__media-count",
"aria-label":a},"("+b+")"))};u.prototype._renderMediaPageButton=function(a,b){var c=(a="previous"===a)?d.previous:d.next,f=a?this.classes("esri-feature__button","esri-feature__media-previous"):this.classes("esri-feature__button","esri-feature__media-next"),v=a?this.classes("esri-feature__icon","esri-feature__media-previous-icon","esri-icon-left-triangle-arrow"):this.classes("esri-feature__icon","esri-feature__media-next-icon","esri-icon-right-triangle-arrow"),g=a?this.classes("esri-feature__icon",
"esri-feature__media-previous-icon--rtl","esri-icon-right-triangle-arrow"):this.classes("esri-feature__icon","esri-feature__media-next-icon--rtl","esri-icon-left-triangle-arrow"),k=a?this._previousClick:this._nextClick;return m.tsx("div",{key:r(a?"previous":"next",b),title:c,tabIndex:0,role:"button",class:f,"data-content-element-index":b,bind:this,onkeydown:k,onclick:k},m.tsx("span",{"aria-hidden":"true",class:v}),m.tsx("span",{"aria-hidden":"true",class:g}),m.tsx("span",{class:"esri-icon-font-fallback-text"},
c))};u.prototype._handleMediaKeyup=function(a){var c=a.currentTarget["data-content-element-index"],d=a.keyCode;d===b.LEFT_ARROW&&(a.stopPropagation(),this.previousMedia(c));d===b.RIGHT_ARROW&&(a.stopPropagation(),this.nextMedia(c))};u.prototype._renderMedia=function(a,b){var c;a=a.mediaInfos;var f=this._getMediaStats(a),v=f.total,g=(c={},c["esri-feature--media-pagination-visible"]=1<f.total,c);c=this._renderMediaStatsItem(d.numImages,f.images,"image");var f=this._renderMediaStatsItem(d.numCharts,
f.charts,"chart"),k=this._renderMediaPageButton("previous",b),l=this._renderMediaPageButton("next",b),n=this._activeMediaMap.get(b);isNaN(n)&&(this._activeMediaMap.set(b,0),n=0);return v?m.tsx("div",{key:r("media-element",b),"data-content-element-index":b,bind:this,onkeyup:this._handleMediaKeyup,class:this.classes("esri-feature__media","esri-feature__content-element",g)},m.tsx("ul",{class:"esri-feature__media-summary"},c,f),m.tsx("div",{key:r("media-element-container",b),class:"esri-feature__media-container"},
k,this._renderMediaInfo(a[n],b),l)):null};u.prototype._renderText=function(a,b){return a.text?m.tsx("div",{key:r("text-element",b),innerHTML:a.text,class:this.classes("esri-feature__text","esri-feature__content-element")}):null};u.prototype._attachToNode=function(a){a.appendChild(this)};u.prototype._getMediaStats=function(a){var b=0,c=0;a.forEach(function(a){a=a.type;"image"===a?b++:-1!==a.indexOf("chart")&&c++});return{total:c+b,images:b,charts:c}};u.prototype._setContentElementMedia=function(a,
b){this._clearMediaRefreshTimer(a);var c=this.viewModel.content;(c=(c=c&&c[a])&&c.mediaInfos)&&c.length&&(this._activeMediaMap.set(a,(b+c.length)%c.length),this._setupMediaRefreshTimer(a),this.scheduleRender())};u.prototype._pageContentElementMedia=function(a,b){b="previous"===b?-1:1;b=this._activeMediaMap.get(a)+b;this._setContentElementMedia(a,b)};u.prototype._previousClick=function(a){this.previousMedia(a.currentTarget["data-content-element-index"])};u.prototype._nextClick=function(a){this.nextMedia(a.currentTarget["data-content-element-index"])};
a([f.aliasOf("viewModel.contentEnabled")],u.prototype,"contentEnabled",void 0);a([f.aliasOf("viewModel.graphic")],u.prototype,"graphic",void 0);a([f.aliasOf("viewModel.title")],u.prototype,"title",void 0);a([f.aliasOf("viewModel.view")],u.prototype,"view",void 0);a([f.property({type:n}),m.renderable(["viewModel.waitingForContent","viewModel.content"])],u.prototype,"viewModel",void 0);a([m.accessibleHandler()],u.prototype,"_previousClick",null);a([m.accessibleHandler()],u.prototype,"_nextClick",null);
return u=a([f.subclass("esri.widgets.Feature")],u)}(f.declared(k))})},"esri/widgets/Feature/FeatureViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper dojo/i18n!dojo/cldr/nls/number ../../Graphic ../../core/date ../../core/Error ../../core/Handles ../../core/lang ../../core/Logger ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../../support/arcadeUtils ./support/featureUtils ./support/RelatedFeatures ../support/widget".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u,x,v){function A(a,b){return a&&"feature"===a.type?a.getField(b):null}function y(a){return a.replace(/[\u00A0-\u99999<>\&]/gim,function(a){return"\x26#"+a.charCodeAt(0)+";"})}var C=l.getLogger("esri.widgets.FeatureViewModel"),B=/^\s*expression\//i,D=new RegExp(""+b.group,"g"),E=new f("cancelled-query","cancelled feature query"),J=c.getFormat("short-date-short-time"),F="DateFormat"+J;return function(f){function l(a){a=f.call(this)||this;a._handles=new k;a._featurePromise=
void 0;a._layerDateFields=null;a._expressionAttributes=null;a.content=null;a.contentEnabled=!0;a.formattedAttributes=null;a.title="";a.view=null;return a}e(l,f);l.prototype.destroy=function(){this._clear();this._handles.destroy();this._expressionAttributes=this._layerDateFields=this.graphic=this.view=this._handles=null};Object.defineProperty(l.prototype,"graphic",{get:function(){return this._get("graphic")||null},set:function(a){if(a){var b=u.getSourceLayer(a);this._layerDateFields=b?this._getDateFields(b):
[]}this._set("graphic",a);this._graphicChanged(a)},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"waitingForContent",{get:function(){return!!this._featurePromise},enumerable:!0,configurable:!0});l.prototype._clear=function(){this._cancelFeatureQuery();this._set("title","");this._set("content",null);this._set("formattedAttributes",null)};l.prototype._graphicChanged=function(a){var b=this,c=this._handles;if(c&&(c.remove("graphic"),this._clear(),a)){c.add(m.watch(this,"graphic.sourceLayer.popupTemplate.title graphic.sourceLayer.popupTemplate.content graphic.sourceLayer.popupTemplate.fieldInfos graphic.popupTemplate.title graphic.popupTemplate.content graphic.popupTemplate.fieldInfos contentEnabled".split(" "),
function(){b._graphicChanged(b.graphic)}),"graphic");var d=!1;a=this._queryFeature().catch(function(a){a!==E&&C.error("error","error loading template",a)}).then(function(){d=!0;b._featurePromise=null;b.notifyChange("waitingForContent")});d||(this._featurePromise=a,this.notifyChange("waitingForContent"))}};l.prototype._cancelFeatureQuery=function(){var a=this._featurePromise;a&&"function"===typeof a.cancel&&a.cancel(E);this._featurePromise=null;this.notifyChange("waitingForContent")};l.prototype._compileContent=
function(a,b){var c=this;if(a&&(a.nodeName||a&&v.isWidgetBase(a)||v.isWidget(a)))return a;if("string"===typeof a)return this._compileText({type:"text",text:a}).text;if(Array.isArray(a))return a.map(function(a,d){d=(d=b&&b[d])&&d.value;var f=a.type;if("attachments"===f)return c._compileAttachments(a,d);if("fields"===f)return c._compileFields(a);if("media"===f)return c._compileMedia(a);if("text"===f)return c._compileText(a)});a&&C.warn("invalid content type.")};l.prototype._compileFields=function(a){var b=
this,c=this.graphic;a=n.clone(a);var d=(c=c.getEffectivePopupTemplate())&&c.expressionInfos,c=a.fieldInfos?void 0:c&&c.fieldInfos,c=a.fieldInfos||n.clone(c),f=[];c&&c.forEach(function(a){var c=a.fieldName.toLowerCase();if(!a.hasOwnProperty("visible")||a.visible)c=b._isExpressionField(c)?b._getExpressionInfo(d,c):null,a.label=c?c.title:a.label,f.push(a)});a.fieldInfos=f;return a};l.prototype._setImageValue=function(a){var b=a.value,c=a.formattedAttributes;a=a.layer;var d=b.linkURL,f=b.sourceURL;f&&
(b.sourceURL=n.substitute(c,this._fixTokens(f,a)));d&&(b.linkURL=(""+n.substitute(c,this._fixTokens(d,a))).trim())};l.prototype._compileMedia=function(a){var b=this,c=this._expressionAttributes,f=this._layerDateFields,v=this.graphic;a=n.clone(a);var g=a.mediaInfos||[],m=d({},v.attributes,c),k=u.getSourceLayer(v),l=this.formattedAttributes.global,e={dateFormat:{properties:f,formatter:F}};a.mediaInfos=g.map(function(a){if(a=n.clone(a)){var c=a.value,d=a.type,f=a.title?b._processFieldsInLinks(b._fixTokens(a.title,
k),m):"",v=a.caption?b._processFieldsInLinks(b._fixTokens(a.caption,k),m):"";a.title=f?(""+n.substitute(l,f,e)).trim():"";a.caption=v?(""+n.substitute(l,v,e)).trim():"";if("image"===d)return b._setImageValue({value:c,formattedAttributes:l,layer:k}),a.value.sourceURL?a:void 0;if("pie-chart"===d||"line-chart"===d||"column-chart"===d||"bar-chart"===d)return b._setChartValue({value:c,attributes:m,formattedAttributes:l,layer:k}),a}}).filter(Boolean);return a};l.prototype._compileText=function(a){var b=
this._expressionAttributes,c=this._layerDateFields,f=this.graphic;if((a=n.clone(a))&&a.text){var v=u.getSourceLayer(f),f=d({},f.attributes,b),b=this.formattedAttributes.global,c={dateFormat:{properties:c,formatter:F}},v=this._processFieldsInLinks(this._fixTokens(a.text,v),f);a.text=(""+n.substitute(b,v,c)).trim()}return a};l.prototype._compileTitle=function(){var a=this._expressionAttributes,b=this._layerDateFields,c=this.graphic,f=c.getEffectivePopupTemplate(),f=f&&f.title,a=d({},c.attributes,a),
v=u.getSourceLayer(c),b={dateFormat:{properties:b,formatter:F}},g=this.formattedAttributes.global;return"function"===typeof f?f.call(null,{graphic:c}):"string"===typeof f&&f?(c=this._processFieldsInLinks(this._fixTokens(f,v),a),(""+n.substitute(g,c,b)).trim()):""};l.prototype._getExpressionInfo=function(a,b){if(this._isExpressionField(b)){var c=b.replace(B,"").toLowerCase(),d;a.some(function(a){if(a.name.toLowerCase()===c)return d=a,!0});return d}};l.prototype._fixTokens=function(a,b){return a.replace(/(\{([^\{\r\n]+)\})/g,
function(a,c,d){return(a=A(b,d))?"{"+a.name+"}":c})};l.prototype._encodeAttributes=function(a){var b=a?n.clone(a):{};Object.keys(b).forEach(function(a){var c=b[a];"string"===typeof c&&(c=encodeURIComponent(c).replace(/\'/g,"\x26apos;"),b[a]=c)});return b};l.prototype._formatAttributesToFieldInfos=function(a,b,c){var d=this,f=n.clone(this._layerDateFields);a.forEach(function(v){var g=d._getFixedFieldName(v.fieldName,b);v.fieldName=g;c[g]=d._formatValue(c[g],{fieldInfos:a,fieldName:g,layer:b});f&&v.format&&
v.format.dateFormat&&(v=f.indexOf(g),-1<v&&f.splice(v,1))})};l.prototype._getArcadeViewingMode=function(a){return a&&"local"===a.viewingMode?"localScene":"globalScene"};l.prototype._getViewInfo=function(){var a=this.view;if(a){var b="3d"===a.type?this._getArcadeViewingMode(a):"map";return t.getViewInfo({viewingMode:b,scale:a.scale,spatialReference:a.spatialReference})}};l.prototype._formatAttributes=function(a){var b=this,c=this._expressionAttributes,f=this.graphic,v=f.attributes,f=u.getSourceLayer(f),
g=v?n.clone(v):{},m=d({},g,c);this.addRelatedFeatureAttributes(m);a&&this._formatAttributesToFieldInfos(a,f,m);if(f){var k=f.typeIdField;v&&Object.keys(v).forEach(function(a){if(!b.isRelatedField(a)){var c=v[a];n.isDefined(c)&&(c=b._getDomainName(a,c),n.isDefined(c)?m[a]=c:a===k&&(c=b._getTypeName(),n.isDefined(c)&&(m[a]=c)))}})}return m};l.prototype._formatValue=function(a,d){var f={dateFormat:{properties:this._layerDateFields,formatter:F}},v=d.fieldName,g=this._getFieldInfo(d.fieldInfos,v),m=n.clone(g),
g=d.preventPlacesFormatting;(d=A(d.layer,v))&&"date"===d.type&&(d=m.format||{},d.dateFormat=d.dateFormat||"short-date-short-time",m.format=d);v=m&&m.format;if(!n.isDefined(a)||!m||!n.isDefined(v))return a;var k=[],m=v.hasOwnProperty("places")||v.hasOwnProperty("digitSeparator");d=v.hasOwnProperty("digitSeparator")?v.digitSeparator:!0;g=n.isDefined(v.places)&&(!g||0<v.places);m&&g&&k.push("places: "+Number(v.places));g=m?g?"NumberFormat("+k.join(",")+")":"NumberFormat":v.dateFormat?"DateFormat"+(c.getFormat(v.dateFormat)||
J):void 0;if(!g)return a;a=n.substitute({myKey:a},"{myKey:"+g+"}",f)||"";return m&&!d&&b.group?a.replace(D,""):a};l.prototype._getDomainName=function(a,b){var c=this.graphic,d=u.getSourceLayer(c);return d&&"feature"===d.type?(a=d.getFieldDomain(a,{feature:c}))&&"coded-value"===a.type?a.getName(b):null:null};l.prototype._getFieldInfo=function(a,b){if(a&&a.length&&b){var c=b.toLowerCase(),d=void 0;a.some(function(a){if(a.fieldName&&a.fieldName.toLowerCase()===c)return d=a,!0});return d}};l.prototype._getTypeName=
function(){var a=this.graphic,b=u.getSourceLayer(a);if(b&&"feature"===b.type&&(a=b.getFeatureType(a)))return a.name};l.prototype._processFieldsInLinks=function(a,b){var c=this._encodeAttributes(b),d=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi;return a?a.replace(d,function(a,d,f){d=(""+(d||f)).trim();return n.substitute(d&&"{"===d[0]?b:c,a)}):a};l.prototype._compileAttachments=function(a,b){a=n.clone(a);if(!b)return a;a.attachmentInfos=b;return a};l.prototype._queryAttachments=function(){var a=this.graphic,
b=u.getSourceLayer(a);return b?(b="scene"===b.type&&b.associatedLayer?b.associatedLayer:b)&&"feature"===b.type?b.queryFeatureAttachments(a):p.resolve([]):p.resolve([])};l.prototype._queryContentElements=function(a){var b=this;if(!Array.isArray(a))return p.resolve();var c={};a.forEach(function(a,d){"attachments"===a.type&&(a=b._queryAttachments())&&(c[d]=a)});return Object.keys(c).length?p.eachAlways(c):p.resolve()};l.prototype._getContent=function(){var a=this.graphic;if(!this.contentEnabled)return p.resolve();
var b=a.getEffectivePopupTemplate(),b=b&&b.content,a="function"===typeof b?b.call(null,{graphic:a}):b;return p.isThenable(a)?a:p.resolve(a)};l.prototype._queryFeature=function(){var a=this;return this._getContent().then(function(b){return a._checkForRelatedFeatures(b).then(function(){a._expressionAttributes=a._createFormattedExpressions();a._set("formattedAttributes",a._createFormattedAttributes(b));a._set("title",a._compileTitle());return a._queryContentElements(b).then(function(c){c=a._compileContent(b,
c);a._set("content",c||null);return c})})})};l.prototype._isExpressionField=function(a){return B.test(a)};l.prototype._createCompiledExpressionDictionary=function(a){var b=new Map;if(!a)return b;a.forEach(function(a){return b.set(a.name,t.createFunction(a.expression))});return b};l.prototype._getDateFields=function(a){return(a=a.fields)?a.filter(function(a){return"date"===a.type}).map(function(a){return a.name}):[]};l.prototype._createFormattedExpressions=function(){var a=this,b=this.graphic,c=b.getEffectivePopupTemplate(),
c=c&&c.expressionInfos,d=this._createCompiledExpressionDictionary(c),f={};c&&c.forEach(function(c){var v="expression/"+c.name;c=d.get(c.name);var g=a._getViewInfo();c=t.executeFunction(c,t.createExecContext(b,g));f[v]="string"===typeof c?y(c):c});return f};l.prototype._createFormattedAttributes=function(a){var b=this,c=this.graphic.getEffectivePopupTemplate(),d={global:this._formatAttributes(c&&c.fieldInfos),content:[]};Array.isArray(a)&&a.forEach(function(a,c){"fields"===a.type&&a.fieldInfos&&(d.content[c]=
b._formatAttributes(a.fieldInfos))});return d};l.prototype._getAllFieldInfos=function(a){var b=[],c=this.graphic.getEffectivePopupTemplate();(c=c&&c.fieldInfos)&&b.push.apply(b,c);if(!a||!Array.isArray(a))return b;a.forEach(function(a){b.push.apply(b,a&&a.fieldInfos)});return b};l.prototype._checkForRelatedFeatures=function(a){var b=this.graphic;a=this._getAllFieldInfos(a);return this.queryRelatedInfos(b,a)};l.prototype._getChartOption=function(a){var c=a.value,d=a.attributes,f=a.formattedAttributes,
v=a.fieldName,g=a.relatedFieldName,m=a.fieldInfos;a=u.getSourceLayer(this.graphic);var k=c.normalizeField,l=c.tooltipField,k=k?this.isRelatedField(k)?d[this.getRelatedFieldInfo(k).fieldName]:d[k]:null,c=g&&void 0!==d[g]?d[g]:void 0!==d[v]?d[v]:f[v],c="string"===typeof c&&b.group?parseFloat(c.replace(D,"")):c,n=void 0===c?null:c&&k?c/k:c,c={y:n};if(this.isRelatedField(v))return f=this.getRelatedFieldInfo(v),v=(v=this.getRelatedFieldInfo(l))?v.fieldName:null,a=this._formatValue(n,{fieldInfos:m,fieldName:g,
layer:a,preventPlacesFormatting:!!k}),g=f?f.label||f.fieldName:g,c.tooltip=(v&&void 0!==d[v]?d[v]:g)+": "+a,c;d=this._getFieldInfo(m,v);g=this._getFixedFieldName(v,a);d=d?d.label||d.fieldName:v;c.tooltip=(l&&void 0!==f[l]?f[l]:d)+": "+f[g];return c};l.prototype._getFixedFieldName=function(a,b){return(b=A(b,a))?b.name:a};l.prototype._getFixedFieldNames=function(a,b){var c=this;return a&&a.map(function(a){return c._getFixedFieldName(a,b)})};l.prototype._setChartValue=function(a){var b=this,c=a.value,
d=a.attributes,f=a.formattedAttributes,v=a.layer,g=this.graphic,m=this.relatedInfoCount;a=c.fields;var k=c.normalizeField;c.fields=this._getFixedFieldNames(a,v);k&&(c.normalizeField=this._getFixedFieldName(k,v));if(a.some(function(a){return!!(n.isDefined(f[a])||b.isRelatedField(a)&&m)})){var l=(v=g.getEffectivePopupTemplate())&&v.fieldInfos;c.chartOptions=c.chartOptions||[];a.forEach(function(a){b.isRelatedField(a)?c.chartOptions=c.chartOptions.concat(b._getRelatedChartInfos({fieldInfos:l,fieldName:a,
formattedAttributes:f,value:c})):(a=b._getChartOption({value:c,attributes:d,formattedAttributes:f,fieldName:a,fieldInfos:l}),c.chartOptions.push(a))})}};l.prototype._getRelatedChartInfos=function(a){var b=this,c=a.fieldInfos,d=a.fieldName,f=a.formattedAttributes,v=a.value,g=[];a=this.getRelatedFieldInfo(d);var m=a.fieldName,k=this.getRelatedInfo(a.layerId);if(!k)return g;a=k.relatedFeatures;k=k.relation;if(!k||!a)return g;k=k.cardinality;a.forEach(function(a){var k=a.attributes;k&&Object.keys(k).forEach(function(a){a===
m&&g.push(b._getChartOption({value:v,attributes:k,formattedAttributes:f,fieldName:d,relatedFieldName:a,fieldInfos:c}))})});return"one-to-many"===k||"many-to-many"===k?g:[g[0]]};a([r.property({readOnly:!0})],l.prototype,"content",void 0);a([r.property()],l.prototype,"contentEnabled",void 0);a([r.property({readOnly:!0})],l.prototype,"formattedAttributes",void 0);a([r.property({type:g})],l.prototype,"graphic",null);a([r.property({readOnly:!0})],l.prototype,"title",void 0);a([r.property()],l.prototype,
"view",void 0);a([r.property({readOnly:!0})],l.prototype,"waitingForContent",null);return l=a([r.subclass("esri.widgets.FeatureViewModel")],l)}(r.declared(x))})},"esri/widgets/Feature/support/featureUtils":function(){define(["require","exports"],function(q,h){Object.defineProperty(h,"__esModule",{value:!0});h.getSourceLayer=function(e){if(e)return e.get("sourceLayer")||e.get("layer")}})},"esri/widgets/Feature/support/RelatedFeatures":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../request ../../../core/Accessor ../../../core/Error ../../../core/Logger ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../../../tasks/QueryTask ../../../tasks/support/Query ../../../tasks/support/StatisticDefinition ./featureUtils".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m){var r=new Map,t=c.getLogger("esri.widgets.Popup.support.RelatedFeatures");return function(b){function c(a){a=b.call(this)||this;a.relatedInfoCount=null;a.relatedInfos=new Map;return a}e(c,b);c.prototype.destroy=function(){this.relatedInfos.clear()};c.prototype.addRelatedFeatureAttributes=function(a){var b=this;this.relatedInfos.forEach(function(c){return b._addRelatedFeatureAttribute(a,c)})};c.prototype.getRelatedFieldInfo=function(a){if(-1===a.indexOf("relationships/"))return null;
a=a.split("/").slice(1);return{layerId:a[0],fieldName:a[1]}};c.prototype.getRelatedInfo=function(a){return this.relatedInfos.get(a.toString())};c.prototype.isRelatedField=function(a){void 0===a&&(a="");return a?-1!==a.indexOf("relationships/"):!1};c.prototype.queryRelatedInfos=function(a,b){var c=this;this.relatedInfos.clear();var d=m.getSourceLayer(a);if(!d)return f.resolve();var v=b.filter(function(a){return a&&c.isRelatedField(a.fieldName)});if(!v||!v.length)return f.resolve();this._createRelatedInfos(b,
d);return this._queryLayerInfos(d,b).then(function(b){c._updateRelatedInfoLayerInfos(b);return c._queryRelatedFeatureMap(a).then(function(a){Object.keys(a).forEach(function(b){c._setRelatedFeatures(a[b],b.toString())});return a})})};c.prototype._addRelatedFeatureAttribute=function(a,b){var c=this;a&&b&&("one-to-one"===b.relation.cardinality&&b.relatedFeatures&&b.relatedFeatures.forEach(function(d){return c._addAttributesFromFeature(a,d,b)}),b.relatedStatsFeatures&&b.relatedStatsFeatures.forEach(function(d){return c._addAttributesFromFeature(a,
d,b)}))};c.prototype._updateRelatedInfoLayerInfo=function(a,b){if(a=a.value)this.getRelatedInfo(b).layerInfo=a.data};c.prototype._updateRelatedInfoLayerInfos=function(a){var b=this;Object.keys(a).forEach(function(c){return b._updateRelatedInfoLayerInfo(a[c],c.toString())})};c.prototype._addAttributesFromFeature=function(a,b,c){var d=this;a&&b&&c&&Object.keys(b.attributes).forEach(function(f){var v=d._relatedFieldInfoToString({layerId:c.relation.id.toString(),fieldName:f});a[v]=b.attributes[f]})};
c.prototype._relatedFieldInfoToString=function(a){return a?"relationships/"+a.layerId+"/"+a.fieldName:""};c.prototype._createRelatedInfoForFieldInfo=function(a,b){var c=this.getRelatedFieldInfo(a.fieldName);if(c){var d=c.layerId,c=c.fieldName;d&&(b=this.getRelatedInfo(d)||this._createRelatedInfo(d,b))&&(b.relatedFields.push(c),a.statisticType&&(a=new p({statisticType:a.statisticType,onStatisticField:c,outStatisticFieldName:c}),b.outStatistics.push(a)))}};c.prototype._createRelatedInfos=function(a,
b){var c=this;a.forEach(function(a){return c._createRelatedInfoForFieldInfo(a,b)})};c.prototype._queryRelatedFeatureMap=function(a){var b=this,c={};this.relatedInfos.forEach(function(d,f){c[f]=b._queryRelatedLayerFeatures(a,d)});return f.eachAlways(c)};c.prototype._queryLayerInfos=function(a,b){var c=this,d={};this.relatedInfos.forEach(function(b,v){b=b.relation;if(!b)return v=new g("relation-required","A relation is required on a layer to retrieve related records."),t.error(v),f.reject(v);b=b.relatedTableId;
if(!b)return v=new g("A related table ID is required on a layer to retrieve related records."),t.error(v),f.reject(v);b=a.url+"/"+b;var m=r.get(b),k=m?m:c._queryLayerInfo(b);m||r.set(b,k);d[v]=k});return f.eachAlways(d)};c.prototype._queryLayerInfo=function(a){return d(a,{query:{f:"json"},callbackParamName:"callback"})};c.prototype._queryRelatedLayerFeatures=function(a,b){var c=m.getSourceLayer(a).layerId.toString(),d=b.layerInfo,v=b.queryTask,g=b.relation;if(c=this._getDestinationRelation(d,c)){var g=
g.keyField,k=c.keyField,c="string"===this._getDestinationFieldType(d,c)?k+"\x3d'"+a.attributes[g]+"'":k+"\x3d"+a.attributes[g];a=v.execute(new l({where:c,outFields:b.relatedFields}));b=b.outStatistics&&0<b.outStatistics.length&&d.supportsStatistics?v.execute(new l({where:c,outFields:b.relatedFields,outStatistics:b.outStatistics})):null;return f.eachAlways({features:a,statsFeatures:b?b:f.resolve()})}return f.resolve()};c.prototype._setRelatedFeatures=function(a,b){if(b=this.getRelatedInfo(b)){var c=
a.value;c&&(a=c.features,c=c.statsFeatures,a=a&&a.value,b.relatedFeatures=a?a.features:[],a=c&&c.value,b.relatedStatsFeatures=a?a.features:[])}};c.prototype._getRelation=function(a,b){if("feature"!==b.type)return null;var c=null;b.relationships.some(function(b){if(b.id===parseInt(a,10))return c=b,!0});return c};c.prototype._createRelatedInfo=function(a,b){var c=this._getRelation(a,b);if(c){b=b.url+"/"+c.relatedTableId;var d=new n({url:b}),c={url:b,queryTask:d,relation:c,relatedFields:[],outStatistics:[]};
this.relatedInfos.set(a,c);return c}};c.prototype._getDestinationRelation=function(a,b){var c;a&&a.relationships&&a.relationships.some(function(a){if(""+a.relatedTableId===b)return c=a,!0});return c};c.prototype._getDestinationFieldType=function(a,b){var c=void 0;a.fields.some(function(a){if(a.name===b.keyField)return c=-1!==["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(a.type)?"number":"string",!0});return c};a([k.aliasOf("relatedInfos.size")],
c.prototype,"relatedInfoCount",void 0);a([k.property()],c.prototype,"relatedInfos",void 0);return c=a([k.subclass("esri.widgets.Popup.support.RelatedFeatures")],c)}(k.declared(b))})},"esri/widgets/Feature/support/attachmentUtils":function(){define(["require","exports"],function(q,h){Object.defineProperty(h,"__esModule",{value:!0});var e=q.toUrl("../../../themes/base/images/files/");h.isSupportedImage=function(a){a=a.toLowerCase();return"image/bmp"===a||"image/emf"===a||"image/exif"===a||"image/gif"===
a||"image/x-icon"===a||"image/jpeg"===a||"image/png"===a||"image/tiff"===a||"image/x-wmf"===a};h.getIconPath=function(a){return"text/plain"===a?e+"text-32.svg":"application/pdf"===a?e+"pdf-32.svg":"text/csv"===a?e+"csv-32.svg":"application/gpx+xml"===a?e+"gpx-32.svg":"application/x-dwf"===a?e+"cad-32.svg":"application/postscript"===a||"application/json"===a||"text/xml"===a||"model/vrml"===a?e+"code-32.svg":"application/x-zip-compressed"===a||"application/x-7z-compressed"===a||"application/x-gzip"===
a||"application/x-tar"===a||"application/x-gtar"===a||"application/x-bzip2"===a||"application/gzip"===a||"application/x-compress"===a||"application/x-apple-diskimage"===a||"application/x-rar-compressed"===a||"application/zip"===a?e+"zip-32.svg":-1!==a.indexOf("image/")?e+"image-32.svg":-1!==a.indexOf("audio/")?e+"sound-32.svg":-1!==a.indexOf("video/")?e+"video-32.svg":-1!==a.indexOf("msexcel")||-1!==a.indexOf("ms-excel")||-1!==a.indexOf("spreadsheetml")?e+"excel-32.svg":-1!==a.indexOf("msword")||
-1!==a.indexOf("ms-word")||-1!==a.indexOf("wordprocessingml")?e+"word-32.svg":-1!==a.indexOf("powerpoint")||-1!==a.indexOf("presentationml")?e+"report-32.svg":e+"generic-32.svg"}})},"esri/widgets/support/uriUtils":function(){define(["require","exports","dojo/i18n!./nls/uriUtils","../../core/lang"],function(q,h,e,a){function d(a){var c=null;b.some(function(b){b.pattern.test(a)&&(c=b);return!!c});return c}Object.defineProperty(h,"__esModule",{value:!0});var b=[{id:"http",pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,
target:"_blank",label:e.view},{id:"tel",pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{id:"mailto",pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{id:"arcgis-appstudio-player",pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:e.openInApp,appName:"App Studio Player"},{id:"arcgis-collector",pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:e.openInApp,appName:"Collector"},{id:"arcgis-explorer",pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:e.openInApp,
appName:"Explorer"},{id:"arcgis-navigator",pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:e.openInApp,appName:"Navigator"},{id:"arcgis-survey123",pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:e.openInApp,appName:"Survey123"},{id:"arcgis-trek2there",pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:e.openInApp,appName:"Trek2There"},{id:"arcgis-workforce",pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:e.openInApp,appName:e.workforce},{id:"iform",pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,
label:e.openInApp,appName:"iForm"},{id:"flow",pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:e.openInApp,appName:"FlowFinity"},{id:"lfmobile",pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:e.openInApp,appName:"Laserfische"},{id:"mspbi",pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:e.openInApp,appName:"Microsoft Power Bi"}];h.autoLink=function(b){if("string"!==typeof b||!b)return b;var c=d(b);if(!c)return b;var f=b.match(c.pattern),f=a.substitute({appName:c.appName,hierPart:f&&f[2]},c.label);return b.replace(c.pattern,
"\x3ca "+(c.target?'target\x3d"'+c.target+'"':"")+'" href\x3d"$1"\x3e'+f+"\x3c/a\x3e")}})},"esri/widgets/Spinner":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/promiseUtils ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./support/AnchorElementViewModel ./support/widget".split(" "),function(q,h,e,a,d,b,g,c,f,k){return function(c){function l(a){a=c.call(this)||this;a._animationDelay=500;a._animationPromise=null;a.location=
null;a.view=null;a.visible=!1;a.viewModel=new f;return a}e(l,c);l.prototype.postInitialize=function(){var a=this;this.own([b.watch(this,"visible",function(b){return a._visibleChange(b)})])};l.prototype.destroy=function(){this._cancelAnimationPromise()};l.prototype.show=function(a){var b=this,c=a.location;a=a.promise;c&&(this.viewModel.location=c);this.visible=!0;c=function(){return b.hide()};a&&a.catch(function(){}).then(c)};l.prototype.hide=function(){this.visible=!1};l.prototype.render=function(){var a,
b=this.visible,c=!!this.viewModel.screenLocation,b=(a={},a["esri-spinner--start"]=b&&c,a["esri-spinner--finish"]=!b&&c,a);a=this._getPositionStyles();return k.tsx("div",{class:this.classes("esri-spinner",b),styles:a})};l.prototype._cancelAnimationPromise=function(){var a=this._animationPromise;a&&a.cancel();this._animationPromise=null};l.prototype._visibleChange=function(a){var b=this;a?this.viewModel.screenLocationEnabled=!0:(this._cancelAnimationPromise(),this._animationPromise=d.after(this._animationDelay).then(function(){b.viewModel.screenLocationEnabled=
!1;b._animationPromise=null}))};l.prototype._getPositionStyles=function(){var a=this.viewModel,b=a.screenLocation,a=a.view;if(!a||!b)return{};a=a.padding;return{left:b.x-a.left+"px",top:b.y-a.top+"px"}};a([g.aliasOf("viewModel.location")],l.prototype,"location",void 0);a([g.aliasOf("viewModel.view")],l.prototype,"view",void 0);a([g.property(),k.renderable()],l.prototype,"visible",void 0);a([g.property({type:f}),k.renderable(["viewModel.screenLocation","viewModel.screenLocationEnabled"])],l.prototype,
"viewModel",void 0);return l=a([g.subclass("esri.widgets.Spinner")],l)}(g.declared(c))})},"esri/widgets/support/AnchorElementViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Evented ../../core/Handles ../../core/watchUtils ../../core/watchUtils ../../core/accessorSupport/decorators".split(" "),function(q,h,e,a,d,b,g,c,f,k){return function(b){function d(){var a=b.call(this)||this;a._anchorHandles=
new g;a.location=null;a.screenLocation=null;a.screenLocationEnabled=!1;a.view=null;a._anchorHandles.add([f.watch(a,"screenLocationEnabled,location,view.size",function(){return a._updateScreenPointAndHandle()}),f.watch(a,"view, view.ready",function(){return a._wireUpView()})]);return a}e(d,b);d.prototype.destroy=function(){this.view=null;this._anchorHandles&&this._anchorHandles.destroy();this._viewpointHandle=this._anchorHandles=null};d.prototype._wireUpView=function(){var a=this;this._anchorHandles.remove("view");
this._viewpointHandle=null;if(this.get("view.ready")){this._setScreenLocation();var b=this.view,b=c.pausable(b,"3d"===b.type?"camera":"viewpoint",function(){return a._viewpointChange()});this._anchorHandles.add(b,"view");this._viewpointHandle=b;this._toggleWatchingViewpoint()}};d.prototype._viewpointChange=function(){this._setScreenLocation();this.emit("view-change")};d.prototype._updateScreenPointAndHandle=function(){this._setScreenLocation();this._toggleWatchingViewpoint()};d.prototype._toggleWatchingViewpoint=
function(){var a=this._viewpointHandle,b=this.screenLocationEnabled;a&&(this.location&&b?a.resume():a.pause())};d.prototype._setScreenLocation=function(){var a=this.location,b=this.view,c=this.screenLocationEnabled,d=this.get("view.ready"),a=c&&a&&d?b.toScreen(a):null;this._set("screenLocation",a)};a([k.property()],d.prototype,"location",void 0);a([k.property({readOnly:!0})],d.prototype,"screenLocation",void 0);a([k.property()],d.prototype,"screenLocationEnabled",void 0);a([k.property()],d.prototype,
"view",void 0);return d=a([k.subclass("esri.widgets.support.AnchorElementViewModel")],d)}(k.declared(d,b))})},"esri/widgets/Popup/PopupViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/Collection ../../core/Error ../../core/Handles ../../core/Logger ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../../geometry/Point ../../geometry/support/webMercatorUtils ../../support/actions/ActionBase ../../support/actions/ActionButton ../../support/actions/ActionToggle ../support/AnchorElementViewModel ../support/GoTo".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u,x,v){function A(a,b){return b.allLayerViews.find(function(b){return b.layer===a})}var y=new t({id:"zoom-to"}),C=b.ofType({key:"type",defaultKeyValue:"button",base:r,typeMap:{button:t,toggle:u}}),B=new C([y]),D=f.getLogger("esri.widgets.Popup.PopupViewModel");return function(b){function f(a){a=b.call(this)||this;a._handles=new c;a._pendingPromises=new Set;a._zoomToLocation=null;a.actions=B;a.autoCloseEnabled=!1;a.content=null;a.highlightEnabled=!0;a.title=
null;a.updateLocationEnabled=!1;a.view=null;a.visible=!1;a.zoomFactor=4;return a}e(f,b);f.prototype.initialize=function(){var a=this;this._handles.add([this.on("view-change",this._autoClose),n.watch(this,["highlightEnabled","selectedFeature","visible","view"],this._highlightFeature),n.watch(this,"view.animation.state",function(b){a._zoomToLocation||(y.disabled="waiting-for-target"===b)})])};f.prototype.destroy=function(){this._handles.destroy();this._handles=null;this._pendingPromises.clear();this.view=
null};Object.defineProperty(f.prototype,"allActions",{get:function(){var a=this._get("allActions")||new C;a.removeAll();var b=this.selectedFeature&&("function"===typeof this.selectedFeature.getEffectivePopupTemplate&&this.selectedFeature.getEffectivePopupTemplate()||this.selectedFeature.popupTemplate),c=b&&b.actions;(b=b&&b.overwriteActions?c:this.actions.concat(c))&&b.filter(Boolean).forEach(function(b){return a.add(b)});return a},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,
"featureCount",{get:function(){return this.features.length},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"features",{get:function(){return this._get("features")||[]},set:function(a){a=a||[];this._set("features",a);var b=this.pendingPromisesCount,c=this.selectedFeatureIndex,d=this.promiseCount&&a.length;d&&b&&-1===c?this.selectedFeatureIndex=0:d&&-1!==c||(this.selectedFeatureIndex=a.length?0:-1)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"location",{get:function(){return this._get("location")||
null},set:function(a){var b=this.get("location"),c=this.get("view.spatialReference.isWebMercator");a&&a.get("spatialReference.isWGS84")&&c&&(a=m.geographicToWebMercator(a));this._set("location",a);a!==b&&this._centerAtLocation()},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"pendingPromisesCount",{get:function(){return this._pendingPromises.size},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"waitingForResult",{get:function(){return 0<this.pendingPromisesCount&&
0===this.featureCount},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"promiseCount",{get:function(){return this.promises.length},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"promises",{get:function(){return this._get("promises")||[]},set:function(a){var b=this,c=this._get("promises");c&&c.forEach(function(a){a&&"function"===typeof a.cancel&&a.cancel()});this._pendingPromises.clear();this.features=[];Array.isArray(a)&&a.length?(this._set("promises",a),a=a.slice(0),
a.forEach(function(a){b._pendingPromises.add(a);a.then(function(c){b._updatePendingPromises(a);b._updateFeatures(c)},function(){return b._updatePendingPromises(a)})})):this._set("promises",[]);this.notifyChange("pendingPromisesCount")},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"selectedFeature",{get:function(){var a=this.selectedFeatureIndex;if(-1===a)return null;a=this.features[a];if(!a)return null;this.updateLocationEnabled&&(this.location=this._getPointFromGeometry(a.geometry));
return a},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"selectedFeatureIndex",{get:function(){var a=this._get("selectedFeatureIndex");return"number"===typeof a?a:-1},set:function(a){var b=this.featureCount;a=isNaN(a)||-1>a||!b?-1:(a+b)%b;this._set("selectedFeatureIndex",a)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0});f.prototype.centerAtLocation=function(){var a=
this.location,b=this.view;return a&&b?this.callGoTo({target:{target:a,scale:b.scale}}):(a=new g("center-at-location:invalid-location-or-view","Cannot center at a location without a location and view.",{location:a,view:b}),D.error(a),k.reject(a))};f.prototype.clear=function(){this.set({promises:[],features:[],content:null,title:null,location:null})};f.prototype.open=function(a){this.set(d({visible:!1},{updateLocationEnabled:!1,promises:[]},a));this._setVisibleWhenContentExists()};f.prototype.triggerAction=
function(a){(a=this.allActions.getItemAt(a))&&this.emit("trigger-action",{action:a})};f.prototype.next=function(){this.selectedFeatureIndex+=1;return this};f.prototype.previous=function(){--this.selectedFeatureIndex;return this};f.prototype.zoomToLocation=function(){var a=this,b=this.location,c=this.selectedFeature,d=this.view,f=this.zoomFactor;if(!b||!d)return c=new g("zoom-to:invalid-location-or-view","Cannot zoom to location without a location and view.",{location:b,view:d}),D.error(c),k.reject(c);
var f=d.scale/f,v=this.get("selectedFeature.geometry"),d=c&&"3d"===d.type,b=(d=v||d)?c:b,m=d&&v&&"point"===v.type&&this._isScreenSize(c),c={target:b,scale:m?f:void 0};y.active=!0;y.disabled=!0;return this._zoomToLocation=c=this.callGoTo({target:c}).then(function(){m&&"point"===v.type&&(a.location=v);y.active=!1;y.disabled=!1;a._zoomToLocation=null}).catch(function(){y.active=!1;y.disabled=!1;a._zoomToLocation=null})};f.prototype._updatePendingPromises=function(a){a&&this._pendingPromises.has(a)&&
(this._pendingPromises.delete(a),this.notifyChange("pendingPromisesCount"))};f.prototype._setVisibleWhenContentExists=function(){var a=this,b=this._handles,c=this.promiseCount;b.remove("pendingVisible");c?(c=n.init(this,"pendingPromisesCount",function(c){a.featureCount&&(a.set("visible",!0),b.remove("pendingVisible"));c||b.remove("pendingVisible")}),b.add(c,"pendingVisible")):this.set("visible",!0)};f.prototype._autoClose=function(){this.autoCloseEnabled&&(this.visible=!1)};f.prototype._isScreenSize=
function(a){var b=this.view;if("3d"!==b.type||"esri.Graphic"!==a.declaredClass)return!0;if((b=b.getViewForGraphic(a))&&b.whenGraphicBounds){var c=!1;b.whenGraphicBounds(a,{useViewElevation:!0}).then(function(a){c=!a||!a.boundingBox||a.boundingBox[0]===a.boundingBox[3]&&a.boundingBox[1]===a.boundingBox[4]&&a.boundingBox[2]===a.boundingBox[5]});return c}return!0};f.prototype._getPointFromGeometry=function(a){return a?"point"===a.type?a:"extent"===a.type?a.center:"polygon"===a.type?a.centroid:"multipoint"===
a.type||"polyline"===a.type?a.extent.center:null:null};f.prototype._centerAtLocation=function(){var a=this.location,b=this.updateLocationEnabled,c=this.get("view.extent");b&&c&&a&&!c.contains(a)&&this.centerAtLocation()};f.prototype._highlightFeature=function(){this._handles.remove("highlight");var a=this.selectedFeature,b=this.highlightEnabled,c=this.view,d=this.visible;a&&c&&b&&d&&(b=a.layer)&&(c=A(b,c))&&"function"===typeof c.highlight&&(b=b.objectIdField,d=a.attributes,a=c.highlight(d&&d[b]||
a,{}),this._handles.add(a,"highlight"))};f.prototype._updateFeatures=function(a){var b=this.features;a&&a.length&&(b.length?(a=a.filter(function(a){return-1===b.indexOf(a)}),this.features=b.concat(a)):this.features=a)};a([l.property({type:C})],f.prototype,"actions",void 0);a([l.property({dependsOn:["actions.length","selectedFeature.sourceLayer.popupTemplate.actions.length","selectedFeature.sourceLayer.popupTemplate.overwriteActions","selectedFeature.popupTemplate.actions.length","selectedFeature.popupTemplate.overwriteActions"],
readOnly:!0})],f.prototype,"allActions",null);a([l.property()],f.prototype,"autoCloseEnabled",void 0);a([l.property()],f.prototype,"content",void 0);a([l.property({readOnly:!0,dependsOn:["features"]})],f.prototype,"featureCount",null);a([l.property()],f.prototype,"features",null);a([l.property()],f.prototype,"highlightEnabled",void 0);a([l.property({type:p})],f.prototype,"location",null);a([l.property({readOnly:!0,dependsOn:["promises"]})],f.prototype,"pendingPromisesCount",null);a([l.property({readOnly:!0,
dependsOn:["featureCount","pendingPromisesCount"]})],f.prototype,"waitingForResult",null);a([l.property({readOnly:!0,dependsOn:["promises"]})],f.prototype,"promiseCount",null);a([l.property()],f.prototype,"promises",null);a([l.property({value:null,readOnly:!0,dependsOn:["features","selectedFeatureIndex","updateLocationEnabled"]})],f.prototype,"selectedFeature",null);a([l.property({value:-1})],f.prototype,"selectedFeatureIndex",null);a([l.property({readOnly:!0,dependsOn:["view.ready"]})],f.prototype,
"state",null);a([l.property()],f.prototype,"title",void 0);a([l.property()],f.prototype,"updateLocationEnabled",void 0);a([l.property()],f.prototype,"view",void 0);a([l.property()],f.prototype,"visible",void 0);a([l.property()],f.prototype,"zoomFactor",void 0);a([l.property()],f.prototype,"centerAtLocation",null);a([l.property()],f.prototype,"clear",null);a([l.property()],f.prototype,"triggerAction",null);a([l.property()],f.prototype,"next",null);a([l.property()],f.prototype,"previous",null);a([l.property()],
f.prototype,"zoomToLocation",null);return f=a([l.subclass("esri.widgets.Popup.PopupViewModel")],f)}(l.declared(x,v))})},"esri/widgets/support/GoTo":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),function(q,h,e,a,d,b){return function(d){function c(){var a=null!==d&&d.apply(this,arguments)||this;a.goToOverride=null;a.view=null;return a}e(c,d);c.prototype.callGoTo=function(a){var b=
this.view;return this.goToOverride?this.goToOverride(b,a):b.goTo(a.target,a.options)};a([b.property()],c.prototype,"goToOverride",void 0);a([b.property()],c.prototype,"view",void 0);return c=a([b.subclass("esri.widgets.support.GoTo")],c)}(b.declared(d))})},"esri/views/3d/constraints/Constraints":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ./AltitudeConstraint ./ClipDistanceConstraint ./CollisionConstraint ./TiltConstraint".split(" "),
function(q,h,e,a,d,b,g,c,f,k){Object.defineProperty(h,"__esModule",{value:!0});q=function(d){function l(){var a=null!==d&&d.apply(this,arguments)||this;a.tilt=new k.default;a.altitude=new g.default;a.clipDistance=new c.default;a.collision=new f.default;return a}e(l,d);a([b.property({type:k.default})],l.prototype,"tilt",void 0);a([b.property({type:g.default})],l.prototype,"altitude",void 0);a([b.property({type:c.default})],l.prototype,"clipDistance",void 0);a([b.property({type:f.default})],l.prototype,
"collision",void 0);return l=a([b.subclass("esri.views.3d.constraints.Constraints")],l)}(b.declared(d));h.Constraints=q;h.default=q})},"esri/views/3d/constraints/AltitudeConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/_base/kernel ../../../core/Accessor ../../../core/accessorSupport/decorators ../state/Constraints".split(" "),function(q,h,e,a,d,b,g,c){Object.defineProperty(h,"__esModule",{value:!0});q=function(b){function f(){var a=
null!==b&&b.apply(this,arguments)||this;a.min=c.AltitudeDefault.min;a.max=c.AltitudeDefault.max;return a}e(f,b);Object.defineProperty(f.prototype,"mode",{get:function(){d.deprecated("esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.","","4.6");return"manual"},set:function(a){d.deprecated("esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.",
"","4.6")},enumerable:!0,configurable:!0});a([g.property({type:Number})],f.prototype,"min",void 0);a([g.property({type:Number})],f.prototype,"max",void 0);return f=a([g.subclass("esri.views.3d.constraints.AltitudeConstraint")],f)}(g.declared(b));h.AltitudeConstraint=q;h.default=q})},"esri/views/3d/state/Constraints":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Logger ../../../core/accessorSupport/decorators ../support/earthUtils ../support/mathUtils".split(" "),
function(q,h,e,a,d,b,g,c,f){Object.defineProperty(h,"__esModule",{value:!0});var k=b.getLogger("esri.views.3d.state.Constraints");q=function(b){function c(a){a=b.call(this)||this;a.collision=new l;a.distance=Infinity;a.minimumPoiDistance=4;return a}e(c,b);Object.defineProperty(c.prototype,"altitude",{get:function(){return"local"===this.mode?null:this._get("altitude")||null},set:function(a){"local"===this.mode?k.warn("Altitude constraint is ignored in local scenes"):this._set("altitude",a)},enumerable:!0,
configurable:!0});c.prototype.clampAltitude=function(a){return this.altitude?f.clamp(a,this.altitude.min,this.altitude.max):a};c.prototype.clampTilt=function(a,b){if(!this.tilt)return b;a=this.tilt(a);return f.clamp(b,a.min,a.max)};c.prototype.clampDistance=function(a){return Math.min(a,this.distance)};c.prototype.createDefaultTilt=function(){return"local"===this.mode?this.createDefaultTiltLocal():this.createDefaultTiltGlobal()};c.prototype.createConstantMaxTilt=function(a){return function(b,c){void 0===
c&&(c=n);c.min=h.TiltDefault.min;c.max=a;return c}};c.prototype.createDefaultTiltLocal=function(){var a=this.collision.enabled?f.makePiecewiseLinearFunction([[4E3,h.TiltDefault.max],[1E4,f.deg2rad(88)],[6E6,f.deg2rad(88)]]):function(){return h.TiltDefault.max};return function(b,c){void 0===c&&(c=n);c.min=h.TiltDefault.min;c.max=a(b);return c}};c.prototype.createDefaultTiltGlobal=function(){var a=this.collision.enabled?f.makePiecewiseLinearFunction([[4E3,h.TiltDefault.max],[5E4,f.deg2rad(88)],[6E6,
f.deg2rad(88)],[2E7,h.TiltDefault.min]]):f.makePiecewiseLinearFunction([[3E5,h.TiltDefault.max],[3E6,f.deg2rad(88)],[6E6,f.deg2rad(88)],[2E7,h.TiltDefault.min]]);return function(b,c){void 0===c&&(c=n);c.min=h.TiltDefault.min;c.max=a(b);return c}};a([g.property()],c.prototype,"altitude",null);a([g.property({readOnly:!0})],c.prototype,"collision",void 0);a([g.property()],c.prototype,"distance",void 0);a([g.property({readOnly:!0})],c.prototype,"minimumPoiDistance",void 0);a([g.property()],c.prototype,
"tilt",void 0);a([g.property({constructOnly:!0})],c.prototype,"mode",void 0);return c=a([g.subclass("esri.views.3d.state.Constraints")],c)}(g.declared(d));h.Constraints=q;h.AltitudeDefault={min:-2E5,max:4*c.earthRadius};h.TiltDefault={min:f.deg2rad(.5),max:f.deg2rad(179.5)};var n={min:0,max:0},l=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.enabled=!0;a.elevationMargin=5;return a}e(c,b);a([g.property({type:Boolean})],c.prototype,"enabled",void 0);a([g.property({type:Number})],
c.prototype,"elevationMargin",void 0);return c=a([g.subclass("esri.views.3d.state.Constraints.CollisionConstraint")],c)}(g.declared(d));h.default=q})},"esri/views/3d/constraints/ClipDistanceConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(q,h,e,a,d,b){Object.defineProperty(h,"__esModule",{value:!0});q=function(d){function c(){var a=
null!==d&&d.apply(this,arguments)||this;a.mode="auto";return a}e(c,d);Object.defineProperty(c.prototype,"near",{get:function(){return this._get("near")},set:function(a){this._set("near",a);a>=this._get("far")&&(this.far=a+1E-9);this.mode="manual"},enumerable:!0,configurable:!0});c.prototype.castNear=function(a){return Math.max(1E-8,a)};Object.defineProperty(c.prototype,"far",{get:function(){return this._get("far")},set:function(a){this._set("far",a);a<=this._get("near")&&(this.near=a-1E-9);this.mode=
"manual"},enumerable:!0,configurable:!0});c.prototype.castFar=function(a){return Math.max(1E-8,a)};c.prototype.autoUpdate=function(a,b){"auto"===this.mode&&(this._get("near")!==a&&this._set("near",a),this._get("far")!==b&&this._set("far",b))};a([b.property({type:Number,value:1E-8})],c.prototype,"near",null);a([b.cast("near")],c.prototype,"castNear",null);a([b.property({type:Number,value:1E-8})],c.prototype,"far",null);a([b.cast("far")],c.prototype,"castFar",null);a([b.property({type:String})],c.prototype,
"mode",void 0);return c=a([b.subclass("esri.views.3d.constraints.ClipDistanceConstraint")],c)}(b.declared(d));h.ClipDistanceConstraint=q;h.default=q})},"esri/views/3d/constraints/CollisionConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/_base/kernel ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(q,h,e,a,d,b,g){Object.defineProperty(h,"__esModule",{value:!0});q=function(b){function c(){return null!==
b&&b.apply(this,arguments)||this}e(c,b);Object.defineProperty(c.prototype,"enabled",{set:function(a){d.deprecated("SceneView.constraint.collision.enabled","Use Map.ground.navigationConstraint instead","4.8");this._set("enabled",a)},enumerable:!0,configurable:!0});a([g.property({value:!0})],c.prototype,"enabled",null);return c=a([g.subclass("esri.views.3d.constraints.CollisionConstraint")],c)}(g.declared(b));h.CollisionConstraint=q;h.default=q})},"esri/views/3d/constraints/TiltConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ../state/Constraints ../support/mathUtils".split(" "),
function(q,h,e,a,d,b,g,c){Object.defineProperty(h,"__esModule",{value:!0});var f=c.rad2deg(g.TiltDefault.min),k=c.rad2deg(g.TiltDefault.max);q=function(d){function g(){var a=null!==d&&d.apply(this,arguments)||this;a.mode="auto";return a}e(g,d);Object.defineProperty(g.prototype,"max",{get:function(){return this._get("max")},set:function(a){this._set("max",a);this.mode="manual"},enumerable:!0,configurable:!0});g.prototype.castMax=function(a){return c.clamp(a,f,k)};g.prototype.autoUpdate=function(a){"auto"===
this.mode&&this._get("max")!==a&&this._set("max",a)};a([b.property({type:String})],g.prototype,"mode",void 0);a([b.property({type:Number,value:k})],g.prototype,"max",null);a([b.cast("max")],g.prototype,"castMax",null);return g=a([b.subclass("esri.views.3d.constraints.TiltConstraint")],g)}(b.declared(d));h.TiltConstraint=q;h.default=q})},"esri/views/3d/environment/SceneViewEnvironment":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/lang ../../../core/accessorSupport/decorators ./SceneViewAtmosphere ./SceneViewLighting ../../../webscene/Environment ../../../webscene/Lighting".split(" "),
function(q,h,e,a,d,b,g,c,f,k){return function(f){function l(){var a=null!==f&&f.apply(this,arguments)||this;a.atmosphere=new g.default;return a}e(l,f);n=l;Object.defineProperty(l.prototype,"lighting",{set:function(a){if(a)if(this.lighting)null!=a.date&&(this.lighting.date=a.date),null!=a.defaultDate&&(this.lighting.defaultDate=a.defaultDate),null!=a.displayUTCOffset&&(this.lighting.displayUTCOffset=a.displayUTCOffset),this.lighting.directShadowsEnabled=a.directShadowsEnabled,null!=a.ambientOcclusionEnabled&&
(this.lighting.ambientOcclusionEnabled=a.ambientOcclusionEnabled),null!=a.cameraTrackingEnabled&&(this.lighting.cameraTrackingEnabled=a.cameraTrackingEnabled);else if(a instanceof c.default)this._set("lighting",a);else if(a instanceof k){var b={directShadowsEnabled:a.directShadowsEnabled};null!=a.date&&(b.date=a.date);null!=a.displayUTCOffset&&(b.displayUTCOffset=a.displayUTCOffset);null!=a.defaultDate&&(b.defaultDate=a.defaultDate);this._set("lighting",new c.default(b))}else this._set("lighting",
new c.default(a));else this.lighting||this._set("lighting",new c.default)},enumerable:!0,configurable:!0});l.prototype.clone=function(){return new n({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:d.clone(this.background)})};var n;a([b.property({type:g.default,json:{read:!1}})],l.prototype,"atmosphere",void 0);a([b.property()],l.prototype,"lighting",null);return l=n=a([b.subclass("esri.views.3d.environment.SceneViewEnvironment")],
l)}(b.declared(f))})},"esri/views/3d/environment/SceneViewAtmosphere":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(q,h,e,a,d,b){Object.defineProperty(h,"__esModule",{value:!0});q=function(d){function c(){return null!==d&&d.apply(this,arguments)||this}e(c,d);Object.defineProperty(c.prototype,"quality",{set:function(a){-1!==["low","high"].indexOf(a)&&
this._set("quality",a)},enumerable:!0,configurable:!0});c.prototype.clone=function(){return new this.constructor({quality:this.quality})};a([b.property({type:String,value:"low"})],c.prototype,"quality",null);return c=a([b.subclass("esri.views.3d.environment.SceneViewAtmosphere")],c)}(b.declared(d));h.SceneViewAtmosphere=q;h.default=q})},"esri/views/3d/environment/SceneViewLighting":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Evented ../../../core/accessorSupport/decorators ../../../webscene/Lighting".split(" "),
function(q,h,e,a,d,b,g){Object.defineProperty(h,"__esModule",{value:!0});q=function(d){function g(a){a=d.call(this)||this;a.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};a.cameraTrackingEnabled=!0;a.ambientOcclusionEnabled=!1;var b=(new Date).getFullYear(),b=new Date("March 15, "+b+" 12:00:00 UTC");a._set("defaultDate",b);a._set("date",b);return a}e(g,d);Object.defineProperty(g.prototype,"defaultDate",{get:function(){return new Date(this._get("defaultDate").getTime())},set:function(a){var b=
this._get("date")===this._get("defaultDate");a=new Date(a.getTime());this._set("defaultDate",a);b&&this._set("date",a)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"date",{set:function(a){null!=a&&(this._set("date",new Date(a.getTime())),this.positionTimezoneInfo.autoUpdated=!1,this._emitDateWillChange())},enumerable:!0,configurable:!0});g.prototype.autoUpdate=function(a,b){var c=this._calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=b.hours;
this.positionTimezoneInfo.minutes=b.minutes;this.positionTimezoneInfo.seconds=b.seconds;b=null;null!=a&&(this.positionTimezoneInfo.autoUpdated=!0,b=this.date&&this.date.getTime(),this._set("date",new Date(a.getTime())),this._emitDateWillChange());var d=this._calculateTimezoneOffset(this.positionTimezoneInfo);c!==d&&(k.target=this,k.timezoneOffset=d,this.emit("timezone-will-change",k));if(null!=a)return b!==a.getTime()};g.prototype._calculateTimezoneOffset=function(a){return Math.round(a.hours+a.minutes/
60+a.seconds/3600)};g.prototype._emitDateWillChange=function(){f.target=this;c.setTime(this._get("date").getTime());f.date=c;this.emit("date-will-change",f)};a([b.property({type:Boolean})],g.prototype,"cameraTrackingEnabled",void 0);a([b.property({type:Boolean})],g.prototype,"ambientOcclusionEnabled",void 0);a([b.property({type:Date})],g.prototype,"defaultDate",null);a([b.property({type:Date})],g.prototype,"date",null);return g=a([b.subclass("esri.views.3d.environment.SceneViewLighting")],g)}(b.declared(g,
d));h.SceneViewLighting=q;var c=new Date,f={target:null,date:null},k={target:null,timezoneOffset:0};h.default=q})},"esri/webscene/Lighting":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators".split(" "),function(q,h,e,a,d,b){return function(d){function c(a){a=d.call(this,a)||this;a.date=null;a.directShadowsEnabled=!1;a.displayUTCOffset=null;return a}e(c,d);f=c;c.prototype.readDate=function(a,
b){return null!=b.datetime&&new Date(b.datetime)||null};c.prototype.writeDate=function(a,b,c){b[c]=a.getTime()};c.prototype.readDirectShadowsEnabled=function(a,b){return!!b.directShadows};c.prototype.writedirectShadowsEnabled=function(a,b,c){a&&(b[c]=a)};c.prototype.writeDisplayUTCOffset=function(a,b){null!=a&&(b.displayUTCOffset=a)};c.prototype.clone=function(){return new f({date:null!=this.date?new Date(this.date.getTime()):null,directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=
this.displayUTCOffset?this.displayUTCOffset:null})};c.sanitizeJSON=function(a){var b={datetime:a.datetime};void 0!==a.directShadows&&(b.directShadows=!!a.directShadows);void 0!==a.displayUTCOffset&&(b.displayUTCOffset=a.displayUTCOffset);return b};var f;a([b.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],c.prototype,"date",void 0);a([b.reader("date",["datetime"])],c.prototype,"readDate",null);a([b.writer("date")],c.prototype,"writeDate",null);a([b.property({type:Boolean,json:{write:{target:"directShadows"}}})],
c.prototype,"directShadowsEnabled",void 0);a([b.reader("directShadowsEnabled",["directShadows"])],c.prototype,"readDirectShadowsEnabled",null);a([b.writer("directShadowsEnabled")],c.prototype,"writedirectShadowsEnabled",null);a([b.property({type:Number,json:{write:!0}})],c.prototype,"displayUTCOffset",void 0);a([b.writer("displayUTCOffset")],c.prototype,"writeDisplayUTCOffset",null);return c=f=a([b.subclass("esri.webscene.Lighting")],c)}(b.declared(d))})},"esri/webscene/Environment":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ./Lighting ./background/utils".split(" "),
function(q,h,e,a,d,b,g,c,f){var k=function(a,b,c){return{enabled:!c||!c.isPresentation}};return function(d){function l(a){a=d.call(this,a)||this;a.lighting=new c;a.background=null;a.atmosphereEnabled=!0;a.starsEnabled=!0;return a}e(l,d);n=l;l.prototype.clone=function(){return new n({lighting:c.prototype.clone.call(this.lighting),background:b.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled})};l.sanitizeJSON=function(a){return{lighting:a.lighting?c.sanitizeJSON(a.lighting):
(new c).toJSON(),background:a.background,atmosphereEnabled:a.atmosphereEnabled,starsEnabled:a.starsEnabled}};var n;a([g.property({type:c,json:{write:!0}})],l.prototype,"lighting",void 0);a([g.property(f.backgroundProperty)],l.prototype,"background",void 0);a([g.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:k}}})],l.prototype,"atmosphereEnabled",void 0);a([g.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:k}}})],l.prototype,"starsEnabled",void 0);return l=n=a([g.subclass("esri.webscene.Environment")],
l)}(g.declared(d))})},"esri/webscene/background/utils":function(){define(["require","exports","./Background","./ColorBackground"],function(q,h,e,a){Object.defineProperty(h,"__esModule",{value:!0});q={base:e,key:"type",typeMap:{color:a}};h.backgroundProperty={types:q,json:{read:function(a){return function(b,d,c){if(!b)return b;for(var f in a.typeMap)if(b.type===f)return d=new a.typeMap[f],d.read(b,c),d}}(q),write:{overridePolicy:function(a,b,g){return{enabled:!g||!g.isPresentation}}}}}})},"esri/webscene/background/Background":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(q,h,e,a,d,b,g){return function(b){function c(a){return b.call(this)||this}e(c,b);c.prototype.normalizeCtorArgs=function(a){a&&a.type&&(a=d({},a),delete a.type);return a};c.prototype.clone=function(){};a([g.property({type:String,readOnly:!0,json:{read:!1,write:!0}})],c.prototype,"type",void 0);return c=a([g.subclass("esri.webscene.background.Background")],c)}(g.declared(b))})},"esri/webscene/background/ColorBackground":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../Color ../../core/accessorSupport/decorators ../../symbols/support/materialUtils ./Background".split(" "),
function(q,h,e,a,d,b,g,c,f){var k=d({},c.colorAndTransparencyProperty,{nonNullable:!0});return function(c){function d(a){a=c.call(this)||this;a.type="color";a.color=new b([0,0,0,1]);return a}e(d,c);f=d;d.prototype.clone=function(){return new f(this.cloneProperties())};d.prototype.cloneProperties=function(){return{color:this.color.clone()}};var f;a([g.property({type:String,readOnly:!0})],d.prototype,"type",void 0);a([g.property(k)],d.prototype,"color",void 0);return d=f=a([g.subclass("esri.webscene.background.ColorBackground")],
d)}(g.declared(f))})},"esri/views/3d/environment/SceneViewEnvironmentManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/Accessor ../../../core/Evented ../../../core/Handles ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/webMercatorUtils ./EnvironmentRenderer ../lib/glMatrix ../support/earthUtils ../support/sunUtils ../webgl-engine/lighting/Lightsources ../../../webscene/background/ColorBackground".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u,x,v,A){Object.defineProperty(h,"__esModule",{value:!0});var y=[.5773502691896258,-.5773502691896258,.5773502691896258];q=function(b){function g(a){a=b.call(this)||this;a.referencePointUpdateDelay=200;a.referencePointUpdateInterval=3E3;a.referencePointUpdateDistThreshold=1E6;a._referencePosUpdateQuery=null;a._referencePosMapCoordsRequested=null;a._viewHandles=new c;a._preserveAbsoluteDateTime=!1;a._trackingEnabled=!1;a._viewConnected=!1;a._referencePosResetPreserveAbsoluteTime=
!1;a._referencePosUpdateTimer=null;a._referencePosWGS84=null;a._referencePosMapCoords=null;a._mainLight=new v.MainLight;a._ambientLight=new v.AmbientLight;a._moonLight=new v.FillLight;a._environmentRenderer=null;a._resetReferencePosition();return a}e(g,b);g.prototype.destroy=function(){this._viewHandles.destroy();this.disposeRendering()};Object.defineProperty(g.prototype,"updating",{get:function(){return!this.noReferencePositionQueries&&(!!this._referencePosUpdateQuery||!!this._referencePosMapCoordsRequested)},
enumerable:!0,configurable:!0});g.prototype.updateReadyChange=function(a){a&&!this._viewConnected?(this._viewConnected=!0,this.connectView(this.view)):!a&&this._viewConnected&&(this._viewConnected=!1,this.disconnectView(this.view))};g.prototype.disposeRendering=function(){this._environmentRenderer&&(this._environmentRenderer.destroy(),this._environmentRenderer=null);this._resetReferencePosition(!0)};g.prototype.connectView=function(a){this._environmentRenderer=new r({view:a});this._viewHandles.add([k.on(this.view,
"environment.lighting","date-will-change",this._lightingDateHandler.bind(this)),this.view.watch("interacting,stationary",this._interactingStationaryHandler.bind(this)),this.view.watch(["environment.lighting.directShadowsEnabled","environment.lighting.ambientOcclusionEnabled","environment.background.color"],this._updateRenderParamsHandler.bind(this)),this.view.watch("spatialReference",this._spatialReferenceHandler.bind(this)),k.init(this.view,"viewingMode",this._viewingModeHandler.bind(this)),k.init(this.view,
"environment.lighting.cameraTrackingEnabled",this._updateCameraTracking.bind(this),!0),this.watch("noReferencePositionQueries",this._cameraHandler.bind(this,null))]);this._updateRenderParamsHandler();this._updateLightParams();this._cameraHandler()};g.prototype._updateCameraTracking=function(a){if(this._trackingEnabled=a)a=k.init(this,"view.state.camera",this._cameraHandler.bind(this,null),!0),this._viewHandles.add(a,"camera");else{if(a=this.get("view.environment.lighting"))a.positionTimezoneInfo.autoUpdated=
!1;this._viewHandles.remove("camera")}};g.prototype.disconnectView=function(a){this.disposeRendering();this._viewHandles.removeAll()};g.prototype._lightingDateHandler=function(a){if(a=a.date){var b=this.view.environment.lighting;if(!b.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;var c=this.view.spatialReference;if(!(c.isWGS84||c.isWebMercator||(c=this.view.camera.position,this._referencePosMapCoords&&this._referencePosMapCoords.equals(c)))){this._requestReferencePositionUpdate(c);
return}this._preupdateTracking(a);this._referencePosWGS84&&(c=u.positionToTimezone(this._referencePosWGS84,B),b.autoUpdate(null,c),this._trackingEnabled&&(b.positionTimezoneInfo.autoUpdated=!0))}this._updateLightParams(a)}};g.prototype._preupdateTracking=function(a){!this._trackingEnabled&&this.get("view.environment.lighting.cameraTrackingEnabled")&&this._cameraHandler(a)};g.prototype._cameraHandler=function(a){void 0===a&&(a=null);if(this.view.ready){var b=this.view.camera;if(b){var c=this.view.spatialReference;
c.isWGS84||c.isWebMercator?this._cameraHandlerGlobal(b,a):this._cameraHandlerLocal(b,a)}}};g.prototype._cameraHandlerGlobal=function(a,b){a=a.position;this._referencePosWGS84||(this._referencePosWGS84=new l({spatialReference:p.WGS84}));a.spatialReference.isWebMercator?m.webMercatorToGeographic(a,!1,this._referencePosWGS84):(this._referencePosWGS84.x=a.x,this._referencePosWGS84.y=a.y);this._referencePosWGS84.z=a.z;this._autoUpdateTimezone(a,b)||this._updateLightParams(b)};g.prototype._cameraHandlerLocal=
function(a,b){a=a.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(a))&&this._requestReferencePositionUpdate(a,!0);this.view.mapCoordsHelper&&this._referencePosWGS84&&(this._referencePosWGS84.z=a.z*this.view.mapCoordsHelper.unitInMeters,this._referencePosChanged())};g.prototype._interactingStationaryHandler=function(){!this.view.interacting&&this.view.stationary&&this._executePendingReferencePositionUpdate()};g.prototype._updateLightParams=
function(a){void 0===a&&(a=null);var b=this.view.environment.lighting;a=a||b.date;var b=this.view._stage,c;this._referencePosWGS84?(c=x.computeColorAndIntensity(a,this._referencePosWGS84),x.computeDirection(a,this._referencePosWGS84,this.view.viewingMode,c.diffuse.direction)):c={diffuse:{color:[1,1,1],intensity:.55,direction:y},ambient:{color:[1,1,1],intensity:.55},noonFactor:.5,globalFactor:0};t.vec3d.scale(c.diffuse.color,c.diffuse.intensity*Math.PI,this._mainLight.intensity);t.vec3d.negate(c.diffuse.direction,
this._mainLight.direction);t.vec3d.scale(c.ambient.color,c.ambient.intensity,this._ambientLight.intensity);t.vec3d.lerp(D,E,c.globalFactor,this._moonLight.intensity);t.vec3d.scale(this._moonLight.intensity,(1-.5*c.globalFactor)*(1-.4*c.noonFactor*(1-c.globalFactor)));t.vec3d.set(c.diffuse.direction,this._moonLight.direction);b.setLighting({lights:[this._mainLight,this._ambientLight,this._moonLight],globalFactor:c.globalFactor,groundLightingFactor:1-c.noonFactor});this._updateRenderParamsHandler()};
g.prototype._autoUpdateTimezone=function(a,b){void 0===b&&(b=null);if(!this.view.get("environment.lighting.cameraTrackingEnabled"))return!1;var c=C;c.setTime((b||this.view.environment.lighting.date).getTime());a=u.positionToTimezone(a,B);var d=this.view.environment.lighting.positionTimezoneInfo;if(!d.autoUpdated)d=a;else if(d.hours===a.hours&&d.minutes===a.minutes&&d.seconds===a.seconds)return!1;var f=c.getUTCHours()-(a.hours-d.hours),v=c.getUTCMinutes()-(a.minutes-d.minutes),d=c.getUTCSeconds()-
(a.seconds-d.seconds);c.setUTCHours(f);c.setUTCMinutes(v);c.setUTCSeconds(d);return b?!1:this.view.environment.lighting.autoUpdate(c,a)};g.prototype._updateRenderParamsHandler=function(){var a=this.view._stage,b=!0;this._referencePosWGS84&&(b=x.computeShadowsEnabled(this._referencePosWGS84,this.view.viewingMode));var c=this.view.environment.background,c=c instanceof A?{type:"color",color:d.toUnitRGBA(c.color)}:{type:"color",color:[0,0,0,1]};a&&a.setRenderParams({shadowMap:this.view.environment.lighting.directShadowsEnabled&&
b,ssao:this.view.environment.lighting.ambientOcclusionEnabled,background:c})};g.prototype._spatialReferenceHandler=function(){this._resetReferencePosition()};g.prototype._viewingModeHandler=function(){this._resetReferencePosition()};g.prototype._resetReferencePosition=function(a){void 0===a&&(a=!1);this._cancelReferencePosUpdates();this._referencePosWGS84=this._referencePosResetPreserveAbsoluteTime=this._referencePosMapCoordsRequested=this._referencePosMapCoords=null;a||this.notifyChange("updating")};
g.prototype._requestReferencePositionUpdate=function(a,b){var c=this;void 0===b&&(b=!1);if(this.view.mapCoordsHelper.canProject()&&!this.noReferencePositionQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(a):this._referencePosMapCoordsRequested=a.clone(),this._referencePosResetPreserveAbsoluteTime=!!b,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&!this.view.interacting&&this.view.stationary)){var d=this._referencePosUpdateQuery=f.after(this.referencePointUpdateDelay).then(function(){if(c._referencePosUpdateQuery===
d)return c._doReferencePositionUpdateQuery(function(){return c._referencePosUpdateQuery!==d})}).always(function(){c._referencePosUpdateQuery===d&&(c._referencePosUpdateQuery=null,c._referencePosUpdateTimer||c._executePendingReferencePositionUpdate(),c.notifyChange("updating"))}),v=this._referencePosUpdateTimer=f.after(this.referencePointUpdateInterval).then(function(){c._referencePosUpdateTimer===v&&(c._referencePosUpdateTimer=null,c._referencePosUpdateQuery||c._executePendingReferencePositionUpdate())});
this.notifyChange("updating")}};g.prototype._doReferencePositionUpdateQuery=function(a){var b=this;this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1);this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone();this._referencePosMapCoordsRequested=this._referencePosResetPreserveAbsoluteTime=null;return this.view.mapCoordsHelper.toGeographic(this._referencePosMapCoords).then(function(c){if(!a()&&
!isNaN(c[0])&&!isNaN(c[1])){var d=b._referencePosMapCoords.z*b.view.mapCoordsHelper.unitInMeters;b._referencePosWGS84?(b._referencePosWGS84.x=c[0],b._referencePosWGS84.y=c[1],b._referencePosWGS84.z=d):b._referencePosWGS84=new l({x:c[0],y:c[1],z:d,spatialReference:p.WGS84});b._referencePosChanged()}})};g.prototype._executePendingReferencePositionUpdate=function(){var a=this._referencePosMapCoordsRequested;a&&this._requestReferencePositionUpdate(a,this._referencePosResetPreserveAbsoluteTime)};g.prototype._referencePosChanged=
function(){this._preserveAbsoluteDateTime?this._updateLightParams():this._autoUpdateTimezone(this._referencePosWGS84)||this._updateLightParams()};g.prototype._exceedsReferencePosDistThreshold=function(a){return this._referencePosMapCoords?(a=this._referencePosMapCoords.distance(a),this.view.mapCoordsHelper&&(a*=this.view.mapCoordsHelper.unitInMeters),a>this.referencePointUpdateDistThreshold):!0};g.prototype._cancelReferencePosUpdates=function(){this._referencePosUpdateTimer=this._referencePosUpdateQuery=
null};g.FIXED_LIGHT_DIRECTION=y;a([n.property({type:Boolean,dependsOn:["noReferencePositionQueries"],readOnly:!0})],g.prototype,"updating",null);a([n.property()],g.prototype,"noReferencePositionQueries",void 0);a([n.property({constructOnly:!0})],g.prototype,"view",void 0);a([n.property()],g.prototype,"_environmentRenderer",void 0);return g=a([n.subclass("esri.views.3d.environment.SceneViewEnvironmentManager")],g)}(n.declared(b,g));h.SceneViewEnvironmentManager=q;var C=new Date,B={hours:0,minutes:0,
seconds:0},D=t.vec3d.createFrom(.22,.22,.33),E=t.vec3d.createFrom(.22,.22,.22);h.default=q})},"esri/views/3d/environment/EnvironmentRenderer":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators ./PanoramicAtmosphere ./RealisticAtmosphere ./SimpleAtmosphere ./Stars ../webgl-engine/lib/RenderSlot".split(" "),function(q,h,e,
a,d,b,g,c,f,k,n,l,p){var m=[p.POSTPROCESSING_ATMOSPHERE_OPAQUE,p.POSTPROCESSING_ATMOSPHERE_TRANSPARENT];return function(d){function p(){var a=null!==d&&d.apply(this,arguments)||this;a.needsRender=!1;a.didRender=!0;a._handles=new b;a._initContext=null;a._atmosphereReadyPromise=null;a._atmosphere=null;a._stars=null;return a}e(p,d);p.prototype.initialize=function(){this.view._stage.addExternalRenderer(m,this)};p.prototype.destroy=function(){this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=
null);this._stars&&(this._stars.destroy(),this._stars=null);this._handles&&this._handles.removeAll();this.view&&(this.view._stage.removeExternalRenderer(this),this.view=null)};p.prototype.initializeRenderContext=function(a){this._initContext=a;this.setup(a)};p.prototype.setup=function(a){var b=this;this._handles.add(g.when(this.view,"basemapTerrain",function(){return b._updateBasemapTerrain()}));this._handles.add([g.init(this.view,["viewingMode","environment.atmosphereEnabled","environment.atmosphere.quality"],
function(){return b._updateAtmosphere()}),g.init(this.view,"environment.starsEnabled",function(){return b._updateStars()})])};p.prototype.uninitializeRenderContext=function(a){this._stars&&(this._stars.uninitializeRenderContext(a),this._stars.destroy(),this._stars=null);this._atmosphere&&(this._atmosphere.uninitializeRenderContext(a),this._atmosphere.destroy(),this._atmosphere=null)};p.prototype.render=function(a){var b=this.view.basemapTerrain;if(!(b&&b.loaded||"global"!==this.view.viewingMode))return!1;
b=!0;this._stars&&(b=this._stars.render(a)&&b);this._atmosphere&&(b=this._atmosphere.render(a)&&b);return b};p.prototype._updateStars=function(){var a=this.view.get("environment.starsEnabled")||!1;a&&!this._stars?(this._stars=new l(this.view),this._stars.initializeRenderContext(this._initContext),this.needsRender=!0):!a&&this._stars&&(this._stars.destroy(),this._stars=null,this.needsRender=!0)};p.prototype._updateAtmosphere=function(){var a=this,b=this._getAtmosphereType(this._initContext);if(this.atmosphereType!==
b){this.atmosphereType=b;var c=null;switch(b){case "realistic":c=k;break;case "panoramic":c=f;break;case "simple":c=n}if(c){var d=new c(this.view);this._atmosphereReadyPromise&&(this._atmosphereReadyPromise.cancel(),this._atmosphereReadyPromise=null);d.initializeRenderContext(this._initContext);null==this._atmosphere&&(this._atmosphere=d,this.needsRender=!0);this._atmosphereReadyPromise=d.when(function(){a._atmosphere!==d&&(a._atmosphere&&(a._atmosphere.destroy(),a._atmosphere=null),a._atmosphere=
d);a._atmosphereReadyPromise=null;a.needsRender=!0;a._updateBasemapTerrain()})}else this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=null),this._updateBasemapTerrain()}};p.prototype._getAtmosphereType=function(a){var b=this.view.get("environment.atmosphereEnabled"),c=this.view.get("environment.atmosphere.quality"),d=this.view.viewingMode;return b&&null!=c?"local"===d?"panoramic":"high"===c&&k.isSupported(a)?"realistic":"simple":"none"};p.prototype._updateBasemapTerrain=function(){var a=
this.view.basemapTerrain;a&&(a.velvetOverground=null!=this._atmosphere&&"simple"===this.atmosphereType)};a([c.property()],p.prototype,"view",void 0);return p=a([c.subclass("esri.views.3d.environment.EnvironmentRenderer")],p)}(c.declared(d))})},"esri/views/3d/environment/PanoramicAtmosphere":function(){define("require exports dojo/text!./materials/SimpleAtmosphereMaterial.xml ./resources/SimpleAtmosphereTexture ../lib/glMatrix ../support/imageUtils ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/GeometryRenderer ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/Util ../../webgl/Program ../../webgl/Texture".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r){var t=d.mat4d,u=p.VertexAttrConstants,x=t.create();return function(){function d(a){this.view=null;this.needsRender=!1;this.didRender=!0;this.slot=l.POSTPROCESSING_ATMOSPHERE_OPAQUE;this._readyPromise=this._program=this._texture=this._renderer=null;this.view=a}d.prototype.destroy=function(){this._program&&(this._program.dispose(),this._program=null);this._texture&&(this._texture.dispose(),this._texture=null)};d.prototype.when=function(a){return this._readyPromise.then(a)};
d.prototype.initializeRenderContext=function(d){var v=this,k=this._createGeometryData(),l=d.rctx;this._renderer=new f(k,c.Pos3,null,l);d.shaderSnippets.vsSimpleAtmosphere||d.shaderSnippets._parse(e);this._program=new m(l,d.shaderSnippets.vsSimpleAtmosphere,d.shaderSnippets.fsSimpleAtmosphere,g.Default3D,["PANORAMIC"]);this._readyPromise=b.requestImage(a).then(function(a){v._texture=new r(d.rctx,{pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},a);v.needsRender=!0})};d.prototype.uninitializeRenderContext=
function(a){this.destroy()};d.prototype.render=function(a){if(a.slot!==this.slot||a.pass!==n.MATERIAL||null==this._texture)return!1;var b=a.rctx,c=b.gl,d=this._program;b.bindProgram(d);b.bindTexture(this._texture);d.setUniform1i("tex",0);d.setUniformMatrix4fv("proj",a.camera.projectionMatrix);t.toRotationMat(a.camera.viewMatrix,x);d.setUniformMatrix4fv("view",x);d.setUniform4f("color",1,1,1,1);d.setUniform3fv("lightDirection",a.lightingData.direction);b.setDepthTestEnabled(!0);b.setFaceCullingEnabled(!0);
b.setDepthFunction(c.LEQUAL);b.setBlendingEnabled(!0);b.setDepthWriteEnabled(!1);this._renderer.render(this._program);b.setDepthWriteEnabled(!0);b.setBlendingEnabled(!1);b.setDepthFunction(c.LESS);b.setFaceCullingEnabled(!1);return!0};d.prototype._createGeometryData=function(){for(var a=k.createPolySphereGeometry(1,2,!1),b=a.indices[u.POSITION],c=0;c<b.length;c+=3){var d=b[c];b[c]=b[c+2];b[c+2]=d}b=a.getVertexAttr();d=b[u.NORMAL].data;for(c=0;c<d.length;c++)d[c]=-d[c];return{id:"panoramicatmosphere",
indices:a.indices,vertexAttr:b,preinterleaved:!1}};return d}()})},"esri/views/3d/environment/resources/SimpleAtmosphereTexture":function(){define(["require","exports"],function(q,h){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAAB3RJTUUH4QkLDx4bnqU2+QAAAd1JREFUSMd9lkmWxDAIQ/Xluv+V0wuDjaeuhV+IGQUoJUnNwGfAVvx+lsBCWJIsCaMpQn8nuhgqyyEzbAX1Ih0oHaQZN5X5jul581diaDVbSgAdZv1YLoCLyn/RruCsOdcqR7RS/jXkLMa9UddcDn9O7G8gwprzs6xbQl/Fns3BE90r9veQ/wzNrTM5p1yDF1yokLCosDX5kik1lxeSWxfWsihN/lZcHuPIOuhccZ4Ovt74qQK3USkFzsQx7Ki5NgqoMI1J5ILztr9UrGoGHN2qnSEwOHiD97ByDghs/KIVYp9DfdIIoJPcBkWWnM2O2s5ru3su+8GdPLhM5048r/09UDsZmJ3HRwe5MT/aA9Ul4cG74+lIvICYlZcFY42B6vAzuz/HEVn5VbP3DDgQ7xuAGZtnI76cEkbPczDDgSMDR8iFkfBMTQV728mnsx84GopNWZxQsWJxbI9pD0hmNAzWB8bun41hRk+3mNlRFvbY86mcMEVCWWAX+xJbERJHWVPP3Wkq91uyDtuKDLrYNKLl7bww6rZulo3jnafyePJ64ZZi67aEl0MkbJtTbE1h+2vIzVOU3JwWISrNyNtfi+9xqECIXZk87ODcEMeBhjj41GN1Xf+DzP9c9UmPd39C1BID2rDpAwAAAABJRU5ErkJggg\x3d\x3d"})},
"esri/views/3d/support/imageUtils":function(){define(["require","exports","../../../request"],function(q,h,e){Object.defineProperty(h,"__esModule",{value:!0});h.dataURItoBlob=function(a){var d=atob(a.split(",")[1]);a=a.split(",")[0].split(":")[1].split(";")[0];for(var b=new ArrayBuffer(d.length),g=new Uint8Array(b),c=0;c<d.length;c++)g[c]=d.charCodeAt(c);return new Blob([b],{type:a})};h.requestImage=function(a){return e(a,{responseType:"image",allowImageDataAccess:!0}).then(function(a){return a.data})}})},
"esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":function(){define(["require","exports"],function(q,h){Object.defineProperty(h,"__esModule",{value:!0});h.Default3D={position:0,normal:1,normalCompressed:1,uv0:2,color:3,instanceColor:3,size:4,auxpos1:5,symbolColor:5,componentIndex:5,auxpos2:6,featureAttribute:6,instanceFeatureAttribute:6,region:7,model:8,modelNormal:12,modelOriginHi:11,modelOriginLo:15}})},"esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":function(){define(["require",
"exports"],function(q,h){Object.defineProperty(h,"__esModule",{value:!0});h.Pos3=[{name:"position",count:3,type:5126,offset:0,stride:12,normalized:!1}];h.Pos3Tex=[{name:"position",count:3,type:5126,offset:0,stride:20,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:20,normalized:!1}];h.Pos3Col=[{name:"position",count:3,type:5126,offset:0,stride:16,normalized:!1},{name:"color",count:4,type:5121,offset:12,stride:16,normalized:!1}];h.Pos2=[{name:"position",count:2,type:5126,offset:0,stride:8,
normalized:!1}];h.Pos2Tex=[{name:"position",count:2,type:5126,offset:0,stride:16,normalized:!1},{name:"uv0",count:2,type:5126,offset:8,stride:16,normalized:!1}]})},"esri/views/3d/webgl-engine/lib/GeometryRenderer":function(){define("require exports ./DefaultVertexAttributeLocations ./Util ../materials/internal/MaterialUtil ../../../webgl/BufferObject ../../../webgl/Util ../../../webgl/VertexArrayObject".split(" "),function(q,h,e,a,d,b,g,c){return function(){function f(f,n,l,p){this._drawMode=4;this._count=
f.indices[a.VertexAttrConstants.POSITION].length;var k=new Float32Array(this._count*g.getStride(n)/4);l?l(f,void 0,void 0,null,n,k,0):d.fillInterleaved(f,void 0,void 0,null,n,k,0);this._rctx=p;this._vao=new c(p,e.Default3D,{geometry:n},{geometry:b.createVertex(p,35044,k)})}f.prototype.enablePointRendering=function(a){this._drawMode=a?0:4};f.prototype.render=function(a){var b=this._rctx;b.bindVAO(this._vao);g.assertCompatibleVertexAttributeLocations(this._vao,a);b.drawArrays(this._drawMode,0,this._count)};
return f}()})},"esri/views/3d/webgl-engine/lib/Util":function(){define(["require","exports","../../support/geometryUtils","./gl-matrix"],function(q,h,e,a){function d(a,b){if(!a)throw a=Error("dummy"),a.stack&&console.log(a.stack),new L(b);}function b(a,b,c){return a<b?b:a>c?c:a}function g(a){return a/180*Math.PI}function c(a){return 180*a/Math.PI}function f(b,c,d){a.mat4d.multiply(c,b,t);a.mat4d.inverse(t);for(b=0;8>b;++b)a.mat4d.multiplyVec4(t,u[b],x),a.vec3d.set3(x[0]/x[3],x[1]/x[3],x[2]/x[3],d[b])}
function k(a,b){e.plane.fromPoints(a[4],a[0],a[3],b[0]);e.plane.fromPoints(a[1],a[5],a[6],b[1]);e.plane.fromPoints(a[4],a[5],a[1],b[2]);e.plane.fromPoints(a[3],a[2],a[6],b[3]);e.plane.fromPoints(a[0],a[1],a[2],b[4]);e.plane.fromPoints(a[5],a[4],a[7],b[5])}function n(a,b,c,d){var f=6378137/Math.sqrt(1-h.ECCENTRICITY_SQUARED*Math.pow(Math.sin(a),2)),v=Math.cos(a);d[0]=(f+c)*Math.cos(b)*v;d[1]=(f*(1-h.ECCENTRICITY_SQUARED)+c)*Math.sin(a);d[2]=-(f+c)*Math.sin(b)*v}function l(a){for(var b in a)return b}
function p(a,b){a[12]=b[0];a[13]=b[1];a[14]=b[2]}function m(a,b){void 0===b&&(b=0);for(var c=0,d=0;4>d;d++)c+=a[b+d]*S[d];return c}function r(a){return a-Math.floor(a)}Object.defineProperty(h,"__esModule",{value:!0});var t=a.mat4d.create(),u=[a.vec4d.createFrom(-1,-1,-1,1),a.vec4d.createFrom(1,-1,-1,1),a.vec4d.createFrom(1,1,-1,1),a.vec4d.createFrom(-1,1,-1,1),a.vec4d.createFrom(-1,-1,1,1),a.vec4d.createFrom(1,-1,1,1),a.vec4d.createFrom(1,1,1,1),a.vec4d.createFrom(-1,1,1,1)],x=a.vec4d.create(),v=
[a.vec3d.create(),a.vec3d.create(),a.vec3d.create(),a.vec3d.create(),a.vec3d.create(),a.vec3d.create(),a.vec3d.create(),a.vec3d.create()],A=a.vec3d.create(),y=a.vec3d.create(),C=a.vec3d.create(),B=a.vec3d.create(),D=a.vec3d.create(),E=a.vec3d.create(),J=a.vec3d.create(),F=a.vec3d.create(),M=a.vec3d.create(),H=a.vec3d.create(),I=a.vec3d.create(),K=a.vec3d.create(),O=a.vec3d.create(),P=a.vec3d.createFrom(0,0,0),L=function(){function a(a){this.message=a}a.prototype.toString=function(){return"AssertException: "+
this.message};return a}();h.AssertException=L;h.EARTH_RADIUS=6378137;h.METER2FEET=3.28084;h.ECCENTRICITY_SQUARED=.0066943799901414;h.VertexAttrConstants={POSITION:"position",NORMAL:"normal",NORMALCOMPRESSED:"normalCompressed",UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",COLOR:"color",SYMBOLCOLOR:"symbolColor",SIZE:"size",REGION:"region",COMPONENTINDEX:"componentIndex"};h.assert=d;h.verify=function(a,b){a||(console.log("Verify failed: "+b),console.log(Error("dummy").stack))};h.isPowerOfTwo=function(a){return 0===
(a&a-1)};h.lerp=function(a,b,c){return a+(b-a)*c};h.clamp=b;h.encodeInt16=function(a){return b(Math.round(32767*a),-32767,32767)};h.encodeNormal=function(a,b){var c=Math.abs(a[0]),d=Math.abs(a[1]),f=1/(c+d+Math.abs(a[2])),c=c*f,d=d*f,f=Math.min(a[2]*f,0);b[0]=U(a[0])*(c-f);b[1]=U(a[1])*(d-f)};var U="function"===typeof Math.sign?Math.sign:function(a){return+(0<a)-+(0>a)||0};h.fallbackIfUndefined=function(a,b){return void 0===a?b:a};h.hex2rgb=function(a){a=Math.floor(a);return[(a>>16&255)/255,(a>>8&
255)/255,(a&255)/255]};h.rgb2hex=function(a){var c=b(Math.round(255*a[0]),0,255),d=b(Math.round(255*a[1]),0,255);a=b(Math.round(255*a[2]),0,255);return"0x"+((c<<16)+(d<<8)+a).toString(16)};h.dec2hex=function(a){a=a.toString(16);return"00000000".substr(0,8-a.length)+a};h.deg2rad=g;h.rad2deg=c;h.azimuthElevationAngle2Direction=function(a,b){a=1.5*Math.PI-a;b=.5*Math.PI-b;return[Math.cos(a)*Math.sin(b),Math.cos(b),Math.sin(a)*Math.sin(b)]};h.raySphere=function(b,c,d,f,v){d=d||P;var g=a.vec3d.subtract(b,
d,A);d=a.vec3d.dot(c,c);var k=2*a.vec3d.dot(c,g);f=a.vec3d.dot(g,g)-f*f;f=k*k-4*d*f;if(0>f)return!1;g=Math.sqrt(f);f=(-k-g)/(2*d);d=(-k+g)/(2*d);if(0>f||d<f&&0<d)f=d;return 0<f?(v&&a.vec3d.add(b,a.vec3d.scale(c,f,O),v),!0):!1};h.rayTriangle3D=function(b,c,d,f,v,g,k,m,l){void 0===l&&(l=a.vec3d.create());var n=f[k]-d[g],e=f[k+1]-d[g+1],p=f[k+2]-d[g+2];f=v[m]-d[g];k=v[m+1]-d[g+1];v=v[m+2]-d[g+2];var A=c[1]*v-k*c[2],u=c[2]*f-v*c[0],r=c[0]*k-f*c[1];m=n*A+e*u+p*r;if(-1E-5<m&&1E-5>m)return!1;m=1/m;var t=
b[0]-d[g],y=b[1]-d[g+1];b=b[2]-d[g+2];l[1]=m*(t*A+y*u+b*r);if(0>l[1]||1<l[1])return!1;d=y*p-e*b;b=b*n-p*t;n=t*e-n*y;l[2]=m*(c[0]*d+c[1]*b+c[2]*n);if(0>l[2]||1<l[1]+l[2])return!1;l[0]=m*(f*d+k*b+v*n);return!0};h.rayBoxTest=function(a,b,c,d){var f,v=(c[0]-a[0])/b[0],g=(d[0]-a[0])/b[0];v>g&&(f=v,v=g,g=f);var k=(c[1]-a[1])/b[1],m=(d[1]-a[1])/b[1];k>m&&(f=k,k=m,m=f);if(v>m||k>g)return!1;k>v&&(v=k);m<g&&(g=m);c=(c[2]-a[2])/b[2];a=(d[2]-a[2])/b[2];c>a&&(f=c,c=a,a=f);if(v>a||c>g)return!1;a<g&&(g=a);return 0>
g?!1:!0};h.rayRay2D=function(b,c,d,f,v,g){void 0===g&&(g=a.vec2d.create());var k=(f[v]-d[v])*(c[0]-b[0])-(f[0]-d[0])*(c[v]-b[v]);if(0===k)return!1;d=((f[0]-d[0])*(b[v]-d[v])-(f[v]-d[v])*(b[0]-d[0]))/k;g[0]=b[0]+d*(c[0]-b[0]);g[1]=b[v]+d*(c[v]-b[v]);return!0};h.matrixToFrustumPoints=f;h.matrixToFrustumPlanes=function(a,b,c,d){void 0===d&&(d=c,c=v);f(a,b,c);k(c,d)};h.frustumPointsToPlanes=k;h.project=function(b,c,f,v,g){g||(g=b);x[0]=b[0];x[1]=b[1];x[2]=b[2];x[3]=1;a.mat4d.multiplyVec4(c,x);2<g.length&&
(g[2]=-x[2]);a.mat4d.multiplyVec4(f,x);d(0!==x[3]);g[0]=x[0]/x[3];g[1]=x[1]/x[3];g[2]=x[2]/x[3];g[0]=(.5*g[0]+.5)*v[2]+v[0];g[1]=(.5*g[1]+.5)*v[3]+v[1]};h.geodeticToGeocentricLatidude=function(a){return Math.atan((1-h.ECCENTRICITY_SQUARED)*Math.tan(a))};h.latLon2positionWGS84Ellipsoid=n;h.pos2latLon=function(d,f){var v=a.vec3d.length(d);f[0]=Math.asin(b(d[1]/v,-1,1));f[1]=(0>d[2]?1:-1)*Math.acos(b(d[0]/(Math.cos(f[0])*v),-1,1));f[0]=c(f[0]);f[1]=c(f[1]);f[2]=v};h.pos2latLonWGS84Ellipsoid=function(a,
b){var c=a[0],d=-a[2],f=a[1],v=Math.sqrt(Math.pow(6378137,2)*(1-h.ECCENTRICITY_SQUARED));a=Math.sqrt(Math.pow(c,2)+Math.pow(d,2));var g=Math.atan2(6378137*f,v*a),c=Math.atan2(d,c),d=Math.atan2(f+Math.pow(Math.sqrt((Math.pow(6378137,2)-Math.pow(v,2))/Math.pow(v,2)),2)*v*Math.pow(Math.sin(g),3),a-6378137*h.ECCENTRICITY_SQUARED*Math.pow(Math.cos(g),3));a=a/Math.cos(d)-6378137/Math.sqrt(1-h.ECCENTRICITY_SQUARED*Math.pow(Math.sin(d),2))+h.EARTH_RADIUS;b[0]=d;b[1]=c;b[2]=a};h.computeGlobeTransformation=
function(b,c,d){var f=g(b[0]);b=g(b[1]);n(f,b,c,y);a.mat4d.translate(d,y);a.mat4d.rotateY(d,.5*Math.PI+b);a.mat4d.rotateX(d,.5*Math.PI-f);return d};h.readUInt16=function(a,b){return a[b]+(a[b+1]<<8)};h.readUInt32=function(a,b){return a[b]+(a[b+1]<<8)+(a[b+2]<<16)+(a[b+3]<<24)};h.setIfDefined=function(a,b,c){void 0!==b[a]&&(c[a]=b[a])};h.array2object=function(a,b){var c={};if(void 0!==b)for(var d=0;d<a.length;d++){var f=a[d];c[b(f)]=f}else for(b=0;b<a.length;b++)f=a[b],c[f]=f;return c};h.object2array=
function(a){var b=[],c;for(c in a)b.push(a[c]);return b};h.mergeObjects=function(a,b,c){void 0===c&&(c={});if(c!==a)for(var d in a)c[d]=a[d];if(c!==b)for(var f in b)c[f]=b[f];return c};h.subtractObjects=function(a,b){var c={},d;for(d in a)void 0===b[d]&&(c[d]=a[d]);return c};h.intersectObjects=function(a,b){var c={},d;for(d in a)void 0!==b[d]&&(c[d]=a[d]);return c};h.getFirstObjectKey=l;h.getFirstObjectValue=function(a){return a[l(a)]};h.objectEmpty=function(a){for(var b in a)return!1;return!0};h.byteBuffer2base64image=
function(a,b,c,f,v){var g=4*b;d(a.length===g*c,"buffer length must match image resolution");var k=document.createElement("canvas");k.width=b;k.height=c;var m=k.getContext("2d");b=m.getImageData(0,0,b,c);for(var l=b.data,n=0;n<c;++n)for(var e=n*g,p=(c-1-n)*g,A=0;A<g;++A)l[e++]=a[p++];m.putImageData(b,0,0);return k.toDataURL(f,v)};h.cround=function(a){return Math.round(100*a)/100};h.logWithBase=function(a,b){return Math.log(a)/Math.log(b)};h.setMatrixTranslation=p;h.setMatrixTranslation3=function(a,
b,c,d){a[12]=b;a[13]=c;a[14]=d};h.getMatrixTranslation=function(b,c){void 0===c&&(c=a.vec3d.create());c[0]=b[12];c[1]=b[13];c[2]=b[14];return c};h.createTranslationMatrix=function(b,c){b=a.mat4d.identity(b);p(b,c);return b};h.isTranslationMatrix=function(a){return 1===a[0]&&0===a[1]&&0===a[2]&&0===a[3]&&0===a[4]&&1===a[5]&&0===a[6]&&0===a[7]&&0===a[8]&&0===a[9]&&1===a[10]&&0===a[11]&&1===a[15]};h.fovx2fovy=function(a,b,c){return 2*Math.atan(c*Math.tan(.5*a)/b)};h.fovy2fovx=function(a,b,c){return 2*
Math.atan(b*Math.tan(.5*a)/c)};h.fovx2fovd=function(a,b,c){return 2*Math.atan(Math.sqrt(b*b+c*c)*Math.tan(.5*a)/b)};h.fovy2fovd=function(a,b,c){return 2*Math.atan(Math.sqrt(b*b+c*c)*Math.tan(.5*a)/c)};h.fovd2fovx=function(a,b,c){return 2*Math.atan(b*Math.tan(.5*a)/Math.sqrt(b*b+c*c))};h.fovd2fovy=function(a,b,c){return 2*Math.atan(c*Math.tan(.5*a)/Math.sqrt(b*b+c*c))};h.nextHighestPowerOfTwo=function(a){--a;for(var b=1;32>b;b<<=1)a|=a>>b;return a+1};h.nextHighestPowerOfTen=function(a){return Math.pow(10,
Math.ceil(Math.LOG10E*Math.log(a)))};h.lineLineDistanceSquared3D=function(c,d,f,v,g){C[0]=c[0]-f[0];C[1]=c[1]-f[1];C[2]=c[2]-f[2];B[0]=v[0]-f[0];B[1]=v[1]-f[1];B[2]=v[2]-f[2];if(1E-4>Math.abs(B[0])&&1E-4>Math.abs(B[1])&&1E-4>Math.abs(B[2]))return g.success=!1,g;D[0]=d[0]-c[0];D[1]=d[1]-c[1];D[2]=d[2]-c[2];if(1E-4>Math.abs(D[0])&&1E-4>Math.abs(D[1])&&1E-4>Math.abs(D[2]))return g.success=!1,g;d=C[0]*B[0]+C[1]*B[1]+C[2]*B[2];v=B[0]*D[0]+B[1]*D[1]+B[2]*D[2];var k=C[0]*D[0]+C[1]*D[1]+C[2]*D[2],m=B[0]*
B[0]+B[1]*B[1]+B[2]*B[2],l=(D[0]*D[0]+D[1]*D[1]+D[2]*D[2])*m-v*v;if(1E-4>Math.abs(l))return g.success=!1,g;k=b((d*v-k*m)/l,0,1);d=b((d+v*k)/m,0,1);E[0]=c[0]+k*D[0];E[1]=c[1]+k*D[1];E[2]=c[2]+k*D[2];J[0]=f[0]+d*B[0];J[1]=f[1]+d*B[1];J[2]=f[2]+d*B[2];c=a.vec3d.dist2(E,J);g.success=!0;g.dist2=c;g.pa=E;g.pb=J;return g};h.pointLineSegmentDistanceSquared2D=function(c,d,f){I[0]=d[0]-c[0];I[1]=d[1]-c[1];I[2]=0;K[0]=f[0]-c[0];K[1]=f[1]-c[1];K[2]=0;O[0]=f[0];O[1]=f[1];O[2]=0;d=a.vec2d.dot(K,I);f=a.vec2d.dot(I,
I);d=b(d/f,0,1);H[0]=I[0]*d;H[1]=I[1]*d;F[0]=c[0]+H[0];F[1]=c[1]+H[1];a.vec2d.subtract(O,F,M);c=a.vec2d.dot(M,M);d=a.vec2d.dot(K,K);f=a.vec2d.dot(I,I);var v=a.vec2d.dot(H,H);if(v>d||v>f)c=Number.MAX_VALUE;return c};h.packFloatRGBA=function(a,c,d){void 0===d&&(d=0);a=b(a,0,aa);for(var f=0;4>f;f++)c[d+f]=Math.floor(256*r(a*N[f]))};h.unpackFloatRGBA=m;var N=[1,256,65536,16777216],S=[1/256,1/65536,1/16777216,1/4294967296],aa=m(new Uint8ClampedArray([255,255,255,255]));h.inverseProjectionInfo=function(b,
c,d,f,v){0===b[11]?(f[0]=2/(c*b[0]),f[1]=2/(d*b[5]),f[2]=(1+b[12])/b[0],f[3]=(1+b[13])/b[5],a.vec2d.set2(0,1,v)):(f[0]=-2/(c*b[0]),f[1]=-2/(d*b[5]),f[2]=(1-b[8])/b[0],f[3]=(1-b[9])/b[5],a.vec2d.set2(1,0,v))}})},"esri/views/3d/support/geometryUtils":function(){define(["require","exports","./geometryUtils/lineSegment","./geometryUtils/plane","./geometryUtils/triangle"],function(q,h,e,a,d){Object.defineProperty(h,"__esModule",{value:!0});h.plane=a;h.triangle=d;h.lineSegment=e})},"esri/views/3d/support/geometryUtils/lineSegment":function(){define(["require",
"exports","../../lib/glMatrix","../mathUtils"],function(q,h,e,a){function d(a,b){void 0===a&&(a=e.vec3d.create());void 0===b&&(b=e.vec3d.create());return{origin:a,vector:b}}Object.defineProperty(h,"__esModule",{value:!0});h.create=d;h.fromOriginAndVector=function(a,b,f){void 0===f&&(f=d());e.vec3d.set(a,f.origin);e.vec3d.set(b,f.vector);return f};h.distance2=function(d,c){c=e.vec3d.subtract(c,d.origin);var f=e.vec3d.dot(d.vector,c),g=e.vec3d.dot(d.vector,d.vector),f=a.clamp(f/g,0,1);d=e.vec3d.subtract(e.vec3d.scale(d.vector,
f,b),c,b);return e.vec3d.dot(d,d)};var b=e.vec3d.create()})},"esri/views/3d/support/geometryUtils/plane":function(){define(["require","exports","../../lib/glMatrix"],function(q,h,e){function a(a){void 0===a&&(a=h.UP);return[a[0],a[1],a[2],a[3]]}function d(b,c,d){void 0===d&&(d=a());e.vec3d.set(c,d);d[3]=-e.vec3d.dot(c,b);return d}function b(b,c,g,p){void 0===p&&(p=a());e.vec3d.cross(c,b,f);return d(g,e.vec3d.normalize(f),p)}Object.defineProperty(h,"__esModule",{value:!0});h.create=a;h.fromValues=
function(b,c,d,f,g){void 0===g&&(g=a());g[0]=b;g[1]=c;g[2]=d;g[3]=f;return g};h.fromNormalAndOffset=function(b,c,d){void 0===d&&(d=a());e.vec3d.set(b,d);d[3]=c;return d};h.fromPositionAndNormal=d;h.projectVector=function(a,b,d){void 0===d&&(d=b);return e.vec3d.cross(a,e.vec3d.cross(b,a,c),d)};h.distance=function(a,b){return e.vec3d.dot(a,b)+a[3]};h.fromPoints=function(d,f,l,p){void 0===p&&(p=a());return b(e.vec3d.subtract(d,f,g),e.vec3d.subtract(l,f,c),d,p)};h.set=function(a,b){a[0]=b[0];a[1]=b[1];
a[2]=b[2];a[3]=b[3];return a};h.negate=function(a,b){void 0===b&&(b=a);b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=-a[3];return b};h.fromVectorsAndPoint=b;h.intersectRay=function(a,b,c,d){var f=e.vec3d.dot(a,c);if(0===f)return!1;a=-(e.vec3d.dot(a,b)+a[3])/f;e.vec3d.add(b,e.vec3d.scale(c,a,d),d);return!0};h.UP=[0,0,1,0];var g=e.vec3d.create(),c=e.vec3d.create(),f=e.vec3d.create()})},"esri/views/3d/support/geometryUtils/triangle":function(){define(["require","exports","../../lib/glMatrix","./lineSegment"],
function(q,h,e,a){function d(a,b,c){var d=e.vec2d.dist(a,b);b=e.vec2d.dist(b,c);a=e.vec2d.dist(c,a);c=(d+b+a)/2;return Math.sqrt(c*(c-d)*(c-b)*(c-a))}Object.defineProperty(h,"__esModule",{value:!0});h.create=function(a,b,c){void 0===a&&(a=e.vec3d.create());void 0===b&&(b=e.vec3d.create());void 0===c&&(c=e.vec3d.create());return{p0:a,p1:b,p2:c}};h.distance2=function(d,r){var m=d.p0,u=d.p1;d=d.p2;var x=e.vec3d.subtract(u,m,b),v=e.vec3d.subtract(d,u,g),A=e.vec3d.subtract(m,d,c),y=e.vec3d.subtract(r,
m,f),C=e.vec3d.subtract(r,u,k),B=e.vec3d.subtract(r,d,n),h=e.vec3d.cross(x,A),E=e.vec3d.dot(e.vec3d.cross(x,h,l),y),C=e.vec3d.dot(e.vec3d.cross(v,h,l),C),B=e.vec3d.dot(e.vec3d.cross(A,h,l),B);if(0<E&&0<C&&0<B)return r=e.vec3d.dot(h,y),r*r/e.vec3d.dot(h,h);m=a.distance2(a.fromOriginAndVector(m,x,p),r);u=a.distance2(a.fromOriginAndVector(u,v,p),r);r=a.distance2(a.fromOriginAndVector(d,A,p),r);return Math.min(m,u,r)};h.areaPoints2d=d;h.area2d=function(a){return d(a.p0,a.p1,a.p2)};var b=e.vec3d.create(),
g=e.vec3d.create(),c=e.vec3d.create(),f=e.vec3d.create(),k=e.vec3d.create(),n=e.vec3d.create(),l=e.vec3d.create(),p=a.create()})},"esri/views/3d/webgl-engine/lib/gl-matrix":function(){define([],function(){var q={};(function(h,e){e(h,!0);e(h,!1)})(q,function(h,e){var a={};(function(){if("undefined"!=typeof Float32Array){var b=new Float32Array(1),c=new Int32Array(b.buffer);a.invsqrt=function(a){b[0]=a;c[0]=1597463007-(c[0]>>1);var d=b[0];return d*(1.5-.5*a*d*d)}}else a.invsqrt=function(a){return 1/
Math.sqrt(a)}})();var d=Array;"undefined"!=typeof Float32Array&&(d=e?Float32Array:Array);var b={create:function(a){var b=new d(3);a?(b[0]=a[0],b[1]=a[1],b[2]=a[2]):b[0]=b[1]=b[2]=0;return b},createFrom:function(a,b,c){var f=new d(3);f[0]=a;f[1]=b;f[2]=c;return f},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b},set3:function(a,b,c,d){d[0]=a;d[1]=b;d[2]=c;return d},add:function(a,b,c){if(!c||a===c)return a[0]+=b[0],a[1]+=b[1],a[2]+=b[2],a;c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];return c},
subtract:function(a,b,c){if(!c||a===c)return a[0]-=b[0],a[1]-=b[1],a[2]-=b[2],a;c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];return c},multiply:function(a,b,c){if(!c||a===c)return a[0]*=b[0],a[1]*=b[1],a[2]*=b[2],a;c[0]=a[0]*b[0];c[1]=a[1]*b[1];c[2]=a[2]*b[2];return c},max:function(a,b,c){c[0]=Math.max(a[0],b[0]);c[1]=Math.max(a[1],b[1]);c[2]=Math.max(a[2],b[2]);return c},min:function(a,b,c){c[0]=Math.min(a[0],b[0]);c[1]=Math.min(a[1],b[1]);c[2]=Math.min(a[2],b[2]);return c},negate:function(a,b){b||
(b=a);b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];return b},scale:function(a,b,c){if(!c||a===c)return a[0]*=b,a[1]*=b,a[2]*=b,a;c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;return c},normalize:function(a,b){b||(b=a);var c=a[0],d=a[1];a=a[2];var f=Math.sqrt(c*c+d*d+a*a);if(!f)return b[0]=0,b[1]=0,b[2]=0,b;if(1===f)return b[0]=c,b[1]=d,b[2]=a,b;f=1/f;b[0]=c*f;b[1]=d*f;b[2]=a*f;return b},cross:function(a,b,c){c||(c=a);var d=a[0],f=a[1];a=a[2];var g=b[0],v=b[1];b=b[2];c[0]=f*b-a*v;c[1]=a*g-d*b;c[2]=d*v-f*g;return c},length:function(a){var b=
a[0],c=a[1];a=a[2];return Math.sqrt(b*b+c*c+a*a)},length2:function(a){var b=a[0],c=a[1];a=a[2];return b*b+c*c+a*a},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},direction:function(a,b,c){c||(c=a);var d=a[0]-b[0],f=a[1]-b[1];a=a[2]-b[2];b=Math.sqrt(d*d+f*f+a*a);if(!b)return c[0]=0,c[1]=0,c[2]=0,c;b=1/b;c[0]=d*b;c[1]=f*b;c[2]=a*b;return c},lerp:function(a,b,c,d){d||(d=a);d[0]=a[0]+c*(b[0]-a[0]);d[1]=a[1]+c*(b[1]-a[1]);d[2]=a[2]+c*(b[2]-a[2]);return d},dist:function(a,b){var c=b[0]-a[0],d=
b[1]-a[1];a=b[2]-a[2];return Math.sqrt(c*c+d*d+a*a)},dist2:function(a,b){var c=b[0]-a[0],d=b[1]-a[1];a=b[2]-a[2];return c*c+d*d+a*a}},g=null,c=new d(4);b.unproject=function(a,b,d,f,k){k||(k=a);g||(g=r.create());var v=g;c[0]=2*(a[0]-f[0])/f[2]-1;c[1]=2*(a[1]-f[1])/f[3]-1;c[2]=2*a[2]-1;c[3]=1;r.multiply(d,b,v);if(!r.inverse(v))return null;r.multiplyVec4(v,c);if(0===c[3])return null;k[0]=c[0]/c[3];k[1]=c[1]/c[3];k[2]=c[2]/c[3];return k};var f=b.createFrom(1,0,0),k=b.createFrom(0,1,0),n=b.createFrom(0,
0,1);b.rotationTo=function(a,c,d){d||(d=t.create());var g=b.dot(a,c),v=b.create();if(1<=g)t.set(u,d);else if(-.999999>g)b.cross(f,a,v),1E-6>v.length&&b.cross(k,a,v),1E-6>v.length&&b.cross(n,a,v),b.normalize(v),t.fromAxisAngle(v,Math.PI,d);else{var g=Math.sqrt(2*(1+g)),m=1/g;b.cross(a,c,v);d[0]=v[0]*m;d[1]=v[1]*m;d[2]=v[2]*m;d[3]=.5*g;t.normalize(d)}1<d[3]?d[3]=1:-1>d[3]&&(d[3]=-1);return d};var l=b.create(),p=b.create();b.project=function(a,c,d,f){f||(f=a);b.direction(c,d,l);b.subtract(a,c,p);a=b.dot(l,
p);b.scale(l,a,f);b.add(f,c,f)};b.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+"]"};var m={create:function(a){var b=new d(9);a?(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8]):b[0]=b[1]=b[2]=b[3]=b[4]=b[5]=b[6]=b[7]=b[8]=0;return b},createFrom:function(a,b,c,f,g,k,m,l,e){var v=new d(9);v[0]=a;v[1]=b;v[2]=c;v[3]=f;v[4]=g;v[5]=k;v[6]=m;v[7]=l;v[8]=e;return v},determinant:function(a){var b=a[3],c=a[4],d=a[5],f=a[6],g=a[7],v=a[8];return a[0]*(v*c-d*g)+
a[1]*(-v*b+d*f)+a[2]*(g*b-c*f)},inverse:function(a,b){var c=a[0],d=a[1],f=a[2],g=a[3],v=a[4],k=a[5],l=a[6],e=a[7];a=a[8];var n=a*v-k*e,p=-a*g+k*l,u=e*g-v*l,r=c*n+d*p+f*u;if(!r)return null;r=1/r;b||(b=m.create());b[0]=n*r;b[1]=(-a*d+f*e)*r;b[2]=(k*d-f*v)*r;b[3]=p*r;b[4]=(a*c-f*l)*r;b[5]=(-k*c+f*g)*r;b[6]=u*r;b[7]=(-e*c+d*l)*r;b[8]=(v*c-d*g)*r;return b},multiply:function(a,b,c){c||(c=a);var d=a[0],f=a[1],g=a[2],v=a[3],k=a[4],m=a[5],l=a[6],e=a[7];a=a[8];var n=b[0],p=b[1],u=b[2],r=b[3],A=b[4],t=b[5],
y=b[6],x=b[7];b=b[8];c[0]=n*d+p*v+u*l;c[1]=n*f+p*k+u*e;c[2]=n*g+p*m+u*a;c[3]=r*d+A*v+t*l;c[4]=r*f+A*k+t*e;c[5]=r*g+A*m+t*a;c[6]=y*d+x*v+b*l;c[7]=y*f+x*k+b*e;c[8]=y*g+x*m+b*a;return c},multiplyVec2:function(a,b,c){c||(c=b);var d=b[0];b=b[1];c[0]=d*a[0]+b*a[3]+a[6];c[1]=d*a[1]+b*a[4]+a[7];return c},multiplyVec3:function(a,b,c){c||(c=b);var d=b[0],f=b[1];b=b[2];c[0]=d*a[0]+f*a[3]+b*a[6];c[1]=d*a[1]+f*a[4]+b*a[7];c[2]=d*a[2]+f*a[5]+b*a[8];return c},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=
a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b},identity:function(a){a||(a=m.create());a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a},transpose:function(a,b){if(!b||a===b){b=a[1];var c=a[2],d=a[5];a[1]=a[3];a[2]=a[6];a[3]=b;a[5]=a[7];a[6]=c;a[7]=d;return a}b[0]=a[0];b[1]=a[3];b[2]=a[6];b[3]=a[1];b[4]=a[4];b[5]=a[7];b[6]=a[2];b[7]=a[5];b[8]=a[8];return b},toMat4:function(a,b){b||(b=r.create());b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=
a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+"]"}},r={create:function(a){var b=new d(16);4===arguments.length?(b[0]=arguments[0],b[1]=arguments[1],b[2]=arguments[2],b[3]=arguments[3],b[4]=arguments[4],b[5]=arguments[5],b[6]=arguments[6],b[7]=arguments[7],b[8]=arguments[8],b[9]=arguments[9],b[10]=arguments[10],b[11]=arguments[11],b[12]=arguments[12],
b[13]=arguments[13],b[14]=arguments[14],b[15]=arguments[15]):a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]);return b},createFrom:function(a,b,c,f,g,k,m,l,e,n,p,u,r,t,x,h){var v=new d(16);v[0]=a;v[1]=b;v[2]=c;v[3]=f;v[4]=g;v[5]=k;v[6]=m;v[7]=l;v[8]=e;v[9]=n;v[10]=p;v[11]=u;v[12]=r;v[13]=t;v[14]=x;v[15]=h;return v},createFromMatrixRowMajor:function(a){var b=new d(16);b[0]=
a[0];b[4]=a[1];b[8]=a[2];b[12]=a[3];b[1]=a[4];b[5]=a[5];b[9]=a[6];b[13]=a[7];b[2]=a[8];b[6]=a[9];b[10]=a[10];b[14]=a[11];b[3]=a[12];b[7]=a[13];b[11]=a[14];b[15]=a[15];return b},createFromMatrix:function(a){var b=new d(16);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];
b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b},setRowMajor:function(a,b){b[0]=a[0];b[4]=a[1];b[8]=a[2];b[12]=a[3];b[1]=a[4];b[5]=a[5];b[9]=a[6];b[13]=a[7];b[2]=a[8];b[6]=a[9];b[10]=a[10];b[14]=a[11];b[3]=a[12];b[7]=a[13];b[11]=a[14];b[15]=a[15];return b},identity:function(a){a||(a=r.create());a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},transpose:function(a,b){if(!b||
a===b){b=a[1];var c=a[2],d=a[3],f=a[6],g=a[7],k=a[11];a[1]=a[4];a[2]=a[8];a[3]=a[12];a[4]=b;a[6]=a[9];a[7]=a[13];a[8]=c;a[9]=f;a[11]=a[14];a[12]=d;a[13]=g;a[14]=k;return a}b[0]=a[0];b[1]=a[4];b[2]=a[8];b[3]=a[12];b[4]=a[1];b[5]=a[5];b[6]=a[9];b[7]=a[13];b[8]=a[2];b[9]=a[6];b[10]=a[10];b[11]=a[14];b[12]=a[3];b[13]=a[7];b[14]=a[11];b[15]=a[15];return b},determinant:function(a){var b=a[0],c=a[1],d=a[2],f=a[3],g=a[4],k=a[5],m=a[6],l=a[7],e=a[8],v=a[9],n=a[10],p=a[11],u=a[12],r=a[13],t=a[14];a=a[15];return u*
v*m*f-e*r*m*f-u*k*n*f+g*r*n*f+e*k*t*f-g*v*t*f-u*v*d*l+e*r*d*l+u*c*n*l-b*r*n*l-e*c*t*l+b*v*t*l+u*k*d*p-g*r*d*p-u*c*m*p+b*r*m*p+g*c*t*p-b*k*t*p-e*k*d*a+g*v*d*a+e*c*m*a-b*v*m*a-g*c*n*a+b*k*n*a},inverse:function(a,b){b||(b=a);var c=a[0],d=a[1],f=a[2],g=a[3],k=a[4],m=a[5],l=a[6],e=a[7],n=a[8],v=a[9],p=a[10],u=a[11],r=a[12],t=a[13],A=a[14];a=a[15];var x=c*m-d*k,h=c*l-f*k,q=c*e-g*k,V=d*l-f*m,T=d*e-g*m,Q=f*e-g*l,G=n*t-v*r,X=n*A-p*r,Z=n*a-u*r,ea=v*A-p*t,fa=v*a-u*t,R=p*a-u*A,da=x*R-h*fa+q*ea+V*Z-T*X+Q*G;if(!da)return null;
da=1/da;b[0]=(m*R-l*fa+e*ea)*da;b[1]=(-d*R+f*fa-g*ea)*da;b[2]=(t*Q-A*T+a*V)*da;b[3]=(-v*Q+p*T-u*V)*da;b[4]=(-k*R+l*Z-e*X)*da;b[5]=(c*R-f*Z+g*X)*da;b[6]=(-r*Q+A*q-a*h)*da;b[7]=(n*Q-p*q+u*h)*da;b[8]=(k*fa-m*Z+e*G)*da;b[9]=(-c*fa+d*Z-g*G)*da;b[10]=(r*T-t*q+a*x)*da;b[11]=(-n*T+v*q-u*x)*da;b[12]=(-k*ea+m*X-l*G)*da;b[13]=(c*ea-d*X+f*G)*da;b[14]=(-r*V+t*h-A*x)*da;b[15]=(n*V-v*h+p*x)*da;return b},toRotationMat:function(a,b){b||(b=r.create());b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=
a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b},toMat3:function(a,b){b||(b=m.create());b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return b},toInverseMat3:function(a,b){var c=a[0],d=a[1],f=a[2],g=a[4],k=a[5],l=a[6],e=a[8],n=a[9];a=a[10];var v=a*k-l*n,p=-a*g+l*e,u=n*g-k*e,r=c*v+d*p+f*u;if(!r)return null;r=1/r;b||(b=m.create());b[0]=v*r;b[1]=(-a*d+f*n)*r;b[2]=(l*d-f*k)*r;b[3]=p*r;b[4]=(a*c-f*e)*r;b[5]=
(-l*c+f*g)*r;b[6]=u*r;b[7]=(-n*c+d*e)*r;b[8]=(k*c-d*g)*r;return b},multiply:function(a,b,c){c||(c=a);var d=a[0],f=a[1],g=a[2],k=a[3],m=a[4],l=a[5],e=a[6],n=a[7],v=a[8],p=a[9],u=a[10],r=a[11],t=a[12],y=a[13],A=a[14];a=a[15];var x=b[0],h=b[1],q=b[2],T=b[3],Q=b[4],G=b[5],X=b[6],Z=b[7],ea=b[8],fa=b[9],R=b[10],da=b[11],ba=b[12],ca=b[13],ga=b[14];b=b[15];c[0]=x*d+h*m+q*v+T*t;c[1]=x*f+h*l+q*p+T*y;c[2]=x*g+h*e+q*u+T*A;c[3]=x*k+h*n+q*r+T*a;c[4]=Q*d+G*m+X*v+Z*t;c[5]=Q*f+G*l+X*p+Z*y;c[6]=Q*g+G*e+X*u+Z*A;c[7]=
Q*k+G*n+X*r+Z*a;c[8]=ea*d+fa*m+R*v+da*t;c[9]=ea*f+fa*l+R*p+da*y;c[10]=ea*g+fa*e+R*u+da*A;c[11]=ea*k+fa*n+R*r+da*a;c[12]=ba*d+ca*m+ga*v+b*t;c[13]=ba*f+ca*l+ga*p+b*y;c[14]=ba*g+ca*e+ga*u+b*A;c[15]=ba*k+ca*n+ga*r+b*a;return c},multiplyVec3:function(a,b,c){c||(c=b);var d=b[0],f=b[1];b=b[2];c[0]=a[0]*d+a[4]*f+a[8]*b+a[12];c[1]=a[1]*d+a[5]*f+a[9]*b+a[13];c[2]=a[2]*d+a[6]*f+a[10]*b+a[14];return c},multiplyVec4:function(a,b,c){c||(c=b);var d=b[0],f=b[1],g=b[2];b=b[3];c[0]=a[0]*d+a[4]*f+a[8]*g+a[12]*b;c[1]=
a[1]*d+a[5]*f+a[9]*g+a[13]*b;c[2]=a[2]*d+a[6]*f+a[10]*g+a[14]*b;c[3]=a[3]*d+a[7]*f+a[11]*g+a[15]*b;return c},translate:function(a,b,c){var d=b[0],f=b[1];b=b[2];var g,k,m,l,e,n,p,v,u,r,t,y;if(!c||a===c)return a[12]=a[0]*d+a[4]*f+a[8]*b+a[12],a[13]=a[1]*d+a[5]*f+a[9]*b+a[13],a[14]=a[2]*d+a[6]*f+a[10]*b+a[14],a[15]=a[3]*d+a[7]*f+a[11]*b+a[15],a;g=a[0];k=a[1];m=a[2];l=a[3];e=a[4];n=a[5];p=a[6];v=a[7];u=a[8];r=a[9];t=a[10];y=a[11];c[0]=g;c[1]=k;c[2]=m;c[3]=l;c[4]=e;c[5]=n;c[6]=p;c[7]=v;c[8]=u;c[9]=r;c[10]=
t;c[11]=y;c[12]=g*d+e*f+u*b+a[12];c[13]=k*d+n*f+r*b+a[13];c[14]=m*d+p*f+t*b+a[14];c[15]=l*d+v*f+y*b+a[15];return c},scale:function(a,b,c){var d=b[0],f=b[1];b=b[2];if(!c||a===c)return a[0]*=d,a[1]*=d,a[2]*=d,a[3]*=d,a[4]*=f,a[5]*=f,a[6]*=f,a[7]*=f,a[8]*=b,a[9]*=b,a[10]*=b,a[11]*=b,a;c[0]=a[0]*d;c[1]=a[1]*d;c[2]=a[2]*d;c[3]=a[3]*d;c[4]=a[4]*f;c[5]=a[5]*f;c[6]=a[6]*f;c[7]=a[7]*f;c[8]=a[8]*b;c[9]=a[9]*b;c[10]=a[10]*b;c[11]=a[11]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c},maxScale:function(a){return Math.max(Math.max(Math.sqrt(a[0]*
a[0]+a[4]*a[4]+a[8]*a[8]),Math.sqrt(a[1]*a[1]+a[5]*a[5]+a[9]*a[9])),Math.sqrt(a[2]*a[2]+a[6]*a[6]+a[10]*a[10]))},rotate:function(a,b,c,d){var f=c[0],g=c[1];c=c[2];var k=Math.sqrt(f*f+g*g+c*c),m,l,e,n,p,v,u,r,t,y,A,C,x,h,q,Q,G,X,Z,ea;if(!k)return null;1!==k&&(k=1/k,f*=k,g*=k,c*=k);m=Math.sin(b);l=Math.cos(b);e=1-l;b=a[0];k=a[1];n=a[2];p=a[3];v=a[4];u=a[5];r=a[6];t=a[7];y=a[8];A=a[9];C=a[10];x=a[11];h=f*f*e+l;q=g*f*e+c*m;Q=c*f*e-g*m;G=f*g*e-c*m;X=g*g*e+l;Z=c*g*e+f*m;ea=f*c*e+g*m;f=g*c*e-f*m;g=c*c*e+
l;d?a!==d&&(d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]):d=a;d[0]=b*h+v*q+y*Q;d[1]=k*h+u*q+A*Q;d[2]=n*h+r*q+C*Q;d[3]=p*h+t*q+x*Q;d[4]=b*G+v*X+y*Z;d[5]=k*G+u*X+A*Z;d[6]=n*G+r*X+C*Z;d[7]=p*G+t*X+x*Z;d[8]=b*ea+v*f+y*g;d[9]=k*ea+u*f+A*g;d[10]=n*ea+r*f+C*g;d[11]=p*ea+t*f+x*g;return d},rotateX:function(a,b,c){var d=Math.sin(b);b=Math.cos(b);var f=a[4],g=a[5],k=a[6],m=a[7],l=a[8],e=a[9],n=a[10],p=a[11];c?a!==c&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):
c=a;c[4]=f*b+l*d;c[5]=g*b+e*d;c[6]=k*b+n*d;c[7]=m*b+p*d;c[8]=f*-d+l*b;c[9]=g*-d+e*b;c[10]=k*-d+n*b;c[11]=m*-d+p*b;return c},rotateY:function(a,b,c){var d=Math.sin(b);b=Math.cos(b);var f=a[0],g=a[1],k=a[2],m=a[3],l=a[8],e=a[9],n=a[10],p=a[11];c?a!==c&&(c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a;c[0]=f*b+l*-d;c[1]=g*b+e*-d;c[2]=k*b+n*-d;c[3]=m*b+p*-d;c[8]=f*d+l*b;c[9]=g*d+e*b;c[10]=k*d+n*b;c[11]=m*d+p*b;return c},rotateZ:function(a,b,c){var d=Math.sin(b);
b=Math.cos(b);var f=a[0],g=a[1],k=a[2],m=a[3],l=a[4],e=a[5],n=a[6],p=a[7];c?a!==c&&(c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a;c[0]=f*b+l*d;c[1]=g*b+e*d;c[2]=k*b+n*d;c[3]=m*b+p*d;c[4]=f*-d+l*b;c[5]=g*-d+e*b;c[6]=k*-d+n*b;c[7]=m*-d+p*b;return c},frustum:function(a,b,c,d,f,g,k){k||(k=r.create());var m=b-a,l=d-c,e=g-f;k[0]=2*f/m;k[1]=0;k[2]=0;k[3]=0;k[4]=0;k[5]=2*f/l;k[6]=0;k[7]=0;k[8]=(b+a)/m;k[9]=(d+c)/l;k[10]=-(g+f)/e;k[11]=-1;k[12]=0;k[13]=0;
k[14]=-(g*f*2)/e;k[15]=0;return k},perspective:function(a,b,c,d,f){a=c*Math.tan(a*Math.PI/360);b*=a;return r.frustum(-b,b,-a,a,c,d,f)},ortho:function(a,b,c,d,f,g,k){k||(k=r.create());var m=b-a,l=d-c,e=g-f;k[0]=2/m;k[1]=0;k[2]=0;k[3]=0;k[4]=0;k[5]=2/l;k[6]=0;k[7]=0;k[8]=0;k[9]=0;k[10]=-2/e;k[11]=0;k[12]=-(a+b)/m;k[13]=-(d+c)/l;k[14]=-(g+f)/e;k[15]=1;return k},lookAt:function(a,b,c,d){d||(d=r.create());var f,g,k,m,l,e,n,p,u=a[0],v=a[1];a=a[2];k=c[0];m=c[1];g=c[2];n=b[0];c=b[1];f=b[2];if(u===n&&v===
c&&a===f)return r.identity(d);b=u-n;c=v-c;n=a-f;p=1/Math.sqrt(b*b+c*c+n*n);b*=p;c*=p;n*=p;f=m*n-g*c;g=g*b-k*n;k=k*c-m*b;(p=Math.sqrt(f*f+g*g+k*k))?(p=1/p,f*=p,g*=p,k*=p):k=g=f=0;m=c*k-n*g;l=n*f-b*k;e=b*g-c*f;(p=Math.sqrt(m*m+l*l+e*e))?(p=1/p,m*=p,l*=p,e*=p):e=l=m=0;d[0]=f;d[1]=m;d[2]=b;d[3]=0;d[4]=g;d[5]=l;d[6]=c;d[7]=0;d[8]=k;d[9]=e;d[10]=n;d[11]=0;d[12]=-(f*u+g*v+k*a);d[13]=-(m*u+l*v+e*a);d[14]=-(b*u+c*v+n*a);d[15]=1;return d},fromRotationTranslation:function(a,b,c){c||(c=r.create());var d=a[0],
f=a[1],g=a[2],k=a[3],m=d+d,l=f+f,e=g+g;a=d*m;var n=d*l,d=d*e,p=f*l,f=f*e,g=g*e,m=k*m,l=k*l,k=k*e;c[0]=1-(p+g);c[1]=n+k;c[2]=d-l;c[3]=0;c[4]=n-k;c[5]=1-(a+g);c[6]=f+m;c[7]=0;c[8]=d+l;c[9]=f-m;c[10]=1-(a+p);c[11]=0;c[12]=b[0];c[13]=b[1];c[14]=b[2];c[15]=1;return c},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+"]"}},t={create:function(a){var b=new d(4);a?(b[0]=
a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]):b[0]=b[1]=b[2]=b[3]=0;return b},createFrom:function(a,b,c,f){var g=new d(4);g[0]=a;g[1]=b;g[2]=c;g[3]=f;return g},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},identity:function(a){a||(a=t.create());a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a}},u=t.identity();t.calculateW=function(a,b){var c=a[0],d=a[1],f=a[2];if(!b||a===b)return a[3]=-Math.sqrt(Math.abs(1-c*c-d*d-f*f)),a;b[0]=c;b[1]=d;b[2]=f;b[3]=-Math.sqrt(Math.abs(1-c*c-d*d-f*f));return b};t.dot=
function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};t.inverse=function(a,b){var c=a[0],d=a[1],f=a[2],g=a[3],c=(c=c*c+d*d+f*f+g*g)?1/c:0;if(!b||a===b)return a[0]*=-c,a[1]*=-c,a[2]*=-c,a[3]*=c,a;b[0]=-a[0]*c;b[1]=-a[1]*c;b[2]=-a[2]*c;b[3]=a[3]*c;return b};t.conjugate=function(a,b){if(!b||a===b)return a[0]*=-1,a[1]*=-1,a[2]*=-1,a;b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};t.length=function(a){var b=a[0],c=a[1],d=a[2];a=a[3];return Math.sqrt(b*b+c*c+d*d+a*a)};t.normalize=function(a,
b){b||(b=a);var c=a[0],d=a[1],f=a[2];a=a[3];var g=Math.sqrt(c*c+d*d+f*f+a*a);if(0===g)return b[0]=0,b[1]=0,b[2]=0,b[3]=0,b;g=1/g;b[0]=c*g;b[1]=d*g;b[2]=f*g;b[3]=a*g;return b};t.add=function(a,b,c){if(!c||a===c)return a[0]+=b[0],a[1]+=b[1],a[2]+=b[2],a[3]+=b[3],a;c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];c[3]=a[3]+b[3];return c};t.multiply=function(a,b,c){c||(c=a);var d=a[0],f=a[1],g=a[2];a=a[3];var k=b[0],m=b[1],l=b[2];b=b[3];c[0]=d*b+a*k+f*l-g*m;c[1]=f*b+a*m+g*k-d*l;c[2]=g*b+a*l+d*m-f*k;c[3]=
a*b-d*k-f*m-g*l;return c};t.multiplyVec3=function(a,b,c){c||(c=b);var d=b[0],f=b[1],g=b[2];b=a[0];var k=a[1],m=a[2];a=a[3];var l=a*d+k*g-m*f,e=a*f+m*d-b*g,n=a*g+b*f-k*d,d=-b*d-k*f-m*g;c[0]=l*a+d*-b+e*-m-n*-k;c[1]=e*a+d*-k+n*-b-l*-m;c[2]=n*a+d*-m+l*-k-e*-b;return c};t.scale=function(a,b,c){if(!c||a===c)return a[0]*=b,a[1]*=b,a[2]*=b,a[3]*=b,a;c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;c[3]=a[3]*b;return c};t.toMat3=function(a,b){b||(b=m.create());var c=a[0],d=a[1],f=a[2],g=a[3],k=c+c,l=d+d,e=f+f;a=c*k;var n=
c*l,c=c*e,p=d*l,d=d*e,f=f*e,k=g*k,l=g*l,g=g*e;b[0]=1-(p+f);b[1]=n+g;b[2]=c-l;b[3]=n-g;b[4]=1-(a+f);b[5]=d+k;b[6]=c+l;b[7]=d-k;b[8]=1-(a+p);return b};t.toMat4=function(a,b){b||(b=r.create());var c=a[0],d=a[1],f=a[2],g=a[3],k=c+c,m=d+d,l=f+f;a=c*k;var e=c*m,c=c*l,n=d*m,d=d*l,f=f*l,k=g*k,m=g*m,g=g*l;b[0]=1-(n+f);b[1]=e+g;b[2]=c-m;b[3]=0;b[4]=e-g;b[5]=1-(a+f);b[6]=d+k;b[7]=0;b[8]=c+m;b[9]=d-k;b[10]=1-(a+n);b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};t.slerp=function(a,b,c,d){d||(d=a);var f=a[0]*
b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3],g,k;if(1<=Math.abs(f))return d!==a&&(d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=a[3]),d;g=Math.acos(f);k=Math.sqrt(1-f*f);if(.001>Math.abs(k))return d[0]=.5*a[0]+.5*b[0],d[1]=.5*a[1]+.5*b[1],d[2]=.5*a[2]+.5*b[2],d[3]=.5*a[3]+.5*b[3],d;f=Math.sin((1-c)*g)/k;c=Math.sin(c*g)/k;d[0]=a[0]*f+b[0]*c;d[1]=a[1]*f+b[1]*c;d[2]=a[2]*f+b[2]*c;d[3]=a[3]*f+b[3]*c;return d};t.fromRotationMatrix=function(a,b){b||(b=t.create());var c=a[0]+a[4]+a[8],d;if(0<c)d=Math.sqrt(c+1),b[3]=.5*d,d=.5/
d,b[0]=(a[7]-a[5])*d,b[1]=(a[2]-a[6])*d,b[2]=(a[3]-a[1])*d;else{d=t.fromRotationMatrix.s_iNext=t.fromRotationMatrix.s_iNext||[1,2,0];c=0;a[4]>a[0]&&(c=1);a[8]>a[3*c+c]&&(c=2);var f=d[c],g=d[f];d=Math.sqrt(a[3*c+c]-a[3*f+f]-a[3*g+g]+1);b[c]=.5*d;d=.5/d;b[3]=(a[3*g+f]-a[3*f+g])*d;b[f]=(a[3*f+c]+a[3*c+f])*d;b[g]=(a[3*g+c]+a[3*c+g])*d}return b};m.toQuat4=t.fromRotationMatrix;(function(){var a=m.create();t.fromAxes=function(b,c,d,f){a[0]=c[0];a[3]=c[1];a[6]=c[2];a[1]=d[0];a[4]=d[1];a[7]=d[2];a[2]=b[0];
a[5]=b[1];a[8]=b[2];return t.fromRotationMatrix(a,f)}})();t.identity=function(a){a||(a=t.create());a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};t.fromAngleAxis=function(a,b,c){c||(c=t.create());a*=.5;var d=Math.sin(a);c[3]=Math.cos(a);c[0]=d*b[0];c[1]=d*b[1];c[2]=d*b[2];return c};t.toAngleAxis=function(b,c){c||(c=b);var d=b[0]*b[0]+b[1]*b[1]+b[2]*b[2];0<d?(c[3]=2*Math.acos(b[3]),d=a.invsqrt(d),c[0]=b[0]*d,c[1]=b[1]*d,c[2]=b[2]*d):(c[3]=0,c[0]=1,c[1]=0,c[2]=0);return c};t.str=function(a){return"["+a[0]+", "+
a[1]+", "+a[2]+", "+a[3]+"]"};var x={create:function(a){var b=new d(4);a?(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]):b[0]=b[1]=b[2]=b[3]=0;return b},createFrom:function(a,b,c,f){var g=new d(4);g[0]=a;g[1]=b;g[2]=c;g[3]=f;return g},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},identity:function(a){a||(a=x.create());a[0]=1;a[1]=0;a[2]=0;a[3]=1;return a},transpose:function(a,b){if(!b||a===b)return b=a[1],a[1]=a[2],a[2]=b,a;b[0]=a[0];b[1]=a[2];b[2]=a[1];b[3]=a[3];return b},determinant:function(a){return a[0]*
a[3]-a[2]*a[1]},inverse:function(a,b){b||(b=a);var c=a[0],d=a[1],f=a[2];a=a[3];var g=c*a-f*d;if(!g)return null;g=1/g;b[0]=a*g;b[1]=-d*g;b[2]=-f*g;b[3]=c*g;return b},multiply:function(a,b,c){c||(c=a);var d=a[0],f=a[1],g=a[2];a=a[3];c[0]=d*b[0]+f*b[2];c[1]=d*b[1]+f*b[3];c[2]=g*b[0]+a*b[2];c[3]=g*b[1]+a*b[3];return c},rotate:function(a,b,c){c||(c=a);var d=a[0],f=a[1],g=a[2];a=a[3];var k=Math.sin(b);b=Math.cos(b);c[0]=d*b+f*k;c[1]=d*-k+f*b;c[2]=g*b+a*k;c[3]=g*-k+a*b;return c},multiplyVec2:function(a,
b,c){c||(c=b);var d=b[0];b=b[1];c[0]=d*a[0]+b*a[1];c[1]=d*a[2]+b*a[3];return c},scale:function(a,b,c){c||(c=a);var d=a[1],f=a[2],g=a[3],k=b[0];b=b[1];c[0]=a[0]*k;c[1]=d*b;c[2]=f*k;c[3]=g*b;return c},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"}};e=e?"":"d";h["glMath"+e]=a;h["vec2"+e]={create:function(a){var b=new d(2);a?(b[0]=a[0],b[1]=a[1]):(b[0]=0,b[1]=0);return b},createFrom:function(a,b){var c=new d(2);c[0]=a;c[1]=b;return c},add:function(a,b,c){c||(c=b);c[0]=a[0]+b[0];c[1]=
a[1]+b[1];return c},subtract:function(a,b,c){c||(c=b);c[0]=a[0]-b[0];c[1]=a[1]-b[1];return c},multiply:function(a,b,c){c||(c=b);c[0]=a[0]*b[0];c[1]=a[1]*b[1];return c},divide:function(a,b,c){c||(c=b);c[0]=a[0]/b[0];c[1]=a[1]/b[1];return c},scale:function(a,b,c){c||(c=a);c[0]=a[0]*b;c[1]=a[1]*b;return c},dist:function(a,b){var c=b[0]-a[0];a=b[1]-a[1];return Math.sqrt(c*c+a*a)},dist2:function(a,b){var c=b[0]-a[0];a=b[1]-a[1];return c*c+a*a},set:function(a,b){b[0]=a[0];b[1]=a[1];return b},set2:function(a,
b,c){c[0]=a;c[1]=b;return c},negate:function(a,b){b||(b=a);b[0]=-a[0];b[1]=-a[1];return b},normalize:function(a,b){b||(b=a);var c=a[0]*a[0]+a[1]*a[1];0<c?(c=Math.sqrt(c),b[0]=a[0]/c,b[1]=a[1]/c):b[0]=b[1]=0;return b},cross:function(a,b,c){a=a[0]*b[1]-a[1]*b[0];if(!c)return a;c[0]=c[1]=0;c[2]=a;return c},length:function(a){var b=a[0];a=a[1];return Math.sqrt(b*b+a*a)},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]},direction:function(a,b,c){c||(c=a);var d=a[0]-b[0];a=a[1]-b[1];b=d*d+a*a;if(!b)return c[0]=
0,c[1]=0,c[2]=0,c;b=1/Math.sqrt(b);c[0]=d*b;c[1]=a*b;return c},lerp:function(a,b,c,d){d||(d=a);d[0]=a[0]+c*(b[0]-a[0]);d[1]=a[1]+c*(b[1]-a[1]);return d},str:function(a){return"["+a[0]+", "+a[1]+"]"}};h["vec3"+e]=b;h["vec4"+e]={create:function(a){var b=new d(4);a?(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]):(b[0]=0,b[1]=0,b[2]=0,b[3]=0);return b},createFrom:function(a,b,c,f){var g=new d(4);g[0]=a;g[1]=b;g[2]=c;g[3]=f;return g},add:function(a,b,c){c||(c=b);c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];
c[3]=a[3]+b[3];return c},subtract:function(a,b,c){c||(c=b);c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];c[3]=a[3]-b[3];return c},multiply:function(a,b,c){c||(c=b);c[0]=a[0]*b[0];c[1]=a[1]*b[1];c[2]=a[2]*b[2];c[3]=a[3]*b[3];return c},divide:function(a,b,c){c||(c=b);c[0]=a[0]/b[0];c[1]=a[1]/b[1];c[2]=a[2]/b[2];c[3]=a[3]/b[3];return c},scale:function(a,b,c){c||(c=a);c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;c[3]=a[3]*b;return c},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]},set:function(a,
b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},set4:function(a,b,c,d,f){f[0]=a;f[1]=b;f[2]=c;f[3]=d;return f},negate:function(a,b){b||(b=a);b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=-a[3];return b},lerp:function(a,b,c,d){d||(d=a);d[0]=a[0]+c*(b[0]-a[0]);d[1]=a[1]+c*(b[1]-a[1]);d[2]=a[2]+c*(b[2]-a[2]);d[3]=a[3]+c*(b[3]-a[3]);return d},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"}};h["mat2"+e]=x;h["mat3"+e]=m;h["mat4"+e]=r;h["quat4"+e]=t});return q})},"esri/views/3d/webgl-engine/materials/internal/MaterialUtil":function(){define("require exports ../../../../../geometry/support/aaBoundingBox ../../lib/ComponentUtils ../../lib/doublePrecisionUtils ../../lib/gl-matrix ../../lib/screenSizePerspectiveUtils ../../lib/Util ../../../../webgl/Util".split(" "),
function(q,h,e,a,d,b,g,c,f){function k(a,b,c,d,f,g){if(void 0===f||3!==g)for(f=0;f<g;++f)c[d+f]=a[b+f];else{var k=a[b],m=a[b+1];a=a[b+2];c[d]=f[0]*k+f[4]*m+f[8]*a+f[12];c[d+1]=f[1]*k+f[5]*m+f[9]*a+f[13];c[d+2]=f[2]*k+f[6]*m+f[10]*a+f[14]}return g}function n(a,b,c,d,f,g){for(var k=a.length,m=0;m<k;++m){for(var l=c*a[m],e=0;e<c;++e)d[f+e]=b[l+e];f+=g}}function l(a,b,c,d,f,g){d=new Uint8Array(d);f*=4;g*=4;var k=a.length;if(4===c)for(c=0;c<k;++c){var m=4*a[c];d[f]=b[m];d[f+1]=b[m+1];d[f+2]=b[m+2];d[f+
3]=b[m+3];f+=g}else if(3===c)for(c=0;c<k;++c)m=3*a[c],d[f]=b[m],d[f+1]=b[m+1],d[f+2]=b[m+2],d[f+3]=255,f+=g}function p(a,b,c,d,f){var g=t(b,c,B);e.setMin(y,a.getBBMin());e.setMax(y,a.getBBMax());if(u(y,b,g,d)){var g=a.getPrimitiveIndices(),k=a.getIndices(),l=a.getPosition(),n=g?g.length:k.length/3;if(n>K&&(a=a.getChildren(),void 0!==a)){for(g=0;8>g;++g)void 0!==a[g]&&p(a[g],b,c,d,f);return}m(b,c,0,n,k,l,g,f)}}function m(a,b,c,d,f,g,k,m){var l=g.data,e=g.offsetIdx;g=g.strideIdx;var n=a[0],p=a[1];a=
a[2];var u=b[0]-n,t=b[1]-p;for(b=b[2]-a;c<d;c++){var v=k?k[c]:c,x=e+g*f[3*v],y=e+g*f[3*v+1],h=e+g*f[3*v+2],C=l[x],A=l[x+1],B=l[x+2],x=l[y]-C,J=l[y+1]-A,y=l[y+2]-B,P=l[h]-C,F=l[h+1]-A,h=l[h+2]-B,I=t*h-F*b,w=b*P-h*u,q=u*F-P*t,L=x*I+J*w+y*q,C=n-C,H=p-A,T=a-B,A=H*y-J*T,B=T*x-y*C,K=C*J-x*H;if(L>D){I=C*I+H*w+T*q;if(0>I||I>L)continue;w=u*A+t*B+b*K;if(0>w||I+w>L)continue}else if(L<-D){I=C*I+H*w+T*q;if(0<I||I<L)continue;w=u*A+t*B+b*K;if(0<w||I+w<L)continue}else continue;L=(P*A+F*B+h*K)/L;0<=L&&(x=r(x,J,y,
P,F,h,E),m(L,x,v))}}function r(a,c,d,f,g,k,m){b.vec3d.set3(a,c,d,J);b.vec3d.set3(f,g,k,F);return b.vec3d.normalize(b.vec3d.cross(J,F,m))}function t(a,c,d){return b.vec3d.set3(1/(c[0]-a[0]),1/(c[1]-a[1]),1/(c[2]-a[2]),d)}function u(a,b,c,d){var f=(a[0]-d-b[0])*c[0],g=(a[3]+d-b[0])*c[0],k=Math.min(f,g),f=Math.max(f,g),g=(a[1]-d-b[1])*c[1],m=(a[4]+d-b[1])*c[1],k=Math.max(k,Math.min(g,m)),f=Math.min(f,Math.max(g,m));if(k>f)return!1;g=(a[2]-d-b[2])*c[2];a=(a[5]+d-b[2])*c[2];k=Math.max(k,Math.min(g,a));
f=Math.min(f,Math.max(g,a));return k<=f}function x(a,b){b=b?x(b):{};for(var c in a){var d=a[c];d&&d.forEach&&(d=v(d));null==d&&c in b||(b[c]=d)}return b}function v(a){var b=[];a.forEach(function(a){return b.push(a)});return b}Object.defineProperty(h,"__esModule",{value:!0});var A=b.mat4d.create(),y=e.create(),C=c.VertexAttrConstants;h.IDENTITY=b.mat4d.identity();h.fill=k;h.fillColor=function(a,b,c,d,f){for(var g=0;g<f;++g)c[d+g]=a[b+g];return f};h.fillInterleaved=function(a,b,c,d,g,k,m,e){for(var p=
f.getStride(g)/4,u=0;u<g.length;u++){var r=g[u],t=m+r.offset/4,r=r.name,v=a.vertexAttr[r];if(null!=v&&(null==e||null!=e[r]))switch(r){case "uv0":n(a.indices[r],v.data,v.size,k,t,p);break;case "region":for(var r=a.indices[r],x=v.data,y=v.size,v=p,h=new Uint16Array(k.buffer),t=2*t,v=2*v,A=r.length,B=0;B<A;++B){for(var D=y*r[B],E=0;E<y;++E)h[t+E]=x[D+E];t+=v}break;case "color":if(d&&d.color)if(r=a.indices[r],x=v.data,y=d.color,B=v.size,v=p,h=new Uint8Array(k.buffer),t*=4,v*=4,A=r.length,4===B)for(B=
0;B<A;++B)D=4*r[B],h[t]=x[D]*y[0],h[t+1]=x[D+1]*y[1],h[t+2]=x[D+2]*y[2],h[t+3]=x[D+3]*y[3],t+=v;else{if(3===B)for(E=255*y[3],B=0;B<A;++B)D=3*r[B],h[t]=x[D]*y[0],h[t+1]=x[D+1]*y[1],h[t+2]=x[D+2]*y[2],h[t+3]=E,t+=v}else l(a.indices[r],v.data,v.size,k.buffer,t,p);break;case "symbolColor":l(a.indices[r],v.data,v.size,k.buffer,t,p);break;default:if(y=r===C.POSITION?b:r===C.NORMAL?c:void 0,void 0!==y&&3===v.size)for(r=a.indices[r],x=v.data,v=k,h=p,A=r.length,B=0;B<A;++B){var J=3*r[B],D=x[J],E=x[J+1],J=
x[J+2];v[t]=y[0]*D+y[4]*E+y[8]*J+y[12];v[t+1]=y[1]*D+y[5]*E+y[9]*J+y[13];v[t+2]=y[2]*D+y[6]*E+y[10]*J+y[14];t+=h}else n(a.indices[r],v.data,v.size,k,t,p)}}};h.triangleVertexArrayToWireframeLines=function(a,b,c,d){for(c=Math.floor(c/3)-1;0<=c;c--){var f=b+3*c*d,g=b+6*c*d+5*d;k(a,f,a,g,null,d);g-=d;k(a,f+d,a,g,null,d);g-=d;k(a,f+d,a,g,null,d);g-=d;k(a,f+2*d,a,g,null,d);g-=d;k(a,f+2*d,a,g,null,d);g-=d;k(a,f,a,g,null,d)}};h.intersectTriangleGeometry=function(b,d,f,g,k,l,n){c.assert("triangle"===b.data.primitiveType);
d=d&&d.componentVisibilities;g=g.tolerance;if(1<b.getComponentCount()){f=t(k,l,B);var r=b.getBoundingInfo();e.setMin(y,r.getBBMin());e.setMax(y,r.getBBMax());if(u(y,k,f,g))for(var v=b.data,r=b.getComponentCount(),x=v.getIndices(C.POSITION),h=v.getAttribute(C.POSITION),v=v.componentOffsets,A=0;A<r;A++)if(!d||a.getVisibility(d,A)){var D=b.getComponentAABB(A,y);u(D,k,f,g)&&m(k,l,v[A]/3,v[A+1]/3,x,h,void 0,n)}}else d&&!a.getVisibility(d,0)||p(b.getBoundingInfo(),k,l,g,n)};var B=b.vec3d.create(),D=Math.pow(2,
-52),E=b.vec3d.create();h.intersectTriangles=m;var J=b.vec3d.create(),F=b.vec3d.create();h.computeNormal=r;h.intersectAabbInvDir=u;h.transformToWorld=function(a,c,d){return b.vec4d.set4(a[0]-c[0],a[1]-c[1],a[2]-c[2],1,d)};h.transformToView=function(a,c,d,f){b.mat4d.translate(d,c,A);d=A;return b.mat4d.multiplyVec4(d,a,f)};h.transformToProjection=function(a,c,d,f){f[0]=a[0]+d[0];f[1]=a[1]+d[1];f[2]=a[2]+d[2];f[3]=a[3];return b.mat4d.multiplyVec4(c,f)};h.transformToNDC=function(a,c){return b.vec4d.scale(a,
1/Math.abs(a[3]),c)};h.applyScreenSizePerspectiveScale=function(a,b,c,d,f){return g.scale(a,d,c,f)};h.verticalOffsetAtDistance=function(a,b,d,f,k){var m=d.screenLength||0;k&&(m=g.scale(m,f,b,k));return c.clamp(m*Math.tan(.5*a.fovY)/(.5*a.fullHeight)*b,d.minWorldLength||0,null!=d.maxWorldLength?d.maxWorldLength:Infinity)};h.aquireIfNotUndefined=function(a,b,c){if(void 0!==a)return b.aquire(a,c)};h.releaseIfNotUndefined=function(a,b){void 0!==a&&b.release(a)};var M=b.mat4.create();h.bindView=function(a,
c,d){b.mat4d.translate(c,a,M);d.setUniform3fv("localOrigin",a);d.setUniformMatrix4fv("view",M)};h.bindCamPos=function(a,b,c){c.setUniform3f("camPos",b[3]-a[0],b[7]-a[1],b[11]-a[2])};var H=b.vec3d.create(),I=b.vec3d.create();h.bindViewOriginDouble=function(a,b){d.encodeDoubleArraySplit(a,H,I,3);b.setUniform3fv("viewOriginHi",H);b.setUniform3fv("viewOriginLo",I)};h.bindVerticalOffset=function(a,b,c){if(a){var d=b.fovY;b=b.viewport[3];var f=void 0;void 0===f&&(f=O);f.screenLength=a.screenLength;f.perDistance=
Math.tan(.5*d)/(.5*b);f.minWorldLength=a.minWorldLength;f.maxWorldLength=a.maxWorldLength;a=f;c.setUniform4f("verticalOffset",a.screenLength,a.perDistance,a.minWorldLength,a.maxWorldLength)}};h.bindScreenSizePerspective=function(a,b,c){void 0===c&&(c="screenSizePerspectiveAlignment");if(a){var d=a.parameters;b.setUniform4f(c,d.divisor,d.offset,d.minPixelSize,a.paddingPixelsOverride)}};h.copyParameters=x;h.updateParameters=function(a,b){var c=!1,d;for(d in b){var f=b[d];void 0!==f&&(c=!0,Array.isArray(f)?
a[d]=f.slice():a[d]=f)}return c};h.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};var K=1E3,O={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0}})},"esri/views/3d/webgl-engine/lib/ComponentUtils":function(){define(["require","exports","../../../../core/arrayUtils"],function(q,h,e){function a(a,b){if(null!=a){var c=a.isVisibleBit,d=a.data,f=8*d.BYTES_PER_ELEMENT;return b<d.length*f?p(c,d,b,f):!a.isVisibleBit}return!0}function d(a){return null===a.component?-1:a.component}function b(b,
c,d,f,k){a(c,f)&&g(b,c,d,d[f],d[f+1]-1,k)}function g(a,b,c,d,f,g){c=(b=0<a.length?a[a.length-1]:null)?b.range[1]:-1;var k=b?b.options:null;c>=d||(c+1===d&&k===g?b.range[1]=f:a.push({range:[d,f],options:g}))}function c(a){void 0===a&&(a=!0);return{isVisibleBit:!a,data:new Uint32Array(0)}}function f(a,b){return n(a,b,!0)}function k(a,b){return n(a,b,!1)}function n(a,b,c){var d=!1;a=a||r;d=a.isVisibleBit;a=a.data;b=m(b);var f=8*a.BYTES_PER_ELEMENT,g=a.length*f;c=c===d;if(0===a.length||0===b)d=!c;else if(g<
b&&!c)d=!0;else{for(var k=t[f],g=t[0],l=0;l<a.length-1;l++)if(d=!c&&a[l]!==k||c&&a[l]!==g)return d;d=a.length-1;b=t[(b-1)%f+1];d=!c&&(a[d]&b)!==b||c&&(a[d]&b)!==g}return d}function l(a){return 0<a.length}function p(a,b,c,d){var f=c/d|0;return 0!==(b[f]&1<<c-f*d)===a}function m(a){return Math.max(0,a.length-1)}Object.defineProperty(h,"__esModule",{value:!0});h.updateVisibility=function(a,b,d,f){if(d<m(b)){null==a&&(a=c());var g=a.isVisibleBit,k=a.data,l=8*k.BYTES_PER_ELEMENT,e=d/l|0,n=d-l*e;b=(m(b)-
1)/l|0;var p=k;f=f===g;d<p.length*l||!f||(d=Math.max(e+1,Math.ceil(1.5*p.length)),d=Math.min(d,b+1),k=new Uint32Array(d),k.set(p));e<k.length&&(k[e]=k[e]&~(1<<n)|(f?1:0)<<n);a.data=k}return a};h.getVisibility=a;h.hideAllComponents=function(a){if(null==a)a=c(!1);else{a.isVisibleBit=!0;for(var b=0;b<a.data.length;b++)a.data[b]=0}return a};h.unhideAllComponents=function(a){var b;if(null!=a)for(b=a,b.isVisibleBit=!1,a=0;a<b.data.length;a++)b.data[a]=0;return b};h.generateVisibleIndexRanges=function(a,
b){var c;if(a)if(l(b))if(0===a.data.length)c=[],b=[[b[0],b[b.length-1]-1]],c=a.isVisibleBit?c:b;else{c=[];for(var d=a.isVisibleBit,f=a.data,g=8*f.BYTES_PER_ELEMENT,k=f.length*g,e=m(b),n=!1,r=0;r<k&&r<e;r++){var t=p(d,f,r,g);if(t!==n){var u=b[r];t?c.push([u,0]):(n=c[c.length-1],n[1]=u-1);n=t}}a=!a.isVisibleBit;e>k&&a&&!n?c.push([b[k],b[e]-1]):n&&(n=c[c.length-1],n[1]=b[a?e:Math.min(e,k)]-1)}else c=[],c=a.isVisibleBit?c:null;else c=null;return c};h.addHighlight=function(a,b,c,f){a=a||[];b={component:b,
options:c,id:f};a.push(b);c=d(b);for(f=a.length-1;0<f&&c<d(a[f-1]);)b=[a[f],a[f-1]],a[f-1]=b[0],a[f]=b[1],--f;return a};h.removeHighlight=function(a,b){return a?(a=a.filter(function(a){return a.id!==b}),0===a.length?null:a):a};h.generateHighlightedIndexRanges=function(a,c,d){if(c){if(l(d)){for(var f=d[0],e=d[d.length-1]-1,n=[],p=!k(a,d),r=0;r<c.length;++r){var t=c[r].options,u=c[r].component;if(null!==u)b(n,a,d,u,t);else if(p)g(n,a,d,f,e,t);else for(u=0;u<m(d);++u)b(n,a,d,u,t)}return 0<n.length?n:
null}var p=!a||!a.isVisibleBit;return p?c.map(function(a){return{range:null,options:a.options}}):null}return null};h.defaultVisibilities=c;h.isAllVisible=function(a,b){return!k(a,b)};h.isAllHidden=function(a,b){return!f(a,b)};h.hasVisible=f;h.hasHidden=k;var r=c();h.createOffsets=function(a){return Array.isArray(a)?new Uint32Array(a):a};h.hasComponent=function(a,b){return b<m(a)};h.hasComponents=l;var t=[];for(q=0;65>q;q++)t.push(Math.pow(2,q)-1);h.componentCount=m;h.componentFind=function(a,b){a=
e.binaryIndexOf(a,b,!0);return 0<=a?a:null}})},"esri/views/3d/webgl-engine/lib/doublePrecisionUtils":function(){define(["require","exports"],function(q,h){function e(a,d,c){for(var b=0;b<c;++b)d[2*b]=a[b],d[2*b+1]=a[b]-d[2*b]}Object.defineProperty(h,"__esModule",{value:!0});h.encodeDouble=function(a,g){d[0]=a;d[1]=a-d[0];g[0]=d[0];g[1]=d[1]};h.encodeDoubleArray=e;h.decodeDoubleArray=function(a,d,c){for(var b=0;b<c;++b)d[b]=a[2*b]+a[2*b+1]};h.encodeDoubleArraySplit=function(b,g,c,f){for(var k=0;k<
f;++k)a[0]=b[k],e(a,d,1),g[k]=d[0],c[k]=d[1]};var a=new Float64Array(1),d=new Float32Array(2)})},"esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":function(){define(["require","exports","./Util"],function(q,h,e){function a(a){return Math.abs(a*a*a)}function d(b,c,d,f){void 0===f&&(f=n);var g=d.parameters;d=d.paddingPixelsOverride;f.scale=Math.min(g.divisor/(c-g.offset),1);f.factor=a(b);f.minPixelSize=g.minPixelSize;f.paddingPixels=d;return f}function b(a,b){return 0===a?b.minPixelSize:b.minPixelSize*
(1+2*b.paddingPixels/a)}function g(a,c){return Math.max(e.lerp(a*c.scale,a,c.factor),b(a,c))}function c(a,b,c){a=d(a,b,c);a.minPixelSize=0;a.paddingPixels=0;return g(1,a)}Object.defineProperty(h,"__esModule",{value:!0});h.getSettings=function(a){return new f(a,h.defaultDescription)};h.getLabelSettings=function(a){var b=h.defaultDescription.curvatureDependent;return new f(a,{curvatureDependent:{min:{curvature:b.min.curvature,tiltAngle:b.min.tiltAngle,scaleFallOffFactor:k.curvatureDependent.min.scaleFallOffFactor},
max:{curvature:b.max.curvature,tiltAngle:b.max.tiltAngle,scaleFallOffFactor:k.curvatureDependent.max.scaleFallOffFactor}},scaleStart:h.defaultDescription.scaleStart,scaleFallOffRange:h.defaultDescription.scaleFallOffRange,minPixelSize:k.minPixelSize})};h.perspectiveFactor=a;h.scaleFactor=d;h.applyScaleFactor=g;h.applyScaleFactorVec2=function(a,c,d){void 0===d&&(d=[0,0]);var f=Math.min(Math.max(c.scale,b(a[1],c)/a[1]),1);d[0]=e.lerp(a[0]*f,a[0],c.factor);d[1]=e.lerp(a[1]*f,a[1],c.factor);return d};
h.precomputeScale=c;h.precomputeScaleFactor=function(a,b,d,f){f.scale=c(a,b,d);f.factor=0;f.minPixelSize=d.parameters.minPixelSize;f.paddingPixels=d.paddingPixelsOverride;return f};h.applyPrecomputedScaleFactorVec2=function(a,c,d){void 0===d&&(d=[0,0]);c=Math.min(Math.max(c.scale,b(a[1],c)/a[1]),1);d[0]=a[0]*c;d[1]=a[1]*c;return d};h.scale=function(a,b,c,f){return g(a,d(b,c,f))};var f=function(){function a(a,b,c,d){void 0===c&&(c={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0});
this.viewingMode=a;this.description=b;this.parameters=c;this._paddingPixelsOverride=d;"local"===this.viewingMode?(this.coverageCompensation=this.surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this.surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersGlobal)}Object.defineProperty(a.prototype,"paddingPixelsOverride",{get:function(){return this._paddingPixelsOverride||
this.parameters.paddingPixels},enumerable:!0,configurable:!0});a.prototype.update=function(a){if(this.parameters&&this.parameters.camera.fovY===a.fovY&&this.parameters.camera.distance===a.distance)return!1;this.calculateParameters(a,this.parameters);return!0};a.prototype.overridePadding=function(b){return b!==this.paddingPixelsOverride?new a(this.viewingMode,this.description,this.parameters,b):this};a.prototype.calculateParameters=function(a,b){var c=this.description,d=c.scaleStart,f=c.scaleFallOffRange,
c=c.minPixelSize,g=a.fovY,k=a.distance,l=this.calculateCurvatureDependentParameters(a),m=this.coverageCompensation(a,l),e=l.tiltAngle,l=l.scaleFallOffFactor,k=Math.sin(e)*k,e=.5*Math.PI-e-g*(.5-d*m),d=k/Math.cos(e),f=(d-k/Math.cos(e+g*f*m)*l)/(1-l);b.camera.fovY=a.fovY;b.camera.distance=a.distance;b.offset=f;b.divisor=d-f;b.minPixelSize=c;return b};a.prototype.calculateCurvatureDependentParametersLocal=function(a,b){void 0===b&&(b=l);b.tiltAngle=this.description.curvatureDependent.min.tiltAngle;b.scaleFallOffFactor=
this.description.curvatureDependent.min.scaleFallOffFactor;return b};a.prototype.calculateCurvatureDependentParametersGlobal=function(a,b){void 0===b&&(b=l);var c=this.description.curvatureDependent;a=1+a.distance/p;var d=[c.min.curvature,c.max.curvature],f=d[0];a=e.clamp((Math.sqrt(a*a-1)-f)/(d[1]-f),0,1);d=[c.min,c.max];c=d[0];d=d[1];b.tiltAngle=e.lerp(c.tiltAngle,d.tiltAngle,a);b.scaleFallOffFactor=e.lerp(c.scaleFallOffFactor,d.scaleFallOffFactor,a);return b};a.prototype.surfaceCoverageCompensationLocal=
function(a,b){return(a.fovY-b.tiltAngle)/a.fovY};a.prototype.surfaceCoverageCompensationGlobal=function(a,b){var c=p*p;b=b.tiltAngle+.5*Math.PI;var d=a.fovY;a=a.distance;a=a*a+c-2*Math.cos(b)*a*p;var f=Math.sqrt(a);return(Math.acos(Math.sqrt(a-c)/f)-Math.asin(p/(f/Math.sin(b)))+.5*d)/d};return a}();h.defaultDescription={curvatureDependent:{min:{curvature:e.deg2rad(10),tiltAngle:e.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:e.deg2rad(70),tiltAngle:e.deg2rad(40),scaleFallOffFactor:.8}},scaleStart:.3,
scaleFallOffRange:.65,minPixelSize:0};var k={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};h.copyParameters=function(a,b){b.camera.distance=a.camera.distance;b.camera.fovY=a.camera.fovY;b.divisor=a.divisor;b.offset=a.offset;b.minPixelSize=a.minPixelSize;return b};var n={scale:0,factor:0,minPixelSize:0,paddingPixels:0},l={tiltAngle:0,scaleFallOffFactor:0},p=6378137})},"esri/views/webgl/Util":function(){define(["require","exports","../../core/tsSupport/assignHelper",
"../../core/Error"],function(q,h,e,a){return function(){function d(){}d.vertexCount=function(a,g){return a.vertexBuffers[g].size/d.getStride(a.layout[g])};d.getStride=function(a){return a[0].stride};d.getBytesPerElement=function(a){switch(a){case 5126:return 4;case 5124:return 4;case 5125:return 4;case 5122:return 2;case 5123:return 2;case 5120:return 1;case 5121:return 1;default:throw Error("Unknown data type");}};d.addDescriptor=function(a,g,c,f,k,e){var b=d.getBytesPerElement(f);if(0<a.length){var n=
a[0].stride,m=n+b*c;a.forEach(function(a){return a.stride=m});a.push({name:g,count:c,type:f,offset:n,stride:m,normalized:k,divisor:e})}else a.push({name:g,count:c,type:f,offset:0,stride:b*c,normalized:k,divisor:e})};d.assertCompatibleVertexAttributeLocations=function(a,d){(a=a.locations===d.locations)||console.error("VertexAttributeLocations are incompatible");return a};d.hasAttribute=function(a,d){for(var b=0;b<a.length;b++)if(a[b].name===d)return!0;return!1};d.findAttribute=function(a,d){for(var b=
0;b<a.length;b++)if(a[b].name===d)return a[b];return null};d.copyFramebufferToTexture=function(a,d,c,f,k){void 0===k&&(k=0);var b=a.getBoundFramebufferObject(),g=a.getBoundTexture(0);a.bindFramebuffer(d);a.bindTexture(c,0);a.gl.copyTexImage2D(a.gl.TEXTURE_2D,k,c.descriptor.pixelFormat,f[0],f[1],f[2],f[3],0);a.gl.flush();a.bindFramebuffer(b);a.bindTexture(g,0)};d.assert=function(b,d){if(!b)throw new a(d);};d.setBaseInstanceOffset=function(a,d){var b={},f;for(f in a)b[f]=a[f].map(function(a){return a.divisor?
e({},a,{baseInstance:d}):a});return b};d.bindVertexBufferLayout=function(a,d,c,f,k){var b=a.gl,g=a.capabilities.instancing;a.bindBuffer(c);f.forEach(function(a){var c=d[a.name],f=(k?k:0+a.baseInstance?a.baseInstance:0)*a.stride;void 0===c&&console.error("There is no location for vertex attribute '"+a.name+"' defined.");a.baseInstance&&!a.divisor&&console.error("Vertex attribute '"+a.name+"' uses baseInstanceOffset without divisor.");if(4>=a.count)b.vertexAttribPointer(c,a.count,a.type,a.normalized,
a.stride,a.offset+f),b.enableVertexAttribArray(c),a.divisor&&0<a.divisor&&g&&g.vertexAttribDivisor(c,a.divisor);else if(9===a.count)for(var l=0;3>l;l++)b.vertexAttribPointer(c+l,3,a.type,a.normalized,a.stride,a.offset+12*l+f),b.enableVertexAttribArray(c+l),a.divisor&&0<a.divisor&&g&&g.vertexAttribDivisor(c+l,a.divisor);else if(16===a.count)for(l=0;4>l;l++)b.vertexAttribPointer(c+l,4,a.type,a.normalized,a.stride,a.offset+16*l+f),b.enableVertexAttribArray(c+l),a.divisor&&0<a.divisor&&g&&g.vertexAttribDivisor(c+
l,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)})};d.unbindVertexBufferLayout=function(a,d,c,f){var b=a.gl;a.bindBuffer(c);f.forEach(function(a){var c=d[a.name];if(4>=a.count)b.disableVertexAttribArray(c);else if(9===a.count)for(a=0;3>a;a++)b.disableVertexAttribArray(c+a);else if(16===a.count)for(a=0;4>a;a++)b.disableVertexAttribArray(c+a);else console.error("Unsupported vertex attribute element count: "+a.count)});a.unbindBuffer(34962)};return d}()})},"esri/views/webgl/BufferObject":function(){define(["require",
"exports","dojo/has","../3d/support/buffer/typedArrayUtil"],function(q,h,e,a){return function(){function d(a,g,c,f,k){this._glName=this._context=null;this._bufferType=void 0;this._usage=35044;this._size=-1;this._indexType=void 0;this._context=a;this._bufferType=g;this._usage=c;this._id=d._nextId++;this._glName=this._context.gl.createBuffer();f&&this.setData(f,k)}d.createIndex=function(a,g,c,f){return new d(a,34963,g,c,f)};d.createVertex=function(a,g,c){return new d(a,34962,g,c)};Object.defineProperty(d.prototype,
"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"usage",{get:function(){return this._usage},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"bufferType",{get:function(){return this._bufferType},enumerable:!0,
configurable:!0});Object.defineProperty(d.prototype,"indexType",{get:function(){return this._indexType},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"byteSize",{get:function(){return 34962===this._bufferType?this._size:5125===this._indexType?4*this._size:2*this._size},enumerable:!0,configurable:!0});d.prototype.dispose=function(){this._context&&(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context=null)};d.prototype.setData=function(b,d){if(b){if("number"===
typeof b){if(0>b&&console.error("Buffer size cannot be negative!"),34963===this._bufferType&&d)switch(this._indexType=d,this._size=b,d){case 5123:b*=2;break;case 5125:b*=4}}else d=b.byteLength,a.isUint16Array(b)&&(d/=2,this._indexType=5123),a.isUint32Array(b)&&(d/=4,this._indexType=5125),this._size=d,ArrayBuffer.isView(b)&&(b=b.buffer);d=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);this._context.gl.bufferData(this._bufferType,b,this._usage);this._context.bindVAO(d)}};
d.prototype.setSubData=function(b,d,c,f){void 0===d&&(d=0);void 0===c&&(c=0);if(b){(0>d||d>=this._size)&&console.error("offset is out of range!");var g=d,e=c,l=f,p=b.byteLength;a.isUint16Array(b)&&(p/=2,g*=2,e*=2,l*=2);a.isUint32Array(b)&&(p/=4,g*=4,e*=4,l*=4);void 0===f&&(f=p-1);c>=f&&console.error("end must be bigger than start!");d+c-f>this._size&&console.error("An attempt to write beyond the end of the buffer!");d=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);
c=this._context.gl;b=ArrayBuffer.isView(b)?b.buffer:b;c.bufferSubData(this._bufferType,g,b.slice(e,l));this._context.bindVAO(d)}};d._nextId=0;return d}()})},"esri/views/3d/support/buffer/typedArrayUtil":function(){define(["require","exports"],function(q,h){Object.defineProperty(h,"__esModule",{value:!0});h.forEach=function(e,a){if(e.forEach)e.forEach(a);else for(var d=0;d<e.length;d++)a(e[d],d,e)};h.slice=function(e,a,d){if(e.slice)return e.slice(a,d);void 0===a?a=0:(0>a&&(a+=e.length),a=Math.min(e.length,
Math.max(0,a)));void 0===d?d=e.length:(0>d&&(d+=e.length),d=Math.min(e.length,Math.max(0,d)));d=Math.max(0,d-a);for(var b=new e.constructor(d),g=0;g<d;g++)b[g]=e[a+g];return b};h.isArrayBuffer=function(e){return e instanceof ArrayBuffer||e&&e.constructor&&"ArrayBuffer"===e.constructor.name};h.isInt8Array=function(e){return e instanceof Int8Array||e&&e.constructor&&"Int8Array"===e.constructor.name};h.isUint8Array=function(e){return e instanceof Uint8Array||e&&e.constructor&&"Uint8Array"===e.constructor.name};
h.isInt16Array=function(e){return e instanceof Int16Array||e&&e.constructor&&"Int16Array"===e.constructor.name};h.isUint16Array=function(e){return e instanceof Uint16Array||e&&e.constructor&&"Uint16Array"===e.constructor.name};h.isInt32Array=function(e){return e instanceof Int32Array||e&&e.constructor&&"Int32Array"===e.constructor.name};h.isUint32Array=function(e){return e instanceof Uint32Array||e&&e.constructor&&"Uint32Array"===e.constructor.name};h.isFloat32Array=function(e){return e instanceof
Float32Array||e&&e.constructor&&"Float32Array"===e.constructor.name};h.isFloat64Array=function(e){return e instanceof Float64Array||e&&e.constructor&&"Float64Array"===e.constructor.name}})},"esri/views/webgl/VertexArrayObject":function(){define(["require","exports","dojo/has","./Util"],function(q,h,e,a){return function(){function d(a,g,c,f,k){this._locations=this._layout=this._glName=this._context=null;this._indexBuffer=this._buffers=void 0;this._initialized=!1;this._context=a;this._layout=c;this._buffers=
f;this._locations=g;k&&(this._indexBuffer=k);this._id=d._nextId++}Object.defineProperty(d.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"vertexBuffers",{get:function(){return this._buffers},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"indexBuffer",{get:function(){return this._indexBuffer},enumerable:!0,
configurable:!0});Object.defineProperty(d.prototype,"size",{get:function(){var a=this;return Object.keys(this._buffers).reduce(function(b,c){return b+a._buffers[c].size},this._indexBuffer?this._indexBuffer.size:0)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"layout",{get:function(){return this._layout},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"locations",{get:function(){return this._locations},enumerable:!0,configurable:!0});d.prototype.dispose=function(a){void 0===
a&&(a=!0);if(this._context){var b=this._context.capabilities.vao;b&&this._glName&&(b.deleteVertexArray(this._glName),this._glName=null);this._context.getBoundVAO()===this&&this._context.bindVAO(null);if(a){for(var c in this._buffers)this._buffers[c].dispose(),delete this._buffers[c];this._indexBuffer&&(this._indexBuffer.dispose(),this._indexBuffer=null)}this._context=null}};d.prototype.initialize=function(){if(!this._initialized){var a=this._context.capabilities.vao;if(a){var d=a.createVertexArray();
a.bindVertexArray(d);this._bindLayout();a.bindVertexArray(null);this._glName=d}this._initialized=!0}};d.prototype.bind=function(){this.initialize();var a=this._context.capabilities.vao;a?a.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())};d.prototype._bindLayout=function(){var b=this._buffers,d=!!this._context.capabilities.vao,c=this._layout,f=this._indexBuffer;b||console.error("Vertex buffer dictionary is empty!");var k=this._context.gl,e;for(e in b){var l=b[e];l||console.error("Vertex buffer is uninitialized!");
var p=c[e];p||console.error("Vertex element descriptor is empty!");a.bindVertexBufferLayout(this._context,this._locations,l,p)}f&&(d?k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,f.glName):this._context.bindBuffer(f))};d.prototype.unbind=function(){this.initialize();var a=this._context.capabilities.vao;a?a.bindVertexArray(null):this._unbindLayout()};d.prototype._unbindLayout=function(){var b=this._buffers,d=this._layout;b||console.error("Vertex buffer dictionary is empty!");for(var c in b){var f=b[c];f||console.error("Vertex buffer is uninitialized!");
a.unbindVertexBufferLayout(this._context,this._locations,f,d[c])}(b=this._indexBuffer)&&this._context.unbindBuffer(b.bufferType)};d._nextId=0;return d}()})},"esri/views/3d/webgl-engine/lib/GeometryUtil":function(){define("require exports ../../support/geometryUtils ./BufferVectorMath ./GeometryData ./gl-matrix ./Util".split(" "),function(q,h,e,a,d,b,g){function c(a,c,d,f,g){if(Math.abs(b.vec3.dot(c,a))>g)return!1;b.vec3.cross(a,c,d);b.vec3.normalize(d);b.vec3.cross(d,a,f);b.vec3.normalize(f);return!0}
var f=a.Vec3Compact,k;(function(a){for(var b=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],c=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],f=[0,0,1,0,1,1,0,1],k=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],l=Array(36),m=0;6>m;m++)for(var e=0;6>e;e++)l[6*m+e]=m;for(var n=Array(36),m=0;6>m;m++)n[6*m+0]=0,n[6*m+1]=1,n[6*m+2]=2,n[6*m+3]=2,n[6*m+4]=3,n[6*m+5]=0;a.createGeometry=function(a){Array.isArray(a)||(a=[a,a,a]);for(var m=
new Float32Array(24),e=0;8>e;e++)m[3*e]=b[e][0]*a[0],m[3*e+1]=b[e][1]*a[1],m[3*e+2]=b[e][2]*a[2];a={};a[g.VertexAttrConstants.POSITION]=new Uint32Array(k);a[g.VertexAttrConstants.NORMAL]=new Uint32Array(l);a[g.VertexAttrConstants.UV0]=new Uint32Array(n);e={};e[g.VertexAttrConstants.POSITION]={size:3,data:m};e[g.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(c)};e[g.VertexAttrConstants.UV0]={size:2,data:new Float32Array(f)};return new d(e,a)}})(k||(k={}));var n;(function(a){var b=[[-.5,
0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],c=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],f=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],k=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];a.createGeometry=function(a){Array.isArray(a)||(a=[a,a,a]);for(var l=new Float32Array(18),m=0;6>m;m++)l[3*m]=b[m][0]*a[0],l[3*m+1]=b[m][1]*a[1],l[3*m+2]=b[m][2]*a[2];a={};a[g.VertexAttrConstants.POSITION]=new Uint32Array(f);a[g.VertexAttrConstants.NORMAL]=new Uint32Array(k);m={};
m[g.VertexAttrConstants.POSITION]={size:3,data:l};m[g.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(c)};return new d(m,a)}})(n||(n={}));var l;(function(a){var c=b.vec3.createFrom(-.5,0,-.5),f=b.vec3.createFrom(.5,0,-.5),k=b.vec3.createFrom(0,0,.5),l=b.vec3.createFrom(0,.5,0),m=b.vec3.create(),e=b.vec3.create(),n=b.vec3.create(),p=b.vec3.create(),r=b.vec3.create();b.vec3.subtract(c,l,m);b.vec3.subtract(c,f,e);b.vec3.cross(m,e,n);b.vec3.normalize(n,n);b.vec3.subtract(f,l,m);b.vec3.subtract(f,
k,e);b.vec3.cross(m,e,p);b.vec3.normalize(p,p);b.vec3.subtract(k,l,m);b.vec3.subtract(k,c,e);b.vec3.cross(m,e,r);b.vec3.normalize(r,r);var t=[c,f,k,l],u=[0,-1,0,n[0],n[1],n[2],p[0],p[1],p[2],r[0],r[1],r[2]],h=[0,1,2,3,1,0,3,2,1,3,0,2],I=[0,0,0,1,1,1,2,2,2,3,3,3];a.createGeometry=function(a){Array.isArray(a)||(a=[a,a,a]);for(var b=new Float32Array(12),c=0;4>c;c++)b[3*c]=t[c][0]*a[0],b[3*c+1]=t[c][1]*a[1],b[3*c+2]=t[c][2]*a[2];a={};a[g.VertexAttrConstants.POSITION]=new Uint32Array(h);a[g.VertexAttrConstants.NORMAL]=
new Uint32Array(I);c={};c[g.VertexAttrConstants.POSITION]={size:3,data:b};c[g.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(u)};return new d(c,a)}})(l||(l={}));var p;(function(p){p.createBoxGeometry=k.createGeometry;p.createDiamondGeometry=n.createGeometry;p.createTetrahedronGeometry=l.createGeometry;p.createSphereGeometry=function(a,b,c,f,k,l,m){a=a||50;f=void 0!==f?f:-Math.PI;k=void 0!==k?k:2*Math.PI;l=void 0!==l?l:.5*-Math.PI;m=void 0!==m?m:Math.PI;var e=Math.max(3,Math.floor(b)||8),
n=Math.max(2,Math.floor(c)||6),p=(e+1)*(n+1);c=new Float32Array(3*p);b=new Float32Array(3*p);for(var p=new Float32Array(2*p),r=[],t=0,u=0;u<=n;u++){for(var v=[],y=u/n,h=l+y*m,x=Math.cos(h),A=0;A<=e;A++){var C=A/e,B=f+C*k,D=Math.cos(B)*x,q=Math.sin(h),B=-Math.sin(B)*x;c[3*t]=D*a;c[3*t+1]=q*a;c[3*t+2]=B*a;b[3*t]=D;b[3*t+1]=q;b[3*t+2]=B;p[2*t]=C;p[2*t+1]=y;v.push(t);++t}r.push(v)}a=new Uint32Array(2*e*(n-1)*3);for(u=t=0;u<n;u++)for(A=0;A<e;A++)f=r[u][A],k=r[u][A+1],l=r[u+1][A+1],m=r[u+1][A],0===u?(a[t++]=
f,a[t++]=l,a[t++]=m):u===n-1?(a[t++]=f,a[t++]=k,a[t++]=l):(a[t++]=f,a[t++]=k,a[t++]=l,a[t++]=l,a[t++]=m,a[t++]=f);g.assert(t===a.length);e={};e[g.VertexAttrConstants.POSITION]=a;e[g.VertexAttrConstants.NORMAL]=a;e[g.VertexAttrConstants.UV0]=a;n={};n[g.VertexAttrConstants.POSITION]={size:3,data:c};n[g.VertexAttrConstants.NORMAL]={size:3,data:b};n[g.VertexAttrConstants.UV0]={size:2,data:p};return new d(n,e)};p.createPolySphereGeometry=function(a,b,c){function k(b,c){b>c&&(c=[c,b],b=c[0],c=c[1]);var d=
b.toString()+"."+c.toString();if(e[d])return e[d];var g=l.length;l.length+=3;f.add(l,3*b,l,3*c,l,g);f.scale(l,g,a/f.length(l,g));g/=3;return e[d]=g}var l;c?(l=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],c=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1])):(c=a*(1+Math.sqrt(5))/2,l=[-a,c,0,a,c,0,-a,-c,0,a,-c,0,0,-a,c,0,a,c,0,-a,-c,0,a,-c,c,0,-a,c,0,a,-c,0,-a,-c,0,a],c=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,
9,5,2,4,11,6,2,10,8,6,7,9,8,1]));for(var m=0;m<l.length;m+=3)f.scale(l,m,a/f.length(l,m));for(var e={},m=0;m<b;m++){for(var n=c.length,p=new Uint32Array(4*n),r=0;r<n;r+=3){var t=c[r],u=c[r+1],v=c[r+2],h=k(t,u),x=k(u,v),A=k(v,t),q=4*r;p[q]=t;p[q+1]=h;p[q+2]=A;p[q+3]=u;p[q+4]=x;p[q+5]=h;p[q+6]=v;p[q+7]=A;p[q+8]=x;p[q+9]=h;p[q+10]=x;p[q+11]=A}c=p;e={}}b=new Float32Array(l);for(m=0;m<b.length;m+=3)f.normalize(b,m);m={};m[g.VertexAttrConstants.POSITION]=c;m[g.VertexAttrConstants.NORMAL]=c;c={};c[g.VertexAttrConstants.POSITION]=
{size:3,data:new Float32Array(l)};c[g.VertexAttrConstants.NORMAL]={size:3,data:b};return new d(c,m)};p.createPointGeometry=function(a,b,c,f,k,l,m){b=b?new Float32Array([b[0],b[1],b[2]]):new Float32Array([0,0,0]);a=a?new Float32Array([a[0],a[1],a[2]]):new Float32Array([0,0,1]);l=l?new Float32Array(l):new Float32Array([0,0]);var e=c?new Uint8Array([255*c[0],255*c[1],255*c[2],3<c.length?255*c[3]:255]):new Uint8Array([255,255,255,255]),n=null!=f&&2===f.length?new Float32Array(f):new Float32Array([1,1]);
f=new Uint32Array([0]);c={};c[g.VertexAttrConstants.POSITION]=f;c[g.VertexAttrConstants.NORMAL]=f;c[g.VertexAttrConstants.UV0]=f;c[g.VertexAttrConstants.COLOR]=f;c[g.VertexAttrConstants.SIZE]=f;var p={};p[g.VertexAttrConstants.POSITION]={size:3,data:b};p[g.VertexAttrConstants.NORMAL]={size:3,data:a};p[g.VertexAttrConstants.UV0]={size:l.length,data:l};p[g.VertexAttrConstants.COLOR]={size:4,data:e};p[g.VertexAttrConstants.SIZE]={size:2,data:n};null!=k&&(k=new Float32Array([k[0],k[1],k[2],k[3]]),c[g.VertexAttrConstants.AUXPOS1]=
f,p[g.VertexAttrConstants.AUXPOS1]={size:4,data:k});null!=m&&(m=new Float32Array([m[0],m[1],m[2],m[3]]),c[g.VertexAttrConstants.AUXPOS2]=f,p[g.VertexAttrConstants.AUXPOS2]={size:4,data:m});return new d(p,c,d.DefaultOffsets,"point")};p.createPointArrayGeometry=function(a,b){for(var c=new Float32Array(3*a.length),f=new Float32Array(b?3*a.length:3),k=new Uint32Array(a.length),l=new Uint32Array(a.length),m=0;m<a.length;m++)c[3*m]=a[m][0],c[3*m+1]=a[m][1],c[3*m+2]=a[m][2],b&&(f[3*m]=b[m][0],f[3*m+1]=b[m][1],
f[3*m+2]=b[m][2]),k[m]=m,l[m]=0;b||(f[0]=0,f[1]=1,f[2]=0);a=new Float32Array(2);a[0]=0;a[1]=0;m={};m[g.VertexAttrConstants.POSITION]=k;m[g.VertexAttrConstants.NORMAL]=b?k:l;m[g.VertexAttrConstants.UV0]=l;b={};b[g.VertexAttrConstants.POSITION]={size:3,data:c};b[g.VertexAttrConstants.NORMAL]={size:3,data:f};b[g.VertexAttrConstants.UV0]={size:2,data:a};return new d(b,m,d.DefaultOffsets,"point")};p.createTriangleGeometry=function(){var a=new Float32Array([0,0,0,0,0,100,100,0,0]),b=new Uint32Array([0,
1,2]),c=new Float32Array([0,1,0]),f=new Uint32Array([0,0,0]),k=new Float32Array([0,0]),m=new Uint32Array([0,0,0]),l={};l[g.VertexAttrConstants.POSITION]=b;l[g.VertexAttrConstants.NORMAL]=f;l[g.VertexAttrConstants.UV0]=m;b={};b[g.VertexAttrConstants.POSITION]={size:3,data:a};b[g.VertexAttrConstants.NORMAL]={size:3,data:c};b[g.VertexAttrConstants.UV0]={size:2,data:k};return new d(b,l)};p.createSquareGeometry=function(a){var b=new Float32Array(12);if(a)for(var c=0;4>c;c++)for(var f=0;3>f;f++)b[3*c+f]=
a[c][f];else b[0]=-1,b[1]=-1,b[2]=0,b[3]=1,b[4]=-1,b[5]=0,b[6]=1,b[7]=1,b[8]=0,b[9]=-1,b[10]=1,b[11]=0;var k=new Uint32Array([0,1,2,2,3,0]);a=new Float32Array([0,0,1]);var m=new Uint32Array([0,0,0,0,0,0]),c=new Float32Array([0,0,1,0,1,1,0,1]),f=new Uint8Array([255,255,255,255]),l={};l[g.VertexAttrConstants.POSITION]=k;l[g.VertexAttrConstants.NORMAL]=m;l[g.VertexAttrConstants.UV0]=k;l[g.VertexAttrConstants.COLOR]=m;k={};k[g.VertexAttrConstants.POSITION]={size:3,data:b};k[g.VertexAttrConstants.NORMAL]=
{size:3,data:a};k[g.VertexAttrConstants.UV0]={size:2,data:c};k[g.VertexAttrConstants.COLOR]={size:4,data:f};return new d(k,l)};p.createConeGeometry=function(a,c,f,k){var m=0,l=b.vec3.createFrom(0,m,0),e=b.vec3.createFrom(0,m+a,0),n=b.vec3.createFrom(0,-1,0),p=b.vec3.createFrom(0,1,0);k&&(m=a,e=b.vec3.createFrom(0,0,0),l=b.vec3.createFrom(0,m,0),n=b.vec3.createFrom(0,1,0),p=b.vec3.createFrom(0,-1,0));l=[e,l];n=[n,p];p=f+2;e=Math.sqrt(a*a+c*c);if(k)for(k=f-1;0<=k;k--)r=2*Math.PI/f*k,t=b.vec3.createFrom(Math.cos(r)*
c,m,Math.sin(r)*c),l.push(t),r=b.vec3.createFrom(a*Math.cos(r)/e,-c/e,a*Math.sin(r)/e),n.push(r);else for(k=0;k<f;k++){var r=2*Math.PI/f*k,t=b.vec3.createFrom(Math.cos(r)*c,m,Math.sin(r)*c);l.push(t);r=b.vec3.createFrom(a*Math.cos(r)/e,c/e,a*Math.sin(r)/e);n.push(r)}a=new Uint32Array(6*(f+2));f=new Uint32Array(6*(f+2));m=c=0;for(k=3;k<l.length;k++)a[c++]=1,a[c++]=k-1,a[c++]=k,f[m++]=0,f[m++]=0,f[m++]=0;a[c++]=l.length-1;a[c++]=2;a[c++]=1;f[m++]=0;f[m++]=0;f[m++]=0;for(k=3;k<l.length;k++)a[c++]=k,
a[c++]=k-1,a[c++]=0,f[m++]=k,f[m++]=k-1,f[m++]=1;a[c++]=0;a[c++]=2;a[c++]=l.length-1;f[m++]=1;f[m++]=2;f[m++]=n.length-1;c=new Float32Array(3*p);for(k=0;k<p;k++)c[3*k]=l[k][0],c[3*k+1]=l[k][1],c[3*k+2]=l[k][2];l=new Float32Array(3*p);for(k=0;k<p;k++)l[3*k]=n[k][0],l[3*k+1]=n[k][1],l[3*k+2]=n[k][2];n={};n[g.VertexAttrConstants.POSITION]=a;n[g.VertexAttrConstants.NORMAL]=f;p={};p[g.VertexAttrConstants.POSITION]={size:3,data:c};p[g.VertexAttrConstants.NORMAL]={size:3,data:l};return new d(p,n)};p.createCylinderGeometry=
function(a,c,f,k,m,l){k=k?b.vec3.create(k):b.vec3.createFrom(1,0,0);m=m?b.vec3.create(m):b.vec3.createFrom(0,0,0);l=void 0===l?!0:l;var e=b.vec3.create();b.vec3.normalize(k,e);k=b.vec3.create();b.vec3.scale(e,Math.abs(a),k);var n=b.vec3.create();b.vec3.scale(k,-.5,n);b.vec3.add(n,m);var p=b.vec3.createFrom(0,1,0);.2>Math.abs(1-b.vec3.dot(e,p))&&b.vec3.set3(0,0,1,p);var r=b.vec3.create();b.vec3.cross(e,p,r);b.vec3.normalize(r);b.vec3.cross(r,e,p);var t=2*f+(l?2:0),u=f+(l?2:0);a=new Float32Array(3*
t);m=new Float32Array(3*u);var v=new Float32Array(2*t),h=new Uint32Array(3*f*(l?4:2)),y=new Uint32Array(3*f*(l?4:2));l&&(a[3*(t-2)+0]=n[0],a[3*(t-2)+1]=n[1],a[3*(t-2)+2]=n[2],v[2*(t-2)]=0,v[2*(t-2)+1]=0,a[3*(t-1)+0]=a[3*(t-2)+0]+k[0],a[3*(t-1)+1]=a[3*(t-2)+1]+k[1],a[3*(t-1)+2]=a[3*(t-2)+2]+k[2],v[2*(t-1)]=1,v[2*(t-1)+1]=1,m[3*(u-2)+0]=-e[0],m[3*(u-2)+1]=-e[1],m[3*(u-2)+2]=-e[2],m[3*(u-1)+0]=e[0],m[3*(u-1)+1]=e[1],m[3*(u-1)+2]=e[2]);for(var e=function(a,b,c){h[a]=b;y[a]=c},x=0,C=b.vec3.create(),A=
b.vec3.create(),B=0;B<f;B++){var q=2*Math.PI/f*B;b.vec3.scale(p,Math.sin(q),C);b.vec3.scale(r,Math.cos(q),A);b.vec3.add(C,A);m[3*B+0]=C[0];m[3*B+1]=C[1];m[3*B+2]=C[2];b.vec3.scale(C,c);b.vec3.add(C,n);a[3*B+0]=C[0];a[3*B+1]=C[1];a[3*B+2]=C[2];v[2*B+0]=B/f;v[2*B+1]=0;a[3*(B+f)+0]=a[3*B+0]+k[0];a[3*(B+f)+1]=a[3*B+1]+k[1];a[3*(B+f)+2]=a[3*B+2]+k[2];v[2*(B+f)+0]=B/f;v[2*B+1]=1;q=(B+1)%f;e(x++,B,B);e(x++,B+f,B);e(x++,q,q);e(x++,q,q);e(x++,B+f,B);e(x++,q+f,q)}if(l){for(B=0;B<f;B++)q=(B+1)%f,e(x++,t-2,u-
2),e(x++,B,u-2),e(x++,q,u-2);for(B=0;B<f;B++)q=(B+1)%f,e(x++,B+f,u-1),e(x++,t-1,u-1),e(x++,q+f,u-1)}c={};c[g.VertexAttrConstants.POSITION]=h;c[g.VertexAttrConstants.NORMAL]=y;c[g.VertexAttrConstants.UV0]=h;f={};f[g.VertexAttrConstants.POSITION]={size:3,data:a};f[g.VertexAttrConstants.NORMAL]={size:3,data:m};f[g.VertexAttrConstants.UV0]={size:2,data:v};return new d(f,c)};p.createTubeGeometry=function(a,b,c,d,f){c=c||10;d=null!=d?d:!0;g.assert(1<a.length);for(var k=[],m=[],l=0;l<c;l++){k.push([0,-l-
1,-((l+1)%c)-1]);var e=l/c*2*Math.PI;m.push([Math.cos(e)*b,Math.sin(e)*b])}return p.createPathExtrusionGeometry(m,a,[[0,0,0]],k,d,f)};p.createPathExtrusionGeometry=function(a,f,k,l,n,p){var r=a.length,t=new Float32Array(f.length*r*3+(6*k.length||0)),u=new Float32Array(f.length*r+(2*k.length||0)),v=new Float32Array(f.length*r*3+(k?6:0)),h=(f.length-1)*r*6+6*l.length,y=new Uint32Array(h),h=new Uint32Array(h),x=0,C=0,A=0,B=0,q=0,U=b.vec3.create(),N=b.vec3.create(),S=b.vec3.create(),aa=b.vec3.create(),
V=b.vec3.create(),T=b.vec3.create(),Q=b.vec3.create(),G=b.vec3.create(),X=b.vec3.create(),Z=b.vec3.create(),ea=b.vec3.create(),fa=b.vec3.create(),R=b.vec3.create(),da=e.plane.create();b.vec3.set3(0,1,0,X);b.vec3.subtract(f[1],f[0],N);b.vec3.normalize(N);n?(b.vec3.add(f[0],p,G),b.vec3.normalize(G,S)):b.vec3.set3(0,0,1,S);var ba=m;c(N,S,V,S,ba)||c(N,X,V,S,ba)||c(N,X,V,S,ba);b.vec3.set(S,aa);b.vec3.set(V,fa);for(var ca=0;ca<k.length;ca++)b.vec3.scale(V,k[ca][0],T),b.vec3.scale(S,k[ca][2],G),b.vec3.add(T,
G),b.vec3.add(T,f[0]),t[x++]=T[0],t[x++]=T[1],t[x++]=T[2],u[A++]=0;v[C++]=-N[0];v[C++]=-N[1];v[C++]=-N[2];for(ca=0;ca<l.length;ca++)y[B++]=0<l[ca][0]?l[ca][0]:-l[ca][0]-1+k.length,y[B++]=0<l[ca][1]?l[ca][1]:-l[ca][1]-1+k.length,y[B++]=0<l[ca][2]?l[ca][2]:-l[ca][2]-1+k.length,h[q++]=0,h[q++]=0,h[q++]=0;for(var ba=k.length,ca=k.length-1,ga=0;ga<f.length;ga++){var ja=!1;if(0<ga){b.vec3.set(N,U);ga<f.length-1?(b.vec3.subtract(f[ga+1],f[ga],N),b.vec3.normalize(N)):ja=!0;b.vec3.add(U,N,Z);b.vec3.normalize(Z);
b.vec3.add(f[ga-1],aa,ea);e.plane.fromPositionAndNormal(f[ga],Z,da);if(e.plane.intersectRay(da,ea,U,G))b.vec3.subtract(G,f[ga]),b.vec3.normalize(G,S),b.vec3.cross(Z,S,V),b.vec3.normalize(V);else{var ha=Z,W=fa,na=X,ka=V,la=S,w=m;c(ha,aa,ka,la,w)||c(ha,W,ka,la,w)||c(ha,na,ka,la,w)}b.vec3.set(S,aa);b.vec3.set(V,fa)}n&&(b.vec3.add(f[ga],p,G),b.vec3.normalize(G,R));for(ha=0;ha<r;ha++)if(b.vec3.scale(V,a[ha][0],T),b.vec3.scale(S,a[ha][1],G),b.vec3.add(T,G),b.vec3.normalize(T,Q),v[C++]=Q[0],v[C++]=Q[1],
v[C++]=Q[2],n?u[A++]=b.vec3.dot(T,R):u[A++]=T[2],b.vec3.add(T,f[ga]),t[x++]=T[0],t[x++]=T[1],t[x++]=T[2],!ja)for(W=(ha+1)%r,y[B++]=ba+ha,y[B++]=ba+r+ha,y[B++]=ba+W,y[B++]=ba+W,y[B++]=ba+r+ha,y[B++]=ba+r+W,W=0;6>W;W++)h[q++]=y[B-6+W]-ca;ba+=r}a=f[f.length-1];for(ca=0;ca<k.length;ca++)b.vec3.scale(V,k[ca][0],T),b.vec3.scale(S,k[ca][1],G),b.vec3.add(T,G),b.vec3.add(T,a),t[x++]=T[0],t[x++]=T[1],t[x++]=T[2],u[A++]=0;k=C/3;v[C++]=N[0];v[C++]=N[1];v[C++]=N[2];r=ba-r;for(ca=0;ca<l.length;ca++)y[B++]=0<=l[ca][0]?
ba+l[ca][0]:-l[ca][0]-1+r,y[B++]=0<=l[ca][2]?ba+l[ca][2]:-l[ca][2]-1+r,y[B++]=0<=l[ca][1]?ba+l[ca][1]:-l[ca][1]-1+r,h[q++]=k,h[q++]=k,h[q++]=k;l={};l[g.VertexAttrConstants.POSITION]=y;l[g.VertexAttrConstants.NORMAL]=h;y={};y[g.VertexAttrConstants.POSITION]={size:3,data:t};y.zOffset={size:1,data:u};y[g.VertexAttrConstants.NORMAL]={size:3,data:v};return new d(y,l)};p.createPolylineGeometry=function(a,b){g.assert(1<a.length,"createPolylineGeometry(): polyline needs at least 2 points");g.assert(3===a[0].length,
"createPolylineGeometry(): malformed vertex");g.assert(void 0===b||b.length===a.length,"createPolylineGeometry: need same number of points and normals");g.assert(void 0===b||3===b[0].length,"createPolylineGeometry(): malformed normal");for(var c=new Float32Array(3*a.length),f=new Uint32Array(2*(a.length-1)),k=0,l=0,m=0;m<a.length;m++){for(var e=0;3>e;e++)c[k++]=a[m][e];0<m&&(f[l++]=m-1,f[l++]=m)}k={};l={};k[g.VertexAttrConstants.POSITION]=f;l[g.VertexAttrConstants.POSITION]={size:3,data:c};if(b){for(var c=
new Float32Array(3*b.length),n=0,m=0;m<a.length;m++)for(e=0;3>e;e++)c[n++]=b[m][e];k[g.VertexAttrConstants.NORMAL]=f;l[g.VertexAttrConstants.NORMAL]={size:3,data:c}}return new d(l,k,d.DefaultOffsets,"line")};p.addVertexColors=function(a,b){var c=b||[1,1,1,1];b=new Uint8Array(4);b[0]=255*c[0];b[1]=255*c[1];b[2]=255*c[2];b[3]=255*(3<c.length?c[3]:1);var c={},f=a.getVertexAttr(),k;for(k in f)c[k]=f[k];c[g.VertexAttrConstants.COLOR]={size:4,data:b};b={};for(k in a.indices)b[k]=a.indices[k];b[g.VertexAttrConstants.COLOR]=
new Uint32Array(b[g.VertexAttrConstants.POSITION].length);return a=new d(c,b,a.componentOffsets,a.primitiveType)};p.addNormals=function(c){var d=c.getVertexAttr();c=c.indices;for(var f=a.Vec3Compact.subtract,k=new Float32Array(c.position.length/3*3),l=d.position.data,m=0,e=c.position,n=new Uint32Array(e.length),p=0;p<e.length;p+=3){f(l,3*e[p],l,3*e[p+2],t,0);f(l,3*e[p],l,3*e[p+1],r,0);b.vec3d.cross(r,t);b.vec3d.normalize(r);var u=m/3;k[m++]=r[0];k[m++]=r[1];k[m++]=r[2];n[p]=u;n[p+1]=u;n[p+2]=u}d[g.VertexAttrConstants.NORMAL]=
{size:3,data:k,offsetIdx:0,strideIdx:3};c[g.VertexAttrConstants.NORMAL]=n};p.cgToGIS=function(a,b){void 0===b&&(b=a);var c=a.getVertexAttr();a=c.position.data;var c=c.normal.data,d=b.getVertexAttr(),f=d.position.data,d=d.normal.data;if(c)for(var g=0;g<c.length;g+=3){var k=c[g+1];d[g+1]=-c[g+2];d[g+2]=k}if(a)for(g=0;g<a.length;g+=3)k=a[g+1],f[g+1]=-a[g+2],f[g+2]=k;return b}})(p||(p={}));var m=.99619469809,r=b.vec3.create(),t=b.vec3.create();return p})},"esri/views/3d/webgl-engine/lib/GeometryData":function(){define(["require",
"exports","./ComponentUtils","./geometryDataUtils","./Util"],function(q,h,e,a,d){return function(){function b(g,c,f,k){void 0===c&&(c=b.DefaultIndices);void 0===f&&(f=b.DefaultOffsets);void 0===k&&(k="triangle");this.preinterleaved=!1;var n={},l;for(l in g){var p=g[l],m=p.size;n[l]={data:p.data,size:m,offsetIdx:0,strideIdx:m}}if(c===b.DefaultIndices){c=d.getFirstObjectValue(n);g=a.generateDefaultIndexArray(c.data.length/c.size);c={};for(var r in n)c[r]=g}this._id=a.getNewId();this._vertexAttributes=
n;this._indices=c;this._componentOffsets=e.createOffsets(f);this._primitiveType=k}Object.defineProperty(b.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"vertexAttributes",{get:function(){return this._vertexAttributes},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"indices",{get:function(){return this._indices},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"componentOffsets",{get:function(){return this._componentOffsets},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"indexCount",{get:function(){return d.getFirstObjectValue(this._indices).length},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"primitiveType",{get:function(){return this._primitiveType},enumerable:!0,configurable:!0});b.prototype.getVertexAttr=function(){return this.vertexAttributes};b.prototype.toRenderData=function(){return{id:this._id.toString(),preinterleaved:!1,indices:this._indices,vertexAttr:this._vertexAttributes}};
b.prototype.getIndices=function(a){return this._indices[a]};b.prototype.getAttribute=function(a){return this._vertexAttributes[a]};b.prototype.estimateGpuMemoryUsage=function(){var a=0;this._indices.position&&(a+=12*this._indices.position.length);this._indices.normal&&(a+=12*this._indices.normal.length);this._indices.uv0&&(a+=8*this._indices.uv0.length);this._indices.color&&(a+=4*this._indices.color.length);return a};b.DefaultIndices={};b.DefaultOffsets=new Uint32Array(0);return b}()})},"esri/views/3d/webgl-engine/lib/geometryDataUtils":function(){define(["require",
"exports"],function(q,h){Object.defineProperty(h,"__esModule",{value:!0});var e=1,a=null;h.generateDefaultIndexArray=function(b){if(b>e||null==a){for(;b>e;)e*=2;a=new Uint32Array(e);for(var d=0;d<e;d++)a[d]=d}return new Uint32Array(a.buffer,0,b)};var d=0;h.getNewId=function(){return d++}})},"esri/views/3d/webgl-engine/lib/RenderPass":function(){define(["require","exports"],function(q,h){var e;q=e||(e={});q[q.MATERIAL=0]="MATERIAL";q[q.MATERIAL_DEPTH=1]="MATERIAL_DEPTH";q[q.MATERIAL_NORMAL=2]="MATERIAL_NORMAL";
q[q.MATERIAL_DEPTH_SHADOWMAP=3]="MATERIAL_DEPTH_SHADOWMAP";q[q.MATERIAL_HIGHLIGHT=4]="MATERIAL_HIGHLIGHT";q[q.MAX_PASS=5]="MAX_PASS";return e})},"esri/views/3d/webgl-engine/lib/RenderSlot":function(){define(["require","exports"],function(q,h){var e;q=e||(e={});q[q.BACKGROUND=0]="BACKGROUND";q[q.INTERNAL_MATERIAL=1]="INTERNAL_MATERIAL";q[q.STENCIL_MATERIAL=2]="STENCIL_MATERIAL";q[q.OPAQUE_TERRAIN=3]="OPAQUE_TERRAIN";q[q.OPAQUE_MATERIAL=4]="OPAQUE_MATERIAL";q[q.OPAQUE_EXTERNAL=5]="OPAQUE_EXTERNAL";
q[q.TRANSPARENT_MATERIAL=6]="TRANSPARENT_MATERIAL";q[q.TRANSPARENT_EXTERNAL=7]="TRANSPARENT_EXTERNAL";q[q.TRANSPARENT_TERRAIN=8]="TRANSPARENT_TERRAIN";q[q.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS";q[q.POSTPROCESSING_HIGHLIGHT=10]="POSTPROCESSING_HIGHLIGHT";q[q.POSTPROCESSING_ATMOSPHERE_OPAQUE=11]="POSTPROCESSING_ATMOSPHERE_OPAQUE";q[q.POSTPROCESSING_ATMOSPHERE_TRANSPARENT=12]="POSTPROCESSING_ATMOSPHERE_TRANSPARENT";q[q.POSTPROCESSING_EXTERNAL=13]="POSTPROCESSING_EXTERNAL";q[q.HUDMATERIAL1=14]="HUDMATERIAL1";
q[q.HUDMATERIAL2=15]="HUDMATERIAL2";q[q.LINE_CALLOUTS=16]="LINE_CALLOUTS";q[q.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH";q[q.MAX_SLOTS=18]="MAX_SLOTS";return e})},"esri/views/webgl/Program":function(){define(["require","exports","dojo/has","./ShaderTranspiler"],function(q,h,e,a){return function(){function d(a,g,c,f,k){void 0===k&&(k={});this._glName=this._context=null;this._locations={};this._id=void 0;this._initialized=!1;this._fShader=this._vShader=null;this._defines={};this._nameToUniformLocation=
{};this._nameToAttribLocation={};this._nameToUniform1={};this._nameToUniform2={};this._nameToUniform3={};this._nameToUniform4={};this._nameToUniformMatrix3={};this._nameToUniformMatrix4={};a||console.error("RenderingContext isn't initialized!");0===g.length&&console.error("Shaders source should not be empty!");this._context=a;this._vertexShaderSource=g;this._fragmentShaderSource=c;if(Array.isArray(k))for(a=0;a<k.length;a++)this._defines[k[a]]="1";else this._defines=k;this._id=d._nextId++;this._locations=
f}Object.defineProperty(d.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"locations",{get:function(){return this._locations},enumerable:!0,configurable:!0});d.prototype.getDefine=function(a){return this._defines[a]};d.prototype.dispose=function(){if(this._context){var a=this._context.gl;this._vShader&&(a.deleteShader(this._vShader),
this._vShader=null);this._fShader&&(a.deleteShader(this._fShader),this._fShader=null);this._glName&&(a.deleteProgram(this._glName),this._glName=null);this._context=null}};d.prototype.initialize=function(){if(!this._initialized){this._vShader=this._loadShader(35633);this._fShader=this._loadShader(35632);this._vShader&&this._fShader||console.error("Error loading shaders!");var a=this._context.gl,d=a.createProgram();a.attachShader(d,this._vShader);a.attachShader(d,this._fShader);for(var c in this._locations)a.bindAttribLocation(d,
this._locations[c],c);a.linkProgram(d);a.getProgramParameter(d,a.LINK_STATUS)||console.error("Could not initialize shader\nVALIDATE_STATUS: "+a.getProgramParameter(d,a.VALIDATE_STATUS)+", gl error ["+a.getError()+"]infoLog: "+a.getProgramInfoLog(d));this._glName=d;this._initialized=!0}};d.prototype.getUniformLocation=function(a){this.initialize();void 0===this._nameToUniformLocation[a]&&(this._nameToUniformLocation[a]=this._context.gl.getUniformLocation(this._glName,a));return this._nameToUniformLocation[a]};
d.prototype.hasUniform=function(a){return null!==this.getUniformLocation(a)};d.prototype.getAttribLocation=function(a){this.initialize();void 0===this._nameToAttribLocation[a]&&(this._nameToAttribLocation[a]=this._context.gl.getAttribLocation(this._glName,a));return this._nameToAttribLocation[a]};d.prototype.setUniform1i=function(a,d){var b=this._nameToUniform1[a];if(void 0===b||d!==b)this._context.bindProgram(this),this._context.gl.uniform1i(this.getUniformLocation(a),d),this._nameToUniform1[a]=
d};d.prototype.setUniform1f=function(a,d){var b=this._nameToUniform1[a];if(void 0===b||d!==b)this._context.bindProgram(this),this._context.gl.uniform1f(this.getUniformLocation(a),d),this._nameToUniform1[a]=d};d.prototype.setUniform1fv=function(a,g){var b=this._nameToUniform2[a];void 0!==b&&d._arraysEqual(g,b)||(this._context.bindProgram(this),this._context.gl.uniform1fv(this.getUniformLocation(a),g),void 0===b?this._nameToUniform2[a]=new Float32Array(g):b.set(g))};d.prototype.setUniform2f=function(a,
d,c){var b=this._nameToUniform2[a];if(void 0===b||d!==b[0]||c!==b[1])this._context.bindProgram(this),this._context.gl.uniform2f(this.getUniformLocation(a),d,c),void 0===b?this._nameToUniform2[a]=new Float32Array([d,c]):(b[0]=d,b[1]=c)};d.prototype.setUniform2fv=function(a,g){var b=this._nameToUniform2[a];void 0!==b&&d._arraysEqual(g,b)||(this._context.bindProgram(this),this._context.gl.uniform2fv(this.getUniformLocation(a),g),void 0===b?this._nameToUniform2[a]=new Float32Array(g):b.set(g))};d.prototype.setUniform3f=
function(a,d,c,f){var b=this._nameToUniform3[a];if(void 0===b||d!==b[0]||c!==b[1]||f!==b[2])this._context.bindProgram(this),this._context.gl.uniform3f(this.getUniformLocation(a),d,c,f),void 0===b?this._nameToUniform3[a]=new Float32Array([d,c,f]):(b[0]=d,b[1]=c,b[2]=f)};d.prototype.setUniform3fv=function(a,g){var b=this._nameToUniform3[a];void 0!==b&&d._arraysEqual(g,b)||(this._context.bindProgram(this),this._context.gl.uniform3fv(this.getUniformLocation(a),g),void 0===b?this._nameToUniform3[a]=new Float32Array(g):
b.set(g))};d.prototype.setUniform4f=function(a,d,c,f,k){var b=this._nameToUniform4[a];if(void 0===b||d!==b[0]||c!==b[1]||f!==b[2]||k!==b[3])this._context.bindProgram(this),this._context.gl.uniform4f(this.getUniformLocation(a),d,c,f,k),void 0===b?this._nameToUniform4[a]=new Float32Array([d,c,f,k]):(b[0]=d,b[1]=c,b[2]=f,b[3]=k)};d.prototype.setUniform4fv=function(a,g){var b=this._nameToUniform4[a];void 0!==b&&d._arraysEqual(g,b)||(this._context.bindProgram(this),this._context.gl.uniform4fv(this.getUniformLocation(a),
g),void 0===b?this._nameToUniform4[a]=new Float32Array(g):b.set(g))};d.prototype.setUniformMatrix3fv=function(a,g,c){void 0===c&&(c=!1);var b=this._nameToUniformMatrix3[a];void 0!==b&&(9===b.length?d._matrix3Equal(b,g):d._arraysEqual(g,b))||(this._context.bindProgram(this),this._context.gl.uniformMatrix3fv(this.getUniformLocation(a),c,g),void 0===b?this._nameToUniformMatrix3[a]=new Float32Array(g):b.set(g))};d.prototype.setUniformMatrix4fv=function(a,g,c){void 0===c&&(c=!1);var b=this._nameToUniformMatrix4[a];
void 0!==b&&(16===b.length?d._matrix4Equal(b,g):d._arraysEqual(g,b))||(this._context.bindProgram(this),this._context.gl.uniformMatrix4fv(this.getUniformLocation(a),c,g),void 0===b?this._nameToUniformMatrix4[a]=new Float32Array(g):b.set(g))};d._padToThree=function(a){var b=a.toString();1E3>a&&(b=("  "+a).slice(-3));return b};d.prototype._addLineNumbers=function(a){var b=2;return a.replace(/\n/g,function(){return"\n"+d._padToThree(b++)+":"})};d.prototype._loadShader=function(b){var d=35633===b,c=d?
this._vertexShaderSource:this._fragmentShaderSource,f;f="";for(var k in this._defines)f+="#define "+k+" "+this._defines[k]+"\n";f+=c;"webgl2"===this._context.contextVersion&&(f=a.transpileShader(f,d?"vertex":"fragment"));d=this._context.gl;b=d.createShader(b);d.shaderSource(b,f);d.compileShader(b);d.getShaderParameter(b,d.COMPILE_STATUS)||(console.error(d.getShaderInfoLog(b)),console.error(this._addLineNumbers(f)),"webgl2"===this._context.contextVersion&&(console.log("Shader source before transpilation:"),
console.log(c)));return b};d._matrix4Equal=function(a,d){return a[0]===d[0]&&a[1]===d[1]&&a[2]===d[2]&&a[3]===d[3]&&a[4]===d[4]&&a[5]===d[5]&&a[6]===d[6]&&a[7]===d[7]&&a[8]===d[8]&&a[9]===d[9]&&a[10]===d[10]&&a[11]===d[11]&&a[12]===d[12]&&a[13]===d[13]&&a[14]===d[14]&&a[15]===d[15]};d._matrix3Equal=function(a,d){return a[0]===d[0]&&a[1]===d[1]&&a[2]===d[2]&&a[3]===d[3]&&a[4]===d[4]&&a[5]===d[5]&&a[6]===d[6]&&a[7]===d[7]&&a[8]===d[8]};d._arraysEqual=function(a,d){if(a.length!==d.length)return!1;for(var b=
0;b<a.length;++b)if(a[b]!==d[b])return!1;return!0};d._nextId=0;return d}()})},"esri/views/webgl/ShaderTranspiler":function(){define(["require","exports","./reservedWordsGLSL3","./lib/glsl-tokenizer/string"],function(q,h,e,a){function d(a){return a.map(function(a){return"eof"!==a.type?a.data:""}).join("")}function b(a,c,d,g){g=g||d;for(var f=0;f<a.length;f++){var k=a[f];if("ident"===k.type&&k.data===d)return g in c?c[g]++:c[g]=0,b(a,c,g+"_"+c[g],g)}return d}function g(a,b,c){void 0===c&&(c="afterVersion");
var d={data:"\n",type:"whitespace"},f=function(b){return b<a.length?/[^\r\n]$/.test(a[b].data):!1},g=function(a){for(var b=-1,d=0,f=-1,g=0;g<a.length;g++){var k=a[g];"preprocessor"===k.type&&(k.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++d:k.data.match(/\#endif\s*.*/)&&--d);("afterVersion"===c||"afterPrecision"===c)&&"preprocessor"===k.type&&/^#version/.test(k.data)&&(f=Math.max(f,g));if("afterPrecision"===c&&"keyword"===k.type&&"precision"===k.data){a:{for(k=g;k<a.length;k++){var l=a[k];if("operator"===
l.type&&";"===l.data)break a}k=null}if(null===k)throw Error("precision statement not followed by any semicolons!");f=Math.max(f,k)}b<f&&0===d&&(b=g)}return b+1}(a);f(g-1)&&a.splice(g++,0,d);for(var k=0;k<b.length;k++){var e=b[k];a.splice(g++,0,e)}f(g-1)&&f(g)&&a.splice(g,0,d)}Object.defineProperty(h,"__esModule",{value:!0});var c=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];h.transpileShader=function(f,k){f=a(f);var n;a:{n="100";var l="300 es";
void 0===n&&(n="100");void 0===l&&(l="300 es");for(var p=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/,m=0;m<f.length;m++){var r=f[m];if("preprocessor"===r.type){var t=p.exec(r.data);if(t)if(p=t[1].replace(/\s\s+/g," "),p===l){n=p;break a}else if(p===n){r.data="#version "+l;break a}else throw Error("unknown glsl version: "+p);}}f.splice(0,0,{type:"preprocessor",data:"#version "+l},{type:"whitespace",data:"\n"});n=null}if("300 es"===n)throw Error("shader is already glsl 300 es");p=r=null;m={};t={};
for(n=0;n<f.length;++n)switch(l=f[n],l.type){case "keyword":"vertex"===k&&"attribute"===l.data?l.data="in":"varying"===l.data&&(l.data="vertex"===k?"out":"in");break;case "builtin":/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(l.data.trim())&&(l.data=l.data.replace(/(2D|Cube|EXT)/g,""));if("fragment"===k&&"gl_FragColor"===l.data){if(!r){var r=b(f,m,"fragColor"),u=void 0;void 0===u&&(u="lowp");g(f,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:u},{type:"whitespace",
data:" "},{type:"keyword",data:"vec4"},{type:"whitespace",data:" "},{type:"ident",data:r},{type:"operator",data:";"}],"afterPrecision")}l.data=r}else"fragment"===k&&"gl_FragDepthEXT"===l.data&&(p||(p=b(f,m,"gl_FragDepth")),l.data=p);break;case "ident":if(0<=e.indexOf(l.data)){if(u="vertex"===k)a:{for(u=n-1;0<=u;u--){var h=f[u];if("whitespace"!==h.type&&"block-comment"!==h.type)if("keyword"===h.type){if("attribute"===h.data||"in"===h.data){u=!0;break a}}else break}u=!1}if(u)throw Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");
l.data in t||(t[l.data]=b(f,m,l.data));l.data=t[l.data]}}for(n=f.length-1;0<=n;--n)l=f[n],"preprocessor"===l.type&&((k=l.data.match(/\#extension\s+(.*)\:/))&&k[1]&&0<=c.indexOf(k[1].trim())&&(k=f[n+1],f.splice(n,k&&"whitespace"===k.type?2:1)),(k=l.data.match(/\#ifdef\s+(.*)/))&&k[1]&&0<=c.indexOf(k[1].trim())&&(l.data="#if 1"),(k=l.data.match(/\#ifndef\s+(.*)/))&&k[1]&&0<=c.indexOf(k[1].trim())&&(l.data="#if 0"));return d(f)}})},"esri/views/webgl/reservedWordsGLSL3":function(){define(["require","exports"],
function(q,h){return"layout centroid smooth case mat2x2 mat2x3 mat2x4 mat3x2 mat3x3 mat3x4 mat4x2 mat4x3 mat4x4 uint uvec2 uvec3 uvec4 samplerCubeShadow sampler2DArray sampler2DArrayShadow isampler2D isampler3D isamplerCube isampler2DArray usampler2D usampler3D usamplerCube usampler2DArray coherent restrict readonly writeonly resource atomic_uint noperspective patch sample subroutine common partition active filter image1D image2D image3D imageCube iimage1D iimage2D iimage3D iimageCube uimage1D uimage2D uimage3D uimageCube image1DArray image2DArray iimage1DArray iimage2DArray uimage1DArray uimage2DArray image1DShadow image2DShadow image1DArrayShadow image2DArrayShadow imageBuffer iimageBuffer uimageBuffer sampler1DArray sampler1DArrayShadow isampler1D isampler1DArray usampler1D usampler1DArray isampler2DRect usampler2DRect samplerBuffer isamplerBuffer usamplerBuffer sampler2DMS isampler2DMS usampler2DMS sampler2DMSArray isampler2DMSArray usampler2DMSArray trunc round roundEven isnan isinf floatBitsToInt floatBitsToUint intBitsToFloat uintBitsToFloat packSnorm2x16 unpackSnorm2x16 packUnorm2x16 unpackUnorm2x16 packHalf2x16 unpackHalf2x16 outerProduct transpose determinant inverse texture textureSize textureProj textureLod textureOffset texelFetch texelFetchOffset textureProjOffset textureLodOffset textureProjLod textureProjLodOffset textureGrad textureGradOffset textureProjGrad textureProjGradOffset".split(" ")})},
"esri/views/webgl/lib/glsl-tokenizer/string":function(){define(["./index"],function(q){"use strict;";return function(h){var e=q(),a=[],a=a.concat(e(h));return a=a.concat(e(null))}})},"esri/views/webgl/lib/glsl-tokenizer/index":function(){define(["./lib/literals","./lib/operators","./lib/builtins"],function(q,h,e){"use strict;";var a="block-comment line-comment preprocessor operator integer float ident builtin keyword whitespace eof integer".split(" ");return function(){function d(b){b.length&&x.push({type:a[m],
data:b,position:y,line:v,column:A})}function b(){u=u.length?[]:u;if("/"===t&&"*"===r)return y=p+l-1,m=0,t=r,l+1;if("/"===t&&"/"===r)return y=p+l-1,m=1,t=r,l+1;if("#"===r)return m=2,y=p+l,l;if(/\s/.test(r))return m=9,y=p+l,l;C=/\d/.test(r);B=/[^\w_]/.test(r);y=p+l;m=C?4:B?3:9999;return l}function g(){if(("\r"===r||"\n"===r)&&"\\"!==t)return d(u.join("")),m=999,l;u.push(r);t=r;return l+1}function c(){if("."===t&&/\d/.test(r))return m=5,l;if("/"===t&&"*"===r)return m=0,l;if("/"===t&&"/"===r)return m=
1,l;if("."===r&&u.length){for(;f(u););m=5;return l}if(";"===r||")"===r||"("===r){if(u.length)for(;f(u););d(r);m=999;return l+1}var a=2===u.length&&"\x3d"!==r;if(/[\w_\d\s]/.test(r)||a){for(;f(u););m=999;return l}u.push(r);t=r;return l+1}function f(a){var b=0,c,f;do{c=h.indexOf(a.slice(0,a.length+b).join(""));f=h[c];if(-1===c){if(0<b--+a.length)continue;f=a.slice(0,1).join("")}d(f);y+=f.length;u=u.slice(f.length);return u.length}while(1)}function k(){if("."===r||/[eE]/.test(r))return u.push(r),m=5,
t=r,l+1;if("x"===r&&1===u.length&&"0"===u[0])return m=11,u.push(r),t=r,l+1;if(/[^\d]/.test(r))return d(u.join("")),m=999,l;u.push(r);t=r;return l+1}function n(){"f"===r&&(u.push(r),t=r,l+=1);if(/[eE]/.test(r)||"-"===r&&/[eE]/.test(t))return u.push(r),t=r,l+1;if(/[^\d]/.test(r))return d(u.join("")),m=999,l;u.push(r);t=r;return l+1}var l=0,p=0,m=999,r,t,u=[],x=[],v=1,A=0,y=0,C=!1,B=!1,D="",E;return function(a){x=[];if(null!==a){a=a.replace?a.replace(/\r\n/g,"\n"):a;l=0;D+=a;for(E=D.length;r=D[l],l<
E;){a=l;switch(m){case 0:"/"===r&&"*"===t?(u.push(r),d(u.join("")),m=999):(u.push(r),t=r);l+=1;break;case 1:l=g();break;case 2:l=g();break;case 3:l=c();break;case 4:l=k();break;case 11:/[^a-fA-F0-9]/.test(r)?(d(u.join("")),m=999):(u.push(r),t=r,l+=1);break;case 5:l=n();break;case 9999:if(/[^\d\w_]/.test(r)){var f=u.join("");m=-1<q.indexOf(f)?8:-1<e.indexOf(f)?7:6;d(u.join(""));m=999}else u.push(r),t=r,l+=1;break;case 9:/[^\s]/g.test(r)?(d(u.join("")),m=999):(u.push(r),t=r,l+=1);break;case 999:l=b()}if(a!==
l)switch(D[a]){case "\n":A=0;++v;break;default:++A}}p+=l;D=D.slice(l);return x}u.length&&d(u.join(""));m=10;d("(eof)");return x}}})},"esri/views/webgl/lib/glsl-tokenizer/lib/literals":function(){define([],function(){return"precision highp mediump lowp attribute const uniform varying break continue do for while if else in out inout float int void bool true false discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow struct asm class union enum typedef template this packed goto switch default inline noinline volatile public static extern external interface long short double half fixed unsigned input output hvec2 hvec3 hvec4 dvec2 dvec3 dvec4 fvec2 fvec3 fvec4 sampler2DRect sampler3DRect sampler2DRectShadow sizeof cast namespace using".split(" ")})},
"esri/views/webgl/lib/glsl-tokenizer/lib/operators":function(){define([],function(){"use strict;";return"\x3c\x3c\x3d \x3e\x3e\x3d ++ -- \x3c\x3c \x3e\x3e \x3c\x3d \x3e\x3d \x3d\x3d !\x3d \x26\x26 || +\x3d -\x3d *\x3d /\x3d %\x3d \x26\x3d ^^ ^\x3d |\x3d ( ) [ ] . ! ~ * / % + - \x3c \x3e \x26 ^ | ? : \x3d , ; { }".split(" ")})},"esri/views/webgl/lib/glsl-tokenizer/lib/builtins":function(){define([],function(){return"abs acos all any asin atan ceil clamp cos cross dFdx dFdy degrees distance dot equal exp exp2 faceforward floor fract gl_BackColor gl_BackLightModelProduct gl_BackLightProduct gl_BackMaterial gl_BackSecondaryColor gl_ClipPlane gl_ClipVertex gl_Color gl_DepthRange gl_DepthRangeParameters gl_EyePlaneQ gl_EyePlaneR gl_EyePlaneS gl_EyePlaneT gl_Fog gl_FogCoord gl_FogFragCoord gl_FogParameters gl_FragColor gl_FragCoord gl_FragData gl_FragDepth gl_FragDepthEXT gl_FrontColor gl_FrontFacing gl_FrontLightModelProduct gl_FrontLightProduct gl_FrontMaterial gl_FrontSecondaryColor gl_LightModel gl_LightModelParameters gl_LightModelProducts gl_LightProducts gl_LightSource gl_LightSourceParameters gl_MaterialParameters gl_MaxClipPlanes gl_MaxCombinedTextureImageUnits gl_MaxDrawBuffers gl_MaxFragmentUniformComponents gl_MaxLights gl_MaxTextureCoords gl_MaxTextureImageUnits gl_MaxTextureUnits gl_MaxVaryingFloats gl_MaxVertexAttribs gl_MaxVertexTextureImageUnits gl_MaxVertexUniformComponents gl_ModelViewMatrix gl_ModelViewMatrixInverse gl_ModelViewMatrixInverseTranspose gl_ModelViewMatrixTranspose gl_ModelViewProjectionMatrix gl_ModelViewProjectionMatrixInverse gl_ModelViewProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixTranspose gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_Normal gl_NormalMatrix gl_NormalScale gl_ObjectPlaneQ gl_ObjectPlaneR gl_ObjectPlaneS gl_ObjectPlaneT gl_Point gl_PointCoord gl_PointParameters gl_PointSize gl_Position gl_ProjectionMatrix gl_ProjectionMatrixInverse gl_ProjectionMatrixInverseTranspose gl_ProjectionMatrixTranspose gl_SecondaryColor gl_TexCoord gl_TextureEnvColor gl_TextureMatrix gl_TextureMatrixInverse gl_TextureMatrixInverseTranspose gl_TextureMatrixTranspose gl_Vertex greaterThan greaterThanEqual inversesqrt length lessThan lessThanEqual log log2 matrixCompMult max min mix mod normalize not notEqual pow radians reflect refract sign sin smoothstep sqrt step tan texture2D texture2DLod texture2DProj texture2DProjLod textureCube textureCubeLod texture2DLodEXT texture2DProjLodEXT textureCubeLodEXT texture2DGradEXT texture2DProjGradEXT textureCubeGradEXT".split(" ")})},
"esri/views/webgl/Texture":function(){define(["require","exports","dojo/has"],function(q,h,e){return function(){function a(d,b,g){this._glName=this._context=null;this._id=-1;this._desc=void 0;this._wrapModeDirty=this._samplingModeDirty=!1;this._boundToUnits=new Set;this._context=d;this._desc={pixelFormat:b.pixelFormat,internalFormat:b.internalFormat,dataType:b.dataType,target:b.target?b.target:3553,samplingMode:b.samplingMode?b.samplingMode:9729,wrapMode:b.wrapMode?b.wrapMode:10497,maxAnisotropy:b.maxAnisotropy,
flipped:void 0!==b.flipped?b.flipped:!1,hasMipmap:void 0!==b.hasMipmap?b.hasMipmap:!1,level:void 0!==b.level?b.level:0,unpackAlignment:b.unpackAlignment?b.unpackAlignment:4,width:b.width,height:b.height,preMultiplyAlpha:void 0!==b.preMultiplyAlpha?b.preMultiplyAlpha:!1};this._id=++a._nextId;this.setData(g)}Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},enumerable:!0,
configurable:!0});Object.defineProperty(a.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0});a.prototype.dispose=function(){var a=this;if(this._context){if(this._glName){var b=this._context.gl;this._boundToUnits.forEach(function(b){a._context.bindTexture(null,b)});b.deleteTexture(this._glName);this._glName=null}this._context=null}};a.prototype.resize=function(a,b){var d=this._desc;if(d.width!==a||d.height!==b)d.width=a,d.height=b,this.setData(null)};a.prototype.setData=
function(d){var b=this._context.gl;this._glName||(this._glName=b.createTexture());void 0===d&&(d=null);null===d&&(this._desc.width=this._desc.width||4,this._desc.height=this._desc.height||4);var g=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var c=this._desc;a._validateTexture(c);b.pixelStorei(b.UNPACK_ALIGNMENT,c.unpackAlignment);b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,c.flipped?1:0);b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c.preMultiplyAlpha);if(d instanceof ImageData||d instanceof
HTMLImageElement||d instanceof HTMLCanvasElement||d instanceof HTMLVideoElement)c.width&&c.height&&console.assert(d.width===c.width&&d.height===c.height),b.texImage2D(b.TEXTURE_2D,c.level,c.internalFormat?c.internalFormat:c.pixelFormat,c.pixelFormat,c.dataType,d),void 0===this._desc.width&&(this._desc.width=d.width),void 0===this._desc.height&&(this._desc.height=d.height);else{null!=c.width&&null!=c.height||console.error("Width and height must be specified!");var f=c.internalFormat?c.internalFormat:
c.pixelFormat,k=c.pixelFormat;b.DEPTH24_STENCIL8&&f===b.DEPTH_STENCIL&&(f=b.DEPTH24_STENCIL8);b.texImage2D(b.TEXTURE_2D,c.level,f,c.width,c.height,0,k,c.dataType,d)}c.hasMipmap&&this.generateMipmap();a._applySamplingMode(b,this._desc);a._applyWrapMode(b,this._desc);a._applyAnisotropicFilteringParameters(this._context,this._desc);this._context.bindTexture(g,0)};a.prototype.updateData=function(a,b,g,c,f,k){k||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");
var d=this._context.gl,l=this._desc,e=this._context.getBoundTexture(0);this._context.bindTexture(this,0);(0>b||0>g||c>l.width||f>l.height||b+c>l.width||g+f>l.height)&&console.error("An attempt to update out of bounds of the texture!");k instanceof ImageData||k instanceof HTMLImageElement||k instanceof HTMLCanvasElement||k instanceof HTMLVideoElement?(console.assert(k.width===c&&k.height===f),d.texSubImage2D(d.TEXTURE_2D,a,b,g,l.pixelFormat,l.dataType,k)):d.texSubImage2D(d.TEXTURE_2D,a,b,g,c,f,l.pixelFormat,
l.dataType,k);this._context.bindTexture(e,0)};a.prototype.generateMipmap=function(){var d=this._desc;d.hasMipmap||(d.hasMipmap=!0,a._validateTexture(d));9729===d.samplingMode?(this._samplingModeDirty=!0,d.samplingMode=9985):9728===d.samplingMode&&(this._samplingModeDirty=!0,d.samplingMode=9984);d=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var b=this._context.gl;b.generateMipmap(b.TEXTURE_2D);this._context.bindTexture(d,0)};a.prototype.setSamplingMode=function(d){d!==this._desc.samplingMode&&
(this._desc.samplingMode=d,a._validateTexture(this._desc),this._samplingModeDirty=!0)};a.prototype.setWrapMode=function(d){d!==this._desc.wrapMode&&(this._desc.wrapMode=d,a._validateTexture(this._desc),this._wrapModeDirty=!0)};a.prototype.applyChanges=function(){var d=this._context.gl,b=this._desc;this._samplingModeDirty&&(a._applySamplingMode(d,b),this._samplingModeDirty=!1);this._wrapModeDirty&&(a._applyWrapMode(d,b),this._wrapModeDirty=!1)};a.prototype.setBoundToUnit=function(a,b){b?this._boundToUnits.add(a):
this._boundToUnits.delete(a)};a._isPowerOfTwo=function(a){return 0===(a&a-1)};a._validateTexture=function(d){(0>d.width||0>d.height)&&console.error("Negative dimension parameters are not allowed!");a._isPowerOfTwo(d.width)&&a._isPowerOfTwo(d.height)||(33071!==d.wrapMode&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),d.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))};a._applySamplingMode=function(a,b){var d=b.samplingMode;if(9985===d||9987===
d)d=9729;else if(9984===d||9986===d)d=9728;a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,d);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,b.samplingMode)};a._applyWrapMode=function(a,b){a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,b.wrapMode);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,b.wrapMode)};a._applyAnisotropicFilteringParameters=function(a,b){if(null!=b.maxAnisotropy){var d=a.capabilities.textureFilterAnisotropic;d&&(a=a.gl,a.texParameterf(a.TEXTURE_2D,d.TEXTURE_MAX_ANISOTROPY,
b.maxAnisotropy))}};a._nextId=0;return a}()})},"esri/views/3d/environment/RealisticAtmosphere":function(){define("require exports dojo/text!./materials/RealisticAtmosphereMaterial.xml ../../../core/Handles ../../../core/promiseUtils ../../../core/watchUtils ./atmosphereUtils ../lib/glMatrix ../support/earthUtils ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/GeometryRenderer ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ../../webgl/Program".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t){var u=f.earthRadius,x=c.vec3d,v=c.vec2d,A=c.vec4d;q=.02*Math.PI;h=.004*Math.PI;var y=x.createFrom(1/Math.pow(.65,4),1/Math.pow(.57,4),1/Math.pow(.475,4)),C=x.create(y);x.scale(C,q);x.add(C,x.createFrom(h,h,h));var B=(1- -.99999*-.99999)/(2+-.99999*-.99999)*1.5;return function(){function c(a){this.view=null;this.needsRender=!1;this.didRender=!0;this.slot=r.POSTPROCESSING_ATMOSPHERE_OPAQUE;this._hazeSlot=r.POSTPROCESSING_ATMOSPHERE_TRANSPARENT;this._renderer=
this._skyProgram=this._hazeProgram=this._handles=null;this._renderData={texDepth:v.create(),v3CameraPos:x.create(),v3CameraUp:x.create(),v3CameraRight:x.create(),v3CameraDir:x.create(),halfSizeNearPlane:v.create(),v2CameraCenterOffset:v.create(),v4SphereComp:A.create(),v4AtmosParams1:A.create(),v4AtmosParams2:A.create(),v4AtmosParams3:A.create(),v3InvWavelength:y,v3InvWavelengthScaled:C,v4Radii:A.create(),fScale:0,fScaleDepth:.25,fLowerAlphaBlendBound:0,fScaleOverScaleDepth:0,fOneOverScaleDepth:0,
fScaleDepthBlue:.05,fOneOverScaleDepthBlue:20,fScaleOverScaleDepthBlue:0,g:-.99999,g2:-.99999*-.99999,fMiePhaseCoefficients:B,showTest:0,nearFar:v.create(),fCameraHeight:0,fCameraHeight2:0,fC:0,fCSur:0,fInnerFadeDistance:0,fAltitudeFade:0};this._lowerElevationBoundRadius=0;this._earthRadius=u;this.view=a;this._updateRadius(u)}c.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);this._hazeProgram&&(this._hazeProgram.dispose(),this._hazeProgram=null);this._skyProgram&&
(this._skyProgram.dispose(),this._skyProgram=null)};c.prototype.when=function(a){return d.resolve().then(a)};c.prototype.initializeRenderContext=function(c){var d=this,f=p.createSquareGeometry([[-1,-1,1],[1,-1,1],[1,1,1],[-1,1,1]]).toRenderData(),g=c.rctx;this._renderer=new l(f,n.Pos3Tex,null,g);this._handles=new a;this._handles.add(b.init(this.view,"state.camera",function(a){return d._update(a)},!0));this._updateElevation({spatialReference:this.view.basemapTerrain.spatialReference,tile:this.view.basemapTerrain.rootTiles[0],
extent:this.view.basemapTerrain.rootTiles[0].extent});this._handles.add(b.on(this.view,"basemapTerrain","elevation-change",function(a){return d._updateElevation(a)},function(){return d._updateElevation()}));this._handles.add(b.on(this.view,"basemapTerrain","elevation-bounds-change",function(){return d._updateVisibleElevationBounds()},function(){return d._updateVisibleElevationBounds()}));c.shaderSnippets.fsRealisticAtmosphere||c.shaderSnippets._parse(e);this._hazeProgram=new t(g,c.shaderSnippets.vsRealisticAtmosphere,
c.shaderSnippets.fsRealisticAtmosphere,k.Default3D,["HAZE"]);this._skyProgram=new t(g,c.shaderSnippets.vsRealisticAtmosphere,c.shaderSnippets.fsRealisticAtmosphere,k.Default3D)};c.prototype.uninitializeRenderContext=function(a){this.destroy()};c.prototype.render=function(a){if(a.slot!==this._hazeSlot&&a.slot!==this.slot||a.pass!==m.MATERIAL)return!1;a.slot===this.slot&&this._renderSky(a);a.slot===this._hazeSlot&&this._renderHaze(a);this.needsRender=!1;return!0};c.prototype._renderSky=function(a){var b=
a.rctx,c=b.gl,d=this._skyProgram;b.bindProgram(d);b.setBlendFunctionSeparate(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA);b.setDepthFunction(c.LEQUAL);b.setDepthTestEnabled(!0);d.setUniform4fv("v4AtmosParams3",this._renderData.v4AtmosParams3);this._renderCommon(d,a)};c.prototype._renderHaze=function(a){var b=this,c=a.rctx,d=c.gl,f=a.offscreenRenderingHelper,g=this._hazeProgram;c.bindProgram(g);c.setBlendFunctionSeparate(d.ONE,d.ONE_MINUS_SRC_COLOR,d.ZERO,d.ONE);f.renderDepthDetached(function(){c.setDepthTestEnabled(!1);
c.bindTexture(f.depthTexture,0);g.setUniform1i("tDepth",0);b._renderCommon(g,a)})};c.prototype._renderCommon=function(a,b){var c=b.rctx,d=c.gl;a.setUniform3fv("v3InvWavelength",this._renderData.v3InvWavelength);a.setUniform3fv("v3InvWavelengthScaled",this._renderData.v3InvWavelengthScaled);a.setUniform3fv("v3LightDir",b.lightingData.direction);a.setUniform4fv("v4SphereComp",this._renderData.v4SphereComp);a.setUniform3fv("v3CameraPos",this._renderData.v3CameraPos);a.setUniform3fv("v3CameraUp",this._renderData.v3CameraUp);
a.setUniform3fv("v3CameraRight",this._renderData.v3CameraRight);a.setUniform3fv("v3CameraDir",this._renderData.v3CameraDir);a.setUniform2fv("nearFar",this._renderData.nearFar);a.setUniform2fv("halfSizeNearPlane",this._renderData.halfSizeNearPlane);a.setUniform2fv("v2CameraCenterOffset",this._renderData.v2CameraCenterOffset);a.setUniform4fv("v4Radii",this._renderData.v4Radii);a.setUniform4fv("v4AtmosParams1",this._renderData.v4AtmosParams1);a.setUniform4fv("v4AtmosParams2",this._renderData.v4AtmosParams2);
a.setUniform1f("showTest",this._renderData.showTest);a.setUniform1f("fInnerFadeDistance",this._renderData.fInnerFadeDistance);a.setUniform1f("fAltitudeFade",this._renderData.fAltitudeFade);c.setBlendingEnabled(!0);c.setDepthWriteEnabled(!1);this._renderer.render(a);c.setDepthFunction(d.LESS);c.setDepthTestEnabled(!1);c.setDepthWriteEnabled(!0);c.setBlendingEnabled(!1);c.setBlendFunctionSeparate(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE_MINUS_SRC_ALPHA)};c.prototype._adjustRadiusForTesselation=
function(a){return a*Math.cos(Math.PI/Math.pow(2,4)/16)};c.prototype._normalizeRadius=function(a){a=this._adjustRadiusForTesselation(a);return Math.max(u-1E4,Math.min(a,u))};c.prototype._updateElevation=function(a){a=a?a.tile:this.view.basemapTerrain.rootTiles[0];0===a.lij[0]&&(a=this._adjustRadiusForTesselation(u+a.elevationBounds[0]),a!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=a,this._earthRadius=-1,this._updateVisibleElevationBounds()))};c.prototype._updateVisibleElevationBounds=
function(){var a=this._adjustRadiusForTesselation(u+this.view.basemapTerrain.getElevationBounds()[0]);return 0>this._earthRadius||a<this._earthRadius?this._updateRadius(a):!1};c.prototype._updateRadius=function(a){this._earthRadius=a;var b=a*a,c=a/10*10.25,d=c*c,f=1/(c-a),k=f/.25,l=f/.05,m=.3*(c-a)+a,e=1/(c-m),n=this._renderData;A.set4(f,.25,k,4,n.v4AtmosParams1);A.set4(-.99999,.05,l,20,n.v4AtmosParams2);A.set4(-.99999*-.99999,B,m,e,n.v4AtmosParams3);A.set4(a,b,c,d,n.v4Radii);n.fScale=f;n.fLowerAlphaBlendBound=
m;n.fScaleOverScaleDepth=k;n.fScaleOverScaleDepthBlue=l;b=g.INNER_ATMOSPHERE_DEPTH;n.fInnerFadeDistance=2*Math.sqrt((2*a-b)*b);this._update();return!0};c.prototype._update=function(a){void 0===a&&(a=this.view.get("state.camera"));a&&(x.negate(a.viewForward,this._renderData.v3CameraDir),x.set(a.viewUp,this._renderData.v3CameraUp),x.set(a.viewRight,this._renderData.v3CameraRight),this._renderData.fCameraHeight=x.length(a.eye),this._renderData.fCameraHeight2=this._renderData.fCameraHeight*this._renderData.fCameraHeight,
this._renderData.fC=this._renderData.fCameraHeight2-this._renderData.v4Radii[3],this._renderData.fCSur=this._renderData.fCameraHeight2-this._renderData.v4Radii[1],this._renderData.v4SphereComp=A.createFrom(this._renderData.fCameraHeight,this._renderData.fCameraHeight2,this._renderData.fC,this._renderData.fCSur),x.set(a.eye,this._renderData.v3CameraPos),v.set2(Math.tan(a.fovX/2)/(a.width/a.fullWidth),Math.tan(a.fovY/2)/(a.height/a.fullHeight),this._renderData.halfSizeNearPlane),v.set2((a.padding[3]+
a.width/2)/a.fullWidth-.5,(a.padding[2]+a.height/2)/a.fullHeight-.5,this._renderData.v2CameraCenterOffset),v.set2(a.near,a.far,this._renderData.nearFar),this._renderData.fAltitudeFade=g.computeInnerAltitudeFade(this._renderData.fCameraHeight-this._earthRadius))};c.isSupported=function(a){return a.rctx.capabilities.depthTexture};return c}()})},"esri/views/3d/environment/atmosphereUtils":function(){define(["require","exports"],function(q,h){Object.defineProperty(h,"__esModule",{value:!0});h.computeInnerAltitudeFade=
function(e){return Math.min(1,Math.max(0,(e-1E5)/9E5))};h.INNER_ATMOSPHERE_DEPTH=1E4})},"esri/views/3d/environment/SimpleAtmosphere":function(){define("require exports dojo/text!./materials/SimpleAtmosphereMaterial.xml ../../../core/watchUtils ./atmosphereUtils ./resources/SimpleAtmosphereTexture ../lib/glMatrix ../support/earthUtils ../support/imageUtils ../support/mathUtils ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/GeometryRenderer ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/Util ../../webgl/Program ../../webgl/Texture ../../webgl/Util".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u,x,v){function A(a,b,c,d,f){var k=g.vec3d.length(a),l=d*Math.sqrt(k*k-d*d)/k,m=f.silCircleV1,e=f.silCircleV2;g.vec3d.scale(a,Math.sqrt(d*d-l*l)/k,f.silCircleCenter);g.vec3d.cross(a,b,m);1>g.vec3d.length2(m)&&g.vec3d.cross(a,c,m);g.vec3d.scale(m,l/g.vec3d.length(m));g.vec3d.cross(m,a,e);g.vec3d.scale(e,l/g.vec3d.length(e));return l}function y(a,b,c,d){g.vec3d.add(d.silCircleCenter,d.silCircleV2,M);g.vec3d.scale(M,E,H);g.mat4d.lookAt(b,M,c,F);t.project(M,F,
a.projectionMatrix,a.viewport);t.project(H,F,a.projectionMatrix,a.viewport);return g.vec3d.dist(M,H)/a.height}var C=-d.INNER_ATMOSPHERE_DEPTH,B=(c.earthRadius+C)/c.earthRadius,D=(c.earthRadius+0)/c.earthRadius,E=(c.earthRadius+3E5)/c.earthRadius,J=k.makePiecewiseLinearFunction([[50,.1015625],[500,.21875],[5E3,.51171875],[5E4,.4140625]]);q=function(){function k(a){this.view=null;this.needsRender=!1;this.didRender=!0;this.slot=r.POSTPROCESSING_ATMOSPHERE_OPAQUE;this._renderData={texV:g.vec2d.create(),
silCircleCenter:g.vec3d.create(),silCircleV1:g.vec3d.create(),silCircleV2:g.vec3d.create(),altitudeFade:0,innerScale:0,undergroundFadeAlpha:0};this._fadeProgram=this._texture=this._program=this._renderer=null;this._fadeVAOCount=0;this._cameraChangeHandle=null;this.view=a}k.prototype.when=function(a){return this._readyPromise.then(a)};k.prototype.initializeRenderContext=function(c){var d=this,g=this._createRibbonGeometryData();this._renderer=new l(g,[{name:"position",count:3,type:5126,offset:0,stride:12,
normalized:!1}],null,c.rctx);this._cameraChangeHandle=a.init(this.view,"state.camera",function(a){return d._update(a)},!0);c.shaderSnippets.vsSimpleAtmosphere||c.shaderSnippets._parse(e);this._program=new u(c.rctx,c.shaderSnippets.vsSimpleAtmosphere,c.shaderSnippets.fsSimpleAtmosphere,n.Default3D);this._fadeProgram=new u(c.rctx,c.shaderSnippets.vsSimpleAtmosphereFade,c.shaderSnippets.fsSimpleAtmosphereFade,n.Default3D);this._fadeVAO=p.createQuadVAO(c.rctx);this._fadeVAOCount=v.vertexCount(this._fadeVAO,
"geometry");this._readyPromise=f.requestImage(b).then(function(a){d._texture=new x(c.rctx,{pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},a);d.needsRender=!0})};k.prototype.uninitializeRenderContext=function(a){this.destroy()};k.prototype.destroy=function(){this._cameraChangeHandle&&(this._cameraChangeHandle.remove(),this._cameraChangeHandle=null);this._texture&&(this._texture.dispose(),this._texture=null);this._program&&(this._program.dispose(),this._program=null);this._fadeProgram&&
(this._fadeProgram.dispose(),this._fadeProgram=null);this._fadeVAO&&(this._fadeVAO.dispose(),this._fadeVAO=null)};k.prototype.render=function(a){if(a.slot!==this.slot||a.pass!==m.MATERIAL||null==this._texture)return!1;var b=a.rctx,c=b.gl,d=this._program;b.setDepthTestEnabled(!0);b.setDepthFunction(c.LEQUAL);b.setBlendingEnabled(!0);b.setDepthWriteEnabled(!1);b.setBlendFunctionSeparate(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA);1>this._renderData.undergroundFadeAlpha&&(b.bindProgram(d),
d.setUniformMatrix4fv("proj",a.camera.projectionMatrix),d.setUniformMatrix4fv("view",a.camera.viewMatrix),d.setUniform3fv("silCircleCenter",this._renderData.silCircleCenter),d.setUniform3fv("silCircleV1",this._renderData.silCircleV1),d.setUniform3fv("silCircleV2",this._renderData.silCircleV2),d.setUniform2fv("texV",this._renderData.texV),b.bindTexture(this._texture,0),d.setUniform1i("tex",0),d.setUniform3fv("lightDirection",a.lightingData.direction),d.setUniform1f("altitudeFade",this._renderData.altitudeFade),
d.setUniform1f("innerScale",this._renderData.innerScale),this._renderer.render(d));0<this._renderData.undergroundFadeAlpha&&(b.bindProgram(this._fadeProgram),this._fadeProgram.setUniform1f("undergroundFadeAlpha",this._renderData.undergroundFadeAlpha),this._fadeProgram.setUniform3fv("lightDirection",a.lightingData.direction),this._fadeProgram.setUniform3fv("cameraPosition",a.camera.eye),b.bindVAO(this._fadeVAO),b.drawArrays(5,0,this._fadeVAOCount));b.setBlendingEnabled(!1);b.setDepthWriteEnabled(!0);
b.setDepthFunction(c.LESS);this.needsRender=!1;return!0};k.prototype._update=function(a){var b=g.vec3d.create(),f=c.earthRadius,k=g.vec3d.length(a.eye),l=k-f;this._renderData.undergroundFadeAlpha=0>l?Math.min(-l/5E3,1):0;var m=f+C,e=f+Math.max(50,l);this._renderData.innerScale=e*e/(Math.sqrt(e*e-f*f)*Math.sqrt(e*e-m*m)+f*m)-1;this._renderData.altitudeFade=d.computeInnerAltitudeFade(l);g.vec3d.scale(a.eye,(f+50)/k,b);A(b,a.center,a.up,f,this._renderData);b=y(a,b,a.up,this._renderData);k=J(l);m=.001953125;
e=0+b*k*1;50<l&&(A(a.eye,a.center,a.up,f,this._renderData),a=y(a,a.eye,a.up,this._renderData),a=t.clamp((a-1.5)/(b-1.5),0,1),m=0+.001953125*a,e=0+1*t.lerp(1,b*k,a));g.vec2d.set2(m,e,this._renderData.texV);this.needsRender=!0};k.prototype._createRibbonGeometryData=function(){var a=new Float32Array(1155),b=new Uint32Array(1920);a[0]=0;a[1]=0;a[2]=-1;for(var c=0;128>c;c++){var d=9*c+3;a[d+0]=c;a[d+1]=B;a[d+2]=-1;a[d+3]=c;a[d+4]=D;a[d+5]=0;a[d+6]=c;a[d+7]=E;a[d+8]=1;var d=3*c+1,f=127===c?1:d+3,g=15*c;
b[g+0]=d;b[g+1]=d+1;b[g+2]=f+1;b[g+3]=f+1;b[g+4]=f;b[g+5]=d;b[g+6]=d+1;b[g+7]=d+2;b[g+8]=f+2;b[g+9]=f+2;b[g+10]=f+1;b[g+11]=d+1;b[g+12]=d;b[g+13]=f;b[g+14]=0}c={};c[t.VertexAttrConstants.POSITION]=b;b={};b[t.VertexAttrConstants.POSITION]={size:3,data:a};return{id:"simpleatmosphereribbon",indices:c,vertexAttr:b,preinterleaved:!1}};return k}();var F=g.mat4d.create(),M=g.vec3d.create(),H=g.vec3d.create();return q})},"esri/views/3d/webgl-engine/lib/glUtil3D":function(){define("require exports ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ../../../webgl/BufferObject ../../../webgl/Texture ../../../webgl/VertexArrayObject".split(" "),
function(q,h,e,a,d,b,g){Object.defineProperty(h,"__esModule",{value:!0});h.createQuadVAO=function(b,f){void 0===f&&(f=a.Pos2);var c=f===a.Pos3Tex?new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,-1,1,0,0,1,1,1,0,1,1]):new Float32Array([-1,-1,1,-1,-1,1,1,1]);return new g(b,e.Default3D,{geometry:f},{geometry:d.createVertex(b,35044,c)})};h.createEmptyTexture=function(a,d){void 0===d&&(d=4);return new b(a,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:d,height:d})};h.createColorTexture=function(a,
d,g){void 0===g&&(g=4);for(var c=new Uint8Array(g*g*4),f=0;f<c.length;f+=4)c[f+0]=255*d[0],c[f+1]=255*d[1],c[f+2]=255*d[2],c[f+3]=255*d[3];return new b(a,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:g,height:g},c)}})},"esri/views/3d/environment/Stars":function(){define("require exports dojo/text!./materials/StarMaterial.xml ../../../request ../../../core/Error ../../../core/Logger ../../../core/promiseUtils ../../../core/watchUtils ../lib/glMatrix ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/GeometryRenderer ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/Util ../webgl-engine/materials/internal/MaterialUtil ../../webgl/Program ../../webgl/Util".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u){var x=m.VertexAttrConstants,v="9bb2ff;9eb5ff;aabfff;bbccff;ccd8ff ;dae2ff;e4e9ff;eeefff;f8f6ff;fff9fb;fff5ef;fff1e5;ffeddb;ffe9d2;ffe6ca;ffe3c3;ffe0bb;ffddb4;ffdaad;ffd6a5;ffd29c;ffcc8f;ffc178;ffa94b;ff7b00".split(";"),A=b.getLogger("esri.views.3d.environment.Stars"),y=f.mat3d.toMat4(f.mat3d.createFrom(1,0,0,0,.9174771405229186,.39778850739794974,0,-.39778850739794974,.9174771405229186)),C=f.mat3d.toMat4(f.mat3d.createFrom(1,0,0,0,.9174771405229186,-.39778850739794974,
0,.39778850739794974,.9174771405229186)),B=null;return function(){function b(a){this.view=null;this.slot=p.POSTPROCESSING_ATMOSPHERE_OPAQUE;this.numBinaryFloats=2;this.numBinaryUInt8=1;this.bytesPerStar=9;this.needsRender=!1;this.didRender=!0;this._renderData={model:f.mat4d.identity()};this._program=this._renderer=null;this._vertexBufferLayout=[{name:"position",count:3,type:5126,offset:0,stride:20,normalized:!1},{name:"color",count:4,type:5121,offset:12,stride:20,normalized:!1},{name:"size",count:1,
type:5126,offset:16,stride:20,normalized:!1}];this._loadDataPromise=null;this._numStars=0;this._dateHandle=this._starData=null;this.view=a;this._loadDataPromise=this._loadBrightStarCatalogue()}b.prototype.destroy=function(){this._loadDataPromise.isFulfilled()||this._loadDataPromise.cancel();this._dateHandle&&(this._dateHandle.remove(),this._dateHandle=null);this._program&&(this._program.dispose(),this._program=null)};b.prototype.initializeRenderContext=function(a){var b=this;a.shaderSnippets.vertexShaderStar||
a.shaderSnippets._parse(e);this._program=new t(a.rctx,a.shaderSnippets.vertexShaderStar,a.shaderSnippets.fragmentShaderStar,k.Default3D);this._dateHandle=c.init(this.view,"environment.lighting.date",function(a){return b._update(a)});this._loadDataPromise.then(function(){b._numStars=b._starData.byteLength/b.bytesPerStar;var c=new Float32Array(b._starData,0,b._numStars*b.numBinaryFloats),d=new Uint8Array(b._starData,b._numStars*b.numBinaryFloats*4,b._numStars*b.numBinaryUInt8),c=b._createStarGeometryData(c,
d);b._renderer=new n(c,b._vertexBufferLayout,b._fillInterleaved,a.rctx);b._renderer.enablePointRendering(!0);b.needsRender=!0})};b.prototype.uninitializeRenderContext=function(a){this.destroy()};b.prototype.render=function(a){if(a.slot!==this.slot||a.pass!==l.MATERIAL||null==this._starData)return!1;var b=a.rctx,c=b.gl,d=this._program;b.bindProgram(d);d.setUniformMatrix4fv("view",a.camera.viewMatrix);d.setUniformMatrix4fv("proj",a.camera.projectionMatrix);d.setUniform4fv("viewport",a.camera.fullViewport);
d.setUniformMatrix4fv("model",this._renderData.model);b.setDepthTestEnabled(!0);b.setDepthFunction(c.LEQUAL);b.setBlendingEnabled(!0);b.setBlendFunctionSeparate(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA);b.setDepthWriteEnabled(!1);this._renderer.render(d);b.setBlendingEnabled(!1);b.setDepthWriteEnabled(!0);b.setDepthFunction(c.LESS);this.needsRender=!1;return!0};b.prototype._fillInterleaved=function(a,b,c,d,f,g,k){var l=u.getStride(f);c=l/4;var m=a.indices[x.POSITION],e=a.vertexAttr[x.POSITION].data;
d=k+u.findAttribute(f,"position").offset/4;for(var n=0;n<m.length;++n){var p=3*m[n];r.fill(e,p,g,d,b,3);d+=c}b=a.indices[x.COLOR];m=a.vertexAttr[x.COLOR].data;d=k+u.findAttribute(f,"color").offset;e=new Uint8Array(g.buffer);for(n=0;n<b.length;++n)p=4*b[n],r.fillColor(m,p,e,d,4),d+=l;l=a.indices[x.SIZE];a=a.vertexAttr[x.SIZE].data;d=k+u.findAttribute(f,"size").offset/4;for(n=0;n<l.length;++n)g[d]=a[l[n]],d+=c};b.prototype._computeDayDuration=function(a){var b=new Date(a.getFullYear(),0,1,11,58,56),
c=new Date(a.getFullYear()+1,0,1,11,58,55);return(+a-+b)/(+c-+b)};b.prototype._update=function(a){if(a){var b=a.getHours()/12,c=a.getMinutes()/60*(2/24),d=a.getSeconds()/60*(2/1440),b=(b+c+d-.9972222)%2;a=2*this._computeDayDuration(a);c=f.mat4d.create(C);f.mat4d.rotateZ(c,-a*Math.PI);f.mat4d.multiply(y,c,c);f.mat4d.rotateZ(c,-b*Math.PI);this._renderData.model=c;this.needsRender=!0}};b.prototype._hexToRGB=function(a){return[parseInt(a.substring(0,2),16),parseInt(a.substring(2,4),16),parseInt(a.substring(4,
6),16)]};b.prototype._unpackUint8Attributes=function(a){return 192<=a?[2.9,a-192]:160<=a?[2.5,a-160]:128<=a?[2,a-128]:96<=a?[1.5,a-96]:64<=a?[1,a-64]:32<=a?[.7,a-32]:[.4,a]};b.prototype._createStarGeometryData=function(a,b){for(var c=new Float32Array(3*this._numStars),d=new Uint8Array(4*this._numStars),f=new Float32Array(this._numStars),g=new Uint32Array(this._numStars),k=0;k<this._numStars;k++){var l=2*k,m=3*k,e=4*k,n=a[l+0],l=a[l+1];c[m+0]=-Math.cos(n)*Math.sin(l);c[m+1]=-Math.sin(n)*Math.sin(l);
c[m+2]=-Math.cos(l);m=this._unpackUint8Attributes(b[k]);n=this._hexToRGB(v[m[1]]);d[e+0]=255*n[0];d[e+1]=255*n[1];d[e+2]=255*n[2];d[e+3]=255;f[k]=m[0];g[k]=k}a={};a[x.POSITION]=g;a[x.NORMAL]=g;a[x.UV0]=g;a[x.COLOR]=g;a[x.SIZE]=g;g={};g[x.POSITION]={size:3,data:c};g[x.COLOR]={size:4,data:d};g[x.SIZE]={size:1,data:f};return{id:"stardata",indices:a,vertexAttr:g,preinterleaved:!1}};b.prototype._verifyStartData=function(a){if(!a)throw new d("stars:no-data-received","Failed to create stars because star catalogue is missing");
a=a.byteLength/this.bytesPerStar;if(0!==a%1||5E4<a||5E3>a)throw new d("stars:invalid-data","Failed to create stars because star catalogue data is invalid");};b.prototype._loadBrightStarCatalogue=function(){var b=this;return B?(this._starData=B,g.resolve()):a(q.toUrl("./resources/stars.wsv"),{responseType:"array-buffer"}).then(function(a){a=a.data;b._verifyStartData(a);B=a;b._starData=a}).catch(function(a){a&&"cancel"!==a.dojoType&&A.error("loadBrightStarCatalogue",a.message);throw a;})};return b}()})},
"esri/views/3d/support/sunUtils":function(){define(["require","exports","../lib/glMatrix","../lib/SunCalc","./mathUtils"],function(q,h,e,a,d){function b(a,b,c,d){for(var f=[],g=0;g<c.length;g++)f[g]=(d[g]-c[g])*a/b+c[g];return f}Object.defineProperty(h,"__esModule",{value:!0});h.settings={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,diffuseAtNoon:.65,diffuseAtTwilight:.7},global:{altitude:8E5,ambient:.015,diffuse:.75},planarDirection:{localAltitude:1E4,globalAltitude:1E6,
globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};h.computeColorAndIntensity=function(c,g){var k,n,m,r=g.z,t=f;e.vec3d.set3(1,1,1,t.ambient.color);t.ambient.intensity=h.settings.global.ambient;e.vec3d.set3(1,1,1,t.diffuse.color);t.diffuse.intensity=h.settings.global.diffuse;r=(Math.abs(r)-h.settings.local.altitude)/(h.settings.global.altitude-h.settings.local.altitude);r=d.clamp(r,0,1);t.globalFactor=r;g=a.getTimes(c,g.y,g.x);if(1>r){n=c.valueOf();var u,x;g.polarException===a.POLAR_EXCEPTION.MIDNIGHT_SUN?
(u=n-36E5*(c.getHours()+48)-6E4*c.getMinutes(),x=u+432E6):g.polarException===a.POLAR_EXCEPTION.POLAR_NIGHT?(u=n-2,x=n-1):(u=g.sunrise.valueOf(),x=g.sunset.valueOf());var v=x-u;m=u+v/2;var A=v/4;k=m-A;var A=m+A,y=.06*v,v=u-y/2;u+=y/2;var C=x-y/2,B=x+y/2;x=h.settings.local;var D=[.01,x.ambientAtNight],E=[.8,.8,1],q=[.01,.01,.01],F=[x.diffuseAtTwilight,x.ambientAtTwilight],M=[1,.75,.75],H=[.8,.8,1],I=[.9*x.diffuseAtNoon,x.ambientAtNoon],K=[1,.98,.98],O=[.98,.98,1],P=[x.diffuseAtNoon,x.ambientAtNoon],
L=[1,1,1],U=[1,1,1];x=[0,0];var N=[0,0],y=[0,0];n<v||n>B?(x=D,N=q,y=E):n<u?(y=u-v,x=b(n-v,y,D,F),N=b(n-v,y,q,M),y=b(n-v,y,E,H)):n<k?(y=k-u,x=b(n-u,y,F,I),N=b(n-u,y,M,K),y=b(n-u,y,H,O)):n<m?(y=m-k,x=b(n-k,y,I,P),N=b(n-k,y,K,L),y=b(n-k,y,O,U)):n<A?(y=A-m,x=b(n-m,y,P,I),N=b(n-m,y,L,K),y=b(n-m,y,U,O)):n<C?(y=C-A,x=b(n-A,y,I,F),N=b(n-A,y,K,M),y=b(n-A,y,O,H)):n<B&&(y=B-C,x=b(n-C,y,F,D),N=b(n-C,y,M,q),y=b(n-C,y,H,E));n=x[0];m=N;k=x[1];e.vec3d.lerp(y,t.ambient.color,r,t.ambient.color);t.ambient.intensity=
d.lerp(k,t.ambient.intensity,r);e.vec3d.lerp(m,t.diffuse.color,r,t.diffuse.color);t.diffuse.intensity=d.lerp(n,t.diffuse.intensity,r)}r=c.valueOf();g.polarException===a.POLAR_EXCEPTION.MIDNIGHT_SUN?(c=r-36E5*(c.getHours()+48)-6E4*c.getMinutes(),g=c+432E6):g.polarException===a.POLAR_EXCEPTION.POLAR_NIGHT?(c=r-2,g=r-1):(c=g.sunrise.valueOf(),g=g.sunset.valueOf());c=1-d.clamp(Math.abs(r-(c+(g-c)/2))/432E5,0,1);t.noonFactor=c;return t};h.computeDirection=function(b,f,l,p){p||(p=e.vec3d.create());var k=
c,n=e.mat4d.identity(g);if("global"===l)a.getPosition(b,0,0,k),e.vec3d.set3(0,0,-1,p),e.mat4d.rotateX(n,-k.azimuth),e.mat4d.rotateY(n,-k.altitude);else{var t=h.settings.planarDirection;l=t.globalAngles;t=(Math.abs(f.z)-t.localAltitude)/(t.globalAltitude-t.localAltitude);t=d.clamp(t,0,1);1>t?(a.getPosition(b,f.y,f.x,k),k.azimuth=(1-t)*k.azimuth+t*l.azimuth,k.altitude=(1-t)*k.altitude+t*l.altitude):(k.azimuth=l.azimuth,k.altitude=l.altitude);e.vec3d.set3(0,-1,0,p);e.mat4d.rotateZ(n,-k.azimuth);e.mat4d.rotateX(n,
-k.altitude)}e.mat4d.multiplyVec3(n,p);return p};h.computeShadowsEnabled=function(a,b){return"global"===b?!0:Math.abs(a.z)<h.settings.planarDirection.localAltitude};var g=e.mat4d.identity(),c={azimuth:0,altitude:0},f={ambient:{color:e.vec3d.create(),intensity:0},diffuse:{color:e.vec3d.create(),intensity:0,direction:e.vec3d.create()},globalFactor:0,noonFactor:0}})},"esri/views/3d/lib/SunCalc":function(){define([],function(){function q(a){return new Date(864E5*(a+.5-2440588))}function h(a,b){return r(n(a)*
l(v)-p(b)*n(v),l(a))}function e(a,b){return m(n(b)*l(v)+l(b)*n(v)*n(a))}function a(a,b,c){return r(n(a),l(a)*n(b)-p(c)*l(b))}function d(a,b,c){return m(n(b)*n(c)+l(b)*l(c)*l(a))}function b(a){return u*(1.9148*n(a)+.02*n(2*a)+3E-4*n(3*a))}function g(a,c){a=u*(357.5291+.98560028*a);var d=b(a);a=a+d+102.9372*u+k;c||(c={dec:0,ra:0});c.dec=e(a,0);c.ra=h(a,0);return c}function c(a,b,c){return 2451545+a+.0053*n(b)-.0069*n(2*c)}function f(a){var b=u*(134.963+13.064993*a),c=u*(93.272+13.22935*a);a=u*(218.316+
13.176396*a)+6.289*u*n(b);c=5.128*u*n(c);b=385001-20905*l(b);return{ra:h(a,c),dec:e(a,c),dist:b}}var k=Math.PI,n=Math.sin,l=Math.cos,p=Math.tan,m=Math.asin,r=Math.atan2,t=Math.acos,u=k/180,x={dec:0,ra:0},v=23.4397*u,A={POLAR_EXCEPTION:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(b,c,f,k){f=u*-f;c*=u;var l=b.valueOf()/864E5-.5+2440588-2451545;b=g(l,x);f=u*(280.16+360.9856235*l)-f-b.ra;k||(k={azimuth:0,altitude:0});k.azimuth=a(f,c,b.dec);k.altitude=d(f,c,b.dec);return k}},y=[[-.83,"sunrise",
"sunset"]];A.addTime=function(a,b,c){y.push([a,b,c])};A.getTimes=function(a,d,f){function g(a){var b=p,d=x;a=t((n(a)-n(b)*n(d))/(l(b)*l(d)));return c(9E-4+(a+m)/(2*k)+r,v,h)}var m=u*-f,p=u*d,r=Math.round(a.valueOf()/864E5-.5+2440588-2451545-9E-4-m/(2*k));a=9E-4+(0+m)/(2*k)+r;var v=u*(357.5291+.98560028*a);d=b(v);var h=v+d+102.9372*u+k,x=e(h,0);a=c(a,v,h);d={solarNoon:q(a),nadir:q(a-.5),polarException:A.POLAR_EXCEPTION.NORMAL};var C,B,D,U;f=0;for(C=y.length;f<C;f+=1)B=y[f],D=g(B[0]*u),U=a-(D-a),d[B[1]]=
q(U),d[B[2]]=q(D);d.polarException=function(a){a=(n(a)-n(p)*n(x))/(l(p)*l(x));return-1>a?A.POLAR_EXCEPTION.MIDNIGHT_SUN:1<a?A.POLAR_EXCEPTION.POLAR_NIGHT:A.POLAR_EXCEPTION.NORMAL}(y[0][0]*u);return d};A.getMoonPosition=function(b,c,g){g=u*-g;c*=u;var k=b.valueOf()/864E5-.5+2440588-2451545;b=f(k);g=u*(280.16+360.9856235*k)-g-b.ra;k=d(g,c,b.dec);k+=.017*u/p(k+10.26*u/(k+5.1*u));return{azimuth:a(g,c,b.dec),altitude:k,distance:b.dist}};A.getMoonFraction=function(a){var b=a.valueOf()/864E5-.5+2440588-
2451545;a=g(b);b=f(b);a=t(n(a.dec)*n(b.dec)+l(a.dec)*l(b.dec)*l(a.ra-b.ra));a=r(149598E3*n(a),b.dist-149598E3*l(a));return(1+l(a))/2};return A})},"esri/views/3d/webgl-engine/lighting/Lightsources":function(){define(["require","exports","../../lib/glMatrix"],function(q,h,e){Object.defineProperty(h,"__esModule",{value:!0});var a=e.vec3d;q=function(){return function(d,b,g){void 0===d&&(d=a.create());void 0===b&&(b=a.createFrom(.57735,.57735,.57735));void 0===g&&(g=!0);this.intensity=d;this.direction=
b;this.castShadows=g}}();h.MainLight=q;q=function(){return function(d,b){void 0===d&&(d=a.create());void 0===b&&(b=a.createFrom(.57735,.57735,.57735));this.intensity=a.create();this.direction=a.create();this.intensity=d;this.direction=b}}();h.FillLight=q;q=function(){return function(d){void 0===d&&(d=a.create());this.intensity=d}}();h.AmbientLight=q;q=function(){return function(){this.sh={r:[0],g:[0],b:[0]}}}();h.SphericalHarmonicsLight=q})},"esri/views/3d/input/SceneInputManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators ./handlers/DoubleClickZoom ./handlers/DragRotate ./handlers/DragZoom ./handlers/KeyPan ./handlers/MouseWheelZoom ./handlers/PinchAndPanNavigation ./handlers/PointerDownCancelAnimation ./handlers/SingleKeyResetHeading ./handlers/SingleKeyResetTilt ./handlers/TwoFingerTilt ../../input/BrowserEventSource ../../input/InputManager ../../input/ViewEvents ../../input/handlers/PreventContextMenu".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u,x,v,A,y,C){q=function(d){function h(){var a=null!==d&&d.apply(this,arguments)||this;a._handles=new b;return a}e(h,d);h.prototype.initialize=function(){var a=this;this.viewEvents=new y.ViewEvents(this.view);this._handles.add([g.whenNot(this.view,"ready",function(){return a._disconnect()}),g.when(this.view,"ready",function(){return a._connect()})])};h.prototype.destroy=function(){this._handles&&(this._handles.removeAll(),this._handles=null);this._disconnect()};
Object.defineProperty(h.prototype,"primaryDragAction",{get:function(){return this._get("primaryDragAction")},set:function(a){"pan"!==a&&"rotate"!==a||a===this._get("primaryDragAction")||(this._set("primaryDragAction",a),this._updateMode())},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"mode",{get:function(){return this._get("mode")},set:function(a){"default"!==a&&"pro"!==a||a===this._get("mode")||(this._set("mode",a),this._updateMode())},enumerable:!0,configurable:!0});h.prototype._disconnect=
function(){this.viewEvents.disconnect();this._source&&(this._source.destroy(),this._source=null);this._inputManager&&(this._inputManager.destroy(),this._inputManager=null)};h.prototype._connect=function(){var a=this.view;this._source=new v.BrowserEventSource(this.view.surface);var b=new A.InputManager(this._source);this._inputManager=b;b.installHandlers("prevent-context-menu",[new C.PreventContextMenu]);this._modeDragPan=new m.PinchAndPanNavigation(a,"primary");this._modeDragRotate=new k.DragRotate(a,
"secondary","center");this._modeDragZoom=new n.DragZoom(a,"tertiary");b.installHandlers("navigation",[new r.PointerDownCancelAnimation(a),new f.DoubleClickZoom(a),new l.KeyPan(a,{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j"}),new p.MouseWheelZoom(a),new u.SingleKeyResetTilt(a,"p"),new t.SingleKeyResetHeading(a,"n"),new k.DragRotate(a,"primary","eye",["b"]),new k.DragRotate(a,"secondary","center",["b"]),new m.PinchAndPanNavigation(a,"tertiary",["b"]),this._modeDragRotate,
this._modeDragZoom,this._modeDragPan,new x.TwoFingerTilt(a)]);this.viewEvents.connect(b);this._updateMode()};h.prototype._updateMode=function(){var a=this.primaryDragAction,a=B.get(this.mode).get(a);this._modeDragPan&&(this._modeDragPan.pointerAction=a.pan);this._modeDragRotate&&(this._modeDragRotate.pointerAction=a.rotate);this._modeDragZoom&&(this._modeDragZoom.pointerAction=a.zoom)};a([c.property()],h.prototype,"view",void 0);a([c.property({value:"pan"})],h.prototype,"primaryDragAction",null);
a([c.property({value:"default"})],h.prototype,"mode",null);a([c.property({readOnly:!0,aliasOf:"_inputManager.latestPointerType"})],h.prototype,"latestPointerType",void 0);a([c.property()],h.prototype,"_inputManager",void 0);return h=a([c.subclass("esri.views.3d.input.SceneInputManager")],h)}(c.declared(d));var B=new Map;h=new Map;d=new Map;h.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"});h.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"});d.set("pan",{pan:"primary",rotate:"tertiary",
zoom:"secondary"});d.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"});B.set("default",h);B.set("pro",d);return q})},"esri/views/3d/input/handlers/DoubleClickZoom":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../state/helpers/PickingHelper ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(q,h,e,a,d,b,g,c){Object.defineProperty(h,
"__esModule",{value:!0});q=function(f){function g(a,c){var d=f.call(this,!0)||this;d.view=a;d.pickingHelper=new b.PickingHelper(a);d.registerIncoming("double-click",c,function(a){return d.handleDoubleClick(a)});return d}e(g,f);g.prototype.handleDoubleClick=function(b){var f=b.data;if(c.eventMatchesPointerAction(f,"primary")){var g=this.view.state.isGlobal?new a.ZoomStepController(this.view,this.pickingHelper,"animation"):new d.ZoomStepController(this.view,this.pickingHelper,"animation");this.view.state.switchCameraController(g);
g.zoomStep(Math.log(.5)/Math.log(.6),[f.x,this.view.height-f.y]);b.stopPropagation()}};return g}(g.InputHandler);h.DoubleClickZoom=q})},"esri/views/3d/state/controllers/global/ZoomStepController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../lib/glMatrix ../PointToPointAnimationController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../animation/easing".split(" "),function(q,h,e,a,d,b,g,c,f){Object.defineProperty(h,
"__esModule",{value:!0});q=function(b){function k(a,f,g){f=b.call(this,a.state,f,"interaction"===g?null:void 0)||this;f.view=a;f.mode=g;f.zoomLocation=d.vec3d.create();f.tmpCamera=new c;f.panAxis=d.vec3d.create();f.tmpViewDir=d.vec3d.create();f.targetOnSphere=d.vec3d.create();f.tmpCenter=d.vec3d.create();f.constraintOptions={selection:7,interactionType:1,interactionFactor:null,interactionStartCamera:new c,interactionDirection:null};f.sphere={center:d.vec3d.create(),radius:0};return f}e(k,b);Object.defineProperty(k.prototype,
"isInteractive",{get:function(){return"interaction"===this.mode},enumerable:!0,configurable:!0});k.prototype.zoomStep=function(a,b){if(this.active){var c=this.view.state,f=this.constraintOptions.interactionStartCamera;this.animation.finished?f.copyFrom(c.camera):this.animation.cameraAt(1,f);f=!1;0<a&&this.pickingHelper.pickPointInScreen(b,this.zoomLocation)&&(f=!0);this.tmpCamera.copyFrom(c.camera);f?this.pickingHelper.pickRaySegment(this.tmpCamera.eye,this.tmpCamera.center,this.tmpCenter)&&(this.tmpCamera.center=
this.tmpCenter):this.pickingHelper.pickRaySegment(this.tmpCamera.eye,this.tmpCamera.center,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:d.vec3d.set(this.tmpCamera.center,this.zoomLocation);this.updateCamera(this.tmpCamera,Math.pow(.6,a),this.zoomLocation,b);this.begin(this.tmpCamera)}};k.prototype.animationSettings=function(){return{apex:null,duration:.6,easing:f.outExpo}};k.prototype.updateCamera=function(b,c,f,k){this.sphere.radius=d.vec3d.length(f);d.vec3d.subtract(b.center,b.eye,
this.tmpViewDir);var m=d.vec3d.length(this.tmpViewDir),l=m*c;1>=c&&4>l&&(l=4,c=l/m);1E-6>Math.abs(m-l)||(m=d.vec3d.length(b.center),this.sphere.radius!==m&&d.vec3d.scale(b.center,(this.sphere.radius+c*(m-this.sphere.radius))/m),d.vec3d.scale(this.tmpViewDir,-c),d.vec3d.add(b.center,this.tmpViewDir,b.eye),a.applyAll(this.view,b,this.constraintOptions),1E-12<d.vec3d.dist2(f,b.center)&&g.intersectSphereFromScreenPoint(this.sphere,b,k,this.targetOnSphere)&&(c=g.rotationAndAxisFromPoints(f,this.targetOnSphere,
this.panAxis),g.applyRotation(b,this.sphere.center,this.panAxis,c)),a.applySurfaceCollision(this.view,b))};return k}(b.PointToPointAnimationController);h.ZoomStepController=q})},"esri/views/3d/camera/constraintUtils":function(){define("require exports ./constraintUtils/altitude ./constraintUtils/common ./constraintUtils/distance ./constraintUtils/surfaceCollision ./constraintUtils/tilt ../lib/glMatrix ../../animation/easing ./constraintUtils/tilt ./constraintUtils/altitude ./constraintUtils/distance ./constraintUtils/surfaceCollision".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p){Object.defineProperty(h,"__esModule",{value:!0});h.applyTilt=k.apply;h.tiltError=k.error;h.applyAltitude=n.apply;h.altitudeError=n.error;h.applyDistance=l.apply;h.distanceError=l.error;h.applySurfaceCollision=p.apply;h.applyAll=function(c,d,f,g){void 0===f&&(f=r);void 0===g&&(g=d);var k=!1;g!==d&&g.copyFrom(d);g.markViewDirty();g.computeUp(c.state.mode);for(d=0;d<t;d++){for(var l=0,e=0,n=m;e<n.length;e++){var p=n[e];if(a.hasConstraintType(f.selection,p.type)){var u=
Math.abs(p.error(c,g,f));p.apply(c,g,f)&&(k=!0,l+=u)}}if(0===l)break}d=a.hasConstraintType(f.selection,8);f=4===f.interactionType?1:0;d&&b.apply(c,g,f)&&(k=!0);k&&g.computeUp(c.state.mode);return k};h.pixelDistanceToInteractionFactor=function(a,b){a="number"===typeof a?a:c.vec2d.dist(a,b);return f.inOutCubic(Math.min(1,a/150))};var m=[{type:1,error:function(a,b,c){return g.error(a,b,c)*b.distance},apply:g.apply},{type:2,error:e.error,apply:e.apply},{type:4,error:d.error,apply:d.apply}],r={selection:15,
interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null},t=5})},"esri/views/3d/camera/constraintUtils/altitude":function(){define("require exports ./common ../../lib/glMatrix ../../support/intersectionUtils ../../support/mathUtils".split(" "),function(q,h,e,a,d,b){function g(a,c,d){void 0===d&&(d=e.defaultApplyOptions);var k;k=a.state.constraints.altitude;k=a.state.isGlobal&&k?2===d.interactionType&&e.hasConstraintType(d.selection,1)?!1:!0:!1;if(!k)return 0;var m=
a.state.constraints.altitude;k=f;k.min=m.min;k.max=m.max;var l=d.interactionType;if(0!==l){var m=k.min,n=k.max,p=d.interactionStartCamera;d=d.interactionFactor;var l=2===l||1===l,r=g(a,p),p=0===r?0:a.renderCoordsHelper.getAltitude(p.eye);k.min=m;k.max=n;e.adjustRangeForInteraction(r,p,l,d,.05*p,k)}a=a.renderCoordsHelper.getAltitude(c.eye);a=b.clamp(a,k.min,k.max)-a;return 1E-6>=Math.abs(a)?0:a}function c(b,c,d,f){b.renderCoordsHelper.worldUpAtPosition(c.eye,f);a.vec3d.scale(f,d);return f}Object.defineProperty(h,
"__esModule",{value:!0});h.apply=function(f,m,r,t){void 0===r&&(r=e.defaultApplyOptions);void 0===t&&(t=m);t!==m&&t.copyFrom(m);var p=g(f,m,r);if(0===p)return!1;var h=f.renderCoordsHelper,v=h.getAltitude(m.eye)+p;f=e.interactionDirectionTowardsConstraintMinimization(f,m,r.interactionDirection,c(f,m,b.sign(p),n),k);r=a.vec3d.set(m.viewForward,l);h.intersectManifold(m.eye,f,v,t.eye)||h.setAltitude(v,t.eye);d.closestPointOnRay(m.eye,r,m.center,m.center);t.markViewDirty();return!0};h.error=g;var f={min:0,
max:0},k=a.vec3d.create(),n=a.vec3d.create(),l=a.vec3d.create()})},"esri/views/3d/camera/constraintUtils/common":function(){define(["require","exports","../../lib/glMatrix","../../support/mathUtils"],function(q,h,e,a){Object.defineProperty(h,"__esModule",{value:!0});h.hasConstraintType=function(a,b){return 0!==(a&b)};h.adjustRangeForInteraction=function(a,b,g,c,f,k){0!==a&&(g?(k.min=Math.min(k.min,b),k.max=Math.max(k.max,b)):null!=c?(k.min-=Math.max(0,(b-k.min)*(1-c)),k.max+=Math.max(0,(b-k.max)*
(1-c))):f&&(k.min-=Math.max(0,b-k.min-f),k.max+=Math.max(0,b-k.max-f)))};h.defaultApplyOptions={selection:0,interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null};h.interactionDirectionTowardsConstraintMinimization=function(d,b,g,c,f){g||(g=b.viewForward);e.vec3d.set(g,f);e.vec3d.scale(f,a.sign(e.vec3d.dot(g,c)));return f}})},"esri/views/3d/support/intersectionUtils":function(){define(["require","exports","../lib/glMatrix"],function(q,h,e){function a(a,b,d,n){var c=
g;a?(d&&n&&(c.len=e.vec3d.dist(b,d)),e.vec3d.set(a,c.dir)):n?(c.len=e.vec3d.dist(b,d),e.vec3d.scale(e.vec3d.subtract(d,b,c.dir),1/c.len)):e.vec3d.normalize(e.vec3d.subtract(d,b,c.dir));return c}function d(a,b){return-e.vec3d.dot(b,a)-a[3]}function b(a,b,g,n){n.clip[0]=0;n.clip[1]=g?n.len:Number.MAX_VALUE;for(g=0;g<a.length;g++){var c;var f=a[g],k=b;c=n;var r=e.vec3d.dot(f,c.dir),f=d(f,k);0>f&&0<=r?c=!1:-1E-6<r&&1E-6>r?c=0<f:!(0>f||0>r)||0>f&&0>r?(f/=r,0<r?f<c.clip[1]&&(c.clip[1]=f):f>c.clip[0]&&(c.clip[0]=
f),c=c.clip[0]<=c.clip[1]):c=!0;if(!c)return!1}return!0}Object.defineProperty(h,"__esModule",{value:!0});h.planeSphere=function(a,b,d){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]<d};h.frustumSphere=function(a,b,d){var c=b[0],f=b[1];b=b[2];return a[0][0]*c+a[0][1]*f+a[0][2]*b+a[0][3]>d||a[1][0]*c+a[1][1]*f+a[1][2]*b+a[1][3]>d||a[2][0]*c+a[2][1]*f+a[2][2]*b+a[2][3]>d||a[3][0]*c+a[3][1]*f+a[3][2]*b+a[3][3]>d||a[4][0]*c+a[4][1]*f+a[4][2]*b+a[4][3]>d||a[5][0]*c+a[5][1]*f+a[5][2]*b+a[5][3]>d?!1:!0};h.frustumRay=
function(c,d,g,e){g=a(e,d,g,!1);return b(c,d,null,g)};h.frustumPoint=function(a,b){for(var c=0;6>c;c++)if(0>d(a[c],b))return!1;return!0};h.frustumLineSegment=function(c,d,g,e){e=a(e,d,g,!0);return b(c,d,g,e)};h.closestPointOnRay=function(a,b,d,g){d=e.vec3d.dot(b,e.vec3d.subtract(d,a,g));e.vec3d.add(a,e.vec3d.scale(b,d,g),g);return g};var g={dir:e.vec3d.create(),len:0,clip:e.vec2d.create()}})},"esri/views/3d/camera/constraintUtils/distance":function(){define(["require","exports","./common","../../lib/glMatrix",
"../../webgl-engine/lib/Util"],function(q,h,e,a,d){function b(c,d,f){void 0===f&&(f=e.defaultApplyOptions);if(!c.state.isLocal)return 0;var k=c.state.constraints.distance;if(!c.pointsOfInterest.surfaceOrigin.renderLocation||Infinity===k)return 0;g.min=0;g.max=k;var k=g,m=f.interactionType;if(0!==m){var l=k.min,n=k.max,p=f.interactionStartCamera;f=f.interactionFactor;var m=1===m||4===m,h=b(c,p),p=0===h?0:a.vec3d.dist(p.eye,c.pointsOfInterest.surfaceOrigin.renderLocation);k.min=l;k.max=n;e.adjustRangeForInteraction(h,
p,m,f,.05*p,k)}c=a.vec3d.dist(d.eye,c.pointsOfInterest.surfaceOrigin.renderLocation);c=g.max-c;return-1E-6<=c?0:c}Object.defineProperty(h,"__esModule",{value:!0});h.error=b;h.apply=function(g,p,m,r){void 0===m&&(m=e.defaultApplyOptions);void 0===r&&(r=p);r!==p&&r.copyFrom(p);var l=b(g,p,m);if(0===l)return!1;var u=g.pointsOfInterest.surfaceOrigin,l=a.vec3d.dist(p.eye,g.pointsOfInterest.surfaceOrigin.renderLocation)+l,h=a.vec3d.set(p.eye,c);m=e.interactionDirectionTowardsConstraintMinimization(g,p,
m.interactionDirection,a.vec3d.direction(g.pointsOfInterest.surfaceOrigin.renderLocation,p.eye,n),k);return d.raySphere(p.eye,m,u.renderLocation,l,r.eye)?(p=a.vec3d.subtract(r.eye,h,f),a.vec3d.add(r.center,p),r.markViewDirty(),p=g.renderCoordsHelper.getAltitude(r.center),g.renderCoordsHelper.intersectManifold(r.eye,r.viewForward,p,r.center),r.markViewDirty(),!0):!1};var g={min:0,max:0},c=a.vec3d.create(),f=a.vec3d.create(),k=a.vec3d.create(),n=a.vec3d.create()})},"esri/views/3d/camera/constraintUtils/surfaceCollision":function(){define(["require",
"exports","../intersectionUtils","../../lib/glMatrix"],function(q,h,e,a){Object.defineProperty(h,"__esModule",{value:!0});h.apply=function(b,g,c,f){void 0===c&&(c=0);void 0===f&&(f=g);var k=b.state.constraints;g!==f&&f.copyFrom(g);if(!k.collision.enabled)return!1;var n=e.surfaceElevationBelowEye(b,g);g=b.renderCoordsHelper.getAltitude(g.eye);k=k.collision.elevationMargin;if(g-n>=k)return!1;a.vec3d.subtract(f.center,f.eye,d);b.renderCoordsHelper.setAltitude(n+k,f.eye);1===c&&a.vec3d.add(f.eye,d,f.center);
f.markViewDirty();return!0};var d=a.vec3d.create()})},"esri/views/3d/camera/intersectionUtils":function(){define("require exports ../../../geometry/Point ../../../geometry/support/aaBoundingRect ../lib/glMatrix ../support/earthUtils ../webgl-engine/lib/Selector".split(" "),function(q,h,e,a,d,b,g){function c(a,b){return a.renderCoordsHelper.fromRenderCoords(b,m,a.basemapTerrain.spatialReference)?a.basemapTerrain.getElevation(m)||0:0}function f(a,b,f,m){void 0===m&&(m=d.vec3d.create());var l=n[a.viewingMode];
l||(l=new g(a.viewingMode),l.enableBackfacesTerrain=!a.state.isGlobal,l.enableInvisibleTerrain=!0,n[a.viewingMode]=l);a._stage.pickRay(b,f,null,null,null,null,l);if((l=l.getMinResult())&&l.getIntersectionPoint(m))return m;var l=d.vec3d.direction(f,b,r),e="global"===a.viewingMode;a.renderCoordsHelper.intersectManifold(b,l,0,m)?e&&0>a.renderCoordsHelper.getAltitude(b)&&(l=c(a,b),e=a.stateManager.constraintsManager.nearFarHeuristic.compute(b,m,a.dataExtent,l),a=e.distance,l=e.maxFarNearRatio,e=e.minNearDistance,
a=a/l>e?a:e*l,d.vec3d.dist2(b,m)>a&&k(b,f,!0,m)):e?k(b,f,!1,m):f!==m&&d.vec3d.set(f,m);return m}function k(a,c,f,g){var k=d.vec3d.dot(a,a)-b.earthRadius*b.earthRadius;f&&(k=Math.abs(k));f=0<k?Math.sqrt(k)/3:1;d.vec3d.subtract(c,a,g);d.vec3d.scale(g,f/d.vec3d.length(g),g);d.vec3d.add(g,a)}Object.defineProperty(h,"__esModule",{value:!0});h.eyeWithinExtent=function(b,c,d,f){return b.renderCoordsHelper.fromRenderCoords(c.eye,l,f)&&a.containsPoint(d,l)};h.surfaceElevationBelowEye=function(a,b){return c(a,
b.eye)};h.surfaceElevationBelowRenderPoint=c;h.cameraOnContentAlongViewDirection=function(a,b,c,g){var k=a.state.camera.copy();b&&(k.eye=b);c&&(k.center=c);g&&(k.up=g);f(a,k.eye,k.center,p);c=a.state.constraints;g=c.minimumPoiDistance;d.vec3d.dist2(k.eye,p)<g&&(b=c.collision.enabled,d.vec3d.set(k.viewForward,r),d.vec3d.scale(r,g),b?d.vec3d.subtract(p,r,k.eye):d.vec3d.add(k.eye,r,p),a=a.renderCoordsHelper,g=a.getAltitude(k.eye),c=c.collision.elevationMargin,b&&g<c&&(d.vec3d.subtract(p,k.eye,r),a.setAltitude(c,
k.eye),d.vec3d.add(k.eye,r,p)));k.center=p;return k};h.contentAlongViewDirection=f;var n={},l=d.vec3d.create(),p=d.vec3d.create(),m=new e,r=d.vec3d.create()})},"esri/views/3d/webgl-engine/lib/Selector":function(){define("require exports dojo/has ./gl-matrix ./Object3D ./PerformanceTimer".split(" "),function(q,h,e,a,d,b){var g=a.vec3d.create(),c=a.vec3d.create();q=function(){function b(b,c,d,g,e,n,h,v){void 0===v&&(v=!1);this.dir=a.vec3d.create();this.normalDir=null;this.minResult=new f;this.maxResult=
new f;this.transform=a.mat4d.create();this._transformInverse=new k({value:this.transform},a.mat4d.inverse,a.mat4d.create);this._transformInverseTranspose=new k(this._transformInverse,a.mat4d.transpose,a.mat4d.create);this._transformTranspose=new k({value:this.transform},a.mat4d.transpose,a.mat4d.create);this._transformInverseRotation=new k({value:this.transform},a.mat4d.toInverseMat3,a.mat3d.create);this.enableTerrain=this.enableHUDSelection=!0;this.enableInvisibleTerrain=!1;this.enableBackfacesTerrain=
!0;this.performanceInfo={queryDuration:0,numObjectsTested:0};this.viewingMode=b||"global";this.intersectObject=this.intersectObject.bind(this);this.init(c,d,g,e,n,h,v)}b.prototype.init=function(b,c,d,f,g,k,e){c&&d&&a.vec3d.subtract(d,c,this.dir);this.minResult.init(c,d);this.maxResult.init(c,d);this.numObjectsTested=0;this.point=f;this.camera=g;this.isSelection=e;this.layers=b;this.p0=c;this.p1=d;this.hudResults=[];null==k&&(k=1E-5);this.tolerance=k;if(this.layers)for(b=0;b<this.layers.length;++b)if(c=
this.layers[b],d=c.getSpatialQueryAccelerator?c.getSpatialQueryAccelerator():void 0)d.forEachAlongRay(this.p0,this.dir,this.intersectObject),e&&d.forEachDegenerateObject(this.intersectObject);else for(c=c.getObjects(),d=0;d<c.length;++d)this.intersectObject(c[d])};Object.defineProperty(b.prototype,"transformInverse",{get:function(){return this._transformInverse.value},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"transformInverseTranspose",{get:function(){return this._transformInverseTranspose.value},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"transformInverseRotation",{get:function(){return this._transformInverseRotation.value},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"transformTranspose",{get:function(){return this._transformTranspose.value},enumerable:!0,configurable:!0});b.prototype.getDirection=function(){this.normalDir||(this.normalDir=a.vec3d.create(),a.vec3d.normalize(this.dir,this.normalDir));return this.normalDir};b.prototype.intersectObject=
function(b){var d=this;this.numObjectsTested++;for(var k=b.id,l=b.getGeometryRecords(),e=b.objectTransformation,n,h=0;h<l.length;h++){var v=l[h],A=v.geometry,y=v.materials,C=v.instanceParameters;C.hidden||(n=A.id,a.mat4d.set(e,this.transform),a.mat4d.multiply(this.transform,v.getShaderTransformation()),this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate(),a.mat4d.multiplyVec3(this.transformInverse,
this.p0,g),a.mat4d.multiplyVec3(this.transformInverse,this.p1,c),y[0].intersect(A,C,this.transform,this,g,c,function(a,c,g,m,l,e){0<=a&&(l?(l=new f,l.init(d.p0,d.p1),l.set(b,k,a,c,m,e,n,g),d.hudResults.push(l)):((null==d.minResult.priority||m>=d.minResult.priority)&&(null==d.minResult.dist||a<d.minResult.dist)&&d.minResult.set(b,k,a,c,m,null,n,g),(null==d.maxResult.priority||m>=d.maxResult.priority)&&(null==d.maxResult.dist||a>d.maxResult.dist)&&d.maxResult.set(b,k,a,c,m,null,n,g)))},v.customTransformation))}};
b.prototype.getMinResult=function(){return this.minResult};b.prototype.getMaxResult=function(){return this.maxResult};b.prototype.getHudResults=function(){return this.hudResults};b.DEFAULT_TOLERANCE=1E-5;return b}();var f=function(){function b(b,c){this.normal=a.vec3d.create();this.init(b,c)}b.prototype.getIntersectionPoint=function(b){if(null==this.dist)return!1;a.vec3d.lerp(this.p0,this.p1,this.dist,b);return!0};b.prototype.set=function(b,c,f,g,k,e,n,v){b instanceof d&&(b={type:"stage",obj:b});
this.dist=f;a.vec3d.set(g,this.normal);this.target=b;this.name=c;this.priority=k;this.center=e?a.vec3d.create(e):null;this.geometryId=n;this.triangleNr=v};b.prototype.copyFrom=function(b){this.p0=b.p0;this.p1=b.p1;this.dist=b.dist;this.target=b.target;this.name=b.name;this.priority=b.priority;this.center=b.center?a.vec3d.create(b.center):null;this.geometryId=b.geometryId;this.triangleNr=b.triangleNr;this.intersector=b.intersector;a.vec3d.set(b.normal,this.normal)};b.prototype.setIntersector=function(a){this.intersector=
a};b.prototype.init=function(a,b){this.priority=this.name=this.target=this.dist=void 0;this.triangleNr=this.geometryId=this.center=null;this.intersector="Stage";this.p0=a;this.p1=b};return b}(),k=function(){function a(a,b,c){this.original=a;this.update=b;this.dirty=!0;this.transform=c()}a.prototype.invalidate=function(){this.dirty=!0};Object.defineProperty(a.prototype,"value",{get:function(){this.dirty&&(this.update(this.original.value,this.transform),this.dirty=!1);return this.transform},enumerable:!0,
configurable:!0});return a}();return q})},"esri/views/3d/webgl-engine/lib/Object3D":function(){define("require exports ./ComponentUtils ./GeometryRecord ./gl-matrix ./HighlightUtils ./IdGen ./ModelContentType ./Util".split(" "),function(q,h,e,a,d,b,g,c,f){var k=f.assert,n=d.mat4d,l=d.vec3d,p=n.identity();q=function(){function d(a){void 0===a&&(a={});this._bvObjectSpace=new m;this._bvWorldSpace=new m;this._bvDirty=!0;this._hasVolatileTransformation=!1;this._allComponentsHiddenDirty=!0;this.id=d._idGen.gen(a.idHint);
this.name=a.name;this.castShadow=null!=a.castShadow?a.castShadow:!0;this.metadata=a.metadata;this.objectTransformation=n.identity();this._initializeGeometryRecords(a.geometries,a.materials,a.transformations)}d.prototype._initializeGeometryRecords=function(b,c,d){if(Array.isArray(b)){k(c.length===b.length,"Object3D: materials don't match geometries");k(d.length===b.length,"Object3D: transformations don't match geometries");this.geometryRecords=Array(b.length);this.geometries=b.slice();for(var f=0;f<
b.length;f++)k(Array.isArray(c[f]),"Object3D: materials parameter must be array of array"),this.geometryRecords[f]=new a(b[f],c[f].slice(),n.create(d[f]),{});this._hasVolatileTransformation=!1}else this.geometryRecords=[],this.geometries=[]};Object.defineProperty(d.prototype,"parentLayer",{get:function(){return this._parentLayer},set:function(a){k(null==this._parentLayer||null==a,"Object3D can only be added to a single Layer");this._parentLayer=a},enumerable:!0,configurable:!0});d.prototype.getParentLayer=
function(){return this.parentLayer};d.prototype.addParentLayer=function(a){this.parentLayer=a};d.prototype.removeParentLayer=function(a){this.parentLayer=null};d.prototype.getNumGeometryRecords=function(){return this.geometryRecords.length};d.prototype.getFirstGeometryIndex=function(a){a=this.geometries.indexOf(a);k(-1<a,"Object3D.getFirstGeometryIndex: geometry not found");return a};d.prototype.findGeometryRecords=function(a){for(var b=[],c=0;c<this.geometries.length;c++)this.geometries[c]===a&&
b.push(this.geometryRecords[c]);return b};d.prototype.getGeometryRecord=function(a){k(0<=a&&a<this.geometryRecords.length,"Object3d.getGeometryDataByIndex: index out of range");return this.geometryRecords[a]};d.prototype.getGeometryRecords=function(){return this.geometryRecords};d.prototype.addGeometry=function(b,c,d,f,g,m){void 0===d&&(d=p);k(Array.isArray(c),"Object3D.addGeometry: materials must be array");this.geometries.push(b);b=new a(b,c.slice(),n.create(d),f||{},g,m);this.geometryRecords.push(b);
this._hasVolatileTransformation=this.geometryRecords.some(function(a){return!!a.customTransformation});this._notifyDirty("objGeometryAdded",b);this._invalidateBoundingVolume();return b};d.prototype.hasGeometry=function(a){return-1<this.geometries.indexOf(a)};d.prototype.removeGeometry=function(a){var b=this.geometryRecords.splice(a,1)[0];this._hasVolatileTransformation=this.geometryRecords.some(function(a){return!!a.customTransformation});this.geometries.splice(a,1);this._notifyDirty("objGeometryRemoved",
b);this._invalidateBoundingVolume();return b};d.prototype.removeAllGeometries=function(){for(;0<this.getNumGeometryRecords();)this.removeGeometry(0)};d.prototype.geometryVertexAttrsUpdated=function(a){this._notifyDirty("vertexAttrsUpdated",this.geometryRecords[a]);this._invalidateBoundingVolume()};d.prototype.areAllComponentsHidden=function(){if(this._allComponentsHiddenDirty){this._allComponentsHiddenDirty=!1;this._allComponentsHidden=!0;for(var a=0,b=this.geometryRecords;a<b.length;a++){var c=b[a],
d=c.instanceParameters.componentVisibilities,c=c.geometry.getData().componentOffsets;if(!e.isAllHidden(d,c)){this._allComponentsHidden=!1;break}}}return this._allComponentsHidden};d.prototype.areAllComponentsVisible=function(){for(var a=0,b=this.geometryRecords;a<b.length;a++){var c=b[a],d=c.instanceParameters.componentVisibilities,c=c.geometry.getData().componentOffsets;if(!e.isAllVisible(d,c))return!1}return!0};d.prototype.hasComponents=function(){for(var a=!1,b=0;b<this.geometries.length&&!(a=
this.geometries[b].getData(),a=e.hasComponents(a.componentOffsets));b++);return a};d.prototype.setComponentVisibility=function(a,b,c){var d=a.instanceParameters.componentVisibilities,f=a.geometry.getData().componentOffsets;b=e.updateVisibility(d,f,b,c);a.instanceParameters.componentVisibilities=b;this._notifyDirty("visibilityChanged",a);this._allComponentsHiddenDirty=!0};d.prototype.setHidden=function(a,b){a.instanceParameters.hidden=!!b;this._notifyDirty("visibilityChanged",a)};d.prototype.isHidden=
function(a){return!!a.instanceParameters.hidden};d.prototype.getComponentVisibility=function(a,b){return e.getVisibility(a.instanceParameters.componentVisibilities,b)};d.prototype.hideAllComponents=function(){for(var a=0,b=this.geometryRecords;a<b.length;a++){var c=b[a],d=e.hideAllComponents(c.instanceParameters.componentVisibilities);c.instanceParameters.componentVisibilities=d}this._notifyDirty("visibilityChanged");this._allComponentsHiddenDirty=!0};d.prototype.unhideAllComponents=function(){for(var a=
0,b=this.geometryRecords;a<b.length;a++){var c=b[a],d=e.unhideAllComponents(c.instanceParameters.componentVisibilities);c.instanceParameters.componentVisibilities=d}this._notifyDirty("visibilityChanged");this._allComponentsHiddenDirty=!0};d.prototype._setComponentHighlight=function(a,b,c,d){b=e.addHighlight(a.instanceParameters.componentHighlights,b,c,d);a.instanceParameters.componentHighlights=b};d.prototype.setComponentHighlight=function(a,c,d){var f=b.generateHighlightId();this._setComponentHighlight(a,
c,d,f);this._notifyDirty("componentHighlightChanged");return f};d.prototype.highlightAllComponents=function(a){for(var c=b.generateHighlightId(),d=0,f=this.geometryRecords;d<f.length;d++)this._setComponentHighlight(f[d],null,a,c);this._notifyDirty("componentHighlightChanged");return c};d.prototype.removeHighlights=function(a){for(var b=0,c=this.geometryRecords;b<c.length;b++){var d=c[b].instanceParameters,f=e.removeHighlight(d.componentHighlights,a);d.componentHighlights=f}this._notifyDirty("componentHighlightChanged")};
d.prototype.getComponentFromTriangleNr=function(a,b){k(0<=a&&a<this.geometryRecords.length,"Object3d.getComponentFromTriangleNr: index out of range");a=this.geometryRecords[a].geometry.getData().componentOffsets;return e.componentFind(a,3*b)};d.prototype.setGeometryTransformation=function(b,c){k(0<=b&&b<this.geometryRecords.length,"Object3d.setGeometryTransformation: index out of range");var d=this.geometryRecords[b];c=new a(d.geometry,d.materials,n.create(c),d.instanceParameters);this.geometryRecords[b]=
c;this._notifyDirty("objGeometryReplaced",[d,c]);this._invalidateBoundingVolume()};d.prototype.getObjectTransformation=function(){return n.create(this.objectTransformation)};d.prototype.setObjectTransformation=function(a){n.set(a,this.objectTransformation);this._invalidateBoundingVolume();this._notifyDirty("objTransformation")};d.prototype.getCombinedStaticTransformation=function(a,b){b=b||n.create();n.multiply(this.objectTransformation,a.getStaticTransformation(),b);return b};d.prototype.getCombinedShaderTransformation=
function(a,b){b=b||n.create();n.multiply(this.objectTransformation,a.getShaderTransformation(),b);return b};d.prototype.hasVolativeTransformation=function(){return this._hasVolatileTransformation};d.prototype.getCastShadow=function(){return this.castShadow};d.prototype.setCastShadow=function(a){this.castShadow=a};d.prototype.getMetadata=function(){return this.metadata};d.prototype.getName=function(){return this.name};d.prototype.getBBMin=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bbMin:
this._bvWorldSpace.bbMin};d.prototype.getBBMax=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bbMax:this._bvWorldSpace.bbMax};d.prototype.getCenter=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.center:this._bvWorldSpace.center};d.prototype.getBSRadius=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bsRadius:this._bvWorldSpace.bsRadius};d.prototype._validateBoundingVolume=function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init();
this._bvWorldSpace.init();for(var a=0;a<this.geometryRecords.length;++a){var b=this.geometries[a],c=this.geometryRecords[a],b=b.getBoundingInfo();this._calculateTransformedBoundingVolume(b,this._bvObjectSpace,c.getShaderTransformation());this._calculateTransformedBoundingVolume(b,this._bvWorldSpace,this.getCombinedShaderTransformation(c))}l.lerp(this._bvObjectSpace.bbMin,this._bvObjectSpace.bbMax,.5,this._bvObjectSpace.center);l.lerp(this._bvWorldSpace.bbMin,this._bvWorldSpace.bbMax,.5,this._bvWorldSpace.center);
for(var c=l.create(),d=l.create(),f=n.maxScale(this.objectTransformation),a=0;a<this.geometryRecords.length;++a){var b=this.geometries[a],g=this.geometryRecords[a].getShaderTransformation(),k=n.maxScale(g),b=b.getBoundingInfo();n.multiplyVec3(g,b.getCenter(),c);g=l.dist(c,this._bvObjectSpace.center);b=b.getBSRadius()*k;this._bvObjectSpace.bsRadius=Math.max(this._bvObjectSpace.bsRadius,g+b);n.multiplyVec3(this.objectTransformation,c,d);k=l.dist(d,this._bvWorldSpace.center);this._bvWorldSpace.bsRadius=
Math.max(this._bvWorldSpace.bsRadius,k+b*f)}this._bvDirty=!1}};d.prototype._calculateTransformedBoundingVolume=function(a,b,c){var d=a.getBBMin();a=a.getBBMax();var f=l.create(d),g=l.create(a);n.multiplyVec3(c,f);n.multiplyVec3(c,g);for(var k=0;3>k;++k)b.bbMin[k]=Math.min(b.bbMin[k],f[k],g[k]),b.bbMax[k]=Math.max(b.bbMax[k],f[k],g[k]);for(k=0;3>k;++k){l.set(d,f);l.set(a,g);f[k]=a[k];g[k]=d[k];n.multiplyVec3(c,f);n.multiplyVec3(c,g);for(var m=0;3>m;++m)b.bbMin[m]=Math.min(b.bbMin[m],f[m],g[m]),b.bbMax[m]=
Math.max(b.bbMax[m],f[m],g[m])}};d.prototype._invalidateBoundingVolume=function(){this._bvDirty=!0;this._parentLayer&&this._parentLayer.notifyObjectBBChanged(this,{center:this._bvWorldSpace.center,radius:this._bvWorldSpace.bsRadius})};d.prototype._notifyDirty=function(a,b,d,f){this._parentLayer&&(d=d||c.OBJECT,this._parentLayer.notifyDirty(a,b,d,f||this))};d._idGen=new g;return d}();var m=function(){function a(){this.bbMin=l.create();this.bbMax=l.create();this.center=l.create();this.bsRadius=0}a.prototype.init=
function(){l.set3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this.bbMin);l.set3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this.bbMax);l.set3(0,0,0,this.center);this.bsRadius=0};a.prototype.getCenter=function(){return this.center};a.prototype.getBSRadius=function(){return this.bsRadius};return a}();return q})},"esri/views/3d/webgl-engine/lib/GeometryRecord":function(){define(["require","exports","./IdGen"],function(q,h,e){return function(){function a(d,b,g,c,f,k){this.id=a._idGen.gen(d.id);
this.geometry=d;this.materials=b;this.transformation=g;this.instanceParameters=c;this.origin=f;this.customTransformation=k}a.prototype.getStaticTransformation=function(){return this.transformation};a.prototype.getShaderTransformation=function(){return this.customTransformation?this.customTransformation(this.transformation):this.transformation};a._idGen=new e;return a}()})},"esri/views/3d/webgl-engine/lib/IdGen":function(){define(["require","exports"],function(q,h){return function(){function e(){this._count=
0}e.prototype.gen=function(a){null==a&&(a="a");return a+"_"+this._count++};return e}()})},"esri/views/3d/webgl-engine/lib/HighlightUtils":function(){define(["require","exports","./IdGen"],function(q,h,e){Object.defineProperty(h,"__esModule",{value:!0});var a=new e;h.generateHighlightId=function(){return a.gen("highlight")}})},"esri/views/3d/webgl-engine/lib/ModelContentType":function(){define(["require","exports"],function(q,h){return function(){function e(){}e.LAYER="layers";e.OBJECT="objects";e.GEOMETRY=
"geometries";e.MATERIAL="materials";e.TEXTURE="textures";return e}()})},"esri/views/3d/webgl-engine/lib/PerformanceTimer":function(){define(["require","exports","./Performance"],function(q,h,e){return function(){function a(a){this._filterSampleIndex=0;this._lastTime=NaN;this._numMeasurements=this._totalTime=0;this._filterSamples=Array(a);this.reset();this._filterSize=a}a.prototype.reset=function(){for(var a=this._filterSampleIndex=0;a<this._filterSize;a++)this._filterSamples[a]=NaN};a.prototype.start=
function(){this._tsStart=e.now()};a.prototype.stop=function(){this._lastTime=e.now()-this._tsStart;this._totalTime+=this._lastTime;this._numMeasurements++;this._filterSize&&(this._filterSamples[this._filterSampleIndex]=this._lastTime,this._filterSampleIndex=(this._filterSampleIndex+1)%this._filterSize);return this._lastTime};a.prototype.getLast=function(){return this._lastTime};a.prototype.getLastFiltered=function(){for(var a=0,b=0;b<this._filterSamples.length;b++)a+=this._filterSamples[b];return a/
this._filterSamples.length};a.prototype.getAverage=function(){return this._totalTime/this._numMeasurements};a.prototype.getTotal=function(){return this._totalTime};a.prototype.getNumMeasurements=function(){return this._numMeasurements};return a}()})},"esri/views/3d/webgl-engine/lib/Performance":function(){define(["require","exports","../../../../core/now"],function(q,h,e){return{now:e}})},"esri/views/3d/camera/constraintUtils/tilt":function(){define("require exports ./common ../../lib/glMatrix ../../state/utils/viewUtils ../../support/earthUtils ../../support/mathUtils".split(" "),
function(q,h,e,a,d,b,g){function c(a,b,k,n){void 0===k&&(k=e.defaultApplyOptions);void 0===n&&(n=e.defaultApplyOptions);if(3===k.interactionType||!a.state.constraints.tilt)return 0;var m=d.viewAngle(a.renderCoordsHelper,b.center,b.eye);b=a.state.constraints.tilt(b.distance,p);if(0!==k.interactionType){var r=k.interactionStartCamera,t=k.interactionFactor,u=b.min,h=b.max,B=c(a,r,e.defaultApplyOptions,k),D=0===B?0:d.viewAngle(a.renderCoordsHelper,r.center,r.eye);b.min=u;b.max=h;2===k.interactionType?
(e.hasConstraintType(k.selection,2)&&f(a,r,b),e.adjustRangeForInteraction(B,D,!0,t,l,b)):e.adjustRangeForInteraction(B,D,!1,t,l,b)}2===n.interactionType&&e.hasConstraintType(n.selection,2)&&f(a,n.interactionStartCamera,b);a=g.clamp(m,b.min,b.max);m-=a;return 1E-6>=Math.abs(m)?0:m}function f(c,d,f){if(!c.state.isLocal){var k=c.state.constraints;if(k.altitude){c=a.vec3d.length2(d.center);var m=Math.sqrt(c);d=d.distance;var e=k.altitude.min+b.earthRadius,k=k.altitude.max+b.earthRadius,e=(e*e-d*d-c)/
(-2*m*d);f.min=Math.max(f.min,Math.min(Math.PI-g.acos((k*k-d*d-c)/(-2*m*d)),f.max));f.max=Math.min(f.max,Math.PI-g.acos(e))}}}Object.defineProperty(h,"__esModule",{value:!0});h.apply=function(b,d,f,g){void 0===f&&(f=e.defaultApplyOptions);void 0===g&&(g=d);d!==g&&g.copyFrom(d);b=c(b,d,f);if(0===b)return!1;a.mat4d.identity(n);a.mat4d.rotate(n,-b,d.viewRight);a.vec3d.subtract(d.center,d.eye,k);a.mat4d.multiplyVec3(n,k);a.vec3d.subtract(d.center,k,g.eye);a.mat4d.multiplyVec3(n,g.up);g.markViewDirty();
return!0};h.error=c;var k=a.vec3d.create(),n=a.mat4d.create(),l=g.deg2rad(5),p={min:0,max:0}})},"esri/views/3d/state/utils/viewUtils":function(){define(["require","exports","../../lib/glMatrix","../../support/mathUtils"],function(q,h,e,a){Object.defineProperty(h,"__esModule",{value:!0});h.viewAngle=function(g,c,f){g.worldUpAtPosition(c,d);e.vec3d.subtract(f,c,b);g=e.vec3d.length(b);return 0===g?0:a.acos(e.vec3d.dot(b,d)/g)};var d=e.vec3d.create(),b=e.vec3d.create()})},"esri/views/animation/easing":function(){define(["require",
"exports"],function(q,h){function e(a){return a}function a(a){var b=2*(a-Math.sqrt((a-1)*a)),c=b/2/a;return function(d){return d<c?a*d*d:b*d-b+1}}function d(a,d){return function(b){return b<d?d*a(b/d):1-a((1-b)/(1-d))*(1-d)}}Object.defineProperty(h,"__esModule",{value:!0});h.linear=e;h.inQuad=function(a){return a*a};h.outQuad=function(a){return 1-h.inQuad(1-a)};h.inOutQuad=function(a){return.5>a?h.inQuad(2*a)/2:(h.outQuad(2*(a-.5))+1)/2};h.inCubic=function(a){return a*a*a};h.outCubic=function(a){return 1-
h.inCubic(1-a)};h.inOutCubic=function(a){return.5>a?h.inCubic(2*a)/2:(h.outCubic(2*(a-.5))+1)/2};h.inQuart=function(a){return a*a*a*a};h.outQuart=function(a){return 1-h.inQuart(1-a)};h.inOutQuart=function(a){return.5>a?h.inQuart(2*a)/2:(h.outQuart(2*(a-.5))+1)/2};h.inQuint=function(a){return a*a*a*a*a};h.outQuint=function(a){return 1-h.inQuint(1-a)};h.inOutQuint=function(a){return.5>a?h.inQuint(2*a)/2:(h.outQuint(2*(a-.5))+1)/2};h.inSine=function(a){return-Math.cos(a*Math.PI/2)+1};h.outSine=function(a){return 1-
h.inSine(1-a)};h.inOutSine=function(a){return.5>a?h.inSine(2*a)/2:(h.outSine(2*(a-.5))+1)/2};h.inExpo=function(a){return Math.pow(2,10*(a-1))};h.outExpo=function(a){return 1-h.inExpo(1-a)};h.inOutExpo=function(a){return.5>a?h.inExpo(2*a)/2:(h.outExpo(2*(a-.5))+1)/2};h.inCirc=function(a){return-(Math.sqrt(1-a*a)-1)};h.outCirc=function(a){return 1-h.inCirc(1-a)};h.inOutCirc=function(a){return.5>a?h.inCirc(2*a)/2:(h.outCirc(2*(a-.5))+1)/2};h.inCoastQuad=d(a(1),1);h.outCoastQuad=d(a(1),0);h.inOutCoastQuad=
d(a(1),.5);h.inCoastCubic=d(a(2),1);h.outCoastCubic=d(a(2),0);h.inOutCoastCubic=d(a(2),.5);h.inCoastQuart=d(a(3),1);h.outCoastQuart=d(a(3),0);h.inOutCoastQuart=d(a(3),.5);h.inCoastQuint=d(a(4),1);h.outCoastQuint=d(a(4),0);h.inOutCoastQuint=d(a(4),.5);h.named={linear:e,"in-quad":h.inQuad,"out-quad":h.outQuad,"in-out-quad":h.inOutQuad,"in-cubic":h.inCubic,"out-cubic":h.outCubic,"in-out-cubic":h.inOutCubic,"in-quart":h.inQuart,"out-quart":h.outQuart,"in-out-quart":h.inOutQuart,"in-quint":h.inQuint,"out-quint":h.outQuint,
"in-out-quint":h.inOutQuint,"in-sine":h.inSine,"out-sine":h.outSine,"in-out-sine":h.inOutSine,"in-expo":h.inExpo,"out-expo":h.outExpo,"in-out-expo":h.inOutExpo,"in-circ":h.inCirc,"out-circ":h.outCirc,"in-out-circ":h.inOutCirc}})},"esri/views/3d/state/controllers/PointToPointAnimationController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../animation/pointToPoint/Animation ../../lib/glMatrix ./AnimationController ../../webgl-engine/lib/Camera".split(" "),function(q,
h,e,a,d,b,g){Object.defineProperty(h,"__esModule",{value:!0});q=function(b){function d(c,d,f){f=b.call(this,f)||this;f.viewState=c;f.pickingHelper=d;f.hasTarget=!1;f.animation=new a.default(f.viewState.mode);return f}e(d,b);d.prototype.begin=function(a,b){this.hasTarget=!0;b=this.animationSettings(b);c.copyFrom(this.viewState.camera);this.pickingHelper.pickRaySegment(c.eye,c.center,f)&&(c.center=f);this.animation.update(c,a,b);this.animation.finished&&this.finish()};d.prototype.finish=function(){this.animation.currentTime=
this.animation.time;b.prototype.finish.call(this)};Object.defineProperty(d.prototype,"steppingFinished",{get:function(){return this.hasTarget&&this.animation.finished},enumerable:!0,configurable:!0});d.prototype.stepController=function(a,c){b.prototype.stepController.call(this,a,c);this.hasTarget&&this.animation.step(a,c)};d.prototype.onControllerEnd=function(a){this.hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,a),this.animation.currentTime=this.animation.time);
b.prototype.onControllerEnd.call(this,a)};d.prototype.animationSettings=function(a){void 0===a&&(a={});return{apex:{maximumDistance:this.viewState.constraints.clampAltitude(Infinity)/6,ascensionFactor:void 0,descensionFactor:void 0},speedFactor:a.speedFactor,duration:a.duration,maxDuration:a.maxDuration,easing:a.easing}};return d}(b.AnimationController);h.PointToPointAnimationController=q;var c=new g,f=d.vec3d.create()})},"esri/views/3d/animation/pointToPoint/Animation":function(){define("require exports ../../../../core/tsSupport/extendsHelper ./Camera ../../lib/glMatrix ../../webgl-engine/lib/Camera ../../../animation/pointToPoint/Animation".split(" "),
function(q,h,e,a,d,b,g){Object.defineProperty(h,"__esModule",{value:!0});var c=d.vec3d,f=c.create();q=function(){function d(b){this.currentTime=0;this.animation=new g.Animation(function(){return new a.default(b)});this._current=new a.default(b)}Object.defineProperty(d.prototype,"finished",{get:function(){return this.currentTime>=this.animation.time},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"time",{get:function(){return this.animation.time},enumerable:!0,configurable:!0});
d.prototype.update=function(a,b,d){var g=this.animation.definition.source,k=this.animation.definition.target,e=c.subtract(b.center,a.center,f),l=c.length(e);1E-5<=l?(e[0]/=l,e[1]/=l,e[2]/=l):(e[0]=0,e[1]=1,e[0]=0);c.set(e,g.lookAtDirection);c.set(e,k.lookAtDirection);g.copyFromRenderCamera(a);k.copyFromRenderCamera(b);this._current.copyFrom(g);this.animation.update(g,k,d);this.currentTime=0;a.almostEquals(b,5E-4,!0)&&(this.currentTime=this.animation.time)};d.prototype.cameraAt=function(a,c){a=this.animation.cameraAt(a,
this._current);c||(c=new b);a.copyToRenderCamera(c);return c};d.prototype.step=function(a,b){this.finished||(this.currentTime+=a,this.currentTime>=this.time&&(this.currentTime=this.time));return this.cameraAt(this.currentTime/this.time,b)};return d}();h.Animation=q;h.default=q})},"esri/views/3d/animation/pointToPoint/Camera":function(){define(["require","exports","../../lib/glMatrix","../../support/mathUtils"],function(q,h,e,a){Object.defineProperty(h,"__esModule",{value:!0});var d=a.angle,b=a.lerp,
g=a.slerp,c=e.vec3d,f=e.mat3d,k=c.create(),n=c.create(),l=c.create(),p=c.create(),m=c.create(),r=c.create(),t=c.createFrom(0,0,1),u=c.createFrom(0,1,0),x=c.createFrom(1,0,0),v=f.create();q=function(){function a(a){void 0===a&&(a="global");this.viewingMode=a;this.center=c.create();this.distance=this.yaw=this.pitch=0;this.lookAtDirection=c.create(u)}a.prototype.pixelsPerPanAtZoom=function(a){return this.size/2/(this._zoomToPanScale*a)};a.prototype.zoomAtPixelsPerPan=function(a){return this.size/2/(this._zoomToPanScale*
a)};a.prototype.pixelsPerRotateAtZoom=function(a){return this.size/2/Math.max(Math.cos(Math.abs(this.pitch)),.5)};a.prototype.compareTo=function(a,b){b||(b={pan:0,rotate:0,sourceZoom:0,targetZoom:0});if("global"===this.viewingMode){var f=c.length(this.center),g=c.length(a.center),f=(f+g)/2;b.pan=d(this.center,a.center)*f}else b.pan=c.dist(this.center,a.center);f=Math.abs(a.yaw-this.yaw);f>=Math.PI&&(f=2*Math.PI-f);b.rotate=Math.max(f,Math.abs(a.pitch-this.pitch));b.sourceZoom=this.distance;b.targetZoom=
a.distance;return b};a.prototype.interpolate=function(a,d,f){"global"===this.viewingMode?g(a.center,d.center,f.pan,this.center):c.lerp(a.center,d.center,f.pan,this.center);this.distance=b(a.distance,d.distance,f.zoom);this.pitch=b(a.pitch,d.pitch,f.rotate);a=a.yaw;d=d.yaw;Math.abs(d-a)>=Math.PI&&(a+=2*(a<d?1:-1)*Math.PI);this.yaw=b(a,d,f.rotate)};a.prototype.copyFrom=function(a){c.set(a.center,this.center);this.pitch=a.pitch;this.yaw=a.yaw;this.distance=a.distance;c.set(a.lookAtDirection,this.lookAtDirection);
this.size=a.size;this.copyFromCommon(a);this.viewingMode=a.viewingMode};a.prototype.copyFromRenderCamera=function(a){var b=this._lookAtOrientation(a.center,v);c.set(a.center,this.center);f.multiplyVec3(b,c.subtract(a.center,a.eye,p));f.multiplyVec3(b,a.up,m);this.distance=c.length(p);p[0]/=this.distance;p[1]/=this.distance;p[2]/=this.distance;this.pitch=this._eyeUpToPitch(p,m);this.yaw=this._eyeUpToYaw(p,m);this.size=Math.sqrt(a.width*a.width+a.height*a.height);this.copyFromCommon(a)};a.prototype.copyFromCommon=
function(a){this.fov=a.fov;this._zoomToPanScale=Math.atan(.5*this.fov)};a.prototype.copyToRenderCamera=function(a){var b=this._lookAtOrientation(this.center,v);f.transpose(b);this._axisAngleVec3(x,this.pitch-Math.PI/2,u,p);this._axisAngleVec3(t,this.yaw,p);this._axisAngleVec3(x,this.pitch-Math.PI/2,t,m);this._axisAngleVec3(t,this.yaw,m);c.scale(p,this.distance);f.multiplyVec3(b,p);f.multiplyVec3(b,m);a.center=this.center;a.eye=c.subtract(this.center,p,p);a.up=m};a.prototype._axisAngleVec3=function(a,
b,d,f){void 0===f&&(f=d);var g=Math.cos(b);b=Math.sin(b);c.scale(d,g,k);c.scale(c.cross(a,d,n),b);c.scale(a,(1-g)*c.dot(a,d),l);return c.add(c.add(k,n,f),l,f)};a.prototype._lookAtOrientation=function(a,b){this._upAtLookAt(a,l);c.normalize(c.cross(this.lookAtDirection,l,k));0===k[0]&&0===k[1]&&0===k[2]&&c.set(x,k);c.normalize(c.cross(l,k,n));b||(b=f.create());b[0]=k[0];b[1]=n[0];b[2]=l[0];b[3]=k[1];b[4]=n[1];b[5]=l[1];b[6]=k[2];b[7]=n[2];b[8]=l[2];return b};a.prototype._upAtLookAt=function(a,b){return"local"===
this.viewingMode?c.set(t,b):c.normalize(a,b)};a.prototype._eyeUpToPitch=function(a,b){return Math.PI-d(t,a)};a.prototype._eyeUpToYaw=function(a,b){.5>Math.abs(b[2])?(c.set(b,r),0<a[2]&&c.scale(r,-1)):c.set(a,r);return d(x,c.normalize(c.cross(r,t,n)),t)};return a}();h.default=q})},"esri/views/3d/webgl-engine/lib/Camera":function(){define(["require","exports","../../support/geometryUtils","./gl-matrix","./Util"],function(q,h,e,a,d){function b(a,b){var c=b[0]-a[0],d=b[1]-a[1],f=b[2]-a[2];a=b[3]-a[3];
return c*c+d*d+f*f+a*a}function g(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]}function c(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]}q=function(){function p(b,c,d){this._viewUp=a.vec3d.create();this._viewForward=a.vec3d.create();this._viewRight=a.vec3d.create();this._viewport=a.vec4d.create();this._padding=a.vec4d.create();this._fov=55/180*Math.PI;this._near=0;this._far=1E3;this._viewDirty=!0;this._viewMatrix=a.mat4d.create();this._projectionDirty=!0;this._projectionMatrix=
a.mat4d.create();this._viewProjectionDirty=!0;this._viewProjectionMatrix=a.mat4d.create();this._viewInverseTransposeMatrixDirty=!0;this._viewInverseTransposeMatrix=a.mat4d.create();this._frustumPlanesDirty=!0;this._frustumPlanes=[e.plane.create(),e.plane.create(),e.plane.create(),e.plane.create(),e.plane.create(),e.plane.create()];this._fullViewport=null;this.relativeElevation=0;this._eye=a.vec3d.create(b);this._center=a.vec3d.create(c);this._up=void 0!==d?a.vec3d.create(d):a.vec3d.create([0,0,1]);
this._padding=a.vec4d.create()}Object.defineProperty(p.prototype,"eye",{get:function(){return this._eye},set:function(a){this._compareAndSetView(a,this._eye)},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"center",{get:function(){return this._center},set:function(a){this._compareAndSetView(a,this._center)},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"up",{get:function(){return this._up},set:function(a){this._compareAndSetView(a,this._up)},enumerable:!0,configurable:!0});
Object.defineProperty(p.prototype,"viewMatrix",{get:function(){this._ensureViewClean();return this._viewMatrix},set:function(b){a.mat4d.set(b,this._viewMatrix);this._viewDirty=!1;this._frustumPlanesDirty=this._viewProjectionDirty=this._viewInverseTransposeMatrixDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"viewForward",{get:function(){this._ensureViewClean();return this._viewForward},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"viewUp",{get:function(){this._ensureViewClean();
return this._viewUp},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"viewRight",{get:function(){this._ensureViewClean();return this._viewRight},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"near",{get:function(){return this._near},set:function(a){this._near!==a&&(this._near=a,this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"far",{get:function(){return this._far},
set:function(a){this._far!==a&&(this._far=a,this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"viewport",{get:function(){return this._viewport},set:function(a){this.x=a[0];this.y=a[1];this.width=a[2];this.height=a[3]},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"x",{get:function(){return this._viewport[0]},set:function(a){a+=this._padding[3];this._viewport[0]!==a&&(this._viewport[0]=
a,this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"y",{get:function(){return this._viewport[1]},set:function(a){a+=this._padding[2];this._viewport[1]!==a&&(this._viewport[1]=a,this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"width",{get:function(){return this._viewport[2]},set:function(a){this._viewport[2]!==
a&&(this._viewport[2]=a,this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"height",{get:function(){return this._viewport[3]},set:function(a){this._viewport[3]!==a&&(this._viewport[3]=a,this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"fullWidth",{get:function(){return this._viewport[2]+this._padding[1]+this._padding[3]},
set:function(a){this.width=a-(this._padding[1]+this._padding[3])},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"fullHeight",{get:function(){return this._viewport[3]+this._padding[0]+this._padding[2]},set:function(a){this.height=a-(this._padding[0]+this._padding[2])},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"fullViewport",{get:function(){this._fullViewport||(this._fullViewport=a.vec4d.create());this._fullViewport[0]=this._viewport[0]-this._padding[3];this._fullViewport[1]=
this._viewport[1]-this._padding[2];this._fullViewport[2]=this.fullWidth;this._fullViewport[3]=this.fullHeight;return this._fullViewport},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"aspect",{get:function(){return this.width/this.height},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"padding",{get:function(){return this._padding},set:function(b){if(this._padding[0]!==b[0]||this._padding[1]!==b[1]||this._padding[2]!==b[2]||this._padding[3]!==b[3])this._viewport[0]+=
b[3]-this._padding[3],this._viewport[1]+=b[2]-this._padding[2],this._viewport[2]-=b[1]+b[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=b[0]+b[2]-(this._padding[0]+this._padding[2]),a.vec4d.set(b,this._padding),this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"viewProjectionMatrix",{get:function(){this._viewProjectionDirty&&(a.mat4d.multiply(this.projectionMatrix,this.viewMatrix,this._viewProjectionMatrix),
this._viewProjectionDirty=!1);return this._viewProjectionMatrix},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"projectionMatrix",{get:function(){if(this._projectionDirty){var b=this.width,c=this.height,d=this.near*Math.tan(this.fovY/2),f=d*this.aspect;a.mat4d.frustum(-f*(1+2*this._padding[3]/b),f*(1+2*this._padding[1]/b),-d*(1+2*this._padding[2]/c),d*(1+2*this._padding[0]/c),this.near,this.far,this._projectionMatrix);this._projectionDirty=!1}return this._projectionMatrix},set:function(b){a.mat4d.set(b,
this._projectionMatrix);this._projectionDirty=!1;this._frustumPlanesDirty=this._viewProjectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"fov",{get:function(){return this._fov},set:function(a){this._fov=a;this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"fovX",{get:function(){return d.fovd2fovx(this._fov,this.width,this.height)},set:function(a){this._fov=d.fovx2fovd(a,this.width,
this.height);this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"fovY",{get:function(){return d.fovd2fovy(this._fov,this.width,this.height)},set:function(a){this._fov=d.fovy2fovd(a,this.width,this.height);this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"distance",{get:function(){return a.vec3d.dist(this._center,this._eye)},
enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"frustumPoints",{get:function(){return this.computeFrustumPoints()},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"frustumPlanes",{get:function(){this._frustumPlanesDirty&&(this._frustumPlanes=this._computeFrustumPlanes(this._frustumPlanes),this._frustumPlanesDirty=!1);return this._frustumPlanes},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"viewInverseTransposeMatrix",{get:function(){if(this._viewInverseTransposeMatrixDirty||
this._viewDirty)this._viewInverseTransposeMatrix||(this._viewInverseTransposeMatrix=a.mat4d.create()),a.mat4d.inverse(this.viewMatrix,this._viewInverseTransposeMatrix),a.mat4d.transpose(this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1;return this._viewInverseTransposeMatrix},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"perPixelRatio",{get:function(){return Math.tan(this.fovX/2)/this.width},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,
"aboveGround",{get:function(){return 0<=this.relativeElevation},enumerable:!0,configurable:!0});p.prototype.copyFrom=function(b){a.vec3d.set(b._eye,this._eye);a.vec3d.set(b._center,this._center);a.vec3d.set(b._up,this._up);a.vec4d.set(b._viewport,this._viewport);a.vec4d.set(b._padding,this._padding);this._near=b._near;this._far=b._far;this._fov=b._fov;this.relativeElevation=b.relativeElevation;b._viewDirty?this._viewDirty=!0:(a.mat4d.set(b._viewMatrix,this._viewMatrix),a.vec3d.set(b._viewRight,this._viewRight),
a.vec3d.set(b._viewUp,this._viewUp),a.vec3d.set(b._viewForward,this._viewForward),this._viewDirty=!1);b._projectionDirty?this._projectionDirty=!0:(a.mat4d.set(b._projectionMatrix,this._projectionMatrix),this._projectionDirty=!1);this._viewProjectionDirty=!0;b._frustumPlanesDirty?this._frustumPlanesDirty=!0:(b.copyFrustumPlanes(this._frustumPlanes),this._frustumPlanesDirty=!1);b._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(this._viewInverseTransposeMatrix?a.mat4d.set(b._viewInverseTransposeMatrix,
this._viewInverseTransposeMatrix):this._viewInverseTransposeMatrix=a.mat4d.create(b._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1);b._fullViewport?this._fullViewport?a.vec4d.set(b._fullViewport,this._fullViewport):this._fullViewport=a.vec4d.create(b._fullViewport):this._fullViewport=null;return this};p.prototype.copyViewFrom=function(a){this.eye=a.eye;this.center=a.center;this.up=a.up};p.prototype.copy=function(){var a=new p;a.copyFrom(this);return a};p.prototype.equivalent=
function(a){return g(this._eye,a._eye)&&g(this._center,a._center)&&g(this._up,a._up)&&c(this._viewport,a._viewport)&&c(this._padding,a._padding)&&this._near===a._near&&this._far===a._far&&this._fov===a._fov};p.prototype.almostEquals=function(c,d,f){void 0===f&&(f=!1);d=a.vec3d.dist(this._eye,this._center)*(d||5E-4);d*=d;f?(a.vec3d.direction(c._center,c._eye,n),a.vec3d.direction(this._center,this._eye,l),f=1E-10):(a.vec3d.set(c._center,n),a.vec3d.set(this._center,l),f=d);return a.vec3d.dist2(c._eye,
this._eye)<d&&a.vec3d.dist2(n,l)<f&&.001>Math.abs(c._fov-this._fov)&&.5>b(c._padding,this._padding)&&.5>b(c._viewport,this._viewport)};p.prototype.markViewDirty=function(){this._viewProjectionDirty=this._frustumPlanesDirty=this._viewDirty=!0};p.prototype.computePixelSizeAt=function(b){return this.computePixelSizeAtDist(a.vec3d.dist(b,this._eye))};p.prototype.computePixelSizeAtDist=function(a){return 2*a*Math.tan(this.fovX/2)/this.width};p.prototype.computeDistanceFromRadius=function(a,b){return a/
Math.tan(Math.min(this.fovX,this.fovY)/(2*(b||1)))};p.prototype.copyFrustumPlanes=function(b){if(!b){b=Array(6);for(var c=0;6>c;++c)b[c]=a.vec4d.create()}for(var d=this.frustumPlanes,c=0;6>c;c++)a.vec4d.set(d[c],b[c]);return b};p.prototype.computeFrustumPoints=function(b){if(!b){b=Array(8);for(var c=0;8>c;++c)b[c]=a.vec3d.create()}d.matrixToFrustumPoints(this.viewMatrix,this.projectionMatrix,b);return b};p.prototype.setGLViewport=function(a){var b=this.viewport,c=this.padding;a.setViewport(b[0]-c[3],
b[1]-c[2],b[2]+c[1]+c[3],b[3]+c[0]+c[2])};p.prototype.applyProjection=function(b,c,g){void 0===g&&(g=!1);b!==f&&a.vec3d.set(b,f);f[3]=1;g&&(c[2]=-f[2]);a.mat4d.multiplyVec4(this.projectionMatrix,f);a.vec3d.scale(f,1/Math.abs(f[3]));b=this.fullViewport;c[0]=d.lerp(0,b[0]+b[2],.5+.5*f[0]);c[1]=d.lerp(0,b[1]+b[3],.5+.5*f[1]);g||(c[2]=.5*(f[2]+1));return c};p.prototype.projectPoint=function(b,c){f[0]=b[0];f[1]=b[1];f[2]=b[2];f[3]=1;a.mat4d.multiplyVec4(this.viewProjectionMatrix,f);a.vec3d.scale(f,1/Math.abs(f[3]));
b=this.fullViewport;c[0]=d.lerp(0,b[0]+b[2],.5+.5*f[0]);c[1]=d.lerp(0,b[1]+b[3],.5+.5*f[1]);c[2]=.5*(f[2]+1);return c};p.prototype.unprojectPoint=function(b,c,d){void 0===d&&(d=!1);if(d)return console.error("Camera.unprojectPoint() not yet implemented for linear Z"),null;a.mat4d.multiply(this.projectionMatrix,this.viewMatrix,k);if(!a.mat4d.inverse(k))return null;d=this.fullViewport;f[0]=2*(b[0]-d[0])/d[2]-1;f[1]=2*(b[1]-d[1])/d[3]-1;f[2]=2*b[2]-1;f[3]=1;a.mat4d.multiplyVec4(k,f);if(0===f[3])return null;
c[0]=f[0]/f[3];c[1]=f[1]/f[3];c[2]=f[2]/f[3];return c};p.prototype.computeUp=function(a){"global"===a?this.computeUpGlobal():this.computeUpLocal()};p.prototype.computeUpGlobal=function(){a.vec3d.subtract(this.center,this.eye,n);var b=a.vec3d.length(this.center);1>b?(a.vec3d.set3(0,0,1,this.up),this.markViewDirty()):Math.abs(a.vec3d.dot(n,this.center))>.9999*a.vec3d.length(n)*b||(a.vec3d.cross(n,this.center,this.up),a.vec3d.cross(this.up,n,this.up),a.vec3d.normalize(this.up),this.markViewDirty())};
p.prototype.computeUpLocal=function(){a.vec3d.direction(this.center,this.eye,n);.9999>=Math.abs(n[2])&&(a.vec3d.scale(n,n[2]),a.vec3d.set3(-n[0],-n[1],1-n[2],this.up),a.vec3d.normalize(this.up),this.markViewDirty())};p.prototype._compareAndSetView=function(b,c){g(b,c)||(a.vec3d.set(b,c),this._viewProjectionDirty=this._frustumPlanesDirty=this._viewDirty=!0)};p.prototype._computeFrustumPlanes=function(a){if(!a){a=Array(6);for(var b=0;6>b;++b)a[b]=e.plane.create()}d.matrixToFrustumPlanes(this.viewMatrix,
this.projectionMatrix,a);return a};p.prototype._ensureViewClean=function(){this._viewDirty&&(a.mat4d.lookAt(this._eye,this._center,this._up,this._viewMatrix),a.vec3d.set3(-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10],this._viewForward),a.vec3d.set3(this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9],this._viewUp),a.vec3d.set3(this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8],this._viewRight),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)};return p}();
var f=a.vec4d.create(),k=a.mat4d.create(),n=a.vec3d.create(),l=a.vec3d.create();return q})},"esri/views/animation/pointToPoint/Animation":function(){define("require exports ../easing ./Definition ./Settings ./apex/Path".split(" "),function(q,h,e,a,d,b){Object.defineProperty(h,"__esModule",{value:!0});var g={zoom:0,pan:0,rotate:0};q=function(){function c(c){this.createCamera=c;this.time=0;this.definition=new a.Definition(c);this.path=new b.Path}c.prototype.update=function(a,b,c){this.definition.update(a,
b,c);this.path.update(this.definition,c);this.time=this._applyTimeSettings(this.path.time,c);this.settings=c};c.prototype.cameraAt=function(a,b){b||(b=this.createCamera());a=Math.min(Math.max(0,a),1);a=this.settings.easing?this.normalizedEasing(this.settings.easing,a,1E3*this.time):1<=this.time?this.normalizedEasing(e.inOutCoastQuad,a):this.normalizedEasing(e.outExpo,a);a=this.path.interpolateComponentsAt(a,g);b.interpolate(this.definition.source,this.definition.target,a);return b};c.prototype.normalizedEasing=
function(a,b,c){c=a(0);var d=a(1);return(a(b)-c)/(d-c)};c.prototype._applyTimeSettings=function(a,b){var c=null!=b.speedFactor?b.speedFactor:1;null!=b.duration?a=b.duration:null!=b.speedFactor&&(a/=c);return a=Math.min(Math.max(null!=b.minDuration?b.minDuration:d.defaultSettings.minDuration/c,a),null!=b.maxDuration?b.maxDuration:d.defaultSettings.maxDuration/c)};return c}();h.Animation=q;h.default=q})},"esri/views/animation/pointToPoint/Definition":function(){define(["require","exports","./Settings"],
function(q,h,e){Object.defineProperty(h,"__esModule",{value:!0});q=function(){function a(a){this.createCamera=a;this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0};this.settings={desiredScreenFlow:e.defaultSettings.desiredScreenFlow};this.source=a();this.target=a()}a.prototype.clone=function(){var d=new a(this.createCamera);d.copyFrom(this);return d};a.prototype.copyFrom=function(a){this.update(a.source,a.target,a.settings)};a.prototype.update=function(a,b,g){this.source!==a&&this.source.copyFrom(a);
this.target!==b&&this.target.copyFrom(b);this.settings.desiredScreenFlow=null!=g.desiredScreenFlow?g.desiredScreenFlow:e.defaultSettings.desiredScreenFlow;this.compared=this.source.compareTo(this.target,this.compared);this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size;this.halfWindowSize=this.target.size/2};a.prototype.halfWindowPanAtZoom=function(a){a=this.target.pixelsPerPanAtZoom(a);return this.halfWindowSize/a};Object.defineProperty(a.prototype,"hasZoom",{get:function(){return 1E-5<
Math.abs(this.compared.sourceZoom-this.compared.targetZoom)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hasPan",{get:function(){return 1E-9<this.compared.pan},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hasRotate",{get:function(){return 1E-9<this.compared.rotate},enumerable:!0,configurable:!0});return a}();h.Definition=q;h.default=q})},"esri/views/animation/pointToPoint/Settings":function(){define(["require","exports"],function(q,h){Object.defineProperty(h,
"__esModule",{value:!0});h.defaultSettings={desiredScreenFlow:2,minDuration:.5,maxDuration:8}})},"esri/views/animation/pointToPoint/apex/Path":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../easing ../Path ../Segment ./planning".split(" "),function(q,h,e,a,d,b,g){Object.defineProperty(h,"__esModule",{value:!0});q=function(c){function d(a,d){var f=c.call(this)||this;f._preallocSegments=[new b.default,new b.default,new b.default];f.update(a,d);return f}e(d,c);d.prototype.update=
function(a,b){if(a){this.definition?this.definition.copyFrom(a):this.definition=a.clone();var c=null;b&&b.apex&&(c=g.optimalDistance(a,b.apex));this.segments.length=0;this._descensionSegment=this._ascensionSegment=null;null==c?this._updateWithoutApex():this._updateWithApex(c,b.apex)}};d.prototype.segmentInterpolateComponentsAt=function(b,c,d){d=b.interpolateComponentsAt(c,d);b===this._ascensionSegment?d.zoom=a.outQuad(d.zoom):b===this._descensionSegment&&(d.zoom=a.inQuad(d.zoom));return d};d.prototype._updateWithApex=
function(a,b){var c=this._preallocSegments,d=c[0],f=c[1],c=c[2],g=null!=b.ascensionFactor?b.ascensionFactor:.5;b=Math.min(1-g,null!=b.ascensionFactor?b.descensionFactor:.5);var k=1-g-b;d.definition?d.definition.copyFrom(this.definition):d.definition=this.definition.clone();d.definition.compared.targetZoom=a;d.definition.compared.pan=this.definition.compared.pan*g;d.definition.compared.rotate=this.definition.compared.rotate*g;d.update();this._ascensionSegment=d;this.segments.push(d);0<k&&(f.definition?
f.definition.copyFrom(this.definition):f.definition=this.definition.clone(),f.definition.copyFrom(this.definition),f.definition.compared.sourceZoom=a,f.definition.compared.targetZoom=a,f.definition.compared.pan=this.definition.compared.pan*k,f.definition.compared.rotate=this.definition.compared.rotate*k,f.update(),this.segments.push(f));c.definition?c.definition.copyFrom(this.definition):c.definition=this.definition.clone();c.definition.compared.sourceZoom=a;c.definition.compared.pan=this.definition.compared.pan*
b;c.definition.compared.rotate=this.definition.compared.rotate*b;c.update();this._descensionSegment=c;this.segments.push(c)};d.prototype._updateWithoutApex=function(){var a=this._preallocSegments[0];a.update(this.definition);this.segments.push(a)};return d}(d.default);h.Path=q;h.default=q})},"esri/views/animation/pointToPoint/Path":function(){define(["require","exports"],function(q,h){Object.defineProperty(h,"__esModule",{value:!0});q=function(){function e(){this.segments=[]}Object.defineProperty(e.prototype,
"time",{get:function(){return this.segments.reduce(function(a,d){return a+d.time},0)},enumerable:!0,configurable:!0});e.prototype.interpolateComponentsAt=function(a,d){a=Math.min(Math.max(a,0),1);a*=this.time;for(var b=0,g=0,c=this.definition,f=0;f<this.segments.length;f++){var k=this.segments[f],e=k.definition;if(a<=k.time||f===this.segments.length-1)return d=this.segmentInterpolateComponentsAt(k,a/k.time,d),d.pan=c.hasPan?(b+e.compared.pan*d.pan)/c.compared.pan:1,d.rotate=c.hasRotate?(g+e.compared.rotate*
d.rotate)/c.compared.rotate:1,a=d.zoom*(e.compared.targetZoom-e.compared.sourceZoom)+e.compared.sourceZoom,b=this.segments[0].definition.compared.sourceZoom,g=this.segments[this.segments.length-1].definition.compared.targetZoom,d.zoom=c.hasZoom?(a-b)/(g-b):1,d;a-=k.time;b+=e.compared.pan;g+=e.compared.rotate}};e.prototype.segmentInterpolateComponentsAt=function(a,d,b){return a.interpolateComponentsAt(d,b)};return e}();h.Path=q;h.default=q})},"esri/views/animation/pointToPoint/Segment":function(){define(["require",
"exports"],function(q,h){Object.defineProperty(h,"__esModule",{value:!0});q=function(){function e(a){a&&this.update(a)}e.prototype.update=function(a){a&&(this.definition?this.definition.copyFrom(a):this.definition=a.clone());this._updatePrecomputedVariables();this._updatePixelFlow()};e.prototype._updatePrecomputedVariables=function(){var a=this.definition,d=a.compared,b=d.sourceZoom,g=d.targetZoom;this._sl=b>g?1:-1;this._panPixelsAtSource=d.pan*a.source.pixelsPerPanAtZoom(b);a=(a.source.pixelsPerRotateAtZoom(b)+
a.target.pixelsPerRotateAtZoom(g))/2;this._rotatePixels=d.rotate*a};e.prototype._updatePixelFlow=function(){var a=this.definition.compared.sourceZoom,d=this.definition.compared.targetZoom,b=this.definition.hasZoom,g=this.definition.hasPan,c=this.definition.hasRotate,f,k;f=g&&b?(d/a-1)/(-1/(this._sl*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource):0;k=b&&c?Math.log(a/d)/Math.LN2*this._sl*this.definition.halfWindowSize/this._rotatePixels:0;this._rotatePixelFlow=this._panPixelFlow=this._zoomPixelFlow=
0;a=this.definition.desiredPixelFlow;b&&g&&c?(d=f+k+f*k,this._zoomPixelFlow=f*k/d*a,this._panPixelFlow=k/d*a,this._rotatePixelFlow=f/d*a):b&&g?(d=1+f,this._zoomPixelFlow=f/d*a,this._panPixelFlow=1/d*a):b&&c?(d=1+k,this._zoomPixelFlow=k/d*a,this._rotatePixelFlow=1/d*a):g&&c?(f=this._panPixelsAtSource/this._rotatePixels,d=1+f,this._panPixelFlow=f/d*a,this._rotatePixelFlow=1/d*a):g?this._panPixelFlow=a:b?this._zoomPixelFlow=a:c&&(this._rotatePixelFlow=a);this.time=c?this.rotateTime:b?this.zoomTime:g?
this.panTime:0};Object.defineProperty(e.prototype,"zoomTime",{get:function(){return this.definition.hasZoom?Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2*this._sl*this.definition.halfWindowSize/this._zoomPixelFlow:0},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"panTime",{get:function(){if(this.definition.hasPan){if(this.definition.hasZoom){var a=-1/(this._sl*this.definition.halfWindowSize)*Math.LN2;return Math.log(this._zoomPixelFlow/
this._panPixelFlow*this._panPixelsAtSource*a+1)/(a*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"rotateTime",{get:function(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0},enumerable:!0,configurable:!0});e.prototype._interpolateComponentsZoom=function(a){if(this.definition.hasZoom){var d=this.definition.compared.sourceZoom,b=this.definition.compared.targetZoom;return(d*
Math.pow(d/b,-a)-d)/(b-d)}return a};e.prototype._interpolateComponentsPan=function(a){if(this.definition.hasPan&&this.definition.hasZoom){var d=-1/(this._sl*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*this._panPixelFlow*(Math.pow(2,d*a*this.time)-1)/(d*Math.LN2)}return a};e.prototype._interpolateComponentsRotate=function(a){return a};e.prototype.interpolateComponentsAt=function(a,d){a=Math.min(Math.max(a,0),1);var b=this._interpolateComponentsZoom(a),g=this._interpolateComponentsPan(a);
a=this._interpolateComponentsRotate(a);d?(d.zoom=b,d.pan=g,d.rotate=a):d={zoom:b,pan:g,rotate:a};return d};return e}();h.Segment=q;h.default=q})},"esri/views/animation/pointToPoint/apex/planning":function(){define(["require","exports","./functions"],function(q,h,e){function a(a,b){var d=Math.max(a.compared.sourceZoom,a.compared.targetZoom);a=a.source.zoomAtPixelsPerPan(a.desiredPixelFlow/a.compared.pan)/2;return a<d?null!=b.maximumDistance?d+(b.maximumDistance-d)/2:1.5*d:b.maximumDistance?Math.min(b.maximumDistance,
a):a}Object.defineProperty(h,"__esModule",{value:!0});h.optimalDistance=function(d,b){var g=a(d,b),c={ascensionFactor:null!=b.ascensionFactor?b.ascensionFactor:.5,descensionFactor:null!=b.descensionFactor?b.descensionFactor:.5},f=0===c.ascensionFactor,k=0===c.descensionFactor,n=f?e.tAscensionZoomOnly:e.tAscensionZoomPan,l=f?e.dtAscensionZoomOnly:e.dtAscensionZoomPan,p=f?e.ddtAscensionZoomOnly:e.ddtAscensionZoomPan,m=k?e.tDescensionZoomOnly:e.tDescensionZoomPan,r=k?e.dtDescensionZoomOnly:e.dtDescensionZoomPan,
t=k?e.ddtDescensionZoomOnly:e.ddtDescensionZoomPan,f=function(a){return n(d,c,a)+e.tPanion(d,c,a)+m(d,c,a)},k=function(a){return l(d,c,a)+e.dtPanion(d,c,a)+r(d,c,a)},u=function(a){return p(d,c,a)+e.ddtPanion(d,c,a)+t(d,c,a)},h=f(g),v=e.tBaseLine(d),A=b.maximumIterations||20,y=null!=b.maximumDistance?b.maximumDistance:Infinity;for(b=0;b<A;b++){var C=(k(g)+1E-6)/u(g);if(isNaN(C)||g>=y&&0>C){if(!isFinite(y))return null;g=y;h=f(g);break}g-=C;if(g<d.compared.sourceZoom||g<d.compared.targetZoom)return null;
C=f(g);if(.005>=Math.abs(C-h)/h)break;h=C}return h>.7*v?null:g<d.compared.sourceZoom||g<d.compared.targetZoom?null:g}})},"esri/views/animation/pointToPoint/apex/functions":function(){define(["require","exports"],function(q,h){Object.defineProperty(h,"__esModule",{value:!0});h.tAscensionZoomPan=function(e,a,d){var b=e.halfWindowPanAtZoom(d-e.compared.sourceZoom);return-e.halfWindowSize*(a.ascensionFactor*Math.LN2*e.compared.pan+b)*Math.log(e.compared.sourceZoom/d)/(e.desiredPixelFlow*Math.LN2*b)};
h.dtAscensionZoomPan=function(e,a,d){var b=1/d,g=Math.log(e.compared.sourceZoom*b),c=1/e.desiredPixelFlow,f=1/Math.LN2;d-=e.compared.sourceZoom;var k=1/d;a=(a.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(d))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*b*c*f*k*a-e.halfWindowSize*g*c*f*k+e.halfWindowSize*g*c*f*a/(d*d)};h.ddtAscensionZoomPan=function(e,a,d){var b=d-e.compared.sourceZoom,g=1/b,c=1/d,f=Math.log(e.compared.sourceZoom*c);a=(a.ascensionFactor*Math.LN2*e.compared.pan+
e.halfWindowPanAtZoom(b))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*g*(-2*g*c*a+2*g*f+2*c-2*f*a/(b*b)-a/(d*d))/(e.desiredPixelFlow*Math.LN2)};h.tAscensionZoomOnly=function(e,a,d){return-e.halfWindowSize*Math.log(e.compared.sourceZoom/d)/(e.desiredPixelFlow*Math.LN2)};h.dtAscensionZoomOnly=function(e,a,d){return e.halfWindowSize/(d*e.desiredPixelFlow*Math.LN2)};h.ddtAscensionZoomOnly=function(e,a,d){return-e.halfWindowSize/(d*d*e.desiredPixelFlow*Math.LN2)};h.tPanion=function(e,a,d){return-e.compared.pan*
e.halfWindowSize*(a.ascensionFactor+a.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(d))};h.dtPanion=function(e,a,d){return e.compared.pan*e.halfWindowSize*(a.ascensionFactor+a.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(d*d))};h.ddtPanion=function(e,a,d){return-2*e.compared.pan*e.halfWindowSize*(a.ascensionFactor+a.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(d*d*d))};h.tDescensionZoomPan=function(e,a,d){return e.halfWindowSize*(-e.halfWindowPanAtZoom(d)-
a.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))*Math.log(d/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*e.halfWindowPanAtZoom(-d+e.compared.targetZoom))};h.dtDescensionZoomPan=function(e,a,d){var b=Math.log(d/e.compared.targetZoom),g=1/e.desiredPixelFlow,c=1/Math.LN2,f=-d+e.compared.targetZoom,k=1/f;a=(-e.halfWindowPanAtZoom(d)-a.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return-e.halfWindowSize*
b*g*c*k+e.halfWindowSize*b*g*c*a/(f*f)+e.halfWindowSize*g*c*k*a/d};h.ddtDescensionZoomPan=function(e,a,d){var b=d-e.compared.targetZoom,g=1/b,c=1/d,f=Math.log(d/e.compared.targetZoom);a=(e.halfWindowPanAtZoom(d)+a.descensionFactor*Math.LN2*e.compared.pan-e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*g*(-2*g*c*a-2*g*f+2*c+2*f*a/(b*b)-a/(d*d))/(e.desiredPixelFlow*Math.LN2)};h.tDescensionZoomOnly=function(e,a,d){return e.halfWindowSize*Math.log(d/e.compared.targetZoom)/
(e.desiredPixelFlow*Math.LN2)};h.dtDescensionZoomOnly=function(e,a,d){return e.halfWindowSize/(d*e.desiredPixelFlow*Math.LN2)};h.ddtDescensionZoomOnly=function(e,a,d){return-e.halfWindowSize/(d*d*e.desiredPixelFlow*Math.LN2)};h.tBaseLine=function(e){var a=Math.LN2*e.compared.pan,d=e.halfWindowPanAtZoom(e.compared.sourceZoom-e.compared.targetZoom),b=e.halfWindowSize*Math.log(e.compared.sourceZoom/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*d);return e.compared.sourceZoom<=e.compared.targetZoom?
b*(a-d):b*(a+d)}})},"esri/views/3d/state/controllers/AnimationController":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../ViewAnimation","./CameraController"],function(q,h,e,a,d){Object.defineProperty(h,"__esModule",{value:!0});q=function(b){function g(c){void 0===c&&(c=new a);var d=b.call(this)||this;d.viewAnimation=c;return d}e(g,b);Object.defineProperty(g.prototype,"canStop",{get:function(){return!0},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,
"asyncResult",{get:function(){return this._asyncResult},set:function(a){this._asyncResult&&this._asyncResult.reject();this._asyncResult=a;if(this.state===d.State.Finished||this.state===d.State.Stopped)this._asyncResult=null,this.state===d.State.Finished?a.resolve():a.reject()},enumerable:!0,configurable:!0});g.prototype.onControllerStart=function(a){var c=this;b.prototype.onControllerStart.call(this,a);this.viewAnimation&&this.viewAnimation.always(function(){c.updateStateFromViewAnimation()})};g.prototype.updateStateFromViewAnimation=
function(){!this.viewAnimation||this.state!==d.State.Ready&&this.state!==d.State.Running||(this.viewAnimation.state===a.State.FINISHED?this.finish():this.viewAnimation.state===a.State.STOPPED&&(this.state=d.State.Stopped))};g.prototype.onControllerEnd=function(a){this.viewAnimation&&(this.viewAnimation.done||(this.state===d.State.Finished?this.viewAnimation.finish():this.state===d.State.Stopped&&this.viewAnimation.stop()));this._asyncResult&&(this.state===d.State.Finished?this._asyncResult.resolve():
this._asyncResult.reject());b.prototype.onControllerEnd.call(this,a)};g.prototype.finish=function(){this.finishController()};return g}(d.CameraController);h.AnimationController=q})},"esri/views/3d/state/controllers/CameraController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/accessorSupport/decorators".split(" "),function(q,h,e,a,d,b){Object.defineProperty(h,"__esModule",{value:!0});
var g;(function(a){a.Ready="ready";a.Rejected="rejected";a.Running="running";a.Stopped="stopped";a.Finished="finished"})(g=h.State||(h.State={}));q=function(c){function d(){var a=null!==c&&c.apply(this,arguments)||this;a.state=g.Ready;return a}e(d,c);Object.defineProperty(d.prototype,"active",{get:function(){return this.state===g.Running},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"isInteractive",{get:function(){return!1},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"canStop",{get:function(){return!1},enumerable:!0,configurable:!0});d.prototype.stopController=function(){return this.canStop?(this.state=g.Stopped,!0):!1};d.prototype.finishController=function(){this.state=g.Finished};d.prototype.onControllerStart=function(a){this.state=g.Running};d.prototype.onControllerEnd=function(a){};d.prototype.stepController=function(a,b){};Object.defineProperty(d.prototype,"steppingFinished",{get:function(){return!1},enumerable:!0,configurable:!0});a([b.property({readOnly:!0,
dependsOn:["state"]})],d.prototype,"active",null);a([b.property()],d.prototype,"state",void 0);return d=a([b.subclass()],d)}(b.declared(d));h.CameraController=q})},"esri/views/3d/state/utils/navigationUtils":function(){define(["require","exports","../../lib/glMatrix","./primitiveIntersectionUtils","../../support/mathUtils"],function(q,h,e,a,d){function b(b,c,d,k,l){void 0===l&&(l=!1);var m=D;a.createRay(c,d,m,l);return a.intersectSphere(b,m,k)?e.vec3d.dist2(b.center,m.origin)<b.radius*b.radius&&(c=
g(b,m.origin),m=-f(m.origin,k,y)-c,0<m)?(c=v,e.mat4d.identity(c),e.mat4d.rotate(c,-m,y),e.vec3d.subtract(k,b.center),e.mat4d.multiplyVec3(c,k,k),e.vec3d.add(k,b.center),!1):!0:(n(b,m,k),!1)}function g(a,b){var c=y;e.vec3d.subtract(b,a.center,c);b=Math.abs(e.vec3d.length(c)-a.radius);return Math.acos(a.radius/(b+a.radius))}function c(b,c,d,f){var g=D;a.createRay(c,d,g,!0);return a.intersectSphere(b,g,f)}function f(a,b,c){e.vec3d.cross(a,b,c);a=e.vec3d.dot(a,b)/(e.vec3d.length(a)*e.vec3d.length(b));
return-d.acos(a)}function k(a,b,c,d){var f=v;e.mat4d.identity(f);e.mat4d.rotate(f,d,c);e.vec3d.subtract(a.eye,b);e.mat4d.multiplyVec3(f,a.eye,a.eye);e.vec3d.add(a.eye,b);e.vec3d.subtract(a.center,b);e.mat4d.multiplyVec3(f,a.center,a.center);e.vec3d.add(a.center,b);e.mat4d.multiplyVec3(f,a.up,a.up);a.markViewDirty()}function n(a,b,c){var f=y,g=C,k=x;e.vec3d.subtract(b.origin,a.center,g);e.vec3d.cross(g,b.direction,f);e.vec3d.cross(f,g,c);e.vec3d.scale(c,1/e.vec3d.length(c)*a.radius);a=-d.asin(a.radius/
e.vec3d.length(b.origin));e.mat4d.identity(k);e.mat4d.rotate(k,a,f);e.mat4d.multiplyVec3(k,c)}function l(a,b){e.vec3d.set3(0,0,0,b);for(var c=0;c<a.length;c++)e.vec3d.add(b,a[c]);e.vec3d.scale(b,1/a.length)}Object.defineProperty(h,"__esModule",{value:!0});h.Earth={center:e.vec3d.create(),radius:6378137};h.normalizeCoordinate=function(a,b,c){c[0]=b[0]/a.fullWidth;c[1]=b[1]/a.fullHeight;return c};h.sphereOrSilhouettePointFromScreenPoint=b;h.computeHorizonSphereCapAngle=g;h.intersectSphereFromScreenPoint=
c;h.rotationAndAxisFromPoints=f;h.rotationFromPointsAroundAxis=function(a,b,c){var d=y,f=C,g=B;e.vec3d.set(a,f);e.vec3d.set(b,g);a=e.vec3d.dot(f,c);b=e.vec3d.dot(g,c);e.vec3d.scale(c,a,d);e.vec3d.subtract(f,d);e.vec3d.normalize(f);e.vec3d.scale(c,b,d);e.vec3d.subtract(g,d);e.vec3d.normalize(g);a=e.vec3d.dot(f,g);e.vec3d.cross(c,f,d);c=e.vec3d.dot(g,d);return Math.atan2(c,a)};h.setPlane=function(a,b,c){e.vec3d.set(b,c.normal);c.d=-e.vec3d.dot(b,a)};h.setPlaneD=function(a,b){b.d=-e.vec3d.dot(b.normal,
a)};h.normalizeRotationDelta=function(a){for(;a>Math.PI;)a-=2*Math.PI;for(;a<-Math.PI;)a+=2*Math.PI;return a};h.applyRotation=k;h.closestPointOnSphereSilhouette=n;h.intersectPlaneFromScreenPoint=function(b,c,d,f){var g=D;a.createRay(c,d,g);return a.intersectPlane(b,g,f)};h.applyZoomToPoint=function(a,b,c,d){var f=A;c=1-c;e.vec3d.subtract(b,a.eye,f);var g=e.vec3d.length(f),k=g*(1-c);0<=c&&k<d&&(k=d,c=-(k-g)/g);1E-6>Math.abs(g-k)||(e.vec3d.scale(f,c),e.vec3d.add(a.eye,f),e.vec3d.lerp(a.center,b,c))};
h.applyZoomOnSphere=function(a,b,d){e.vec2d.set2(b.padding[3]+b.width/2,b.padding[2]+b.height/2,p);c(a,b,p,b.center);e.vec3d.subtract(b.center,b.eye,A);a=e.vec3d.length(A);1E-6>Math.abs(a-a*d)||(e.vec3d.scale(A,d),e.vec3d.subtract(b.center,A,b.eye),b.markViewDirty())};var p=e.vec2d.create();h.navPointToScreenPoint=function(a,b,c){e.vec2d.set2(b.x,a.fullHeight-b.y,c)};h.centroidOnSphere=function(a,b,c){l(b,c);e.vec3d.normalize(c);e.vec3d.scale(c,a)};h.centroid=l;var m;(function(a){a[a.Vertical=0]=
"Vertical";a[a.Horizontal=1]="Horizontal"})(m=h.PanMode||(h.PanMode={}));h.VerticalPanTresholds={Elevation:3E4,Angle:8/180*Math.PI};h.pickPointAndInitSphere=function(a,d,f,g){var k=e.vec3d.create(),l={center:e.vec3d.create(),radius:0},m=!0;a.pickPointInScreen(f,k)?l.radius=e.vec3d.length(k):(l.radius=d.aboveGround?Math.max(e.vec3d.length(d.center),.9*h.Earth.radius):e.vec3d.length(d.eye)-d.relativeElevation,g?b(l,d,f,k):m=c(l,d,f,k));return{sphere:l,scenePickPoint:m?k:null}};h.decidePanMode=function(a,
b,c){var d=e.vec3d.length(a.eye);if(Math.abs(d-h.Earth.radius)>h.VerticalPanTresholds.Elevation)return m.Horizontal;if(a.aboveGround===b.radius>d)return m.Vertical;e.vec3d.normalize(e.vec3d.subtract(a.eye,c,r));return Math.abs(.5*Math.PI-Math.acos(e.vec3d.dot(c,r)/e.vec3d.length(c)))<h.VerticalPanTresholds.Angle?m.Vertical:m.Horizontal};var r=e.vec3d.create();h.applyPanPlanar=function(a,b,c){e.vec3d.subtract(c,b,t);e.vec3d.subtract(a.eye,t);e.vec3d.subtract(a.center,t);a.markViewDirty()};var t=e.vec3d.create();
h.applyPanSpherical=function(a,b,c,d){c=f(c,d,u);k(b,a.center,u,c)};var u=e.vec3d.create(),x=e.mat4d.create(),v=e.mat4d.create(),A=e.vec3d.create(),y=e.vec3d.create(),C=e.vec3d.create(),B=e.vec3d.create(),D={origin:e.vec3d.create(),direction:e.vec3d.create()}})},"esri/views/3d/state/utils/primitiveIntersectionUtils":function(){define(["require","exports","../../lib/glMatrix"],function(q,h,e){Object.defineProperty(h,"__esModule",{value:!0});h.createRay=function(b,d,c,f){void 0===f&&(f=!1);e.vec3d.set3(d[0],
d[1],0,a);f?e.vec3d.set(b.eye,c.origin):e.vec3d.unproject(a,b.viewMatrix,b.projectionMatrix,b.fullViewport,c.origin);a[2]=1;e.vec3d.unproject(a,b.viewMatrix,b.projectionMatrix,b.fullViewport,c.direction);e.vec3d.subtract(c.direction,c.origin,c.direction);e.vec3d.normalize(c.direction)};h.intersectSphere=function(a,g,c){var b=e.vec3d.subtract(g.origin,a.center,d),k=e.vec3d.dot(g.direction,g.direction),n=2*e.vec3d.dot(g.direction,b);a=e.vec3d.dot(b,b)-a.radius*a.radius;a=n*n-4*k*a;if(0>a)return!1;b=
Math.sqrt(a);a=(-n-b)/(2*k);k=(-n+b)/(2*k);if(0>a||k<a&&0<k)a=k;return 0<a?(e.vec3d.add(g.origin,e.vec3d.scale(g.direction,a,c),c),!0):!1};h.intersectPlane=function(a,d,c){var b=e.vec3d.dot(a.normal,d.direction);if(0===b)return!1;a=-(e.vec3d.dot(a.normal,d.origin)+a.d)/b;if(0>a)return!1;e.vec3d.add(d.origin,e.vec3d.scale(d.direction,a,c),c);return!0};var a=e.vec3d.create(),d=e.vec3d.create()})},"esri/views/3d/state/controllers/local/ZoomStepController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../lib/glMatrix ../PointToPointAnimationController ../../../webgl-engine/lib/Camera ../../../../animation/easing".split(" "),
function(q,h,e,a,d,b,g,c){Object.defineProperty(h,"__esModule",{value:!0});q=function(b){function f(a,c,f){c=b.call(this,a.state,c,"interaction"===f?null:void 0)||this;c.view=a;c.mode=f;c.zoomLocation=d.vec3d.create();c.tmpCamera=new g;c.tmpRayDir=d.vec3d.create();c.tmpCenter=d.vec3d.create();c.constraintOptions={selection:15,interactionType:1,interactionFactor:null,interactionStartCamera:new g,interactionDirection:null};return c}e(f,b);Object.defineProperty(f.prototype,"isInteractive",{get:function(){return"interaction"===
this.mode},enumerable:!0,configurable:!0});f.prototype.zoomStep=function(a,b){if(this.active){var c=this.view.state,f=this.constraintOptions.interactionStartCamera;this.animation.finished?f.copyFrom(c.camera):this.animation.cameraAt(1,f);this.tmpCamera.copyFrom(c.camera);0<a?(this.pickingHelper.pickPointInScreen(b,this.zoomLocation)||this.pickingHelper.pickFreePointInScreen(b,this.zoomLocation),this.pickingHelper.pickRaySegment(this.tmpCamera.eye,this.tmpCamera.center,this.tmpCenter)&&(this.tmpCamera.center=
this.tmpCenter)):this.pickingHelper.pickRaySegment(this.tmpCamera.eye,this.tmpCamera.center,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:d.vec3d.set(this.tmpCamera.center,this.zoomLocation);this.updateCamera(this.tmpCamera,Math.pow(.6,a),this.zoomLocation,b);this.begin(this.tmpCamera)}};f.prototype.animationSettings=function(){return{apex:null,duration:.6,easing:c.outExpo}};f.prototype.updateCamera=function(b,c,f,g){d.vec3d.subtract(f,b.eye,this.tmpRayDir);g=d.vec3d.length(this.tmpRayDir);
var k=g*c;1>=c&&4>k&&(k=4,c=k/g);1E-6>Math.abs(g-k)||(d.vec3d.scale(this.tmpRayDir,c),d.vec3d.subtract(f,this.tmpRayDir,b.eye),d.vec3d.lerp(b.center,f,1-c),a.applyAll(this.view,this.tmpCamera,this.constraintOptions))};return f}(b.PointToPointAnimationController);h.ZoomStepController=q})},"esri/views/3d/state/helpers/PickingHelper":function(){define(["require","exports","../../camera/intersectionUtils","../../lib/glMatrix","../../webgl-engine/lib/Selector"],function(q,h,e,a,d){Object.defineProperty(h,
"__esModule",{value:!0});q=function(){function b(b){this.view=b;this.tmpR0=a.vec3d.create();this.tmpR1=a.vec3d.create();this.tmpSelector=new d(this.view.viewingMode)}b.prototype.pickPointInScreen=function(a,b){return this.pickedIntersectionPoint(this.pickInScreen(a,!1),b)};b.prototype.pickFreePointFromSegment=function(b,c,d){a.vec3d.set(b,this.tmpR0);a.vec3d.set(c,this.tmpR1);a.vec3d.subtract(this.tmpR1,this.tmpR0);a.vec3d.normalize(this.tmpR1);var f=this.view.dataExtent;b=Math.max(f.xmax-f.xmin,
f.ymax-f.ymin,8*Math.max(f.xmax-f.xmin,f.ymax-f.ymin));c=this.view.state.camera;var g=Math.max(0,f.xmin-c.eye[0],c.eye[0]-f.xmax),f=Math.max(0,f.ymin-c.eye[1],c.eye[1]-f.ymax),g=Math.sqrt(g*g+f*f),f=this.view.renderCoordsHelper.getAltitude(c.eye);c=e.surfaceElevationBelowEye(this.view,c);c=b/Math.max(1,Math.pow(Math.max(0,Math.log(b/(Math.abs(f-c)+Number.MIN_VALUE))),2));c=Math.max(c,Math.min(g,b));a.vec3d.scale(this.tmpR1,c);a.vec3d.add(this.tmpR0,this.tmpR1,d)};b.prototype.pickFreePointInScreen=
function(a,b){this.view._pickRayWithBeginPoint(a,void 0,this.view.state.camera.viewMatrix,this.tmpR0,this.tmpR1);this.pickFreePointFromSegment(this.tmpR0,this.tmpR1,b)};b.prototype.pickRaySegment=function(a,b,d){return this.pickedIntersectionPoint(this.view._pickRay(a,b,null,null,null,null,this.tmpSelector),d)};b.prototype.pickInScreen=function(b,c){this.view._pickRayWithBeginPoint(b,void 0,this.view.state.camera.viewMatrix,this.tmpR0,this.tmpR1);c&&a.vec3d.set(this.view.state.camera.eye,this.tmpR0);
return this.view._pickRay(this.tmpR0,this.tmpR1,b,b,null,null,this.tmpSelector)};b.prototype.pickedIntersectionPoint=function(a,b){return a?a.getMinResult().getIntersectionPoint(b):!1};return b}();h.PickingHelper=q})},"esri/views/input/InputHandler":function(){define(["require","exports","../../core/Logger","./EventMatch"],function(q,h,e,a){Object.defineProperty(h,"__esModule",{value:!0});var d=e.getLogger("esri.views.input.InputHandler");q=function(){function c(a){this._manager=null;this._incoming=
{};this._outgoing={};this._outgoingEventTypes=this._incomingEventTypes=this._incomingEventMatches=null;this._hasSideEffects=a}Object.defineProperty(c.prototype,"incomingEventMatches",{get:function(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(var a in this._incoming)for(var b=0,c=this._incoming[a];b<c.length;b++)this._incomingEventMatches.push(c[b].match)}return this._incomingEventMatches},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"incomingEventTypes",
{get:function(){this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(function(a){return a.eventType}));return this._incomingEventTypes},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"outgoingEventTypes",{get:function(){this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing));return this._outgoingEventTypes},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"hasSideEffects",{get:function(){return this._hasSideEffects},
enumerable:!0,configurable:!0});c.prototype.onInstall=function(a){var b=this;this._manager?d.error("This InputHandler has already been registered with an InputManager"):(a.setEventCallback(function(a){return b._handleEvent(a)}),a.setUninstallCallback(function(){return b._onUninstall()}),this._manager=a)};c.prototype.onUninstall=function(){};c.prototype.registerIncoming=function(c,d,g){var f=this;"function"===typeof d?(g=d,d=[]):d=d||[];c="string"===typeof c?new a.EventMatch(c,d):c;var k=function(){f._incomingEventTypes=
null;f._incomingEventMatches=null};d=function(a){var b=f._incoming[a.match.eventType];b&&(a=b.indexOf(a),b.splice(a,1),k(),f._manager&&f._manager.updateDependencies())};g=new b(c,g,{onPause:d,onRemove:d,onResume:function(a){var b=f._incoming[a.match.eventType];b&&-1===b.indexOf(a)&&(b.push(a),k(),f._manager&&f._manager.updateDependencies())}});d=this._incoming[c.eventType];d||(d=[],this._incoming[c.eventType]=d);d.push(g);k();this._manager&&this._manager.updateDependencies();return g};c.prototype.registerOutgoing=
function(a){var b=this;if(this._outgoing[a])throw Error("There is already a callback registered for this outgoing InputEvent: "+a);var c=new g(a,{onEmit:function(a,c,d,f){b._manager.emit(a.eventType,c,d,f)},onRemove:function(a){delete b._outgoing[a.eventType];b._manager.updateDependencies()}});this._outgoing[a]=c;this._outgoingEventTypes=null;this._manager&&this._manager.updateDependencies();return c};c.prototype.startCapturingPointer=function(a){this._manager.setPointerCapture(a,!0)};c.prototype.stopCapturingPointer=
function(a){this._manager.setPointerCapture(a,!1)};c.prototype._onUninstall=function(){this._manager?(this.onUninstall(),this._manager=null):d.error("This InputHandler is not registered with an InputManager")};c.prototype._handleEvent=function(a){var b=this._incoming[a.type];if(b)for(var c=0;c<b.length;c++){var d=b[c];if(d.match.matches(a)&&(d.callback(a),a.shouldStopPropagation()))break}};return c}();h.InputHandler=q;var b=function(){function a(a,b,c){this.match=a;this._callback=b;this._handler=
c}a.prototype.pause=function(){this._handler.onPause(this)};a.prototype.resume=function(){this._handler.onResume(this)};a.prototype.remove=function(){this._handler.onRemove(this)};Object.defineProperty(a.prototype,"callback",{get:function(){return this._callback},enumerable:!0,configurable:!0});return a}(),g=function(){function a(a,b){this.eventType=a;this._removed=!1;this._handler=b}a.prototype.emit=function(a,b,c){if(!this._removed)this._handler.onEmit(this,a,b,c)};a.prototype.remove=function(){this._removed=
!0;this._handler.onRemove(this)};return a}()})},"esri/views/input/EventMatch":function(){define(["require","exports"],function(q,h){Object.defineProperty(h,"__esModule",{value:!0});q=function(){function e(a,d){void 0===d&&(d=[]);this.eventType=a;this.keyModifiers=d}e.prototype.matches=function(a){if(a.type!==this.eventType)return!1;if(0===this.keyModifiers.length)return!0;a=a.modifiers;for(var d=0,b=this.keyModifiers;d<b.length;d++)if(!a.has(b[d]))return!1;return!0};return e}();h.EventMatch=q})},
"esri/views/input/handlers/support":function(){define(["require","exports"],function(q,h){Object.defineProperty(h,"__esModule",{value:!0});h.eventMatchesPointerAction=function(e,a){switch(a){case "primary":return"touch"===e.pointerType||0===e.button;case "secondary":return"touch"!==e.pointerType&&2===e.button;case "tertiary":return"touch"!==e.pointerType&&1===e.button}};h.eventMatchesMousePointerAction=function(e,a){if("touch"===e.pointerType)return!1;switch(a){case "primary":return 0===e.button;
case "secondary":return 2===e.button;case "tertiary":return 1===e.button}}})},"esri/views/3d/input/handlers/DragRotate":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../state/controllers/RotateController ../../state/helpers/PickingHelper ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(q,h,e,a,d,b,g){Object.defineProperty(h,"__esModule",{value:!0});q=function(b){function c(a,c,f,g){var k=b.call(this,!0)||this;k.view=a;k.pointerAction=
c;k.pivotPoint=f;k.pickingHelper=new d.PickingHelper(a);k.registerIncoming("drag",g,function(a){return k.handleDrag(a)});return k}e(c,b);c.prototype.handleDrag=function(b){var c=b.data;if(!(1<c.pointers.size)&&g.eventMatchesMousePointerAction(b.data,this.pointerAction)){var d=[c.center.x,this.view.height-c.center.y];switch(c.action){case "start":this.cameraController=new a.RotateController(this.view,this.pickingHelper,this.pivotPoint);this.view.state.switchCameraController(this.cameraController);
this.cameraController.begin(d);break;case "update":this.cameraController.update(d);break;case "end":this.cameraController.end(),this.cameraController=null}b.stopPropagation()}};return c}(b.InputHandler);h.DragRotate=q})},"esri/views/3d/state/controllers/RotateController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../camera/constraintUtils ../../lib/glMatrix ../../state/Constraints ./InteractiveController ../../state/utils/navigationUtils ../../support/mathUtils".split(" "),
function(q,h,e,a,d,b,g,c,f){Object.defineProperty(h,"__esModule",{value:!0});q=function(g){function k(a,b,c){var f=g.call(this)||this;f.view=a;f.pickingHelper=b;f.pivot=c;f.lastPoint=d.vec2d.create();f.tmpWorldUp=d.vec3d.create();f.tmpViewDir=d.vec3d.create();f.tmpRotCurPoint=d.vec2d.create();f.tmpTransf=d.mat4d.create();f.tmpAxis=d.vec3d.create();f.pivotPos=d.vec3d.create();f.constraintOptions={selection:15,interactionType:2,interactionFactor:0,interactionStartCamera:null,interactionDirection:null};
f.rotScale="center"===c?3:1.5;return f}e(k,g);k.prototype.begin=function(a){if(this.active){switch(this.pivot){case "eye":d.vec3d.set(this.beginCamera.eye,this.pivotPos);this.constraintOptions.interactionType=3;this.constraintOptions.selection=0;break;case "center":this.pickingHelper.pickRaySegment(this.beginCamera.eye,this.beginCamera.center,this.pivotPos)||(this.view.state.isLocal?this.pickingHelper.pickFreePointFromSegment(this.beginCamera.eye,this.beginCamera.center,this.pivotPos):d.vec3d.set(this.beginCamera.center,
this.pivotPos)),this.beginCamera.center=this.pivotPos,this.constraintOptions.interactionType=2,this.constraintOptions.selection=11}this.constraintOptions.interactionStartCamera=this.beginCamera;c.normalizeCoordinate(this.beginCamera,a,this.lastPoint)}};k.prototype.update=function(b){if(this.active){var c;switch(this.pivot){case "eye":c=this.currentCamera.center;break;case "center":this.currentCamera.center=this.pivotPos,c=this.currentCamera.eye}this.applyRotation(this.currentCamera,b,c,this.pivotPos);
a.applyAll(this.view,this.currentCamera,this.constraintOptions)}};k.prototype.end=function(){this.active&&this.finishController()};k.prototype.applyRotation=function(a,g,k,e){this.view.renderCoordsHelper.worldUpAtPosition(e,this.tmpWorldUp);c.normalizeCoordinate(a,g,this.tmpRotCurPoint);g=(this.tmpRotCurPoint[1]-this.lastPoint[1])*this.rotScale;var l=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;d.vec3d.subtract(k,e,this.tmpViewDir);var m=d.vec3d.length(this.tmpViewDir),m=f.acos(d.vec3d.dot(this.tmpViewDir,
this.tmpWorldUp)/m);if("eye"===this.pivot){var n=.5*Math.PI-m,p=.495*Math.PI;g=n-Math.max(-p,Math.min(p,n+-.5*g))}g=f.clamp(g+m,b.TiltDefault.min,b.TiltDefault.max)-m;d.mat4d.identity(this.tmpTransf);d.vec3d.cross(a.up,this.tmpViewDir,this.tmpAxis);"center"===this.pivot&&(l=-l);d.mat4d.rotate(this.tmpTransf,l,this.tmpWorldUp);d.mat4d.rotate(this.tmpTransf,g,this.tmpAxis);d.mat4d.multiplyVec3(this.tmpTransf,this.tmpViewDir);d.vec3d.add(e,this.tmpViewDir,k);d.mat4d.multiplyVec3(this.tmpTransf,a.up);
d.vec2d.set(this.tmpRotCurPoint,this.lastPoint);a.markViewDirty()};return k}(g.InteractiveController);h.RotateController=q})},"esri/views/3d/state/controllers/InteractiveController":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./CameraController","../../webgl-engine/lib/Camera"],function(q,h,e,a,d){Object.defineProperty(h,"__esModule",{value:!0});q=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.beginCamera=new d;b.currentCamera=new d;
return b}e(b,a);Object.defineProperty(b.prototype,"isInteractive",{get:function(){return!0},enumerable:!0,configurable:!0});b.prototype.stepController=function(b,d){a.prototype.stepController.call(this,b,d);d.copyViewFrom(this.currentCamera);this.currentCamera.copyFrom(d)};b.prototype.onControllerStart=function(b){a.prototype.onControllerStart.call(this,b);this.beginCamera.copyFrom(b);this.currentCamera.copyFrom(b)};b.prototype.onControllerEnd=function(b){b.copyViewFrom(this.currentCamera);a.prototype.onControllerEnd.call(this,
b)};return b}(a.CameraController);h.InteractiveController=q})},"esri/views/3d/input/handlers/DragZoom":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../state/controllers/global/ZoomController ../../state/controllers/local/ZoomController ../../state/helpers/PickingHelper ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(q,h,e,a,d,b,g,c){Object.defineProperty(h,"__esModule",{value:!0});q=function(f){function g(a,c,d){var g=f.call(this,
!0)||this;g.view=a;g.pointerAction=c;g.pickingHelper=new b.PickingHelper(a);g.registerIncoming("drag",d,function(a){return g.handleDrag(a)});return g}e(g,f);g.prototype.handleDrag=function(b){var f=b.data;if(!(1<f.pointers.size)&&c.eventMatchesMousePointerAction(b.data,this.pointerAction)){var g=[f.center.x,this.view.height-f.center.y];switch(f.action){case "start":this.cameraController=this.view.state.isGlobal?new a.ZoomController(this.view,this.pickingHelper):new d.ZoomController(this.view,this.pickingHelper);
this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(g);break;case "update":this.cameraController.update(g);break;case "end":this.cameraController.end(),this.cameraController=null}b.stopPropagation()}};return g}(g.InputHandler);h.DragZoom=q})},"esri/views/3d/state/controllers/global/ZoomController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../lib/glMatrix ../InteractiveController ../../utils/navigationUtils".split(" "),
function(q,h,e,a,d,b,g){Object.defineProperty(h,"__esModule",{value:!0});q=function(b){function c(a,c){var f=b.call(this)||this;f.view=a;f.pickingHelper=c;f.pickPoint=d.vec3d.create();f.tmpP0=d.vec3d.create();f.panAxis=d.vec3d.create();f.tmpRayDir=d.vec3d.create();f.targetOnSphere=d.vec3d.create();f.dragBeginPoint=d.vec2d.create();f.normalizedAnchorPoint=d.vec2d.create();f.constraintOptions={selection:7,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:null};f.sphere=
{center:d.vec3d.create(),radius:0};f.hasPickPoint=!1;return f}e(c,b);c.prototype.begin=function(a){this.active&&(d.vec2d.set(a,this.dragBeginPoint),g.normalizeCoordinate(this.beginCamera,a,this.normalizedAnchorPoint),a=g.pickPointAndInitSphere(this.pickingHelper,this.beginCamera,a,!1),this.hasPickPoint=!!a.scenePickPoint,this.pickPoint=a.scenePickPoint,this.sphere=a.sphere,this.constraintOptions.interactionStartCamera=this.beginCamera)};c.prototype.update=function(b){if(this.active){this.currentCamera.eye=
this.beginCamera.eye;this.currentCamera.center=this.beginCamera.center;this.currentCamera.up=this.beginCamera.up;d.vec3d.subtract(this.currentCamera.center,this.currentCamera.eye,this.tmpRayDir);var c=d.vec3d.length(this.tmpRayDir);g.normalizeCoordinate(this.currentCamera,b,this.tmpP0);var f=12*(this.tmpP0[1]-this.normalizedAnchorPoint[1]),k=c*Math.pow(2,f),e=this.view.state.constraints.minimumPoiDistance;0>f&&k<e&&(k=e);1E-6>Math.abs(c-k)||(this.hasPickPoint&&k<c&&(f=1-(1-k/c)*(1-this.sphere.radius/
d.vec3d.length(this.currentCamera.center)),d.vec3d.scale(this.currentCamera.center,f)),d.vec3d.scale(this.tmpRayDir,-k/c),d.vec3d.add(this.currentCamera.center,this.tmpRayDir,this.currentCamera.eye),this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(this.dragBeginPoint,b),a.applyAll(this.view,this.currentCamera,this.constraintOptions),this.hasPickPoint&&(g.sphereOrSilhouettePointFromScreenPoint(this.sphere,this.currentCamera,this.dragBeginPoint,this.targetOnSphere,!0),b=g.rotationAndAxisFromPoints(this.pickPoint,
this.targetOnSphere,this.panAxis),g.applyRotation(this.currentCamera,this.sphere.center,this.panAxis,b)),a.applySurfaceCollision(this.view,this.currentCamera))}};c.prototype.end=function(){this.active&&this.finishController()};return c}(b.InteractiveController);h.ZoomController=q})},"esri/views/3d/state/controllers/local/ZoomController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../lib/glMatrix ../InteractiveController ../../utils/navigationUtils ../../../support/mathUtils".split(" "),
function(q,h,e,a,d,b,g,c){Object.defineProperty(h,"__esModule",{value:!0});q=function(b){function f(a,c){var f=b.call(this)||this;f.view=a;f.pickingHelper=c;f.tmpP=d.vec3d.create();f.tmpN=d.vec3d.create();f.tmpP0=d.vec3d.create();f.tmpPoi=d.vec3d.create();f.tmpRayDir=d.vec3d.create();f.dragBeginPoint=d.vec2d.create();f.normalizedAnchorPoint=d.vec2d.create();f.constraintOptions={selection:15,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:d.vec3d.create()};f.plane=
{normal:d.vec3d.create(),d:0};return f}e(f,b);f.prototype.begin=function(a){this.active&&(d.vec2d.set(a,this.dragBeginPoint),g.normalizeCoordinate(this.beginCamera,a,this.normalizedAnchorPoint),this.pickingHelper.pickPointInScreen(a,this.tmpP)||this.pickingHelper.pickFreePointInScreen(a,this.tmpP),d.vec3d.normalize(d.vec3d.subtract(this.beginCamera.eye,this.beginCamera.center,this.tmpN)),0>this.tmpN[1]&&d.vec3d.negate(this.tmpN),g.setPlane(this.tmpP,this.tmpN,this.plane),this.constraintOptions.interactionStartCamera=
this.beginCamera)};f.prototype.update=function(b){if(this.active){g.intersectPlaneFromScreenPoint(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||d.vec3d.set(this.currentCamera.center,this.tmpPoi);g.normalizeCoordinate(this.currentCamera,b,this.tmpP0);var f=4*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);d.vec2d.set(this.tmpP0,this.normalizedAnchorPoint);d.vec3d.subtract(this.tmpPoi,this.currentCamera.eye,this.tmpRayDir);var k=d.vec3d.length(this.tmpRayDir),e=k*(1-f);d.vec3d.set(this.tmpRayDir,
this.constraintOptions.interactionDirection);d.vec3d.scale(this.constraintOptions.interactionDirection,c.sign(f)/k);var n=this.view.state.constraints.minimumPoiDistance;0<=f&&e<n&&(e=n,f=-(e-k)/k);1E-6>Math.abs(k-e)||(d.vec3d.scale(this.tmpRayDir,f),d.vec3d.add(this.currentCamera.eye,this.tmpRayDir),d.vec3d.lerp(this.currentCamera.center,this.tmpPoi,f),this.currentCamera.center[2]=this.tmpPoi[2]>this.beginCamera.center[2]?Math.max(this.beginCamera.center[2],this.currentCamera.center[2]):Math.min(this.beginCamera.center[2],
this.currentCamera.center[2]),this.currentCamera.markViewDirty(),this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(this.dragBeginPoint,b),a.applyAll(this.view,this.currentCamera,this.constraintOptions))}};f.prototype.end=function(){this.active&&this.finishController()};return f}(b.InteractiveController);h.ZoomController=q})},"esri/views/3d/input/handlers/KeyPan":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../state/controllers/global/PanContinuousController",
"../../../input/InputHandler"],function(q,h,e,a,d){Object.defineProperty(h,"__esModule",{value:!0});q=function(b){function d(c,d,g){var f,k=b.call(this,!0)||this;k.view=c;k.keyToDirection=(f={},f[d.left]=a.Direction.LEFT,f[d.right]=a.Direction.RIGHT,f[d.forward]=a.Direction.FORWARD,f[d.backward]=a.Direction.BACKWARD,f[d.up]=a.Direction.UP,f[d.down]=a.Direction.DOWN,f);c.state.isGlobal&&(k.registerIncoming("key-down",g,function(a){return k.handleKeyDown(a)}),k.registerIncoming("key-up",g,function(a){return k.handleKeyUp(a)}));
return k}e(d,b);d.prototype.handleKeyDown=function(b){if(!b.data.repeat){var c=this.keyToDirection[b.data.key];null!=c&&(this.cameraController&&this.cameraController.active||(this.cameraController=new a.PanContinuousController(this.view),this.view.state.switchCameraController(this.cameraController)),this.cameraController.active&&this.handleKey(b,c,!0))}};d.prototype.handleKeyUp=function(a){var b=this.keyToDirection[a.data.key];null!=b&&this.cameraController&&this.cameraController.active&&this.handleKey(a,
b,!1)};d.prototype.handleKey=function(a,b,d){d?this.cameraController.addDirection(b):this.cameraController.removeDirection(b);a.stopPropagation()};return d}(d.InputHandler);h.KeyPan=q})},"esri/views/3d/state/controllers/global/PanContinuousController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../lib/glMatrix ../CameraController ../../../support/earthUtils ../../../support/mathUtils".split(" "),function(q,h,e,a,d,b,g,c){Object.defineProperty(h,
"__esModule",{value:!0});h.Direction={LEFT:1,RIGHT:2,FORWARD:4,BACKWARD:8,UP:16,DOWN:32};var f=d.vec3d,k=d.mat4d;q=function(b){function d(a){var c=b.call(this)||this;c.view=a;c.directionStatus=0;c.direction=f.create();c.tmpAxis=f.create();c.radiusChange=0;c.velocity=0;c.tmpP1=f.create();c.tmpTransf=k.create();return c}e(d,b);Object.defineProperty(d.prototype,"isInteractive",{get:function(){return!0},enumerable:!0,configurable:!0});d.prototype.addDirection=function(a){0===this.directionStatus&&f.set3(0,
0,0,this.direction);this.directionStatus&a||(this.directionStatus|=a,a&(h.Direction.LEFT|h.Direction.RIGHT|h.Direction.FORWARD|h.Direction.BACKWARD)?(this.computePanAxis(a,this.tmpAxis),f.add(this.direction,this.tmpAxis)):(a=this.directionStatus&(h.Direction.UP|h.Direction.DOWN),this.radiusChange=a===h.Direction.UP?1:a===h.Direction.DOWN?-1:0),this.velocity=this.computePanVelocity())};d.prototype.removeDirection=function(a){this.directionStatus&=~a;0===this.directionStatus&&this.active?this.finishController():
a&(h.Direction.LEFT|h.Direction.RIGHT|h.Direction.FORWARD|h.Direction.BACKWARD)?(this.computePanAxis(a,this.tmpAxis),f.subtract(this.direction,this.tmpAxis),.01>f.length(this.direction)&&f.set3(0,0,0,this.direction)):(a=this.directionStatus&(h.Direction.UP|h.Direction.DOWN),this.radiusChange=a===h.Direction.UP?1:a===h.Direction.DOWN?-1:0)};d.prototype.stepController=function(c,d){b.prototype.stepController.call(this,c,d);c*=this.velocity;var g=!1;if(0<Math.abs(this.radiusChange)){var g=1+c*this.radiusChange,
e=d.viewForward,l=f.normalize(d.center,this.tmpP1);(-.999<f.dot(e,l)||0>this.radiusChange)&&f.scale(d.center,g);f.scale(d.eye,g);this.velocity=this.computePanVelocity();g=!0}.01<f.length2(this.direction)&&(k.identity(this.tmpTransf),k.rotate(this.tmpTransf,c,this.direction),k.multiplyVec3(this.tmpTransf,d.eye),k.multiplyVec3(this.tmpTransf,d.center),k.multiplyVec3(this.tmpTransf,d.up),g=!0);g&&a.applyAll(this.view,d,{selection:14,interactionType:4,interactionStartCamera:this.view.state.camera,interactionFactor:null,
interactionDirection:null})};d.prototype.computePanAxis=function(a,b){var c=this.view.state.camera;f.subtract(c.center,c.eye,b);f.cross(b,c.up);if(a===h.Direction.LEFT||a===h.Direction.RIGHT)f.normalize(b),f.cross(b,c.center);a!==h.Direction.RIGHT&&a!==h.Direction.FORWARD||f.negate(b);f.normalize(b)};d.prototype.computePanVelocity=function(){var a=.5*Math.abs(f.length(this.view.state.camera.eye)-g.earthRadius),a=c.clamp(a,1,2*g.earthRadius);return c.acos(1-a*a/(2*g.earthRadius*g.earthRadius))};return d}(b.CameraController);
h.PanContinuousController=q})},"esri/views/3d/input/handlers/MouseWheelZoom":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../state/helpers/PickingHelper ../../../input/InputHandler".split(" "),function(q,h,e,a,d,b,g){Object.defineProperty(h,"__esModule",{value:!0});q=function(c){function f(a,d){var f=c.call(this,!0)||this;f.view=a;f.pickingHelper=new b.PickingHelper(a);
f.registerIncoming("mouse-wheel",d,function(a){return f.handleMouseWheel(a)});return f}e(f,c);f.prototype.handleMouseWheel=function(b){var c=b.data;this.cameraController&&this.cameraController.active||(this.cameraController=this.view.state.isGlobal?new a.ZoomStepController(this.view,this.pickingHelper,"interaction"):new d.ZoomStepController(this.view,this.pickingHelper,"interaction"),this.view.state.switchCameraController(this.cameraController));this.cameraController.zoomStep(-1/60*c.deltaY,[c.x,
this.view.height-c.y]);b.stopPropagation()};return f}(g.InputHandler);h.MouseWheelZoom=q})},"esri/views/3d/input/handlers/PinchAndPanNavigation":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../state/controllers/global/PinchAndPanController ../../state/controllers/local/PinchAndPanController ../../state/helpers/PickingHelper ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(q,h,e,a,d,b,g,c){Object.defineProperty(h,"__esModule",{value:!0});
q=function(f){function g(a,c,d){var g=f.call(this,!0)||this;g.view=a;g.pointerAction=c;g.lastEndTimestamp=0;g.lastTimestamp=0;g.pickingHelper=new b.PickingHelper(a);g.registerIncoming("drag",d,function(a){return g.handleDrag(a)});return g}e(g,f);g.prototype.handleDrag=function(a){if("mouse"!==a.data.pointerType||c.eventMatchesMousePointerAction(a.data,this.pointerAction)){var b=a.timestamp-this.lastEndTimestamp,b=this.momentum&&this.momentum.active&&40>b;switch(a.data.action){case "start":case "update":if(b)break;
this.controller&&this.controller.active?2<a.data.timestamp-this.lastTimestamp&&(this.controller.update(a.data),this.lastTimestamp=a.timestamp):this.startController(a);break;case "end":case "removed":this.endController(a,!0);break;case "added":this.endController(a,!1),this.startController(a)}a.stopPropagation()}};g.prototype.endController=function(a,b){this.controller&&this.controller.active&&(this.lastEndTimestamp=a.timestamp,a=this.controller.end(a.data),b&&a&&(this.momentum=a,this.view.state.switchCameraController(this.momentum)));
this.controller=null};g.prototype.startController=function(a){this.controller=this.createController();this.view.state.switchCameraController(this.controller);this.controller.begin(a.data);this.lastTimestamp=a.timestamp};g.prototype.createController=function(){return this.view.state.isGlobal?new a.PinchAndPanController(this.view,this.pickingHelper):new d.PinchAndPanController(this.view,this.pickingHelper)};return g}(g.InputHandler);h.PinchAndPanNavigation=q})},"esri/views/3d/state/controllers/global/PinchAndPanController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../input/util ../../../lib/glMatrix ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/PanSphericalMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../momentum/ZoomSphericalMomentumController ../../utils/navigationUtils ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/PanSphericalMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u,x,v){Object.defineProperty(h,"__esModule",{value:!0});q=function(g){function h(a,c){var f=g.call(this)||this;f.view=a;f.pickingHelper=c;f.smoothRotation=new d.ExponentialFalloff(.05);f.rotationAxis=b.vec3d.create();f.panningPlane={normal:b.vec3d.create(),d:0};f.smoothScaling=new d.ExponentialFalloff(.05);f.zoomCenterScreen=b.vec2d.create();f.zoomMomentumEstimator=new v.ZoomMomentumEstimator;f.rotationMomentumEstimator=new x.RotationMomentumEstimator;f.panSphericalMomentumEstimator=
new u.PanSphericalMomentumEstimator;f.panPlanarMomentumEstimator=new t.PanPlanarMomentumEstimator;f.adjustedSphere={center:b.vec3d.create(),radius:0};f.tmp2d=b.vec2d.create();f.tmp3d=b.vec3d.create();f.tmpMat=b.mat4d.create();f.beginScreenPoint=b.vec2d.create();f.beginScenePoint=b.vec3d.create();f.screenPickPoint=b.vec2d.create();f.panMode=m.PanMode.Horizontal;f.tmpInteractionDirection=b.vec3d.create();f.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new r,
interactionDirection:null};return f}e(h,g);h.prototype.begin=function(a){if(this.active){this.beginRadius=a.radius;this.pointerCount=a.pointers.size;this.beginAngle=a.angle;this.smoothRotation.reset();p.navPointToScreenPoint(this.currentCamera,a.center,this.screenPickPoint);b.vec2d.set(this.screenPickPoint,this.beginScreenPoint);var c=p.pickPointAndInitSphere(this.pickingHelper,this.beginCamera,this.screenPickPoint,!0);this.scenePickPoint=c.scenePickPoint;this.sphere=c.sphere;b.vec3d.set(this.scenePickPoint,
this.beginScenePoint);this.panMode=p.decidePanMode(this.beginCamera,this.sphere,this.scenePickPoint);this.panMode===m.PanMode.Vertical&&(this.beginCamera.aboveGround?this.preparePlanarPanModeOverground(a):this.preparePlanarPanMode(a));this.constraintOptions.interactionStartCamera.copyFrom(this.beginCamera)}};h.prototype.preparePlanarPanModeOverground=function(a){b.vec3d.set(this.beginCamera.viewForward,this.panningPlane.normal);b.vec3d.normalize(this.panningPlane.normal);b.vec3d.negate(this.panningPlane.normal);
p.setPlane(this.scenePickPoint,this.panningPlane.normal,this.panningPlane);var c=b.vec3d.create();b.vec3d.set3(this.screenPickPoint[0],this.currentCamera.fullHeight,0,c);var d=b.vec3d.create(),f=b.vec3d.length(this.beginCamera.eye);this.adjustedSphere.radius=f<this.sphere.radius?f-100:this.sphere.radius;p.sphereOrSilhouettePointFromScreenPoint(this.adjustedSphere,this.beginCamera,c,d);this.beginCamera.projectPoint(d,c);this.screenPickPoint[1]=Math.min(this.screenPickPoint[1],.9*c[1]);this.pickingHelper.pickPointInScreen(this.screenPickPoint,
this.scenePickPoint)&&p.setPlane(this.scenePickPoint,this.panningPlane.normal,this.panningPlane);p.navPointToScreenPoint(this.currentCamera,a.center,this.tmp2d);p.intersectPlaneFromScreenPoint(this.panningPlane,this.beginCamera,this.tmp2d,this.beginScenePoint)};h.prototype.preparePlanarPanMode=function(a){b.vec3d.set(this.beginCamera.viewForward,this.panningPlane.normal);b.vec3d.normalize(this.panningPlane.normal);b.vec3d.negate(this.panningPlane.normal);p.setPlane(this.scenePickPoint,this.panningPlane.normal,
this.panningPlane);var c=p.computeHorizonSphereCapAngle(this.sphere,this.currentCamera.eye),d=this.tmp3d,c=-p.rotationAndAxisFromPoints(this.currentCamera.eye,this.scenePickPoint,d)-(this.currentCamera.aboveGround?.25:.025)*c;if(0<c){var f=b.mat4d.identity(this.tmpMat);b.mat4d.rotate(f,-c,d);b.vec3d.subtract(this.scenePickPoint,this.sphere.center);b.mat4d.multiplyVec3(f,this.scenePickPoint,this.scenePickPoint);b.vec3d.add(this.scenePickPoint,this.sphere.center);p.setPlane(this.scenePickPoint,this.panningPlane.normal,
this.panningPlane);p.navPointToScreenPoint(this.currentCamera,a.center,this.tmp2d);p.intersectPlaneFromScreenPoint(this.panningPlane,this.beginCamera,this.tmp2d,this.beginScenePoint)}};h.prototype.update=function(a){if(this.active){this.currentCamera.copyFrom(this.beginCamera);var b=1<a.pointers.size;this.panMode===m.PanMode.Horizontal?(b&&this.zoomSpherical(a),this.panningSpherical(a),b&&this.rotateSpherical(a)):(b&&this.zoomPlanar(a),this.panningPlanar(a),b&&this.rotatePlanar(a));this.currentCamera.markViewDirty()}};
h.prototype.end=function(a){a.pointers.size===this.pointerCount&&this.update(a);this.finishController();if(a=this.zoomMomentumEstimator.evaluateMomentum())return this.panMode===m.PanMode.Horizontal?new l.ZoomSphericalMomentumController(this.view,a,this.zoomCenterScreen,this.beginScenePoint,this.sphere.radius):new n.ZoomPlanarMomentumController(this.view,a,this.beginScenePoint);if(a=this.rotationMomentumEstimator.evaluateMomentum())return new k.RotationMomentumController(this.view,a,this.sphere.center,
this.rotationAxis);if(this.panMode===m.PanMode.Horizontal){if(a=this.panSphericalMomentumEstimator.evaluateMomentum())return new f.PanSphericalMomentumController(this.view,a)}else if(a=this.panPlanarMomentumEstimator.evaluateMomentum())return new c.PanPlanarMomentumController(this.view,a);return null};h.prototype.zoomSpherical=function(b){var c=this.beginRadius/b.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(b.radius,40),120);this.smoothScaling.update(c);p.applyZoomOnSphere(this.sphere,
this.currentCamera,this.smoothScaling.value);p.navPointToScreenPoint(this.currentCamera,b.center,this.zoomCenterScreen);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*b.timestamp);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(b.radius-this.beginRadius);a.applyAll(this.view,this.currentCamera,this.constraintOptions)};h.prototype.panningSpherical=function(b){p.navPointToScreenPoint(this.currentCamera,b.center,this.tmp2d);
p.sphereOrSilhouettePointFromScreenPoint(this.sphere,this.currentCamera,this.tmp2d,this.tmp3d);p.applyPanSpherical(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d);this.panSphericalMomentumEstimator.add(this.tmp2d,this.tmp3d,.001*b.timestamp);this.constraintOptions.interactionType=4;this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(this.screenPickPoint,this.tmp2d);a.applyAll(this.view,this.currentCamera,this.constraintOptions)};h.prototype.rotateSpherical=
function(c){b.vec3d.normalize(this.scenePickPoint,this.rotationAxis);var d=this.smoothRotation.value,f=p.normalizeRotationDelta(c.angle-d),d=d+f;this.smoothRotation.gain=.00125*Math.min(Math.max(c.radius,40),120);this.smoothRotation.update(d);f=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(f,.001*c.timestamp);p.applyRotation(this.currentCamera,this.sphere.center,this.rotationAxis,f);this.constraintOptions.interactionType=2;this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(c.radius*
d);a.applyAll(this.view,this.currentCamera,this.constraintOptions)};h.prototype.panningPlanar=function(b){p.navPointToScreenPoint(this.currentCamera,b.center,this.tmp2d);p.intersectPlaneFromScreenPoint(this.panningPlane,this.currentCamera,this.tmp2d,this.tmp3d)&&(p.applyPanPlanar(this.currentCamera,this.beginScenePoint,this.tmp3d),this.panPlanarMomentumEstimator.add(this.tmp2d,this.tmp3d,.001*b.timestamp),this.constraintOptions.interactionType=4,this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(this.beginScreenPoint,
this.tmp2d),this.constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this.tmpInteractionDirection),a.applyAll(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null)};h.prototype.zoomPlanar=function(b){var c=this.beginRadius/b.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(b.radius,40),120);this.smoothScaling.update(c);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*b.timestamp);
p.applyZoomToPoint(this.currentCamera,this.beginScenePoint,this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(b.radius-this.beginRadius);a.applyAll(this.view,this.currentCamera,this.constraintOptions)};h.prototype.rotatePlanar=function(c){b.vec3d.set(this.beginScenePoint,this.rotationAxis);var d=this.smoothRotation.value,f=c.angle-d,f=p.normalizeRotationDelta(f);
this.smoothRotation.gain=.00125*Math.min(Math.max(c.radius,40),120);this.smoothRotation.update(d+f);d=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(d,.001*c.timestamp);p.applyRotation(this.currentCamera,this.sphere.center,this.rotationAxis,d);this.constraintOptions.interactionType=2;this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(c.radius*d);a.applyAll(this.view,this.currentCamera,this.constraintOptions)};return h}(g.InteractiveController);
h.PinchAndPanController=q})},"esri/views/3d/input/util":function(){define(["require","exports"],function(q,h){Object.defineProperty(h,"__esModule",{value:!0});q=function(){function e(a){this._gain=a}e.prototype.reset=function(a){this._value=a};Object.defineProperty(e.prototype,"gain",{set:function(a){this._gain=a},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"value",{get:function(){return void 0===this._value?0:this._value},enumerable:!0,configurable:!0});e.prototype.update=function(a){this._value=
void 0===this._value?a:this._gain*a+(1-this._gain)*this._value};return e}();h.ExponentialFalloff=q})},"esri/views/3d/state/controllers/momentum/PanPlanarMomentumController":function(){define(["require","exports","../../../../../core/tsSupport/extendsHelper","../../../lib/glMatrix","./MomentumController"],function(q,h,e,a,d){Object.defineProperty(h,"__esModule",{value:!0});q=function(b){function d(c,d){c=b.call(this,c,4)||this;c.momentum=d;c.tmpPan=a.vec3d.create();return c}e(d,b);d.prototype.momentumStep=
function(b,d){b=this.momentum.value(b);a.vec3d.scale(this.momentum.direction,b,this.tmpPan);a.vec3d.subtract(d.eye,this.tmpPan);a.vec3d.subtract(d.center,this.tmpPan);d.markViewDirty();this.constraintOptions.interactionDirection=this.tmpPan};return d}(d.MomentumController);h.PanPlanarMomentumController=q})},"esri/views/3d/state/controllers/momentum/MomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../AnimationController ../../../webgl-engine/lib/Camera".split(" "),
function(q,h,e,a,d,b){Object.defineProperty(h,"__esModule",{value:!0});q=function(d){function c(a,c){c=d.call(this)||this;c.view=a;c.beginCamera=new b;c.elapsedTimeSec=0;c.constraintOptions={selection:15,interactionType:4,interactionFactor:0,interactionStartCamera:new b,interactionDirection:null};return c}e(c,d);Object.defineProperty(c.prototype,"steppingFinished",{get:function(){return this.momentum.isFinished(this.elapsedTimeSec)},enumerable:!0,configurable:!0});c.prototype.onControllerStart=function(a){this.beginCamera.copyFrom(a);
this.constraintOptions.interactionStartCamera=this.beginCamera;d.prototype.onControllerStart.call(this,a)};c.prototype.stepController=function(b,c){c.copyViewFrom(this.beginCamera);this.elapsedTimeSec+=b;this.momentumStep(this.elapsedTimeSec,c);a.applyAll(this.view,c,this.constraintOptions)};return c}(d.AnimationController);h.MomentumController=q})},"esri/views/3d/state/controllers/momentum/PanSphericalMomentumController":function(){define(["require","exports","../../../../../core/tsSupport/extendsHelper",
"./MomentumController","../../utils/navigationUtils"],function(q,h,e,a,d){Object.defineProperty(h,"__esModule",{value:!0});var b=[0,0,0];q=function(a){function c(b,c){b=a.call(this,b,4)||this;b.momentum=c;return b}e(c,a);c.prototype.momentumStep=function(a,c){a=this.momentum.value(a);d.applyRotation(c,b,this.momentum.axis,a)};return c}(a.MomentumController);h.PanSphericalMomentumController=q})},"esri/views/3d/state/controllers/momentum/RotationMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../lib/glMatrix ./MomentumController ../../utils/navigationUtils".split(" "),
function(q,h,e,a,d,b){Object.defineProperty(h,"__esModule",{value:!0});q=function(d){function c(b,c,g,e){b=d.call(this,b,2)||this;b.momentum=c;b.axis=a.vec3d.create();b.center=a.vec3d.create();a.vec3d.set(e,b.axis);a.vec3d.set(g,b.center);return b}e(c,d);c.prototype.momentumStep=function(a,c){a=this.momentum.value(a);b.applyRotation(c,this.center,this.axis,a)};return c}(d.MomentumController);h.RotationMomentumController=q})},"esri/views/3d/state/controllers/momentum/ZoomPlanarMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../lib/glMatrix ./MomentumController ../../utils/navigationUtils".split(" "),
function(q,h,e,a,d,b){Object.defineProperty(h,"__esModule",{value:!0});q=function(d){function c(b,c,g){b=d.call(this,b,1)||this;b.momentum=c;b.zoomCenter=a.vec3d.create();a.vec3d.set(g,b.zoomCenter);b.constraintOptions.interactionDirection=a.vec3d.create();return b}e(c,d);c.prototype.momentumStep=function(c,d){a.vec3d.set(d.eye,this.constraintOptions.interactionDirection);c=this.momentum.valueDelta(0,c);b.applyZoomToPoint(d,this.zoomCenter,c,this.view.state.constraints.minimumPoiDistance);this.constraintOptions.interactionDirection=
a.vec3d.direction(this.constraintOptions.interactionDirection,d.eye)};return c}(d.MomentumController);h.ZoomPlanarMomentumController=q})},"esri/views/3d/state/controllers/momentum/ZoomSphericalMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../lib/glMatrix ./MomentumController ../../utils/navigationUtils".split(" "),function(q,h,e,a,d,b,g){Object.defineProperty(h,"__esModule",{value:!0});q=function(b){function c(a,
c,f,g,e){a=b.call(this,a,1)||this;a.momentum=c;a.screenCenter=d.vec2d.create();a.sceneCenter=d.vec3d.create();a.tmpSceneCenter=d.vec3d.create();a.tmpZoomAxis=d.vec3d.create();a.sphere={center:d.vec3d.create(),radius:0};d.vec2d.set(f,a.screenCenter);d.vec3d.set(g,a.sceneCenter);a.sphere.radius=e;return a}e(c,b);c.prototype.momentumStep=function(b,c){b=this.momentum.valueDelta(0,b);g.applyZoomOnSphere(this.sphere,c,b);this.constraintOptions.interactionType=1;a.applyAll(this.view,c,this.constraintOptions);
g.sphereOrSilhouettePointFromScreenPoint(this.sphere,c,this.screenCenter,this.tmpSceneCenter);b=g.rotationAndAxisFromPoints(this.sceneCenter,this.tmpSceneCenter,this.tmpZoomAxis);g.applyRotation(c,this.sphere.center,this.tmpZoomAxis,b);this.constraintOptions.interactionType=4};return c}(b.MomentumController);h.ZoomSphericalMomentumController=q})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../3d/lib/glMatrix ./FilteredFiniteDifference ./Momentum".split(" "),
function(q,h,e,a,d,b){Object.defineProperty(h,"__esModule",{value:!0});var g=function(a){function b(b,c,d,f,g){b=a.call(this,b,c,d)||this;b.sceneVelocity=f;b.direction=g;return b}e(b,a);b.prototype.value=function(b){return a.prototype.valueFromInitialVelocity.call(this,this.sceneVelocity,b)};return b}(b.Momentum);h.PanPlanarMomentum=g;q=function(){function b(b,c,g){void 0===b&&(b=300);void 0===c&&(c=12);void 0===g&&(g=.84);this.minimumInitialVelocity=b;this.stopVelocity=c;this.friction=g;this.time=
new d.FilteredFiniteDifference(.6);this.screen=[new d.FilteredFiniteDifference(.4),new d.FilteredFiniteDifference(.4)];this.scene=[new d.FilteredFiniteDifference(.6),new d.FilteredFiniteDifference(.6),new d.FilteredFiniteDifference(.6)];this.tmpDirection=a.vec3d.create()}b.prototype.add=function(a,b,c){this.time.hasLastValue&&.015>this.time.computeDelta(c)||(this.screen[0].update(a[0]),this.screen[1].update(a[1]),this.scene[0].update(b[0]),this.scene[1].update(b[1]),this.scene[2].update(b[2]),this.time.update(c))};
b.prototype.reset=function(){this.screen[0].reset();this.screen[1].reset();this.scene[0].reset();this.scene[1].reset();this.scene[2].reset();this.time.reset()};b.prototype.evaluateMomentum=function(){if(!this.screen[0].hasFilteredDelta)return null;var a=this.screen[0].filteredDelta,b=this.screen[1].filteredDelta,a=Math.sqrt(a*a+b*b)/this.time.filteredDelta;return Math.abs(a)<this.minimumInitialVelocity?null:this.createMomentum(a,this.stopVelocity,this.friction)};b.prototype.createMomentum=function(b,
c,d){a.vec3d.set3(this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta,this.tmpDirection);var f=a.vec3d.length(this.tmpDirection);0<f&&a.vec3d.scale(this.tmpDirection,1/f);return new g(b,c,d,f/this.time.filteredDelta,this.tmpDirection)};return b}();h.PanPlanarMomentumEstimator=q})},"esri/views/navigation/FilteredFiniteDifference":function(){define(["require","exports"],function(q,h){Object.defineProperty(h,"__esModule",{value:!0});q=function(){function e(a){this.gain=
a}e.prototype.update=function(a){if(this.hasLastValue){var d=this.computeDelta(a);this.updateDelta(d)}this.lastValue=a};e.prototype.reset=function(){this.filteredDelta=this.lastValue=void 0};Object.defineProperty(e.prototype,"hasLastValue",{get:function(){return void 0!==this.lastValue},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"hasFilteredDelta",{get:function(){return void 0!==this.filteredDelta},enumerable:!0,configurable:!0});e.prototype.computeDelta=function(a){return a-
this.lastValue};e.prototype.updateDelta=function(a){this.filteredDelta=this.hasFilteredDelta?(1-this.gain)*this.filteredDelta+this.gain*a:a};return e}();h.FilteredFiniteDifference=q})},"esri/views/navigation/Momentum":function(){define(["require","exports","../../core/tsSupport/extendsHelper"],function(q,h,e){Object.defineProperty(h,"__esModule",{value:!0});q=function(){function a(a,b,g){this._initialVelocity=a;this._stopVelocity=b;this._friction=g;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/
this._stopVelocity)/Math.log(1-this._friction))}Object.defineProperty(a.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0});a.prototype.isFinished=function(a){return a>this.duration};Object.defineProperty(a.prototype,"friction",{get:function(){return this._friction},enumerable:!0,configurable:!0});a.prototype.value=function(a){return this.valueFromInitialVelocity(this._initialVelocity,a)};a.prototype.valueDelta=function(a,b){var d=this.value(a);return this.value(a+
b)-d};a.prototype.valueFromInitialVelocity=function(a,b){b=Math.min(b,this.duration);var d=1-this.friction;return a*(Math.pow(d,b)-1)/Math.log(d)};return a}();h.Momentum=q})},"esri/views/navigation/PanSphericalMomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../3d/lib/glMatrix ../../views/3d/state/utils/navigationUtils ./FilteredFiniteDifference ./FilteredValue ./Momentum".split(" "),function(q,h,e,a,d,b,g,c){Object.defineProperty(h,"__esModule",{value:!0});
var f=function(a){function b(b,c,d,f,g){b=a.call(this,b,c,d)||this;b.angularVelocity=f;b.axis=g;return b}e(b,a);b.prototype.value=function(b){return a.prototype.valueFromInitialVelocity.call(this,this.angularVelocity,b)};return b}(c.Momentum);h.PanSphericalMomentum=f;q=function(){function c(c,d,f){void 0===c&&(c=300);void 0===d&&(d=12);void 0===f&&(f=.84);this.minimumInitialVelocity=c;this.stopVelocity=d;this.friction=f;this.tmpAxis=a.vec3d.create();this.time=new b.FilteredFiniteDifference(.3);this.screen=
[new b.FilteredFiniteDifference(.4),new b.FilteredFiniteDifference(.4)];this.angle=new g.FilteredValue(.6);this.axis=a.vec3d.create();this.lastScene=a.vec3d.create()}c.prototype.add=function(b,c,f){if(this.time.hasLastValue){if(.01>this.time.computeDelta(f))return;var g=d.rotationAndAxisFromPoints(this.lastScene,c,this.tmpAxis);1E-5>a.vec3d.length2(this.tmpAxis)?g=0:a.vec3d.normalize(this.tmpAxis,this.axis);this.angle.update(g);a.vec3d.set(c,this.lastScene)}this.screen[0].update(b[0]);this.screen[1].update(b[1]);
this.time.update(f)};c.prototype.reset=function(){this.screen[0].reset();this.screen[1].reset();this.angle.reset();this.time.reset()};c.prototype.evaluateMomentum=function(){if(!this.screen[0].hasFilteredDelta)return null;var a=this.screen[0].filteredDelta,b=this.screen[1].filteredDelta,a=Math.sqrt(a*a+b*b)/this.time.filteredDelta;return Math.abs(a)<this.minimumInitialVelocity?null:this.createMomentum(a,this.stopVelocity,this.friction)};c.prototype.createMomentum=function(a,b,c){return new f(a,b,
c,this.angle.filteredValue/this.time.filteredDelta,this.axis)};return c}();h.PanSphericalMomentumEstimator=q})},"esri/views/navigation/FilteredValue":function(){define(["require","exports"],function(q,h){Object.defineProperty(h,"__esModule",{value:!0});q=function(){function e(a){this.gain=a}e.prototype.update=function(a){this.filteredValue=this.hasFilteredValue?(1-this.gain)*this.filteredValue+this.gain*a:a};e.prototype.reset=function(){this.filteredValue=void 0};Object.defineProperty(e.prototype,
"hasFilteredValue",{get:function(){return void 0!==this.filteredValue},enumerable:!0,configurable:!0});return e}();h.FilteredValue=q})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["require","exports","../../core/tsSupport/extendsHelper","./MomentumEstimator"],function(q,h,e,a){Object.defineProperty(h,"__esModule",{value:!0});q=function(a){function b(b,c,d,k){void 0===b&&(b=3);void 0===c&&(c=.01);void 0===d&&(d=.95);void 0===k&&(k=12);return a.call(this,b,c,d,k)||this}e(b,
a);b.prototype.add=function(b,c){if(this.value.hasLastValue){var d=this.value.lastValue;for(b-=d;b>Math.PI;)b-=2*Math.PI;for(;b<-Math.PI;)b+=2*Math.PI;b=d+b}a.prototype.add.call(this,b,c)};return b}(a.MomentumEstimator);h.RotationMomentumEstimator=q})},"esri/views/navigation/MomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../3d/support/mathUtils ./FilteredFiniteDifference ./Momentum".split(" "),function(q,h,e,a,d,b){Object.defineProperty(h,"__esModule",{value:!0});
q=function(){function g(a,b,g,e){void 0===a&&(a=2.5);void 0===b&&(b=.01);void 0===g&&(g=.95);void 0===e&&(e=12);this.minimumInitialVelocity=a;this.stopVelocity=b;this.friction=g;this.maxVelocity=e;this.value=new d.FilteredFiniteDifference(.8);this.time=new d.FilteredFiniteDifference(.3)}g.prototype.add=function(a,b){if(this.time.hasLastValue){if(.01>this.time.computeDelta(b))return;if(this.value.hasFilteredDelta){var c=this.value.computeDelta(a);0>this.value.filteredDelta*c&&this.value.reset()}}this.time.update(b);
this.value.update(a)};g.prototype.reset=function(){this.value.reset();this.time.reset()};g.prototype.evaluateMomentum=function(){if(!this.value.hasFilteredDelta)return null;var b=this.value.filteredDelta/this.time.filteredDelta,b=a.clamp(b,-this.maxVelocity,this.maxVelocity);return Math.abs(b)<this.minimumInitialVelocity?null:this.createMomentum(b,this.stopVelocity,this.friction)};g.prototype.createMomentum=function(a,d,g){return new b.Momentum(a,d,g)};return g}();h.MomentumEstimator=q})},"esri/views/navigation/ZoomMomentumEstimator":function(){define(["require",
"exports","../../core/tsSupport/extendsHelper","./Momentum","./MomentumEstimator"],function(q,h,e,a,d){Object.defineProperty(h,"__esModule",{value:!0});var b=function(a){function b(b,c,d){return a.call(this,b,c,d)||this}e(b,a);b.prototype.value=function(b){b=a.prototype.value.call(this,b);return Math.exp(b)};b.prototype.valueDelta=function(b,c){var d=a.prototype.value.call(this,b);b=a.prototype.value.call(this,b+c);return Math.exp(b-d)};return b}(a.Momentum);h.ZoomMomentum=b;q=function(a){function c(b,
c,d,g){void 0===b&&(b=2.5);void 0===c&&(c=.01);void 0===d&&(d=.95);void 0===g&&(g=12);return a.call(this,b,c,d,g)||this}e(c,a);c.prototype.add=function(b,c){a.prototype.add.call(this,Math.log(b),c)};c.prototype.createMomentum=function(a,c,d){return new b(a,c,d)};return c}(d.MomentumEstimator);h.ZoomMomentumEstimator=q})},"esri/views/3d/state/controllers/local/PinchAndPanController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../input/util ../../../lib/glMatrix ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r){Object.defineProperty(h,"__esModule",{value:!0});var t;(function(a){a[a.Vertical=0]="Vertical";a[a.Horizontal=1]="Horizontal"})(t=h.PanMode||(h.PanMode={}));var u=b.vec3d.createFrom(0,0,1),x=16/180*Math.PI;q=function(g){function h(a,c){var f=g.call(this)||this;f.view=a;f.pickingHelper=c;f.rotationValueSmooth=new d.ExponentialFalloff(.05);f.scalingValueSmooth=new d.ExponentialFalloff(.05);f.planeHorizontal={normal:b.vec3d.create(),d:0};f.planeVertical={normal:b.vec3d.create(),
d:0};f.rotationMomentumEstimator=new m.RotationMomentumEstimator;f.panMomentumEstimator=new p.PanPlanarMomentumEstimator(300,12,.9);f.zoomMomentumEstimator=new r.ZoomMomentumEstimator;f.beginCenter=b.vec3d.create();f.tmpPoints=[];f.beginCenterScreen=b.vec2d.create();f.tmpCentroid3d=b.vec3d.create();f.tmpCentroid2d=b.vec2d.create();f.tmp2d=b.vec2d.create();f.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new l,interactionDirection:null};return f}e(h,g);
h.prototype.begin=function(a){if(this.active){this.beginRadius=a.radius;this.pointerCount=a.pointers.size;this.beginAngle=a.angle;this.rotationValueSmooth.reset();this.scalingValueSmooth.reset();n.navPointToScreenPoint(this.beginCamera,a.center,this.beginCenterScreen);this.planeHorizontal.d=0;b.vec3d.set(u,this.planeHorizontal.normal);var c=b.vec3d.create();this.pickingHelper.pickPointInScreen(this.beginCenterScreen,c)||this.pickingHelper.pickFreePointInScreen(this.beginCenterScreen,c);var d=b.vec3d.create();
b.vec3d.negate(this.beginCamera.viewForward,d);var f=b.vec3d.create();b.vec3d.set(u,f);var g=b.vec3d.dot(d,f);this.panMode=Math.asin(0>g?-g:g)>=x?t.Horizontal:t.Vertical;n.setPlaneD(c,this.planeHorizontal);0>b.vec3d.dot(this.planeHorizontal.normal,this.beginCamera.eye)+this.planeHorizontal.d&&(b.vec3d.negate(this.planeHorizontal.normal),this.planeHorizontal.d*=-1);this.panMode===t.Vertical?(b.vec3d.scale(f,g),b.vec3d.subtract(d,f,this.planeVertical.normal),b.vec3d.normalize(this.planeVertical.normal),
n.setPlaneD(c,this.planeVertical),this.computePlanePoints(a.pointers,this.planeVertical,this.beginCamera,this.tmpPoints)):this.computePlanePoints(a.pointers,this.planeHorizontal,this.beginCamera,this.tmpPoints);n.centroid(this.tmpPoints,this.beginCenter);this.constraintOptions.interactionStartCamera.copyFrom(this.beginCamera)}};h.prototype.update=function(b){if(this.active){this.currentCamera.copyFrom(this.beginCamera);var c=1<b.pointers.size,d=this.panMode===t.Horizontal?this.planeHorizontal:this.planeVertical,
f=this.beginCenter;if(c){var g=this.beginRadius/b.radius,k=.001875*Math.min(Math.max(b.radius,40),120);this.scalingValueSmooth.gain=k;this.scalingValueSmooth.update(g);n.applyZoomToPoint(this.currentCamera,f,this.scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance);this.zoomMomentumEstimator.add(this.scalingValueSmooth.value,.001*b.timestamp);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(Math.abs(b.radius-this.beginRadius));
a.applyAll(this.view,this.currentCamera,this.constraintOptions)}this.computePlanePoints(b.pointers,d,this.currentCamera,this.tmpPoints);n.centroid(this.tmpPoints,this.tmpCentroid3d);n.navPointToScreenPoint(this.currentCamera,b.center,this.tmpCentroid2d);n.applyPanPlanar(this.currentCamera,f,this.tmpCentroid3d);this.panMomentumEstimator.add(this.tmpCentroid2d,this.tmpCentroid3d,.001*b.timestamp);this.constraintOptions.interactionType=4;this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(this.beginCenterScreen,
this.tmpCentroid2d);a.applyAll(this.view,this.currentCamera,this.constraintOptions);c&&(c=this.planeHorizontal.normal,d=this.rotationValueSmooth.value,g=n.normalizeRotationDelta(b.angle-d),k=.00125*Math.min(Math.max(b.radius,40),120),this.rotationValueSmooth.gain=k,this.rotationValueSmooth.update(d+g),k=this.rotationValueSmooth.value-this.beginAngle,this.rotationMomentumEstimator.add(k,.001*b.timestamp),n.applyRotation(this.currentCamera,f,c,k),this.constraintOptions.interactionType=2,this.constraintOptions.interactionFactor=
a.pixelDistanceToInteractionFactor(Math.abs(b.radius*k)),a.applyAll(this.view,this.currentCamera,this.constraintOptions));this.currentCamera.markViewDirty()}};h.prototype.end=function(a){a.pointers.size===this.pointerCount&&this.update(a);this.finishController();return(a=this.zoomMomentumEstimator.evaluateMomentum())?new k.ZoomPlanarMomentumController(this.view,a,this.beginCenter):(a=this.rotationMomentumEstimator.evaluateMomentum())?new f.RotationMomentumController(this.view,a,this.beginCenter,this.planeHorizontal.normal):
(a=this.panMomentumEstimator.evaluateMomentum())?new c.PanPlanarMomentumController(this.view,a):null};h.prototype.computePlanePoints=function(a,c,d,f){f.length=a.size;var g=this.tmp2d,k=0;a.forEach(function(a){n.navPointToScreenPoint(d,a,g);void 0===f[k]&&(f[k]=b.vec3d.create());n.intersectPlaneFromScreenPoint(c,d,g,f[k]);k+=1});return f};return h}(g.InteractiveController);h.PinchAndPanController=q})},"esri/views/3d/input/handlers/PointerDownCancelAnimation":function(){define(["require","exports",
"../../../../core/tsSupport/extendsHelper","../../../input/InputHandler"],function(q,h,e,a){Object.defineProperty(h,"__esModule",{value:!0});q=function(a){function b(b,c){var d=a.call(this,!0)||this;d.view=b;d.registerIncoming("pointer-down",c,function(a){return d.view.state.stopActiveCameraController()});return d}e(b,a);return b}(a.InputHandler);h.PointerDownCancelAnimation=q})},"esri/views/3d/input/handlers/SingleKeyResetHeading":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper",
"./SingleKey"],function(q,h,e,a){Object.defineProperty(h,"__esModule",{value:!0});q=function(a){function b(b,c,d){d=a.call(this,"esri.views.3d.input.handlers.SingleKeyResetHeading",c,d)||this;d.view=b;d.key=c;return d}e(b,a);b.prototype.activate=function(){this.view.goTo({heading:0})};return b}(a.SingleKey);h.SingleKeyResetHeading=q})},"esri/views/3d/input/handlers/SingleKey":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler"],function(q,
h,e,a){Object.defineProperty(h,"__esModule",{value:!0});q=function(a){function b(b,c,d){var f=a.call(this,!0)||this;f.key=c;f.registerIncoming("key-down",d,function(a){return f._handleKeyDown(a)});return f}e(b,a);b.prototype._handleKeyDown=function(a){a.data.key===this.key&&(this.activate(),a.stopPropagation())};return b}(a.InputHandler);h.SingleKey=q})},"esri/views/3d/input/handlers/SingleKeyResetTilt":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./SingleKey"],
function(q,h,e,a){Object.defineProperty(h,"__esModule",{value:!0});q=function(a){function b(b,c,d){d=a.call(this,"esri.views.3d.input.handlers.SingleKeyResetTilt",c,d)||this;d.view=b;d.key=c;return d}e(b,a);b.prototype.activate=function(){this.view.goTo({tilt:0})};return b}(a.SingleKey);h.SingleKeyResetTilt=q})},"esri/views/3d/input/handlers/TwoFingerTilt":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../state/controllers/RotateController ../../state/helpers/PickingHelper ../../../input/InputHandler".split(" "),
function(q,h,e,a,d,b){Object.defineProperty(h,"__esModule",{value:!0});q=function(b){function c(a,c){void 0===c&&(c=!1);var f=b.call(this,!0)||this;f.view=a;f.invert=c;f.pickingHelper=new d.PickingHelper(a);f.registerIncoming("vertical-two-finger-drag",function(a){return f.handleTwoFinger(a)});return f}e(c,b);c.prototype.handleTwoFinger=function(b){var c=[0,-b.data.delta*(this.invert?-1:1)];switch(b.data.action){case "begin":this.cameraController=new a.RotateController(this.view,this.pickingHelper,
"center");this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(c);break;case "update":this.cameraController.update(c);break;case "end":this.cameraController.end(),this.cameraController=null}};return c}(b.InputHandler);h.TwoFingerTilt=q})},"esri/views/input/BrowserEventSource":function(){define(["require","exports","dojo/sniff","../../core/libs/pep/pep","./keys"],function(q,h,e,a,d){Object.defineProperty(h,"__esModule",{value:!0});var b=e("trident"),g=e("edge"),
c=e("chrome"),f=e("ff"),k=e("safari");q=function(){function e(b){this._active={};this._activePointerCaptures=new Set;this._keyDownState=new Set;this._element=b;a.applyLocal(b);b.getAttribute("tabindex")||b.setAttribute("tabindex","0");this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,
"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost};this._initialCssTouchAction=b.style.touchAction;b.style.touchAction="none";this._element.addEventListener("keydown",this._preventAltKeyDefault)}e.prototype.destroy=function(){var a=this;this.activeEvents=this._callback=null;this._activePointerCaptures.forEach(function(b){a._element.releasePointerCapture(b)});this._activePointerCaptures=null;this._element.style.touchAction=
this._initialCssTouchAction;this._element.removeEventListener("keydown",this._preventAltKeyDefault)};Object.defineProperty(e.prototype,"onEventReceived",{set:function(a){this._callback=a},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"activeEvents",{set:function(a){var b=this,c;for(c in this._active)a&&a.has(c)||(this._element.removeEventListener(n[c],this._active[c]),delete this._active[c]);a&&a.forEach(function(a){if(!b._active[a]&&n[a]){var c=(b._eventHandlers[a]||b._handleDefault).bind(b,
a);b._element.addEventListener(n[a],c);b._active[a]=c}})},enumerable:!0,configurable:!0});e.prototype.setPointerCapture=function(a,b){b?(this._element.setPointerCapture(a.pointerId),this._activePointerCaptures.add(a.pointerId)):(this._element.releasePointerCapture(a.pointerId),this._activePointerCaptures.delete(a.pointerId))};e.prototype._updateNormalizedPointerLikeEvent=function(a,b){var c=this._element.getBoundingClientRect();b.x=a.clientX-Math.round(c.left);b.y=a.clientY-Math.round(c.top);return b};
e.prototype._handleKey=function(a,b){var c=d.eventKey(b);c&&"key-up"===a&&this._keyDownState.delete(c);b={native:b,key:c,repeat:c&&this._keyDownState.has(c)};c&&"key-down"===a&&this._keyDownState.add(b.key);this._callback(a,b)};e.prototype._handlePointer=function(a,b){b=this._updateNormalizedPointerLikeEvent(b,{native:b,x:0,y:0,pointerType:b.pointerType,button:b.button,buttons:b.buttons});this._callback(a,b)};e.prototype._handlePointerPreventDefault=function(a,b){var c=this._updateNormalizedPointerLikeEvent(b,
{native:b,x:0,y:0,pointerType:b.pointerType,button:b.button,buttons:b.buttons});b.preventDefault();this._callback(a,c)};e.prototype._handleMouseWheel=function(a,d){d.preventDefault();var e=d.deltaY;switch(d.deltaMode){case 0:if(b||g)e=e/document.documentElement.clientHeight*600;break;case 1:e*=30;break;case 2:e*=900}b||g?e*=.7:c||k?e*=.6:f&&(e*=1.375);var l=Math.abs(e);100<l&&(e=e/l*200/(1+Math.exp(-.02*(l-100))));d=this._updateNormalizedPointerLikeEvent(d,{native:d,x:0,y:0,deltaY:e});this._callback(a,
d)};e.prototype._handlePointerCaptureLost=function(a,b){this._activePointerCaptures.delete(b.pointerId);this._handleDefault(a,b)};e.prototype._handleDefault=function(a,b){var c={native:b};b.preventDefault();this._callback(a,c)};e.prototype._preventAltKeyDefault=function(a){"Alt"===a.key&&a.preventDefault()};return e}();h.BrowserEventSource=q;var n={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture",
"pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel"}})},"esri/core/libs/pep/pep":function(){define(function(){function q(a,b){b=b||Object.create(null);var c=document.createEvent("Event");c.initEvent(a,b.bubbles||!1,b.cancelable||!1);a=2;for(var d;a<k.length;a++)d=k[a],c[d]=b[d]||n[a];c.buttons=b.buttons||0;a=0;a=b.pressure?b.pressure:c.buttons?.5:0;c.x=c.clientX;c.y=c.clientY;c.pointerId=
b.pointerId||0;c.width=b.width||0;c.height=b.height||0;c.pressure=a;c.tiltX=b.tiltX||0;c.tiltY=b.tiltY||0;c.pointerType=b.pointerType||"";c.hwTimestamp=b.hwTimestamp||0;c.isPrimary=b.isPrimary||!1;return c}function h(){this.array=[];this.size=0}function e(a,b,c,d){this.addCallback=a.bind(d);this.removeCallback=b.bind(d);this.changedCallback=c.bind(d);B&&(this.observer=new B(this.mutationWatcher.bind(this)))}function a(a){return"body /shadow-deep/ "+d(a)}function d(a){return'[touch-action\x3d"'+a+
'"]'}function b(a){return"{ -ms-touch-action: "+a+"; touch-action: "+a+"; touch-action-delay: none; }"}function g(){if(F){E.forEach(function(c){String(c)===c?(J+=d(c)+b(c)+"\n",M&&(J+=a(c)+b(c)+"\n")):(J+=c.selectors.map(d)+b(c.rule)+"\n",M&&(J+=c.selectors.map(a)+b(c.rule)+"\n"))});var c=document.createElement("style");c.textContent=J;document.head.appendChild(c)}}function c(a){if(!u.pointermap.has(a))throw a=Error("InvalidPointerId"),a.name="InvalidPointerId",a;}function f(a){if(!a.ownerDocument.contains(a))throw a=
Error("InvalidStateError"),a.name="InvalidStateError",a;}var k="bubbles cancelable view detail screenX screenY clientX clientY ctrlKey altKey shiftKey metaKey button relatedTarget pageX pageY".split(" "),n=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0],l=window.Map&&window.Map.prototype.forEach?Map:h;h.prototype={set:function(a,b){if(void 0===b)return this.delete(a);this.has(a)||this.size++;this.array[a]=b},has:function(a){return void 0!==this.array[a]},delete:function(a){this.has(a)&&(delete this.array[a],
this.size--)},get:function(a){return this.array[a]},clear:function(){this.size=this.array.length=0},forEach:function(a,b){return this.array.forEach(function(c,d){a.call(b,c,d,this)},this)}};var p="bubbles cancelable view detail screenX screenY clientX clientY ctrlKey altKey shiftKey metaKey button relatedTarget buttons pointerId width height pressure tiltX tiltY pointerType hwTimestamp isPrimary type target currentTarget which pageX pageY timeStamp".split(" "),m=[!1,!1,null,null,0,0,0,0,!1,!1,!1,
!1,0,null,0,0,0,0,0,0,0,"",0,!1,"",null,null,0,0,0,0],r={pointerover:1,pointerout:1,pointerenter:1,pointerleave:1},t="undefined"!==typeof SVGElementInstance,u={pointermap:new l,eventMap:Object.create(null),captureInfo:Object.create(null),eventSources:Object.create(null),eventSourceList:[],registerSource:function(a,b){var c=b.events;c&&(c.forEach(function(a){b[a]&&(this.eventMap[a]=b[a].bind(b))},this),this.eventSources[a]=b,this.eventSourceList.push(b))},register:function(a){for(var b=this.eventSourceList.length,
c=0,d;c<b&&(d=this.eventSourceList[c]);c++)d.register.call(d,a)},unregister:function(a){for(var b=this.eventSourceList.length,c=0,d;c<b&&(d=this.eventSourceList[c]);c++)d.unregister.call(d,a)},contains:function(a,b){try{return a.contains(b)}catch(R){return!1}},down:function(a){a.bubbles=!0;this.fireEvent("pointerdown",a)},move:function(a){a.bubbles=!0;this.fireEvent("pointermove",a)},up:function(a){a.bubbles=!0;this.fireEvent("pointerup",a)},enter:function(a){a.bubbles=!1;this.fireEvent("pointerenter",
a)},leave:function(a){a.bubbles=!1;this.fireEvent("pointerleave",a)},over:function(a){a.bubbles=!0;this.fireEvent("pointerover",a)},out:function(a){a.bubbles=!0;this.fireEvent("pointerout",a)},cancel:function(a){a.bubbles=!0;this.fireEvent("pointercancel",a)},leaveOut:function(a){this.out(a);this.propagate(a,this.leave,!1)},enterOver:function(a){this.over(a);this.propagate(a,this.enter,!0)},eventHandler:function(a){if(!a._handledByPE){var b=a.type;(b=this.eventMap&&this.eventMap[b])&&b(a);a._handledByPE=
!0}},listen:function(a,b){b.forEach(function(b){this.addEvent(a,b)},this)},unlisten:function(a,b){b.forEach(function(b){this.removeEvent(a,b)},this)},addEvent:function(a,b){a.addEventListener(b,this.boundHandler)},removeEvent:function(a,b){a.removeEventListener(b,this.boundHandler)},makeEvent:function(a,b){this.captureInfo[b.pointerId]&&(b.relatedTarget=null);a=new q(a,b);b.preventDefault&&(a.preventDefault=b.preventDefault);a._target=a._target||b.target;return a},fireEvent:function(a,b){a=this.makeEvent(a,
b);return this.dispatchEvent(a)},cloneEvent:function(a){for(var b=Object.create(null),c,d=0;d<p.length;d++)c=p[d],b[c]=a[c]||m[d],t&&("target"===c||"relatedTarget"===c)&&b[c]instanceof SVGElementInstance&&(b[c]=b[c].correspondingUseElement);a.preventDefault&&(b.preventDefault=function(){a.preventDefault()});return b},getTarget:function(a){var b=this.captureInfo[a.pointerId];if(!b)return a._target;if(a._target===b||!(a.type in r))return b},propagate:function(a,b,c){for(var d=a.target,f=[];!d.contains(a.relatedTarget)&&
d!==document;)f.push(d),d=d.parentNode;c&&f.reverse();f.forEach(function(c){a.target=c;b.call(this,a)},this)},setCapture:function(a,b){this.captureInfo[a]&&this.releaseCapture(a);this.captureInfo[a]=b;var c=new q("gotpointercapture");c.pointerId=a;this.implicitRelease=this.releaseCapture.bind(this,a);document.addEventListener("pointerup",this.implicitRelease);document.addEventListener("pointercancel",this.implicitRelease);c._target=b;this.asyncDispatchEvent(c)},releaseCapture:function(a){var b=this.captureInfo[a];
if(b){var c=new q("lostpointercapture");c.pointerId=a;this.captureInfo[a]=void 0;document.removeEventListener("pointerup",this.implicitRelease);document.removeEventListener("pointercancel",this.implicitRelease);c._target=b;this.asyncDispatchEvent(c)}},dispatchEvent:function(a){var b=this.getTarget(a);if(b)return b.dispatchEvent(a)},asyncDispatchEvent:function(a){requestAnimationFrame(this.dispatchEvent.bind(this,a))}};u.boundHandler=u.eventHandler.bind(u);var x={shadow:function(a){if(a)return a.shadowRoot||
a.webkitShadowRoot},canTarget:function(a){return a&&!!a.elementFromPoint},targetingShadow:function(a){a=this.shadow(a);if(this.canTarget(a))return a},olderShadow:function(a){var b=a.olderShadowRoot;!b&&(a=a.querySelector("shadow"))&&(b=a.olderShadowRoot);return b},allShadows:function(a){var b=[];for(a=this.shadow(a);a;)b.push(a),a=this.olderShadow(a);return b},searchRoot:function(a,b,c){if(a){var d=a.elementFromPoint(b,c),f;for(f=this.targetingShadow(d);f;){if(a=f.elementFromPoint(b,c))return d=this.targetingShadow(a),
this.searchRoot(d,b,c)||a;f=this.olderShadow(f)}return d}},owner:function(a){for(;a.parentNode;)a=a.parentNode;a.nodeType!==Node.DOCUMENT_NODE&&a.nodeType!==Node.DOCUMENT_FRAGMENT_NODE&&(a=document);return a},findTarget:function(a){var b=a.clientX,c=a.clientY;a=this.owner(a.target);a.elementFromPoint(b,c)||(a=document);return this.searchRoot(a,b,c)}},v=Array.prototype.forEach.call.bind(Array.prototype.forEach),A=Array.prototype.map.call.bind(Array.prototype.map),y=Array.prototype.slice.call.bind(Array.prototype.slice),
C=Array.prototype.filter.call.bind(Array.prototype.filter),B=window.MutationObserver||window.WebKitMutationObserver,D={subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["touch-action"]};e.prototype={watchSubtree:function(a){this.observer&&x.canTarget(a)&&this.observer.observe(a,D)},enableOnSubtree:function(a){this.watchSubtree(a);a===document&&"complete"!==document.readyState?this.installOnLoad():this.installNewSubtree(a)},installNewSubtree:function(a){v(this.findElements(a),
this.addElement,this)},findElements:function(a){return a.querySelectorAll?a.querySelectorAll("[touch-action]"):[]},removeElement:function(a){this.removeCallback(a)},addElement:function(a){this.addCallback(a)},elementChanged:function(a,b){this.changedCallback(a,b)},concatLists:function(a,b){return a.concat(y(b))},installOnLoad:function(){document.addEventListener("readystatechange",function(){"complete"===document.readyState&&this.installNewSubtree(document)}.bind(this))},isElement:function(a){return a.nodeType===
Node.ELEMENT_NODE},flattenMutationTree:function(a){var b=A(a,this.findElements,this);b.push(C(a,this.isElement));return b.reduce(this.concatLists,[])},mutationWatcher:function(a){a.forEach(this.mutationHandler,this)},mutationHandler:function(a){"childList"===a.type?(this.flattenMutationTree(a.addedNodes).forEach(this.addElement,this),this.flattenMutationTree(a.removedNodes).forEach(this.removeElement,this)):"attributes"===a.type&&this.elementChanged(a.target,a.oldValue)}};var E=["none","auto","pan-x",
"pan-y",{rule:"pan-x pan-y",selectors:["pan-x pan-y","pan-y pan-x"]}],J="",F=window.PointerEvent||window.MSPointerEvent,M=!window.ShadowDOMPolyfill&&document.head.createShadowRoot,H=u.pointermap,I=[1,4,2,8,16],K=!1;try{K=1===(new MouseEvent("test",{buttons:1})).buttons}catch(ea){}var O={POINTER_ID:1,POINTER_TYPE:"mouse",events:["mousedown","mousemove","mouseup","mouseover","mouseout"],register:function(a){u.listen(a,this.events)},unregister:function(a){u.unlisten(a,this.events)},lastTouches:[],isEventSimulatedFromTouch:function(a){var b=
this.lastTouches,c=a.clientX;a=a.clientY;for(var d=0,f=b.length,g;d<f&&(g=b[d]);d++){var k=Math.abs(a-g.y);if(25>=Math.abs(c-g.x)&&25>=k)return!0}},prepareEvent:function(a){var b=u.cloneEvent(a),c=b.preventDefault;b.preventDefault=function(){a.preventDefault();c()};b.pointerId=this.POINTER_ID;b.isPrimary=!0;b.pointerType=this.POINTER_TYPE;return b},prepareButtonsForMove:function(a,b){var c=H.get(this.POINTER_ID);a.buttons=0!==b.which&&c?c.buttons:0;b.buttons=a.buttons},mousedown:function(a){if(!this.isEventSimulatedFromTouch(a)){var b=
H.get(this.POINTER_ID),c=this.prepareEvent(a);K||(c.buttons=I[c.button],b&&(c.buttons|=b.buttons),a.buttons=c.buttons);H.set(this.POINTER_ID,a);b&&0!==b.buttons?u.move(c):u.down(c)}},mousemove:function(a){if(!this.isEventSimulatedFromTouch(a)){var b=this.prepareEvent(a);K||this.prepareButtonsForMove(b,a);b.button=-1;H.set(this.POINTER_ID,a);u.move(b)}},mouseup:function(a){if(!this.isEventSimulatedFromTouch(a)){var b=H.get(this.POINTER_ID),c=this.prepareEvent(a);if(!K){var d=I[c.button];c.buttons=
b?b.buttons&~d:0;a.buttons=c.buttons}H.set(this.POINTER_ID,a);c.buttons&=~I[c.button];0===c.buttons?u.up(c):u.move(c)}},mouseover:function(a){if(!this.isEventSimulatedFromTouch(a)){var b=this.prepareEvent(a);K||this.prepareButtonsForMove(b,a);b.button=-1;H.set(this.POINTER_ID,a);u.enterOver(b)}},mouseout:function(a){if(!this.isEventSimulatedFromTouch(a)){var b=this.prepareEvent(a);K||this.prepareButtonsForMove(b,a);b.button=-1;u.leaveOut(b)}},cancel:function(a){a=this.prepareEvent(a);u.cancel(a);
this.deactivateMouse()},deactivateMouse:function(){H.delete(this.POINTER_ID)}},P=u.captureInfo,L=x.findTarget.bind(x),U=x.allShadows.bind(x),N=u.pointermap,S,aa={events:["touchstart","touchmove","touchend","touchcancel"],register:function(a){S.enableOnSubtree(a)},unregister:function(a){},elementAdded:function(a){var b=a.getAttribute("touch-action"),c=this.touchActionToScrollType(b);c&&(a._scrollType=c,u.listen(a,this.events),U(a).forEach(function(a){a._scrollType=c;u.listen(a,this.events)},this))},
elementRemoved:function(a){a._scrollType=void 0;u.unlisten(a,this.events);U(a).forEach(function(a){a._scrollType=void 0;u.unlisten(a,this.events)},this)},elementChanged:function(a,b){var c=a.getAttribute("touch-action"),d=this.touchActionToScrollType(c);b=this.touchActionToScrollType(b);d&&b?(a._scrollType=d,U(a).forEach(function(a){a._scrollType=d},this)):b?this.elementRemoved(a):d&&this.elementAdded(a)},scrollTypes:{EMITTER:"none",XSCROLLER:"pan-x",YSCROLLER:"pan-y",SCROLLER:/^(?:pan-x pan-y)|(?:pan-y pan-x)|auto$/},
touchActionToScrollType:function(a){var b=this.scrollTypes;if("none"===a)return"none";if(a===b.XSCROLLER)return"X";if(a===b.YSCROLLER)return"Y";if(b.SCROLLER.exec(a))return"XY"},POINTER_TYPE:"touch",firstTouch:null,isPrimaryTouch:function(a){return this.firstTouch===a.identifier},setPrimaryTouch:function(a){if(0===N.size||1===N.size&&N.has(1))this.firstTouch=a.identifier,this.firstXY={X:a.clientX,Y:a.clientY},this.scrolling=!1,this.cancelResetClickCount()},removePrimaryPointer:function(a){a.isPrimary&&
(this.firstXY=this.firstTouch=null,this.resetClickCount())},clickCount:0,resetId:null,resetClickCount:function(){var a=function(){this.clickCount=0;this.resetId=null}.bind(this);this.resetId=setTimeout(a,200)},cancelResetClickCount:function(){this.resetId&&clearTimeout(this.resetId)},typeToButtons:function(a){var b=0;if("touchstart"===a||"touchmove"===a)b=1;return b},touchToPointer:function(a){var b=this.currentTouchEvent,c=u.cloneEvent(a),d=c.pointerId=a.identifier+2;c.target=P[d]||L(c);c.bubbles=
!0;c.cancelable=!0;c.detail=this.clickCount;c.button=0;c.buttons=this.typeToButtons(b.type);c.width=a.radiusX||a.webkitRadiusX||0;c.height=a.radiusY||a.webkitRadiusY||0;c.pressure=a.force||a.webkitForce||.5;c.isPrimary=this.isPrimaryTouch(a);c.pointerType=this.POINTER_TYPE;c.altKey=b.altKey;c.ctrlKey=b.ctrlKey;c.metaKey=b.metaKey;c.shiftKey=b.shiftKey;var f=this;c.preventDefault=function(){f.scrolling=!1;f.firstXY=null;b.preventDefault()};return c},processTouches:function(a,b){var c=a.changedTouches;
this.currentTouchEvent=a;a=0;for(var d;a<c.length;a++)d=c[a],b.call(this,this.touchToPointer(d))},shouldScroll:function(a){if(this.firstXY){var b;b=a.currentTarget._scrollType;if("none"===b)b=!1;else if("XY"===b)b=!0;else{a=a.changedTouches[0];var c="Y"===b?"X":"Y";b=Math.abs(a["client"+b]-this.firstXY[b])>=Math.abs(a["client"+c]-this.firstXY[c])}this.firstXY=null;return b}},findTouch:function(a,b){for(var c=0,d=a.length,f;c<d&&(f=a[c]);c++)if(f.identifier===b)return!0},vacuumTouches:function(a){var b=
a.touches;if(N.size>=b.length){var c=[];N.forEach(function(a,d){1===d||this.findTouch(b,d-2)||c.push(a.out)},this);c.forEach(this.cancelOut,this)}},touchstart:function(a){this.vacuumTouches(a);this.setPrimaryTouch(a.changedTouches[0]);this.dedupSynthMouse(a);this.scrolling||(this.clickCount++,this.processTouches(a,this.overDown))},overDown:function(a){N.set(a.pointerId,{target:a.target,out:a,outTarget:a.target});u.enterOver(a);u.down(a)},touchmove:function(a){this.scrolling||(this.shouldScroll(a)?
(this.scrolling=!0,this.touchcancel(a)):(a.preventDefault(),this.processTouches(a,this.moveOverOut)))},moveOverOut:function(a){var b=N.get(a.pointerId);if(b){var c=b.out,d=b.outTarget;u.move(a);c&&d!==a.target&&(c.relatedTarget=a.target,a.relatedTarget=d,c.target=d,a.target?(u.leaveOut(c),u.enterOver(a)):(a.target=d,a.relatedTarget=null,this.cancelOut(a)));b.out=a;b.outTarget=a.target}},touchend:function(a){this.dedupSynthMouse(a);this.processTouches(a,this.upOut)},upOut:function(a){this.scrolling||
(u.up(a),u.leaveOut(a));this.cleanUpPointer(a)},touchcancel:function(a){this.processTouches(a,this.cancelOut)},cancelOut:function(a){u.cancel(a);u.leaveOut(a);this.cleanUpPointer(a)},cleanUpPointer:function(a){N.delete(a.pointerId);this.removePrimaryPointer(a)},dedupSynthMouse:function(a){var b=O.lastTouches;a=a.changedTouches[0];this.isPrimaryTouch(a)&&(a={x:a.clientX,y:a.clientY},b.push(a),b=function(a,b){b=a.indexOf(b);-1<b&&a.splice(b,1)}.bind(null,b,a),setTimeout(b,2500))}};S=new e(aa.elementAdded,
aa.elementRemoved,aa.elementChanged,aa);var V=u.pointermap,T=window.MSPointerEvent&&"number"===typeof window.MSPointerEvent.MSPOINTER_TYPE_MOUSE,Q={events:"MSPointerDown MSPointerMove MSPointerUp MSPointerOut MSPointerOver MSPointerCancel MSGotPointerCapture MSLostPointerCapture".split(" "),register:function(a){u.listen(a,this.events)},unregister:function(a){u.unlisten(a,this.events)},POINTER_TYPES:["","unavailable","touch","pen","mouse"],prepareEvent:function(a){var b=a;T&&(b=u.cloneEvent(a),b.pointerType=
this.POINTER_TYPES[a.pointerType]);return b},cleanup:function(a){V.delete(a)},MSPointerDown:function(a){V.set(a.pointerId,a);a=this.prepareEvent(a);u.down(a)},MSPointerMove:function(a){a=this.prepareEvent(a);u.move(a)},MSPointerUp:function(a){var b=this.prepareEvent(a);u.up(b);this.cleanup(a.pointerId)},MSPointerOut:function(a){a=this.prepareEvent(a);u.leaveOut(a)},MSPointerOver:function(a){a=this.prepareEvent(a);u.enterOver(a)},MSPointerCancel:function(a){var b=this.prepareEvent(a);u.cancel(b);this.cleanup(a.pointerId)},
MSLostPointerCapture:function(a){a=u.makeEvent("lostpointercapture",a);u.dispatchEvent(a)},MSGotPointerCapture:function(a){a=u.makeEvent("gotpointercapture",a);u.dispatchEvent(a)}},G,X;window.navigator.msPointerEnabled?(G=function(a){c(a);f(this);0!==u.pointermap.get(a).buttons&&this.msSetPointerCapture(a)},X=function(a){c(a);this.msReleasePointerCapture(a)}):(G=function(a){c(a);f(this);0!==u.pointermap.get(a).buttons&&u.setCapture(a,this)},X=function(a){c(a);u.releaseCapture(a,this)});var Z=window.PointerEvent||
window.MSPointerEvent;return{dispatcher:u,Installer:e,PointerEvent:q,PointerMap:l,targetFinding:x,applyGlobal:function(){g();window.PointerEvent||(window.PointerEvent=q,window.navigator.msPointerEnabled?(Object.defineProperty(window.navigator,"maxTouchPoints",{value:window.navigator.msMaxTouchPoints,enumerable:!0}),u.registerSource("ms",Q)):(u.registerSource("mouse",O),void 0!==window.ontouchstart&&u.registerSource("touch",aa)),u.register(document));window.Element&&!Element.prototype.setPointerCapture&&
Object.defineProperties(Element.prototype,{setPointerCapture:{value:G},releasePointerCapture:{value:X}})},applyLocal:function(a){Z||(window.PointerEvent||(window.navigator.msPointerEnabled?u.registerSource("ms",Q):(u.registerSource("mouse",O),void 0!==window.ontouchstart&&u.registerSource("touch",aa)),u.register(document)),window.Element&&!Element.prototype.setPointerCapture&&(a.setPointerCapture=G.bind(a),a.releasePointerCapture=X.bind(a)),a.getAttribute("touch-action")||a.setAttribute("touch-action",
"none"))}}})},"esri/views/input/keys":function(){define(["require","exports","../../core/sniff"],function(q,h,e){Object.defineProperty(h,"__esModule",{value:!0});h.primaryKey=e("mac")?"Meta":"Ctrl";var a={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(q=48;58>q;q++)a[q]=String.fromCharCode(q);for(q=1;25>q;q++)a[111+q]="F"+q;for(q=65;91>q;q++)a[q]=[String.fromCharCode(q+
32),String.fromCharCode(q)];var d={Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Esc:"Escape"};h.eventKey=function(b){if(void 0!==b.key)return d[b.key]||b.key;var g=a[b.keyCode];return Array.isArray(g)?b.shiftKey?g[1]:g[0]:g};h.isSystemModifier=function(a){switch(a){case "Ctrl":case "Alt":case "Shift":case "Meta":case "Primary":return!0}}})},"esri/views/input/InputManager":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Logger ../../core/now ../../core/accessorSupport/decorators ./keys ./recognizers ./handlers/LatestPointerType".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n){Object.defineProperty(h,"__esModule",{value:!0});var l=b.getLogger("esri.views.input.InputManager");q=function(b){function d(a,c){a=b.call(this)||this;a._pointerCaptures=new Map;a._nameToGroup={};a._handlers=[];a._currentPropagation=null;a._sourceEvents=new Set;a._keyModifiers=new Set;a._activeKeyModifiers=new Set;a.primaryKey=f.primaryKey;a.latestPointerType="mouse";a._installRecognizers();return a}e(d,b);d.prototype.normalizeCtorArgs=function(a,b){this._browserEvents=
a;this._browserEvents.onEventReceived=this._onEventReceived.bind(this);this._recognizers=b;this._recognizers||(this._recognizers=k.defaults.map(function(a){return new a}));return{}};d.prototype.destroy=function(){for(var a=0,b=Object.keys(this._nameToGroup);a<b.length;a++)this.uninstallHandlers(b[a])};d.prototype.installHandlers=function(a,b){var c=this;if(this._nameToGroup[a])l.error("There is already an InputHandler group registered under the name `"+a+"`");else if(0===b.length)l.error("Can't register a group of zero handlers");
else{var d={name:a,handlers:b.map(function(a,b){return{handler:a,active:!0,removed:!1,priorityIndex:0,eventCallback:null,uninstallCallback:null}})};this._nameToGroup[a]=d;a=function(a){var b=d.handlers[a];f._handlers.push(b);b.handler.onInstall({updateDependencies:function(){c.updateDependencies()},emit:function(a,d,f,g){c._emitInputEvent(b.priorityIndex,a,d,f,g)},setPointerCapture:function(a,f){c._setPointerCapture(d,b,a,f)},setEventCallback:function(a){b.eventCallback=a},setUninstallCallback:function(a){b.uninstallCallback=
a}})};var f=this;for(b=d.handlers.length-1;0<=b;b--)a(b);this.updateDependencies()}};d.prototype.uninstallHandlers=function(a){var b=this._nameToGroup[a];b?(b.handlers.forEach(function(a){a.removed=!0;a.uninstallCallback()}),delete this._nameToGroup[a],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):l.error("There is no InputHandler group registered under the name `"+a+"`")};d.prototype.hasHandlers=function(a){return void 0!==
this._nameToGroup[a]};d.prototype.updateDependencies=function(){var a=new Set,b=new Set;this._handlersPriority=[];for(var c=this._handlers.length-1;0<=c;c--){var d=this._handlers[c];d.priorityIndex=c;this._handlersPriority.push(d)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(c=this._handlersPriority.length-1;0<=c;c--){d=this._handlersPriority[c];d.priorityIndex=c;var g=d.handler.hasSideEffects;if(!g)for(var k=0,e=d.handler.outgoingEventTypes;k<e.length;k++)if(a.has(e[k])){g=
!0;break}if(g)for(k=0,e=d.handler.incomingEventMatches;k<e.length;k++){var l=e[k];a.add(l.eventType);for(var m=0,l=l.keyModifiers;m<l.length;m++){var n=l[m];f.isSystemModifier(n)||b.add(n)}}d.active=g}this._sourceEvents=a;this._keyModifiers=b;0<this._pointerCaptures.size&&this._sourceEvents.add("pointer-capture-lost");0<this._keyModifiers.size&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up"));this._browserEvents&&(this._browserEvents.activeEvents=this._sourceEvents)};d.prototype._setLatestPointerType=
function(a){this._set("latestPointerType",a)};d.prototype._onEventReceived=function(a,b){"pointer-capture-lost"===a&&this._pointerCaptures.delete(b.native.pointerId);this._updateKeyModifiers(a,b);this._emitInputEventFromSource(a,b,b.native.timestamp)};d.prototype._updateKeyModifiers=function(a,b){var c=this;if(b){var d=!1,f=function(){if(!d){var a=new Set;c._activeKeyModifiers.forEach(function(b){a.add(b)});c._activeKeyModifiers=a;d=!0}},g=function(a,b){b&&!c._activeKeyModifiers.has(a)?(f(),c._activeKeyModifiers.add(a)):
!b&&c._activeKeyModifiers.has(a)&&(f(),c._activeKeyModifiers.delete(a))};if("key-down"===a||"key-up"===a){var k=b.key;this._keyModifiers.has(k)&&g(k,"key-down"===a)}a=b.native;g("Alt",!(!a||!a.altKey));g("Ctrl",!(!a||!a.ctrlKey));g("Shift",!(!a||!a.shiftKey));g("Meta",!(!a||!a.metaKey));g("Primary",this._activeKeyModifiers.has(this.primaryKey))}};d.prototype._installRecognizers=function(){var a=this;this._latestPointerTypeHandler=new n.LatestPointerType(function(b){return a._setLatestPointerType(b)});
0<this._recognizers.length&&this.installHandlers("default",this._recognizers);this.installHandlers("input-manager-logic",[this._latestPointerTypeHandler])};d.prototype._setPointerCapture=function(a,b,c,d){a=a.name+"-"+b.priorityIndex;b=this._pointerCaptures.get(c.pointerId)||new Set;this._pointerCaptures.set(c.pointerId,b);d?(b.add(a),1===b.size&&this._browserEvents&&this._browserEvents.setPointerCapture(c,!0)):b.has(a)&&(b.delete(a),0===b.size&&(this._pointerCaptures.delete(c.pointerId),this._browserEvents&&
this._browserEvents.setPointerCapture(c,!1)))};d.prototype._garbageCollectRemovedHandlers=function(){this._handlers=this._handlers.filter(function(a){return!a.removed});this.updateDependencies()};d.prototype._emitInputEventFromSource=function(a,b,c){this._emitInputEvent(0,a,b,c)};d.prototype._emitInputEvent=function(a,b,c,d,f){d=void 0!==d?d:this._currentPropagation?this._currentPropagation.timestamp:g();b=new p(b,c,d,f||this._activeKeyModifiers);this._currentPropagation?this._currentPropagation.addedEvents.push(b):
this._doNewPropagation(a,b)};d.prototype._doNewPropagation=function(a,b){for(a=this._currentPropagation={events:[b],addedEvents:[],currentHandler:this._handlersPriority[a],needsHandlerGarbageCollect:!1,timestamp:b.timestamp};a.currentHandler;){if(a.currentHandler.removed)a.needsHandlerGarbageCollect=!0;else{b=a.events;var c=[];a.addedEvents=[];for(var d=0;d<b.length;d++){var f=b[d];a.currentHandler.active&&a.currentHandler.eventCallback(f);f.shouldStopPropagation()||c.push(f)}a.events=c.concat(a.addedEvents)}a.currentHandler=
this._handlersPriority[a.currentHandler.priorityIndex+1]}a.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers();this._currentPropagation=null};d.prototype._compareHandlerPriority=function(a,b){if(a.handler.hasSideEffects!==b.handler.hasSideEffects)return a.handler.hasSideEffects?1:-1;for(var c=0,d=a.handler.incomingEventMatches;c<d.length;c++)for(var f=d[c],g=function(a){if(f.eventType!==a.eventType)return"continue";var b=f.keyModifiers.filter(function(b){return-1!==a.keyModifiers.indexOf(b)});
if(b.length===f.keyModifiers.length!==(b.length===a.keyModifiers.length))return{value:f.keyModifiers.length>a.keyModifiers.length?-1:1}},k=0,e=b.handler.incomingEventMatches;k<e.length;k++){var l=g(e[k]);if("object"===typeof l)return l.value}return a.priorityIndex>b.priorityIndex?-1:1};d.prototype._sortHandlersPriority=function(a){for(var b=[],c=0;c<a.length;c++){for(var d=a[c],f=0;f<b.length&&0<=this._compareHandlerPriority(d,b[f]);)f++;b.splice(f,0,d)}return b};a([c.property({readOnly:!0})],d.prototype,
"latestPointerType",void 0);return d=a([c.subclass("esri.views.input.InputManager")],d)}(c.declared(d));h.InputManager=q;var p=function(){function a(a,b,c,d){this.type=a;this.data=b;this.timestamp=c;this.modifiers=d;this._stopPropagation=!1}a.prototype.stopPropagation=function(){this._stopPropagation=!0};a.prototype.shouldStopPropagation=function(){return this._stopPropagation};return a}()})},"esri/views/input/recognizers":function(){define("require exports ./recognizers/Drag ./recognizers/PointerClickHoldAndDrag ./recognizers/SingleAndDoubleClick ./recognizers/VerticalTwoFingerDrag".split(" "),
function(q,h,e,a,d,b){Object.defineProperty(h,"__esModule",{value:!0});h.defaults=[a.PointerClickHoldAndDrag,d.SingleAndDoubleClick,e.Drag,b.VerticalTwoFingerDrag]})},"esri/views/input/recognizers/Drag":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../InputHandler","./support"],function(q,h,e,a,d){function b(a){var b=[];a.forEach(function(a){b.push(a.event)});return d.fitCircleLSQ(b)}function g(a){var c=b(a),d=0;a.forEach(function(a){for(var b=f(a,c),b=b-a.lastAngle;b>
Math.PI;)b-=2*Math.PI;for(;b<-Math.PI;)b+=2*Math.PI;b=a.lastAngle+b;a.lastAngle=b;d+=b-a.initialAngle});d/=a.size||1;return{angle:d,radius:c.radius,center:c.center}}function c(a){var b=new Map;a.forEach(function(a,c){return b.set(c,a.event)});return b}function f(a,b){a=a.event;return Math.atan2(a.y-b.center.y,a.x-b.center.x)}Object.defineProperty(h,"__esModule",{value:!0});q=function(a){function d(){var b=a.call(this,!1)||this;b.startStateModifiers=new Set;b.activePointerMap=new Map;b.isDragging=
!1;b.drag=b.registerOutgoing("drag");b.registerIncoming("pointer-drag",b.handlePointerDrag.bind(b));b.registerIncoming("pointer-up",b.handlePointerUpAndPointerLost.bind(b));b.registerIncoming("pointer-capture-lost",b.handlePointerUpAndPointerLost.bind(b));b.registerIncoming("pointer-cancel",b.handlePointerUpAndPointerLost.bind(b));return b}e(d,a);d.prototype.createPayload=function(a,b,d,f){return{action:a,pointerType:this.pointerType,button:this.mouseButton,buttons:b.buttons,timestamp:f,pointers:c(this.activePointerMap),
pointer:b,angle:d.angle,radius:d.radius,center:d.center}};d.prototype.addPointer=function(a){var c=a.native.pointerId,d=g(this.activePointerMap).angle;a={event:a,initialAngle:0,lastAngle:0};this.activePointerMap.set(c,a);c=f(a,b(this.activePointerMap));a.initialAngle=c;a.lastAngle=c;this.updatePointerAngles(d)};d.prototype.updatePointer=function(a){if(!a||null!=a.x||null!=a.y){var b=this.activePointerMap.get(a.native.pointerId);b?b.event=a:this.addPointer(a)}};d.prototype.removePointer=function(a){var b=
g(this.activePointerMap).angle;this.activePointerMap.delete(a);this.updatePointerAngles(b)};d.prototype.updatePointerAngles=function(a){var b=g(this.activePointerMap);this.activePointerMap.forEach(function(c){c.initialAngle=f(c,b)-a;c.lastAngle=f(c,b)-a})};d.prototype.emitEvent=function(a,b,c){var d=g(this.activePointerMap);this.drag.emit(this.createPayload(a,b,d,c),void 0,this.startStateModifiers)};d.prototype.handlePointerUpAndPointerLost=function(a){var b=a.data.native.pointerId,c=a.timestamp;
this.activePointerMap.get(b)&&(1===this.activePointerMap.size?(this.updatePointer(a.data),this.emitEvent("end",a.data,c),this.isDragging=!1,this.removePointer(b)):(this.removePointer(b),this.emitEvent("removed",a.data,a.timestamp)))};d.prototype.handlePointerDrag=function(a){var b=a.data,c=b.currentEvent,d=a.timestamp;switch(b.action){case "start":case "update":this.isDragging?this.activePointerMap.has(c.native.pointerId)?(this.updatePointer(c),this.emitEvent("update",c,d)):(this.addPointer(c),this.emitEvent("added",
c,d)):(this.updatePointer(c),this.pointerType=a.data.startEvent.pointerType,this.mouseButton=a.data.startEvent.button,this.startStateModifiers=a.modifiers,this.isDragging=!0,this.emitEvent("start",c,d))}};return d}(a.InputHandler);h.Drag=q;(function(a){a[a.Left=0]="Left";a[a.Middle=1]="Middle";a[a.Right=2]="Right";a[a.Back=3]="Back";a[a.Forward=4]="Forward";a[a.Undefined=-1]="Undefined"})(h.Button||(h.Button={}))})},"esri/views/input/recognizers/support":function(){define(["require","exports"],function(q,
h){Object.defineProperty(h,"__esModule",{value:!0});h.manhattanDistance=function(e,a){return Math.abs(a.x-e.x)+Math.abs(a.y-e.y)};h.euclideanDistance=function(e,a){var d=a.x-e.x;e=a.y-e.y;return Math.sqrt(d*d+e*e)};h.fitCircleLSQ=function(e,a){a?(a.radius=0,a.center.x=0,a.center.y=0):a={radius:0,center:{x:0,y:0}};if(0===e.length)return a;if(1===e.length)return a.center.x=e[0].x,a.center.y=e[0].y,a;if(2===e.length){var d=e[0];e=e[1];var b=[e.x-d.x,e.y-d.y],g=b[0],b=b[1];a.radius=Math.sqrt(g*g+b*b)/
2;a.center.x=(d.x+e.x)/2;a.center.y=(d.y+e.y)/2;return a}for(var c=0,f=0,k=0;k<e.length;k++)c+=e[k].x,f+=e[k].y;for(var c=c/e.length,f=f/e.length,n=e.map(function(a){return a.x-c}),l=e.map(function(a){return a.y-f}),p=d=a=0,m=0,r=g=0,k=b=0;k<n.length;k++){var t=n[k],u=l[k],h=t*t,v=u*u;a+=h;d+=v;p+=t*u;m+=h*t;g+=v*u;r+=t*v;b+=u*h}k=a;n=p;l=d;m=.5*(m+r);g=.5*(g+b);b=k*l-p*n;r=(m*l-g*n)/b;g=(k*g-p*m)/b;return{radius:Math.sqrt(r*r+g*g+(a+d)/e.length),center:{x:r+c,y:g+f}}}})},"esri/views/input/recognizers/PointerClickHoldAndDrag":function(){define(["require",
"exports","../../../core/tsSupport/extendsHelper","../InputHandler","./support"],function(q,h,e,a,d){Object.defineProperty(h,"__esModule",{value:!0});h.DefaultParameters={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilTouchDrag:6,holdDelay:500};q=function(a){function b(b,d,g,e){void 0===b&&(b=h.DefaultParameters.maximumClickDelay);void 0===d&&(d=h.DefaultParameters.movementUntilMouseDrag);void 0===g&&(g=h.DefaultParameters.movementUntilTouchDrag);void 0===e&&(e=h.DefaultParameters.holdDelay);
var c=a.call(this,!1)||this;c.maximumClickDelay=b;c.movementUntilMouseDrag=d;c.movementUntilTouchDrag=g;c.holdDelay=e;c._pointerState=new Map;c._pointerDrag=c.registerOutgoing("pointer-drag");c._immediateClick=c.registerOutgoing("immediate-click");c._pointerHold=c.registerOutgoing("hold");c.registerIncoming("pointer-down",c._handlePointerDown.bind(c));c.registerIncoming("pointer-up",function(a){c._handlePointerLoss(a,"pointer-up")});c.registerIncoming("pointer-capture-lost",function(a){c._handlePointerLoss(a,
"pointer-capture-lost")});c.registerIncoming("pointer-cancel",function(a){c._handlePointerLoss(a,"pointer-cancel")});c._moveHandle=c.registerIncoming("pointer-move",c._handlePointerMove.bind(c));c._moveHandle.pause();return c}e(b,a);b.prototype.onUninstall=function(){this._pointerState.forEach(function(a){0!==a.holdTimeout&&(clearTimeout(a.holdTimeout),a.holdTimeout=0)});a.prototype.onUninstall.call(this)};b.prototype._handlePointerDown=function(a){var b=this,c=a.data,d=c.native.pointerId,g=0;0===
this._pointerState.size&&(g=setTimeout(function(){var c=b._pointerState.get(d);c&&(c.isDragging||(b._pointerHold.emit(c.previousEvent,void 0,a.modifiers),c.holdEmitted=!0),c.holdTimeout=0)},this.holdDelay));g={startEvent:c,previousEvent:c,startTimestamp:a.timestamp,isDragging:!1,downButton:c.native.button,holdTimeout:g,modifiers:new Set};this._pointerState.set(d,g);this.startCapturingPointer(c.native);this._moveHandle.resume();1<this._pointerState.size&&this.startDragging(a)};b.prototype._createPointerDragData=
function(a,b,d){return{action:a,startEvent:b.startEvent,previousEvent:b.previousEvent,currentEvent:d}};b.prototype._handlePointerMove=function(a){var b=a.data,c=this._pointerState.get(b.native.pointerId);c&&(c.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",c,b),void 0,c.modifiers):d.euclideanDistance(b,c.startEvent)>("touch"===b.native.pointerType?this.movementUntilTouchDrag:this.movementUntilMouseDrag)&&this.startDragging(a),c.previousEvent=b)};b.prototype.startDragging=function(a){var b=
this,c=a.data,d=c.native.pointerId;this._pointerState.forEach(function(f){0!==f.holdTimeout&&(clearTimeout(f.holdTimeout),f.holdTimeout=0);f.isDragging||(f.modifiers=a.modifiers,f.isDragging=!0,d===f.startEvent.native.pointerId?b._pointerDrag.emit(b._createPointerDragData("start",f,c)):b._pointerDrag.emit(b._createPointerDragData("start",f,f.previousEvent),a.timestamp))})};b.prototype._handlePointerLoss=function(a,b){var c=a.data,d=c.native.pointerId,f=this._pointerState.get(d);f&&(0!==f.holdTimeout&&
clearTimeout(f.holdTimeout),f.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",f,"pointer-up"===b?c:f.previousEvent),void 0,f.modifiers):"pointer-up"===b&&f.downButton===c.native.button&&a.timestamp-f.startTimestamp<=this.maximumClickDelay&&!f.holdEmitted&&this._immediateClick.emit(c),this._pointerState.delete(d),this.stopCapturingPointer(c.native),0===this._pointerState.size&&this._moveHandle.pause())};return b}(a.InputHandler);h.PointerClickHoldAndDrag=q})},"esri/views/input/recognizers/SingleAndDoubleClick":function(){define(["require",
"exports","../../../core/tsSupport/extendsHelper","../InputHandler","./support"],function(q,h,e,a,d){Object.defineProperty(h,"__esModule",{value:!0});h.DefaultParameters={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};q=function(a){function b(b,d,g,e){void 0===b&&(b=h.DefaultParameters.maximumDoubleClickDelay);void 0===d&&(d=h.DefaultParameters.maximumDoubleClickDistance);void 0===g&&(g=h.DefaultParameters.maximumDoubleTouchDelay);
void 0===e&&(e=h.DefaultParameters.maximumDoubleTouchDistance);var c=a.call(this,!1)||this;c.maximumDoubleClickDelay=b;c.maximumDoubleClickDistance=d;c.maximumDoubleTouchDelay=g;c.maximumDoubleTouchDistance=e;c._pointerState=new Map;c._click=c.registerOutgoing("click");c._doubleClick=c.registerOutgoing("double-click");c.registerIncoming("immediate-click",c._handleImmediateClick.bind(c));return c}e(b,a);b.prototype.onUninstall=function(){this._pointerState.forEach(function(a){0!==a.doubleClickTimeout&&
(clearTimeout(a.doubleClickTimeout),a.doubleClickTimeout=0)})};b.prototype._pointerId=function(a){a=a.native;return"mouse"===a.pointerType?a.pointerId+":"+a.button:""+a.pointerType};b.prototype._handleImmediateClick=function(a){var b=a.data,c=this._pointerId(b),g=this._pointerState.get(c);if(g){clearTimeout(g.doubleClickTimeout);g.doubleClickTimeout=0;var e="touch"===b.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;d.manhattanDistance(g.event.data,b)>e?(this._doubleClickTimeoutExceeded(c),
this._startClick(a)):(this._doubleClick.emit(b,void 0,g.event.modifiers),this._pointerState.delete(c))}else this._startClick(a)};b.prototype._startClick=function(a){var b=this,c=this._pointerId(a.data);this._pointerState.set(c,{event:a,doubleClickTimeout:setTimeout(function(){return b._doubleClickTimeoutExceeded(c)},"touch"===a.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay)})};b.prototype._doubleClickTimeoutExceeded=function(a){var b=this._pointerState.get(a);this._click.emit(b.event.data,
void 0,b.event.modifiers);b.doubleClickTimeout=0;this._pointerState.delete(a)};return b}(a.InputHandler);h.SingleAndDoubleClick=q})},"esri/views/input/recognizers/VerticalTwoFingerDrag":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../DragEventSeparator","../InputHandler"],function(q,h,e,a,d){Object.defineProperty(h,"__esModule",{value:!0});q=function(b){function d(c,d){void 0===c&&(c=20);void 0===d&&(d=40);var f=b.call(this,!1)||this;f._threshold=c;f._maxDelta=d;
f.state="ready";f.emittedArtificalEnd2=!1;f._vertical=f.registerOutgoing("vertical-two-finger-drag");f._artificalDrag=f.registerOutgoing("drag");f.dragEventSeparator=new a.DragEventSeparator({start:function(a,b){return f.observeStart(a,b)},update:function(a,b,c){return f.observeUpdate(a,b,c)},end:function(a,b){return f.observeEnd(a,b)}});f.registerIncoming("drag",function(a){return f.dragEventSeparator.handle(a)});return f}e(d,b);Object.defineProperty(d.prototype,"failed",{get:function(){return"failed"===
this.state},enumerable:!0,configurable:!0});d.prototype.observeStart=function(a,b){1===a&&this.emittedArtificalEnd2&&(this.emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:b.data.button,buttons:b.data.buttons,pointerType:b.data.pointerType,timestamp:b.data.timestamp,pointers:b.data.pointers,pointer:b.data.pointer,angle:b.data.angle,radius:b.data.radius,center:b.data.center,artifical:!0}),b.stopPropagation());this.state=2===a?"ready":"failed"};d.prototype.observeUpdate=function(a,
b,d){"failed"!==this.state&&2===a&&("active"===this.state?(this._vertical.emit({delta:b.data.center.y-this._thresholdReachedCenter.y,action:"update"}),b.stopPropagation()):this.checkMovementWithinLimits(b.data,d.data)?this.checkVerticalThresholdReached(b.data,d.data)&&(this.state="active",this.emittedArtificalEnd2=!0,this._thresholdReachedCenter=b.data.center,this._artificalDrag.emit({action:"end",button:b.data.button,buttons:b.data.buttons,pointerType:b.data.pointerType,timestamp:b.data.timestamp,
pointers:b.data.pointers,pointer:b.data.pointer,angle:b.data.angle,radius:b.data.radius,center:b.data.center,artifical:!0}),this._vertical.emit({delta:b.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),b.stopPropagation()):this.state="failed")};d.prototype.observeEnd=function(a,b){"active"===this.state&&(this._vertical.emit({delta:b.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this.state="ready",b.stopPropagation())};d.prototype.checkMovementWithinLimits=function(a,b){var c=
-Infinity,d=Infinity,f=-Infinity,g=Infinity;b.pointers.forEach(function(a){c=Math.max(c,a.x);d=Math.min(d,a.x);f=Math.max(f,a.y);g=Math.min(g,a.y)});var e=-Infinity,r=Infinity,t=-Infinity,u=Infinity;a.pointers.forEach(function(a){e=Math.max(e,a.x);r=Math.min(r,a.x);t=Math.max(t,a.y);u=Math.min(u,a.y)});return Math.abs(a.center.x-b.center.x)<this._threshold&&Math.abs(e-r-(c-d))<=this._maxDelta&&Math.abs(t-u-(f-g))<=this._maxDelta};d.prototype.checkVerticalThresholdReached=function(a,b){var c=Math.abs(a.center.y-
b.center.y);a.pointers.forEach(function(a,d){d=b.pointers.get(d);c=Math.min(c,Math.abs(a.y-d.y))});return c>=this._threshold};return d}(d.InputHandler);h.VerticalTwoFingerDrag=q})},"esri/views/input/DragEventSeparator":function(){define(["require","exports"],function(q,h){Object.defineProperty(h,"__esModule",{value:!0});q=function(){function e(a){this.callbacks=a;this.currentCount=0;this.callbacks.condition||(this.callbacks.condition=function(){return!0})}e.prototype.handle=function(a){var d=a.data,
b=d.pointers.size;switch(d.action){case "start":this.currentCount=b;this.emitStart(a);break;case "added":this.emitEnd(this.previousEvent);this.currentCount=b;this.emitStart(a);break;case "update":this.emitUpdate(a);break;case "removed":this.startEvent&&this.emitEnd(this.previousEvent);this.currentCount=b;this.emitStart(a);break;case "end":this.emitEnd(a),this.currentCount=0}this.previousEvent=a};e.prototype.emitStart=function(a){this.startEvent=a;this.callbacks.condition(this.currentCount,a)&&this.callbacks.start(this.currentCount,
a,this.startEvent)};e.prototype.emitUpdate=function(a){this.callbacks.condition(this.currentCount,a)&&this.callbacks.update(this.currentCount,a,this.startEvent)};e.prototype.emitEnd=function(a){this.callbacks.condition(this.currentCount,a)&&this.callbacks.end(this.currentCount,a,this.startEvent);this.startEvent=null};return e}();h.DragEventSeparator=q})},"esri/views/input/handlers/LatestPointerType":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../InputHandler"],
function(q,h,e,a){Object.defineProperty(h,"__esModule",{value:!0});q=function(a){function b(b){var c=a.call(this,!0)||this;c._onChange=b;c._value="mouse";c.registerIncoming("pointer-down",function(a){c._setValue("touch"===a.data.native.pointerType?"touch":"mouse")});c._moveHandler=c.registerIncoming("pointer-move",function(a){c._setValue("touch"===a.data.native.pointerType?"touch":"mouse")});c._moveHandler.pause();return c}e(b,a);b.prototype._setValue=function(a){a!==this._value&&("touch"===a?this._moveHandler.resume():
this._moveHandler.pause(),this._value=a,this._onChange(a))};return b}(a.InputHandler);h.LatestPointerType=q})},"esri/views/input/ViewEvents":function(){define("require exports ../../core/tsSupport/extendsHelper ../../geometry/ScreenPoint ../3d/support/mathUtils ./InputHandler".split(" "),function(q,h,e,a,d,b){function g(a){return!!f[a]}function c(a){for(var b=0;b<a.length;b++)if(!g(a[b]))return!1;return!0}Object.defineProperty(h,"__esModule",{value:!0});var f={click:!0,"double-click":!0,"immediate-click":!0,
hold:!0,drag:!0,"key-down":!0,"key-up":!0,"pointer-down":!0,"pointer-move":!0,"pointer-up":!0,"pointer-drag":!0,"mouse-wheel":!0,"pointer-enter":!0,"pointer-leave":!0},k;(function(a){a[a.Left=0]="Left";a[a.Middle=1]="Middle";a[a.Right=2]="Right"})(k||(k={}));q=function(){function a(a){this.handlers=new Map;this.counter=0;this.handlerCounts=new Map;this.view=a;this.inputManager=null}a.prototype.connect=function(a){var b=this;a&&this.disconnect();this.inputManager=a;this.handlers.forEach(function(a,
c){return b.inputManager.installHandlers(c,[a])})};a.prototype.disconnect=function(){var a=this;this.inputManager&&this.handlers.forEach(function(b,c){return a.inputManager.uninstallHandlers(c)});this.inputManager=null};a.prototype.destroy=function(){this.disconnect();this.handlers.clear();this.view=null};a.prototype.register=function(a,b,d){var f=this,e=Array.isArray(a)?a:a.split(",");if(!c(e))return e.some(g)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),
null;a=Array.isArray(b)?b:[];d=Array.isArray(b)?d:b;var k=this.createUniqueGroupName();b=new n(this.view,e,a,d);this.handlers.set(k,b);for(d=0;d<e.length;d++){a=e[d];var m=this.handlerCounts.get(a)||0;this.handlerCounts.set(a,m+1)}this.inputManager&&this.inputManager.installHandlers(k,[b]);return{remove:function(){return f.removeHandler(k,e)}}};a.prototype.hasHandler=function(a){return!!this.handlerCounts.get(a)};a.prototype.removeHandler=function(a,b){if(this.handlers.has(a)){this.handlers.delete(a);
for(var c=0;c<b.length;c++){var d=b[c],f=this.handlerCounts.get(d);void 0===f?console.error("Trying to remove handler for event that has no handlers registered: ",d):1===f?this.handlerCounts.delete(d):this.handlerCounts.set(d,f-1)}}this.inputManager&&this.inputManager.uninstallHandlers(a)};a.prototype.createUniqueGroupName=function(){this.counter+=1;return"viewEvents_"+this.counter};return a}();h.ViewEvents=q;var n=function(b){function c(a,c,d,f){var g=b.call(this,!0)||this;g.view=a;for(a=0;a<c.length;a++)switch(c[a]){case "click":g.registerIncoming("click",
d,function(a){return f(g.wrapClick(a))});break;case "double-click":g.registerIncoming("double-click",d,function(a){return f(g.wrapDoubleClick(a))});break;case "immediate-click":g.registerIncoming("immediate-click",d,function(a){return f(g.wrapImmediateClick(a))});break;case "hold":g.registerIncoming("hold",d,function(a){return f(g.wrapHold(a))});break;case "drag":g.registerIncoming("drag",d,function(a){(a=g.wrapDrag(a))&&f(a)});break;case "key-down":g.registerIncoming("key-down",d,function(a){return f(g.wrapKeyDown(a))});
break;case "key-up":g.registerIncoming("key-up",d,function(a){return f(g.wrapKeyUp(a))});break;case "pointer-down":g.registerIncoming("pointer-down",d,function(a){return f(g.wrapPointer(a,"pointer-down"))});break;case "pointer-move":g.registerIncoming("pointer-move",d,function(a){return f(g.wrapPointer(a,"pointer-move"))});break;case "pointer-up":g.registerIncoming("pointer-up",d,function(a){return f(g.wrapPointer(a,"pointer-up"))});break;case "pointer-drag":g.registerIncoming("pointer-drag",d,function(a){return f(g.wrapPointerDrag(a))});
break;case "mouse-wheel":g.registerIncoming("mouse-wheel",d,function(a){return f(g.wrapMouseWheel(a))});break;case "pointer-enter":g.registerIncoming("pointer-enter",d,function(a){return f(g.wrapPointer(a,"pointer-enter"))});break;case "pointer-leave":g.registerIncoming("pointer-leave",d,function(a){return f(g.wrapPointer(a,"pointer-leave"))})}return g}e(c,b);c.prototype.wrapClick=function(b){var c=b.data,d=c.x,f=c.y;return{type:"click",pointerType:c.pointerType,button:c.button,buttons:c.buttons,
x:d,y:f,native:c.native,timestamp:b.timestamp,screenPoint:new a(d,f),mapPoint:this.view.toMap(d,f),stopPropagation:function(){return b.stopPropagation()}}};c.prototype.wrapDoubleClick=function(a){var b=a.data,c=b.x,d=b.y;return{type:"double-click",pointerType:b.pointerType,button:b.button,buttons:b.buttons,x:c,y:d,native:b.native,timestamp:a.timestamp,mapPoint:this.view.toMap(c,d),stopPropagation:function(){return a.stopPropagation()}}};c.prototype.wrapImmediateClick=function(a){var b=a.data,c=b.x,
d=b.y;return{type:"immediate-click",pointerType:b.pointerType,button:b.button,buttons:b.buttons,x:c,y:d,native:b.native,timestamp:a.timestamp,mapPoint:this.view.toMap(c,d),stopPropagation:function(){return a.stopPropagation()}}};c.prototype.wrapHold=function(a){var b=a.data,c=b.x,d=b.y;return{type:"hold",pointerType:b.pointerType,button:b.button,buttons:b.buttons,x:c,y:d,native:b.native,timestamp:a.timestamp,mapPoint:this.view.toMap(c,d),stopPropagation:function(){return a.stopPropagation()}}};c.prototype.wrapDrag=
function(a){var b=a.data,c=b.center,f=c.x,c=c.y,g=b.action,e=b.pointerType,k=b.button;"start"===g&&(this.latestDragStart=b);if(this.latestDragStart){var m=b.pointer.native,l=b.buttons,n=a.timestamp,p={x:this.latestDragStart.center.x,y:this.latestDragStart.center.y};"end"===g&&(this.latestDragStart=void 0);return{type:"drag",action:g,x:f,y:c,origin:p,pointerType:e,button:k,buttons:l,radius:b.radius,angle:d.rad2deg(b.angle),native:m,timestamp:n,stopPropagation:function(){return a.stopPropagation()}}}};
c.prototype.wrapKeyDown=function(a){var b=a.data;return{type:"key-down",key:b.key,repeat:b.repeat,native:b.native,timestamp:a.timestamp,stopPropagation:function(){return a.stopPropagation()}}};c.prototype.wrapKeyUp=function(a){var b=a.data;return{type:"key-up",key:b.key,native:b.native,timestamp:a.timestamp,stopPropagation:function(){return a.stopPropagation()}}};c.prototype.wrapPointer=function(a,b){var c=a.data,d=c.native;return{type:b,x:c.x,y:c.y,pointerId:d.pointerId,pointerType:d.pointerType,
button:c.button,buttons:c.buttons,native:d,timestamp:a.timestamp,stopPropagation:function(){return a.stopPropagation()}}};c.prototype.wrapPointerDrag=function(a){var b=a.data.currentEvent,c=a.data.startEvent.native;return{type:"pointer-drag",x:b.x,y:b.y,pointerId:c.pointerId,pointerType:c.pointerType,button:a.data.startEvent.button,buttons:b.buttons,action:a.data.action,origin:{x:a.data.startEvent.x,y:a.data.startEvent.y},native:b.native,timestamp:a.timestamp,stopPropagation:function(){return a.stopPropagation()}}};
c.prototype.wrapMouseWheel=function(a){var b=a.data;return{type:"mouse-wheel",x:b.x,y:b.y,deltaY:b.deltaY,native:b.native,timestamp:a.timestamp,stopPropagation:function(){return a.stopPropagation()}}};return c}(b.InputHandler)})},"esri/views/input/handlers/PreventContextMenu":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../InputHandler"],function(q,h,e,a){Object.defineProperty(h,"__esModule",{value:!0});q=function(a){function b(){var b=a.call(this,!0)||this;b.registerIncoming("context-menu",
function(a){a.data.native.preventDefault()});return b}e(b,a);return b}(a.InputHandler);h.PreventContextMenu=q;h.default=q})},"esri/views/3d/layers/GraphicsView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/promiseUtils ../../../core/accessorSupport/decorators ./graphics/Graphics3DGraphicLikeLayerView ../../layers/GraphicsView".split(" "),function(q,h,e,a,d,b,g,c){return function(c){function f(a){a=c.call(this)||
this;a.graphics3d=null;a.supportsDraping=!0;a.overlayUpdating=!1;a.mockLayerId="__sceneView.graphics-"+Date.now().toString(16);return a}e(f,c);f.prototype.initialize=function(){this.graphics3d=new g({owner:this,layer:{id:this.mockLayerId,uid:this.mockLayerId}});this.graphics3d.setup()};f.prototype.destroy=function(){this.graphics3d&&(this.graphics3d.destroy(),this.graphics3d=null)};Object.defineProperty(f.prototype,"updating",{get:function(){return!(this.graphics3d&&!this.graphics3d.updating&&!this.overlayUpdating)},
enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"drawingOrder",{set:function(a){this.graphics3d.graphicsCore.setDrawingOrder(a);this._set("drawingOrder",a)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"graphics3DGraphics",{get:function(){return this.graphics3d.graphicsCore.graphics3DGraphics},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"graphics3DGraphicsKeys",{get:function(){return this.graphics3d.graphicsCore.graphics3DGraphicsKeys},
enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"symbolUpdateType",{get:function(){return this.graphics3d.graphicsCore.symbolUpdateType},enumerable:!0,configurable:!0});f.prototype.getRenderingInfo=function(a){return{symbol:a.symbol||null}};f.prototype.getGraphicFromGraphicUid=function(a){return this.graphics3d.getGraphicFromGraphicUid(a)};f.prototype.whenGraphicBounds=function(a,b){return this.graphics3d.whenGraphicBounds(a,b)};f.prototype.queryGraphics=function(){return d.resolve(this.loadedGraphics)};
a([b.property({aliasOf:"view.graphics"})],f.prototype,"graphics",void 0);a([b.property({aliasOf:"graphics"})],f.prototype,"loadedGraphics",void 0);a([b.property({readOnly:!0,dependsOn:["graphics3d.updating","overlayUpdating"]})],f.prototype,"updating",null);a([b.property({constructOnly:!0})],f.prototype,"view",void 0);a([b.property()],f.prototype,"graphics3d",void 0);a([b.property({aliasOf:"graphics3d.graphicsCore.hasDraped"})],f.prototype,"hasDraped",void 0);a([b.property({type:Boolean})],f.prototype,
"supportsDraping",void 0);a([b.property({type:Boolean})],f.prototype,"overlayUpdating",void 0);a([b.property()],f.prototype,"drawingOrder",null);return f=a([b.subclass("esri.views.3d.layers.GraphicsView3D")],f)}(b.declared(c))})},"esri/views/3d/layers/graphics/Graphics3DGraphicLikeLayerView":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../layers/Layer ../../../../layers/graphics/dehydratedFeatures ./constants ./Graphics3DCore ./Graphics3DElevationAlignment ./Graphics3DScaleVisibility ./Graphics3DSpatialIndex ./graphicUtils".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u,x){return function(b){function h(a){a=b.call(this)||this;a.graphicsCore=null;a.elevationAlignment=new r;a.handles=new g;a.suspendResumeExtent=null;return a}e(h,b);h.prototype.normalizeCtorArgs=function(a){var b=null;a.scaleVisibilityEnabled&&(b=new t);var c=new m({owner:a.owner,layer:a.layer,basemapTerrain:a.owner.view.basemapTerrain,asyncUpdates:!1});return d({},a,{graphicsCore:c,scaleVisibility:b})};h.prototype.initialize=function(){var a=this;this._set("spatialIndex",
new u({spatialReference:this.owner.view.spatialReference}));this.scaleVisibility&&"minScale"in this.layer&&this.handles.add(this.layer.watch(["minScale","maxScale"],function(){return a.scaleVisibility.layerMinMaxScaleChangeHandler()}));this.idleClients=[this.scaleVisibility,this.elevationAlignment,this.graphicsCore]};h.prototype.setup=function(){var a=this;this.elevationAlignment.setup(this.owner,function(b,c,d){return a.spatialIndex.queryGraphicUIDsInExtent(b,c,d)},this.graphicsCore,this.view.elevationProvider);
this.scaleVisibility&&"minScale"in this.layer&&this.scaleVisibility.setup(this.owner,this.layer,function(b,c,d){return a.spatialIndex.queryGraphicUIDsInExtent(b,c,d)},this.graphicsCore,this.owner.view.basemapTerrain);this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,spatialIndex:this.spatialIndex,scaleVisibility:this.scaleVisibility});this.handles.add(this.view.watch("clippingArea",function(){return a.updateClippingExtent()}));this.updateClippingExtent();this.setupSuspendResumeExtent();
this.handles.add(this.view.resourceController.registerIdleFrameWorker({needsUpdate:function(){return a.needsIdleUpdate()},idleFrame:function(b){return a.idleUpdate(b)}}))};h.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.elevationAlignment&&(this.elevationAlignment.destroy(),this._set("elevationAlignment",null));this.scaleVisibility&&(this.scaleVisibility.destroy(),this._set("scaleVisibility",null));this.graphicsCore&&(this.graphicsCore.destroy(),this._set("graphicsCore",
null));this.spatialIndex&&(this.spatialIndex.destroy(),this._set("spatialIndex",null))};Object.defineProperty(h.prototype,"suspended",{get:function(){return!(!this.scaleVisibility||!this.scaleVisibility.suspended)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"updating",{get:function(){return!!(this.graphicsCore&&this.graphicsCore.updating||this.scaleVisibility&&this.scaleVisibility.updating)},enumerable:!0,configurable:!0});h.prototype.getGraphicFromGraphicUid=function(a){var b=
this,d=null;this.owner.loadedGraphics&&this.owner.loadedGraphics.some(function(c){return c.uid===a?(d=l.hydrateGraphic(c,b.layer instanceof n?b.layer:null),!0):!1});return c.create(function(a,b){null!==d?a(d):b()})};h.prototype.whenGraphicBounds=function(a,b){return this.spatialIndex?this.graphicsCore?this.graphicsCore.whenGraphicBounds(a,b):c.reject():c.reject()};h.prototype.needsIdleUpdate=function(){for(var a=0,b=this.idleClients;a<b.length;a++){var c=b[a];if(c&&c.needsIdleUpdate())return!0}return!1};
h.prototype.idleUpdate=function(a){for(var b=0,c=this.idleClients;b<c.length;b++){var d=c[b];d&&d.idleUpdate(a)}};h.prototype.updateClippingExtent=function(){this.graphicsCore.setClippingExtent(this.view.clippingArea,this.view.spatialReference)&&this.graphicsCore.recreateAllGraphics()};h.prototype.setupSuspendResumeExtent=function(){var a=this;this.scaleVisibility&&f.init(this.graphicsCore,"computedExtent",function(b){a.suspendResumeExtent=x.enlargeExtent(b,a.suspendResumeExtent,p.SUSPEND_RESUME_EXTENT_OPTIMISM);
a.scaleVisibility.setExtent(a.suspendResumeExtent)},!0)};a([k.property({constructOnly:!0})],h.prototype,"owner",void 0);a([k.property({constructOnly:!0})],h.prototype,"layer",void 0);a([k.property({readOnly:!0,aliasOf:"owner.view"})],h.prototype,"view",void 0);a([k.property({constructOnly:!0})],h.prototype,"graphicsCore",void 0);a([k.property({readOnly:!0})],h.prototype,"spatialIndex",void 0);a([k.property({constructOnly:!0})],h.prototype,"scaleVisibility",void 0);a([k.property({readOnly:!0})],h.prototype,
"elevationAlignment",void 0);a([k.property({readOnly:!0,dependsOn:["scaleVisibility.suspended"]})],h.prototype,"suspended",null);a([k.property({readOnly:!0,dependsOn:["graphicsCore.updating","scaleVisibility.updating"]})],h.prototype,"updating",null);return h=a([k.subclass("esri.views.3d.layers.graphics.Graphics3DGraphicLikeLayerView")],h)}(k.declared(b))})},"esri/views/3d/layers/graphics/constants":function(){define(["require","exports"],function(q,h){Object.defineProperty(h,"__esModule",{value:!0});
h.defaultIconElevationOffset=1;h.SUSPEND_RESUME_EXTENT_OPTIMISM=1.2})},"esri/views/3d/layers/graphics/Graphics3DCore":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper dojo/Deferred ../../../../geometry ../../../../renderers ../../../../symbols ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/Error ../../../../core/Handles ../../../../core/iteratorUtils ../../../../core/Logger ../../../../core/ObjectPool ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../layers/Layer ../../../../layers/graphics/dehydratedFeatures ../../../../renderers/support/diffUtils ../../../../renderers/support/rendererConversion ../../../../symbols/support/symbolConversion ../../../../symbols/support/unitConversionUtils ./ElevationQuery ./featureExpressionInfoUtils ./Graphics3DGraphic ./Graphics3DOwner ./Graphics3DSymbolFactory ./Graphics3DWebStyleSymbol ./graphicUtils ../../lib/glMatrix ../../support/mathUtils ../../support/projectionUtils ../../support/PropertiesPool ../../webgl-engine/Stage ../../webgl-engine/lib/FloatingBoxLocalOriginFactory ../../webgl-engine/lib/Layer".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u,x,v,A,y,C,B,D,E,J,F,M,H,I,K,O,P,L,U,N,S,aa,V,T,Q,G,X){function Z(a){(a=a.elevationInfo&&a.elevationInfo.unit)&&!H.supportsUnit(a)&&da.warn("elevationInfo.unit","'"+a+"' is not a valid unit")}q=S.vec3d;var ea=new c.Point,fa=q.create(),R=C.create(),da=t.getLogger("esri.views.3d.layers.graphics.Graphics3DCore");n=function(n){function u(a){a=n.call(this)||this;a.propertiesPool=new T.PropertiesPool({computedExtent:c.Extent},a);a.computedExtent=null;a.symbolCreationContext=
new P.Graphics3DSymbolCreationContext;a.graphics={};a.stageLayer=null;a.stage=null;a.graphicsDrapedUids={};a.graphicsBySymbol={};a.graphicsKeys=[];a.symbols={};a.graphicsWithoutSymbol={};a.graphicsWaitingForSymbol=new Set;a.lastFastUpdate=null;a.tilingSchemeHandle=null;a.handles=new m;a.viewSR=null;a.elevationAlignment=null;a.scaleVisibility=null;a.spatialIndex=null;a.labeling=null;a.highlights=null;a.elevationQueryService=null;a.elevationQueryView=null;a.sharedSymbolResourcesOwnerHandle=null;a.whenGraphics3DGraphicRequests=
{};a.pendingUpdates=new Map;a.pendingUpdatesPool=new x({initialSize:2E3,allocator:function(){return{add:null,remove:null}},deallocator:function(a){a.add=null;a.remove=null}});a.symbolWarningLogged=!1;a.geometryWarningLogged=!1;a.asyncUpdates=!1;a.elevationFeatureExpressionEnabled=!0;a.owner=null;a.layer=null;a.hasDraped=!1;a.minTotalNumberOfFeatures=2E3;a.numberOfGraphics=0;a._visible=void 0;return a}e(u,n);t=u;Object.defineProperty(u.prototype,"updating",{get:function(){return!!(0<this.graphicsWaitingForSymbol.size||
this.needsIdleUpdate()||this.elevationAlignment&&this.elevationAlignment.updating||this.scaleVisibility&&this.scaleVisibility.updating)},enumerable:!0,configurable:!0});Object.defineProperty(u.prototype,"maxNumberOfFeatures",{get:function(){return aa.clamp(Math.ceil((this.maxTotalNumberOfVertices||1)/this.maxSymbolNumberOfVertices),this.minTotalNumberOfFeatures,this.maxTotalNumberOfFeatures||1)},enumerable:!0,configurable:!0});Object.defineProperty(u.prototype,"maxSymbolNumberOfVertices",{get:function(){var a=
0,b;for(b in this.symbols){var c=this.symbols[b];c&&(a=Math.max(a,c.numberOfVertices))}return 0===a?this._get("maxSymbolNumberOfVertices")||1:a},enumerable:!0,configurable:!0});u.prototype.initialize=function(){this.viewSR=this.owner.view.spatialReference};u.prototype.setup=function(a){var b=this;this._set("elevationAlignment",a.elevationAlignment);this._set("scaleVisibility",a.scaleVisibility);this._set("spatialIndex",a.spatialIndex);this._set("labeling",a.labeling);this._set("highlights",a.highlights);
var c=this.owner.view;this.elevationQueryService=new I.ElevationQuery(this.viewSR,function(){return c.map.ground},{maximumAutoTileRequests:4});this.elevationQueryView=new I.ElevationQueryView(this.viewSR,c.basemapTerrain);this.initializeStage(c,this.layer.uid);this.symbolCreationContext.sharedResources=c.sharedSymbolResources;this.sharedSymbolResourcesOwnerHandle=c.sharedSymbolResources.addGraphicsOwner(this.owner);this.symbolCreationContext.renderer=this.layer.renderer;this.symbolCreationContext.stage=
this.stage;this.symbolCreationContext.streamDataSupplier=c.sharedSymbolResources.streamDataSupplier;this.symbolCreationContext.renderSpatialReference=c.renderSpatialReference;this.symbolCreationContext.renderCoordsHelper=c.renderCoordsHelper;this.symbolCreationContext.layer=this.layer;this.symbolCreationContext.layerView=this.owner;this.symbolCreationContext.layerOrder=0;this.symbolCreationContext.localOriginFactory=t.createLocalOriginFactory();this.symbolCreationContext.elevationProvider=c.elevationProvider;
Z(this.layer);a=K.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=K.createContext(a,this.viewSR,da);c.deconflictor.addGraphicsOwner(this);this.symbolCreationContext.screenSizePerspectiveEnabled=c.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled;this.tilingSchemeHandle=A.when(this.basemapTerrain,"tilingScheme",function(a){a.spatialReference.equals(b.symbolCreationContext.overlaySR)||
(b.symbolCreationContext.overlaySR=b.basemapTerrain.spatialReference,b.recreateAllGraphics())});this.handles.add(this.owner.watch("suspended",function(){return b.updateLayerVisibility()}));this.handles.add(this.owner.watch("layer"in this.owner?["layer.screenSizePerspectiveEnabled,view.screenSizePerspectiveEnabled"]:"view.screenSizePerspectiveEnabled",function(){var a=c.screenSizePerspectiveEnabled&&b.layer.screenSizePerspectiveEnabled;a!==b.symbolCreationContext.screenSizePerspectiveEnabled&&(b.symbolCreationContext.screenSizePerspectiveEnabled=
a,b.recreateAllGraphics())}));this.handles.add(A.on(this.owner,"loadedGraphics","change",function(a){return b.graphicsCollectionChanged(a)},function(){b.clearSymbolsAndGraphics();b.graphicsCollectionChanged({added:b.owner.loadedGraphics.toArray(),removed:[]})}));this.validateRenderer(this.layer.renderer)};u.prototype.destroy=function(){this.owner.view.deconflictor.removeGraphicsOwner(this);this.owner.view.labeler.removeGraphicsOwner(this);this.clear();this.stage&&(this.stage.removeFromViewContent([this.stageLayer.id]),
this.stage.remove(Q.ModelContentType.LAYER,this.stageLayer.id),this.stage=this.stageLayer=null);this.tilingSchemeHandle&&(this.tilingSchemeHandle.remove(),this.tilingSchemeHandle=null);this.handles.destroy();this.viewSR=this.handles=null;this._set("owner",null);for(var a in this.whenGraphics3DGraphicRequests)this.whenGraphics3DGraphicRequests[a].reject(new p("graphic:layer-destroyed","Layer has been destroyed"));this.whenGraphics3DGraphicRequests=null;this.sharedSymbolResourcesOwnerHandle&&(this.sharedSymbolResourcesOwnerHandle.remove(),
this.sharedSymbolResourcesOwnerHandle=null);this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null);this.pendingUpdatesPool=null};u.prototype.clear=function(){for(var a in this.graphics)this.graphics[a].destroy();this.spatialIndex&&this.spatialIndex.clear();this.graphics={};this.graphicsKeys=null;this.numberOfGraphics=0;this.updateLayerVisibility();for(var b in this.symbols)(a=this.symbols[b])&&a.destroy();this.symbols={};this.graphicsBySymbol={};this.graphicsWithoutSymbol={};
this.graphicsWaitingForSymbol.clear();this.pendingUpdates.clear();this.pendingUpdatesPool.clear();this._set("hasDraped",!1);this.notifyChange("updating")};u.prototype.initializeStage=function(a,b){this.stage=a._stage;this.stageLayer=new X(b,{isPickable:!this.owner.suspended},b);this.stage.add(Q.ModelContentType.LAYER,this.stageLayer);this.stage.addToViewContent([this.stageLayer.id])};u.prototype.setDrawingOrder=function(a){this.symbolCreationContext.layerOrder=a;var b=new Set,c;for(c in this.symbols){var d=
this.symbols[c];d&&d.setDrawOrder(a,b)}0<b.size&&this.stage.getDrapedTextureRenderer().updateRenderOrder(b)};u.prototype.updateLayerVisibility=function(){var a=this.numberOfGraphics>this.maxNumberOfFeatures*ja,a=!this.owner.suspended&&!a;a!==this._visible&&((this._visible=a)?(this.stageLayer.isPickable=!0,this.updateAllGraphicsVisibility()):(this.stageLayer.isPickable=!1,this.hideAllGraphics()))};Object.defineProperty(u.prototype,"graphics3DGraphics",{get:function(){return this.graphics},enumerable:!0,
configurable:!0});u.prototype.getGraphics3DGraphicById=function(a){return this.graphics[a]};Object.defineProperty(u.prototype,"graphics3DGraphicsKeys",{get:function(){null===this.graphicsKeys&&(this.graphicsKeys=Object.keys(this.graphics));return this.graphicsKeys},enumerable:!0,configurable:!0});Object.defineProperty(u.prototype,"labelsEnabled",{get:function(){return!(!this.labeling||!this.labeling.layerLabelsEnabled())},enumerable:!0,configurable:!0});u.prototype.updateLabelingInfo=function(a){return this.labeling&&
this.labeling.labelingInfoChange(a)};u.prototype.updateVisibilityInfo=function(){return this.labeling&&this.labeling.visibilityInfoChange()};Object.defineProperty(u.prototype,"symbolUpdateType",{get:function(){if(0<this.pendingUpdates.size)return"unknown";var a=0,b=0,c;for(c in this.symbols){var d=this.symbols[c];if(d){d=d.getFastUpdateStatus();if(0<d.loading)return"unknown";this.graphicsBySymbol[c]&&(b+=d.fast,a+=d.slow)}}return 0<=b&&0===a?"fast":0<=a&&0===b?"slow":"mixed"},enumerable:!0,configurable:!0});
u.prototype.needsIdleUpdate=function(){return 0<this.pendingUpdates.size?!0:!!this.lastFastUpdate&&500<performance.now()-this.lastFastUpdate};u.prototype.idleUpdate=function(a){var b=this.needsIdleUpdate();this._applyPendingUpdates(a);!a.done()&&this.lastFastUpdate&&(this.lastFastUpdate=null);a=this.needsIdleUpdate();b!==a&&this.notifyChange("updating")};u.prototype.whenGraphics3DGraphic=function(a){var b=this.graphics[a.uid];if(b)return v.resolve(b);b=this.whenGraphics3DGraphicRequests[a.uid];b||
(b=new g,this.whenGraphics3DGraphicRequests[a.uid]=b);return b.promise};u.prototype.boundsForGraphics3DGraphic=function(a,c){return b(this,void 0,void 0,function(){var b,f,g,e,k,l,m,n,p,u,r;return d(this,function(d){switch(d.label){case 0:return b=this.owner.view.spatialReference,f=this.owner.view.renderSpatialReference,g=this.owner.view.basemapTerrain.spatialReference,e=function(a,c,d){return V.bufferToBuffer(a,f,c,a,b,c,d)},k=function(a,c,d){return V.bufferToBuffer(a,g,c,a,b,c,d)},l=c&&c.useViewElevation?
this.elevationQueryView:this.elevationQueryService,m=null,l&&(m={service:c&&c.useViewElevation?this.elevationQueryView:this.elevationQueryService,minDemResolution:c&&c.minDemResolution,minDemResolutionForPoints:this.owner.view.resolution}),[4,a.getProjectedBoundingBox(e,k,m)];case 1:n=d.sent();if(!n)return[2,null];p=n.boundingBox;n.requiresDrapedElevation&&(u=this.symbolCreationContext.elevationProvider)&&(C.center(p,fa),ea.x=fa[0],ea.y=fa[1],ea.z=void 0,ea.spatialReference=b,r=u.getElevation(ea)||
0,p[2]=Math.min(p[2],r),p[5]=Math.max(p[5],r));return[2,{boundingBox:p,screenSpaceObjects:n.screenSpaceObjects}]}})})};u.prototype.whenGraphicBounds=function(a,b){var c=this;return A.whenOnce(this.owner,"loadedGraphics").then(function(){var b=c.owner.layer&&c.owner.layer.objectIdField,d=c.owner.loadedGraphics.find(function(c){return c===a?!0:b&&c.attributes&&a.attributes&&c.attributes[b]===a.attributes[b]});if(d)return c.whenGraphics3DGraphic(d);throw new p("internal:graphic-not-part-of-view","Graphic is not part of this view");
}).then(function(a){return c.boundsForGraphics3DGraphic(a,b)})};u.prototype.graphicsCollectionChanged=function(a){this.add(a.added);this.remove(a.removed)};u.prototype.graphicUpdateHandler=function(a){if("visible"===a.property){var b=this.graphics[a.graphic.uid];b&&b.setVisibilityFlag(0,a.newValue)&&this.labeling&&(this.lastFastUpdate=performance.now(),this.owner.view.deconflictor.setDirty(),this.owner.view.labeler.setDirty())}};u.prototype.beginGraphicUpdate=function(a,b){this.graphicsWaitingForSymbol.add(a.uid);
1===this.graphicsWaitingForSymbol.size&&this.notifyChange("updating");this._get("symbolsUpdating")||this._set("symbolsUpdating",!0)};u.prototype.endGraphicUpdate=function(a){a&&(this.graphicsWaitingForSymbol.delete(a.uid),0===this.graphicsWaitingForSymbol.size&&this.notifyChange("updating"));this._get("symbolsUpdating")&&0===this.graphicsWaitingForSymbol.size&&(this.owner.view.flushDisplayModifications(),this._set("symbolsUpdating",!1))};u.prototype.expandComputedExtent=function(a){var b=a.spatialReference;
E.computeAABB(a,R);a=this.viewSR;var c=t.tmpVec;!b.equals(a)&&V.xyzToVector(R[0],R[1],0,b,c,a)&&(R[0]=c[0],R[1]=c[1],V.xyzToVector(R[3],R[4],0,b,c,a),R[3]=c[0],R[4]=c[1]);if(aa.isFinite(R[0])&&aa.isFinite(R[3])&&aa.isFinite(R[1])&&aa.isFinite(R[4])){var b=this.computedExtent,c=null,d=aa.isFinite(R[2])&&aa.isFinite(R[5]),f=d&&(!b||null==b.zmin||R[2]<b.zmin),d=d&&(!b||null==b.zmax||R[5]>b.zmax);if(b){if(R[0]<b.xmin||R[1]<b.ymin||R[3]>b.xmax||R[4]>b.ymax||f||d)c=this.propertiesPool.get("computedExtent"),
c.xmin=Math.min(R[0],b.xmin),c.ymin=Math.min(R[1],b.ymin),c.xmax=Math.max(R[3],b.xmax),c.ymax=Math.max(R[4],b.ymax),c.spatialReference=a}else c=this.propertiesPool.get("computedExtent"),c.xmin=R[0],c.ymin=R[1],c.xmax=R[3],c.ymax=R[4],c.spatialReference=a;c&&(f&&(c.zmin=R[2]),d&&(c.zmax=R[5]),this._set("computedExtent",c))}};u.prototype.updateHasDraped=function(){var a=!1,b;for(b in this.graphicsDrapedUids)if(this.graphicsDrapedUids.hasOwnProperty(b)){a=!0;break}this._set("hasDraped",a)};u.prototype.elevationInfoChange=
function(){Z(this.layer);var a=K.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=K.createContext(a,this.viewSR,da);this.labeling&&this.labeling.elevationInfoChange();this.layer.renderer!==this.symbolCreationContext.renderer&&this.rendererChange(this.layer.renderer);for(var b in this.graphicsBySymbol){var c=this.symbols[b],a=this.graphicsBySymbol[b];if(c&&c.layerPropertyChanged("elevationInfo",a))for(var d in a)for(var f=
a[d],c=f.graphic,f=f._labelGraphics,g=0;g<f.length;g++){var e=f[g];e.graphics3DSymbolLayer.updateGraphicElevationContext(c,e)}else this._recreateSymbol(b)}this.elevationAlignment&&this.elevationAlignment.elevationInfoChange()};u.prototype.clearSymbolsAndGraphics=function(){this.clear();this.elevationAlignment&&this.elevationAlignment.clear();this.labeling&&this.labeling.clear();this.stageLayer&&this.stageLayer.invalidateSpatialQueryAccelerator()};u.prototype.recreateAllGraphics=function(){this.clearSymbolsAndGraphics();
this._set("computedExtent",null);this.symbolCreationContext.screenSizePerspectiveEnabled=this.owner.view.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled;this.owner.loadedGraphics&&this.owner.view.basemapTerrain.tilingScheme&&this.add(this.owner.loadedGraphics.toArray())};u.prototype._recreateSymbol=function(a){var b=this.graphicsBySymbol[a],c=[],d=[],f;for(f in b){var g=b[f];g.isDraped()&&delete this.graphicsDrapedUids[f];this.spatialIndex&&c.push(g);d.push(g.graphic);g.destroy();
this.removeGraphics3DGraphic(f);this.updateLayerVisibility()}0<c.length&&this.spatialIndex.removeMany(c);this.graphicsBySymbol[a]={};(b=this.symbols[a])&&b.destroy();delete this.symbols[a];this.updateHasDraped();this.add(d)};u.prototype.add=function(a){this.owner.view.basemapTerrain&&this.owner.view.basemapTerrain.tilingScheme?(this.asyncUpdates?this._addDelayed(a):this._addImmediate(a),this.notifyChange("updating")):da.error("#add()","Cannot add graphics before terrain surface has been initialized")};
u.prototype._addImmediate=function(a){var b=this;this.symbolWarningLogged=this.geometryWarningLogged=!1;ba.clear();for(var c=0;c<a.length;c++)this._startAddGraphic(a[c],ba);ba.forEach(function(a){return b._finishAddGraphics(a)});ba.clear();this.updateHasDraped();this.owner.view.deconflictor.setDirty();this.owner.view.labeler.setDirty()};u.prototype._addDelayed=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=c.uid,f=this.pendingUpdates.get(d);f?f.add=c:(f=this.pendingUpdatesPool.pushNew(),f.add=
c,this.pendingUpdates.set(d,f))}};u.prototype.remove=function(a){this.asyncUpdates?this._removeDelayed(a):this._removeImmediate(a);this.notifyChange("updating")};u.prototype._removeImmediate=function(a){for(var b=[],c=0;c<a.length;c++){var d=this._removeGraphic(a[c]);this.spatialIndex&&d&&b.push(d)}0<b.length&&this.spatialIndex.removeMany(b);this.updateHasDraped();this.owner.view.deconflictor.setDirty();this.owner.view.labeler.setDirty()};u.prototype._removeDelayed=function(a){for(var b=0;b<a.length;b++){var c=
a[b],d=c.uid,f=this.pendingUpdates.get(d);f?f.add&&(f.remove?f.add=null:this.pendingUpdates.delete(d)):(f=this.pendingUpdatesPool.pushNew(),f.remove=c,this.pendingUpdates.set(d,f))}0===this.pendingUpdates.size&&this.pendingUpdatesPool.clear()};u.prototype._applyPendingUpdates=function(a){var b=this;if(!a.done()){this.symbolWarningLogged=this.geometryWarningLogged=!1;var c=[],d=0;ba.clear();r.forEachUntilMap(this.pendingUpdates,function(f,g){if(a.done())return!1;if(f.remove){var e=b._removeGraphic(f.remove);
b.spatialIndex&&e&&c.push(e)}f.add&&b._startAddGraphic(f.add,ba)&&d++;b.pendingUpdates.delete(g);1E3<d&&(ba.forEach(function(a){return b._finishAddGraphics(a)}),ba.clear(),d=0)});ba.forEach(function(a){return b._finishAddGraphics(a)});ba.clear();0<c.length&&this.spatialIndex.removeMany(c);0===this.pendingUpdates.size&&this.pendingUpdatesPool.clear();this.updateHasDraped();this.owner.view.deconflictor.setDirty();this.owner.view.labeler.setDirty()}};u.prototype._startAddGraphic=function(a,b){this.graphicsWithoutSymbol[a.uid]=
a;var c=a.geometry;if(!c)return this.geometryWarningLogged||(this.geometryWarningLogged=!0,da.warn("Graphic in layer "+this.layer.id+" has no geometry and will not render")),!1;var d=this.owner.getRenderingInfo&&this.owner.getRenderingInfo(a);if(!d||!d.symbol)return this.symbolWarningLogged||(this.symbolWarningLogged=!0,da.warn("Graphic in layer "+this.layer.id+" has no symbol and will not render")),!1;var f=this.getOrCreateGraphics3DSymbol(d.symbol,d.renderer);if(!f)return!1;d={graphic:a,renderingInfo:d,
layer:this.layer};this.expandComputedExtent(c);this.beginGraphicUpdate(a,f);a=f.symbol.id;(c=b.get(a))?c.graphics.push(d):(c=ga.acquire(),c.clear(),c.push(d),b.set(a,{asyncSymbol:f,graphics:c}));return!0};u.prototype._finishAddGraphics=function(a){var b=this;a.asyncSymbol.then(function(){ca.clear();for(var c=0;c<a.graphics.length;c++){var d=a.graphics.data[c],f=d.graphic;b.graphicsWaitingForSymbol.has(f.uid)&&(d=b.createGraphics3DGraphic(a.asyncSymbol,d),b.spatialIndex&&d&&ca.push(d));b.endGraphicUpdate(f)}0<
ca.length&&b.spatialIndex.addMany(ca.data,ca.length);ca.clear();a.graphics.clear();ga.release(a.graphics);b.labeling&&(b.lastFastUpdate=performance.now(),b.owner.view.labeler.setDirty())},function(){for(var c=0;c<a.graphics.length;c++)b.endGraphicUpdate(a.graphics.data[c].graphic);a.graphics.clear();ga.release(a.graphics)})};u.prototype._removeGraphic=function(a){a=a.uid;var b=this.graphics[a];if(b){b.isDraped()&&delete this.graphicsDrapedUids[a];var c=b.graphics3DSymbol.symbol.id;b.destroy();delete this.graphicsBySymbol[c][a];
delete this.graphicsWithoutSymbol[a];this.removeGraphics3DGraphic(a);this.labeling&&this.labeling.removeGraphic(b)}else this.graphicsWaitingForSymbol.delete(a);return b};u.prototype.hasLabelingContext=function(a){if(a instanceof k.LabelSymbol3D||a instanceof k.TextSymbol){var b=this.symbolCreationContext.layer;return b.labelingInfo?b.labelingInfo.some(function(b){return b.symbol===a}):!1}return!1};u.prototype.hasValidSymbolCreationContext=function(a){return a instanceof k.LabelSymbol3D&&!this.hasLabelingContext(a)?
(da.error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),!1):!0};u.prototype.createGraphics3DSymbol=function(a,b){var c=this;if(!this.hasValidSymbolCreationContext(a))return null;a=M.to3D(a,!0,!1,this.hasLabelingContext(a));if(a.symbol){var d=void 0;b&&b.backgroundFillSymbol&&(b=M.to3D(b.backgroundFillSymbol,!1,!0),b.symbol&&(d=b.symbol.symbolLayers));b=L.make(a.symbol,this.symbolCreationContext,d);b.then(function(){c.notifyChange("maxSymbolNumberOfVertices")});
return b}a.error&&da.error(a.error.message);return null};u.prototype.getOrCreateGraphics3DSymbol=function(a,b){var c=this,d=this.symbols[a.id];void 0===d&&(d=a instanceof k.WebStyleSymbol?new U(a,function(a){return c.createGraphics3DSymbol(a,b)}):this.createGraphics3DSymbol(a,b),this.symbols[a.id]=d);return d};u.prototype.addGraphics3DGraphic=function(a){this.graphics[a.graphic.uid]=a;this.graphicsKeys=null;this.numberOfGraphics++;this.updateLayerVisibility()};u.prototype.removeGraphics3DGraphic=
function(a){delete this.graphics3DGraphics[a];this.graphicsKeys=null;this.numberOfGraphics--;this.updateLayerVisibility()};u.prototype.createGraphics3DGraphic=function(a,b){var c=b.graphic;delete this.graphicsWithoutSymbol[c.uid];if(!this.symbols[a.symbol.id])this.add([c]);else if(!this.graphics[c.uid]){b=a.createGraphics3DGraphic(b);a=a.symbol.id;this.addGraphics3DGraphic(b);this.graphicsBySymbol[a]||(this.graphicsBySymbol[a]={});this.graphicsBySymbol[a][c.uid]=b;b.initialize(this.stageLayer,this.stage);
b.isDraped()&&(this.graphicsDrapedUids[c.uid]=!0,this._set("hasDraped",!0));b.centroid=null;"point"!==c.geometry.type&&b instanceof O&&(b.centroid=N.computeCentroid(c.geometry),b.centroid&&N.convertPointSR(b.centroid,this.viewSR));a=this.scaleVisibility&&this.scaleVisibility.scaleRangeActive();this.labeling&&this.labeling.addGraphic(b);a&&this.scaleVisibility.updateGraphicScaleVisibility(b);b.setVisibilityFlag(0,!!c.visible&&!this.owner.suspended);this.owner.view.deconflictor.setInitialIconVisibilityFlag(this.layer,
b);if(a=this.whenGraphics3DGraphicRequests[c.uid])delete this.whenGraphics3DGraphicRequests[c.uid],a.resolve(b);this.highlights&&this.highlights.graphicCreated(b);return b}};u.prototype.rendererChange=function(a){var b=this.symbolCreationContext.renderer;if(a!==b){this.validateRenderer(a);var c=J.diff(b,a);this.updateUnchangedSymbolMappings(c,a,b);this.symbolCreationContext.renderer=a;c&&("complete"===c.type?this.recreateAllGraphics():"partial"===c.type&&(this.applyRendererDiff(c,a,b)?this.volatileGraphicsUpdated():
this.recreateAllGraphics()))}};u.prototype.diffHasSymbolChange=function(a){for(var b in a.diff)switch(b){case "visualVariables":case "defaultSymbol":case "uniqueValueInfos":break;case "authoringInfo":case "fieldDelimiter":delete a.diff[b];break;default:return!0}return!1};u.prototype.applySymbolSetDiff=function(a,b,c,d){a=a||[];b=b||[];d=[];for(var f=0;f<b.length;f++){var g=b[f],e=this.graphicsBySymbol[g.id],k;for(k in e){var l=e[k],m=l.graphic,n=this.layer instanceof D?this.layer:null;if(g!==c.defaultSymbol||
c.getSymbol(E.hydrateGraphic(m,n))!==c.defaultSymbol)l.isDraped()&&delete this.graphicsDrapedUids[k],a.length||c.defaultSymbol?d.push(m):this.graphicsWithoutSymbol[k]=m,l.destroy(),this.highlights&&this.highlights.graphicDeleted(this.graphics[k]),delete e[k],this.removeGraphics3DGraphic(k),this.updateLayerVisibility()}if(void 0===e||0===Object.keys(e).length)delete this.graphicsBySymbol[g.id],(e=this.symbols[g.id])&&e.destroy(),delete this.symbols[g.id],this.notifyChange("maxSymbolNumberOfVertices")}if(a.length||
d.length){for(k in this.graphicsWithoutSymbol)d.push(this.graphicsWithoutSymbol[k]);this.graphicsWithoutSymbol={};this.add(d)}this.updateHasDraped();this.owner.view.deconflictor.setDirty();this.owner.view.labeler.setDirty()};u.prototype.applyUniqueValueRendererDiff=function(a,b,c){var d=a.diff.defaultSymbol,f=a.diff.uniqueValueInfos;if(d||f){var g=f?f.added.map(function(a){return a.symbol}):[],e=f?f.removed.map(function(a){return a.symbol}):[];if(f)for(var k=0;k<f.changed.length;k++)g.push(f.changed[k].newValue.symbol),
e.push(f.changed[k].oldValue.symbol);d?(c.defaultSymbol&&e.push(c.defaultSymbol),b.defaultSymbol&&g.push(b.defaultSymbol)):c.defaultSymbol&&g.length&&e.push(b.defaultSymbol);this.applySymbolSetDiff(g,e,b,c);delete a.diff.defaultSymbol;delete a.diff.uniqueValueInfos;return!0}return!1};u.prototype.calculateUnchangedSymbolMapping=function(a,b,c){if(b instanceof f.UniqueValueRenderer&&c instanceof f.UniqueValueRenderer)if(!a){if(c&&c.defaultSymbol)return[{oldId:c.defaultSymbol.id,newId:b.defaultSymbol.id}]}else if("partial"===
a.type){var d=a.diff;a=d.defaultSymbol;var d=d.uniqueValueInfos,g=void 0,g=d?d.unchanged.map(function(a){return{oldId:a.oldValue.symbol.id,newId:a.newValue.symbol.id}}):c.uniqueValueInfos.map(function(a,c){return{oldId:a.symbol.id,newId:b.uniqueValueInfos[c].symbol.id}});!a&&c.defaultSymbol&&g.push({oldId:c.defaultSymbol.id,newId:b.defaultSymbol.id});return g}return[]};u.prototype.updateUnchangedSymbolMappings=function(a,b,c){var d=0;for(a=this.calculateUnchangedSymbolMapping(a,b,c);d<a.length;d++)if(c=
a[d],b=c.oldId,c=c.newId,b&&b!==c){var f=this.graphicsBySymbol[b];delete this.graphicsBySymbol[b];void 0!==f&&(this.graphicsBySymbol[c]=f);f=this.symbols[b];delete this.symbols[b];void 0!==f&&(this.symbols[c]=f,f.symbol.id=c)}};u.prototype.applyRendererDiff=function(a,b,c){if(this.diffHasSymbolChange(a))return!1;if(b instanceof f.UniqueValueRenderer&&c instanceof f.UniqueValueRenderer&&this.applyUniqueValueRendererDiff(a,b,c)&&0===Object.keys(a.diff).length)return!0;for(var d in this.graphicsBySymbol)if((c=
this.symbols[d])&&!c.applyRendererDiff(a,b,this.graphicsBySymbol[d]))return!1;return!0};u.prototype.opacityChange=function(){for(var a in this.graphicsBySymbol){var b=this.symbols[a];b&&b.layerPropertyChanged("opacity")}};u.prototype.setClippingExtent=function(a,b){var c=this.symbolCreationContext.clippingExtent,d=B.create();V.extentToBoundingRect(a,d,b)?this.symbolCreationContext.clippingExtent=[d[0],d[1],-Infinity,d[2],d[3],Infinity]:this.symbolCreationContext.clippingExtent=null;return!l.equals(this.symbolCreationContext.clippingExtent,
c)};u.prototype.forEachGraphics3DGraphic=function(a){var b=this;if(this.owner.loadedGraphics){var c=!1;this.owner.loadedGraphics.forEach(function(d){var f=b.getGraphics3DGraphicById(d.uid);f&&a(f,d)&&(c=!0)});c&&(this.owner.view.deconflictor.setDirty(),this.owner.view.labeler.setDirty())}};u.prototype.updateAllGraphicsVisibility=function(){var a=this;this.forEachGraphics3DGraphic(function(b,c){c=b.setVisibilityFlag(0,c.visible);var d=!1;a.scaleVisibility&&(d=a.scaleVisibility.updateGraphicScaleVisibility(b));
return c||d})};u.prototype.hideAllGraphics=function(){this.forEachGraphics3DGraphic(function(a){return a.setVisibilityFlag(0,!1)})};u.prototype.validateRenderer=function(a){(a=F.validateTo3D(a))&&da.warn("Renderer for layer '"+(this.layer.title?this.layer.title+", ":"")+", id:"+this.layer.id+"' is not supported in a SceneView",a.message)};u.prototype.volatileGraphicsUpdated=function(){this.labeling&&(this.lastFastUpdate=performance.now(),this.labeling.clear());this.stageLayer.invalidateSpatialQueryAccelerator();
this.stageLayer.shaderTransformationChanged();this.notifyChange("updating")};u.createLocalOriginFactory=function(){return new G(5E6,16)};u.prototype.snapshotInternals=function(){var a=this;return{graphics:Object.keys(this.graphics).sort(),symbols:Object.keys(this.symbols).sort(),graphicsBySymbol:Object.keys(this.graphicsBySymbol).sort().map(function(b){return{symbolId:b,graphics:Object.keys(a.graphicsBySymbol[b]).sort()}}),graphicsWithoutSymbol:Object.keys(this.graphicsWithoutSymbol).sort(),graphicsDrapedUids:Object.keys(this.graphicsDrapedUids).sort(),
pendingUpdates:this.pendingUpdates}};var t;u.tmpVec=S.vec3d.create();a([y.property({readOnly:!0})],u.prototype,"computedExtent",void 0);a([y.property({readOnly:!0})],u.prototype,"elevationAlignment",void 0);a([y.property({readOnly:!0})],u.prototype,"scaleVisibility",void 0);a([y.property({readOnly:!0})],u.prototype,"spatialIndex",void 0);a([y.property({readOnly:!0})],u.prototype,"labeling",void 0);a([y.property({readOnly:!0})],u.prototype,"highlights",void 0);a([y.property()],u.prototype,"asyncUpdates",
void 0);a([y.property({constructOnly:!0})],u.prototype,"elevationFeatureExpressionEnabled",void 0);a([y.property({constructOnly:!0})],u.prototype,"owner",void 0);a([y.property({constructOnly:!0})],u.prototype,"layer",void 0);a([y.property({constructOnly:!0})],u.prototype,"basemapTerrain",void 0);a([y.property({readOnly:!0})],u.prototype,"hasDraped",void 0);a([y.property({readOnly:!0})],u.prototype,"symbolsUpdating",void 0);a([y.property({readOnly:!0,dependsOn:["elevationAlignment.updating","scaleVisibility.updating"]})],
u.prototype,"updating",null);a([y.property({aliasOf:"owner.view.qualitySettings.graphics3D.maxTotalNumberOfVertices"})],u.prototype,"maxTotalNumberOfVertices",void 0);a([y.property({aliasOf:"owner.view.qualitySettings.graphics3D.maxTotalNumberOfFeatures"})],u.prototype,"maxTotalNumberOfFeatures",void 0);a([y.property()],u.prototype,"minTotalNumberOfFeatures",void 0);a([y.property({readOnly:!0,dependsOn:["maxSymbolNumberOfVertices","maxTotalNumberOfVertices","minTotalNumberOfFeatures","maxTotalNumberOfFeatures"]})],
u.prototype,"maxNumberOfFeatures",null);a([y.property({readOnly:!0})],u.prototype,"maxSymbolNumberOfVertices",null);return u=t=a([y.subclass("esri.views.3d.layers.graphics.Graphics3DCore")],u)}(y.declared(n));var ba=new Map,ca=new x,ga=new u(x);(function(){return function(){this.remove=this.add=null}})();var ja=10;return n})},"esri/core/tsSupport/generatorHelper":function(){define([],function(){return function(q,h){function e(b){return function(c){return a([b,c])}}function a(a){if(b)throw new TypeError("Generator is already executing.");
for(;d;)try{if(b=1,g&&(c=a[0]&2?g["return"]:a[0]?g["throw"]||((c=g["return"])&&c.call(g),0):g.next)&&!(c=c.call(g,a[1])).done)return c;if(g=0,c)a=[a[0]&2,c.value];switch(a[0]){case 0:case 1:c=a;break;case 4:return d.label++,{value:a[1],done:!1};case 5:d.label++;g=a[1];a=[0];continue;case 7:a=d.ops.pop();d.trys.pop();continue;default:if(!(c=d.trys,c=0<c.length&&c[c.length-1])&&(6===a[0]||2===a[0])){d=0;continue}if(3===a[0]&&(!c||a[1]>c[0]&&a[1]<c[3]))d.label=a[1];else if(6===a[0]&&d.label<c[1])d.label=
c[1],c=a;else if(c&&d.label<c[2])d.label=c[2],d.ops.push(a);else{c[2]&&d.ops.pop();d.trys.pop();continue}}a=h.call(q,d)}catch(n){a=[6,n],g=0}finally{b=c=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}var d={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},b,g,c,f;return f={next:e(0),"throw":e(1),"return":e(2)},"function"===typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f}})},"esri/core/tsSupport/awaiterHelper":function(){define(["dojo/Deferred",
"dojo/when"],function(q,h){return function(e,a,d,b){function g(a){try{f(b.next(a))}catch(l){k.reject(l)}}function c(a){try{f(b["throw"](a))}catch(l){k.reject(l)}}function f(a){a.done?h(a.value).then(k.resolve,k.reject):h(a.value).then(g,c)}var k=new q;f((b=b.apply(e,a||[])).next());return k.promise}})},"esri/core/iteratorUtils":function(){define(["require","exports"],function(q,h){Object.defineProperty(h,"__esModule",{value:!0});h.forEachUntilMap=Map.prototype.entries?function(e,a){for(e=e.entries();;){var d=
e.next();if(d.done)break;if(!1===a(d.value[1],d.value[0]))return!1}return!0}:function(e,a){var d=!0;e.forEach(function(b,g){d&&(d=!1!==a(b,g))});return d}})},"esri/core/PooledArray":function(){define(["require","exports","./arrayUtils","./HeapSort"],function(q,h,e,a){return function(){function d(a){var b=this;this.data=[];this._length=0;this._deallocator=this._allocator=null;this._shrink=function(){};this._hint=new e.RemoveHint;if(a){a.initialSize&&(this.data=Array(a.initialSize));if(a.allocator){if(this._allocator=
a.allocator,a.deallocator&&(this._deallocator=a.deallocator),a.initialSize)for(var c=0;c<a.initialSize;++c)this.data[c]=this._allocator(c)}else this._deallocator=function(a,c){return b.data[c]=void 0};a.shrink&&(this._shrink=function(){b.data.length>2*b.length&&(b.data.length=b.length)})}}d.prototype.toArray=function(){return this.data.slice(0,this.length)};Object.defineProperty(d.prototype,"length",{get:function(){return this._length},set:function(a){if(this._allocator)for(;this.data.length<a;)this.data.push(this._allocator(this.data.length));
if(this._deallocator)for(var b=a;b<this._length;++b)this._deallocator(this.data[b],b);this._length=a;this._shrink()},enumerable:!0,configurable:!0});d.prototype.clear=function(){this.length=0};d.prototype.equal=function(a){return e.equals(this.data,a.data)};d.prototype.push=function(a){this.data.length===this.length&&this._grow(2*(this.length+1));return this.data[this.length++]=a};d.prototype.pushArray=function(a){var b=this.length+a.length;b>=this.data.length&&this._grow(Math.max(2*this.length,b));
for(b=0;b<a.length;b++)this.data[this._length++]=a[b];return this.back()};d.prototype.pushNew=function(){this.data.length===this.length&&this._grow(2*(this.length+1));++this._length;return this.back()};d.prototype.pushAny=function(a){return void 0===a?this.pushNew():Array.isArray(a)?this.pushArray(a):this.push(a)};d.prototype.pop=function(){if(0!==this.length){var a=this.data[this.length-1];--this.length;this._shrink();return a}};d.prototype.removeMany=function(a){var b=this,c=[];this.data=this.data.filter(function(d,
g){if(g>=b.length)return!1;if(0>a.indexOf(d))return!0;c.push(d);return!1});this._length=this.data.length;return c};d.prototype.removeUnordered=function(a){a=e.removeUnordered(this.data,a,this.length,this._hint);void 0!==a&&--this.length;return a};d.prototype.removeUnorderedMany=function(a){a=e.removeUnorderedMany(this.data,a,this.length,this._hint);this.length-=a.length;return a};d.prototype.front=function(){if(0!==this.length)return this.data[0]};d.prototype.back=function(){if(0!==this.length)return this.data[this.length-
1]};d.prototype.swapElements=function(a,d){var b;a>=this.length||d>=this.length||(b=[this.data[d],this.data[a]],this.data[a]=b[0],this.data[d]=b[1])};d.prototype.sort=function(b){a.sort(this.data,0,this.length,b)};d.prototype.some=function(a,d){for(var b=0;b<this.length;++b)if(a.call(d,this.data[b],b,this.data))return!0;return!1};d.prototype.find=function(a,d){for(var b=0;b<this.length;++b){var f=this.data[b];if(a.call(d,f,b,this.data))return f}};d.prototype.filter=function(a,g,c){c=c||new d;for(var b=
0;b<this.length;++b)a.call(g,this.data[b],b,this.data)&&c.push(this.data[b]);return c};d.prototype.forEach=function(a,d){for(var b=0;b<this.length;++b)a.call(d,this.data[b],b,this.data)};d.prototype.map=function(a,d){for(var b=Array(this.length),f=0;f<this.length;++f)b[f]=a.call(d,this.data[f],f,this.data);return b};d.prototype._grow=function(a){if(this._allocator)for(;this.data.length<a;)this.data.push(this._allocator(this.data.length))};return d}()})},"esri/core/HeapSort":function(){define([],function(){function q(e,
a,d,b){for(var g=a,c=d>>>1,f=e[g-1];a<=c;){a=g<<1;a<d&&0>b(e[a-1],e[a])&&++a;var k=e[a-1];if(0>=b(k,f))break;e[g-1]=k;g=a}e[g-1]=f}function h(e,a){return e<a?-1:e>a?1:0}return{sort:function(e,a,d,b){void 0===a&&(a=0);void 0===d&&(d=e.length);void 0===b&&(b=h);for(var g=d>>>1;g>a;g--)q(e,g,d,b);for(var c=a+1,g=d-1;g>a;g--)d=e[a],e[a]=e[g],e[g]=d,q(e,c,g,b);return e}}})},"esri/renderers/support/rendererConversion":function(){define(["require","exports","../../core/Error","../../symbols/support/symbolConversion"],
function(q,h,e,a){function d(a,b){if(!b)return null;b=Array.isArray(b)?b:[b];if(0<b.length){var c=b.map(function(a){return a.details.symbol.type||a.details.symbol.declaredClass}).filter(function(a){return!!a});c.sort();var d=[];c.forEach(function(a,b){0!==b&&a===c[b-1]||d.push(a)});return new e("renderer-conversion-3d:unsupported-symbols","Renderer contains symbols ("+d.join(", ")+") which are not supported in 3D",{renderer:a,symbolErrors:b})}return null}function b(b){var c=b.uniqueValueInfos.map(function(b){return a.to3D(b.symbol).error}).filter(function(a){return!!a}),
g=a.to3D(b.defaultSymbol);g.error&&c.unshift(g.error);return d(b,c)}function g(b){var c=b.classBreakInfos.map(function(b){return a.to3D(b.symbol).error}).filter(function(a){return!!a}),g=a.to3D(b.defaultSymbol);g.error&&c.unshift(g.error);return d(b,c)}Object.defineProperty(h,"__esModule",{value:!0});h.validateTo3D=function(c){return c?"simple"===c.type?d(c,a.to3D(c.symbol).error):"unique-value"===c.type?b(c):"class-breaks"===c.type?g(c):new e("renderer-conversion-3d:unsupported-renderer","Unsupported renderer of type '"+
(c.type||c.declaredClass)+"'",{renderer:c}):null}})},"esri/symbols/support/unitConversionUtils":function(){define(["require","exports","../../renderers/support/utils"],function(q,h,e){Object.defineProperty(h,"__esModule",{value:!0});h.supportsUnit=function(a){return null!=e.meterIn[a]};h.getMetersPerUnit=function(a){return 1/(e.meterIn[a]||1)}})},"esri/views/3d/layers/graphics/ElevationQuery":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/assignHelper dojo/Deferred ../../../../geometry ../../../../core/promiseUtils ../../../../core/scheduling".split(" "),
function(q,h,e,a,d,b,g,c,f){Object.defineProperty(h,"__esModule",{value:!0});q=function(){function b(a,b){this.spatialReference=a;this.elevationProvider=b;this.point=new g.Point;this.point.spatialReference=a}b.prototype.queryElevation=function(b,d){return a(this,void 0,void 0,function(){return e(this,function(a){this.point.x=b;this.point.y=d;return[2,c.resolve(this.elevationProvider&&this.elevationProvider.getElevation(this.point)||0)]})})};return b}();h.ElevationQueryView=q;q=function(){function c(a,
b,c){this.spatialReference=a;this._getElevationQueryProvider=b;this._queries=[];this._isScheduled=!1;this._queryOptions=d({},c,{ignoreInvisibleLayers:!0})}c.prototype.queryElevation=function(c,d,f){void 0===f&&(f=0);return a(this,void 0,void 0,function(){var a;return e(this,function(g){a=new b;this._queries.push({x:c,y:d,minDemResolution:f,result:a});this._scheduleDoQuery();return[2,a.promise]})})};c.prototype._scheduleDoQuery=function(){var a=this;this._isScheduled||(f.schedule(function(){return a._doQuery()}),
this._isScheduled=!0)};c.prototype._doQuery=function(){return a(this,void 0,void 0,function(){var a,b,c,f,k,t,u,h,v;return e(this,function(e){switch(e.label){case 0:this._isScheduled=!1;a=this._queries;this._queries=[];b=a.map(function(a){return[a.x,a.y]});c=a.reduce(function(a,b){return Math.min(a,b.minDemResolution)},Infinity);f=new g.Multipoint({points:b,spatialReference:this.spatialReference});k=this._getElevationQueryProvider();if(!k)return a.forEach(function(a,b){return a.result.reject()}),
[2];u=d({},this._queryOptions,{minDemResolution:c});e.label=1;case 1:return e.trys.push([1,3,,4]),[4,k.queryElevation(f,u)];case 2:return t=e.sent(),[3,4];case 3:return h=e.sent(),a.forEach(function(a){return a.result.reject(h)}),[2];case 4:return v=t.geometry.points,a.forEach(function(a,b){return a.result.resolve(v[b][2])}),[2]}})})};return c}();h.ElevationQuery=q})},"esri/views/3d/layers/graphics/featureExpressionInfoUtils":function(){define(["require","exports","../../../../support/arcadeUtils"],
function(q,h,e){Object.defineProperty(h,"__esModule",{value:!0});h.createContext=function(a,d,b){var g=null;a=a&&a.expression;"string"===typeof a&&(g="0"===a?0:null,null!=g?g={cachedResult:g}:(g=e.createSyntaxTree(a),e.dependsOnView(g)?(null!=b&&b.error("Expressions containing '$view' are not supported on ElevationInfo"),g={cachedResult:0}):g={arcade:{func:e.createFunction(g),context:e.createExecContext(null,{sr:d})}}));return g};h.createFeature=function(a,d){return e.createFeature(a.attributes,a.geometry,
d)};h.setContextFeature=function(a,d){null!=a&&null==a.cachedResult&&e.updateExecContext(a.arcade.context,d)};h.execute=function(a){if(null!=a){if(null!=a.cachedResult)return a.cachedResult;var d=a.arcade,d=e.executeFunction(d.func,d.context);"number"!==typeof d&&(d=a.cachedResult=0);return d}return 0};h.extractExpressionInfo=function(a,d){void 0===d&&(d=!1);var b=(a=a&&a.featureExpressionInfo)&&a.expression;d||"0"===b||(a=null);return a};h.zeroContext={cachedResult:0}})},"esri/views/3d/layers/graphics/Graphics3DGraphic":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/asyncUtils ../../../../core/ObjectPool ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ./featureExpressionInfoUtils ../../support/projectionUtils".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n){var l=new b(Array,function(a){return g.set(a,g.ZERO)},null,10,5),p=c.create();return function(){function b(a,b,c,d){this.addedToSpatialIndex=!1;this._labelGraphics=[];this._auxiliaryGraphics=[];for(var f=Array(2),g=0;g<f.length;g++)f[g]=Array(3);this._visibilityFlags=f;this.extent=this._featureExpressionFeature=null;this.graphics3DSymbol=b;this.graphic=a;this._graphics=c;this._featureExpressionFeature=k.createFeature(a,d)}b.prototype.initialize=function(a,b){var c=
this;this._layer=a;this._stage=b;this.forEachSymbolLayerGraphic(function(d){d.initialize(a,b);d.setVisibility(c.isVisible())})};b.prototype.destroy=function(){this.forEachRenderedGraphic(function(a){return a.destroy()});this._graphics.length=0;this._labelGraphics.length=0;this._auxiliaryGraphics.length=0};b.prototype.clearLabelGraphics=function(){this.forEachLabelGraphic(function(a){return a.destroy()});this._labelGraphics.length=0};b.prototype.addLabelGraphic=function(a,b,c){this._labelGraphics.push(a);
a.initialize(b,c);a.setVisibility(this.isVisible(1))};b.prototype.addAuxiliaryGraphic=function(a){this._auxiliaryGraphics.push(a);this._layer&&(a.initialize(this._layer,this._stage),a.setVisibility(this.isVisible()))};b.prototype.isDraped=function(){var a=!1;this.forEachSymbolLayerGraphic(function(b){"draped"===b.type&&(a=!0)});return a};b.prototype.areVisibilityFlagsSet=function(a,b,c){void 0===c&&(c=0);c=this._visibilityFlags[c];if(null!=a)return c[a];a=!0;for(var d=0;d<c.length;d++)if(d!==b){var f=
c[d];a=a&&(null==f||!0===f)}return a};b.prototype.isVisible=function(a){void 0===a&&(a=0);for(var b=0;b<=a;b++)for(var c=this._visibilityFlags[b],d=0;d<c.length;d++){var f=c[d];if(null!==f&&!1===f)return!1}return!0};b.prototype.setVisibilityFlag=function(a,b,c){void 0===c&&(c=0);var d=this.isVisible(c);this._visibilityFlags[c][a]=b;var f=this.isVisible(c);if(d===f)return!1;if(1===c)this.forEachLabelGraphic(function(a){return a.setVisibility(f)});else{this.forEachSymbolLayerGraphic(function(a){return a.setVisibility(f)});
var g=this.isVisible(1);this.forEachLabelGraphic(function(a){return a.setVisibility(g)})}return!0};b.prototype.getBSRadius=function(){var a=0;this.forEachSymbolLayerGraphic(function(b){a=Math.max(a,b.getBSRadius())});return a};b.prototype.getCenterObjectSpace=function(){return this._graphics[0].getCenterObjectSpace()};b.prototype.computeExtent=function(a){if(!this.extent){this.extent=c.create();var b=this.graphic.geometry,d=b.spatialReference;f.computeAABR(b,this.extent);if(!d.equals(a)&&!n.boundingRectToBoundingRect(this.extent,
d,this.extent,a))return this.extent=null,!1}return!0};b.prototype.getProjectedBoundingBox=function(b,f,k,m){return a(this,void 0,void 0,function(){var n=this;return e(this,function(u){switch(u.label){case 0:return m||(m={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),m.boundingBox?g.empty(m.boundingBox):m.boundingBox=g.empty(),m.requiresDrapedElevation=!1,[4,d.forEach(this._graphics,function(c){return a(n,void 0,void 0,function(){var a,d,n;return e(this,function(e){switch(e.label){case 0:if(!c)return[2];
a="draped"===c.type?f:b;d=l.acquire();return[4,c.getProjectedBoundingBox(a,k,d,m.screenSpaceObjects)];case 1:return n=e.sent(),isFinite(n[2])&&isFinite(n[5])||(m.requiresDrapedElevation=!0),n&&g.expand(m.boundingBox,d),l.release(d),[2]}})})})];case 1:return u.sent(),g.allFinite(m.boundingBox)||c.allFinite(g.toRect(m.boundingBox,p))?[2,m]:[2,null]}})})};b.prototype.needsElevationUpdates=function(){for(var a=0,b=this._graphics;a<b.length;a++){var c=b[a];if(c&&("object3d"===c.type||"lod-instance"===
c.type)&&c.needsElevationUpdates)return!0}a=0;for(b=this._labelGraphics;a<b.length;a++)if((c=b[a])&&c.needsElevationUpdates)return!0;return!1};b.prototype.alignWithElevation=function(a,b){var c=this;this.forEachRenderedGraphic(function(d){"object3d"!==d.type&&"lod-instance"!==d.type||d.alignWithElevation(a,b,c._featureExpressionFeature)})};b.prototype.addHighlight=function(a,b){this.forEachSymbolLayerGraphic(function(c){return c.addHighlight(a,b)})};b.prototype.removeHighlight=function(a){this.forEachSymbolLayerGraphic(function(b){return b.removeHighlight(a)})};
b.prototype.forEachGraphicList=function(a,b){a.forEach(function(a,c){return a&&b(a,c)})};b.prototype.forEachSymbolLayerGraphic=function(a){this.forEachGraphicList(this._graphics,a);this.forEachGraphicList(this._auxiliaryGraphics,a)};b.prototype.forEachLabelGraphic=function(a){this.forEachGraphicList(this._labelGraphics,a)};b.prototype.forEachRenderedGraphic=function(a){this.forEachSymbolLayerGraphic(a);this.forEachLabelGraphic(a)};return b}()})},"esri/core/asyncUtils":function(){define(["require",
"exports","./tsSupport/generatorHelper","./tsSupport/awaiterHelper","./promiseUtils"],function(q,h,e,a,d){Object.defineProperty(h,"__esModule",{value:!0});h.forEach=function(b,g,c){return a(this,void 0,void 0,function(){return e(this,function(a){switch(a.label){case 0:return[4,d.eachAlways(b.map(function(a,b){return g.apply(c,[a,b])}))];case 1:return a.sent(),[2]}})})};h.map=function(b,g,c){return a(this,void 0,void 0,function(){var a;return e(this,function(f){switch(f.label){case 0:return[4,d.eachAlways(b.map(function(a,
b){return g.apply(c,[a,b])}))];case 1:return a=f.sent(),[2,a.map(function(a){return a.value})]}})})};h.maybe=function(a){return a.then(function(a){return{ok:!0,value:a}}).catch(function(a){return{ok:!1,error:a}})};h.assertMaybe=function(a){if(!0===a.ok)return a.value;throw a.error;};h.cancellable=function(a){var b,c=function(a){return b=a};return d.create(function(b,d){a(c).then(b,d)},function(a){return b&&b.cancel(a)})}})},"esri/views/3d/layers/graphics/Graphics3DOwner":function(){define(["require",
"exports"],function(q,h){Object.defineProperty(h,"__esModule",{value:!0});q=function(){return function(){this.featureExpressionInfoContext=this.localOriginFactory=this.layerView=this.layer=this.overlaySR=this.renderCoordsHelper=this.renderSpatialReference=this.clippingExtent=this.layerOrderDelta=this.layerOrder=this.stage=this.renderer=this.elevationProvider=this.streamDataSupplier=this.sharedResources=null;this.screenSizePerspectiveEnabled=!0}}();h.Graphics3DSymbolCreationContext=q})},"esri/views/3d/layers/graphics/Graphics3DSymbolFactory":function(){define(["require",
"exports","./Graphics3DPointSymbol","./Graphics3DSymbol"],function(q,h,e,a){Object.defineProperty(h,"__esModule",{value:!0});h.make=function(d,b,g){var c;switch(d.type){case "point-3d":c=e;break;default:c=a}return new c(d,b,g)}})},"esri/views/3d/layers/graphics/Graphics3DPointSymbol":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./Graphics3DCalloutSymbolLayerFactory","./Graphics3DSymbol"],function(q,h,e,a,d){return function(b){function d(c,d,g){c=b.call(this,c,
d,g)||this;c.calloutSymbolLayer=null;c.symbol.hasVisibleCallout()&&(c.calloutSymbolLayer=a.make(c.symbol,d));return c}e(d,b);d.prototype.destroy=function(){b.prototype.destroy.call(this)};d.prototype.createGraphics3DGraphic=function(a,d,g){d=b.prototype.createGraphics3DGraphic.call(this,a,g);this.calloutSymbolLayer&&(a=this.createCalloutGraphic(a))&&d.addAuxiliaryGraphic(a);return d};d.prototype.layerPropertyChanged=function(a,d){var c=this;return b.prototype.layerPropertyChanged.call(this,a,d)?this.calloutSymbolLayer?
this.calloutSymbolLayer.layerPropertyChanged(a,d,function(a){var b=0;for(a=a._auxiliaryGraphics;b<a.length;b++){var d=a[b];if(d.graphics3DSymbolLayer===c.calloutSymbolLayer)return d}}):!0:!1};d.prototype.createCalloutGraphic=function(a){var b=a.renderingInfo;a.renderingInfo={renderer:b.renderer,symbol:b.symbol,needsOffsetAdjustment:b.needsOffsetAdjustment,translation:[0,0,0],centerOffset:[0,0,0,0],screenOffset:[0,0],centerOffsetUnits:"world",elevationOffset:0,materialCollection:null};return this.calloutSymbolLayer.createGraphics3DGraphic(a)};
return d}(d)})},"esri/views/3d/layers/graphics/Graphics3DCalloutSymbolLayerFactory":function(){define(["require","exports","../../../../core/Logger","../../../../symbols/callouts/calloutUtils","./Graphics3DLineCalloutSymbolLayer"],function(q,h,e,a,d){Object.defineProperty(h,"__esModule",{value:!0});var b=e.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");h.make=function(c,d){if(!a.isCalloutSupport(c))return b.error("Graphics3DCalloutSymbolLayerFactory#make","symbol of type '"+
c.type+"' does not support callouts"),null;if(!c.callout)return null;var f=g[c.callout.type];return f?new f(c,d):(b.error("Graphics3DCalloutSymbolLayerFactory#make","unknown or unsupported callout type "+c.callout.type),null)};var g={line:d}})},"esri/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../core/screenUtils ./ElevationAligners ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Util ../../webgl-engine/materials/LineCalloutMaterial".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r){var t,u,x=m.VertexAttrConstants;q=function(f){function m(a,b){a=f.call(this,a,null,b,!0)||this;a._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};return a}e(m,f);m.prototype.destroy=function(){f.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(n.ModelContentType.MATERIAL,this._material.id),this._material=null)};m.prototype._prepareResources=function(){var a=this._getStageIdHint();
this._createMaterialsAndAddToStage(this._context.stage,a);this.resolve()};m.prototype.perInstanceMaterialParameters=function(a){var b=this.materialParameters;b.screenOffset=a.screenOffset||[0,0];b.centerOffsetUnits=a.centerOffsetUnits||"world";return b};Object.defineProperty(m.prototype,"materialParameters",{get:function(){var b=this.symbolContainer,c=b.callout,f=a.toUnitRGBA(c.color);f[3]*=this._getLayerOpacity();var g=d.pt2px(c.size||0),e=null;if(b.verticalOffset)var e=b.verticalOffset,k=e.minWorldLength,
m=e.maxWorldLength,e={screenLength:d.pt2px(e.screenLength),minWorldLength:k||0,maxWorldLength:null!=m?m:Infinity};c=c.border&&c.border.color?a.toUnitRGBA(c.border.color):null;k="object"===b.symbolLayers.getItemAt(0).type;return{color:f,size:g,verticalOffset:e,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:c,occlusionTest:!k,shaderPolygonOffset:k?0:void 0,depthHUDAlignStart:"label-3d"===
b.type}},enumerable:!0,configurable:!0});m.prototype._createMaterialsAndAddToStage=function(a,b){this._material=new r(this.materialParameters,b+"_lineCallout_common");a.add(n.ModelContentType.MATERIAL,this._material)};m.prototype._defaultElevationInfoNoZ=function(){return y};m.prototype.createGraphics3DGraphic=function(a){var b=a.renderingInfo;a=a.graphic;null!=b.needsOffsetAdjustment&&(this._elevationOptions.needsOffsetAdjustment=b.needsOffsetAdjustment);var c=this.getGraphicElevationContext(a,b.elevationOffset||
0),d=b.symbol,f="on-the-ground"===this._elevationContext.mode&&!d.symbolLayers.some(function(a){return"object"===a.type||"text"===a.type});if("label-3d"!==d.type&&f)return null;d=k.computeCentroid(a.geometry);return null==d?null:this._createAs3DShape(a,d,c,b,"graphic"+a.uid,a.uid)};m.prototype.layerPropertyChanged=function(a,b,c){switch(a){case "opacity":return this.layerOpacityChanged(b,c);case "elevationInfo":return this.layerElevationInfoChanged(b,c)}return!1};m.prototype.layerOpacityChanged=function(a,
b){this._material.setParameterValues(this.materialParameters);return!0};m.prototype.layerElevationInfoChanged=function(a,b){var c=this._elevationContext.mode;this._updateElevationContext();var d=this._elevationContext.mode;if(c!==d&&("on-the-ground"===c||"on-the-ground"===d))return!1;for(var f in a)c=a[f],(d=b(c))&&this.updateGraphicElevationContext(c.graphic,d);return!0};m.prototype.getGraphicElevationContext=function(a,b){void 0===b&&(b=0);a=f.prototype.getGraphicElevationContext.call(this,a);a.addOffsetRenderUnits(b);
return a};m.prototype.updateGraphicElevationContext=function(a,b){a=this.getGraphicElevationContext(a,b.metadata.elevationOffset);b.elevationContext.set(a);b.needsElevationUpdates=c.needsElevationUpdates2D(a.mode)};Object.defineProperty(m.prototype,"numberOfVertices",{get:function(){return 6},enumerable:!0,configurable:!0});m.prototype.createVertexData=function(a){var b,c=a.translation;a=a.centerOffset;if(!c&&!a)return v;c=c?{size:3,data:[c[0],c[1],c[2]]}:v[x.POSITION];a=a?{size:4,data:[a[0],a[1],
a[2],a[3]]}:v[x.AUXPOS1];return b={},b[x.POSITION]=c,b[x.NORMAL]=v[x.NORMAL],b[x.AUXPOS1]=a,b};m.prototype.getOrCreateMaterial=function(a,b){var c=this.perInstanceMaterialParameters(a),d=r.uniqueMaterialIdentifier(c);if(d===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(a.materialCollection){var f=a.materialCollection.getMaterial(d);f||(f=new r(c,b+"_lineCallout_shared"),a.materialCollection.addMaterial(d,f));return{material:f,isUnique:!1}}f=new r(c,b+"_lineCallout_unique");
return{material:f,isUnique:!0}};m.prototype._createAs3DShape=function(a,d,f,e,k,m){a=new p(this.createVertexData(e),A,p.DefaultOffsets,"point");a=[new l(a,k)];var n=this.getOrCreateMaterial(e,k);k=c.createStageObjectForPoint.call(this,d,a,[[n.material]],null,null,f,k,this._context.layer.uid,m,!0);if(null===k)return null;m=new g(this,k.object,a,n.isUnique?[n.material]:null,null,b.perObjectElevationAligner,f);m.metadata={elevationOffset:e.elevationOffset||0};m.alignedTerrainElevation=k.terrainElevation;
m.needsElevationUpdates=c.needsElevationUpdates2D(f.mode);c.extendPointGraphicElevationContext(m,d,this._context.elevationProvider);return m};return m}(f);var v=(t={},t[x.POSITION]={size:3,data:[0,0,0]},t[x.NORMAL]={size:3,data:[0,0,1]},t[x.AUXPOS1]={size:4,data:[0,0,0,1]},t);t=new Uint32Array([0]);var A=(u={},u[x.POSITION]=t,u[x.NORMAL]=t,u[x.AUXPOS1]=t,u),y={mode:"relative-to-ground",offset:0};return q})},"esri/views/3d/layers/graphics/ElevationAligners":function(){define("require exports ../../../../geometry/Point ./Graphics3DSymbolCommonCode ./graphicUtils ../../lib/glMatrix ../../support/debugFlags ../../support/projectionUtils ../../webgl-engine/lib/Util".split(" "),
function(q,h,e,a,d,b,g,c,f){Object.defineProperty(h,"__esModule",{value:!0});var k=f.VertexAttrConstants,n=new e,l=b.vec3d.create(),p=b.vec3d.create(),m=b.vec3d.create(),r=b.vec3d.create(),t=b.mat4d.create(),u={verticalDistanceToGround:0,terrainElevation:0};h.perVertexElevationAligner=function(b,c,d,f){b=b.stageObject;n.spatialReference=d.spatialReference;for(var e=b.getGeometryRecords(),r=e.length,t="absolute-height"!==c.mode,v=0,y=0;y<r;y++){var A=e[y].geometry,x=e[y].getShaderTransformation(),
q=A.getData();p[0]=x[12];p[1]=x[13];p[2]=x[14];A.invalidateBoundingInfo();for(var x=q.getVertexAttr(),q=x[k.POSITION],A=q.data,x=x.mapPos.data,q=q.size,I=A.length/q,K=0,O=0,P=!1,L=0,U=0;U<I;U++){n.x=x[O++];n.y=x[O++];n.z=x[O++];m[0]=A[K];m[1]=A[K+1];m[2]=A[K+2];var N=a.computeElevation(d,n,c,f,t?u:null);t&&(L+=u.terrainElevation);l[0]=A[K]+p[0];l[1]=A[K+1]+p[1];l[2]=A[K+2]+p[2];f.setAltitude(N,l);A[K]=l[0]-p[0];A[K+1]=l[1]-p[1];A[K+2]=l[2]-p[2];if(g.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS)P=!0;else if(N=
h.updateThresholdInMeters/f.unitInMeters,Math.abs(m[0]-A[K])>=N||Math.abs(m[1]-A[K+1])>=N||Math.abs(m[2]-A[K+2])>=N)P=!0;K+=q}v+=L/I;P&&b.geometryVertexAttrsUpdated(y)}return v/r};h.perObjectElevationAligner=function(b,f,e,k,m){b=b.stageObject;var n=f.centerPointInElevationSR,p=0;m=0;if(b.metadata.usesVerticalDistanceToGround)p=a.computeElevation(e,n,f,k,u),d.updateVertexAttributeAuxpos1w(b,u.verticalDistanceToGround),m=u.terrainElevation;else{var r="absolute-height"!==f.mode,p=a.computeElevation(e,
n,f,k,r?u:null);r&&(m=u.terrainElevation)}f=b.getObjectTransformation();e=[f[12],f[13],f[14]];g.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(l[0]=n.x,l[1]=n.y,l[2]=p,c.computeLinearTransformation(n.spatialReference,l,f,k.spatialReference)&&b.setObjectTransformation(f)):k.setAltitudeOfTransformation(p,f);k=h.updateThresholdInMeters/k.unitInMeters;(Math.abs(f[12]-e[0])>=k||Math.abs(f[13]-e[1])>=k||Math.abs(f[14]-e[2])>=k)&&b.setObjectTransformation(f);return m};h.perLodInstanceElevationAligner=function(b,
d,f,e,k){k=d.centerPointInElevationSR;var m=0,n=0,p="absolute-height"!==d.mode,m=a.computeElevation(f,k,d,e,p?u:null);p&&(n=u.terrainElevation);d=b.graphics3DSymbolLayer.lodRenderer.instanceData;d.getTranslation(b.instanceIndex,r);g.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(l[0]=k.x,l[1]=k.y,l[2]=m,c.computeLinearTransformation(k.spatialReference,l,t,e.spatialReference)&&d.setTransform(b.instanceIndex,t)):e.setAltitude(m,r);d.setTranslation(b.instanceIndex,r);return n};h.updateThresholdInMeters=
.01;h.iterativeUpdatesEnabled=!0})},"esri/views/3d/layers/graphics/Graphics3DSymbolCommonCode":function(){define("require exports ../../../../geometry/support/coordsUtils ../../../../geometry/support/triangulationUtils ../../../../layers/graphics/dehydratedFeatures ../../../../symbols/callouts/calloutUtils ./graphicUtils ../../lib/glMatrix ../../support/projectionUtils ../../webgl-engine/lib/Object3D".split(" "),function(q,h,e,a,d,b,g,c,f,k){function n(a,b,c,d,f){var g=b.z||0,e=c.featureExpressionInfoContext;
switch(c.mode){case "on-the-ground":return c=a.getElevation(b,"ground")||0,f&&(f.verticalDistanceToGround=0,f.terrainElevation=c),c;case "relative-to-ground":return a=a.getElevation(b,"ground")||0,c=c.calculateOffsetRenderUnits(d),null==e&&(c+=g),f&&(f.verticalDistanceToGround=c,f.terrainElevation=a),c+a;case "relative-to-scene":return a=a.getElevation(b,"scene")||0,c=c.calculateOffsetRenderUnits(d),f&&(f.verticalDistanceToGround=c,f.terrainElevation=a),c+a;case "absolute-height":return c=c.calculateOffsetRenderUnits(d),
null==e&&(c+=g),f&&(a=a.getElevation(b,"ground")||0,f.verticalDistanceToGround=c-a,f.terrainElevation=a),c}return 0}function l(b,c){b=a.pathsToTriangulationInfo(b,c);return{vertexData:b.position,polygons:b.polygons,outlines:b.outlines}}function p(a,b,c,d,f){b*=3;d*=3;for(var g=0;g<f;++g)c[d++]=a[b++],c[d++]=a[b++],c[d++]=a[b++]}function m(a,b,c,d,g,e,k){return f.bufferToBuffer(a,c,b,d,e,g,k)}function r(a,b,c){f.pointToVector(a,b,c)}function t(a,b){return!(a[0]>b[3]||a[0]<b[0]||a[1]>b[4]||a[1]<b[1])}
function u(a,b){return!(b[0]>a[3]||b[3]<a[0]||b[1]>a[4]||b[4]<a[1])}Object.defineProperty(h,"__esModule",{value:!0});q=c.mat4d;var x=c.vec3d.create(),v=q.identity(),A=d.makeDehydratedPoint(0,0,0,null);h.createStageObjectForPoint=function(a,b,c,d,e,m,l,p,u,h,A){var B=b?b.length:0,C=this._context.clippingExtent;r(a,x,this._context.elevationProvider.spatialReference);if(C&&!t(x,C))return null;r(a,x,this._context.renderSpatialReference);C=this._context.localOriginFactory.getOrigin(x);l=new k({castShadow:!1,
metadata:{layerUid:p,graphicUid:u,usesVerticalDistanceToGround:!!h},idHint:l});for(p=0;p<B;p++)l.addGeometry(b[p],c[p],d?d[p]:v,e,C,A);b=this._context.renderSpatialReference;d=this._context.elevationProvider;e=this._context.renderCoordsHelper;c=0;var D;l.metadata.usesVerticalDistanceToGround?(c=n(d,a,m,e,y),g.updateVertexAttributeAuxpos1w(l,y.verticalDistanceToGround),D=y.terrainElevation):(A="absolute-height"!==m.mode,c=n(d,a,m,e,A?y:null),A&&(D=y.terrainElevation));m=l.getObjectTransformation();
x[0]=a.x;x[1]=a.y;x[2]=c;f.computeLinearTransformation(a.spatialReference,x,m,b)?l.setObjectTransformation(m):console.warn("Could not locate symbol object properly, it might be misplaced");return{object:l,terrainElevation:D}};h.extendPointGraphicElevationContext=function(a,b,c){a=a.elevationContext;c=c.spatialReference;r(b,x,c);a.centerPointInElevationSR=d.makeDehydratedPoint(x[0],x[1],d.hasZ(b)?x[2]:0,c)};h.placePointOnGeometry=function(a){switch(a.type){case "point":return a;case "polygon":case "extent":return g.computeCentroid(a);
case "polyline":var b=a.paths[0];if(!b||0===b.length)break;b=e.getPointOnPath(b,e.getPathLength(b)/2);return d.makeDehydratedPoint(b[0],b[1],b[2],a.spatialReference);case "mesh":return a.extent.center}return null};h.computeElevation=n;h.getSingleSizeDriver=function(a,b){void 0===b&&(b=0);return isFinite(a[b])?a[b]:null};h.copyPathData=l;h.copyVertices=p;h.chooseOrigin=function(a,b,c,d){b=Math.floor(b+(c-1)/2);d[0]=a[3*b+0];d[1]=a[3*b+1];d[2]=a[3*b+2]};h.subtractCoordinates=function(a,b,c,d){b*=3;
for(var f=0;f<c;++f)a[b++]-=d[0],a[b++]-=d[1],a[b++]-=d[2]};h.setZ=function(a,b,c,d){b*=3;for(var f=0;f<c;++f)a[b+2]=d,b+=3};h.offsetZ=function(a,b,c,d){b*=3;for(var f=0;f<c;++f)a[b+2]+=d,b+=3};h.scaleZ=function(a,b,c,d){b*=3;for(var f=0;f<c;++f)a[b+2]*=d,b+=3};h.flatArrayToArrayOfArrays=function(a,b,c){var d=[];b*=3;for(var f=0;f<c;++f)d.push([a[b++],a[b++],a[b++]]);return d};h.reproject=m;h.reprojectPoint=r;h.getGeometryVertexData3D=function(a,b,c,d,f,g,e){var k=f.spatialReference;a=l(a,b);b=a.vertexData;
var n=b.length/3,u=new Float64Array(b.length),r=!0;c.equals(k)?p(b,0,u,0,b.length):r=m(b,0,c,u,0,k,n);var t=c=0,h=e.mode,v=0,y=0,x=0;g=e.calculateOffsetRenderUnits(g);e=e.featureExpressionInfoContext;A.spatialReference=f.spatialReference;c*=3;for(var t=3*t,C=0;C<n;++C)A.x=u[c+0],A.y=u[c+1],A.z=u[c+2],"on-the-ground"===h?(y=v=f.getElevation(A)||0,x+=v):"relative-to-ground"===h?(v=f.getElevation(A)||0,y=v+g,null==e&&(y+=A.z),x+=v):"relative-to-scene"===h?(v=f.getElevation(A,"scene")||0,y=v+g,x+=v):
"absolute-height"===h&&(y=g,null==e&&(y+=A.z)),b[t+0]=u[c+0],b[t+1]=u[c+1],b[t+2]=y,c+=3,t+=3;f=x/n;k.equals(d)||m(b,0,k,b,0,d,n);return{geometryData:a,vertexData:b,eleVertexData:u,terrainElevation:f,projectionSuccess:r}};h.getGeometryVertexDataDraped=function(a,b,c){a=l(a,!1);var d=a.vertexData,g=d.length/3,e=!0;b.equals(c)||(e=f.bufferToBuffer(d,b,0,d,c,0,g));return{geometryData:a,vertexData:d,projectionSuccess:e}};h.computeBoundingBox=function(a,b,c,d){d[0]=Number.MAX_VALUE;d[1]=Number.MAX_VALUE;
d[2]=Number.MAX_VALUE;d[3]=-Number.MAX_VALUE;d[4]=-Number.MAX_VALUE;d[5]=-Number.MAX_VALUE;b*=3;for(var f=0;f<c;++f){var g=a[b++],e=a[b++],k=a[b++];g<d[0]&&(d[0]=g);e<d[1]&&(d[1]=e);k<d[2]&&(d[2]=k);g>d[3]&&(d[3]=g);e>d[4]&&(d[4]=e);k>d[5]&&(d[5]=k)}return d};h.pointInBox2D=t;h.boxesIntersect2D=u;h.boundingBoxClipped=function(a,b){return b?!u(a,b):!1};h.needsElevationUpdates2D=function(a){return"relative-to-ground"===a||"relative-to-scene"===a};h.needsElevationUpdates3D=function(a){return"absolute-height"!==
a};h.needsOffsetAdjustment=function(a,c,f,g){if(!1===c.needsOffsetAdjustment||!1===c.supportsOffsetAdjustment||"on-the-ground"===a.mode)return!1;if(0===a.meterUnitOffset){if(!0===c.needsOffsetAdjustment)return!0;if(b.isCalloutSupport(g)&&g.hasVisibleVerticalOffset())return!1;if("relative-to-ground"===a.mode&&(!d.hasZ(f)||a.featureExpressionInfoContext)||"relative-to-scene"===a.mode)return!0}return!1};var y={verticalDistanceToGround:0,terrainElevation:0}})},"esri/views/3d/layers/graphics/graphicUtils":function(){define("require exports ../../../../geometry ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/centroid ../../../../geometry/support/coordsUtils ../../../../geometry/support/webMercatorUtils ../../../../layers/graphics/dehydratedFeatures ../../lib/glMatrix ../../support/mathUtils".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n){function l(a){var b=a.paths[0];if(!b||0===b.length)return null;b=g.getPointOnPath(b,g.getPathLength(b)/2);return f.makeDehydratedPoint(b[0],b[1],b[2],a.spatialReference)}function p(a){if(Array.isArray(a)){for(var b=0;b<a.length;b++)if(!p(a[b]))return!1;return!0}return null==a||0<=a}Object.defineProperty(h,"__esModule",{value:!0});var m=[1,1,1];h.computeCentroid=function(a){if("point"===a.type)return a;if(f.isHydratedGeometry(a))switch(a.type){case "extent":return a.center;
case "polygon":return a.centroid;case "polyline":return l(a);case "mesh":return a.extent.center}else switch(a.type){case "extent":var c=n.isFinite(a.zmin);return f.makeDehydratedPoint(.5*(a.xmax+a.xmin),.5*(a.ymax+a.ymin),c?.5*(a.zmax+a.zmin):void 0,a.spatialReference);case "polygon":return c=b.ringsCentroid(a.rings,f.hasZ(a)),f.makeDehydratedPoint(c[0],c[1],c[2],a.spatialReference);case "polyline":return l(a)}};h.convertPointSR=function(a,b){var d=a.spatialReference;d.isWebMercator&&b.isWGS84?(c.xyToLngLat(a.x,
a.y,r),a.x=r[0],a.y=r[1],a.spatialReference=e.SpatialReference.WGS84):b.isWebMercator&&d.isWGS84&&(c.lngLatToXY(a.x,a.y,r),a.x=r[0],a.y=r[1],a.spatialReference=e.SpatialReference.WebMercator)};h.enlargeExtent=function(a,b,c){if(a){b||(b=d.create());var f=.5*a.width*(c-1);c=.5*a.height*(c-1);a.width<1E-7*a.height?f+=c/20:a.height<1E-7*a.width&&(c+=f/20);k.vec4d.set4(a.xmin-f,a.ymin-c,a.xmax+f,a.ymax+c,b);return b}return null};h.updateVertexAttributeAuxpos1w=function(a,b){for(var c=0;c<a.geometries.length;++c){var d=
a.geometries[c].data.vertexAttributes.auxpos1;d&&d.data[3]!==b&&(d.data[3]=b,a.geometryVertexAttrsUpdated(c))}};h.mixinColorAndOpacity=function(a,b){var c=[1,1,1,1];null!=a&&(c[0]=a[0],c[1]=a[1],c[2]=a[2]);null!==b&&void 0!==b?c[3]=b:null!=a&&3<a.length&&(c[3]=a[3]);return c};h.overrideColor=function(a,b,c,d,f,g){void 0===g&&(g=[0,0,0,0]);for(var e=0;3>e;++e)g[e]=a&&null!=a[e]?a[e]:c&&null!=c[e]?c[e]:f[e];g[3]=null!=b?b:null!=d?d:f[3];return g};h.computeObjectScale=function(a,b,c,d){void 0===a&&(a=
m);void 0===d&&(d=1);var f=Array(3);if(null==b||null==c)f[0]=1,f[1]=1,f[2]=1;else{for(var g=void 0,e=0,k=2;0<=k;k--){var l=a[k],n=void 0,p=null!=l,u=0===k&&!g&&!p,r=c[k];"symbolValue"===l||u?n=0!==r?b[k]/r:1:p&&"proportional"!==l&&isFinite(l)&&(n=0!==r?l/r:1);null!=n&&(g=f[k]=n,e=Math.max(e,Math.abs(n)))}for(k=2;0<=k;k--)null==f[k]?f[k]=g:0===f[k]&&(f[k]=.001*e)}for(k=2;0<=k;k--)f[k]/=d;return f};h.computeSizeWithResourceSize=function(a,b){var c=b.width,d=b.depth,f=b.height;b=b.isPrimitive?10:1;if(null==
c&&null==f&&null==d)return[b*a[0],b*a[1],b*a[2]];for(var c=[c,d,f],g,d=0;3>d;d++)if(f=c[d],null!=f){g=f/a[d];break}for(d=0;3>d;d++)null==c[d]&&(c[d]=a[d]*g);return c};h.validateSymbolLayerSize=function(a){null!=a.isPrimitive&&(a=[a.width,a.depth,a.height]);return p(a)?null:"Symbol sizes may not be negative values"};h.computeObjectRotation=function(a,b,c,d){void 0===d&&(d=k.mat4d.identity());a=a||0;b=b||0;c=c||0;0!==a&&k.mat4d.rotateZ(d,-a/180*Math.PI,d);0!==b&&k.mat4d.rotateX(d,b/180*Math.PI,d);0!==
c&&k.mat4d.rotateY(d,c/180*Math.PI,d);return d};h.demResolutionForBoundingBox=function(b,c){return null!=c.minDemResolution?c.minDemResolution:a.isPoint(b)?c.minDemResolutionForPoints:.01*a.maximumDimension(b)};var r=[0,0]})},"esri/views/3d/support/debugFlags":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(q,h,e,a,d,b){return new (function(d){function c(){var a=
null!==d&&d.apply(this,arguments)||this;a.SCENEVIEW_HITTEST_RETURN_SELECTOR=!1;a.SCENEVIEW_LOCKING_LOG=!1;a.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED=!1;a.HIGHLIGHTS_VISUALIZE_BLOCKS=!1;a.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1;a.DECONFLICTOR_SHOW_OUTLINES=!1;a.DECONFLICTOR_SHOW_GRID=!1;a.LABELS_SHOW_BORDER=!1;a.OVERLAY_DRAW_TEST_TEXTURE=!1;a.OVERLAY_SHOW_CENTER=!1;a.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS=!1;a.DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES=!1;a.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=
!1;a.DRAW_MESH_GEOMETRY_NORMALS=!1;a.FEATURE_TILE_FETCH_SHOW_TILES=!1;a.FEATURE_TILE_TREE_SHOW_TILES=!1;a.ENABLE_PROFILE_DEPTH_RANGE=!1;return a}e(c,d);a([b.property()],c.prototype,"SCENEVIEW_HITTEST_RETURN_SELECTOR",void 0);a([b.property()],c.prototype,"SCENEVIEW_LOCKING_LOG",void 0);a([b.property()],c.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED",void 0);a([b.property()],c.prototype,"HIGHLIGHTS_VISUALIZE_BLOCKS",void 0);a([b.property()],c.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0);a([b.property()],
c.prototype,"DECONFLICTOR_SHOW_OUTLINES",void 0);a([b.property()],c.prototype,"DECONFLICTOR_SHOW_GRID",void 0);a([b.property()],c.prototype,"LABELS_SHOW_BORDER",void 0);a([b.property()],c.prototype,"OVERLAY_DRAW_TEST_TEXTURE",void 0);a([b.property()],c.prototype,"OVERLAY_SHOW_CENTER",void 0);a([b.property()],c.prototype,"TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS",void 0);a([b.property()],c.prototype,"DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES",void 0);a([b.property()],c.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",
void 0);a([b.property()],c.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0);a([b.property()],c.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0);a([b.property()],c.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0);a([b.property()],c.prototype,"ENABLE_PROFILE_DEPTH_RANGE",void 0);return c=a([b.subclass()],c)}(b.declared(d)))})},"esri/views/3d/layers/graphics/Graphics3DObject3DGraphicLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../geometry/support/aaBoundingBox ./featureExpressionInfoUtils ./Graphics3DGraphicElevationContext ./graphicUtils ../../lib/glMatrix ../../webgl-engine/Stage".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n){q=function(){function e(a,b,d,f,g,k,m,l){this.type="object3d";this._addedToStage=!1;this.alignedTerrainElevation=0;this.needsElevationUpdates=!1;this.graphics3DSymbolLayer=a;this.uniqueMaterials=f;this.uniqueGeometries=d;this.uniqueTextures=g;this.stageObject=b;this.elevationAligner=k;this.elevationContext=new c(m);this.stageLayer=this.stage=null;this._visible=!1;this.visibilityMode=null!=l?l:e.VisibilityModes.HIDE_FACERANGE}e.prototype.initialize=function(a,b){this.stageLayer=
a;this.stage=b;if(this.uniqueMaterials)for(a=0;a<this.uniqueMaterials.length;a++)b.add(n.ModelContentType.MATERIAL,this.uniqueMaterials[a]);if(this.uniqueGeometries)for(a=0;a<this.uniqueGeometries.length;a++)b.add(n.ModelContentType.GEOMETRY,this.uniqueGeometries[a]);if(this.uniqueTextures)for(a=0;a<this.uniqueTextures.length;a++)b.add(n.ModelContentType.TEXTURE,this.uniqueTextures[a]);b.add(n.ModelContentType.OBJECT,this.stageObject)};e.prototype.setVisibility=function(a){if(null!=this.stage)return this._visible!==
a?((this._visible=a)?this._addedToStage?this.stageObject.unhideAllComponents():(this.stageLayer.addObject(this.stageObject),this._addedToStage=!0):this.visibilityMode===e.VisibilityModes.HIDE_FACERANGE?this.stageObject.hideAllComponents():(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1),(a=this.stage.view.getEdgeView())&&a.hasObject(this.stageObject)&&a.updateObjectVisibility(this.stageObject,this._visible),!0):!1};e.prototype.destroy=function(){var a=this.stage;if(this.stageLayer){if(this.uniqueMaterials)for(var b=
0;b<this.uniqueMaterials.length;b++)a.remove(n.ModelContentType.MATERIAL,this.uniqueMaterials[b].id);if(this.uniqueGeometries)for(b=0;b<this.uniqueGeometries.length;b++)a.remove(n.ModelContentType.GEOMETRY,this.uniqueGeometries[b].id);if(this.uniqueTextures)for(b=0;b<this.uniqueTextures.length;b++)a.remove(n.ModelContentType.TEXTURE,this.uniqueTextures[b].id)}a.remove(n.ModelContentType.OBJECT,this.stageObject.id);this._addedToStage&&(this.stageLayer.removeObject(this.stageObject),this._addedToStage=
!1);(a=this.stage.view.getEdgeView())&&a.hasObject(this.stageObject)&&a.removeObject(this.stageObject);this._visible=!1;this.stage=this.stageLayer=null};e.prototype.alignWithElevation=function(a,b,c){this.elevationAligner&&(g.setContextFeature(this.elevationContext.featureExpressionInfoContext,c),a=this.elevationAligner(this,this.elevationContext,a,b),null!=a&&(this.alignedTerrainElevation=a))};e.prototype.getBSRadius=function(){return this.stageObject.getBSRadius()};e.prototype.getCenterObjectSpace=
function(){return this.stageObject.getCenter(!0)};e.prototype.getBoundingBoxObjectSpace=function(a){var c=this.stageObject;a||(a=b.create());b.setMin(a,c.getBBMin(!0));b.setMax(a,c.getBBMax(!0));return a};e.prototype.getProjectedBoundingBox=function(c,g,e,n){return d(this,void 0,void 0,function(){var d,u,t,h,v,A,x,q,H;return a(this,function(a){switch(a.label){case 0:d=this.getBoundingBoxObjectSpace(e);u=r;t=b.isPoint(d)?1:u.length;for(h=0;h<t;h++)v=u[h],p[0]=d[v[0]],p[1]=d[v[1]],p[2]=d[v[2]],k.mat4d.multiplyVec3(this.stageObject.objectTransformation,
p),l[3*h+0]=p[0],l[3*h+1]=p[1],l[3*h+2]=p[2];if(!c(l,0,t))return[2,null];b.empty(d);A=null;this.calculateRelativeScreenBounds&&(A=this.calculateRelativeScreenBounds());for(h=0;h<3*t;h+=3){for(x=0;3>x;x++)d[x]=Math.min(d[x],l[h+x]),d[x+3]=Math.max(d[x+3],l[h+x]);A&&n.push({location:l.slice(h,h+3),screenSpaceBoundingRect:A})}if(!g)return[3,5];b.center(d,m);if("absolute-height"===this.elevationContext.mode)return[3,5];q=void 0;H=f.demResolutionForBoundingBox(d,g);a.label=1;case 1:return a.trys.push([1,
3,,4]),[4,g.service.queryElevation(m[0],m[1],H)];case 2:return q=a.sent(),[3,4];case 3:return a.sent(),q=null,[3,4];case 4:null!=q&&b.offset(d,0,0,-this.alignedTerrainElevation+q),a.label=5;case 5:return[2,d]}})})};e.prototype.addHighlight=function(a,b){b=this.stageObject.highlightAllComponents(b);a.addObject(this.stageObject,b)};e.prototype.removeHighlight=function(a){a.removeObject(this.stageObject)};return e}();(function(a){a=a.VisibilityModes||(a.VisibilityModes={});a[a.REMOVE_OBJECT=0]="REMOVE_OBJECT";
a[a.HIDE_FACERANGE=1]="HIDE_FACERANGE"})(q||(q={}));var l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],p=k.vec3d.create(),m=k.vec3d.create(),r=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];return q})},"esri/views/3d/layers/graphics/Graphics3DGraphicElevationContext":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./ElevationContext"],function(q,h,e,a){return function(a){function b(b){b=a.call(this,b)||this;b.centerPointInElevationSR=null;
return b}e(b,a);return b}(a)})},"esri/views/3d/layers/graphics/ElevationContext":function(){define(["require","exports","../../../../symbols/support/unitConversionUtils","./featureExpressionInfoUtils"],function(q,h,e,a){return function(){function d(a){a?this.set(a):this.setDefaults()}Object.defineProperty(d.prototype,"meterUnitOffset",{get:function(){return this._meterUnitOffset},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"unit",{get:function(){return this._unit},enumerable:!0,
configurable:!0});d.prototype.setUnit=function(a){this._unit=a;this._metersPerElevationInfoUnit=e.getMetersPerUnit(a)};d.prototype.setDefaults=function(){this.mode=null;this._renderUnitOffset=this._meterUnitOffset=0;this.featureExpressionInfoContext=null;this.hasOffsetAdjustment=!1;this.setUnit("meters")};d.prototype.set=function(a){this.mode=a.mode;this._meterUnitOffset=a._meterUnitOffset||0;this._renderUnitOffset=a._renderUnitOffset||0;this.featureExpressionInfoContext=a.featureExpressionInfoContext;
this.hasOffsetAdjustment=a.hasOffsetAdjustment;this.setUnit(a.unit)};d.prototype.setOffsetMeters=function(a){this._meterUnitOffset=a;this._renderUnitOffset=0};d.prototype.setOffsetElevationInfoUnits=function(a){this._meterUnitOffset=a*this._metersPerElevationInfoUnit;this._renderUnitOffset=0};d.prototype.setOffsetRenderUnits=function(a){this._meterUnitOffset=0;this._renderUnitOffset=a};d.prototype.addOffsetRenderUnits=function(a){this._renderUnitOffset+=a};d.prototype.mixinApi=function(a){null!=a.mode&&
(this.mode=a.mode);null!=a.unit&&this.setUnit(a.unit);null!=a.offset&&this.setOffsetElevationInfoUnits(a.offset)};d.prototype.calculateOffsetRenderUnits=function(b){var d=this._meterUnitOffset,c=this.featureExpressionInfoContext;null!=c&&(d+=a.execute(c)*this._metersPerElevationInfoUnit);return d/b.unitInMeters+this._renderUnitOffset};return d}()})},"esri/views/3d/webgl-engine/Stage":function(){define("require exports ./lib/gl-matrix ./lib/ModelContentType ./lib/Selector ./lib/Util ./lighting/Lightsources ./parts/Model ./parts/View".split(" "),
function(q,h,e,a,d,b,g,c,f){q=e.vec2d;h=e.vec2;var k=e.vec3d;e=function(){function e(a,b,e){this._intersectTolerance=d.DEFAULT_TOLERANCE;this._viewContent=[];this._externalIntersectionHandlers=[];this.container=b;this.viewingMode=a;this.model=new c;this.view=new f(b,this,this.model.getDirtySet(),e);this._validateHUDSelector=new d(this.viewingMode);this._validateHUDSelector.enableHUDSelection=!1;this.view.setLighting({lights:[new g.MainLight(k.createFrom(.7,.7,.7)),new g.AmbientLight(k.createFrom(.3,
.3,.3))],groundLightingFactor:.5,globalFactor:.5})}e.prototype.setNeedsRender=function(){this.view.setNeedsRender()};e.prototype.dispose=function(){this.view.dispose();this.model=this.view=null};e.prototype.beginMod=function(){e.DebugSettings.fineGrainedContentValidation&&this.model.validateContent()};e.prototype.endMod=function(a){void 0===a&&(a=!1);e.DebugSettings.fineGrainedContentValidation&&!a&&this.model.validateContent()};e.prototype.add=function(a,b){this.model.add(a,b);"function"===typeof b.addParentStage&&
b.addParentStage(this)};e.prototype.remove=function(a,b){a=this.model.remove(a,b);"function"===typeof a.removeParentStage&&a.removeParentStage(this);return a};e.prototype.notifyDirty=function(a,b,c,d){this.model.notifyDirty(a,b,c,d)};e.prototype.processDirty=function(){var a=this.model.getDirtySet(),b=a.getDirtyMaterials();if(a.hasDirtyGeometryRecords()||b){e.DebugSettings.endFrameContentValidation&&this.model.validateContent();e.DebugSettings.logDirtySet&&console.log("Dirty set: "+this.model.getDirtySet().formatDebugInfo(!1));
var c=a.commitLayers(this._viewContent);(0<c[0].length+c[1].length+c[2].length||b)&&this.view.modify(c[0],c[1],c[2],b);e.DebugSettings.logDirtySet&&(console.log("RGs add: "+c[0].map(function(a){return a.uniqueName})),console.log("RGs remove: "+c[1].map(function(a){return a.uniqueName})));a.commit();a.clearDirtyMaterials();this.view.setNeedsRender()}};e.prototype.processDirtyLayer=function(a){var b=this.model.getDirtySet(),c=b.getDirtyMaterials();a=b.commitLayers([a]);(0<a[0].length+a[1].length+a[2].length||
c)&&this.view.modify(a[0],a[1],a[2],c);b.clearDirtyMaterials();this.view.setNeedsRender()};e.prototype.get=function(a,b){return this.model.get(a,b)};e.prototype.getAll=function(a){return this.model.getAll(a)};e.prototype.addTextureListener=function(a){this.view.addTextureListener(a)};e.prototype.removeTextureListener=function(a){this.view.removeTextureListener(a)};e.prototype.getContainer=function(){return this.container};e.prototype.getCamera=function(){return this.view.getCamera()};e.prototype.setCamera=
function(a){this.view.setCamera(a)};e.prototype.getViewParams=function(a){return this.view.getViewParams(a)};e.prototype.setViewParams=function(a){this.view.setViewParams(a)};e.prototype.getLayers=function(){return this.model.getAll(a.LAYER)};e.prototype.setLighting=function(a){this.view.setLighting(a)};e.prototype.getCanvas=function(){return this.view.getCanvas()};e.prototype.setRenderParams=function(a){this.view.setRenderParams(a)};e.prototype.getRenderParams=function(){return this.view.getRenderParams()};
e.prototype.has=function(a){return this.view.has(a)};e.prototype.getViewContent=function(){return this._viewContent.slice(0)};e.prototype.setViewContent=function(a){var c=b.array2object(this._viewContent),d=b.array2object(a),f=b.subtractObjects(d,c),c=b.subtractObjects(c,d);this.processDirty();d=this.model.getDirtySet();f=d.getResidentRenderGeometriesFilteredByLayers(b.object2array(f));c=d.getResidentRenderGeometriesFilteredByLayers(b.object2array(c));this.view.modify(f,c,[]);this._viewContent=a.slice(0)};
e.prototype.addToViewContent=function(a){for(var b=[],c=0;c<a.length;c++)-1===this._viewContent.indexOf(a[c])&&b.push(a[c]);0<a.length&&(this.processDirty(),a=this.model.getDirtySet().getResidentRenderGeometriesFilteredByLayers(b),this.view.modify(a,[],[]),this._viewContent.push.apply(this._viewContent,b))};e.prototype.removeFromViewContent=function(a){this.processDirty();for(var b=this.model.getDirtySet(),c=this._viewContent,d=[],f=0;f<a.length;f++){var g=c.indexOf(a[f]);-1<g&&(c[g]=c[c.length-1],
c.pop(),d.push(a[f]))}a=b.getResidentRenderGeometriesFilteredByLayers(d);this.view.modify([],a,[])};e.prototype.getLocalOrigin=function(a,b,c){return this.model.getOrigin(a,b,c)};e.prototype.getFrameTask=function(){return this.view.getFrameTask()};e.prototype.requestScreenCapture=function(a,b){this.view.requestScreenCapture(a,b)};e.prototype.getAllTexturesLoaded=function(){return this.view.getAllTexturesLoaded()};e.prototype.getTextureLoaded=function(a){return this.view.getTextureLoaded(a)};e.prototype.addExternalRenderer=
function(a,b){"function"===typeof b.intersect&&this._externalIntersectionHandlers.push(b);return this.view.addExternalRenderer(a,b)};e.prototype.removeExternalRenderer=function(a){var b=this._externalIntersectionHandlers.indexOf(a);-1<b&&this._externalIntersectionHandlers.splice(b,1);return this.view.removeExternalRenderer(a)};e.prototype.getContentDebugStrings=function(a){return this.model.formatDebugInfo(a)};e.prototype.getRenderStats=function(){return this.view.getCombinedStats()};e.prototype.getRenderStatString=
function(a){var b=this.getRenderStats(),c="";if(a){var c=c+"\x3ctable\x3e",d;for(d in b)c+="\x3ctr\x3e\x3ctd\x3e"+d+'\x3c/td\x3e\x3ctd style\x3d"text-align: right"\x3e'+Math.round(b[d])+"\x3c/td\x3e\x3c/tr\x3e";c+="\x3c/table\x3e"}else for(d in b)c+=d+": "+b[d]+"\n";return c};e.prototype.pick=function(a,b,c,d){var f=k.create(),g=k.create();this.view.getPickRay(a,f,g);return this.pickRay(f,g,a,a,b,c,d)};e.prototype.pickRayWithBeginPoint=function(a,b,c,d,f){this.view.pickRayWithBeginPoint(a,b,c,d,f)};
e.prototype.pickRay=function(a,b,f,g,e,m,h){g=this.view.getCamera();f||(f=n,g.projectPoint(b,f));var u;if(e){u=Array(e.length);for(var r=0;r<u.length;r++)u[r]=this.model.get(c.ContentType.LAYER,e[r])}else{u=[];e=this.getViewContent();for(var t=this.model.getAll(c.ContentType.LAYER),r=0;r<e.length;r++){var v=t[e[r]];v&&v.isPickable&&u.push(v)}}h?h.init(u,a,b,f,g,this._intersectTolerance,m):h=new d(this.viewingMode,u,a,b,f,g,this._intersectTolerance,m);for(r=0;r<this._externalIntersectionHandlers.length;r++)this._externalIntersectionHandlers[r].intersect(h,
a,b,f);if(h.getHudResults().length){r=h.getHudResults();r.sort(function(a,b){return b.dist-a.dist});b=r[r.length-1];e=l;g.projectPoint(b.center,e);e[0]=Math.round(e[0]);e[1]=Math.round(e[1]);t=p;this.view.getPickRay(e,a,t);f=k.dist(b.center,a)/k.dist(a,t)*.99;this._validateHUDSelector.init(u,a,t,e,g,this._intersectTolerance,m);for(r=0;r<this._externalIntersectionHandlers.length;r++)this._externalIntersectionHandlers[r].intersect(this._validateHUDSelector,a,t,e);a=this._validateHUDSelector.getMinResult();
(null==a.dist||f<=a.dist)&&h.getMinResult().copyFrom(b)}return h};e.prototype.getIntersectTolerance=function(){return this._intersectTolerance};e.prototype.setIntersectTolerance=function(a){void 0===a&&(a=1E-5);this._intersectTolerance=a};e.prototype.getDrapedTextureRenderer=function(){return this.view.getDrapedTextureRenderer()};e.DebugSettings={fineGrainedContentValidation:!1,endFrameContentValidation:!1,logDirtySet:!1};e.ModelContentType=a;return e}();var n=q.create(),l=h.create(),p=k.create();
return e})},"esri/views/3d/webgl-engine/parts/Model":function(){define("require exports dojo/string ../lib/gl-matrix ../lib/ModelContentType ../lib/ModelDirtySet ../lib/RenderGeometry ../lib/Util".split(" "),function(q,h,e,a,d,b,g,c){var f=c.assert,k=a.vec3d,n=a.mat4d,l=c.logWithBase;return function(){function a(){this.dirtySet=new b(this);this._uniqueIdx=0;this._id2origin={};this.content={};for(var a in d)this.content[d[a]]={}}a.prototype.getAll=function(a){a=this.content[a];f(void 0!==a);return a};
a.prototype.get=function(a,b){return this.getAll(a)[b]};a.prototype.add=function(a,b){var c=this.content[a];f(void 0!==c);var g=b.id;f(null==c[g],"Model/Stage already contains object to be added");c[g]=b;a===d.LAYER&&this.notifyDirty(a,b,"layerAdded")};a.prototype.remove=function(a,b){var c=this.content[a];f(void 0!==c);var g=c[b];f(void 0!==g,"Model/Stage doesn't contain object to be removed");delete c[b];a===d.TEXTURE&&g.unload();a===d.LAYER&&this.notifyDirty(a,g,"layerRemoved");return g};a.prototype.getDirtySet=
function(){return this.dirtySet};a.prototype.notifyDirty=function(a,b,c,d){this.dirtySet.handleUpdate(b,c,d)};a.prototype.getOrigin=function(a,b,c){void 0===c&&(c=10);var d=0;b=b*c/1E4;1<b&&(d=Math.ceil(l(b,2)));b=1E4*Math.pow(2,d);c=Math.round(a[0]/b);var f=Math.round(a[1]/b);a=Math.round(a[2]/b);var d=d+"_"+c+"_"+f+"_"+a,g=this._id2origin[d];null==g&&(g={vec3:k.createFrom(c*b,f*b,a*b),id:d},this._id2origin[d]=g);return g};a.prototype.getGeometryRenderGeometries=function(a,b,c){var d=a.id,f=b.geometry,
e=f.getData(),k=!!f.singleUse,l=b.materials,m=b.instanceParameters,p=a.getCombinedStaticTransformation(b),r=n.maxScale(p),h=b.origin,f=f.getBoundingInfo(),t=b.id,q=this._uniqueIdx++;a=new g(e,f,l[0],p,b.customTransformation,r,a.getCastShadow(),k,d,t,q);a.origin=h||this.getOrigin(a.center,a.bsRadius);a.instanceParameters=m;c.push(a)};a.prototype.updateRenderGeometryTransformation=function(a,b,c){a.getCombinedStaticTransformation(b,c.transformation);c.updateTransformation(c.transformation)};a.prototype.formatDebugInfo=
function(a){var b=[];if(a){b[0]="\x3ctable\x3e";for(var c in d)a=d[c],b[0]+="\x3ctr\x3e\x3ctd\x3e"+a+'\x3c/td\x3e\x3ctd style\x3d"text-align: right"\x3e'+Object.keys(this.getAll(a)).length+"\x3c/td\x3e\x3c/tr\x3e";b[0]+="\x3c/table\x3e";b[1]=this.dirtySet.formatDebugInfo(!0)}else{b[0]="";for(c in d)a=d[c],b[0]+=e.pad(String(Object.keys(this.getAll(a)).length),6," ")+" "+a+", ";b[1]=this.dirtySet.formatDebugInfo(!1)}return b};a.prototype.validateContent=function(){var a=this.getAll(d.OBJECT),b;for(b in a)this.validateObject(a[b]);
var a=this.getAll(d.LAYER),c;for(c in a)this.validateLayer(a[c]);c=this.getAll(d.MATERIAL);for(var f in c)this.validateMaterial(c[f])};a.prototype.validateObject=function(a){a=a.geometryRecords;for(var b=0;b<a.length;++b){var c=a[b];f(null!=this.get(d.GEOMETRY,c.geometry.id));f(1===c.materials.length,"object materials do not match geometry groups");f(null!=this.get(d.MATERIAL,c.materials[0].id))}};a.prototype.validateLayer=function(a){a=a.getObjects();for(var b=0;b<a.length;++b){var c=this.get(d.OBJECT,
a[b].id);f(null!=c)}};a.prototype.validateMaterial=function(a){a=a.getAllTextureIds();for(var b=0;b<a.length;++b){var c=this.get(d.TEXTURE,a[b]);f(null!=c)}};a.ContentType=d;return a}()})},"esri/views/3d/webgl-engine/lib/ModelDirtySet":function(){define("require exports ../../../../core/arrayUtils ../../../../core/iteratorUtils ./ModelContentType ./Util".split(" "),function(q,h,e,a,d,b){return function(){function g(a){this._residentGeomRecords=new Map;this._dirtyGeomRecords=new Map;this._dirtyMaterials=
new Set;this._model=a}Object.defineProperty(g.prototype,"residentLayerCount",{get:function(){return this._residentGeomRecords.size},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"residentObjectCount",{get:function(){var a=0;this._residentGeomRecords.forEach(function(b){a+=b.size});return a},enumerable:!0,configurable:!0});g.prototype.getDirtyMaterials=function(){return 0<this._dirtyMaterials.size?this._dirtyMaterials:null};g.prototype.clearDirtyMaterials=function(){this._dirtyMaterials.clear()};
g.prototype.hasDirtyGeometryRecords=function(){var b=!1;a.forEachUntilMap(this._dirtyGeomRecords,function(c){if(b)return!1;a.forEachUntilMap(c,function(a){if(!b&&a&&0<a.size)return b=!0,!1})});return b};g.prototype.handleUpdate=function(a,d,g){b.assert(this[d],"ModelDirtySet doesn't know how to process "+d);return this[d](a,g)};g.prototype.shaderTransformationChanged=function(a){var b=this;(a=this._residentGeomRecords.get(a.id))&&a.forEach(function(a,c){(c=b._model.content[d.OBJECT][c])&&c.hasVolativeTransformation()&&
a.forEach(function(a){var b=0;for(a=a[1];b<a.length;b++)a[b].shaderTransformationChanged()})})};g.prototype.commit=function(){return this.commitLayers(e.keysOfMap(this._dirtyGeomRecords))};g.prototype.commitLayers=function(a){for(var c=this,g=[],e=[],l=[],p=function(f){var k=a[f];f=m._dirtyGeomRecords.get(k);if(!f)return"continue";f.forEach(function(a,f){var m=c._ensureGeomRecord(k,f);a.forEach(function(a,k){var n=a[0],p=a[1];a=a[2];var u=p&2&&a&1;if(p&4||u){var r=m.get(k);r?e.push.apply(e,r[1]):
4===p&&b.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove");r&&m.delete(k)}if(p&1||u){var h=[n,[]],r=c._model.get(d.OBJECT,f);c._model.getGeometryRenderGeometries(r,n,h[1]);g.push.apply(g,h[1]);m.set(k,h)}if(p&2&&!u)if(r=m.get(k)){k=r[1];p=k.length;if(a&16)for(r=c._model.get(d.OBJECT,f),u=0;u<p;u++)h=k[u],c._model.updateRenderGeometryTransformation(r,n,h);for(u=0;u<p;u++)h=k[u],l.push({renderGeometry:h,updateType:a})}else b.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")});
0===m.size&&c._residentGeomRecords.get(k).delete(f)});0===m._residentGeomRecords.get(k).size&&m._residentGeomRecords.delete(k);m._dirtyGeomRecords.delete(k)},m=this,r=0;r<a.length;r++)p(r);return[g,e,l]};g.prototype.getResidentRenderGeometries=function(){return this.getResidentRenderGeometriesFilteredByLayers(e.keysOfMap(this._residentGeomRecords))};g.prototype.getResidentRenderGeometriesFilteredByLayers=function(a){for(var b=[],c=0;c<a.length;c++){var d=this._residentGeomRecords.get(a[c]);d&&d.forEach(function(a){a.forEach(function(a){b.push.apply(b,
a[1])})})}return b};g.prototype.visibilityChanged=function(a,b,d){if(null!=b)this._componentPropertyChanged(a,b,d,2);else{b=0;for(var c=a.getGeometryRecords();b<c.length;b++)this._componentPropertyChanged(a,c[b],d,2)}};g.prototype.componentHighlightChanged=function(a,b,d){if(null!=b)this._componentPropertyChanged(a,b,d,32);else{b=0;for(var c=a.getGeometryRecords();b<c.length;b++)this._componentPropertyChanged(a,c[b],d,32)}};g.prototype.vertexAttrsUpdated=function(a,b,d){this._updateOrCreateDirtyRecord(a,
b,d,2,0,0,2,5,4)};g.prototype.matChanged=function(a){this._dirtyMaterials.add(a.id);if(this.onMaterialChanged)this.onMaterialChanged(a)};g.prototype.layerAdded=function(a){for(var b=a.getObjects(),c=0;c<b.length;c++)this.layObjectAdded(a,b[c])};g.prototype.layerRemoved=function(a){for(var b=a.getObjects(),c=0;c<b.length;c++)this.layObjectRemoved(a,b[c])};g.prototype.layObjectAdded=function(a,b){a=a.id;for(var c=b.getGeometryRecords(),d=0;d<c.length;d++)this.objGeometryAdded(b,c[d],a)};g.prototype.layObjectRemoved=
function(a,b){a=a.id;for(var c=b.getGeometryRecords(),d=0;d<c.length;d++)this.objGeometryRemoved(b,c[d],a)};g.prototype.layObjectReplaced=function(a,b){this.layObjectRemoved(a,b[0]);this.layObjectAdded(a,b[1])};g.prototype.objDirty=function(a,b){var c=this;b=b||this._getParentLayerId(a);this._ensureGeomRecord(b,a.id).forEach(function(d){c._updateOrCreateDirtyRecord(a,d[0],b,2,0,2,0,5,1)})};g.prototype.objTransformation=function(a,b){var c=this;b=b||this._getParentLayerId(a);this._ensureGeomRecord(b,
a.id).forEach(function(d){c._updateOrCreateDirtyRecord(a,d[0],b,2,0,0,2,5,16)})};g.prototype.objGeometryAdded=function(a,b,d){this._updateOrCreateDirtyRecord(a,b,d,1,4,0,0,0)};g.prototype.objGeometryRemoved=function(a,b,d){this._updateOrCreateDirtyRecord(a,b,d,4,1,2,0,0)};g.prototype.objGeometryReplaced=function(a,b){this.objGeometryRemoved(a,b[0]);this.objGeometryAdded(a,b[1])};g.prototype.objGeometryTransformation=function(a,b){this.objGeometryReplaced(a,b)};g.prototype._componentPropertyChanged=
function(a,b,d,g){this._updateOrCreateDirtyRecord(a,b,d,2,0,0,2,5,g)};g.prototype._updateOrCreateDirtyRecord=function(a,d,g,e,l,p,m,r,h){g=g||this._getParentLayerId(a);var c=d.id;a=this._ensureDirtyRecord(g,a.id);(g=a.get(c))?(d=g[1],d&l?a.delete(c):d&p?(g[1]=e,g[2]=h):d&m?g[2]|=h:d&r||b.assert(!1,"ModelDirtySet.objGeometryAdded: inconsistent state")):a.set(c,[d,e,h])};g.prototype._ensureGeomRecord=function(a,b){var c=this._residentGeomRecords.get(a);c||(c=new Map,this._residentGeomRecords.set(a,
c));a=c.get(b);a||(a=new Map,c.set(b,a));return a};g.prototype._ensureDirtyRecord=function(a,b){var c=this._dirtyGeomRecords.get(a);c||(c=new Map,this._dirtyGeomRecords.set(a,c));a=c.get(b);a||(a=new Map,c.set(b,a));return a};g.prototype._getParentLayerId=function(a){return a.parentLayer.id};g.prototype.formatDebugInfo=function(a){if(a)return"";var b=["ADD","UPD",void 0,"REM"],c="";this._dirtyGeomRecords.forEach(function(a,d){a.forEach(function(a,f){0<c.length&&(c+="\n");c+=d+"."+f;var g=[];a.forEach(function(a){var b=
a[1];g[b]||(g[b]=[]);g[b].push(a[0].geometry.id)});for(a=0;a<g.length;a++)if(g[a])for(c+=" "+b[a-1]+": ",f=0;f<g[a].length;f++)c+=g[a][f]+", "})});return c};return g}()})},"esri/views/3d/webgl-engine/lib/RenderGeometry":function(){define(["require","exports","./gl-matrix"],function(q,h,e){var a=e.vec3d,d=e.mat4d;return function(){function b(b,c,d,e,n,l,p,m,r,h,u){this.shaderTransformationDirty=!0;this.data=b.toRenderData();this.componentOffsets=b.componentOffsets;this.boundingInfo=c;this.material=
d;this.origin=null;this.center=a.create();this.bsRadius=0;this.transformation=null;this.calculateShaderTransformation=n;e&&this.updateTransformation(e,l);this.castShadow=p;this.singleUse=m;this.name=r;this.uniqueName=h;this.idx=u;this.canBeMerged=!0;this.instanceParameters={}}b.prototype.updateTransformation=function(a,b){this.transformation=a;this.shaderTransformationDirty=!0;this.bsRadius=this.getBoundingSphere(a,b,this.center)};b.prototype.shaderTransformationChanged=function(){this.shaderTransformationDirty=
!0};b.prototype.getBoundingSphere=function(a,b,f){b=b||d.maxScale(a);d.multiplyVec3(a,this.boundingInfo.getCenter(),f);return this.boundingInfo.getBSRadius()*b};Object.defineProperty(b.prototype,"hasShaderTransformation",{get:function(){return!!this.calculateShaderTransformation},enumerable:!0,configurable:!0});b.prototype.getShaderTransformation=function(){return this.calculateShaderTransformation?(this.shaderTransformationDirty&&(this.shaderTransformation||(this.shaderTransformation=d.create()),
d.set(this.calculateShaderTransformation(this.transformation),this.shaderTransformation),this.shaderTransformationDirty=!1),this.shaderTransformation):this.transformation};return b}()})},"esri/views/3d/webgl-engine/parts/View":function(){define("require exports ../../../../core/Logger ../../../../core/sniff ../lib/DrapedRenderer ../lib/gl-matrix ../lib/GLMaterialRep ../lib/GLTextureRep ../lib/HighlightHelper ../lib/OffscreenRenderingHelper ../lib/ProgramRepository ../lib/RenderOccludedHelper ../lib/ShaderSnippets ../lib/SSAOHelper ../lib/tracer ../lighting/Lightsources ../materials/repository ./Model ./Viewport ../../../support/screenshotUtils ../../../webgl/context-util ../../../webgl/RenderingContext".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u,x,v,A,y,C){var B=b.vec3d,D=b.vec4d,E=e.getLogger("esri.views.3d.webgl-engine.parts.View");return function(){function b(a,b,f,e){var k=this;this._backgroundColor=D.createFrom(1,1,1,1);this._lightDirection=B.createFrom(0,1,0);this._didRender=!1;this._idleSuspend=this._needsRender=!0;this._shouldRender=!1;this._screenCaptureQueue=[];this._container=a;this._stage=b;this._initializeContext(e);this._initializeShaders(e);this._textureRep=new c(b.getAll(x.ContentType.TEXTURE),
this._programRepository,function(){return k._viewport.getCamera().viewport},this._rctx);this._materialRep=new g(this._textureRep,this._programRepository);this._viewport=new v(this._stage,this._programRepository,this._materialRep,this._textureRep,this._rctx);this._initializeViewportCamera();this._drapedRenderer=new d(this._rctx,this._canvas,this._programRepository,this._materialRep,this._textureRep,f);this._initializeFrameTask()}Object.defineProperty(b.prototype,"isLoadingResources",{get:function(){return this._viewport.isLoadingResources},
enumerable:!0,configurable:!0});b.prototype._initializeFrameTask=function(){var a=this;this._frameTask={preRender:function(){r.begin();a._stage.processDirty();a.needsRender()?(a._shouldRender=!0,a._viewport.getCamera().setGLViewport(a._rctx),a._rctx.setClearColor.apply(a._rctx,a._backgroundColor),a._rctx.clear(16640)):a._shouldRender=!1},render:function(){a._shouldRender&&(a._didRender=!0,a._viewport.render(a._lightDirection,null))},postRender:function(){r.end()},update:function(){a._performScreenCaptures();
a.resetNeedsRender()}}};b.prototype._initializeViewportCamera=function(){var a=this._container.getBoundingClientRect(),b=this._viewport.getCamera();b.viewport[2]=a.width;b.viewport[3]=a.height;this._viewport.setCamera(b)};b.prototype._initializeContext=function(b){this._canvas=b.canvas;this._canvas||(this._canvas=document.createElement("canvas"));this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");var c=y.createContextOrErrorHTML(this._canvas,{alpha:b.alpha||!1,premultipliedAlpha:!0,
antialias:!1,depth:!0,stencil:null==b.stencil?!0:b.stencil},b.renderContext);this._gl=r.instrumentContext(c);this._rctx=new C(this._gl,{disabledExtensions:b.deactivatedWebGLExtensions||{}});!b.alpha&&this._rctx.contextAttributes.alpha&&E.error("WebGL context has alpha channel even though no alpha channel was requested");!this._rctx.contextAttributes.alpha&&11<=a("safari")&&(this._container.style.backgroundColor="black");this._container.appendChild(this._canvas)};b.prototype._initializeShaders=function(a){this._shaderSnippets=
new p({enableRequiredExtensions:"\n#extension GL_OES_standard_derivatives : enable\n",fsprecisionf:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\nprecision highp sampler2D;\n#else\nprecision mediump float;\nprecision mediump sampler2D;\n#endif\n",vsprecisionf:"\nprecision highp float;\nprecision highp sampler2D;\n",viewingMode:"global"===a.viewingMode?"#define VIEWING_MODE_GLOBAL 1 \n":" #define VIEWING_MODE_LOCAL 1 \n"});this._programRepository=new n;u.initializeShaders(this._shaderSnippets,
this._programRepository,this._rctx);f.loadShaders(this._shaderSnippets,this._programRepository,this._rctx);l.loadShaders(this._shaderSnippets,this._programRepository,this._rctx);m.loadShaders(this._shaderSnippets,this._programRepository,this._rctx);k.loadShaders(this._shaderSnippets,this._programRepository,this._rctx)};b.prototype.dispose=function(){this._viewport.dispose();this._viewport=null;this._drapedRenderer.dispose();this._drapedRenderer=null;this._programRepository.dispose();this._programRepository=
null;this._container.contains(this._canvas)&&this._container.removeChild(this._canvas);this._gl=this._canvas=this._container=null};b.prototype.getCombinedStats=function(){return this._viewport.getCombinedStats()};b.prototype.setNeedsRender=function(){this._didRender=!1;this._needsRender=!0};b.prototype.resetNeedsRender=function(){this._didRender&&(this._didRender=this._needsRender=!1);this._viewport.resetNeedsRender();this._textureRep.resetNeedsRender()};b.prototype.needsRender=function(){return this._needsRender||
!this._idleSuspend||this._viewport.needsRender()||this._textureRep.needsRender()};b.prototype.getFrameTask=function(){return this._frameTask};b.prototype.setLighting=function(a){B.set3(0,0,0,this._lightDirection);for(var b=0,c=a.lights;b<c.length;b++){var d=c[b];if(d instanceof t.MainLight){B.negate(d.direction,this._lightDirection);break}}this._viewport.setLighting(a);this._needsRender=!0};b.prototype.getEdgeView=function(){return this._viewport.getEdgeView()};b.prototype.getMainLightDirection=function(){return this._lightDirection};
b.prototype.getViewParams=function(a){var b=this._viewport.getViewParams(a);if(!a||a.backgroundColor)b.backgroundColor=this._backgroundColor;return b};b.prototype.setViewParams=function(a){this._needsRender=!0;a.backgroundColor&&(this._backgroundColor=a.backgroundColor);this._viewport.setViewParams(a)};b.prototype.setRenderParams=function(a){this._needsRender=!0;void 0!==a.idleSuspend&&(this._idleSuspend=!!a.idleSuspend);this._viewport.setRenderParams(a)};b.prototype.getRenderParams=function(){var a=
this._viewport.getRenderParams();a.anisotropicFiltering=this._textureRep.getMaxAnisotropy();a.idleSuspend=this._idleSuspend;return a};Object.defineProperty(b.prototype,"renderingContext",{get:function(){return this._rctx},enumerable:!0,configurable:!0});b.prototype.has=function(a){return"s3tc"===a?!!this._rctx.capabilities.compressedTextureS3TC:"standardDerivatives"===a?!!this._rctx.capabilities.standardDerivatives:"shaderTextureLOD"===a?!!this._rctx.capabilities.shaderTextureLOD:"instancedRendering"===
a?!!this._rctx.capabilities.instancing:!1};b.prototype.modify=function(a,b,c,d){this._viewport.modify(a,b,c,d)};b.prototype.setCamera=function(a){this._viewport.setCamera(a)};b.prototype.getCamera=function(){return this._viewport.getCamera()};b.prototype.getPickRay=function(a,b,c){this._viewport.getPickRay(a,b,c)};b.prototype.pickRayWithBeginPoint=function(a,b,c,d,f){this._viewport.pickRayWithBeginPoint(a,b,c,d,f)};b.prototype.getCanvas=function(){return this._canvas};b.prototype.getDrapedTextureRenderer=
function(){return this._drapedRenderer};b.prototype.requestScreenCapture=function(a,b){this._screenCaptureQueue.push({settings:a||{},callback:b});this._needsRender=!0};b.prototype.getAllTexturesLoaded=function(){return 0===this._textureRep.getLoadingCount()};b.prototype.getTextureLoaded=function(a){return this._textureRep.getIsLoaded(a)};b.prototype.addTextureListener=function(a){this._textureRep.addTextureListener(a)};b.prototype.removeTextureListener=function(a){this._textureRep.removeTextureListener(a)};
b.prototype.addExternalRenderer=function(a,b){return this._viewport.addExternalRenderer(a,b)?(b.initializeRenderContext({rctx:this._rctx,gl:this._rctx.gl,shaderSnippets:this._shaderSnippets,programRep:this._programRepository,textureRep:this._textureRep,materialRep:this._materialRep}),!0):!1};b.prototype.removeExternalRenderer=function(a){return this._viewport.removeExternalRenderer(a)?(a.uninitializeRenderContext({rctx:this._rctx,gl:this._rctx.gl}),!0):!1};b.prototype._performScreenCaptures=function(){if(0!==
this._screenCaptureQueue.length){for(var a=0;a<this._screenCaptureQueue.length;a++){var b=this._screenCaptureQueue[a],c=0,d=0,f=this._canvas.width,g=this._canvas.height,e=this._canvas.width,k=this._canvas.height,l=b.settings.area;l&&(c=l.x,d=l.y,f=l.width,g=l.height);void 0!==b.settings.width&&void 0!==b.settings.height?(l=b.settings.width/b.settings.height,g*l<f?(l*=g,c+=Math.floor((f-l)/2),f=Math.floor(l)):(l=f/l,d+=Math.floor((g-l)/2),g=Math.floor(l)),e=b.settings.width,k=b.settings.height):(e=
f,k=g);var m=this._canvas,l=null;if(0!==c||0!==d||f!==this._canvas.width||g!==this._canvas.height||e!==this._canvas.width||k!==this._canvas.height){this._resizeCanvas||(this._resizeCanvas=document.createElement("canvas"));this._resizeCanvas.width=e;this._resizeCanvas.height=k;var n=this._resizeCanvas.getContext("2d"),l=new Uint8Array(f*g*4);this._gl.readPixels(c,this._canvas.height-(d+g),f,g,6408,5121,l);c=n.getImageData(0,0,e,k);A.resampleHermite(l,f,g,c.data,e,k,!0);n.putImageData(c,0,0);m=this._resizeCanvas;
n=null}f={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"}[b.settings.format?b.settings.format.toLowerCase():"png"];g=1;void 0!==b.settings.quality&&(g=b.settings.quality/100);f={dataURL:m.toDataURL(f,g),x:0,y:0,width:e,height:k};b.settings.returnByteBuffer&&(f.data=l);b.callback(f)}this._screenCaptureQueue=[]}};return b}()})},"esri/views/3d/webgl-engine/lib/DrapedRenderer":function(){define("require exports ../../support/debugFlags ./Camera ./ComponentUtils ./DefaultVertexBufferLayouts ./gl-matrix ./glUtil3D ./HighlightUtils ./Renderer ./RenderPass ./Util ../lighting/Lightsources ../materials/internal/TexOnlyGLMaterial ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u){var x=g.vec3d,v=g.vec4d,A=g.mat4d;q=function(){function a(a,b,c,d,f,g){var e=this;this._renderTargets={};this._clearColor=v.createFrom(0,0,0,0);this._id2origin={};this._uniqueIdx=0;this._rctx=a;this._canvas=b;this._programRep=c;this._modelDirtySet=g;this._modelDirtySet.onMaterialChanged=function(a){return e.materialChanged(a)};this._renderer=new k(c,d,f,this._rctx,!0);this._renderer.onHasHighlightsChanged=function(a){if(e.onHasHighlightsChanged)e.onHasHighlightsChanged(a)};
this._renderer.setLighting({lights:[new p.AmbientLight(x.createFrom(1,1,1))],groundLightingFactor:1,globalFactor:0})}a.prototype.dispose=function(){for(var a in this._renderTargets)this._renderTargets[a].dispose();this._renderTargets=null;this._renderer.dispose();this._renderer=null};a.prototype.createRenderTarget=function(a){return this.createRenderTargetInternal(a,!0)};a.prototype.createHighlightRenderTarget=function(a){return this.createRenderTargetInternal(a,!1)};a.prototype.disposeRenderTarget=
function(a){var b=this._renderTargets[a];b&&b.dispose();delete this._renderTargets[a]};a.prototype.getRenderTargetTexture=function(a){return(a=this._renderTargets[a])?a.colorTexture:null};a.prototype.addRenderGeometries=function(a){var b=this;a.forEach(function(a){null==a.origin&&(a.origin=b.getOrigin(a.center,a.bsRadius));a.idx=b._uniqueIdx++});this._renderer.modify(a,[]);if(this.onContentChanged)this.onContentChanged()};a.prototype.removeRenderGeometries=function(a){this._renderer.modify([],a);
if(this.onContentChanged)this.onContentChanged()};a.prototype.updateRenderGeometries=function(a,b){a=a.map(function(a){return{renderGeometry:a,updateType:b}});this._renderer.modify([],[],a);if(this.onContentChanged)this.onContentChanged()};a.prototype.updateRenderOrder=function(a){if(0<a.size&&(this._renderer.modifyRenderOrder(a),this.onContentChanged))this.onContentChanged()};a.prototype.setBackgroundColor=function(a){this._clearColor=a;if(this.onContentChanged)this.onContentChanged()};a.prototype.addRenderGeometryHighlight=
function(a,b){var c=a.instanceParameters,g=f.generateHighlightId();c.componentHighlights=d.addHighlight(c.componentHighlights,null,b,g);this.updateRenderGeometries([a],32);return g};a.prototype.removeRenderGeometryHighlight=function(a,b){var c=a.instanceParameters;c.componentHighlights=d.removeHighlight(c.componentHighlights,b);this.updateRenderGeometries([a],32)};a.prototype.isEmpty=function(){return this._renderer.isEmpty()&&!e.OVERLAY_DRAW_TEST_TEXTURE};a.prototype.processDirtyMaterials=function(){var a=
this._modelDirtySet.getDirtyMaterials();a&&this._renderer.modify([],[],[],a);this._modelDirtySet.clearDirtyMaterials()};Object.defineProperty(a.prototype,"hasHighlights",{get:function(){return this._renderer.hasHighlights},enumerable:!0,configurable:!0});a.prototype.draw=function(a,b){return this.drawPass(n.MATERIAL,a,b)};a.prototype.drawHighlights=function(a,b){return this.drawPass(n.MATERIAL_HIGHLIGHT,a,b)};a.prototype.drawPass=function(a,b,c){if(this.isEmpty()||a===n.MATERIAL_HIGHLIGHT&&!this.hasHighlights)return!1;
this.processDirtyMaterials();if(!c.views.some(function(a){return a.extent[0]!==a.extent[2]&&a.extent[1]!==a.extent[3]}))return!1;b=this._renderTargets[b];if(!b)return!1;var d=this._rctx,f=d.gl,g=c.width,k=c.height;if(b.width!==g||b.height!==k)b.resize(g,k),b.colorTexture.setSamplingMode(9729);C.near=1;C.far=1E4;d.bindFramebuffer(b);d.setDepthTestEnabled(!1);d.setBlendFunctionSeparate(770,771,1,771);d.setClearColor.apply(d,this._clearColor);d.clear(f.COLOR_BUFFER_BIT);this._renderer.setPixelRatio(c.pixelRatio||
1);for(f=0;f<c.views.length;f++){var l=c.views[f];C.viewport=l.viewport;A.ortho(0,l.extent[2]-l.extent[0],0,l.extent[3]-l.extent[1],C.near,C.far,C.projectionMatrix);A.identity(C.viewMatrix);A.translate(C.viewMatrix,[-l.extent[0],-l.extent[1],0]);C.setGLViewport(this._rctx);e.OVERLAY_DRAW_TEST_TEXTURE&&this._drawTestTexture(g,k,y[c.index%y.length]);this._renderer.renderGeometryPass(a,C)}d.setDepthTestEnabled(!0);d.setBlendFunctionSeparate(770,771,1,771);d.bindFramebuffer(null);d.setViewport(0,0,this._canvas.width,
this._canvas.height);b.colorTexture.descriptor.hasMipmap&&b.colorTexture.generateMipmap();return!0};a.prototype._drawTestTexture=function(a,d,f){var g=this._rctx,e=g.gl;if(!this._testPatternMat){for(var k=new Uint8Array(a*d*4),l=0,n=0;n<d;n++)for(var p=0;p<a;p++){var r=Math.floor(p/10),h=Math.floor(n/10);2>r||2>h||10*r>a-20||10*h>d-20?(k[l++]=255,k[l++]=255,k[l++]=255,k[l++]=255):(k[l++]=255,k[l++]=255,k[l++]=255,r&1&&h&1?k[l++]=p&1^n&1?0:255:k[l++]=r&1^h&1?0:128)}a=new t(g,{target:3553,pixelFormat:6408,
dataType:5121,samplingMode:9728,width:a,height:d},k);this._testPatternMat=new m(this._programRep,a,[1,1,1,1],!0,e.ALWAYS);this._testPatternBindParams={proj:A.identity(),view:A.identity(),nearFar:[-1,1],origin:[0,0,0],viewInvTransp:null,viewport:null,lightingData:null,fovY:0};this._quadVAO=c.createQuadVAO(g,b.Pos3Tex)}this._testPatternMat.setColor([f[0],f[1],f[2],1]);this._testPatternMat.bind(g,this._testPatternBindParams);this._testPatternMat.bindView(g,this._testPatternBindParams);g.bindVAO(this._quadVAO);
g.drawArrays(5,0,u.vertexCount(this._quadVAO,"geometry"));this._testPatternMat.release(g)};a.prototype.getOrigin=function(a,b){var c=0;b=10*b/1E4;1<b&&(c=Math.ceil(l.logWithBase(b,2)));b=1E4*Math.pow(2,c);var d=Math.round(a[0]/b),f=Math.round(a[1]/b);a=Math.round(a[2]/b);var c=c+"_"+d+"_"+f+"_"+a,g=this._id2origin[c];null==g&&(g={vec3:x.createFrom(d*b,f*b,a*b),id:c},this._id2origin[c]=g);return g};a.prototype.materialChanged=function(a){if(this.onContentChanged)this.onContentChanged()};a.prototype.createRenderTargetInternal=
function(a,b){for(var c=a,d=0;this._renderTargets[c];)c=a+"_"+ ++d;this._renderTargets[c]=r.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,hasMipmap:b,maxAnisotropy:8,width:0,height:0},{colorTarget:0,depthStencilTarget:0});return c};return a}();var y=[[1,.5,.5],[.5,.5,1],[.5,1,.5]],C=new a;return q})},"esri/views/3d/webgl-engine/lib/Renderer":function(){define("require exports ../../../../core/iteratorUtils ./ComponentUtils ./DefaultVertexAttributeLocations ./ExternalRendererContainer ./Float32ArrayList ./FxaaRenderPass ./gl-matrix ./HighlightTextureHelper ./InstanceBufferData ./IntervalUtilities ./LinearDepthTextureHelper ./NormalTextureHelper ./RenderContext ./RenderPass ./RenderSlot ./SmaaRenderPass ./StencilRenderingHelper ./Util ./edgeRendering/EdgeView ../lighting/SceneLighting ../materials/HUDMaterial ../../../webgl/BufferObject ../../../webgl/Profiling ../../../webgl/Texture ../../../webgl/Util ../../../webgl/VertexArrayObject".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u,x,v,A,y,C,B,D,E,J,F,M){function H(b){return b.instanceParameters.hidden?[]:a.generateVisibleIndexRanges(b.instanceParameters.componentVisibilities,b.componentOffsets)}function I(a,b,c){var d=a.origin.vec3;A.setMatrixTranslation3(T,-d[0],-d[1],-d[2]);P.multiply(T,a.transformation,b);P.inverse(b,c);P.transpose(c)}function K(a,b,c){for(var d in a){var f=a[d];b(d,f);f.origin2data.forEach(function(a,b){c(b,a)})}}function O(a){return!1===a.preinterleaved?A.getFirstObjectValue(a.indices).length:
a.indexCount}q=f.vec2d;var P=f.mat4d,L=P.identity();f=function(){function f(a,d,f,g,e){this._lighting=new C.SceneLighting;this._mat2DataMerged={};this._mat2DataInstanced={};this._mat2DataPreinterleaved={};this._renderOrder=[];this._externalRenderers=new b;this._renderContext=new r;this._isRendering=!1;this._highlights=[];this._pixelRatio=1;this._threshold=1535;this._needsRender=!0;this._fallbackDepthStencilTexture=null;this._stats=new U;this._edgeView=null;this.ssaoEnabled=this._edgeViewLoaded=!1;
this.renderOptions={antialiasing:"smaa",earlyOcclusionPixelDraw:!1};this._programRep=a;this._materialRep=d;this._orderedRendering=e;this._rctx=g;this._fxaaPass=new c(g);this._smaaPass=new x(g);this._renderContext.rctx=g;this._renderContext.lightingData=this._lighting.getOld();g.setDepthTestEnabled(!0);g.setFaceCullingEnabled(!0);g.setBlendingEnabled(!1);g.setBlendFunctionSeparate(770,771,1,771);this._bindParameters={view:null,proj:null,viewInvTransp:null,fovY:0,nearFar:null,lightingData:null,viewport:null,
framebufferTex:null,shadowMappingEnabled:!1,ssaoEnabled:!1,origin:null,pixelRatio:null};this._linearDepthTextureHelper=new p(g);this._normalTextureHelper=new m(g);this._highlightTextureHelper=new k(g);this._stencilRenderingHelper=new v(g);this._initializeFramebufferTexture()}f.prototype._initializeFramebufferTexture=function(){var a=this._rctx.gl,a=this._rctx.contextAttributes.alpha?a.RGBA:a.RGB,b=new J(this._rctx,{target:3553,pixelFormat:a,dataType:5121,samplingMode:9728,wrapMode:33071,width:4,height:4});
this._framebuffer={format:a,texture:b}};f.prototype.dispose=function(){var a=this,b=function(b){a._releaseMaterials(b)},c=function(a,b){if(b.type===S.Preinterleaved)for(var c in b.instances)b.instances[c].vao.dispose(!0);else b.vao.dispose(!0)};K(this._mat2DataMerged,b,c);K(this._mat2DataInstanced,b,c);K(this._mat2DataPreinterleaved,b,c);this._mat2DataPreinterleaved=this._mat2DataInstanced=this._mat2DataMerged=null;this._framebuffer.texture.dispose();this._framebuffer.texture=null;this._linearDepthTextureHelper.enabled=
!1;this._normalTextureHelper.enabled=!1;this._highlightTextureHelper.enabled=!1;this._stencilRenderingHelper.enabled=!1;this._fallbackDepthStencilTexture&&(this._fallbackDepthStencilTexture.dispose(),this._fallbackDepthStencilTexture=null)};Object.defineProperty(f.prototype,"isLoadingResources",{get:function(){return"smaa"===this.renderOptions.antialiasing&&this._smaaPass.isLoadingResources},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"edgeView",{get:function(){var a=this;this._edgeViewLoaded||
(this._edgeViewLoaded=!0,y.EdgeView.isSupported(this._rctx)&&(this._edgeView=new y.EdgeView(this._rctx,this._programRep,{setNeedsRender:function(){a._needsRender=!0}}),this._edgeView.initialize()));return this._edgeView},enumerable:!0,configurable:!0});f.prototype.setLighting=function(a){this._lighting.set(a)};f.prototype.setPixelRatio=function(a){this._pixelRatio=a;this._needsRender=!0};f.prototype.getPixelRatio=function(){return this._pixelRatio};f.prototype.addExternalRenderer=function(a,b){this._externalRenderers.addRenderer(a,
b);return!0};f.prototype.removeExternalRenderer=function(a){this._externalRenderers.removeRenderer(a);return!0};f.prototype.getExternalRenderers=function(){return this._externalRenderers};f.prototype.resetNeedsRender=function(){this._needsRender=!1;this._externalRenderers.resetNeedsRender()};f.prototype.needsRender=function(){return this._needsRender||this._externalRenderers.needsRender()};f.prototype.getCombinedStats=function(){var a=this;this._stats.VBOallocatedSize=0;this._stats.VBOoptimalSize=
0;this._stats.VBOusedSize=0;var b=function(){},c=function(b,c){if(c.type===S.Preinterleaved)for(var d in c.instances)b=c.instances[d].vao.size,a._stats.VBOallocatedSize+=b/4,a._stats.VBOusedSize+=b/4,a._stats.VBOoptimalSize+=b/4;else a._stats.VBOallocatedSize+=c.buffer.getArray().length,a._stats.VBOusedSize+=c.buffer.getSize(),a._stats.VBOoptimalSize+=c.optimalCount};K(this._mat2DataMerged,b,c);K(this._mat2DataInstanced,b,c);K(this._mat2DataPreinterleaved,b,c);this._stats.VBOallocatedSize*=.00390625;
this._stats.VBOusedSize*=.00390625;this._stats.VBOoptimalSize*=.00390625;return this._stats};f.prototype._addHighlight=function(a){var b=this._getInstance(a);if(null===b)console.error("No instance found for RenderGeometry {name: '"+a.name+"', uniqueName: '"+a.uniqueName+"'}");else if(this._highlights.push(b),this._orderedRendering&&this._sortHighlightsByRenderOrder(),this._needsRender=!0,this.onHasHighlightsChanged)this.onHasHighlightsChanged(this.hasHighlights)};f.prototype._removeHighlight=function(a){var b=
this._highlights.length;this._highlights=this._highlights.filter(function(b){return b.uniqueName!==a.uniqueName});if(b!==this._highlights.length){if(this.onHasHighlightsChanged)this.onHasHighlightsChanged(this.hasHighlights);this._needsRender=!0}};Object.defineProperty(f.prototype,"hasHighlights",{get:function(){return 0<this._highlights.length},enumerable:!0,configurable:!0});f.prototype._renderHUDVisibility=function(a){var b=this,c=B.shouldRenderVisibilityDuringRenderPass(a.pass),d=a.offscreenRenderingHelper&&
a.offscreenRenderingHelper.enabled,f=!1;c&&d&&a.offscreenRenderingHelper.renderHUDVisibility(function(){f=b._renderInternalSlot(u.OCCLUSION_PIXELS,a)});return f};f.prototype.renderGeometrySlotsPt1=function(a){this._externalRenderers.render(u.INTERNAL_MATERIAL,a);this._renderInternalSlot(u.STENCIL_MATERIAL,a);this._externalRenderers.render(u.OPAQUE_TERRAIN,a);this._renderInternalSlot(u.OPAQUE_MATERIAL,a);this._externalRenderers.render(u.OPAQUE_EXTERNAL,a);a.ssaoHelper&&a.ssaoHelper.bindAll(this._programRep);
this._externalRenderers.render(u.POSTPROCESSING_ATMOSPHERE_OPAQUE,this._renderContext);this._renderInternalSlot(u.TRANSPARENT_MATERIAL,a);this.renderOptions.earlyOcclusionPixelDraw&&(this._renderHUDVisibility(a),this._renderInternalSlot(u.LINE_CALLOUTS,this._renderContext));this._externalRenderers.render(u.TRANSPARENT_EXTERNAL,a);a.ssaoHelper&&a.ssaoHelper.bindAll(this._programRep)};f.prototype.renderTransparentTerrain=function(a){return this._externalRenderers.render(u.TRANSPARENT_TERRAIN,a)};f.prototype.renderGeometrySlots=
function(a){this.renderGeometrySlotsPt1(a);this.renderTransparentTerrain(a)};f.prototype.renderHUD=function(a){this._bindParameters.renderTransparentlyOccludedHUD=a;this._renderInternalSlot(u.LINE_CALLOUTS_HUD_DEPTH,this._renderContext);this._renderInternalSlot(u.HUDMATERIAL1,this._renderContext);this._renderInternalSlot(u.HUDMATERIAL2,this._renderContext)};f.prototype._renderHighlights=function(a,b,c){var d=!!c&&c.enabled&&(this.hasHighlights||this._externalRenderers.needsHighlight());if(this._highlightTextureHelper.enabled=
d)d=null,c.profilingCallback&&(d=E.startMeasurement(this._renderContext.rctx)),this._highlightTextureHelper.setupFBOs(a),this._highlightTextureHelper.prepareHighlightPass(),this.renderGeometryPass(t.MATERIAL_HIGHLIGHT,a,null,null),this._rctx.clear(this._rctx.gl.DEPTH_BUFFER_BIT),this.renderHUD("both"),this._highlightTextureHelper.finish(b),c.render(a,b,this._highlightTextureHelper.framebuffer),null!==d&&c.profilingCallback&&d.stop(function(a){c.profilingCallback&&c.profilingCallback(a)})};f.prototype._needsRenderOccluded=
function(a){for(var b in this._mat2DataInstanced){var c=this._mat2DataInstanced[b][0];if(c&&c.renderOccluded&&c.beginSlot(a)&&c.isVisible())return!0}return!1};f.prototype._renderOccluded=function(a,b,c){if(b&&c&&c.enabled){var d=this._needsRenderOccluded(u.OPAQUE_MATERIAL)||this._needsRenderOccluded(u.TRANSPARENT_MATERIAL);if(b.enabled=d)d=this._renderContext,b.setupFBOs(a),b.prepareColorPass(),d.pass=t.MATERIAL,d.renderOccludedOnly=!0,this._renderInternalSlot(u.OPAQUE_MATERIAL,d),this._renderInternalSlot(u.TRANSPARENT_MATERIAL,
d),d.renderOccludedOnly=!1,b.finish(c.framebuffer),b.apply()}};f.prototype._renderUnordered=function(a,b,c,d){var f=this,g=this._rctx;this._isRendering=!0;this._stats.reset();this._updateGlobalUniforms(a.projectionMatrix);this._renderContext.pass=t.MATERIAL;this._renderContext.camera=a;this._renderContext.pixelRatio=this._pixelRatio;this._renderContext.shadowMap=b;this._renderContext.ssaoHelper=d.ssao;this._renderContext.offscreenRenderingHelper=d.offscreenRendering;this._renderContext.stencilRenderingHelper=
this._stencilRenderingHelper;this._renderContext.depth=this._linearDepthTextureHelper.framebuffer;this._renderContext.normals=this._normalTextureHelper.framebuffer;this._renderContext.highlight=this._highlightTextureHelper.framebuffer;this._renderContext.options=this.renderOptions;d.offscreenRendering.enabled=!0;d.offscreenRendering.initializeFrame(a);this._externalRenderers.render(u.BACKGROUND,this._renderContext);this.renderGeometrySlotsPt1(this._renderContext);this._edgeView&&this.edgeView.shouldRender()&&
d.offscreenRendering.renderSeparateAndComposite(function(){f._edgeView.render(f._bindParameters)},void 0,"alpha");var e=b=!1;this.renderOptions.earlyOcclusionPixelDraw||(b=this._renderHUDVisibility(this._renderContext),this._renderInternalSlot(u.LINE_CALLOUTS,this._renderContext));(e=this.renderTransparentTerrain(this._renderContext))&&b&&(d.offscreenRendering.compositeTransparentTerrainOntoHUDVisibility(),d.offscreenRendering.renderToTargets(function(){return f.renderHUD("occluded")},d.offscreenRendering.mainColor,
d.offscreenRendering.tmpDepth,void 0,!0));e&&d.offscreenRendering.compositeTransparentTerrainOntoMain();d.offscreenRendering.renderToTargets(function(){f._externalRenderers.render(u.POSTPROCESSING_ATMOSPHERE_TRANSPARENT,f._renderContext);f._externalRenderers.render(u.POSTPROCESSING_EXTERNAL,f._renderContext);f._renderOccluded(a,d.renderOccluded,d.offscreenRendering)},d.offscreenRendering.mainColor,d.offscreenRendering.mainDepth);b=this.renderOptions.antialiasing;"smaa"===b&&this._smaaPass.loadResources(function(){f._needsRender=
!0});"smaa"===b&&this._smaaPass.enable()?(this._fxaaPass.disable(),this._smaaPass.render({colorTexture:d.offscreenRendering.colorTexture},null)):"fxaa"===b&&this._fxaaPass.enable()?(this._smaaPass.disable(),this._fxaaPass.render({colorTexture:d.offscreenRendering.colorTexture},null)):(d.offscreenRendering.composite(),this._fxaaPass.disable(),this._smaaPass.disable());g.bindFramebuffer(null);this._renderContext.framebufferTex=d.offscreenRendering.colorTexture;this.renderHUD("notOccluded");this._renderHighlights(a,
c,d.highlight);this._isRendering=!1};f.prototype._renderGeometryPassOrderedHighlight=function(a){this._renderInternalHighlights(this._highlights)};f.prototype._renderGeometryPassOrderedMaterial=function(a){for(var b=null,c=0;c<this._renderOrder.length;c++){var d=this._renderOrder[c][1];if(d.instanced){var f=d.instanced||d.merged,g=f[a.pass];g&&g.isVisible()&&(this._renderInternalInstanced(f,g,this._bindParameters,Infinity),b=null)}d.merged&&(f=d.merged,(g=f[a.pass])&&g.isVisible()&&(d=g.getProgram(),
d!==b&&(d.setUniformMatrix4fv("model",L),d.hasUniform("modelNormal")&&d.setUniformMatrix4fv("modelNormal",L)),b=d,this._renderInternalMerged(f,g,this._bindParameters,Infinity)))}};f.prototype._renderGeometryPassOrdered=function(a){var b=a.camera;this._bindParameters.view=b.viewMatrix;this._bindParameters.proj=b.projectionMatrix;this._bindParameters.viewInvTransp=b.viewInverseTransposeMatrix;V[0]=b.near;V[1]=b.far;this._bindParameters.nearFar=V;this._bindParameters.lightingData=a.lightingData;this._bindParameters.viewport=
b.fullViewport;this._bindParameters.framebufferTex=this._framebuffer.texture;this._bindParameters.pixelRatio=a.pixelRatio;a.isHighlightPass?this._renderGeometryPassOrderedHighlight(a):this._renderGeometryPassOrderedMaterial(a)};f.prototype._renderOrdered=function(a,b){this._stats.reset();this.renderGeometryPass(a,b)};f.prototype.prepareRender=function(a){this._externalRenderers.prepareRender(a);this._renderContext.rctx.setDepthFunction(513)};f.prototype.render=function(a,b,c){this._orderedRendering?
this._renderOrdered(t.MATERIAL,a):this._renderUnordered(a,c.shadowMap,b,c)};f.prototype.renderAuxiliaryBuffers=function(a,b,c){var d=c.ssao;c=c.shadowMap;var f=this.ssaoEnabled||this._externalRenderers.needsLinearDepth();if(this._linearDepthTextureHelper.enabled=f)this._linearDepthTextureHelper.setupFBOs(a),this._linearDepthTextureHelper.prepareDepthPass(),this.renderGeometryPass(t.MATERIAL_DEPTH,a,c,d),this._linearDepthTextureHelper.finish(b);if(this._normalTextureHelper.enabled=this.ssaoEnabled)this._normalTextureHelper.setupFBOs(a),
this._normalTextureHelper.prepareNormalPass(),this.renderGeometryPass(t.MATERIAL_NORMAL,a,c,d),this._normalTextureHelper.finish(b);this.ssaoEnabled&&d.computeSSAO(a,b,this._linearDepthTextureHelper.framebuffer,this._normalTextureHelper.framebuffer);d.bindAll(this._programRep)};f.prototype.renderGeometryPass=function(a,b,c,d){this._isRendering=!0;this._updateGlobalUniforms(b.projectionMatrix);this._renderContext.pass=a;this._renderContext.camera=b;this._renderContext.pixelRatio=this._pixelRatio;this._renderContext.shadowMap=
c;this._renderContext.ssaoHelper=d;this._renderContext.depth=this._linearDepthTextureHelper.framebuffer;this._renderContext.normals=this._normalTextureHelper.framebuffer;this._orderedRendering?this._renderGeometryPassOrdered(this._renderContext):this._renderGeometryPassUnordered(this._renderContext);this._isRendering=!1};f.prototype._renderGeometryPassUnordered=function(a){this.renderGeometrySlots(a)};f.prototype._renderInternalHighlights=function(a,b){void 0===b&&(b=null);for(var c=!1,d=0;d<a.length;++d){var f=
a[d],g=f.matData[t.MATERIAL_HIGHLIGHT];g&&(null===b||g.beginSlot(b))&&g.isVisible()&&(c=this._renderInternalHighlight(f,this._bindParameters,t.MATERIAL_HIGHLIGHT)||c)}return c};f.prototype._renderInternalSlotOccluded=function(a,b){var c=!1,d;for(d in this._mat2DataInstanced){var f=this._mat2DataInstanced[d],g=f[b.pass];g&&g.renderOccluded&&g.beginSlot(a)&&g.isVisible()&&(c=this._renderInternalInstanced(f,g,this._bindParameters,a)||c)}return c};f.prototype._renderInternalSlotMaterial=function(a,b){var c=
!1,d;for(d in this._mat2DataInstanced){var f=this._mat2DataInstanced[d],g=f[b.pass];g&&g.beginSlot(a)&&g.isVisible()&&(c=this._renderInternalInstanced(f,g,this._bindParameters,a)||c)}for(var f=this._programRep.getProgramsUsingUniform("model"),g=this._programRep.getProgramsUsingUniform("modelNormal"),e=0;e<f.length;e++){var k=f[e];k.setUniformMatrix4fv("model",L);-1<g.indexOf(k)&&k.setUniformMatrix4fv("modelNormal",L)}for(d in this._mat2DataMerged)f=this._mat2DataMerged[d],(g=f[b.pass])&&g.beginSlot(a)&&
g.isVisible()&&(c=this._renderInternalMerged(f,g,this._bindParameters,a)||c);for(d in this._mat2DataPreinterleaved)f=this._mat2DataPreinterleaved[d],(g=f[b.pass])&&g.beginSlot(a)&&g.isVisible()&&(c=this._renderInternalPreinterleaved(f,g,this._bindParameters,a)||c);a===u.STENCIL_MATERIAL&&this._stencilRenderingHelper.finish();return c};f.prototype._renderInternalSlotHighlights=function(a,b){return this._renderInternalHighlights(this._highlights,a)};f.prototype._renderInternalSlot=function(a,b){this._bindParameters.view=
b.camera.viewMatrix;this._bindParameters.proj=b.camera.projectionMatrix;this._bindParameters.viewInvTransp=b.camera.viewInverseTransposeMatrix;this._bindParameters.cameraAboveGround=b.camera.aboveGround;this._bindParameters.fovY=b.camera.fovY;V[0]=b.camera.near;V[1]=b.camera.far;var c=this._renderContext.offscreenRenderingHelper;this._bindParameters.nearFar=V;this._bindParameters.lightingData=b.lightingData;this._bindParameters.viewport=b.camera.fullViewport;this._bindParameters.framebufferTex=c?
c.colorTexture:null;this._bindParameters.shadowMap=b.shadowMap;this._bindParameters.shadowMappingEnabled=!!b.shadowMap&&b.shadowMap.enabled;this._bindParameters.ssaoEnabled=!!b.ssaoHelper&&b.ssaoHelper.enabled;this._bindParameters.pixelRatio=b.pixelRatio;this._bindParameters.hudVisibilityTexture=c?c.hudVisibilityTexture:null;return b.isHighlightPass?this._renderInternalSlotHighlights(a,b):b.renderOccludedOnly?this._renderInternalSlotOccluded(a,b):this._renderInternalSlotMaterial(a,b)};f.prototype._renderInternalInstanced=
function(a,b,c,d){var f=this,g=this._rctx,e=g.gl,k=!1,l=b.getDrawMode(g),m=g.capabilities.instancing,n=!1;a.origin2data.forEach(function(a){c.origin=a.origin;d===u.STENCIL_MATERIAL&&(f._stencilRenderingHelper.enabled=!0,f._stencilRenderingHelper.prepareStencilWritePass());var p=!1;if(b.instanced)for(var r in a.perGeometryDataInfo){var h=a.perGeometryDataInfo[r];k||(b.bind(g,c),k=!0);g.bindVAO(h.vao);var t=b.getProgram();F.assertCompatibleVertexAttributeLocations(h.vao,t);p||(b.bindView(g,c),p=!0);
var t=h.to-h.from,v=h.refCount;l===e.TRIANGLES&&(f._stats.trianglesRendered+=v*t/3);m.drawArraysInstanced(l,h.from,t,v);n=!0;f._stats.drawCallsAngleInstanced++;f._stats.instancesDrawnAngle+=v}else for(h in r=a.instances,r)t=r[h],v=t.displayedIndexRange,v&&0===v.length||(k||(b.bind(g,c),k=!0),p||(g.bindVAO(a.vao),b.bindView(g,c),p=!0),b.bindInstance(g,t),f._stats.drawCallsInstanced++,l===e.TRIANGLES&&(f._stats.trianglesRendered+=(t.to-t.from)/3),v?f._drawArraysFaceRange(v,t.from,l):g.drawArrays(l,
t.from,t.to-t.from),n=!0)});g.bindVAO(null);k&&b.release(g,c);return n};f.prototype._renderInternalHighlight=function(a,b,c){var d=this._rctx,f=d.gl;c=a.matData[c];var g=c.getDrawMode(d),e=a.instance,k=e.highlightedIndexRange,l=this._renderContext.offscreenRenderingHelper,l=(l?l.depthTexture:null)||this._getFallbackDepthTexture(),m=c.getProgram(),n=d.capabilities.instancing;b.origin=a.originData.origin;var p=!1;if(c.instanced&&a.type===S.Instanced)for(a=a.instancedVAO,c.bind(d,b),d.bindVAO(a),F.assertCompatibleVertexAttributeLocations(a,
m),c.bindView(d,b),a=0;a<k.length;a++){var u=k[a],p=u.range?u.range[0]+e.from:e.from,u=u.range?u.range[1]-u.range[0]+1:e.to-e.from;d.bindTexture(l,5);m.setUniform1i("depthTex",5);m.setUniform4f("highlightViewportPixelSz",0,0,1/this._bindParameters.viewport[2],1/this._bindParameters.viewport[3]);n.drawArraysInstanced(g,p,u,1);g===f.TRIANGLES&&(this._stats.trianglesRendered+=1*u/3);this._stats.drawCallsHighlight++;p=!0}else if(a.type===S.Instanced&&c.instanced)console.error("_renderInternalHighlight: incompatible instance type");
else{c.bind(d,b);c.bindView(d,b);n=null;switch(a.type){case S.Merged:u=a.originData;d.bindVAO(u.vao);m.setUniformMatrix4fv("model",L);break;case S.Instanced:u=a.originData;d.bindVAO(u.vao);c.bindInstance(d,e);break;case S.Preinterleaved:u=a.originData,a=u.instances[a.uniqueName].vao,d.bindVAO(a),c.bindInstance(d,e),n=a.indexBuffer&&a.indexBuffer.indexType}for(a=0;a<k.length;a++){u=k[a];p=u.range?u.range[0]+e.from:e.from;u=u.range?u.range[1]-u.range[0]+1:e.to-e.from;d.bindTexture(l,5);c.getProgram().setUniform1i("depthTex",
5);m.setUniform4f("highlightViewportPixelSz",0,0,1/this._bindParameters.viewport[2],1/this._bindParameters.viewport[3]);if(n){var r=F.getBytesPerElement(n);d.drawElements(g,u,n,p*r)}else d.drawArrays(g,p,u);g===f.TRIANGLES&&(this._stats.trianglesRendered+=u/3);this._stats.drawCallsHighlight++;p=!0}}d.bindVAO(null);c.release(d,b);return p};f.prototype._drawArraysFaceRange=function(a,b,c){for(var d=this._rctx,f=0;f<a.length;f++){var g=a[f];d.drawArrays(c,g[0]+b,g[1]-g[0]+1)}this._stats.drawCallsFragmented+=
a.length-1};f.prototype._drawElementsFaceRange=function(a,b,c,d){for(var f=this._rctx,g=F.getBytesPerElement(d),e=0;e<a.length;e++){var k=a[e];f.drawElements(c,k[1]-k[0]+1,d,(k[0]+b)*g)}this._stats.drawCallsFragmented+=a.length-1};f.prototype._renderInternalMerged=function(a,b,c,d){var f=this,g=this._rctx,e=g.gl,k=!1,l=!1;a.origin2data.forEach(function(a){c.origin=a.origin;d===u.STENCIL_MATERIAL&&(f._stencilRenderingHelper.enabled=!0,f._stencilRenderingHelper.prepareStencilWritePass());if(!a.displayedIndexRange||
0!==a.displayedIndexRange.length){l||(b.bind(g,c),l=!0);var m=b.getProgram();g.bindVAO(a.vao);F.assertCompatibleVertexAttributeLocations(a.vao,m);b.bindView(g,c);f._stats.drawCallsMerged++;m=b.getDrawMode(g);m===e.TRIANGLES&&(f._stats.trianglesRendered+=a.vao.vertexBuffers.geometry.size/3);a.displayedIndexRange?f._drawArraysFaceRange(a.displayedIndexRange,0,m):g.drawArrays(m,0,F.vertexCount(a.vao,"geometry"));k=!0}});l&&b.release(g,c);return k};f.prototype._renderInternalPreinterleaved=function(a,
b,c,d){var f=this,g=this._rctx,e=g.gl,k=!1,l=!1,m=b.getDrawMode(g);a.origin2data.forEach(function(a){c.origin=a.origin;var n=!1;d===u.STENCIL_MATERIAL&&(f._stencilRenderingHelper.enabled=!0,f._stencilRenderingHelper.prepareStencilWritePass());for(var p in a.instances){var r=a.instances[p],h=r.instance,t=r.vao,r=h.displayedIndexRange;if(!r||0!==r.length){l||(b.bind(g,c),l=!0);var v=b.getProgram();F.assertCompatibleVertexAttributeLocations(t,v);g.bindVAO(t);n||(b.bindView(g,c),n=!0);b.bindInstance(g,
h);f._stats.drawCallsPreinterleaved++;m===e.TRIANGLES&&(f._stats.trianglesRendered+=(h.to-h.from)/3);t=t.indexBuffer&&t.indexBuffer.indexType;r?t?f._drawElementsFaceRange(r,h.from,m,t):f._drawArraysFaceRange(r,h.from,m):t?(r=F.getBytesPerElement(t),g.drawElements(m,h.to-h.from,t,h.from*r)):g.drawArrays(m,h.from,h.to-h.from);k=!0}}});g.bindVAO(null);l&&b.release(g,c);return k};f.prototype._updateGlobalUniforms=function(a){for(var b=this._programRep.getProgramsUsingUniform("proj"),c=0;c<b.length;c++)b[c].setUniformMatrix4fv("proj",
a);if(this._lighting){b=this._programRep.getProgramsUsingUniform("lightingMainDirection");for(c=0;c<b.length;c++)this._lighting.setUniforms(b[c]);b=this._programRep.getProgramsUsingUniform("lightDirection");for(c=0;c<b.length;c++)this._lighting.setUniforms(b[c])}};f.prototype.print=function(){var a=Object.keys(this._mat2DataMerged).length,b=Object.keys(this._mat2DataInstanced).length,c=Object.keys(this._mat2DataPreinterleaved).length;console.log("number of materials (merged/instanced/preinterleaved): "+
a+"/"+b+"/"+c);var d=0;K(this._mat2DataMerged,function(){},function(a,b){d+=Object.keys(b.instances).length});var f=0;K(this._mat2DataInstanced,function(){},function(a,b){f+=Object.keys(b.instances).length});var g=0;K(this._mat2DataPreinterleaved,function(){},function(a,b){g+=Object.keys(b.instances).length});console.log("number of instances (merged/instanced/preinterleaved): "+d+"/"+f+"/"+g)};f.prototype.isEmpty=function(){for(var a in this._mat2DataInstanced){var b=this._mat2DataInstanced[a];if(!e.forEachUntilMap(b.origin2data,
function(a){return A.objectEmpty(a.instances)}))return!1}for(a in this._mat2DataMerged)if(b=this._mat2DataMerged[a],!e.forEachUntilMap(b.origin2data,function(a){return A.objectEmpty(a.instances)}))return!1;for(a in this._mat2DataPreinterleaved)if(b=this._mat2DataPreinterleaved[a],!e.forEachUntilMap(b.origin2data,function(a){return A.objectEmpty(a.instances)}))return!1;return!0};f.prototype.modify=function(a,b,c,d){this._isRendering&&console.warn("Renderer.modify called while rendering");var f=[],
g=[],e=[];this._classifyRenderGeometry(a,f,g,e);a=[];var k=[],l=[];this._classifyRenderGeometry(b,a,k,l);var m={};c&&this._performUpdates(c,m);c=[];this._modifyMerged(f,a,c,m);this._modifyInstanced(g,k,c);this._modifyPreinterleaved(e,l,c);this._updateMergedFaceranges(m);this._releaseMaterials(c);f=this._highlights.length;if(b&&0<b.length&&0<f&&(this._highlights=this._highlights.filter(function(a){return!b.some(function(b){return b.uniqueName===a.uniqueName})}),f!==this._highlights.length&&this.onHasHighlightsChanged))this.onHasHighlightsChanged(this.hasHighlights);
this._updateHighlightVAOs();d&&this._modifyMaterials(d);this._needsRender=!0};f.prototype._classifyRenderGeometry=function(a,b,c,d){for(var f=0;f<a.length;f++){var g=a[f];if(1<=O(g.data))switch(this._getType(g)){case S.Merged:b.push(g);break;case S.Instanced:c.push(g);break;case S.Preinterleaved:d.push(g)}}};f.prototype._performUpdates=function(a,b){for(var c=0;c<a.length;c++){var d=a[c],f=d.updateType,d=d.renderGeometry,g=this._getType(d)===S.Merged;if(1<=O(d.data)){f&2&&this._updateFaceranges(d,
b);if(f&32){var e=this._getInstance(d);e&&this._updateHighlightFaceranges(d,e.instance)}f&4||g&&f&16?this._updateVertexAttributes(d,!g):!g&&f&16&&this._updateInstanceTransformation(d)}}};f.prototype._updateFaceranges=function(a,b){var c=a.material.id,d=a.origin.id,f=this._getType(a),g;if(f===S.Preinterleaved){var e=this._getOriginData(f,c,d);g=e.instances[a.uniqueName].instance}else e=this._getOriginData(f,c,d),(g=e.instances[a.uniqueName])&&f===S.Merged&&(b[this._modifiedMergedFacerangesKey(c,d)]=
e);g&&(g.displayedIndexRange=H(a),this._updateHighlightFaceranges(a,g))};f.prototype._updateHighlightFaceranges=function(b,c){if(c){var d=c.highlightedIndexRange,f;f=b.instanceParameters.hidden?[]:a.generateHighlightedIndexRanges(b.instanceParameters.componentVisibilities,b.instanceParameters.componentHighlights,b.componentOffsets);(c.highlightedIndexRange=f)&&!d?this._addHighlight(b):!f&&d&&this._removeHighlight(b)}};f.prototype._updateMergedFaceranges=function(a){for(var b in a){var c=a[b];c.displayedIndexRange=
[];var d=c.instances,f=!0,g;for(g in d){var e=d[g];e.displayedIndexRange?(c.displayedIndexRange.push.apply(c.displayedIndexRange,l.offsetIntervals(e.displayedIndexRange,e.from)),f=!1):c.displayedIndexRange.push([e.from,e.to-1])}c.displayedIndexRange=f?null:l.mergeIntervals(c.displayedIndexRange)}};f.prototype._updateVertexAttributes=function(a,b){var c=a.material,d=c.id,f=a.origin.id,g=F.getStride(c.getVertexBufferLayout())/4,e=this._getType(a);if(e===S.Preinterleaved)console.error("Updating Preinterleaved geometry not supported");
else{var e=this._getOriginData(e,d,f),d=e.instances[a.uniqueName],f=e.buffer.getArray(),e=e.vao,k,l;b||(I(a,Q,G),k=Q,l=G);c.fillInterleaved(a.data,k,l,a.instanceParameters,f,d.from*g);A.assert(d.from+c.getOutputAmount(O(a.data))/g===d.to,"material VBO layout has changed");e.vertexBuffers.geometry.setSubData(f,d.from*g*4,d.from*g*4,d.to*g*4)}};f.prototype._updateInstanceTransformation=function(a){var b=this._getType(a),c=a.material.id,d=a.origin.id;b===S.Preinterleaved?(b=this._getOriginData(b,c,d),
d=b.instances[a.uniqueName].instance,I(a,d.transformation,d.transformationNormal)):(b=this._getOriginData(b,c,d),d=b.instances[a.uniqueName],b=b.perGeometryDataInfo[a.data.id],c=b.instanceBufferData,I(a,d.transformation,d.transformationNormal),c&&(a=c.getSlot(a.idx),c.fill(a,0,d.transformation),c.fill(a,16,d.transformationNormal),a=4*c.getOffset(a),d=F.getStride(b.vao.layout.instance),b.vao.vertexBuffers.instance.setSubData(c.getArray(),a,a,a+d)))};f.prototype._modifyMerged=function(a,b,c,d){a=this._compMatToDelta(a,
b,S.Merged);b=this._mat2DataMerged;for(var f in a){var g=a[f],e;for(e in g){var k=g[e],l=k.optimalCount,m=k.sparseCount,n=k.material,p=n.getVertexBufferLayout(),u=F.getStride(p)/4,r=b[f];null==r&&(A.assert(0<l),r=this._initializeMatData(n),b[f]=r,this._orderedRendering&&this._insertIntoRenderOrder(r,n.renderPriority,"merged"));var h=r.origin2data.get(e);null==h&&(A.assert(0<l),h=this._createMergedData(p,l,k.origin),r.origin2data.set(e,h));if(0===l)h.vao.dispose(!0),h.vao=null,r.origin2data.delete(e),
0===r.origin2data.size&&(c.push(f),delete b[f],this._orderedRendering&&this._removeFromRenderOrder(r,"merged"));else{var t=(p=l<k.sparseCount/2)?l:m,l=aa,m=h.buffer.getSize(),r=h.buffer.getArray(),t=h.buffer.resize(t);p||t?this._rebuildMerged(h,k.toRemove,u,r,l):0<k.toRemove.length?(this._removeMergedByErasing(h,k.toRemove,u,l),0<k.toAdd.length&&(l.end=m)):(l.begin=m,l.end=m);p=T;A.setMatrixTranslation3(p,-k.origin[0],-k.origin[1],-k.origin[2]);this._appendMerged(h,n,k.toAdd,u,p,l);k=h.vao.vertexBuffers.geometry;
k.byteSize!==h.buffer.getArray().buffer.byteLength?k.setData(h.buffer.getArray()):(p=l.begin,n=l.end,p<n&&(u=h.buffer.getArray(),p*=4,k.setSubData(u,p,p,4*n)));if(l.updatedDisplayedIndexRange||h.displayedIndexRange)d[this._modifiedMergedFacerangesKey(f,e)]=h}}}};f.prototype._createMergedData=function(a,b,c){return{type:S.Merged,instances:{},vao:new M(this._rctx,d.Default3D,{geometry:a},{geometry:D.createVertex(this._rctx,35044)}),buffer:new g(b),optimalCount:0,origin:c}};f.prototype._rebuildMerged=
function(a,b,c,d,f){for(var g=0;g<b.length;++g){var e=a.instances[b[g].uniqueName];a.optimalCount-=(e.to-e.from)*c;delete a.instances[b[g].uniqueName]}b=0;g=a.buffer.getArray();f.begin=0;f.end=0;var k=-1,l=-1,m=0,n;for(n in a.instances){var e=a.instances[n],p=e.from*c,u=e.to*c,r=u-p;k!==l&&l!==p?(g.set(d.subarray(k,l),m),m+=l-k,k=p):-1===k&&(k=p);l=u;e.from=b/c;b+=r;e.to=b/c}k!==l&&g.set(d.subarray(k,l),m);f.end=b};f.prototype._removeMergedByErasing=function(a,b,c,d){if(0!==b.length){d.begin=Infinity;
d.end=-Infinity;for(var f=-1,g=-1,e=0;e<b.length;e++){var k=b[e].uniqueName,l=a.instances[k].from*c,m=a.instances[k].to*c;f!==g&&g!==l?(a.buffer.erase(f,g),f=l):-1===f&&(f=l);g=m;delete a.instances[k];a.optimalCount-=m-l;l<d.begin&&(d.begin=l);m>d.end&&(d.end=m)}f!==g&&a.buffer.erase(f,g)}};f.prototype._appendMerged=function(a,b,c,d,f,g){g.updatedDisplayedIndexRange=!1;for(var e=0;e<c.length;e++){var k=c[e],l=k.data;P.multiply(f,k.transformation,Q);P.inverse(Q,G);P.transpose(G);var m=g.end;b.fillInterleaved(l,
Q,G,k.instanceParameters,a.buffer.getArray(),g.end);var l=b.getOutputAmount(O(l)),n=m+l;A.assert(null==a.instances[k.uniqueName]);var p=H(k),m=new N(k.name,m/d,n/d,p,void 0,void 0,k.idx);a.instances[k.uniqueName]=m;this._updateHighlightFaceranges(k,m);p&&(g.updatedDisplayedIndexRange=!0);a.optimalCount+=l;g.end+=l}};f.prototype._modifyInstanced=function(a,b,c){var f=this._rctx,e=S.Instanced;a=this._compMatToDelta(a,b,e);b=this._mat2DataInstanced;for(var k in a){var l=a[k],m;for(m in l){var p=l[m];
if(0===p.optimalCount)p=b[k],p.origin2data.get(m).vao.dispose(!0),p.origin2data.delete(m),0===p.origin2data.size&&(c.push(k),delete b[k],this._orderedRendering&&this._removeFromRenderOrder(p,"instanced"));else{var u=p.material,r=b[k];if(null==r){var h=u.renderPriority,r=this._initializeMatData(u);b[k]=r;this._orderedRendering&&this._insertIntoRenderOrder(r,h,"instanced")}var v=u.getVertexBufferLayout(),y=r[t.MATERIAL].instanced?u.getInstanceBufferLayout():void 0,x=y&&F.findAttribute(y,"instanceColor"),
C=y&&F.findAttribute(y,"instanceFeatureAttribute"),B=F.getStride(v)/4,h=r.origin2data.get(m);null==h&&(h={type:e,instances:{},vao:new M(f,d.Default3D,{geometry:v},{geometry:D.createVertex(f,35044)}),buffer:new g(p.optimalCount),optimalCount:0,perGeometryDataInfo:{},origin:p.origin},r.origin2data.set(m,h));var r=h.buffer.getSize(),Q=h.buffer.getArray(),q=p.optimalCount<p.sparseCount/2,Z=h.buffer.resize(q?p.optimalCount:p.sparseCount),G;for(G in p.perGeometryDelta){var X=h.perGeometryDataInfo[G];if(X&&
X.instanceBufferData){var E=p.perGeometryDelta[G].removeCount;0<E&&X.instanceBufferData.prepareFree(E)}}var I=p.toRemove;if(q||Z){for(q=0;q<I.length;++q){Z=I[q];delete h.instances[Z.uniqueName];G=Z.data.id;var L=X=h.perGeometryDataInfo[G];0===--L.refCount&&null==p.dataId2refCount[G]?(h.optimalCount-=(L.to-L.from)*B,delete h.perGeometryDataInfo[G]):X.instanceBufferData&&X.instanceBufferData.free(Z.idx)}var r=0,q=h.buffer.getArray(),Z={},ea;for(ea in h.perGeometryDataInfo)L=h.perGeometryDataInfo[ea],
A.assert(null==Z[L.from]),Z[L.from]=L;for(var K in Z)L=Z[K],E=L.from*B,X=L.to*B,q.set(Q.subarray(E,X),r),L.from=r/B,r+=X-E,L.to=r/B;for(var V in h.instances)E=h.instances[V],E.from=h.perGeometryDataInfo[E.dataId].from,E.to=h.perGeometryDataInfo[E.dataId].to}else for(q=0;q<I.length;++q)Z=I[q],delete h.instances[Z.uniqueName],G=Z.data.id,X=h.perGeometryDataInfo[G],0===--X.refCount&&null==p.dataId2refCount[G]?(E=X.from*B,X=X.to*B,h.buffer.erase(E,X),h.optimalCount-=X-E,delete h.perGeometryDataInfo[G]):
X.instanceBufferData&&X.instanceBufferData.free(Z.idx);A.setMatrixTranslation3(T,-p.origin[0],-p.origin[1],-p.origin[2]);for(G in p.perGeometryDelta)(X=h.perGeometryDataInfo[G])&&X.instanceBufferData&&(q=p.perGeometryDelta[G].addCount,0<q&&X.instanceBufferData.prepareAllocate(q));Q=p.toAdd;for(q=0;q<Q.length;++q)if(Z=Q[q],E=Z.data,G=E.id,X=h.perGeometryDataInfo[G],null==X?(u.fillInterleaved(E,void 0,void 0,void 0,h.buffer.getArray(),r),I=u.getOutputAmount(O(E)),E=r/B,r+=I,X=r/B,h.optimalCount+=I,
X={refCount:1,from:E,to:X,vao:null,instanceBufferData:null},y&&(E=F.getStride(y)/4,X.vao=new M(f,d.Default3D,{geometry:v,instance:y},{geometry:h.vao.vertexBuffers.geometry,instance:D.createVertex(f,35044)}),X.instanceBufferData=new n(E,p.perGeometryDelta[G].addCount)),h.perGeometryDataInfo[G]=X):++X.refCount,A.assert(X.from*B<=h.buffer.getSize()&&X.to*B<=h.buffer.getSize()),E=P.create(),P.multiply(T,Z.transformation,E),I=H(Z),E=new N(Z.name,X.from,X.to,I,E,Z.instanceParameters,Z.idx,G),h.instances[Z.uniqueName]=
E,this._updateHighlightFaceranges(Z,E),X=X.instanceBufferData)I=X.allocate(Z.idx),X.fill(I,0,E.transformation),X.fill(I,16,E.transformationNormal),x&&X.fill(I,x.offset/4,Z.instanceParameters.color),C&&X.fill(I,C.offset/4,Z.instanceParameters.featureAttribute);A.assert(h.optimalCount===p.optimalCount);u=new Float32Array(h.buffer.getArray().buffer,0,h.buffer.getSize());h.vao.vertexBuffers.geometry.setData(u);for(G in h.perGeometryDataInfo)if(v=h.perGeometryDataInfo[G],v.vao&&(u=v.vao.vertexBuffers.instance))y=
p.perGeometryDelta[G],0<y.addCount+y.removeCount&&(v=v.instanceBufferData.compact(),u.setData(v))}}}};f.prototype._modifyPreinterleaved=function(a,b,c){for(var f=this._rctx,g=S.Preinterleaved,e=this._mat2DataPreinterleaved,k=0;k<a.length;k++){var l=a[k],m=l.material,n=m.id,p=l.origin.id,u=l.origin.vec3,r=e[n];null==r&&(r=this._initializeMatData(m),e[n]=r);n=r.origin2data.get(p);null==n&&(n={type:g,origin:u,count:0,instances:{}},r.origin2data.set(p,n));A.setMatrixTranslation3(T,-u[0],-u[1],-u[2]);
r=P.create();P.multiply(T,l.transformation,r);u=H(l);p=l.data;p.preinterleaved?null==p.vertexData?A.assert(!1,"Trying to re-add preinterleaved geometry data which is no longer available."):(r=new N(l.name,0,p.indexCount,u,r,l.instanceParameters,l.idx,p.id),u=p.indexData?D.createIndex(f,35044,p.indexData):null,m=m.getVertexBufferLayout(),m=new M(f,d.Default3D,{geometry:m},{geometry:D.createVertex(f,35044)},u),m.vertexBuffers.geometry.setData(p.vertexData),p.vertexData=null,n.count+=1,n.instances[l.uniqueName]=
{instance:r,vao:m},this._updateHighlightFaceranges(l,r)):A.assert(!1,"Non-interleaved render geometry processed as pre-interleaved")}for(a=0;a<b.length;a++)l=b[a],u=l.origin,m=l.material,n=m.id,p=u.id,l=l.uniqueName,r=e[n],f=r.origin2data.get(p),f.instances[l].vao.dispose(),delete f.instances[l],--f.count,0===f.count&&r.origin2data.delete(p),0===r.origin2data.size&&(c.push(n),delete e[n])};f.prototype._compMatToDelta=function(a,b,c){var d={};this._updateMatToDelta(a,!0,c,d);this._updateMatToDelta(b,
!1,c,d);return d};f.prototype._updateMatToDelta=function(a,b,c,d){c=c===S.Instanced;for(var f=0;f<a.length;f++){var g=a[f],e=g.origin,k=g.material,l=k.id,m=c?this._mat2DataInstanced[l]:this._mat2DataMerged[l],m=m&&m.origin2data.get(e.id),n=d[l];null==n&&(n={},d[l]=n);l=n[e.id];if(null==l){l={optimalCount:null==m?0:m.optimalCount,sparseCount:null==m?0:m.buffer.getSize(),material:k,toAdd:[],toRemove:[],perGeometryDelta:null,origin:e.vec3};if(c){var p={};if(void 0!==m)for(var u in m.perGeometryDataInfo)p[u]=
m.perGeometryDataInfo[u].refCount;l.dataId2refCount=p;l.perGeometryDelta={}}n[e.id]=l}e=k.getOutputAmount(O(g.data));c?(k=g.data.id,m=l.perGeometryDelta[k],m||(m={addCount:0,removeCount:0},l.perGeometryDelta[k]=m),b?(m.addCount++,null==l.dataId2refCount[k]&&(l.dataId2refCount[k]=0),1===++l.dataId2refCount[k]&&(l.optimalCount+=e,l.sparseCount+=e),l.toAdd.push(g)):(m.removeCount++,0===--l.dataId2refCount[k]&&(delete l.dataId2refCount[k],l.optimalCount-=e),l.toRemove.push(g))):b?(l.optimalCount+=e,l.sparseCount+=
e,l.toAdd.push(g)):(l.optimalCount-=e,l.toRemove.push(g))}};f.prototype._getType=function(a){if(a.data.preinterleaved)return S.Preinterleaved;var b=!1,c=O(a.data),b=(b=(b=b||!1===a.material.canBeMerged)||a.material.instanced)||!0===a.material.renderOccluded;a.singleUse||(b=b||c>this._threshold);return b?S.Instanced:S.Merged};f.prototype._getTargetMat2Data=function(a){switch(a){case S.Merged:return this._mat2DataMerged;case S.Instanced:return this._mat2DataInstanced;case S.Preinterleaved:return this._mat2DataPreinterleaved}};
f.prototype._getOriginData=function(a,b,c){return this._getTargetMat2Data(a)[b].origin2data.get(c)};f.prototype._modifiedMergedFacerangesKey=function(a,b){return a+"_"+b};f.prototype._insertIntoRenderOrder=function(a,b,c){for(var d=a[t.MATERIAL].materialId,f=this._renderOrder.length,g=0;g<f&&this._renderOrder[g][0]>=b;){var e=this._renderOrder[g][1];if(e.id===d){A.assert(!e[c],"matData for type already exists");e[c]=a;return}g++}d={id:d,instanced:null,merged:null};d[c]=a;this._renderOrder.splice(g,
0,[b,d])};f.prototype._removeFromRenderOrder=function(a,b){var c=a[t.MATERIAL].materialId;for(a=0;this._renderOrder[a][1].id!==c;)a++;c=this._renderOrder[a][1];c[b]=null;c.instanced||c.merged||this._renderOrder.splice(a,1)};f.prototype._sortHighlightsByRenderOrder=function(){this._highlights.sort(function(a,b){a=a.matData[t.MATERIAL].renderPriority;b=b.matData[t.MATERIAL].renderPriority;return a>b?-1:b>a?1:0})};f.prototype._updateRenderOrder=function(a,b){for(var c=b.length,d=0;d<c&&b[d][1].id!==
a;)d++;if(d<c){a=b[d][1];a=(a.merged||a.instanced)[t.MATERIAL].renderPriority;var f=b[d][0];if(a!==b[d][0])for(b[d][0]=a,f=a>f?-1:1,d+=f;-1<d&&d<c&&f*b[d][0]>f*a;){var g=b[d];b[d]=b[d-f];b[d-f]=g;d+=f}}};f.prototype._modifyMaterials=function(a){var b=this;a.forEach(function(a){b._materialRep.updateMaterialParameters(a)})};f.prototype.modifyRenderOrder=function(a){var b=this;this._orderedRendering&&(a.forEach(function(a){b._updateRenderOrder(a,b._renderOrder)}),this._sortHighlightsByRenderOrder(),
this._needsRender=!0)};f.prototype._initializeMatData=function(a){var b={origin2data:new Map};b[t.MATERIAL]=this._materialRep.aquire(a);b[t.MATERIAL_DEPTH_SHADOWMAP]=this._materialRep.aquireDepthShadowMap(a);b[t.MATERIAL_NORMAL]=this._materialRep.aquireNormal(a);b[t.MATERIAL_DEPTH]=this._materialRep.aquireDepth(a);b[t.MATERIAL_HIGHLIGHT]=this._materialRep.aquireHighlight(a);return b};f.prototype._releaseMaterials=function(a){if(Array.isArray(a))for(var b=0;b<a.length;b++)this._materialRep.release(a[b]),
this._materialRep.releaseDepthShadowMap(a[b]),this._materialRep.releaseNormal(a[b]),this._materialRep.releaseDepth(a[b]),this._materialRep.releaseHighlight(a[b]);else this._materialRep.release(a),this._materialRep.releaseDepthShadowMap(a),this._materialRep.releaseNormal(a),this._materialRep.releaseDepth(a),this._materialRep.releaseHighlight(a)};f.prototype._getInstance=function(a){var b=a.uniqueName,c=a.material.id,d=this._getType(a),c=this._getTargetMat2Data(d)[c];if(!c)return null;a=c.origin2data.get(a.origin.id);
if(!a)return null;var f;return(f=a.type===S.Preinterleaved?a.instances[b].instance:a.instances[b])?{type:d,uniqueName:b,instance:f,matData:c,originData:a,instancedVAO:null,instancedVAOBaseInstance:null}:null};f.prototype._createBaseInstanceVAO=function(a){var b=this._rctx,c=a.instance,d=a.originData;if(a.type===S.Instanced&&d.perGeometryDataInfo){var d=d.perGeometryDataInfo[c.dataId],f=d.instanceBufferData;f&&(d=d.vao,c=f.getSlot(c.idx),a.instancedVAOBaseInstance!==c&&(f=F.setBaseInstanceOffset(d.layout,
c),a.instancedVAO=new M(b,d.locations,f,d.vertexBuffers,d.indexBuffer),a.instancedVAOBaseInstance=c))}};f.prototype._updateHighlightVAOs=function(){for(var a=0;a<this._highlights.length;++a)this._createBaseInstanceVAO(this._highlights[a])};f.prototype._getFallbackDepthTexture=function(){this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=new J(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([255,255,255,255])));return this._fallbackDepthStencilTexture};
return f}();var U=function(){function a(){this.reset()}a.prototype.reset=function(){this.VBOusedSize=this.VBOoptimalSize=this.VBOallocatedSize=this.instancesDrawnAngle=this.drawCallsHighlight=this.drawCallsFragmented=this.drawCallsPreinterleaved=this.drawCallsMerged=this.drawCallsAngleInstanced=this.drawCallsInstanced=this.trianglesRendered=0};return a}(),N=function(){return function(a,b,c,d,f,g,e,k){this.name=a;this.from=b;this.to=c;this.displayedIndexRange=d;this.transformation=f;this.instanceParameters=
g;this.idx=e;this.dataId=k;null!=f&&(this.transformationNormal=P.create(),P.set(f,this.transformationNormal),P.inverse(this.transformationNormal,this.transformationNormal),P.transpose(this.transformationNormal,this.transformationNormal))}}(),S;(function(a){a[a.Merged=0]="Merged";a[a.Instanced=1]="Instanced";a[a.Preinterleaved=2]="Preinterleaved"})(S||(S={}));var aa={updatedDisplayedIndexRange:!1,begin:0,end:0},V=q.create(),T=P.identity(),Q=P.create(),G=P.create();return f})},"esri/views/3d/webgl-engine/lib/ExternalRendererContainer":function(){define(["require",
"exports","./depthRange","./RenderSlot"],function(q,h,e,a){var d={near:0,far:0};return function(){function b(){this.renderersChanged=!1;this.renderers=[];this.slots=[];for(var b=0;b<a.MAX_SLOTS;++b)this.slots[b]=[]}b.prototype.addRenderer=function(a,b){this.renderers.push(b);for(var c=0;c<a.length;++c)this.slots[a[c]].push(b);this.renderersChanged=!0};b.prototype.removeRenderer=function(a){this.renderers=this.renderers.filter(function(b){return b!==a});for(var b=0;b<this.slots.length;++b)this.slots[b]=
this.slots[b].filter(function(b){return b!==a});this.renderersChanged=!0};b.prototype.prepareRender=function(a){for(var b=0,d=this.renderers;b<d.length;b++){var g=d[b];g.prepareRender&&g.prepareRender(a)}};b.prototype.render=function(a,b){b.slot=a;var c=!1,d=0;for(a=this.slots[a];d<a.length;d++){var g=a[d];g.render(b)&&(c=g.didRender=!0)}return c};b.prototype.queryDepthRange=function(a){d.near=Infinity;d.far=-Infinity;for(var b=0,f=this.renderers;b<f.length;b++){var g=f[b];g.queryDepthRange&&(g=g.queryDepthRange(a))&&
e.union(d,g,d)}return d};b.prototype.needsRender=function(){if(this.renderersChanged)return!0;for(var a=0,b=this.renderers;a<b.length;a++)if(b[a].needsRender)return!0;return!1};b.prototype.needsHighlight=function(){for(var a=0,b=this.renderers;a<b.length;a++)if(b[a].needsHighlight)return!0;return!1};b.prototype.needsLinearDepth=function(){for(var a=0,b=this.renderers;a<b.length;a++)if(b[a].needsLinearDepth)return!0;return!1};b.prototype.resetNeedsRender=function(){this.renderersChanged=!1;for(var a=
0,b=this.renderers;a<b.length;a++){var d=b[a];d.resetNeedsRender?d.resetNeedsRender():d.didRender&&(d.needsRender=!1,d.didRender=!1)}};return b}()})},"esri/views/3d/webgl-engine/lib/depthRange":function(){define(["require","exports"],function(q,h){function e(a,b){return{near:a,far:b}}function a(a,b,g){a.near=b;a.far=g;return a}Object.defineProperty(h,"__esModule",{value:!0});h.create=e;h.empty=function(d){return d?a(d,Infinity,-Infinity):e(Infinity,-Infinity)};h.set=a;h.union=function(a,b,g){void 0===
g&&(g=a);g.near=Math.min(a.near,b.near);g.far=Math.max(a.far,b.far);return g}})},"esri/views/3d/webgl-engine/lib/Float32ArrayList":function(){define(["require","exports","./Util"],function(q,h,e){return function(){function a(a){null==a?a=16:65536>a&&(a=e.nextHighestPowerOfTwo(a));this.array=new Float32Array(a);this.size=0}a.prototype.resize=function(a,b){void 0===b&&(b=!1);this.size=a;var d;if(this.size>this.array.length){for(a=this.array.length||1;a<this.size;)a*=2;d=new Float32Array(a);b&&d.set(this.array);
this.array=d;return!0}if(this.size<=this.array.length/2){a=this.array.length;for(d=2*this.size;a>=d;)a=Math.floor(a/2);d=new Float32Array(a);b&&d.set(this.array.subarray(0,a));this.array=d;return!0}return!1};a.prototype.append=function(a){var b=this.size;this.resize(this.size+a.length,!0);this.array.set(a,b)};a.prototype.erase=function(a,b){for(;a<b;++a)this.array[a]=0};a.prototype.getArray=function(){return this.array};a.prototype.getSize=function(){return this.size};return a}()})},"esri/views/3d/webgl-engine/lib/FxaaRenderPass":function(){define(["require",
"exports","../../../webgl/BufferObject","../../../webgl/Program","../../../webgl/VertexArrayObject"],function(q,h,e,a,d){return function(){function b(a){this.isEnabled=!1;this.vertexAttributeLocations={position:0};this.vertexBufferLayout=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}];this.rctx=a}b.prototype.enable=function(){if(!this.isEnabled){var b=this.rctx;this.program=new a(b,"\n      #version 100\n      precision highp float;\n\n      attribute vec2 position;\n\n      varying   vec2 fCoordinate;\n\n      void main() {\n        fCoordinate \x3d (position + 1.0 ) * 0.5;\n        gl_Position \x3d vec4(position, -1, 1);\n      }",
"\n      #version 100\n      #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      #else\n      precision mediump float;\n      #endif\n\n      /**\n       * @license\n       * Copyright (c) 2011 NVIDIA Corporation. All rights reserved.\n       *\n       * TO  THE MAXIMUM  EXTENT PERMITTED  BY APPLICABLE  LAW, THIS SOFTWARE  IS PROVIDED\n       * *AS IS*  AND NVIDIA AND  ITS SUPPLIERS DISCLAIM  ALL WARRANTIES,  EITHER  EXPRESS\n       * OR IMPLIED, INCLUDING, BUT NOT LIMITED  TO, NONINFRINGEMENT,IMPLIED WARRANTIES OF\n       * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO EVENT SHALL  NVIDIA\n       * OR ITS SUPPLIERS BE  LIABLE  FOR  ANY  DIRECT, SPECIAL,  INCIDENTAL,  INDIRECT,  OR\n       * CONSEQUENTIAL DAMAGES WHATSOEVER (INCLUDING, WITHOUT LIMITATION,  DAMAGES FOR LOSS\n       * OF BUSINESS PROFITS, BUSINESS INTERRUPTION, LOSS OF BUSINESS INFORMATION, OR ANY\n       * OTHER PECUNIARY LOSS) ARISING OUT OF THE  USE OF OR INABILITY  TO USE THIS SOFTWARE,\n       * EVEN IF NVIDIA HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.\n       */\n\n      #define FXAA_EDGE_THRESHOLD      (1.0/8.0)\n      #define FXAA_EDGE_THRESHOLD_MIN  (1.0/24.0)\n      #define FXAA_SEARCH_STEPS        16\n      #define FXAA_SEARCH_THRESHOLD    (1.0/4.0)\n      #define FXAA_SUBPIX_CAP          (3.0/4.0)\n      #define FXAA_SUBPIX_TRIM         (1.0/4.0)\n      #define FXAA_SUBPIX_TRIM_SCALE (1.0/(1.0 - FXAA_SUBPIX_TRIM))\n\n      uniform vec2 uRcpFrameDimension;\n      uniform sampler2D uColorTexture;\n      varying vec2 fCoordinate;\n\n      // Return the luma, the estimation of luminance from rgb inputs.\n      // This approximates luma using one FMA instruction,\n      // skipping normalization and tossing out blue.\n      // FxaaLuma() will range 0.0 to 2.963210702.\n      float FxaaLuma(vec3 rgb) {\n        return rgb.y * (0.587 / 0.299) + rgb.x;\n      }\n      vec3 FxaaLerp3(vec3 a, vec3 b, float amountOfA) {\n        return (vec3(-amountOfA) * b) + ((a * vec3(amountOfA)) + b);\n      }\n      vec4 FxaaTexOff(sampler2D tex, vec2 pos, ivec2 off, vec2 rcpFrame) {\n        float x \x3d pos.x + float(off.x) * rcpFrame.x;\n        float y \x3d pos.y + float(off.y) * rcpFrame.y;\n        return texture2D(tex, vec2(x, y));\n      }\n\n      // pos is the output of FxaaVertexShader interpolated across screen.\n      // xy -\x3e actual texture position {0.0 to 1.0}\n      // rcpFrame should be a uniform equal to  {1.0/frameWidth, 1.0/frameHeight}\n      vec3 FxaaPixelShader(vec2 pos, sampler2D tex, vec2 rcpFrame) {\n        vec3 rgbN \x3d FxaaTexOff(tex, pos.xy, ivec2( 0,-1), rcpFrame).xyz;\n        vec3 rgbW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1, 0), rcpFrame).xyz;\n        vec3 rgbM \x3d FxaaTexOff(tex, pos.xy, ivec2( 0, 0), rcpFrame).xyz;\n        vec3 rgbE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1, 0), rcpFrame).xyz;\n        vec3 rgbS \x3d FxaaTexOff(tex, pos.xy, ivec2( 0, 1), rcpFrame).xyz;\n        float lumaN \x3d FxaaLuma(rgbN);\n        float lumaW \x3d FxaaLuma(rgbW);\n        float lumaM \x3d FxaaLuma(rgbM);\n        float lumaE \x3d FxaaLuma(rgbE);\n        float lumaS \x3d FxaaLuma(rgbS);\n        float rangeMin \x3d min(lumaM, min(min(lumaN, lumaW), min(lumaS, lumaE)));\n        float rangeMax \x3d max(lumaM, max(max(lumaN, lumaW), max(lumaS, lumaE)));\n        float range \x3d rangeMax - rangeMin;\n        if (range \x3c max(FXAA_EDGE_THRESHOLD_MIN, rangeMax * FXAA_EDGE_THRESHOLD)) {\n          return rgbM;\n        }\n        vec3 rgbL \x3d rgbN + rgbW + rgbM + rgbE + rgbS;\n        float lumaL \x3d (lumaN + lumaW + lumaE + lumaS) * 0.25;\n        float rangeL \x3d abs(lumaL - lumaM);\n        float blendL \x3d max(0.0, (rangeL / range) - FXAA_SUBPIX_TRIM) * FXAA_SUBPIX_TRIM_SCALE;\n        blendL \x3d min(FXAA_SUBPIX_CAP, blendL);\n        vec3 rgbNW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1,-1), rcpFrame).xyz;\n        vec3 rgbNE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1,-1), rcpFrame).xyz;\n        vec3 rgbSW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1, 1), rcpFrame).xyz;\n        vec3 rgbSE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1, 1), rcpFrame).xyz;\n        rgbL +\x3d (rgbNW + rgbNE + rgbSW + rgbSE);\n        rgbL *\x3d vec3(1.0/9.0);\n        float lumaNW \x3d FxaaLuma(rgbNW);\n        float lumaNE \x3d FxaaLuma(rgbNE);\n        float lumaSW \x3d FxaaLuma(rgbSW);\n        float lumaSE \x3d FxaaLuma(rgbSE);\n        float edgeVert \x3d\n          abs((0.25 * lumaNW) + (-0.5 * lumaN) + (0.25 * lumaNE)) +\n          abs((0.50 * lumaW ) + (-1.0 * lumaM) + (0.50 * lumaE )) +\n          abs((0.25 * lumaSW) + (-0.5 * lumaS) + (0.25 * lumaSE));\n        float edgeHorz \x3d\n          abs((0.25 * lumaNW) + (-0.5 * lumaW) + (0.25 * lumaSW)) +\n          abs((0.50 * lumaN ) + (-1.0 * lumaM) + (0.50 * lumaS )) +\n          abs((0.25 * lumaNE) + (-0.5 * lumaE) + (0.25 * lumaSE));\n        bool horzSpan \x3d edgeHorz \x3e\x3d edgeVert;\n        float lengthSign \x3d horzSpan ? -rcpFrame.y : -rcpFrame.x;\n        if(!horzSpan) {\n          lumaN \x3d lumaW;\n          lumaS \x3d lumaE;\n        }\n        float gradientN \x3d abs(lumaN - lumaM);\n        float gradientS \x3d abs(lumaS - lumaM);\n        lumaN \x3d (lumaN + lumaM) * 0.5;\n        lumaS \x3d (lumaS + lumaM) * 0.5;\n        if (gradientN \x3c gradientS)\n        {\n          lumaN \x3d lumaS;\n          lumaN \x3d lumaS;\n          gradientN \x3d gradientS;\n          lengthSign *\x3d -1.0;\n        }\n        vec2 posN;\n        posN.x \x3d pos.x + (horzSpan ? 0.0 : lengthSign * 0.5);\n        posN.y \x3d pos.y + (horzSpan ? lengthSign * 0.5 : 0.0);\n        gradientN *\x3d FXAA_SEARCH_THRESHOLD;\n        vec2 posP \x3d posN;\n        vec2 offNP \x3d horzSpan ? vec2(rcpFrame.x, 0.0) : vec2(0.0, rcpFrame.y);\n        float lumaEndN \x3d lumaN;\n        float lumaEndP \x3d lumaN;\n        bool doneN \x3d false;\n        bool doneP \x3d false;\n        posN +\x3d offNP * vec2(-1.0, -1.0);\n        posP +\x3d offNP * vec2( 1.0,  1.0);\n        for(int i \x3d 0; i \x3c FXAA_SEARCH_STEPS; i++) {\n          if(!doneN) {\n            lumaEndN \x3d FxaaLuma(texture2D(tex, posN.xy).xyz);\n          }\n          if(!doneP) {\n            lumaEndP \x3d FxaaLuma(texture2D(tex, posP.xy).xyz);\n          }\n          doneN \x3d doneN || (abs(lumaEndN - lumaN) \x3e\x3d gradientN);\n          doneP \x3d doneP || (abs(lumaEndP - lumaN) \x3e\x3d gradientN);\n          if(doneN \x26\x26 doneP) { break; }\n          if(!doneN) {\n            posN -\x3d offNP;\n          }\n          if(!doneP) {\n            posP +\x3d offNP;\n          }\n        }\n        float dstN \x3d horzSpan ? pos.x - posN.x : pos.y - posN.y;\n        float dstP \x3d horzSpan ? posP.x - pos.x : posP.y - pos.y;\n        bool directionN \x3d dstN \x3c dstP;\n        lumaEndN \x3d directionN ? lumaEndN : lumaEndP;\n        if(((lumaM - lumaN) \x3c 0.0) \x3d\x3d ((lumaEndN - lumaN) \x3c 0.0)) {\n          lengthSign \x3d 0.0;\n        }\n        float spanLength \x3d (dstP + dstN);\n        dstN \x3d directionN ? dstN : dstP;\n        float subPixelOffset \x3d (0.5 + (dstN * (-1.0/spanLength))) * lengthSign;\n        vec3 rgbF \x3d texture2D(tex, vec2(\n          pos.x + (horzSpan ? 0.0 : subPixelOffset),\n          pos.y + (horzSpan ? subPixelOffset : 0.0))).xyz;\n        return FxaaLerp3(rgbL, rgbF, blendL);\n      }\n\n      void main() {\n        vec4 color;\n        vec2 screenCoord \x3d fCoordinate;\n        // if (screenCoord.x \x3c 0.5) {\n          color.rgb \x3d FxaaPixelShader(screenCoord, uColorTexture, uRcpFrameDimension);\n        // } else if (screenCoord.x \x3c 0.501 \x26\x26 screenCoord.x \x3e 0.499) {\n        //   color.rgb \x3d vec3(1,0,0);\n        // } else {\n        //   color \x3d texture2D(uColorTexture, fCoordinate);\n        // }\n        color.a \x3d 1.0;\n        gl_FragColor \x3d color;\n      }",
this.vertexAttributeLocations);var c=new Float32Array([-1,-1,3,-1,-1,3]);this.vao=new d(b,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new e(b,34962,35044,c)});this.isEnabled=!0}};b.prototype.disable=function(){this.isEnabled&&(this.program.dispose(),this.program=null,this.vao.dispose(),this.vao=null,this.isEnabled=!1)};b.prototype.render=function(a,b){this.enable();var c=this.rctx;c.bindVAO(this.vao);c.bindFramebuffer(b);var d=0,g=0;null!=b?(d=b.descriptor.width,g=b.descriptor.height):
(d=c.gl.canvas.width,g=c.gl.canvas.height);c.bindProgram(this.program);c.bindTexture(a.colorTexture,0);this.program.setUniform1i("uColorTexture",0);this.program.setUniform2f("uRcpFrameDimension",1/d,1/g);c.setFaceCullingEnabled(!1);c.drawArrays(4,0,3)};return b}()})},"esri/views/3d/webgl-engine/lib/HighlightTextureHelper":function(){define(["require","exports","./Util","../../../webgl/FramebufferObject"],function(q,h,e,a){return function(){function d(a){this._rctx=a;this.height=this.width=this.viewportToRestore=
this.fbo=null}Object.defineProperty(d.prototype,"enabled",{get:function(){return null!==this.fbo},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"framebuffer",{get:function(){return this.fbo},enumerable:!0,configurable:!0});d.prototype.setupFBOs=function(a){e.assert(this.enabled);this.viewportToRestore=a=a.fullViewport;this.width=a[2];this.height=a[3];this._rctx.setViewport(0,0,this.width,this.height)};d.prototype.prepareHighlightPass=
function(){e.assert(this.enabled);var a=this._rctx,d=a.gl;this.fbo.resize(this.width,this.height);a.bindFramebuffer(this.fbo);a.setClearColor(0,0,0,0);a.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT)};d.prototype.finish=function(a){var b=this._rctx;b.bindFramebuffer(a);b.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3])};d.prototype.enable=function(){this.enabled||(this.fbo=a.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,
dataType:32819,samplingMode:9729,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:1}))};d.prototype.disable=function(){this.enabled&&(this.fbo.dispose(),this.fbo=null)};return d}()})},"esri/views/webgl/FramebufferObject":function(){define(["require","exports","dojo/has","./Renderbuffer","./Texture"],function(q,h,e,a,d){return function(){function b(g,c,f,e){this._colorAttachment=this._stencilAttachment=this._depthAttachment=this._glName=this._context=null;this._initialized=!1;this._context=
g;this._desc={colorTarget:c.colorTarget,depthStencilTarget:c.depthStencilTarget,width:c.width,height:c.height,multisampled:c.multisampled};this._id=b._nextId++;f&&(g=void 0,f instanceof d?(this._colorAttachment=f,g=f.descriptor):(g=f,this._colorAttachment=new d(this._context,g)),0!==this._desc.colorTarget&&console.error("Framebuffer is initialized with a texture however the descriptor indicates using a renderbuffer color attachment!"),b._validateTextureDimensions(g,this._desc));e instanceof a?(2===
c.depthStencilTarget?this._stencilAttachment=e:1===c.depthStencilTarget||3===c.depthStencilTarget?this._depthAttachment=e:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),b._validateBufferDimensions(e.descriptor,this._desc)):e&&(this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),
c=void 0,e instanceof d?(this._depthStencilTexture=e,c=this._depthStencilTexture.descriptor):(c=e,this._depthStencilTexture=new d(this._context,c)),b._validateTextureDimensions(c,this._desc))}b.create=function(a,c){return new b(a,c)};b.createWithAttachments=function(a,c,d,e){return new b(a,d,c,e)};Object.defineProperty(b.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"colorTexture",{get:function(){return this._colorAttachment instanceof d?this._colorAttachment:null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"depthStencilTexture",{get:function(){return this._depthStencilTexture},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"width",{get:function(){return this._desc.width},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"height",{get:function(){return this._desc.height},enumerable:!0,configurable:!0});b.prototype.dispose=function(){this._context&&(this._disposeColorAttachment(),this._disposeDepthStencilAttachments(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context=null)};b.prototype.attachColorTexture=function(a){if(a){b._validateTextureDimensions(a.descriptor,this._desc);this._disposeColorAttachment();
if(this._initialized){this._context.bindFramebuffer(this);var c=this._context.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,a.glName,0)}this._colorAttachment=a}};b.prototype.detachColorTexture=function(){var a=void 0;if(this._colorAttachment instanceof d){a=this._colorAttachment;if(this._initialized){this._context.bindFramebuffer(this);var b=this._context.gl;this._context.gl.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,null,0)}this._colorAttachment=
null}return a};b.prototype.attachDepthStencilTexture=function(a){if(a){var c=a.descriptor;34041!==c.pixelFormat&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!");34042!==c.dataType&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8_WEBGL!");this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!");b._validateTextureDimensions(c,this._desc);
4!==this._desc.depthStencilTarget&&(this._desc.depthStencilTarget=4);this._disposeDepthStencilAttachments();this._initialized&&(this._context.bindFramebuffer(this),c=this._context.gl,c.framebufferTexture2D(c.FRAMEBUFFER,c.DEPTH_STENCIL_ATTACHMENT,c.TEXTURE_2D,a.glName,0));this._depthStencilTexture=a}};b.prototype.detachDepthStencilTexture=function(){var a=this._depthStencilTexture;if(a&&this._initialized){this._context.bindFramebuffer(this);var b=this._context.gl;this._context.gl.framebufferTexture2D(b.FRAMEBUFFER,
b.DEPTH_STENCIL_ATTACHMENT,b.TEXTURE_2D,null,0)}this._depthStencilTexture=null;return a};b.prototype.attachDepthStencilBuffer=function(a){if(a){var c=a.descriptor;34041!==c.internalFormat&&33189!==c.internalFormat&&console.error("Depth/Stencil buffer must have correct internalFormat");b._validateBufferDimensions(c,this._desc);this._disposeDepthStencilAttachments();this._desc.depthStencilTarget=34041===c.internalFormat?3:1;this._initialized&&(this._context.bindFramebuffer(this),c=this._context.gl,
c.framebufferRenderbuffer(c.FRAMEBUFFER,1===this._desc.depthStencilTarget?c.DEPTH_ATTACHMENT:c.DEPTH_STENCIL_ATTACHMENT,c.RENDERBUFFER,a.glName));this._depthAttachment=a}};b.prototype.detachDepthStencilBuffer=function(){var a=this._context.gl,b=this._depthAttachment;b&&this._initialized&&(this._context.bindFramebuffer(this),a.framebufferRenderbuffer(a.FRAMEBUFFER,1===this._desc.depthStencilTarget?a.DEPTH_ATTACHMENT:a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,null));this._depthAttachment=null;return b};
b.prototype.copyToTexture=function(a,b,d,e,n,l,p){(0>a||0>b||0>n||0>l)&&console.error("Offsets cannot be negative!");(0>=d||0>=e)&&console.error("Copy width and height must be greater than zero!");var c=this._desc,f=p.descriptor;3553!==p.descriptor.target&&console.error("Texture target must be TEXTURE_2D!");(a+d>c.width||b+e>c.height||n+d>f.width||l+e>f.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");c=this._context;c.bindTexture(p);c.bindFramebuffer(this);
c.gl.copyTexSubImage2D(3553,0,n,l,a,b,d,e)};b.prototype.readPixels=function(a,b,d,e,n,l,p){(0>=d||0>=e)&&console.error("Copy width and height must be greater than zero!");p||console.error("Target memory is not initialized!");this._context.bindFramebuffer(this);this._context.gl.readPixels(a,b,d,e,n,l,p)};b.prototype.resize=function(a,c){var f=this._desc;if(f.width!==a||f.height!==c)if(this._initialized)f.width=a,f.height=c,this._colorAttachment instanceof d?(g=this._colorAttachment,f=g.descriptor,
f.width=a,f.height=c,this._colorAttachment.dispose(),this._colorAttachment=new d(this._context,f),b._validateTextureDimensions(g.descriptor,this._desc)):this._colorAttachment&&this._disposeColorAttachment(),null!=this._depthStencilTexture?(f=this._depthStencilTexture.descriptor,f.width=a,f.height=c,this._depthStencilTexture.dispose(),this._depthStencilTexture=new d(this._context,f)):(this._depthAttachment||this._stencilAttachment)&&this._disposeDepthStencilAttachments(),this._context.getBoundFramebufferObject()===
this&&this._context.bindFramebuffer(null),this._initialized=!1;else{f.width=a;f.height=c;if(this._colorAttachment instanceof d){var g=this._colorAttachment;g.resize(a,c)}this._depthStencilTexture&&this._depthStencilTexture.resize(a,c)}};b.prototype.initialize=function(){if(this._initialized)return!1;var b=this._context.gl;this._glName&&b.deleteFramebuffer(this._glName);var c=b.createFramebuffer(),f=this._desc;b.bindFramebuffer(b.FRAMEBUFFER,c);if(!this._colorAttachment)if(0===f.colorTarget)this._colorAttachment=
new d(this._context,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:f.width,height:f.height});else{var e=new a(this._context,{internalFormat:32854,width:f.width,height:f.height});b.framebufferRenderbuffer(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.RENDERBUFFER,e.glName);this._colorAttachment=e}this._colorAttachment instanceof d&&b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,this._colorAttachment.glName,0);switch(f.depthStencilTarget){case 1:case 3:this._depthAttachment||
(this._depthAttachment=new a(this._context,{internalFormat:1===f.depthStencilTarget?33189:34041,width:f.width,height:f.height}));b.framebufferRenderbuffer(b.FRAMEBUFFER,1===f.depthStencilTarget?b.DEPTH_ATTACHMENT:b.DEPTH_STENCIL_ATTACHMENT,b.RENDERBUFFER,this._depthAttachment.glName);break;case 2:this._stencilAttachment||(this._stencilAttachment=new a(this._context,{internalFormat:36168,width:f.width,height:f.height}));b.framebufferRenderbuffer(b.FRAMEBUFFER,b.STENCIL_ATTACHMENT,b.RENDERBUFFER,this._stencilAttachment.glName);
break;case 4:this._depthStencilTexture||(this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),this._depthStencilTexture=new d(this._context,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:f.width,height:f.height})),b.framebufferTexture2D(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.TEXTURE_2D,this._depthStencilTexture.glName,0)}b.checkFramebufferStatus(b.FRAMEBUFFER)!==
b.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!");this._glName=c;return this._initialized=!0};b.prototype._disposeColorAttachment=function(){if(this._colorAttachment instanceof d){var a=this._colorAttachment;if(this._initialized){this._context.bindFramebuffer(this);var b=this._context.gl;b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,null,0)}a.dispose()}else this._colorAttachment instanceof WebGLRenderbuffer&&(a=this._colorAttachment,b=this._context.gl,this._initialized&&
(this._context.bindFramebuffer(this),b.framebufferRenderbuffer(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.RENDERBUFFER,null)),this._context.gl.deleteRenderbuffer(a));this._colorAttachment=null};b.prototype._disposeDepthStencilAttachments=function(){var a=this._context.gl;this._depthAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),a.framebufferRenderbuffer(a.FRAMEBUFFER,1===this._desc.depthStencilTarget?a.DEPTH_ATTACHMENT:a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,null)),this._depthAttachment.dispose(),
this._depthAttachment=null);this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.STENCIL_ATTACHMENT,a.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null);this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,null,0)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)};b._validateBufferDimensions=
function(a,b){console.assert(0<=a.width&&0<=a.height);void 0!==b.width&&0<=b.width&&void 0!==b.height&&0<=b.height?b.width===a.width&&b.height===a.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(b.width=a.width,b.height=a.height)};b._validateTextureDimensions=function(a,b){console.assert(0<=a.width&&0<=a.height);3553!==a.target&&console.error("Texture type must be TEXTURE_2D!");void 0!==b.width&&0<=b.width&&void 0!==b.height&&0<=b.height?b.width===a.width&&b.height===
a.height||console.error("Color attachment texture must match the framebuffer's!"):(b.width=a.width,b.height=a.height)};b._nextId=0;return b}()})},"esri/views/webgl/Renderbuffer":function(){define(["require","exports","dojo/has"],function(q,h,e){return function(){function a(d,b){this._context=d;this._desc=b;this._glName=null;this._id=-1;d=this._context.gl;this._id=++a._nextId;this._glName=d.createRenderbuffer();this._context.bindRenderbuffer(this);d.renderbufferStorage(d.RENDERBUFFER,b.internalFormat,
b.width,b.height)}Object.defineProperty(a.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});a.prototype.resize=function(a,b){var d=this._context.gl,c=this._desc;if(c.width!==a||c.height!==b)c.width=a,c.height=b,this._context.bindRenderbuffer(this),
d.renderbufferStorage(d.RENDERBUFFER,c.internalFormat,c.width,c.height)};a.prototype.dispose=function(){this._glName&&(this._context.gl.deleteRenderbuffer(this._glName),this._glName=null);this._context=null};a._nextId=0;return a}()})},"esri/views/3d/webgl-engine/lib/InstanceBufferData":function(){define(["require","exports","./Util"],function(q,h,e){return function(){function a(a,b){null==b&&(b=4);var d=e.nextHighestPowerOfTwo(b*a);this.array=new Float32Array(d);this.zeroItem=new Float32Array(a);
this.endSlot=0;this.perInstanceDataSize=a;this.emptySlots=[];this.emptySlotsIdx=0;this.id2slot={};this.slot2id=Array(b)}a.prototype.prepareFree=function(a){this.emptySlots.length+=a};a.prototype.free=function(a){a=this.id2slot[a];null!=a&&(this.emptySlots[this.emptySlotsIdx++]=a,this.slot2id[a]=void 0)};a.prototype.prepareAllocate=function(a){a-=this.emptySlotsIdx;0<a&&this._resizeArray((this.endSlot+a)*this.perInstanceDataSize)};a.prototype.allocate=function(a){var b;b=0<this.emptySlotsIdx?this.emptySlots[--this.emptySlotsIdx]:
this.endSlot++;this.id2slot[a]=b;this.slot2id[b]=a;return b};a.prototype.getSlot=function(a){return this.id2slot[a]};a.prototype.getOffset=function(a){return a*this.perInstanceDataSize};a.prototype.getArray=function(){return this.array};a.prototype.fill=function(a,b,g){this.array.set(g,a*this.perInstanceDataSize+b)};a.prototype.compact=function(){if(0<this.emptySlotsIdx){this.emptySlots.length=this.emptySlotsIdx;for(this.emptySlots.sort(function(a,b){return a-b});0<this.emptySlotsIdx&&this.emptySlots[this.emptySlotsIdx-
1]===this.endSlot;)this.emptySlotsIdx--,this.endSlot--;for(;0<this.emptySlotsIdx;){this.emptySlotsIdx--;var a=this.endSlot-1,b=this.emptySlots[this.emptySlotsIdx],g=a*this.perInstanceDataSize,c=b*this.perInstanceDataSize;this.array.set(this.array.subarray(g,g+this.perInstanceDataSize),c);this.array.set(this.zeroItem,g);g=this.slot2id[a];this.slot2id[a]=void 0;this.slot2id[b]=g;this.id2slot[g]=b;this.endSlot--}}this._resizeArray(this.endSlot*this.perInstanceDataSize);this.emptySlots.length=0;return this.array};
a.prototype._resizeArray=function(a){var b;if(a>this.array.length){for(b=this.array.length||1;b<a;)b*=2;a=new Float32Array(b);a.set(this.array);this.array=a}else if(a<=this.array.length/2){b=this.array.length;for(a*=2;b>=a;)b/=2;a=new Float32Array(b);a.set(this.array.subarray(0,b));this.array=a}};return a}()})},"esri/views/3d/webgl-engine/lib/IntervalUtilities":function(){define(["require","exports"],function(q,h){return function(){function e(){}e.copyIntervals=function(a){for(var d=[],b=0;b<a.length;b++){var g=
a[b];d.push([g[0],g[1]])}return d};e.convertFaceToIndexRange=function(a,d){for(var b=0;b<a.length;b++){var g=a[b];g[0]*=d;g[1]=g[1]*d+(d-1)}};e.sortIntervals=function(a){return a.sort(function(a,b){return a[0]===b[0]?a[1]>b[1]?1:a[1]<b[1]?-1:0:a[0]>b[0]?1:a[0]<b[0]?-1:0})};e.intersectIntervals=function(a,d){if(0>=a.length)return[];for(var b=[],g=0;g<a.length;g++){var c=a[g];c[1]<d[0]||c[0]>d[1]||(c=[c[0],c[1]],c[0]<d[0]&&(c[0]=d[0]),c[1]>d[1]&&(c[1]=d[1]),b.push(c))}return b};e.mergeIntervals=function(a){if(0>=
a.length)return[];var d=[];a=this.sortIntervals(a);d.push(a[0]);for(var b=1;b<a.length;b++){var g=d[d.length-1];g[1]+1<a[b][0]?d.push(a[b]):g[1]<a[b][1]&&(g[1]=a[b][1],d.pop(),d.push(g))}return d};e.invertIntervals=function(a,d){for(var b=[],g=0,c=0;c<a.length;c++){var f=a[c];f[0]>g&&b.push([g,f[0]-1]);g=f[1]+1}g<=d&&b.push([g,d]);return b};e.offsetIntervals=function(a,d){for(var b=[],g=0;g<a.length;g++){var c=a[g];b.push([c[0]+d,c[1]+d])}return b};return e}()})},"esri/views/3d/webgl-engine/lib/LinearDepthTextureHelper":function(){define(["require",
"exports","./Util","../../../webgl/FramebufferObject"],function(q,h,e,a){return function(){function d(a){this._rctx=a;this._depthFBO=void 0;this.height=this.width=this.viewportToRestore=null}Object.defineProperty(d.prototype,"enabled",{get:function(){return void 0!==this._depthFBO},set:function(a){a!==this.enabled&&(a?this.enable():this.disable())},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"framebuffer",{get:function(){return this._depthFBO},enumerable:!0,configurable:!0});
d.prototype.setupFBOs=function(a){e.assert(this.enabled);this.viewportToRestore=a=a.fullViewport;this.width=a[2];this.height=a[3];this._rctx.setViewport(0,0,this.width,this.height)};d.prototype.prepareDepthPass=function(){e.assert(this.enabled);var a=this._rctx,d=a.gl;this._depthFBO.resize(this.width,this.height);a.bindFramebuffer(this._depthFBO);a.setClearStencil(0);a.setClearColor(0,0,0,0);a.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT|d.STENCIL_BUFFER_BIT);a.setBlendingEnabled(!1)};d.prototype.finish=
function(a){var b=this._rctx;b.bindFramebuffer(a);b.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3])};d.prototype.enable=function(){e.assert(!this.enabled);this._depthFBO=a.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:3})};d.prototype.disable=function(){e.assert(this.enabled);this._depthFBO.dispose();this._depthFBO=
void 0};return d}()})},"esri/views/3d/webgl-engine/lib/NormalTextureHelper":function(){define(["require","exports","./Util","../../../webgl/FramebufferObject"],function(q,h,e,a){return function(){function d(a){this.rctx=a;this.normalFBO=void 0;this.height=this.width=this.viewportToRestore=null}Object.defineProperty(d.prototype,"enabled",{get:function(){return void 0!==this.normalFBO},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"framebuffer",{get:function(){return this.normalFBO},enumerable:!0,configurable:!0});d.prototype.setupFBOs=function(a){e.assert(this.enabled);this.viewportToRestore=a=a.viewport;this.width=a[2];this.height=a[3];this.rctx.setViewport(0,0,this.width,this.height)};d.prototype.prepareNormalPass=function(){e.assert(this.enabled);var a=this.rctx,d=a.gl;this.normalFBO.resize(this.width,this.height);a.bindFramebuffer(this.normalFBO);a.setClearColor(0,0,0,0);a.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT)};
d.prototype.finish=function(a){var b=this.rctx;b.bindFramebuffer(a);b.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3])};d.prototype.enable=function(){this.enabled||(this.normalFBO=a.createWithAttachments(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:1}))};d.prototype.disable=function(){this.enabled&&(this.normalFBO.dispose(),this.normalFBO=
void 0)};return d}()})},"esri/views/3d/webgl-engine/lib/RenderContext":function(){define(["require","exports","./RenderPass","./RenderSlot"],function(q,h,e,a){return function(){function d(){this.camera=null;this.pixelRatio=1;this.normals=this.lightingData=this.highlight=this.depth=null;this.pass=e.MATERIAL;this.shadowMap=null;this.slot=a.BACKGROUND;this.options=this.rctx=this.framebufferTex=this.stencilRenderingHelper=this.offscreenRenderingHelper=this.ssaoHelper=null;this.renderOccludedOnly=!1}Object.defineProperty(d.prototype,
"isHighlightPass",{get:function(){return this.pass===e.MATERIAL_HIGHLIGHT},enumerable:!0,configurable:!0});return d}()})},"esri/views/3d/webgl-engine/lib/SmaaRenderPass":function(){define("require exports ../../support/imageUtils ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/Texture ../../../webgl/VertexArrayObject".split(" "),function(q,h,e,a,d,b,g,c){return function(){function f(a){this.isEnabled=this._isLoadingResources=!1;this.vertexAttributeLocations=
{vPosition:0};this.vertexBufferLayout=[{name:"vPosition",count:2,type:5126,offset:0,stride:8,normalized:!1}];this.rctx=a}f.prototype.loadResources=function(a){var b=this;return this.data?!0:(this._isLoadingResources=!0,q(["./SmaaRenderPassData"],function(c){b.data=c;b._isLoadingResources=!1;a&&a()}),!1)};Object.defineProperty(f.prototype,"isLoadingResources",{get:function(){return this._isLoadingResources},enumerable:!0,configurable:!0});f.prototype.enable=function(){if(this.isEnabled)return!0;if(!this.loadResources())return!1;
var f=this.rctx;this.programEdgeDetect=new b(f,this.data.edgeDetectShader.vertex,this.data.edgeDetectShader.fragment,this.vertexAttributeLocations);this.programBlendWeights=new b(f,this.data.blendWeightShader.vertex,this.data.blendWeightShader.fragment,this.vertexAttributeLocations);this.programBlur=new b(f,this.data.blurShader.vertex,this.data.blurShader.fragment,this.vertexAttributeLocations);var g=new Float32Array([-1,-1,3,-1,-1,3]);this.vao=new c(f,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},
{geometry:new a(f,34962,35044,g)});this.tmpFramebufferEdges=d.createWithAttachments(this.rctx,{target:3553,pixelFormat:6407,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0});this.tmpFramebufferBlend=d.createWithAttachments(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0});this.textureArea=this.loadTextureFromBase64(this.data.areaTexture,9729,6407);this.textureSearch=
this.loadTextureFromBase64(this.data.searchTexure,9728,6409);return this.isEnabled=!0};f.prototype.disable=function(){this.isEnabled&&(this.programEdgeDetect.dispose(),this.programEdgeDetect=null,this.programBlendWeights.dispose(),this.programBlendWeights=null,this.programBlur.dispose(),this.programBlur=null,this.vao.dispose(),this.vao=null,this.textureArea.dispose(),this.textureArea=null,this.textureSearch.dispose(),this.textureSearch=null,this.tmpFramebufferBlend.dispose(),this.tmpFramebufferBlend=
null,this.tmpFramebufferEdges.dispose(),this.tmpFramebufferEdges=null,this.isEnabled=!1)};f.prototype.render=function(a,b){this.enable();var c=this.rctx,d=0,f=0;null!=b?(d=b.descriptor.width,f=b.descriptor.height):(d=c.gl.canvas.width,f=c.gl.canvas.height);c.bindVAO(this.vao);c.setFaceCullingEnabled(!0);c.setCullFace(1029);c.setFrontFace(2305);c.setBlendingEnabled(!1);c.setDepthTestEnabled(!1);c.setViewport(0,0,d,f);this.tmpFramebufferEdges.resize(d,f);c.bindFramebuffer(this.tmpFramebufferEdges);
c.setClearColor(0,0,0,1);c.clear(c.gl.COLOR_BUFFER_BIT);c.bindProgram(this.programEdgeDetect);c.bindTexture(a.colorTexture,0);this.programEdgeDetect.setUniform1i("tColor",0);this.programEdgeDetect.setUniform4f("uResolution",1/d,1/f,d,f);c.drawArrays(4,0,3);this.tmpFramebufferBlend.resize(d,f);c.bindFramebuffer(this.tmpFramebufferBlend);c.setClearColor(0,0,1,1);c.clear(c.gl.COLOR_BUFFER_BIT);c.bindProgram(this.programBlendWeights);this.programBlendWeights.setUniform4f("uResolution",1/d,1/f,d,f);c.bindTexture(this.textureSearch,
1);this.programBlendWeights.setUniform1i("tSearch",1);c.bindTexture(this.textureArea,2);this.programBlendWeights.setUniform1i("tArea",2);c.bindTexture(this.tmpFramebufferEdges.colorTexture,3);this.programBlendWeights.setUniform1i("tEdges",3);c.drawArrays(4,0,3);c.bindFramebuffer(b);c.setClearColor(0,1,0,1);c.clear(c.gl.COLOR_BUFFER_BIT);c.bindProgram(this.programBlur);this.programBlur.setUniform4f("uResolution",1/d,1/f,d,f);c.bindTexture(a.colorTexture,0);this.programBlur.setUniform1i("tColor",0);
c.bindTexture(this.tmpFramebufferBlend.colorTexture,1);this.programBlur.setUniform1i("tBlendWeights",1);c.drawArrays(4,0,3);c.setDepthTestEnabled(!0)};f.prototype.loadTextureFromBase64=function(a,b,c){var d=new g(this.rctx,{pixelFormat:c,dataType:5121,wrapMode:33071,samplingMode:b},null);e.requestImage(a).then(function(a){d.resize(a.width,a.height);d.setData(a)});return d};return f}()})},"esri/views/3d/webgl-engine/lib/StencilRenderingHelper":function(){define(["require","exports","./Util"],function(q,
h,e){return function(){function a(a){this._enabled=!1;this._rctx=a}Object.defineProperty(a.prototype,"enabled",{get:function(){return this._enabled},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});a.prototype.prepareStencilWritePass=function(){e.assert(this.enabled);var a=this._rctx;a.setStencilFunction(519,1,255);a.setStencilOp(7680,7680,7681);a.setStencilWriteMask(255)};a.prototype.finish=function(){if(this.enabled){var a=this._rctx;a.setStencilFunction(519,0,0);
a.setStencilOp(7680,7680,7680)}};a.prototype.enableStencilRead=function(){this.enabled&&this._rctx.setStencilFunction(517,1,255)};a.prototype.disableStencilRead=function(){this.enabled&&this._rctx.setStencilFunction(519,0,0)};a.prototype.enable=function(){this._enabled=!0;this._rctx.setStencilTestEnabled(!0)};a.prototype.disable=function(){this._enabled=!1;this._rctx.setStencilTestEnabled(!1)};return a}()})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeView":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/tsSupport/awaiterHelper ../../../../../core/tsSupport/generatorHelper ../../../../../core/arrayUtils ../../../../../core/promiseUtils ../../../../../core/requireUtils ../../../../../core/workers ../../../lib/glMatrix ../../../support/buffer/BufferView ../../../support/buffer/bufferViewUtil ../../../support/buffer/typedArrayUtil ../localOriginHelper ../LocalOriginManager ../PreinterleavedGeometryData ../RegularGridLocalOriginFactory ../Util ../TextureBackedBuffer/BufferManager ./bufferLayouts ./edgeBufferWriters ./EdgeProcessingWorker ./EdgeRenderer ./strokes ./util ../../../../webgl/BufferObject ../../../../webgl/VertexArrayObject module".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u,x,v,A,y,C,B,D,E,J,F,M){Object.defineProperty(h,"__esModule",{value:!0});var H=function(){function h(a,b,c){this.rctx=a;this.programRepository=b;this.callbacks=c;this.profilingCallback=null;this.perObjectData=new Map;this.renderers=new Map;this.localOrigins=new r.LocalOriginManager(new u(1E4));this.gpuMemoryUsage=this.numberOfRenderedEdges=0;this.worker=new C;this.workerThread=null;this.destroyed=!1;this.tmpModelPosition=k.vec3d.create();this.tmpCameraPosition=
k.vec3d.create();this.componentColorManager=new v.BufferManager(this.rctx,2)}h.isSupported=function(a){return!!a.capabilities.instancing};h.loadShaders=function(a,b,c){B.EdgeRenderer.loadShaders(a,b,c)};h.prototype.initialize=function(){var a=this;f.open(c.getAbsMid("./EdgeProcessingWorker",q,M),{client:this}).then(function(b){a.destroyed?b.close():a.workerThread=b});for(var b=A.VertexLayout.createBuffer(4),d=0;4>d;d++)b.sideness.set(d,0,0===d||3===d?0:1),b.sideness.set(d,1,0===d||1===d?0:1);this.verticesBufferObject=
J.createVertex(this.rctx,35044,b.buffer)};h.prototype.destroy=function(){this.destroyed||(this.workerThread&&(this.workerThread.close(),this.workerThread=null),this.verticesBufferObject&&(this.verticesBufferObject.dispose(),this.verticesBufferObject=null),this.destroyed=!0)};h.prototype.getGpuMemoryUsage=function(){return this.gpuMemoryUsage/1048576};Object.defineProperty(h.prototype,"numberOfRenderedPrimitives",{get:function(){return this.numberOfRenderedEdges},enumerable:!0,configurable:!0});h.prototype.shouldRender=
function(){return 0<this.renderers.size};h.prototype.addObject=function(b,c,f){return a(this,void 0,void 0,function(){var a,e,k,l,m,n,p;return d(this,function(d){switch(d.label){case 0:if(this.hasObject(b))return[2];a=[];k={loaded:g.create(function(a){e=a}),renderables:[]};this.perObjectData.set(b,k);if(f&&f.mergeGeometries&&1<b.geometries.length&&this.canMergeGeometries(b))a.push(this.addObjectMergedGeometries(b,k,c));else for(l=0;l<b.geometries.length;l++)m=b.geometries[l],n=b.geometryRecords[l],
p=n.materials[0],p.supportsEdges&&(m.data instanceof t?a.push(this.addGeometryPreinterleaved(b,k,m,m.data,n,c)):a.push(this.addGeometryNonPreinterleaved(b,k,m,m.data,n,c[0])));return[4,g.all(a)];case 1:return d.sent(),this.callbacks.setNeedsRender(),e(),[2]}})})};h.prototype.hasObject=function(a){return this.perObjectData.has(a)};h.prototype.updateAllComponentOpacities=function(b,c){return a(this,void 0,void 0,function(){var a,f;return d(this,function(d){switch(d.label){case 0:return(a=this.perObjectData.get(b))?
[4,a.loaded]:[2];case 1:return d.sent(),f=c instanceof Array?function(a){return c[a]}:function(a){return c},a.renderables.forEach(function(a){for(var b=a.components.meta.length,c=0;c<b;c++){var d=f(c),g=a.components.meta[c],e=g.index;g.material.opacity=d;a.components.buffer.textureBuffer.setDataElement(e,1,3,255*d)}a.allTransparent=E.determineAllTransparent(a.components.meta)}),this.callbacks.setNeedsRender(),[2]}})})};h.prototype.updateAllComponentMaterials=function(b,c){return a(this,void 0,void 0,
function(){var a,f=this;return d(this,function(d){switch(d.label){case 0:return(a=this.perObjectData.get(b))?[4,a.loaded]:[2];case 1:return d.sent(),a.renderables.forEach(function(a){var b=E.determineRequiresUberRenderer(c),d=B.EdgeRenderer.getKey(b,c[0].type);if(d!==a.rendererKey){var g=f.renderers.get(a.rendererKey),b=f.aquireRenderer(b,c[0].type);g.removeRenderable(a);g.refCount.decrement();a.rendererKey=d;b.addRenderable(a)}for(d=0;d<c.length;d++)a.components.meta[d].material=c[d];f.updateComponentBuffer(a.components);
a.allTransparent=E.determineAllTransparent(a.components.meta)}),this.callbacks.setNeedsRender(),[2]}})})};h.prototype.updateObjectVisibility=function(b,c){return a(this,void 0,void 0,function(){var a;return d(this,function(d){switch(d.label){case 0:return(a=this.perObjectData.get(b))?[4,a.loaded]:[2];case 1:return d.sent(),a.renderables.forEach(function(a){a.visible=c}),this.callbacks.setNeedsRender(),[2]}})})};h.prototype.removeObject=function(a){var b=this,c=this.perObjectData.get(a);c&&(this.perObjectData.delete(a),
c.loaded.then(function(){c.renderables.forEach(function(a){b.removeRenderable(a)});b.callbacks.setNeedsRender()}))};h.prototype.removeAll=function(){var a=this;this.perObjectData.forEach(function(b,c){a.removeObject(c)})};h.prototype.createSolidEdgeMaterial=function(a){return e({},I,a,{type:"solid"})};h.prototype.createSketchEdgeMaterial=function(a){return e({},K,a,{type:"sketch"})};h.prototype.render=function(a){var b=this;this.localOrigins.updateViewMatrices(a.view);this.renderers.forEach(function(a){0===
a.refCount.value&&(b.renderers.delete(a.key),a.dispose())});this.componentColorManager.garbageCollect();this.componentColorManager.updateTextures();var c=a.view,d=0,f=0;this.renderers.forEach(function(a){a.forEachRenderable(function(a){d+=a.statistics.averageEdgeLength;f++})});var g={distanceFalloffFactor:d/f*40,minimumEdgeLength:E.estimateLengthAtDistance(a.viewport[3],a.fovY,1,3.5)},e=this.rctx.capabilities.blendMinMax;e?(this.rctx.setDepthWriteEnabled(!1),this.rctx.setBlendingEnabled(!0),this.rctx.setBlendEquationSeparate(32774,
e.MAX),this.rctx.setBlendFunctionSeparate(1,0,1,1)):(this.rctx.setDepthWriteEnabled(!0),this.rctx.setBlendingEnabled(!1));this.rctx.setDepthTestEnabled(!0);this.rctx.setDepthFunction(515);this.updateObjectCameraDistances(a);this.numberOfRenderedEdges=0;this.renderers.forEach(function(c){b.renderRegularEdges(c,a,g);b.renderSilhouetteEdges(c,a,g)});this.rctx.setDepthWriteEnabled(!0);this.rctx.setDepthFunction(513);this.rctx.setBlendEquationSeparate(32774,32774);this.rctx.setBlendFunctionSeparate(1,
0,1,1);a.view=c};h.prototype.computeModelTransformWithLocalOrigin=function(a,b,c){a.getCombinedStaticTransformation(b,c);b.origin?this.localOrigins.register(b.origin):(a=k.vec3d.set3(c[12],c[13],c[14],this.tmpModelPosition),b.origin=this.localOrigins.aquire(a));m.applyToModelMatrix(b.origin.vec3,c);return c};h.prototype.updateComponentBuffer=function(a){var b=a.meta;a=a.buffer;for(var c=0;c<b.length;c++){var d=b[c].material,f=b[c].index,g=x.clamp(Math.round(d.size*B.LINE_WIDTH_FRACTION_FACTOR),0,
255),e=x.clamp(d.extensionLength,-B.EXTENSION_LENGTH_OFFSET,255-B.EXTENSION_LENGTH_OFFSET)+B.EXTENSION_LENGTH_OFFSET,k="solid"===d.type?0:1,l=255*d.opacity,d=d.color;a.textureBuffer.setData(f,0,255*d[0],255*d[1],255*d[2],255*d[3]);a.textureBuffer.setData(f,1,g,e,k,l)}};h.prototype.createComponentBuffers=function(a){for(var b=[],c=this.componentColorManager.getBuffer(a.length),d=0;d<a.length;d++){var f=a[d],g=c.aquireIndex();b.push({index:g,material:f})}a={meta:b,buffer:c};this.updateComponentBuffer(a);
return a};h.prototype.extractEdges=function(a,b,c,d){return this.worker.process({data:b,originalIndices:d,writerSettings:a,skipDeduplicate:c},this.workerThread)};h.prototype.createEdgeResources=function(a){var b={};if(0<a.regular.lodInfo.lengths.length){var c=new F(this.rctx,A.EdgeShaderAttributeLocations,{vertices:A.glVertexLayout,instances:y.RegularEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:J.createVertex(this.rctx,35044,a.regular.instancesData.buffer)});b.regular=
{vao:c,lod:a.regular.lodInfo}}0<a.silhouette.lodInfo.lengths.length&&(c=new F(this.rctx,A.EdgeShaderAttributeLocations,{vertices:A.glVertexLayout,instances:y.SilhouetteEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:J.createVertex(this.rctx,35044,a.silhouette.instancesData.buffer)}),b.silhouette={vao:c,lod:a.silhouette.lodInfo});return b};h.prototype.disposeEdgeResources=function(a){a.regular&&(a.regular.vao.vertexBuffers.instances.dispose(),a.regular.vao.dispose(!1),a.regular.vao=
null);a.silhouette&&(a.silhouette.vao.vertexBuffers.instances.dispose(),a.silhouette.vao.dispose(!1),a.silhouette.vao=null)};h.prototype.addGeometryNonPreinterleaved=function(b,c,f,g,e,l){return a(this,void 0,void 0,function(){var a,f,m,n;return d(this,function(d){switch(d.label){case 0:return a=g.getAttribute("position"),f=this.computeModelTransformWithLocalOrigin(b,e,k.mat4d.create()),m=e.origin,n={position:a,indices:g.getIndices("position"),modelTransform:f,origin:m},[4,this.addNonPreinterleaved(b,
c,n,l)];case 1:return d.sent(),[2]}})})};h.prototype.addNonPreinterleaved=function(b,c,f,g){return a(this,void 0,void 0,function(){var a,b,e,k,l,m,n,p,u,h,r,t,v,y,x;return d(this,function(d){switch(d.label){case 0:a=this.aquireRenderer(!1,g.type);b=f.modelTransform;e=f.origin;k=f.indices;l=f.position;m=l.data.length/l.strideIdx;n=A.EdgeInputBufferLayout.createBuffer(m);for(p=0;p<m;p++)n.position.set(p,0,l.data[l.offsetIdx+p*l.strideIdx+0]),n.position.set(p,1,l.data[l.offsetIdx+p*l.strideIdx+1]),n.position.set(p,
2,l.data[l.offsetIdx+p*l.strideIdx+2]);u=this.createComponentBuffers([g]);E.fillComponenBufferIndices(u.meta,[0,n.componentIndex.count],n.componentIndex);return[4,this.extractEdges(a.writerSettings,n,!1,k)];case 1:return h=d.sent(),r=this.createEdgeResources(h),t=r.regular,v=r.silhouette,y=(t?t.vao.size:0)+(v?v.vao.size:0),x={regular:t,silhouette:v,transform:{modelMatrix:b,origin:e},statistics:{gpuMemoryUsage:y,averageEdgeLength:h.averageEdgeLength},components:u,visible:!0,allTransparent:E.determineAllTransparent(u.meta),
distanceToCamera:0,rendererKey:a.key},c.renderables.push(x),a.addRenderable(x),this.gpuMemoryUsage+=y,[2]}})})};h.prototype.addGeometryPreinterleaved=function(b,c,f,g,e,m){return a(this,void 0,void 0,function(){var a,f,u,h,r,t,v,y,x,C,B,D,q,I,H,P,L;return d(this,function(d){switch(d.label){case 0:a=g.getAttribute("position");if(!a||!p.isFloat32Array(a.data))return console.warn("Geometry has no float32 `position` attribute, skipping it."),[2];f=m[0];u=E.determineRequiresUberRenderer(m);h=this.aquireRenderer(u,
f.type);r=this.computeModelTransformWithLocalOrigin(b,e,k.mat4d.create());t=e.origin;v=g.getIndices("position");y=new n.BufferViewVec3f(a.data.buffer,4*a.offsetIdx,4*a.strideIdx);x=A.EdgeInputBufferLayout.createBuffer(y.count);l.unrolledCopyVec3(x.position,y);C=this.createComponentBuffers(m);E.fillComponenBufferIndices(C.meta,g.componentOffsets,x.componentIndex,v);B=g.hasPositionData;return[4,this.extractEdges(h.writerSettings,x,B,v)];case 1:return D=d.sent(),q=this.createEdgeResources(D),I=q.regular,
H=q.silhouette,P=(I?I.vao.size:0)+(H?H.vao.size:0),L={regular:I,silhouette:H,transform:{modelMatrix:r,origin:t},statistics:{gpuMemoryUsage:P,averageEdgeLength:D.averageEdgeLength},components:C,visible:!b.isHidden(e),allTransparent:E.determineAllTransparent(C.meta),distanceToCamera:0,rendererKey:h.key},c.renderables.push(L),h.addRenderable(L),this.gpuMemoryUsage+=P,[2]}})})};h.prototype.canMergeGeometries=function(a){for(var c=null,d=null,f=0;f<a.geometries.length;f++){var g=a.geometryRecords[f];if(g.materials[0].supportsEdges){if(a.geometries[f].data instanceof
t)return!1;if(!c)c=g.transformation;else if(!b.equals(c,g.transformation))return!1;if(!d&&g.origin)d=g;else if(d&&g.origin&&d.origin.id!==g.origin.id)return!1}}return!0};h.prototype.addObjectMergedGeometries=function(b,c,f){return a(this,void 0,void 0,function(){var a,g,e,l,m,n,u,h,r,t,v,y,A,x,C,B,D,q,E,I,H;return d(this,function(d){switch(d.label){case 0:a=new Map;g=0;l=e=null;for(m=0;m<b.geometries.length;m++)if(n=b.geometries[m],u=b.geometryRecords[m],h=u.materials[0],h.supportsEdges&&(!l&&u.origin&&
(l=u),r=n.data.getIndices("position"),g+=r?r.length:0,r&&null==e||e===Uint16Array))e=p.isUint16Array(r)?Uint16Array:Uint32Array;t=g?new e(g):null;v=[];for(m=y=0;m<b.geometries.length;m++)if(n=b.geometries[m],A=b.geometryRecords[m],h=A.materials[0],h.supportsEdges){x=n.data.getAttribute("position");r=n.data.getIndices("position");C=a.get(x.data);if(null==C){C=v.length/3;for(B=x.offsetIdx;B<x.data.length;B+=x.strideIdx)v.push(x.data[B+0]),v.push(x.data[B+1]),v.push(x.data[B+2]);a.set(x.data,C)}if(r)for(D=
0;D<r.length;D++)t[y++]=C+r[D]}q=l||b.geometryRecords[0];E=this.computeModelTransformWithLocalOrigin(b,q,k.mat4d.create());I=q.origin;for(m=0;m<b.geometryRecords.length;m++)b.geometryRecords[m].origin=I;H={position:{data:v,offsetIdx:0,strideIdx:3},indices:t,modelTransform:E,origin:I};return[4,this.addNonPreinterleaved(b,c,H,f[0])];case 1:return d.sent(),[2]}})})};h.prototype.aquireRenderer=function(a,b){var c=B.EdgeRenderer.getKey(a,b),d=this.renderers.get(c);this.strokesTexture||(this.strokesTexture=
D.generateStrokesTexture(this.rctx));d||(d=new B.EdgeRenderer(this.rctx,this.programRepository,{type:b,strokesTexture:this.strokesTexture,uber:a}),this.renderers.set(c,d));d.refCount.increment();return d};h.prototype.removeRenderable=function(a){var b=this.renderers.get(a.rendererKey);b.removeRenderable(a);b.refCount.decrement();this.disposeEdgeResources(a);this.localOrigins.release(a.transform.origin);this.gpuMemoryUsage-=a.statistics.gpuMemoryUsage;for(var b=0,c=a.components.meta;b<c.length;b++)a.components.buffer.releaseIndex(c[b].index)};
h.prototype.updateObjectCameraDistances=function(a){var b=this;a=a.viewInvTransp;k.vec3d.set3(a[3],a[7],a[11],this.tmpCameraPosition);this.perObjectData.forEach(function(a,c){var d=k.vec3d.dist(c.getCenter(),b.tmpCameraPosition);a.renderables.forEach(function(a){return a.distanceToCamera=d})})};h.prototype.renderRegularEdges=function(a,b,c){var d=this;a.bindRegularEdges(b,c);a.forEachRenderable(function(f){if(f.visible&&f.regular&&!f.allTransparent){var g=E.computeEdgeCount(f.regular.lod.lengths,
f.distanceToCamera,c);b.view=d.localOrigins.getViewMatrix(f.transform.origin);a.renderRegularEdges(f,b,g);d.numberOfRenderedEdges+=g}})};h.prototype.renderSilhouetteEdges=function(a,b,c){var d=this;a.bindSilhouetteEdges(b,c);a.forEachRenderable(function(f){if(f.visible&&f.silhouette&&!f.allTransparent){var g=E.computeEdgeCount(f.silhouette.lod.lengths,f.distanceToCamera,c);b.view=d.localOrigins.getViewMatrix(f.transform.origin);a.renderSilhouetteEdges(f,b,g);d.numberOfRenderedEdges+=g}})};return h}();
h.EdgeView=H;var I={color:k.vec4d.createFrom(0,0,0,.2),size:1,extensionLength:0,opacity:1},K={color:k.vec4d.createFrom(0,0,0,.2),size:1,extensionLength:0,opacity:1}})},"esri/core/requireUtils":function(){define(["require","exports","dojo/Deferred"],function(q,h,e){function a(d,b){if(Array.isArray(b)){var g=new e;d(b,function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];g.resolve(a)});return g.promise}return a(d,[b]).then(function(a){return a[0]})}Object.defineProperty(h,"__esModule",
{value:!0});h.when=a;h.getAbsMid=function(a,b,g){return b.toAbsMid?b.toAbsMid(a):g.id.replace(/\/[^\/]*$/gi,"/")+a}})},"esri/core/workers":function(){define(["require","exports","./workers/workers"],function(q,h,e){Object.defineProperty(h,"__esModule",{value:!0});for(var a in e)h.hasOwnProperty(a)||(h[a]=e[a])})},"esri/core/workers/workers":function(){define("require exports dojo/sniff dojo/promise/all ../Logger ../promiseUtils ./Connection ./RemoteClient ./WorkerOwner".split(" "),function(q,h,e,
a,d,b,g,c,f){function k(){if(t)return t;for(var b=n+l,c=[],d=function(a){var b=f.create(a).then(function(b){return r[a]=b});c.push(b)},g=0;g<b;g++)d(g);return t=a(c).then(function(){})}Object.defineProperty(h,"__esModule",{value:!0});h.Connection=g;h.RemoteClient=c;(g=e("host-browser")?navigator.hardwareConcurrency:0)||(g=e("safari")&&e("mac")||e("trident")?8:2);var n=e("esri-workers-debug")?1:Math.max(1,Math.ceil(g/2)),l=e("esri-workers-debug")?1:Math.max(1,Math.floor(g/2)),p=d.getLogger("esri.core.workers"),
m=0,r=[];h.initialize=function(){k()};h.open=function(a,c,d){void 0===c&&(c={});if(Array.isArray(a))return new h.Connection(a.map(function(a){return new h.RemoteClient(a,c.client)}));if("string"!==typeof a){p.warn("workers-open:signature-deprecated","DEPRECATED: workers.open() changed signature.");var f=a;a=c;c={client:f,strategy:d?"dedicated":"distributed"}}var g=c.strategy||"distributed";return"local"===g?b.create(function(b){q([a],function(a){b(h.RemoteClient.connect(a))})}).then(function(a){return new h.Connection([new h.RemoteClient(a,
c.client)])}):k().then(function(){if("dedicated"===g){var d=n+m++;m%=l;return r[d].open(a).then(function(a){return new h.Connection([new h.RemoteClient(a,c.client)])})}return b.all(r.map(function(b){return b.open(a)})).then(function(a){return new h.Connection(a.map(function(a){return new h.RemoteClient(a,c.client)}))})})};h.terminate=function(){t&&(t.cancel(),t=null);for(var a=0;a<r.length;a++)r[a]&&r[a].terminate();r.length=0};var t=null})},"esri/core/workers/Connection":function(){define(["require",
"exports","../promiseUtils"],function(q,h,e){return function(){function a(a){this._clientIdx=0;this._clients=a}a.prototype.broadcast=function(a,b,g){for(var c=[],d=0,e=this._clients;d<e.length;d++)c.push(e[d].invoke(a,b,g));return c};a.prototype.close=function(){for(var a=0,b=this._clients;a<b.length;a++)b[a].close();this._clients=[]};a.prototype.invoke=function(a,b,g,c){var d=c&&c.client;if(!this._clients||!this._clients.length)return e.reject(Error("Connection closed"));null!=d&&-1!==this._clients.indexOf(d)||
this._clients.some(function(a){return a.isBusy()?!1:(d=a,!0)})||(this._clientIdx=(this._clientIdx+1)%this._clients.length,d=this._clients[this._clientIdx]);a=d.invoke(a,b,g);c&&(c.client=d);return a};a.prototype.openPorts=function(){return e.all(this._clients.map(function(a){return a.openPort()}))};return a}()})},"esri/core/workers/RemoteClient":function(){define("require exports dojo/Deferred ../Error ../promiseUtils ./utils".split(" "),function(q,h,e,a,d,b){function g(a,b){a["delete"](b)}var c=
b.MessageType.CLOSE,f=b.MessageType.CANCEL,k=b.MessageType.INVOKE,n=b.MessageType.RESPONSE,l=b.MessageType.OPEN_PORT,p=function(){function a(a){this._timer=null;this._cancelledJobIds=new Set;this._invokeMessages=[];this._invoke=a;this._timer=null;this._process=this._process.bind(this)}a.prototype.push=function(a){a.type===b.MessageType.CANCEL?this._cancelledJobIds.add(a.jobId):(this._invokeMessages.push(a),null===this._timer&&(this._timer=setTimeout(this._process,0)))};a.prototype.clear=function(){this._invokeMessages.length=
0;this._cancelledJobIds.clear();this._timer=null};a.prototype._process=function(){this._timer=null;for(var a=0,b=this._invokeMessages;a<b.length;a++){var c=b[a];this._cancelledJobIds.has(c.jobId)||this._invoke(c)}this._cancelledJobIds.clear();this._invokeMessages.length=0};return a}();return function(){function m(a,b,c){this._outJobs=new Map;this._inJobs=new Map;this._queue=new p(this._onInvoke.bind(this));this._onMessage=this._onMessage.bind(this);this._client=b;this._port=a;this._port.addEventListener("message",
this._onMessage);this._port.start();this._channel=c}m.connect=function(a){var b=new MessageChannel;a="function"===typeof a?new a:"default"in a&&"function"===typeof a.default?new a.default:a;a.remoteClient=new m(b.port1,a,b);return b.port2};m.prototype.close=function(){this._post({type:c});this._close()};m.prototype.isBusy=function(){return 0<this._outJobs.size};m.prototype.invoke=function(c,l,m){var n=this;if(!this._port)return d.reject(new a("remote-client:port-closed","Can't invoke(), port is closed"));
var p=b.newJobId(),u=new e(function(){g(n._outJobs,p);n._post({type:f,jobId:p})});this._outJobs.set(p,u);this._post({type:k,jobId:p,methodName:c},l,m);return u.promise};m.prototype.openPort=function(){var a=this,c=b.newJobId(),d=new e(function(){g(a._outJobs,c);a._post({type:f,jobId:c})});this._outJobs.set(c,d);this._post({type:l,jobId:c});return d.promise};m.prototype._close=function(){this._channel&&(this._channel=null);this._port.removeEventListener("message",this._onMessage);this._port.close();
this._outJobs.forEach(function(a){a.cancel()});this._inJobs.clear();this._outJobs.clear();this._queue.clear();this._port=this._client=null};m.prototype._onMessage=function(a){if(a=b.receiveMessage(a))switch(a.type){case n:this._onResponse(a);break;case k:this._queue.push(a);break;case f:this._onCancel(a);break;case c:this._close();break;case l:this._onOpenPort(a)}};m.prototype._onCancel=function(a){var b=this._inJobs,c=a.jobId,d=b.get(c);this._queue.push(a);d&&(g(b,c),d.cancel())};m.prototype._onInvoke=
function(a){var c=this,f=a.methodName,e=a.jobId;a=a.data;var k=this._inJobs,l=this._client,m=l[f],p;try{if(!m&&f&&-1!==f.indexOf("."))for(var h=f.split("."),r=0;r<h.length-1;r++)l=l[h[r]],m=l[h[r+1]];if("function"!==typeof m)throw new TypeError(f+" is not a function");p=m.call(l,a,this)}catch(E){this._post({type:n,jobId:e,error:b.toInvokeError(E)});return}d.isThenable(p)?(k.set(e,p),p.then(function(a){k.has(e)&&(g(k,e),c._post({type:n,jobId:e},a))}).catch(function(a){k.has(e)&&(g(k,e),a&&"cancel"===
a.dojoType||c._post({type:n,jobId:e,error:b.toInvokeError(a||{message:"Error encountered at method "+f})}))})):this._post({type:n,jobId:e},p)};m.prototype._onOpenPort=function(a){var b=new MessageChannel;new m(b.port1,this._client);this._post({type:n,jobId:a.jobId},b.port2,[b.port2])};m.prototype._onResponse=function(b){var c=b.jobId,d=b.error;b=b.data;var f=this._outJobs;if(f.has(c)){var e=f.get(c);g(f,c);d?e.reject(a.fromJSON(JSON.parse(d))):e.resolve(b)}};m.prototype._post=function(a,c,d){return b.postMessage(this._port,
a,c,d)};return m}()})},"esri/core/workers/utils":function(){define(["require","exports","dojo/has"],function(q,h,e){function a(a){return a&&"object"===typeof a&&("result"in a||"transferList"in a)}function d(a){return a instanceof ArrayBuffer||a&&a.constructor&&"ArrayBuffer"===a.constructor.name}Object.defineProperty(h,"__esModule",{value:!0});(function(a){a[a.HANDSHAKE=0]="HANDSHAKE";a[a.CONFIGURE=1]="CONFIGURE";a[a.CONFIGURED=2]="CONFIGURED";a[a.OPEN=3]="OPEN";a[a.OPENED=4]="OPENED";a[a.RESPONSE=
5]="RESPONSE";a[a.INVOKE=6]="INVOKE";a[a.CANCEL=7]="CANCEL";a[a.CLOSE=8]="CLOSE";a[a.OPEN_PORT=9]="OPEN_PORT"})(h.MessageType||(h.MessageType={}));var b=0;h.newJobId=function(){return b++};h.isTranferableResult=a;h.toInvokeError=function(a){return a?a.toJSON?JSON.stringify(a):JSON.stringify({name:a.name,message:a.message,details:a.details,stack:a.stack}):null};h.postMessage=function(b,c,f,k){2===arguments.length||void 0===f&&void 0===k?b.postMessage(c):(e("esri-workers-supports-transfer-arraybuffer")||
(k?(k=k.filter(function(a){return!d(a)}),k.length||(k=null)):a(f)&&f.transferList&&(f.transferList=f.transferList.filter(function(a){return!d(a)}),f.transferList.length||(f.transferList=null))),k?(c.data=f,b.postMessage(c,k)):a(f)?(c.data=f.result,f.transferList?b.postMessage(c,f.transferList):b.postMessage(c)):(c.data=f,b.postMessage(c)))};h.receiveMessage=function(a){return a?(a=a.data)?"string"===typeof a?JSON.parse(a):a:null:null}})},"esri/core/workers/WorkerOwner":function(){define("require exports dojo/Deferred ../../kernel ../Error ../Logger ../promiseUtils ./utils ./workerFactory".split(" "),
function(q,h,e,a,d,b,g,c,f){var k=b.getLogger("esri.core.workers"),n=c.MessageType.CANCEL,l=c.MessageType.INVOKE,p=c.MessageType.OPEN,m=c.MessageType.OPENED,r=c.MessageType.RESPONSE;return function(){function b(a,b){this._outJobs=new Map;this._inJobs=new Map;this.worker=a;this.id=b;a.addEventListener("message",this._onMessage.bind(this));a.addEventListener("error",function(a){a.preventDefault();k.error(a)})}b.create=function(a){return f.createWorker().then(function(c){return new b(c,a)})};b.prototype.terminate=
function(){this.worker.terminate()};b.prototype.open=function(a){var b=this,d=c.newJobId(),f=new e(function(a){b._outJobs["delete"](d);b._post({type:n,jobId:d})});this._outJobs.set(d,f);this._post({type:p,jobId:d,modulePath:a});return f.promise};b.prototype._onMessage=function(a){if(a=c.receiveMessage(a))switch(a.type){case m:case r:this._onResponse(a);break;case n:this._onCancel(a);break;case l:this._onInvoke(a)}};b.prototype._onCancel=function(a){(a=this._inJobs.get(a.jobId))&&a.cancel()};b.prototype._onInvoke=
function(b){var d=this,f=b.methodName,e=b.jobId;b=b.data;var k=this._inJobs,l=a.workerMessages[f],m;try{if("function"!==typeof l)throw new TypeError(f+" is not a function");m=l.call(null,b)}catch(D){this._post({type:r,jobId:e,error:c.toInvokeError(D)});return}g.isThenable(m)?(k.set(e,m),m.then(function(a){k["delete"](e);d._post({type:r,jobId:e},a)}).catch(function(a){k["delete"](e);a||(a={message:"Error encountered at method"+f});a.dojoType&&"cancel"===a.dojoType||d._post({type:r,jobId:e,error:c.toInvokeError(a)})})):
this._post({type:r,jobId:e},m)};b.prototype._onResponse=function(a){var b=a.jobId,c=a.error;a=a.data;var f=this._outJobs.get(b);f&&(this._outJobs["delete"](b),c?f.reject(d.fromJSON(JSON.parse(c))):f.resolve(a))};b.prototype._post=function(a,b,d){return c.postMessage(this.worker,a,b,d)};return b}()})},"esri/core/workers/workerFactory":function(){define("require exports ../tsSupport/assignHelper dojo/_base/kernel ../../config ../../request ../Logger ../promiseUtils ../sniff ../urlUtils ./loaderConfig ./utils ./WorkerFallback".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p){function m(b){return c.create(function(c){function g(m){if(m=l.receiveMessage(m))switch(m.type){case y:m=b;var p=d.workers.loaderUrl||n.DEFAULT_LOADER_URL,h;null!=d["default"]?(h=e({},d),delete h["default"],h=JSON.parse(JSON.stringify(h))):h=JSON.parse(JSON.stringify(d));var u=d.workers.loaderConfig,u=n.default({baseUrl:u.baseUrl,locale:a.locale,has:e({"config-deferredInstrumentation":0,"dojo-test-sniff":0,"esri-cors":1,"esri-secure-context":f("esri-secure-context"),
"esri-workers-supports-transfer-arraybuffer":f("esri-workers-supports-transfer-arraybuffer"),"events-keypress-typed":0,"host-webworker":1},u.has),map:e({},u.map),paths:e({},u.paths),packages:u.packages||[]});m.postMessage({type:A,configure:{esriConfig:h,loaderUrl:p,loaderConfig:u}});break;case v:b.removeEventListener("message",g),b.removeEventListener("error",k),c(b)}}function k(a){a.preventDefault();b.removeEventListener("message",g);b.removeEventListener("error",k);u.warn("Failed to create Worker. Fallback to execute module in main thread",
a);b=new p;b.addEventListener("message",g);b.addEventListener("error",k)}b.addEventListener("message",g);b.addEventListener("error",k)})}Object.defineProperty(h,"__esModule",{value:!0});var r=k.normalize(q.toUrl("./worker.js")),t=!k.hasSameOrigin(r,location.href),u=g.getLogger("esri.core.workers"),x=null,v=l.MessageType.CONFIGURED,A=l.MessageType.CONFIGURE,y=l.MessageType.HANDSHAKE;h.createWorker=function(){if(!f("esri-workers"))return m(new p);if(!t){var a=void 0;try{a=new Worker(r)}catch(B){u.warn("Failed to create Worker. Fallback to execute module in main thread",
event),a=new p}return m(a)}x||(x=b(r,{responseType:"text"}));return x.then(function(a){return new Worker(URL.createObjectURL(new Blob([a.data],{type:"text/javascript"})))}).catch(function(a){u.warn("Failed to create Worker. Fallback to execute module in main thread",a);return new p}).then(function(a){return m(a)})}})},"esri/core/workers/loaderConfig":function(){define(["require","exports","../tsSupport/assignHelper","dojo/has","../urlUtils"],function(q,h,e,a,d){Object.defineProperty(h,"__esModule",
{value:!0});a=a("esri-built")?"dojo/dojo-lite.js":"dojo/dojo.js";h.DEFAULT_LOADER_URL=d.makeAbsolute(d.removeQueryParameters(q.toUrl(a)));h.DEFAULT_CONFIG={baseUrl:function(){var a=d.removeQueryParameters(q.toUrl("dojo/x.js"));return d.makeAbsolute(a.slice(0,a.length-5))}(),packages:[{name:"esri"},{name:"dojo"},{name:"dojox"},{name:"dstore"},{name:"moment",main:"moment"},{name:"@dojo"},{name:"cldrjs",main:"dist/cldr"},{name:"globalize",main:"dist/globalize"},{name:"maquette",main:"dist/maquette.umd"},
{name:"maquette-css-transitions",main:"dist/maquette-css-transitions.umd"},{name:"maquette-jsx",main:"dist/maquette-jsx.umd"},{name:"tslib",main:"tslib"}],map:{globalize:{cldr:"cldrjs/dist/cldr","cldr/event":"cldrjs/dist/cldr/event","cldr/supplemental":"cldrjs/dist/cldr/supplemental","cldr/unresolved":"cldrjs/dist/cldr/unresolved"}}};h.default=function(a){var b={async:a.async,isDebug:a.isDebug,locale:a.locale,baseUrl:a.baseUrl,has:e({},a.has),map:e({},a.map),packages:a.packages&&a.packages.concat()||
[],paths:e({},a.paths)};a.hasOwnProperty("async")||(b.async=!0);a.hasOwnProperty("isDebug")||(b.isDebug=!1);a.baseUrl||(b.baseUrl=h.DEFAULT_CONFIG.baseUrl);h.DEFAULT_CONFIG.packages.forEach(function(a){a:{for(var c=b.packages,f=0;f<c.length;f++)if(c[f].name===a.name)break a;a=e({},a);f=d.removeQueryParameters(q.toUrl(a.name+"/x.js"));f=f.slice(0,f.length-5);a.location=d.makeAbsolute(f);c.push(a)}});a=b.map=b.map||{};for(var c=0,f=Object.keys(h.DEFAULT_CONFIG.map);c<f.length;c++){var k=f[c];a[k]||
(a[k]=h.DEFAULT_CONFIG.map[k])}return b}})},"esri/core/workers/WorkerFallback":function(){define(["require","exports","dojo/has","../global","./utils"],function(q,h,e,a,d){var b=function(){return function(){var a=this,b=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(function(c){a[c]=function(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];return b[c].apply(b,a)}})}}(),g=a.MutationObserver||a.WebKitMutationObserver,c=function(){var b;
if(a.process&&a.process.nextTick)b=function(b){a.process.nextTick(b)};else if(a.Promise)b=function(b){a.Promise.resolve().then(b)};else if(g){var c=[],d=document.createElement("div");(new g(function(){for(;0<c.length;)c.shift()()})).observe(d,{attributes:!0});b=function(a){c.push(a);d.setAttribute("queueStatus","1")}}return b}();return function(){function a(){this._dispatcher=new b;this._isInitialized=!1;this._workerPostMessage({type:d.MessageType.HANDSHAKE})}a.prototype.terminate=function(){};Object.defineProperty(a.prototype,
"onmessage",{get:function(){return this._onmessageHandler},set:function(a){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler);(this._onmessageHandler=a)&&this.addEventListener("message",a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"onerror",{get:function(){return this._onerrorHandler},set:function(a){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler);(this._onerrorHandler=a)&&this.addEventListener("error",a)},enumerable:!0,
configurable:!0});a.prototype.postMessage=function(a,b){var d=this;c(function(){d._workerMessageHandler(new MessageEvent("message",{data:a}))})};a.prototype.dispatchEvent=function(a){return this._dispatcher.dispatchEvent(a)};a.prototype.addEventListener=function(a,b,c){this._dispatcher.addEventListener(a,b,c)};a.prototype.removeEventListener=function(a,b,c){this._dispatcher.removeEventListener(a,b,c)};a.prototype._workerPostMessage=function(a,b){var d=this;c(function(){d.dispatchEvent(new MessageEvent("message",
{data:a}))})};a.prototype._workerMessageHandler=function(a){var b=this;if(a=d.receiveMessage(a)){var c=a.jobId;switch(a.type){case d.MessageType.CONFIGURE:this._isInitialized||this._workerPostMessage({type:d.MessageType.CONFIGURED});break;case d.MessageType.OPEN:q(["esri/core/workers/RemoteClient",a.modulePath],function(a,f){a=a.connect(f);b._workerPostMessage({type:d.MessageType.OPENED,jobId:c,data:a})})}}};return a}()})},"esri/views/3d/support/buffer/BufferView":function(){define("require exports ../../../../core/tsSupport/extendsHelper ./internals/Mat3 ./internals/Mat4 ./internals/Single ./internals/Vec2 ./internals/Vec3 ./internals/Vec4".split(" "),
function(q,h,e,a,d,b,g,c,f){Object.defineProperty(h,"__esModule",{value:!0});q=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Float32Array,b,c,d)||this}e(b,a);b.ElementType="f32";return b}(b.BufferViewSingle);h.BufferViewFloat=q;q=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Float32Array,b,c,d)||this}e(b,a);b.ElementType="f32";return b}(g.BufferViewVec2);h.BufferViewVec2f=q;q=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Float32Array,
b,c,d)||this}e(b,a);b.ElementType="f32";return b}(c.BufferViewVec3Impl);h.BufferViewVec3f=q;q=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Float32Array,b,c,d)||this}e(b,a);b.ElementType="f32";return b}(f.BufferViewVec4);h.BufferViewVec4f=q;a=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Float32Array,b,c,d)||this}e(b,a);b.ElementType="f32";return b}(a.BufferViewMat3);h.BufferViewMat3f=a;d=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,
Float32Array,b,c,d)||this}e(b,a);b.ElementType="f32";return b}(d.BufferViewMat4);h.BufferViewMat4f=d;d=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Float64Array,b,c,d)||this}e(b,a);b.ElementType="f64";return b}(b.BufferViewSingle);h.BufferViewFloat64=d;d=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Float64Array,b,c,d)||this}e(b,a);b.ElementType="f64";return b}(g.BufferViewVec2);h.BufferViewVec2f64=d;d=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,
Float64Array,b,c,d)||this}e(b,a);b.ElementType="f64";return b}(c.BufferViewVec3Impl);h.BufferViewVec3f64=d;d=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Float64Array,b,c,d)||this}e(b,a);b.ElementType="f64";return b}(f.BufferViewVec4);h.BufferViewVec4f64=d;d=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Uint8Array,b,c,d)||this}e(b,a);b.ElementType="u8";return b}(b.BufferViewSingle);h.BufferViewUint8=d;d=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,
Uint8Array,b,c,d)||this}e(b,a);b.ElementType="u8";return b}(g.BufferViewVec2);h.BufferViewVec2u8=d;d=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Uint8Array,b,c,d)||this}e(b,a);b.ElementType="u8";return b}(c.BufferViewVec3Impl);h.BufferViewVec3u8=d;d=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Uint8Array,b,c,d)||this}e(b,a);b.ElementType="u8";return b}(f.BufferViewVec4);h.BufferViewVec4u8=d;d=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,
Uint16Array,b,c,d)||this}e(b,a);b.ElementType="u16";return b}(b.BufferViewSingle);h.BufferViewUint16=d;d=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Uint16Array,b,c,d)||this}e(b,a);b.ElementType="u16";return b}(g.BufferViewVec2);h.BufferViewVec2u16=d;d=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Uint16Array,b,c,d)||this}e(b,a);b.ElementType="u16";return b}(c.BufferViewVec3Impl);h.BufferViewVec3u16=d;d=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,
Uint16Array,b,c,d)||this}e(b,a);b.ElementType="u16";return b}(f.BufferViewVec4);h.BufferViewVec4u16=d;d=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Uint32Array,b,c,d)||this}e(b,a);b.ElementType="u32";return b}(b.BufferViewSingle);h.BufferViewUint32=d;d=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Uint32Array,b,c,d)||this}e(b,a);b.ElementType="u32";return b}(g.BufferViewVec2);h.BufferViewVec2u32=d;d=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,
Uint32Array,b,c,d)||this}e(b,a);b.ElementType="u32";return b}(c.BufferViewVec3Impl);h.BufferViewVec3u32=d;d=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Uint32Array,b,c,d)||this}e(b,a);b.ElementType="u32";return b}(f.BufferViewVec4);h.BufferViewVec4u32=d;d=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Int8Array,b,c,d)||this}e(b,a);b.ElementType="i8";return b}(b.BufferViewSingle);h.BufferViewInt8=d;d=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,
Int8Array,b,c,d)||this}e(b,a);b.ElementType="i8";return b}(g.BufferViewVec2);h.BufferViewVec2i8=d;d=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Int8Array,b,c,d)||this}e(b,a);b.ElementType="i8";return b}(c.BufferViewVec3Impl);h.BufferViewVec3i8=d;d=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Int8Array,b,c,d)||this}e(b,a);b.ElementType="i8";return b}(f.BufferViewVec4);h.BufferViewVec4i8=d;d=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,
Int16Array,b,c,d)||this}e(b,a);b.ElementType="i16";return b}(b.BufferViewSingle);h.BufferViewInt16=d;d=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Int16Array,b,c,d)||this}e(b,a);b.ElementType="i16";return b}(g.BufferViewVec2);h.BufferViewVec2i16=d;d=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Int16Array,b,c,d)||this}e(b,a);b.ElementType="i16";return b}(c.BufferViewVec3Impl);h.BufferViewVec3i16=d;d=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,
Int16Array,b,c,d)||this}e(b,a);b.ElementType="i16";return b}(f.BufferViewVec4);h.BufferViewVec4i16=d;b=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Int32Array,b,c,d)||this}e(b,a);b.ElementType="i32";return b}(b.BufferViewSingle);h.BufferViewInt32=b;g=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Int32Array,b,c,d)||this}e(b,a);b.ElementType="i32";return b}(g.BufferViewVec2);h.BufferViewVec2i32=g;c=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,
Int32Array,b,c,d)||this}e(b,a);b.ElementType="i32";return b}(c.BufferViewVec3Impl);h.BufferViewVec3i32=c;f=function(a){function b(b,c,d){void 0===c&&(c=0);return a.call(this,Int32Array,b,c,d)||this}e(b,a);b.ElementType="i32";return b}(f.BufferViewVec4);h.BufferViewVec4i32=f})},"esri/views/3d/support/buffer/internals/Mat3":function(){define(["require","exports"],function(q,h){Object.defineProperty(h,"__esModule",{value:!0});q=function(){function e(a,d,b,g){void 0===b&&(b=0);a=this.TypedArrayConstructor=
a;void 0===g&&(g=9*a.BYTES_PER_ELEMENT);this.data=new a(d,0===d.byteLength?0:b);this.elementStride=g/a.BYTES_PER_ELEMENT}e.prototype.getMat=function(a,d){a*=this.elementStride;for(var b=0;9>b;b++)d[b]=this.data[a+b];return d};e.prototype.setMat=function(a,d){a*=this.elementStride;for(var b=0;9>b;b++)this.data[a+b]=d[b]};e.prototype.get=function(a,d){return this.data[a*this.elementStride+d]};e.prototype.set=function(a,d,b){this.data[a*this.elementStride+d]=b};Object.defineProperty(e.prototype,"count",
{get:function(){return Math.ceil(this.data.length/this.elementStride)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"buffer",{get:function(){return this.data.buffer},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"typedBuffer",{get:function(){return this.data},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"stride",{get:function(){return this.elementStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT},enumerable:!0,configurable:!0});e.ElementCount=
9;return e}();h.BufferViewMat3=q})},"esri/views/3d/support/buffer/internals/Mat4":function(){define(["require","exports"],function(q,h){Object.defineProperty(h,"__esModule",{value:!0});q=function(){function e(a,d,b,g){void 0===b&&(b=0);a=this.TypedArrayConstructor=a;void 0===g&&(g=16*a.BYTES_PER_ELEMENT);this.data=new a(d,0===d.byteLength?0:b);this.elementStride=g/a.BYTES_PER_ELEMENT}e.prototype.getMat=function(a,d){a*=this.elementStride;for(var b=0;16>b;b++)d[b]=this.data[a+b];return d};e.prototype.setMat=
function(a,d){a*=this.elementStride;for(var b=0;16>b;b++)this.data[a+b]=d[b]};e.prototype.get=function(a,d){return this.data[a*this.elementStride+d]};e.prototype.set=function(a,d,b){this.data[a*this.elementStride+d]=b};Object.defineProperty(e.prototype,"count",{get:function(){return Math.ceil(this.data.length/this.elementStride)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"buffer",{get:function(){return this.data.buffer},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,
"typedBuffer",{get:function(){return this.data},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"stride",{get:function(){return this.elementStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT},enumerable:!0,configurable:!0});e.ElementCount=16;return e}();h.BufferViewMat4=q})},"esri/views/3d/support/buffer/internals/Single":function(){define(["require","exports"],function(q,h){Object.defineProperty(h,"__esModule",{value:!0});q=function(){function e(a,d,b,g){void 0===b&&(b=0);a=this.TypedArrayConstructor=
a;void 0===g&&(g=a.BYTES_PER_ELEMENT);this.data=new a(d,0===d.byteLength?0:b);this.elementStride=g/a.BYTES_PER_ELEMENT}e.prototype.get=function(a){return this.data[a*this.elementStride]};e.prototype.set=function(a,d){this.data[a*this.elementStride]=d};Object.defineProperty(e.prototype,"count",{get:function(){return Math.ceil(this.data.length/this.elementStride)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"buffer",{get:function(){return this.data.buffer},enumerable:!0,configurable:!0});
Object.defineProperty(e.prototype,"typedBuffer",{get:function(){return this.data},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"stride",{get:function(){return this.elementStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT},enumerable:!0,configurable:!0});e.ElementCount=1;return e}();h.BufferViewSingle=q})},"esri/views/3d/support/buffer/internals/Vec2":function(){define(["require","exports","../../../lib/glMatrix"],function(q,h,e){Object.defineProperty(h,"__esModule",{value:!0});
q=function(){function a(a,b,g,c){void 0===g&&(g=0);a=this.TypedArrayConstructor=a;void 0===c&&(c=2*a.BYTES_PER_ELEMENT);this.data=new a(b,0===b.byteLength?0:g);this.elementStride=c/a.BYTES_PER_ELEMENT}a.prototype.getVec=function(a,b){return e.vec2d.set2(this.data[a*this.elementStride],this.data[a*this.elementStride+1],b)};a.prototype.setVec=function(a,b){this.data[a*this.elementStride]=b[0];this.data[a*this.elementStride+1]=b[1]};a.prototype.get=function(a,b){return this.data[a*this.elementStride+
b]};a.prototype.set=function(a,b,g){this.data[a*this.elementStride+b]=g};Object.defineProperty(a.prototype,"count",{get:function(){return Math.ceil(this.data.length/this.elementStride)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"buffer",{get:function(){return this.data.buffer},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"typedBuffer",{get:function(){return this.data},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"stride",{get:function(){return this.elementStride*
this.TypedArrayConstructor.BYTES_PER_ELEMENT},enumerable:!0,configurable:!0});a.ElementCount=2;return a}();h.BufferViewVec2=q})},"esri/views/3d/support/buffer/internals/Vec3":function(){define(["require","exports","../../../lib/glMatrix"],function(q,h,e){Object.defineProperty(h,"__esModule",{value:!0});q=function(){function a(a,b,g,c){void 0===g&&(g=0);a=this.TypedArrayConstructor=a;void 0===c&&(c=3*a.BYTES_PER_ELEMENT);this.data=new a(b,0===b.byteLength?0:g);this.elementStride=c/a.BYTES_PER_ELEMENT}
a.prototype.getVec=function(a,b){return e.vec3d.set3(this.data[a*this.elementStride],this.data[a*this.elementStride+1],this.data[a*this.elementStride+2],b)};a.prototype.setVec=function(a,b){this.data[a*this.elementStride]=b[0];this.data[a*this.elementStride+1]=b[1];this.data[a*this.elementStride+2]=b[2]};a.prototype.get=function(a,b){return this.data[a*this.elementStride+b]};a.prototype.set=function(a,b,g){this.data[a*this.elementStride+b]=g};Object.defineProperty(a.prototype,"count",{get:function(){return Math.ceil(this.data.length/
this.elementStride)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"buffer",{get:function(){return this.data.buffer},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"typedBuffer",{get:function(){return this.data},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"stride",{get:function(){return this.elementStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"typedBufferStride",{get:function(){return this.elementStride},
enumerable:!0,configurable:!0});a.ElementCount=3;return a}();h.BufferViewVec3Impl=q})},"esri/views/3d/support/buffer/internals/Vec4":function(){define(["require","exports","../../../lib/glMatrix"],function(q,h,e){Object.defineProperty(h,"__esModule",{value:!0});q=function(){function a(a,b,g,c){void 0===g&&(g=0);a=this.TypedArrayConstructor=a;void 0===c&&(c=4*a.BYTES_PER_ELEMENT);this.data=new a(b,0===b.byteLength?0:g);this.elementStride=c/a.BYTES_PER_ELEMENT}a.prototype.getVec=function(a,b){return e.vec4d.set4(this.data[a*
this.elementStride],this.data[a*this.elementStride+1],this.data[a*this.elementStride+2],this.data[a*this.elementStride+3],b)};a.prototype.setVec=function(a,b){this.data[a*this.elementStride]=b[0];this.data[a*this.elementStride+1]=b[1];this.data[a*this.elementStride+2]=b[2];this.data[a*this.elementStride+3]=b[3]};a.prototype.get=function(a,b){return this.data[a*this.elementStride+b]};a.prototype.set=function(a,b,g){this.data[a*this.elementStride+b]=g};Object.defineProperty(a.prototype,"count",{get:function(){return Math.ceil(this.data.length/
this.elementStride)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"buffer",{get:function(){return this.data.buffer},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"typedBuffer",{get:function(){return this.data},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"stride",{get:function(){return this.elementStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT},enumerable:!0,configurable:!0});a.ElementCount=4;return a}();h.BufferViewVec4=q})},"esri/views/3d/support/buffer/bufferViewUtil":function(){define(["require",
"exports"],function(q,h){Object.defineProperty(h,"__esModule",{value:!0});h.unrolledCopyVec3=function(e,a){var d=e.typedBuffer;e=e.typedBufferStride;var b=a.typedBuffer,g=a.typedBufferStride;a=a.count;for(var c=0;c<a;c++){var f=c*e,k=c*g;d[f]=b[k];d[f+1]=b[k+1];d[f+2]=b[k+2]}}})},"esri/views/3d/webgl-engine/lib/localOriginHelper":function(){define(["require","exports"],function(q,h){Object.defineProperty(h,"__esModule",{value:!0});h.applyToModelMatrix=function(e,a){var d=-e[0],b=-e[1];e=-e[2];var g=
a[3],c=a[7],f=a[11],k=a[15];a[0]+=g*d;a[1]+=g*b;a[2]+=g*e;a[4]+=c*d;a[5]+=c*b;a[6]+=c*e;a[8]+=f*d;a[9]+=f*b;a[10]+=f*e;a[12]+=k*d;a[13]+=k*b;a[14]+=k*e};h.applyToViewMatrix=function(e,a){var d=e[0],b=e[1];e=e[2];a[12]+=d*a[0]+b*a[4]+e*a[8];a[13]+=d*a[1]+b*a[5]+e*a[9];a[14]+=d*a[2]+b*a[6]+e*a[10];a[14]+=d*a[3]+b*a[7]+e*a[11]}})},"esri/views/3d/webgl-engine/lib/LocalOriginManager":function(){define(["require","exports","./gl-matrix","./localOriginHelper"],function(q,h,e,a){Object.defineProperty(h,"__esModule",
{value:!0});q=function(){function d(a){this.factory=a;this.originData=new Map}d.prototype.aquire=function(a){return this.register(this.factory.getOrigin(a))};d.prototype.register=function(a){var b=this.originData.get(a.id);if(b)return b.refCount++,b.origin;this.originData.set(a.id,{refCount:1,viewMatrix:e.mat4d.identity(),origin:a});return a};d.prototype.release=function(a){var b=this.originData.get(a.id);b&&(b.refCount--,0===b.refCount&&this.originData.delete(a.id))};d.prototype.updateViewMatrices=
function(b){this.originData.forEach(function(d){e.mat4d.set(b,d.viewMatrix);a.applyToViewMatrix(d.origin.vec3,d.viewMatrix)})};d.prototype.getViewMatrix=function(a){return this.originData.get(a.id).viewMatrix};return d}();h.LocalOriginManager=q})},"esri/views/3d/webgl-engine/lib/PreinterleavedGeometryData":function(){define(["require","exports","./ComponentUtils","./geometryDataUtils","../../../webgl/Util"],function(q,h,e,a,d){function b(a){switch(a){case 5120:return Int8Array;case 5126:return Float32Array;
case 5124:return Int32Array;case 5122:return Int16Array;case 5121:return Uint8Array;case 5125:return Uint32Array;case 5123:return Uint16Array}throw Error("Unhandled data type: "+a);}return function(){function g(c,f,k,n,l){void 0===k&&(k=null);void 0===n&&(n=g.DefaultOffsets);void 0===l&&(l=g.DefaultIndices);this.preinterleaved=!0;this.primitiveType="triangle";this._positionData=null;var p=d.getStride(f)/4,p=c.length/p;(this._hasDefaultIndices=l===g.DefaultIndices)&&(l=a.generateDefaultIndexArray(p));
for(var p={},m=0;m<f.length;m++){var h=f[m],t=new (b(h.type))(c.buffer),u=d.getBytesPerElement(h.type);p[h.name]={data:t,size:h.count,offsetIdx:h.offset/u,strideIdx:h.stride/u}}k&&(this._positionData=k,p.position={data:k.data,size:3,offsetIdx:0,strideIdx:3});this._id=a.getNewId();this._vertexData=c;this._vertexAttributes=p;this._layout=f;this._indexData=l;this._componentOffsets=e.createOffsets(n);this._gpuMemoryUsage=c.byteLength+(this._hasDefaultIndices?0:l.byteLength)}Object.defineProperty(g.prototype,
"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"layout",{get:function(){return this._layout},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"componentOffsets",{get:function(){return this._componentOffsets},enumerable:!0,configurable:!0});g.prototype.toRenderData=function(){var a={id:this._id.toString(),preinterleaved:!0,indexData:this._hasDefaultIndices?null:this._indexData,indexCount:this._indexData.length,vertexData:this._vertexData,
layout:this._layout};this._indexData=this._vertexData=null;this._vertexAttributes={position:this._vertexAttributes.position};return a};g.prototype.getIndices=function(a){return"position"===a&&this._positionData?this._positionData.indices:this._indexData};g.prototype.getAttribute=function(a){return this._vertexAttributes[a]};g.prototype.estimateGpuMemoryUsage=function(){return this._gpuMemoryUsage};Object.defineProperty(g.prototype,"hasPositionData",{get:function(){return!!this._positionData},enumerable:!0,
configurable:!0});g.DefaultOffsets=new Uint32Array(0);g.DefaultIndices=new Uint32Array(0);return g}()})},"esri/views/3d/webgl-engine/lib/RegularGridLocalOriginFactory":function(){define(["require","exports"],function(q,h){return function(){function e(a){this._gridSize=a;this._origins={}}e.prototype.getOrigin=function(a){var d=this._gridSize,b=Math.round(a[0]/d),g=Math.round(a[1]/d);a=Math.round(a[2]/d);var d=""+e.ORIGIN_PREFIX+b+"/"+g+"/"+a,c=this._origins[d];if(!c){var c=this._gridSize,f=e.OFFSET,
c={id:d,vec3:[b*c+f,g*c+f,a*c+f]};this._origins[d]=c}return c};e.ORIGIN_PREFIX="rg_";e.OFFSET=1.11;return e}()})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager":function(){define(["require","exports","./ManagedTextureBackedBuffer"],function(q,h,e){Object.defineProperty(h,"__esModule",{value:!0});q=function(){function a(a,b){void 0===b&&(b=1);this.rctx=a;this.fieldCount=b;this.buffers=[]}a.prototype.garbageCollect=function(){this.buffers=this.buffers.filter(function(a){return 0===
a.activeCount?(a.dispose(),!1):!0})};a.prototype.getBuffer=function(a){for(var b=0,d=this.buffers;b<d.length;b++){var c=d[b];if(c.availableCount>=a)return c}if(a>e.MAX_INDEX_COUNT)return null;a=new e.ManagedTextureBackedBuffer(this.rctx,this.fieldCount);this.buffers.push(a);return a};a.prototype.updateTextures=function(){for(var a=0,b=this.buffers;a<b.length;a++)b[a].textureBuffer.updateTexture()};return a}();h.BufferManager=q})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer":function(){define(["require",
"exports","./SimpleIndexManager","./TextureBackedBuffer"],function(q,h,e,a){Object.defineProperty(h,"__esModule",{value:!0});h.MAX_INDEX_COUNT=65536;q=function(){function d(b,d){void 0===d&&(d=1);this.textureBuffer=new a.TextureBackedBuffer(b,d);this.indexManager=new e.SimpleIndexManager(h.MAX_INDEX_COUNT)}d.prototype.dispose=function(){this.textureBuffer.dispose();this.textureBuffer=void 0};Object.defineProperty(d.prototype,"availableCount",{get:function(){return this.indexManager.availableCount},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"activeCount",{get:function(){return this.indexManager.activeCount},enumerable:!0,configurable:!0});d.prototype.aquireIndex=function(){var a=this.indexManager.aquire();this.textureBuffer.resizeToFit(a);return a};d.prototype.releaseIndex=function(a){this.indexManager.release(a)};return d}();h.ManagedTextureBackedBuffer=q})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager":function(){define(["require","exports"],
function(q,h){Object.defineProperty(h,"__esModule",{value:!0});q=function(){function e(a){this.maxCount=a;this._nextIndex=0;this.recycledIndices=[]}Object.defineProperty(e.prototype,"activeCount",{get:function(){return this._nextIndex-this.recycledIndices.length},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"availableCount",{get:function(){return this.recycledIndices.length+this.maxCount-this._nextIndex},enumerable:!0,configurable:!0});e.prototype.aquire=function(){if(0<this.recycledIndices.length)return this.recycledIndices.pop();
if(this.availableCount)return this._nextIndex++};e.prototype.release=function(a){this.recycledIndices.push(a)};return e}();h.SimpleIndexManager=q})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer":function(){define(["require","exports","../../../support/buffer/BufferView","../../../../webgl/Texture"],function(q,h,e,a){Object.defineProperty(h,"__esModule",{value:!0});q=function(){function d(b,d){void 0===d&&(d=1);this.rctx=b;this.fieldCount=d;this.textureWidth=4096;this.dirty=
!0;this.texture=new a(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:this.textureWidth,height:1,flipped:!1});this.data=new e.BufferViewVec4u8(new ArrayBuffer(4*this.textureWidth))}d.prototype.dispose=function(){this.texture.dispose();this.data=this.texture=void 0};d.prototype.setData=function(a,d,c,f,e,n){a=a*this.fieldCount+d;this.dirty=!0;this.data.set(a,0,c);this.data.set(a,1,f);this.data.set(a,2,e);this.data.set(a,3,n)};d.prototype.setDataElement=
function(a,d,c,f){a=a*this.fieldCount+d;this.dirty=!0;this.data.set(a,c,f)};d.prototype.resizeToFit=function(a){a*=this.fieldCount;a>=this.data.count&&(a=new e.BufferViewVec4u8(new ArrayBuffer(Math.ceil((a+1)/this.textureWidth)*this.textureWidth*4)),a.typedBuffer.set(this.data.typedBuffer),this.data=a)};d.prototype.updateTexture=function(){if(this.dirty){var a=this.texture.descriptor.width;this.data.count>a*this.texture.descriptor.height&&this.texture.resize(a,this.data.count/a);this.texture.setData(this.data.typedBuffer);
this.dirty=!1}};d.prototype.bind=function(a,d){this.rctx.bindTexture(this.texture,d.unit);a.setUniform1i(d.texName,d.unit);a.setUniform2f(d.invDimName,1/this.texture.descriptor.width,1/this.texture.descriptor.height)};return d}();h.TextureBackedBuffer=q})},"esri/views/3d/webgl-engine/lib/edgeRendering/bufferLayouts":function(){define(["require","exports","../../../support/buffer/glUtil","../../../support/buffer/InterleavedLayout"],function(q,h,e,a){Object.defineProperty(h,"__esModule",{value:!0});
h.EdgeInputBufferLayout=a.newLayout().vec3f("position").u16("componentIndex").u16("_padding");h.VertexLayout=a.newLayout().vec2u8("sideness");h.glVertexLayout=e.glLayout(h.VertexLayout,{prefixA:!0});h.CommonInstancesLayout=a.newLayout().vec3f("position0").vec3f("position1").u16("componentIndex").vec2u8("packedAttributes").u8("variantOffset",{glNormalized:!0}).u8("variantStroke").u8("variantExtension",{glNormalized:!0}).u8("_padding",{glPadding:!0});h.RegularEdgeInstancesLayout=h.CommonInstancesLayout.clone().vec3f("normal");
h.SilhouetteEdgeInstancesLayout=h.CommonInstancesLayout.clone().vec3f("normalA").vec3f("normalB");h.EdgeShaderAttributeLocations={aPosition0:0,aPosition1:1,aComponentIndex:2,aPackedAttributes:3,aVariantOffset:4,aVariantStroke:5,aVariantExtension:6,aNormal:7,aNormalA:7,aNormalB:8,aSideness:9}})},"esri/views/3d/support/buffer/glUtil":function(){define(["require","exports","../../../../core/tsSupport/assignHelper"],function(q,h,e){Object.defineProperty(h,"__esModule",{value:!0});var a={divisor:0,prefixA:!1};
h.glLayout=function(b,g){void 0===g&&(g={});g=e({},a,g);var c=b.stride;return b.fieldNames.filter(function(a){a=b.fields.get(a).optional;return!(a&&a.glPadding)}).map(function(a){var f=b.fields.get(a),e=f.constructor.ElementCount,l;l=d[f.constructor.ElementType];if(!l)throw Error("BufferType not supported in WebGL");var p=f.offset,f=f.optional&&!!f.optional.glNormalized;return{name:g.prefixA?"a"+a[0].toUpperCase()+a.substr(1):a,stride:c,count:e,type:l,offset:p,normalized:f,divisor:g.divisor}})};var d=
{u8:5121,u16:5123,u32:5125,i8:5120,i16:5122,i32:5124,f32:5126}})},"esri/views/3d/support/buffer/InterleavedLayout":function(){define(["require","exports","./BufferView"],function(q,h,e){Object.defineProperty(h,"__esModule",{value:!0});var a=function(){function a(a,b){this.layout=a;this.buffer="number"===typeof b?new ArrayBuffer(b*a.stride):b;b=0;for(var c=a.fieldNames;b<c.length;b++){var d=c[b],g=a.fields.get(d);this[d]=new g.constructor(this.buffer,g.offset,this.stride)}}Object.defineProperty(a.prototype,
"stride",{get:function(){return this.layout.stride},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"count",{get:function(){return this.buffer.byteLength/this.stride},enumerable:!0,configurable:!0});a.prototype.slice=function(b,c){return new a(this.layout,this.buffer.slice(b*this.stride,c*this.stride))};return a}(),d=function(){function b(){this.stride=0;this.fields=new Map;this.fieldNames=[]}b.prototype.vec2f=function(a,b){this.fields.set(a,{size:8,constructor:e.BufferViewVec2f,
offset:this.stride,optional:b});this.stride+=8;this.fieldNames.push(a);return this};b.prototype.vec2f64=function(a,b){this.fields.set(a,{size:16,constructor:e.BufferViewVec2f64,offset:this.stride,optional:b});this.stride+=16;this.fieldNames.push(a);return this};b.prototype.vec3f=function(a,b){this.fields.set(a,{size:12,constructor:e.BufferViewVec3f,offset:this.stride,optional:b});this.stride+=12;this.fieldNames.push(a);return this};b.prototype.vec3f64=function(a,b){this.fields.set(a,{size:24,constructor:e.BufferViewVec3f64,
offset:this.stride,optional:b});this.stride+=24;this.fieldNames.push(a);return this};b.prototype.vec4f=function(a,b){this.fields.set(a,{size:16,constructor:e.BufferViewVec4f,offset:this.stride,optional:b});this.stride+=16;this.fieldNames.push(a);return this};b.prototype.vec4f64=function(a,b){this.fields.set(a,{size:32,constructor:e.BufferViewVec4f64,offset:this.stride,optional:b});this.stride+=32;this.fieldNames.push(a);return this};b.prototype.mat3f=function(a,b){this.fields.set(a,{size:36,constructor:e.BufferViewMat3f,
offset:this.stride,optional:b});this.stride+=36;this.fieldNames.push(a);return this};b.prototype.mat4f=function(a,b){this.fields.set(a,{size:64,constructor:e.BufferViewMat4f,offset:this.stride,optional:b});this.stride+=64;this.fieldNames.push(a);return this};b.prototype.vec4u8=function(a,b){this.fields.set(a,{offset:this.stride,size:4,optional:b,constructor:e.BufferViewVec4u8});this.stride+=4;this.fieldNames.push(a);return this};b.prototype.f32=function(a,b){this.fields.set(a,{offset:this.stride,
size:4,optional:b,constructor:e.BufferViewFloat});this.stride+=4;this.fieldNames.push(a);return this};b.prototype.f64=function(a,b){this.fields.set(a,{offset:this.stride,size:8,optional:b,constructor:e.BufferViewFloat64});this.stride+=8;this.fieldNames.push(a);return this};b.prototype.u8=function(a,b){this.fields.set(a,{offset:this.stride,size:1,optional:b,constructor:e.BufferViewUint8});this.stride+=1;this.fieldNames.push(a);return this};b.prototype.u16=function(a,b){this.fields.set(a,{offset:this.stride,
size:2,optional:b,constructor:e.BufferViewUint16});this.stride+=2;this.fieldNames.push(a);return this};b.prototype.i8=function(a,b){this.fields.set(a,{offset:this.stride,size:1,optional:b,constructor:e.BufferViewInt8});this.stride+=1;this.fieldNames.push(a);return this};b.prototype.vec2i8=function(a,b){this.fields.set(a,{offset:this.stride,size:2,optional:b,constructor:e.BufferViewVec2i8});this.stride+=2;this.fieldNames.push(a);return this};b.prototype.vec2i16=function(a,b){this.fields.set(a,{offset:this.stride,
size:4,optional:b,constructor:e.BufferViewVec2i16});this.stride+=4;this.fieldNames.push(a);return this};b.prototype.vec2u8=function(a,b){this.fields.set(a,{offset:this.stride,size:2,optional:b,constructor:e.BufferViewVec2u8});this.stride+=2;this.fieldNames.push(a);return this};b.prototype.vec4u16=function(a,b){this.fields.set(a,{offset:this.stride,size:8,optional:b,constructor:e.BufferViewVec4u16});this.stride+=8;this.fieldNames.push(a);return this};b.prototype.u32=function(a,b){this.fields.set(a,
{offset:this.stride,size:4,optional:b,constructor:e.BufferViewUint32});this.stride+=4;this.fieldNames.push(a);return this};b.prototype.createBuffer=function(b){return new a(this,b)};b.prototype.createView=function(b){return new a(this,b)};b.prototype.clone=function(){var a=new b;a.stride=this.stride;a.fields=new Map;this.fields.forEach(function(b,d){return a.fields.set(d,b)});a.fieldNames=this.fieldNames.slice();a.BufferType=this.BufferType;return a};return b}();h.InterleavedLayout=d;h.newLayout=
function(){return new d}})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgeBufferWriters":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/tsSupport/extendsHelper ../../../lib/glMatrix ../../../support/buffer/glUtil ./bufferLayouts".split(" "),function(q,h,e,a,d,b,g){Object.defineProperty(h,"__esModule",{value:!0});var c=function(){function a(){}a.prototype.updateSettings=function(a){this.settings=a};a.prototype.write=function(a,b,c){var d=f;d[0]=
c.position0[0];d[1]=c.position0[1];d[2]=c.position0[2];d[3]=c.position1[0];d[4]=c.position1[1];d[5]=c.position1[2];n[0]=5381;for(d=0;d<k.length;d++)n[0]=31*n[0]+k[d];l.reseed(n[0]);var d=l.randomRangeInt(0,255),g=l.randomRangeInt(0,this.settings.variants-1),e=l.randomFloat(),e=-(1-Math.min(e/.7,1))+Math.max(0,e-.7)/(1-.7),e=255*(Math.pow(Math.abs(e),1.2)*(0>e?-1:1)*.5+.5);a.position0.setVec(b,c.position0);a.position1.setVec(b,c.position1);a.componentIndex.set(b,c.componentIndex);a.variantOffset.set(b,
d);a.variantStroke.set(b,g);a.variantExtension.set(b,e)};a.prototype.trim=function(a,b){return a.slice(0,b)};return a}();h.CommonBufferWriter=c;var f=new Float32Array(6),k=new Uint32Array(f.buffer),n=new Uint32Array(1),l=new (function(){function a(a){void 0===a&&(a=1);this.seed=a}a.prototype.randomFloat=function(){return this.step()/a.LARGE_PRIME};a.prototype.randomRangeInt=function(a,b){b-=a;return Math.round(a+this.randomFloat()*b)};a.prototype.reseed=function(a){this.seed=a};a.prototype.step=function(){return this.seed=
this.seed*a.SMALL_PRIME%a.LARGE_PRIME};a.LARGE_PRIME=2147483647;a.SMALL_PRIME=16807;return a}());q=function(){function a(){this.commonWriter=new c}a.prototype.updateSettings=function(a){this.commonWriter.updateSettings(a)};a.prototype.allocate=function(a){return g.RegularEdgeInstancesLayout.createBuffer(a)};a.prototype.write=function(a,b,c){this.commonWriter.write(a,b,c);c=d.vec3d.normalize(d.vec3d.add(c.faceNormal0,c.faceNormal1,p));a.normal.setVec(b,c)};a.prototype.trim=function(a,b){return this.commonWriter.trim(a,
b)};a.Layout=g.RegularEdgeInstancesLayout;a.glLayout=b.glLayout(g.RegularEdgeInstancesLayout,{prefixA:!0,divisor:1});return a}();h.RegularEdgeBufferWriter=q;q=function(){function a(){this.commonWriter=new c}a.prototype.updateSettings=function(a){this.commonWriter.updateSettings(a)};a.prototype.allocate=function(a){return g.SilhouetteEdgeInstancesLayout.createBuffer(a)};a.prototype.write=function(a,b,c){this.commonWriter.write(a,b,c);a.normalA.setVec(b,c.faceNormal0);a.normalB.setVec(b,c.faceNormal1)};
a.prototype.trim=function(a,b){return this.commonWriter.trim(a,b)};a.Layout=g.SilhouetteEdgeInstancesLayout;a.glLayout=b.glLayout(g.SilhouetteEdgeInstancesLayout,{prefixA:!0,divisor:1});return a}();h.SilhouetteEdgeBufferWriter=q;var p=d.vec3d.create()})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker":function(){define("require exports ../../../../../core/tsSupport/awaiterHelper ../../../../../core/tsSupport/generatorHelper ../../../support/meshProcessing ../../../support/buffer/typedArrayUtil ../../../support/buffer/workerHelper ./bufferLayouts ./edgeBufferWriters ./edgePreprocessing".split(" "),
function(q,h,e,a,d,b,g,c,f,k){return function(){function n(){this.regularWriter=new f.RegularEdgeBufferWriter;this.silhouetteWriter=new f.SilhouetteEdgeBufferWriter}n.prototype.process=function(b,c){return e(this,void 0,void 0,function(){var d,f,g;return a(this,function(a){switch(a.label){case 0:if(!c)return[3,2];d=[];f=this.packInput(b,d);this.wrappedWork;return[4,c.invoke("wrappedWork",f,d)];case 1:return g=a.sent(),[2,this.unpackOutput(g)];case 2:return[2,this.work(b)]}})})};n.prototype.wrappedWork=
function(b){return e(this,void 0,void 0,function(){var c,d,f,g;return a(this,function(a){c=this.unpackInput(b);d=this.work(c);f=[];this.packInputTransferables(c,f);g=this.packOutput(d,f);return[2,{result:g,transferList:f}]})})};n.prototype.work=function(a){var b=this.extractEdgeInformation(a.data,a.skipDeduplicate,a.originalIndices);this.regularWriter.updateSettings(a.writerSettings);this.silhouetteWriter.updateSettings(a.writerSettings);return k.extractEdges(b,this.regularWriter,this.silhouetteWriter)};
n.prototype.packInputTransferables=function(a,b){b.push(a.data.buffer)};n.prototype.packInput=function(a,c){this.packInputTransferables(a,c);c={dataBuffer:a.data.buffer,writerSettings:a.writerSettings,skipDeduplicate:a.skipDeduplicate};a.originalIndices&&(c.originalIndicesBuffer=a.originalIndices.buffer,c.originalIndicesType=b.isUint32Array(a.originalIndices)?"Uint32Array":"Uint16Array");return c};n.prototype.unpackInput=function(a){return{data:c.EdgeInputBufferLayout.createView(a.dataBuffer),originalIndices:"Uint32Array"===
a.originalIndicesType?new Uint32Array(a.originalIndicesBuffer):"Uint16Array"===a.originalIndicesType?new Uint16Array(a.originalIndicesBuffer):void 0,writerSettings:a.writerSettings,skipDeduplicate:a.skipDeduplicate}};n.prototype.packOutput=function(a,b){b.push(a.regular.lodInfo.lengths.buffer);b.push(a.silhouette.lodInfo.lengths.buffer);return{regular:{instancesData:g.packInterleavedBuffer(a.regular.instancesData,b),lodInfo:{lengths:a.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:g.packInterleavedBuffer(a.silhouette.instancesData,
b),lodInfo:{lengths:a.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:a.averageEdgeLength}};n.prototype.unpackOutput=function(a){return{regular:{instancesData:g.unpackInterleavedBuffer(a.regular.instancesData),lodInfo:{lengths:new Float32Array(a.regular.lodInfo.lengths)}},silhouette:{instancesData:g.unpackInterleavedBuffer(a.silhouette.instancesData),lodInfo:{lengths:new Float32Array(a.silhouette.lodInfo.lengths)}},averageEdgeLength:a.averageEdgeLength}};n.prototype.extractEdgeInformation=function(a,
b,f){if(b&&f)return b=d.computeNeighbors(f,a.count),{faces:f,neighbors:b,vertices:a};a=d.deduplicate(a.buffer,a.stride/4);f=this.selectIndexData(a.indices,f);b=d.computeNeighbors(f,a.uniqueCount);return{faces:f,neighbors:b,vertices:c.EdgeInputBufferLayout.createView(a.buffer)}};n.prototype.selectIndexData=function(a,c){if(c){c=b.slice(c);for(var d=0;d<c.length;d++)c[d]=a[c[d]];return c}return a};return n}()})},"esri/views/3d/support/meshProcessing":function(){define(["require","exports","../webgl-engine/lib/Util"],
function(q,h,e){Object.defineProperty(h,"__esModule",{value:!0});h.computeNeighbors=function(a,b){for(var d=a.length/3,c=new Uint32Array(b+1),f=new Uint32Array(b+1),e=function(a,b){a<b?c[a+1]++:f[b+1]++},n=0;n<d;n++){var l=a[3*n],p=a[3*n+1],m=a[3*n+2];e(l,p);e(p,m);e(m,l)}for(n=p=l=0;n<b;n++)m=c[n+1],e=f[n+1],c[n+1]=l,f[n+1]=p,l+=m,p+=e;for(var h=new Uint32Array(6*d),t=c[b],e=function(a,b,d){if(a<b){var g=c[a+1]++;h[2*g]=b;h[2*g+1]=d}else g=f[b+1]++,h[2*t+2*g]=a,h[2*t+2*g+1]=d},n=0;n<d;n++)l=a[3*
n],p=a[3*n+1],m=a[3*n+2],e(l,p,n),e(p,m,n),e(m,l,n);l=function(a,b){var c=2*a;a=b-a;for(b=1;b<a;b++){var d=h[c+2*b],f=h[c+2*b+1],g=b-1;for(g;0<=g&&h[c+2*g]>d;g--)h[c+2*g+2]=h[c+2*g],h[c+2*g+3]=h[c+2*g+1];h[c+2*g+2]=d;h[c+2*g+3]=f}};for(n=0;n<b;n++)l(c[n],c[n+1]),l(t+f[n],t+f[n+1]);for(var u=new Int32Array(3*d),x=function(b,c){return b===a[3*c]?0:b===a[3*c+1]?1:b===a[3*c+2]?2:-1},d=function(a,b){a=x(a,b);u[3*b+a]=-1},l=function(a,b,c,d){a=x(a,b);u[3*b+a]=d;c=x(c,d);u[3*d+c]=b},n=0;n<b;n++){for(var p=
c[n],m=c[n+1],e=f[n],v=f[n+1];p<m&&e<v;){var A=h[2*p],y=h[2*t+2*e];A===y?(l(n,h[2*p+1],y,h[2*t+2*e+1]),p++,e++):A<y?(d(n,h[2*p+1]),p++):(d(y,h[2*t+2*e+1]),e++)}for(;p<m;)d(n,h[2*p+1]),p++;for(;e<v;)y=h[2*t+2*e],d(y,h[2*t+2*e+1]),e++}return u};var a=null;h.deduplicate=function(d,b,g,c,f){void 0===g&&(g=0);void 0===c&&(c=0);void 0===f&&(f=d.byteLength/(4*b));d=new Uint32Array(d,c,f*b);c=new Uint32Array(f);var k=Math.floor(1.1*f)+1;if(null==a||a.length<2*k)a=new Uint32Array(e.nextHighestPowerOfTwo(2*
k));for(var n=0;n<2*k;n++)a[n]=0;for(var l=0,p=0!==g?Math.ceil(7.84*1.96/(g*g)*g*(1-g)):f,n=0;n<f;n++){if(n===p){var m=1-l/n;if(m+1.96*Math.sqrt(m*(1-m)/n)<g)return null;p*=2}for(var m=n*b,h,t=h=0;t<b;t++)h=d[m+t]+h|0,h=h+(h<<11)+(h>>>2)|0;h>>>=0;for(var t=h%k,u=l;0!==a[2*t+1];){if(a[2*t]===h){var x=a[2*t+1]-1,v=x*b;a:{for(var A=0;A<b;A++)if(d[m+A]!==d[v+A]){v=!1;break a}v=!0}if(v){u=c[x];break}}t++;t>=k&&(t-=k)}u===l&&(a[2*t]=h,a[2*t+1]=n+1,l++);c[n]=u}if(0!==g&&1-l/f<g)return null;g=new Uint32Array(b*
l);for(n=l=0;n<f;n++)if(c[n]===l){k=d;p=n*b;m=g;h=l*b;t=b;for(u=0;u<t;u++)m[h+u]=k[p+u];l++}return{buffer:g.buffer,indices:c,uniqueCount:l}}})},"esri/views/3d/support/buffer/workerHelper":function(){define(["require","exports","../../../../core/tsSupport/assignHelper","./BufferView","./InterleavedLayout"],function(q,h,e,a,d){function b(a){var b=[];a.fields.forEach(function(a,c){var d=a.constructor;a=e({},a,{constructor:d.ElementType+"_"+d.ElementCount});b.push([c,a])});return{stride:a.stride,fields:b,
fieldNames:a.fieldNames}}function g(a){var b=d.newLayout();b.stride=a.stride;b.fieldNames=a.fieldNames;a.fields.forEach(function(a){return b.fields.set(a[0],e({},a[1],{constructor:c.get(a[1].constructor)}))});return b}Object.defineProperty(h,"__esModule",{value:!0});h.packInterleavedBuffer=function(a,c){c.push(a.buffer);return{buffer:a.buffer,layout:b(a.layout)}};h.unpackInterleavedBuffer=function(a){return g(a.layout).createView(a.buffer)};h.packLayout=b;h.unpackLayout=g;q=[a.BufferViewFloat,a.BufferViewVec2f,
a.BufferViewVec3f,a.BufferViewVec4f,a.BufferViewMat4f,a.BufferViewFloat64,a.BufferViewVec2f64,a.BufferViewVec3f64,a.BufferViewVec4f64,a.BufferViewUint8,a.BufferViewVec2u8,a.BufferViewVec3u8,a.BufferViewVec4u8,a.BufferViewUint16,a.BufferViewVec2u16,a.BufferViewVec3u16,a.BufferViewVec4u16,a.BufferViewUint32,a.BufferViewVec2u32,a.BufferViewVec3u32,a.BufferViewVec4u32,a.BufferViewInt8,a.BufferViewVec2i8,a.BufferViewVec3i8,a.BufferViewVec4i8,a.BufferViewInt16,a.BufferViewVec2i16,a.BufferViewVec3i16,a.BufferViewVec4i16,
a.BufferViewInt32,a.BufferViewVec2i32,a.BufferViewVec3i32,a.BufferViewVec4i32];var c=new Map;q.forEach(function(a){return c.set(a.ElementType+"_"+a.ElementCount,a)})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgePreprocessing":function(){define("require exports ../../../../../core/arrayUtils ../../../lib/glMatrix ../../../support/mathUtils ../../../support/buffer/typedArrayUtil".split(" "),function(q,h,e,a,d,b){function g(b,c){var d=Math.acos(b.cosAngle),f=k.fwd,g=k.ortho;a.vec3d.normalize(a.vec3d.direction(b.position0,
b.position1,f));b=0<a.vec3d.dot(a.vec3d.cross(b.faceNormal0,b.faceNormal1,g),f)?-1:1;return d*b>c}function c(a){var b=a.faces.length/3,c=a.faces;a=a.neighbors;for(var d=0,f=0;f<b;f++)var g=a[3*f+0],e=a[3*f+1],k=a[3*f+2],l=c[3*f+0],n=c[3*f+1],p=c[3*f+2],d=d+(-1===g||l<n?1:0),d=d+(-1===e||n<p?1:0),d=d+(-1===k||p<l?1:0);for(var d=new Int32Array(4*d),h=0,f=0;f<b;f++){g=a[3*f+0];e=a[3*f+1];k=a[3*f+2];l=c[3*f+0];n=c[3*f+1];p=c[3*f+2];if(-1===g||l<n)d[h++]=l,d[h++]=n,d[h++]=f,d[h++]=g;if(-1===e||n<p)d[h++]=
n,d[h++]=p,d[h++]=f,d[h++]=e;if(-1===k||p<l)d[h++]=p,d[h++]=l,d[h++]=f,d[h++]=k}return d}function f(b){var c=b.faces.length/3,d=b.vertices.position;b=b.faces;for(var f=n.v0,g=n.v1,e=n.v2,k=new Float32Array(3*c),l=0;l<c;l++){var p=b[3*l+1],h=b[3*l+2];d.getVec(b[3*l+0],f);d.getVec(p,g);d.getVec(h,e);a.vec3d.subtract(g,f);a.vec3d.subtract(e,f);a.vec3d.normalize(a.vec3d.cross(g,e,f));k[3*l+0]=f[0];k[3*l+1]=f[1];k[3*l+2]=f[2]}return k}Object.defineProperty(h,"__esModule",{value:!0});h.extractEdges=function(n,
m,h,t){void 0===t&&(t=l);var p=n.vertices.position,r=n.vertices.componentIndex,v=d.deg2rad(t.anglePlanar);t=d.deg2rad(t.angleSignificantEdge);var A=Math.cos(t),y=Math.cos(v),C=k.edge,B=C.position0,q=C.position1,E=C.faceNormal0,J=C.faceNormal1,F=f(n),M=c(n),H=M.length/4;n=m.allocate(H);t=0;var I=h.allocate(H),K=0,O=0,P=0,L=e.range(0,H),U=new Float32Array(H);b.forEach(U,function(b,c,d){p.getVec(M[4*c+0],B);p.getVec(M[4*c+1],q);d[c]=a.vec3d.dist(B,q)});L.sort(function(a,b){return U[b]-U[a]});for(var N=
[],S=[],aa=0;aa<H;aa++){var V=L[aa],T=U[V],Q=M[4*V+0],G=M[4*V+1],X=M[4*V+2],V=M[4*V+3],Z=-1===V;p.getVec(Q,B);p.getVec(G,q);if(Z)a.vec3d.set3(F[3*X+0],F[3*X+1],F[3*X+2],E),a.vec3d.set(E,J),C.componentIndex=r.get(Q),C.cosAngle=a.vec3d.dot(E,J);else if(a.vec3d.set3(F[3*X+0],F[3*X+1],F[3*X+2],E),a.vec3d.set3(F[3*V+0],F[3*V+1],F[3*V+2],J),C.componentIndex=r.get(Q),C.cosAngle=a.vec3d.dot(E,J),C.cosAngle>y)continue;O+=T;P++;Z||C.cosAngle<A?(m.write(n,t++,C),N.push(T)):g(C,v)&&(h.write(I,K++,C),S.push(T))}r=
new Float32Array(N.reverse());v=new Float32Array(S.reverse());return{regular:{instancesData:m.trim(n,t),lodInfo:{lengths:r}},silhouette:{instancesData:h.trim(I,K),lodInfo:{lengths:v}},averageEdgeLength:O/P}};var k={edge:{position0:a.vec3d.create(),position1:a.vec3d.create(),faceNormal0:a.vec3d.create(),faceNormal1:a.vec3d.create(),componentIndex:0,cosAngle:0},ortho:a.vec3d.create(),fwd:a.vec3d.create()},n={v0:a.vec3d.create(),v1:a.vec3d.create(),v2:a.vec3d.create()},l={anglePlanar:4,angleSignificantEdge:35}})},
"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/tsSupport/extendsHelper dojo/text!./EdgeRenderer.xml dojo/text!./EdgeRendererUtils.xml ../../../lib/glMatrix ../../../support/mathUtils ../ShaderVariations ./bufferLayouts".split(" "),function(q,h,e,a,d,b,g,c,f,k){Object.defineProperty(h,"__esModule",{value:!0});h.LINE_WIDTH_FRACTION_FACTOR=8;h.EXTENSION_LENGTH_OFFSET=128;var n={type:"solid",
uber:!0,strokesTexture:null},l=function(){function a(){this._value=0}Object.defineProperty(a.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0});a.prototype.increment=function(){this._value++};a.prototype.decrement=function(){this._value--};return a}();q=function(){function a(b,c,d){this.rctx=b;this.programRepository=c;this.refCount=new l;this.renderables=new Set;this.depthBiasZ=-4E-4;this.depthBiasXY=.5;this.tmpViewToWorldNormalMatrix=g.mat3d.create();this.settings=
e({},n,d);this.key=a.getKey(this.settings.uber,this.settings.type);this.writerSettings={variants:this.settings.strokesTexture.variants};this.createPrograms()}a.prototype.dispose=function(){for(var a in this.programs){var b=this.programs[a];b&&(this.programRepository.decreaseRefCount(b),this.programs[a]=null)}};a.prototype.addRenderable=function(a){this.renderables.add(a)};a.prototype.removeRenderable=function(a){this.renderables.delete(a)};a.prototype.forEachRenderable=function(a){this.renderables.forEach(a)};
a.prototype.bindRegularEdges=function(a,b){this.bind(this.programs.regular,a,b)};a.prototype.bindSilhouetteEdges=function(a,b){this.bind(this.programs.silhouette,a,b)};a.prototype.bind=function(a,b,c){this.rctx.bindProgram(a);a.setUniformMatrix4fv("uProj",b.proj);a.setUniform2f("uDepthBias",this.depthBiasXY,this.depthBiasZ);a.setUniform2f("uPixelToNDC",2/b.viewport[2],2/b.viewport[3]);a.setUniform2f("uNDCToPixel",b.viewport[2]/2,b.viewport[3]/2);a.setUniform1f("uDistanceFalloffFactor",c.distanceFalloffFactor);
a.setUniform2f("uViewportDimInv",1/b.viewport[2],1/b.viewport[3])};a.prototype.renderRegularEdges=function(a,b,c){this.render(this.programs.regular,a,a.regular.vao,b,c)};a.prototype.renderSilhouetteEdges=function(a,b,c){this.render(this.programs.silhouette,a,a.silhouette.vao,b,c)};a.prototype.render=function(a,b,c,d,f){this.setUniforms(a,b,d);a=this.rctx;a.bindVAO(c);a.capabilities.instancing.drawArraysInstanced(6,0,4,f)};a.prototype.setUniforms=function(a,b,c){b.components.buffer.textureBuffer.bind(a,
h.componentDataBindParameters);a.setUniformMatrix4fv("uView",c.view);a.setUniformMatrix4fv("uModel",b.transform.modelMatrix);var d=c.viewInvTransp,f=g.mat4d.toMat3(d,this.tmpViewToWorldNormalMatrix);a.setUniform3f("uCameraPosition",d[3],d[7],d[11]);a.setUniformMatrix3fv("uViewToWorldNormalMatrix",f);(this.settings.uber||"sketch"===this.settings.type)&&this.setSketchUniforms(a);a.setUniform1f("uWorldLineRadiusPerDistance",Math.tan(c.fovY/2)/(c.viewport[3]/2));a.setUniform3fv("uLocalOrigin",b.transform.origin.vec3)};
a.prototype.setSketchUniforms=function(a){var b=this.settings.strokesTexture,d=b.texture;this.rctx.bindTexture(d,0);a.setUniform1i("uStrokesTexture",0);a.setUniform2f("uStrokesTextureScale",1/d.descriptor.width,1/d.descriptor.height);a.setUniform1f("uStrokesLog2Resolution",c.log2(b.resolution));a.setUniform1f("uStrokesNormalizationScale",b.normalizationScale);a.setUniform1f("uStrokesAmplitude",b.amplitude);a.setUniform1f("uStrokeVariants",b.variants)};a.prototype.getDefines=function(a){return[a.silhouette,
!!this.rctx.capabilities.blendMinMax,"solid"===this.settings.type&&!this.settings.uber,"sketch"===this.settings.type&&!this.settings.uber,this.settings.uber]};a.prototype.createPrograms=function(){var a=this.programRepository.getShaderVariationsProgram(p,this.getDefines({silhouette:!1}),void 0,void 0,k.EdgeShaderAttributeLocations),b=this.programRepository.getShaderVariationsProgram(p,this.getDefines({silhouette:!0}),void 0,void 0,k.EdgeShaderAttributeLocations);this.programRepository.increaseRefCount(a);
this.programRepository.increaseRefCount(b);this.programs={regular:a,silhouette:b}};a.loadShaders=function(a,c,g){a.EdgeRendererUtils_readComponentColor||a._parse(b);a.fsRibbonEdge||a._parse(d);c.getShaderVariations(p)||(a=new f("ribbonEdge",["vsRibbonEdge","fsRibbonEdge"],null,c,a,g),a.addDefine("Silhouette","SILHOUETTE"),a.addDefine("AntiAliasing","ANTIALIASING"),a.addDefine("Solid","SOLID"),a.addDefine("Sketch","SKETCH"),a.addDefine("Uber","UBER"),c.addShaderVariations(p,a))};a.getKey=function(a,
b){return a?"edges-uber":"edges-t:"+b};return a}();h.EdgeRenderer=q;var p="edge-shader-variations";h.componentDataBindParameters={texName:"uComponentDataTex",invDimName:"uComponentDataTexInvDim",unit:2}})},"esri/views/3d/webgl-engine/lib/ShaderVariations":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/lang ./DefaultVertexAttributeLocations ./Util ../../../webgl/Program".split(" "),function(q,h,e,a,d,b,g){return function(){function c(a,c,d,g,e,m){this.variables=
[];this.sealed=!1;this.programCache={};b.assert(2===c.length,"you must specify shader snippet prefixes for vertex and fragment shaders");this.programNamePrefix=a;this.shaderSnippetPrefixes=c;this.baseDefines=d;this.programRep=g;this.snippets=e;this.rctx=m;this.baseDefines=d?d.slice():[]}c.prototype.addDefine=function(a,c,d,g){b.assert(!this.sealed,"you cannot add another variable after the first program has been generated");b.assert(!!a,"you must specify a program name suffix");this.variables.push({programNameSuffixes:["",
a],shaderNameSuffixes:g||a,defineStr:c,affectsShaderTypes:d||[!0,!0]})};c.prototype.addBinaryShaderSnippetSuffix=function(a,c,d){b.assert(!this.sealed,"you cannot add another variable after the first program has been generated");b.assert(!!a,"you must specify a program name suffix");this.variables.push({programNameSuffixes:["",a],shaderSnippetSuffixes:["",c],affectsShaderTypes:d||[!0,!0]})};c.prototype.addNaryShaderSnippetSuffix=function(a,c){b.assert(!this.sealed,"you cannot add another variable after the first program has been generated");
var d=a.map(function(a){b.assert(null!=a.value,"value must always be specified");return a.value});this.variables.push({values:d,programNameSuffixes:a.map(function(a,b){return null!=a.programNameSuffix?a.programNameSuffix:d[b]}),shaderSnippetSuffixes:a.map(function(a,b){return null!=a.shaderSnippetSuffix?a.shaderSnippetSuffix:d[b]}),affectsShaderTypes:c||[!0,!0]})};c.prototype.getShaderVariation=function(c){b.assert(c.length===this.variables.length,"you must specify a value for each variable");for(var d=
this.programNamePrefix,f=a.clone(this.shaderSnippetPrefixes),g=a.clone(this.shaderSnippetPrefixes),e=a.clone(this.baseDefines),m=0;m<this.variables.length;m++){var h=this.variables[m],t=c[m],u=void 0;h.values?(u=h.values.indexOf(t.toString()),b.assert(0<=u,"invalid value "+t+" for variable "+m)):u=t?1:0;d+=h.programNameSuffixes[u];for(t=0;2>t;t++)h.affectsShaderTypes[t]&&(h.shaderSnippetSuffixes&&(f[t]+=h.shaderSnippetSuffixes[u],g[t]+=h.shaderSnippetSuffixes[u]),h.defineStr&&u&&(e.push(h.defineStr),
g[t]+=h.shaderNameSuffixes))}return{programName:d,shaderSnippetNames:f,shaderNames:g,defines:e}};c.prototype.getProgram=function(a,c,e,l){void 0===c&&(c=this.snippets);void 0===e&&(e=this.rctx);void 0===l&&(l=d.Default3D);this.sealed=!0;var f=a.reduce(function(a,b){return a+b.toString()},"");if(this.programCache[f])return this.programCache[f];a=this.getShaderVariation(a);var k=this.programRep.get(a.programName);if(k)return k;var n=a.shaderSnippetNames[0],k=c[n];b.assert(null!=k,"shader snippet '"+
n+"' does not exist");n=a.shaderSnippetNames[1];c=c[n];b.assert(null!=c,"shader snippet '"+n+"' does not exist");k=new g(e,k,c,l,a.defines);this.programCache[f]=k;this.programRep.add(a.programName,k);return k};return c}()})},"esri/views/3d/webgl-engine/lib/edgeRendering/strokes":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../support/mathUtils ../Util ../../../../webgl/Texture".split(" "),function(q,h,e,a,d,b){function g(a,b){if(!a)return null;var d=a.length/
2,g=c*d,d=Array(d),e=0;b=1===b;for(var k=0;k<a.length;k+=2){var n=(a[k]+a[k+1])/2;b?d[e++]=Math.min(g,1-(1-n)*f):d[e++]=Math.min(g,n*f)}return d}Object.defineProperty(h,"__esModule",{value:!0});h.generateStrokesTexture=function(c){for(var f=h.strokesDefinition.resolution,e=f/2,k=new Uint8Array(4*f*f),m=4*f*e,e=h.strokesDefinition.amplitude,r=2*e,t=4*f,u=a.log2(f)+1,x=h.strokesDefinition.strokes.length,v=(u-1)*x*t,A=0,y=h.strokesDefinition.strokes;A<y.length;A++){for(var C=y[A],B=C.distance,C=C.pressure,
q=v,E=0;E<u;E++){0!==E&&(B=g(B,0),C=g(C,1));for(var J=0;J<h.strokesDefinition.resolution;J++){var F=C?C[J%C.length]:1;d.packFloatRGBA((B?B[J%B.length]/r:0)+.5,k,q);d.packFloatRGBA(F,k,q+m);q+=4}q-=t*(x+1)}v+=t}c=new b(c,{pixelFormat:6408,dataType:5121,hasMipmap:!1,samplingMode:9729,width:f,height:f,wrapMode:10497},k);return{resolution:f,texture:c,normalizationScale:r,amplitude:e,variants:x}};var c=.1,f=.5;h.strokesDefinition={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,
-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,
.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,
.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,
-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,
.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,
.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,
.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,
-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,
-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,
1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,
.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,
-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,
.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,
.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,
.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,
.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,
4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,
3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,
1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-7.6E-4,2.7E-4,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,
.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,
.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,
.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,
.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,
1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,
-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,
.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,
2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,
.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,
.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,
.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,
-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,
.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,
.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,
-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,
.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,
.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,
.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,
.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,
5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,
.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,
-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,
4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,
.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,
.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,
.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]}})},"esri/views/3d/webgl-engine/lib/edgeRendering/util":function(){define(["require","exports","../../../../../core/arrayUtils","../../../support/buffer/typedArrayUtil"],function(q,h,
e,a){function d(a,d){var b=e.binaryIndexOf(a,d,!0);return-1===b?d<a[0]?0:a.length:b}Object.defineProperty(h,"__esModule",{value:!0});h.determineRequiresUberRenderer=function(a){if(0===a.length)return!1;for(var b=a[0].type,c=0;c<a.length;c++)if(b!==a[c].type)return!0;return!1};h.determineAllTransparent=function(a){if(0===a.length)return!0;for(var b=0;b<a.length;b++){var c=a[b].material;if(0<c.size*c.color[3]*c.opacity)return!1}return!0};h.cloneIndices=function(b){if(Uint16Array.from)return a.isUint16Array(b)?
Uint16Array.from(b):Uint32Array.from(b);for(var d=a.isUint16Array(b)?new Uint16Array(b.length):new Uint32Array(b.length),c=0;c<b.length;c++)d[c]=b[c];return d};h.estimateLengthAtDistance=function(a,d,c,f){return f/a*c*2*Math.tan(.5*d)};h.findLowerBoundIndex=d;h.computeEdgeCount=function(a,g,c){return a.length-d(a,g*c.minimumEdgeLength)};h.fillComponenBufferIndices=function(a,d,c,f){for(var b=0;b<a.length;b++){var g=a[b].index,e=d[b],p=d[b+1];if(f)for(;e<p;e++)c.set(f[e],g);else for(;e<p;e++)c.set(e,
g)}}})},"esri/views/3d/webgl-engine/lighting/SceneLighting":function(){define(["require","exports","../../lib/glMatrix","./SphericalHarmonics"],function(q,h,e,a){Object.defineProperty(h,"__esModule",{value:!0});var d=e.vec3d,b=e.vec4d,g=d.create();q=function(){function c(){this._renderLighting={main:{intensity:d.create(),direction:d.createFrom(1,0,0),castShadows:!1},sphericalHarmonics:{sh:{r:[0],g:[0],b:[0]}}};this._shOrder=2;this._oldDirection=d.create();this._oldSpecular=b.create();this._oldDiffuse=
b.create();this._oldAmbient=b.create()}c.prototype.setUniforms=function(a,b){void 0===b&&(b=!1);b||a.getDefine("GROUND_NORMAL_SHADING")?a.setUniform1f("lightingFixedFactor",(1-this._info.groundLightingFactor)*(1-this._info.globalFactor)):a.setUniform1f("lightingFixedFactor",0);a.setUniform1f("lightingGlobalFactor",this._info.globalFactor);a.setUniform3fv("lightingMainDirection",this._renderLighting.main.direction);a.setUniform3fv("lightingMainIntensity",this._renderLighting.main.intensity);a.setUniform1f("ambientBoostFactor",
.4);b=this._renderLighting.sphericalHarmonics.sh;0===this._shOrder?a.setUniform3f("lightingAmbientSH0",b.r[0],b.g[0],b.b[0]):1===this._shOrder?(a.setUniform4f("lightingAmbientSH_R",b.r[0],b.r[1],b.r[2],b.r[3]),a.setUniform4f("lightingAmbientSH_G",b.g[0],b.g[1],b.g[2],b.g[3]),a.setUniform4f("lightingAmbientSH_B",b.b[0],b.b[1],b.b[2],b.b[3])):2===this._shOrder&&(a.setUniform3f("lightingAmbientSH0",b.r[0],b.g[0],b.b[0]),a.setUniform4f("lightingAmbientSH_R1",b.r[1],b.r[2],b.r[3],b.r[4]),a.setUniform4f("lightingAmbientSH_G1",
b.g[1],b.g[2],b.g[3],b.g[4]),a.setUniform4f("lightingAmbientSH_B1",b.b[1],b.b[2],b.b[3],b.b[4]),a.setUniform4f("lightingAmbientSH_R2",b.r[5],b.r[6],b.r[7],b.r[8]),a.setUniform4f("lightingAmbientSH_G2",b.g[5],b.g[6],b.g[7],b.g[8]),a.setUniform4f("lightingAmbientSH_B2",b.b[5],b.b[6],b.b[7],b.b[8]));a.setUniform3fv("lightDirection",this._oldDirection)};c.prototype.set=function(b){this._info=b;a.combineLights(b.lights,this._shOrder,this._renderLighting.main,this._renderLighting.sphericalHarmonics);d.negate(this._renderLighting.main.direction,
this._oldDirection);b=1/Math.PI;this._oldAmbient[0]=.282095*this._renderLighting.sphericalHarmonics.sh.r[0]*b;this._oldAmbient[1]=.282095*this._renderLighting.sphericalHarmonics.sh.g[0]*b;this._oldAmbient[2]=.282095*this._renderLighting.sphericalHarmonics.sh.b[0]*b;this._oldAmbient[3]=1;this._oldDiffuse[0]=this._renderLighting.main.intensity[0]*b;this._oldDiffuse[1]=this._renderLighting.main.intensity[1]*b;this._oldDiffuse[2]=this._renderLighting.main.intensity[2]*b;this._oldDiffuse[3]=1;b=d.set(this._oldDiffuse,
g);d.scale(b,.4*this._info.globalFactor);d.add(this._oldAmbient,b)};Object.defineProperty(c.prototype,"globalFactor",{get:function(){return this._info.globalFactor},enumerable:!0,configurable:!0});c.prototype.getOld=function(){return{ambient:this._oldAmbient,diffuse:this._oldDiffuse,specular:this._oldSpecular,direction:this._oldDirection,helper:this}};return c}();h.SceneLighting=q})},"esri/views/3d/webgl-engine/lighting/SphericalHarmonics":function(){define("require exports ../../lib/glMatrix ../../support/mathUtils ../lib/LongVectorMath ./Lightsources".split(" "),
function(q,h,e,a,d,b){function g(a){return(a+1)*(a+1)}function c(b){return a.clamp(Math.floor(Math.sqrt(b)-1),0,2)}function f(a,b,c){var d=a[0],f=a[1];a=a[2];c=c||[];c.length=g(b);0<=b&&(c[0]=.28209479177);1<=b&&(c[1]=.4886025119*d,c[2]=.4886025119*a,c[3]=.4886025119*f);2<=b&&(c[4]=1.09254843059*d*f,c[5]=1.09254843059*f*a,c[6]=.31539156525*(3*a*a-1),c[7]=1.09254843059*d*a,c[8]=.54627421529*(d*d-f*f));return c}function k(a,b){a=g(a);b=b||{r:[],g:[],b:[]};b.r.length=b.g.length=b.b.length=a;for(var c=
0;c<a;c++)b.r[c]=b.g[c]=b.b[c]=0;return b}function n(a,b){for(var g=c(b.r.length),e=0;e<a.length;e++){var k=a[e];p.negate(k.direction,v);f(v,g,u);d.elementwiseProduct(u,A);d.scalarProduct(u,k.intensity[0],x);d.add(b.r,x);d.scalarProduct(u,k.intensity[1],x);d.add(b.g,x);d.scalarProduct(u,k.intensity[2],x);d.add(b.b,x)}return b}function l(a,b){f(v,0,u);for(var c=0;c<a.length;c++){var d=a[c];b.r[0]+=u[0]*A[0]*d.intensity[0]*4*Math.PI;b.g[0]+=u[0]*A[0]*d.intensity[1]*4*Math.PI;b.b[0]+=u[0]*A[0]*d.intensity[2]*
4*Math.PI}return b}Object.defineProperty(h,"__esModule",{value:!0});var p=e.vec3d;h.numberOfCoefficients=g;h.numberOfCoefficientsInBand=function(a){return 2*a+1};h.orderFromNumberOfCoefficients=c;h.computeCoefficients=f;h.initSHCoefficients=k;h.projectFillLights=n;h.projectAmbientLights=l;h.combineLights=function(a,c,f,g){k(c,g.sh);p.set3(0,0,0,f.intensity);var e=!1,h=m,u=r;c=t;h.length=0;u.length=0;for(var v=c.length=0;v<a.length;v++){var y=a[v];y instanceof b.MainLight&&!e?(p.set(y.direction,f.direction),
f.intensity[0]=y.intensity[0],f.intensity[1]=y.intensity[1],f.intensity[2]=y.intensity[2],f.castShadows=y.castShadows,e=!0):y instanceof b.MainLight||y instanceof b.FillLight?h.push(y):y instanceof b.AmbientLight?u.push(y):y instanceof b.SphericalHarmonicsLight&&c.push(y)}n(h,g.sh);l(u,g.sh);for(a=0;a<c.length;a++)y=c[a],d.add(g.sh.r,y.sh.r),d.add(g.sh.g,y.sh.g),d.add(g.sh.b,y.sh.b)};var m=[],r=[],t=[],u=[0],x=[0],v=p.create(),A=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,
.785398]})},"esri/views/3d/webgl-engine/lib/LongVectorMath":function(){define(["require","exports"],function(q,h){Object.defineProperty(h,"__esModule",{value:!0});h.dotProduct=function(e,a){for(var d=0,b=0;b<e.length;b++)d+=e[b]*a[b];return d};h.elementwiseProduct=function(e,a,d){d=d||e;d.length=e.length;for(var b=0;b<e.length;b++)d[b]=e[b]*a[b];return d};h.scalarProduct=function(e,a,d){d=d||e;d.length=e.length;for(var b=0;b<e.length;b++)d[b]=e[b]*a;return d};h.add=function(e,a,d){d=d||e;d.length=
e.length;for(var b=0;b<e.length;b++)d[b]=e[b]+a[b];return d}})},"esri/views/3d/webgl-engine/materials/HUDMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/text!./HUDMaterial.xml ../../../../geometry/support/aaBoundingRect ../lib/ComponentUtils ../lib/gl-matrix ../lib/GLMaterialTexture ../lib/Material ../lib/RenderPass ../lib/RenderSlot ../lib/screenSizePerspectiveUtils ../lib/ShaderVariations ../lib/Util ./internal/MaterialUtil ../../../webgl/Util".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t){function u(a,b){void 0===b&&(b=M);if(a.textureIsSignedDistanceField){var c=a.anchorPos;a=a.distanceFieldBoundingBox;var d=b;d[0]=c[0]*(a[2]-a[0])+a[0];d[1]=c[1]*(a[3]-a[1])+a[1]}else x.set(a.anchorPos,b);return b}var x=g.vec2d,v=g.vec3d,A=g.mat3d,y=g.mat4d,C={"bottom-left":[0,0],bottom:[.5,0],"bottom-right":[1,0],left:[0,.5],center:[.5,.5],right:[1,.5],"top-left":[0,1],top:[.5,1],"top-right":[1,1]},B=[{name:"position",count:3,type:5126,offset:0,stride:76,
normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:76,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:76,normalized:!1},{name:"color",count:4,type:5121,offset:32,stride:76,normalized:!1},{name:"size",count:2,type:5126,offset:36,stride:76,normalized:!1},{name:"auxpos1",count:4,type:5126,offset:44,stride:76,normalized:!1},{name:"auxpos2",count:4,type:5126,offset:60,stride:76,normalized:!1}],D={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,
color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,anchorPos:C.center,shaderPolygonOffset:1E-5,polygonOffset:!1,
textureId:null,centerOffsetUnits:"world",debugDrawBorder:!1};q=function(c){function f(a,b){b=c.call(this,b)||this;b._textureDirty=!1;b.params=r.copyParameters(a,D);"string"===typeof b.params.anchorPos&&(b.params.anchorPos=C[b.params.anchorPos]);return b}e(f,c);f.prototype.dispose=function(){};f.prototype.getParameterValues=function(){var a=this.params;return{color:a.color,texCoordScale:a.texCoordScale,polygonOffset:a.polygonOffset,anchorPos:a.anchorPos,screenOffset:a.screenOffset,verticalOffset:a.verticalOffset,
screenSizePerspective:a.screenSizePerspective,screenSizePerspectiveAlignment:a.screenSizePerspectiveAlignment,shaderPolygonOffset:a.shaderPolygonOffset,textureIsSignedDistanceField:a.textureIsSignedDistanceField,outlineColor:a.outlineColor,outlineSize:a.outlineSize,distanceFieldBoundingBox:a.distanceFieldBoundingBox,vvSizeEnabled:a.vvSizeEnabled,vvSizeMinSize:a.vvSizeMinSize,vvSizeMaxSize:a.vvSizeMaxSize,vvSizeOffset:a.vvSizeOffset,vvSizeFactor:a.vvSizeFactor,vvColorEnabled:a.vvColorEnabled,vvColorValues:a.vvColorValues,
vvColorColors:a.vvColorColors,textureId:a.textureId,occlusionTest:a.occlusionTest,binaryHighlightOcclusion:a.binaryHighlightOcclusion,centerOffsetUnits:a.centerOffsetUnits,debugDrawBorder:a.debugDrawBorder,drawInSecondSlot:a.drawInSecondSlot}};f.prototype.setParameterValues=function(a){for(var b in a)"textureId"===b&&m.assert(!!this.params.textureId,"Can only change texture of material that already has a texture"),this.params[b]=a[b];this.notifyDirty("matChanged")};f.prototype.getParams=function(){return this.params};
f.prototype.getOutputAmount=function(a){return 114*a};f.prototype.getInstanceBufferLayout=function(){};f.prototype.getVertexBufferLayout=function(){return B};f.prototype.fillInterleaved=function(a,b,c,d,f,g){var e=4*g,k=a.indices[m.VertexAttrConstants.POSITION],l=a.vertexAttr[m.VertexAttrConstants.POSITION].data,n=g+t.findAttribute(B,m.VertexAttrConstants.POSITION).offset/4;for(d=0;d<k.length;++d){var p=3*k[d];r.fill(l,p,f,n,b,3);n+=19;r.fill(l,p,f,n,b,3);n+=19;r.fill(l,p,f,n,b,3);n+=19;r.fill(l,
p,f,n,b,3);n+=19;r.fill(l,p,f,n,b,3);n+=19;r.fill(l,p,f,n,b,3);n+=19}b=a.indices[m.VertexAttrConstants.NORMAL];l=a.vertexAttr[m.VertexAttrConstants.NORMAL].data;n=g+t.findAttribute(B,m.VertexAttrConstants.NORMAL).offset/4;for(d=0;d<b.length;++d)p=3*b[d],r.fill(l,p,f,n,c,3),n+=19,r.fill(l,p,f,n,c,3),n+=19,r.fill(l,p,f,n,c,3),n+=19,r.fill(l,p,f,n,c,3),n+=19,r.fill(l,p,f,n,c,3),n+=19,r.fill(l,p,f,n,c,3),n+=19;d=a.vertexAttr[m.VertexAttrConstants.UV0].data;null==d||3>=d.length?(c=p=0,b=this.params.texCoordScale[0],
l=this.params.texCoordScale[1]):(p=a.vertexAttr[m.VertexAttrConstants.UV0].data[0],c=a.vertexAttr[m.VertexAttrConstants.UV0].data[1],b=a.vertexAttr[m.VertexAttrConstants.UV0].data[2],l=a.vertexAttr[m.VertexAttrConstants.UV0].data[3]);b=Math.min(1.99999,b+1);l=Math.min(1.99999,l+1);n=g+t.findAttribute(B,m.VertexAttrConstants.UV0).offset/4;for(d=0;d<k.length;++d)f[n]=p,f[n+1]=c,n+=19,f[n]=b,f[n+1]=c,n+=19,f[n]=b,f[n+1]=l,n+=19,f[n]=b,f[n+1]=l,n+=19,f[n]=p,f[n+1]=l,n+=19,f[n]=p,f[n+1]=c,n+=19;k=a.indices[m.VertexAttrConstants.COLOR];
c=a.vertexAttr[m.VertexAttrConstants.COLOR].data;e+=t.findAttribute(B,m.VertexAttrConstants.COLOR).offset;b=new Uint8Array(f.buffer);for(d=0;d<k.length;++d)p=4*k[d],r.fillColor(c,p,b,e,4),e+=76,r.fillColor(c,p,b,e,4),e+=76,r.fillColor(c,p,b,e,4),e+=76,r.fillColor(c,p,b,e,4),e+=76,r.fillColor(c,p,b,e,4),e+=76,r.fillColor(c,p,b,e,4),e+=76;p=a.indices[m.VertexAttrConstants.SIZE];e=a.vertexAttr[m.VertexAttrConstants.SIZE].data;k=g+t.findAttribute(B,m.VertexAttrConstants.SIZE).offset/4;for(d=0;d<p.length;++d)c=
e[2*p[d]],b=e[2*p[d]+1],f[k]=c,f[k+1]=b,k+=19,f[k]=c,f[k+1]=b,k+=19,f[k]=c,f[k+1]=b,k+=19,f[k]=c,f[k+1]=b,k+=19,f[k]=c,f[k+1]=b,k+=19,f[k]=c,f[k+1]=b,k+=19;if(null!=a.indices[m.VertexAttrConstants.AUXPOS1]&&null!=a.vertexAttr[m.VertexAttrConstants.AUXPOS1])for(e=a.indices[m.VertexAttrConstants.AUXPOS1],k=a.vertexAttr[m.VertexAttrConstants.AUXPOS1].data,c=g+t.findAttribute(B,"auxpos1").offset/4,d=0;d<e.length;++d)p=4*e[d],r.fill(k,p,f,c,null,4),c+=19,r.fill(k,p,f,c,null,4),c+=19,r.fill(k,p,f,c,null,
4),c+=19,r.fill(k,p,f,c,null,4),c+=19,r.fill(k,p,f,c,null,4),c+=19,r.fill(k,p,f,c,null,4),c+=19;if(null!=a.indices[m.VertexAttrConstants.AUXPOS2]&&null!=a.vertexAttr[m.VertexAttrConstants.AUXPOS2])for(e=a.indices[m.VertexAttrConstants.AUXPOS2],a=a.vertexAttr[m.VertexAttrConstants.AUXPOS2].data,g+=t.findAttribute(B,"auxpos2").offset/4,d=0;d<e.length;++d)p=4*e[d],r.fill(a,p,f,g,null,4),g+=19,r.fill(a,p,f,g,null,4),g+=19,r.fill(a,p,f,g,null,4),g+=19,r.fill(a,p,f,g,null,4),g+=19,r.fill(a,p,f,g,null,4),
g+=19,r.fill(a,p,f,g,null,4),g+=19};f.prototype.intersect=function(a,c,d,f,g,e,k,n){if(f.isSelection&&f.enableHUDSelection&&!b.isAllHidden(c.componentVisibilities,a.data.componentOffsets)){var p=a.getData();a=this.params;g=c=1;y.toMat3(d,L);if(n){g=n(S);c=g[0];g=g[5];n=L;e=n[0];var h=n[1],r=n[2],t=n[3],A=n[4],x=n[5],C=n[6],B=n[7],q=n[8],Q=1/Math.sqrt(e*e+h*h+r*r),D=1/Math.sqrt(t*t+A*A+x*x),G=1/Math.sqrt(C*C+B*B+q*q);n[0]=e*Q;n[1]=h*Q;n[2]=r*Q;n[3]=t*D;n[4]=A*D;n[5]=x*D;n[6]=C*G;n[7]=B*G;n[8]=q*G}n=
p.getVertexAttr()[m.VertexAttrConstants.POSITION];e=p.getVertexAttr()[m.VertexAttrConstants.SIZE];p=p.getVertexAttr()[m.VertexAttrConstants.NORMAL];m.assert(3<=n.size);h=f.point;r=f.camera;t=u(a);for(A=0;A<n.data.length/n.size;A++)x=A*n.size,v.set3(n.data[x],n.data[x+1],n.data[x+2],H),y.multiplyVec3(d,H,H),x=A*e.size,V[0]=e.data[x]*c,V[1]=e.data[x+1]*g,y.multiplyVec3(r.viewMatrix,H),x=A*p.size,v.set3(p.data[x],p.data[x+1],p.data[x+2],I),this.applyVerticalOffsetTransformation(H,I,L,r,F),r.applyProjection(H,
K),-1<K[0]&&(x=Math.floor(K[0]),B=Math.floor(K[1]),l.applyPrecomputedScaleFactorVec2(V,F.factor,V),x=x-aa-(0<t[0]?V[0]*t[0]:0),C=x+V[0]+2*aa,B=B-aa-(0<t[1]?V[1]*t[1]:0),q=B+V[1]+2*aa,a.textureIsSignedDistanceField&&(Q=a.outlineSize/2,D=a.distanceFieldBoundingBox,x+=V[0]*D[0],B+=V[1]*D[1],C-=V[0]*(1-D[2]),q-=V[1]*(1-D[3]),x-=Q,C+=Q,B-=Q,q+=Q),h[0]>x&&h[0]<C&&h[1]>B&&h[1]<q&&(C=f.p0,B=f.p1,y.multiplyVec3(y.inverse(r.viewMatrix,U),H,P),K[0]=h[0],K[1]=h[1],r.unprojectPoint(K,H),x=v.negate(f.getDirection(),
v.create()),C=v.dist(C,H)/v.dist(C,B),k(C,x,-1,1,!0,P)))}};f.prototype.normalAndViewAngle=function(a,b,c,d){void 0===d&&(d=N);A.multiplyVec3(b,a,d.normal);y.multiplyVec3(c.viewInverseTransposeMatrix,d.normal);d.cosAngle=v.dot(O,T);return d};f.prototype.updateScaleInfo=function(a,b,c){b=this.params;b.screenSizePerspective?a.factor=l.precomputeScaleFactor(N.cosAngle,c,b.screenSizePerspective,a.factor):(a.factor.scale=1,a.factor.factor=0,a.factor.minPixelSize=0,a.factor.paddingPixels=0);b.screenSizePerspectiveAlignment?
(a.scaleAlignment=l.precomputeScale(N.cosAngle,c,b.screenSizePerspectiveAlignment),a.minPixelSizeAlignment=b.screenSizePerspectiveAlignment.parameters.minPixelSize):(a.scaleAlignment=a.factor.scale,a.minPixelSizeAlignment=a.factor.minPixelSize)};f.prototype.applyVerticalOffsetTransformation=function(a,b,c,d,f,g){var e=this.params;16===c.length&&(c=y.toMat3(c,L));if(!e.verticalOffset||!e.verticalOffset.screenLength)return f&&(e.screenSizePerspective||e.screenSizePerspectiveAlignment)?(d=this.normalAndViewAngle(b,
c,d),e=v.length(a),this.updateScaleInfo(f,d.cosAngle,e)):f&&(f.factor.scale=1,f.scaleAlignment=1),g?v.set(a,g):a;b=this.normalAndViewAngle(b,c,d);c=v.length(a);d=r.verticalOffsetAtDistance(d,c,e.verticalOffset,b.cosAngle,e.screenSizePerspectiveAlignment||e.screenSizePerspective);f&&this.updateScaleInfo(f,b.cosAngle,c);return v.add(a,v.scale(b.normal,d),g)};f.prototype.getGLMaterials=function(){return{color:E,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:J}};f.prototype.getAllTextureIds=
function(){return[this.params.textureId]};f.prototype.setTextureDirty=function(){this._textureDirty=!0};f.prototype.calculateRelativeScreenBounds=function(a,b,c){void 0===c&&(c=d.create());var f=this.params,g=c;void 0===g&&(g=M);x.set(f.anchorPos,g);g[0]*=-a[0];g[1]*=-a[1];g[0]+=f.screenOffset[0]*b;g[1]+=f.screenOffset[1]*b;c[2]=c[0]+a[0];c[3]=c[1]+a[1];return c};f.prototype.calculateAnchorPosForRendering=function(a){return u(this.params,a)};f.loadShaders=function(b,c,d){b._parse(a);var f=function(a){a.addDefine("OcclTest",
"OCCL_TEST");a.addDefine("SDF","SIGNED_DISTANCE_FIELD");a.addDefine("vvSize","VV_SIZE");a.addDefine("vvColor","VV_COLOR");a.addDefine("verticalOffset","VERTICAL_OFFSET");a.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");a.addDefine("centerOffsetUnitsScreen","CENTER_OFFSET_UNITS_SCREEN")},g=new p("hud",["vertexShaderHUD","fragmentShaderHUD"],null,c,b,d);f(g);g.addDefine("debugDrawBorder","DEBUG_DRAW_BORDER");c.addShaderVariations("hud-material-shader-variations",g);g=new p("hudHighlight",
["vertexShaderHUD","fragmentShaderHUDHighlight"],null,c,b,d);f(g);g.addDefine("binaryHighlightOcclusion","BINARY_HIGHLIGHT_OCCLUSION");c.addShaderVariations("hud-material-highlight-shader-variations",g);b=new p("hudOcclusionTestPixel",["vertexShaderOcclusionTestPixel","fragmentShaderSimple"],null,c,b,d);b.addDefine("verticalOffset","VERTICAL_OFFSET");b.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");b.addDefine("centerOffsetUnitsScreen","CENTER_OFFSET_UNITS_SCREEN");c.addShaderVariations("hud-material-occlusion-test-pixel-shader-variations",
b)};f.shouldRenderVisibilityDuringRenderPass=function(a){return a===k.MATERIAL||k.MATERIAL_HIGHLIGHT};return f}(f);c=function(a){function b(b,c,d){c=a.call(this,b,c,d,b.getParams().textureId)||this;c.params=r.copyParameters(b.getParams());c.selectProgram();c.selectSlot();return c}e(b,a);b.prototype.selectSlot=function(){this.mainSlot=this.params.drawInSecondSlot?n.HUDMATERIAL2:n.HUDMATERIAL1};b.prototype.beginSlot=function(a){return a===this.mainSlot};b.prototype.getProgram=function(){return this.program};
b.prototype.updateParameters=function(){var a=this.material.getParams(),b=this.params;b.color=a.color;b.texCoordScale=a.texCoordScale;b.polygonOffset=a.polygonOffset;b.anchorPos=a.anchorPos;b.screenOffset=a.screenOffset;b.verticalOffset=a.verticalOffset;b.screenSizePerspective=a.screenSizePerspective;b.screenSizePerspectiveAlignment=a.screenSizePerspectiveAlignment;b.shaderPolygonOffset=a.shaderPolygonOffset;b.textureIsSignedDistanceField=a.textureIsSignedDistanceField;b.outlineColor=a.outlineColor;
b.outlineSize=a.outlineSize;b.vvSizeEnabled=a.vvSizeEnabled;b.vvSizeMinSize=a.vvSizeMinSize;b.vvSizeMaxSize=a.vvSizeMaxSize;b.vvSizeOffset=a.vvSizeOffset;b.vvSizeFactor=a.vvSizeFactor;b.vvColorEnabled=a.vvColorEnabled;b.vvColorValues=a.vvColorValues;b.vvColorColors=a.vvColorColors;this.updateTexture(a.textureId);this.selectProgram();this.selectSlot()};b.prototype.bindRender=function(a,b){var c=this.params,d=this.getProgram();this.bindTexture(a,d);d.setUniform1i("hudVisibilityTexture",1);a.bindTexture(b.hudVisibilityTexture,
1);a.setActiveTexture(0);d.setUniform1f("uRenderTransparentlyOccludedHUD","occluded"===b.renderTransparentlyOccludedHUD?1:"notOccluded"===b.renderTransparentlyOccludedHUD?0:.75);d.setUniform4fv("overrideColor",c.color);d.setUniform1f("pixelRatio",b.pixelRatio);c.textureIsSignedDistanceField&&(d.setUniform4fv("outlineColor",c.outlineColor),d.setUniform1f("outlineSize",c.outlineSize));c.vvSizeEnabled&&(d.setUniform3fv("vvSizeMinSize",c.vvSizeMinSize),d.setUniform3fv("vvSizeMaxSize",c.vvSizeMaxSize),
d.setUniform3fv("vvSizeOffset",c.vvSizeOffset),d.setUniform3fv("vvSizeFactor",c.vvSizeFactor));c.vvColorEnabled&&(d.setUniform1fv("vvColorValues",c.vvColorValues),d.setUniform4fv("vvColorColors",c.vvColorColors));d.setUniform2fv("texScale",c.texCoordScale);d.setUniform2f("screenOffset",2*c.screenOffset[0],2*c.screenOffset[1]);d.setUniform2fv("anchorPos",u(c));c.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(0,-4));a.setBlendingEnabled(!0);a.setBlendFunction(1,771)};b.prototype.bindProjection=
function(a,b){this.material._textureDirty&&(this.renderTexture(a),this.material._textureDirty=!1);var c=b.cameraAboveGround?1:-1,d=this.getProgram(),f=this.params;a.bindProgram(d);d.setUniform1f("cameraGroundRelative",c);d.setUniform1f("polygonOffset",f.shaderPolygonOffset);d.setUniform4fv("viewport",b.viewport);r.bindVerticalOffset(f.verticalOffset,b,d);d.setUniformMatrix4fv("viewNormal",b.viewInvTransp);f.screenSizePerspective&&(r.bindScreenSizePerspective(f.screenSizePerspective,d,"screenSizePerspective"),
r.bindScreenSizePerspective(f.screenSizePerspectiveAlignment||f.screenSizePerspective,d,"screenSizePerspectiveAlignment"))};b.prototype.releaseRender=function(a){a.setPolygonOffsetFillEnabled(!1);a.setBlendFunction(770,771);a.setBlendingEnabled(!1)};b.prototype.bindView=function(a,b){a=b.origin;var c=this.getProgram();r.bindView(a,b.view,c);r.bindCamPos(a,b.viewInvTransp,c)};b.prototype.bindInstance=function(a,b){a=this.getProgram();a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",
b.transformationNormal)};b.prototype.getDrawMode=function(a){return a.gl.TRIANGLES};return b}(c);var E=function(a){function b(b,c,d){b=a.call(this,b,c,d)||this;b.isOcclusionSlot=!1;return b}e(b,a);b.prototype.selectProgram=function(){var a=this.params;this.programOcclusionTestPixel=this.programRep.getShaderVariationsProgram("hud-material-occlusion-test-pixel-shader-variations",[!!a.verticalOffset,!!a.screenSizePerspective,"screen"===a.centerOffsetUnits]);this.program=this.programRep.getShaderVariationsProgram("hud-material-shader-variations",
[a.occlusionTest,a.textureIsSignedDistanceField,!!a.vvSizeEnabled,!!a.vvColorEnabled,!!a.verticalOffset,!!a.screenSizePerspective,"screen"===a.centerOffsetUnits,!!a.debugDrawBorder])};b.prototype.getDrawMode=function(a){a=a.gl;return this.isOcclusionSlot?a.POINTS:a.TRIANGLES};b.prototype.release=function(a){a.setDepthFunction(a.gl.LESS);this.isOcclusionSlot||this.releaseRender(a)};b.prototype.bind=function(a,b){var c=a.gl;this.bindProjection(a,b);var d=this.getProgram();a.setDepthTestEnabled(!0);
a.setDepthFunction(c.LEQUAL);this.isOcclusionSlot?d.setUniform4f("color",1,1,1,1):(this.bindRender(a,b),this.bindTexture(a,d))};b.prototype.getProgram=function(){return this.isOcclusionSlot?this.programOcclusionTestPixel:this.program};b.prototype.getPrograms=function(){return[this.programOcclusionTestPixel,this.program]};b.prototype.beginSlot=function(a){if(this.params.occlusionTest)return this.isOcclusionSlot=a===n.OCCLUSION_PIXELS,a===n.OCCLUSION_PIXELS||a===this.mainSlot;this.isOcclusionSlot=!1;
return a===this.mainSlot};return b}(c),J=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}e(b,a);b.prototype.selectProgram=function(){var a=this.params;this.program=this.programRep.getShaderVariationsProgram("hud-material-highlight-shader-variations",[a.occlusionTest,a.textureIsSignedDistanceField,!!a.vvSizeEnabled,!!a.vvColorEnabled,!!a.verticalOffset,!!a.screenSizePerspective,"screen"===a.centerOffsetUnits,a.binaryHighlightOcclusion])};b.prototype.bind=function(a,b){this.bindProjection(a,
b);this.bindRender(a,b)};b.prototype.release=function(a){this.releaseRender(a)};return b}(c),F={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},scaleAlignment:0,minPixelSizeAlignment:0},M=[0,0],H=v.create(),I=v.create(),K=v.create(),O=v.create(),P=v.create(),L=A.create(),U=y.create(),N={normal:O,cosAngle:0},S=y.create();y.identity(S);var aa=1,V=[0,0],T=[0,0,1];return q})},"esri/views/3d/webgl-engine/lib/GLMaterialTexture":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper",
"./GLMaterial","../materials/internal/MaterialUtil"],function(q,h,e,a,d){return function(a){function b(b,f,g,e,l){void 0===l&&(l=!1);b=a.call(this,b,f)||this;b.textureRep=g;b.textureId=e;b.initTransparent=l;b.glTextureRef=d.aquireIfNotUndefined(b.textureId,g,b.initTransparent);return b}e(b,a);b.prototype.dispose=function(){d.releaseIfNotUndefined(this.textureId,this.textureRep)};b.prototype.updateTexture=function(a){a!==this.textureId&&(d.releaseIfNotUndefined(this.textureId,this.textureRep),this.textureId=
a,this.glTextureRef=d.aquireIfNotUndefined(this.textureId,this.textureRep,this.initTransparent))};b.prototype.renderTexture=function(a){(a=this.textureRep.getTexture(this.textureId))&&a.dirty&&a.redraw&&a.redraw()};b.prototype.bindTexture=function(a,b){null!=this.glTextureRef&&(b.setUniform1i("tex",0),a.bindTexture(this.glTextureRef.getGLTexture()))};b.prototype.bindTextureSize=function(a,b){null!=this.glTextureRef&&(a=this.glTextureRef.getGLTexture(),b.setUniform2f("texSize",a.descriptor.width,a.descriptor.height))};
return b}(a)})},"esri/views/3d/webgl-engine/lib/GLMaterial":function(){define(["require","exports"],function(q,h){return function(){function e(a,d){this.material=a;this.programRep=d}e.prototype.dispose=function(){};Object.defineProperty(e.prototype,"materialId",{get:function(){return this.material.id},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"renderOccluded",{get:function(){return this.material.renderOccluded},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,
"renderPriority",{get:function(){return this.material.renderPriority},enumerable:!0,configurable:!0});e.prototype.isVisible=function(){return this.material.isVisible()};e.prototype.getPrograms=function(){return[this.getProgram()]};return e}()})},"esri/views/3d/webgl-engine/lib/Material":function(){define(["require","exports","./IdGen","./ModelContentType"],function(q,h,e,a){return function(){function d(a){this._parentStage=null;this._visible=!0;this._renderOccluded=!1;this._renderPriority=0;this.supportsEdges=
!1;this.id=d._idGen.gen(a)}Object.defineProperty(d.prototype,"parentStage",{get:function(){return this._parentStage},enumerable:!0,configurable:!0});d.prototype.addParentStage=function(a){this._parentStage=a};d.prototype.removeParentStage=function(a){this._parentStage=null};Object.defineProperty(d.prototype,"visible",{get:function(){return this._visible},set:function(a){a!==this._visible&&(this._visible=a,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"renderOccluded",{get:function(){return this._renderOccluded},set:function(a){a!==this._renderOccluded&&(this._renderOccluded=a,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"renderPriority",{get:function(){return this._renderPriority},set:function(a){a!==this._renderPriority&&(this._renderPriority=a,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0});d.prototype.isVisible=function(){return this._visible};d.prototype.notifyDirty=function(b){this.parentStage&&
this.parentStage.notifyDirty(a.MATERIAL,this,b)};d._idGen=new e;return d}()})},"esri/views/webgl/Profiling":function(){define(["require","exports"],function(q,h){Object.defineProperty(h,"__esModule",{value:!0});h.startMeasurement=function(a){return(a=a.capabilities.disjointTimerQuery)?new e(a):null};h.getTimestamp=function(a,d,b){void 0===b&&(b=50);var g=a.capabilities.disjointTimerQuery;if(!g||0>=g.timestampBits())return null;var c=g.createQuery();g.createTimestamp(c);var f=function(){var a=g.resultAvailable(c),
e=g.disjoint();a&&!e?(a=g.getResult(c),d(a/1E6)):e?d():setTimeout(f,b)};f()};h.supportsTimestamps=function(a){a=a.capabilities.disjointTimerQuery;if(!a)return!1;a=a.timestampBits();console.log({bits:a});return 0<a};var e=function(){function a(a){this.timer=a;this.query=a.createQuery();this.timer.beginTimeElapsed(this.query)}a.prototype.stop=function(a,b){void 0===b&&(b=50);this.cb=a;this.checkInterval=b;this.timer.endTimeElapsed();this.checkQueryResult()};a.prototype.checkQueryResult=function(){var a=
this.timer.resultAvailable(this.query),b=this.timer.disjoint();a&&!b?(a=this.timer.getResult(this.query),this.cb(a/1E6)):b?this.cb():setTimeout(this.checkQueryResult.bind(this),this.checkInterval)};return a}()})},"esri/views/3d/webgl-engine/materials/internal/TexOnlyGLMaterial":function(){define("require exports dojo/text!./TexOnlyGLMaterial.xml ../../lib/DefaultVertexAttributeLocations ../../lib/gl-matrix ../../lib/RenderSlot ./MaterialUtil ../../../../webgl/Program".split(" "),function(q,h,e,a,
d,b,g,c){var f=d.vec4d.createFrom(1,1,1,1);return function(){function d(a,b,c,d,f){this.program=a.get("texOnly");this.color=c;this.depthFunc=f;this.blend=d;this.texGLName=b}d.prototype.beginSlot=function(a){return a===b.INTERNAL_MATERIAL};d.prototype.getProgram=function(){return this.program};d.prototype.setColor=function(a){this.color=a};d.prototype.bind=function(a,b){a.bindProgram(this.program);this.program.setUniformMatrix4fv("model",g.IDENTITY);this.program.setUniformMatrix4fv("proj",b.proj);
this.program.setUniform4fv("color",void 0!==this.color?this.color:f);this.program.setUniform1i("tex",0);a.bindTexture(this.texGLName,0);this.blend&&(a.setBlendingEnabled(!0),a.setBlendFunctionSeparate(a.gl.SRC_ALPHA,a.gl.ONE_MINUS_SRC_ALPHA,a.gl.ONE,a.gl.ONE_MINUS_SRC_ALPHA));a.setDepthTestEnabled(!0);void 0!==this.depthFunc&&a.setDepthFunction(this.depthFunc)};d.prototype.release=function(a){void 0!==this.depthFunc&&a.setDepthFunction(513);this.blend&&a.setBlendingEnabled(!1)};d.prototype.bindView=
function(a,b){g.bindView(b.origin,b.view,this.program)};d.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};d.prototype.getDrawMode=function(a){return a.gl.TRIANGLES};d.loadShaders=function(b,d,f){b._parse(e);b=new c(f,b.vertexShaderTexOnly,b.fragmentShaderTexOnly,a.Default3D);d.add("texOnly",b)};return d}()})},"esri/views/3d/webgl-engine/lib/GLMaterialRep":function(){define(["require","exports","./Util"],function(q,h,e){var a=function(){function a(a){this.refCnt=
0;this.glMaterial=a}a.prototype.incRefCnt=function(){++this.refCnt};a.prototype.decRefCnt=function(){--this.refCnt;e.assert(0<=this.refCnt)};a.prototype.getRefCnt=function(){return this.refCnt};a.prototype.getGLMaterial=function(){return this.glMaterial};return a}();return function(){function d(a,d){this.textureRep=a;this.programRep=d;this.id2glMaterialRef={}}d.prototype.aquire=function(a){return this.aquireExt(a,"color")};d.prototype.aquireDepthShadowMap=function(a){return this.aquireExt(a,"depthShadowMap")};
d.prototype.aquireDepth=function(a){return this.aquireExt(a,"depth")};d.prototype.aquireNormal=function(a){return this.aquireExt(a,"normal")};d.prototype.aquireHighlight=function(a){return this.aquireExt(a,"highlight")};d.prototype.aquireExt=function(b,d){var c=b.id+"_"+d,f=this.id2glMaterialRef[c];null==f?(b=(f=b.getGLMaterials()[d])?new f(b,this.programRep,this.textureRep):void 0,f=new a(b),this.id2glMaterialRef[c]=f):b=f.getGLMaterial();f.incRefCnt();b&&this.increaseProgramReferences(b);return b};
d.prototype.release=function(a){this.releaseExt(a,"color")};d.prototype.releaseDepth=function(a){this.releaseExt(a,"depth")};d.prototype.releaseNormal=function(a){this.releaseExt(a,"normal")};d.prototype.releaseDepthShadowMap=function(a){this.releaseExt(a,"depthShadowMap")};d.prototype.releaseHighlight=function(a){this.releaseExt(a,"highlight")};d.prototype.releaseExt=function(a,d){a=a+"_"+d;d=this.id2glMaterialRef[a];d.decRefCnt();if(0===d.getRefCnt()){if(d=d.getGLMaterial())this.decreaseProgramReferences(d),
d.dispose();delete this.id2glMaterialRef[a]}};d.prototype.updateMaterialParameters=function(a){var b=this.id2glMaterialRef[a+"_color"];b&&b.getGLMaterial()&&this.updateParamsForMat(b.getGLMaterial());(b=this.id2glMaterialRef[a+"_depth"])&&b.getGLMaterial()&&this.updateParamsForMat(b.getGLMaterial());(b=this.id2glMaterialRef[a+"_depthShadowMap"])&&b.getGLMaterial()&&this.updateParamsForMat(b.getGLMaterial());(b=this.id2glMaterialRef[a+"_normal"])&&b.getGLMaterial()&&this.updateParamsForMat(b.getGLMaterial());
(a=this.id2glMaterialRef[a+"_highlight"])&&a.getGLMaterial()&&this.updateParamsForMat(a.getGLMaterial())};d.prototype.updateParamsForMat=function(a){a.updateParameters&&(this.decreaseProgramReferences(a),a.updateParameters(),this.increaseProgramReferences(a))};d.prototype.increaseProgramReferences=function(a){a=a.getPrograms();for(var b=this.programRep,c=0;c<a.length;c++)b.increaseRefCount(a[c])};d.prototype.decreaseProgramReferences=function(a){a=a.getPrograms();for(var b=this.programRep,c=0;c<a.length;c++)b.decreaseRefCount(a[c])};
return d}()})},"esri/views/3d/webgl-engine/lib/GLTextureRep":function(){define(["require","exports","../../../../core/Logger","./Util","../../../webgl/Texture"],function(q,h,e,a,d){var b=e.getLogger("esri.views.3d.webgl-engine.lib.GLTextureRep"),g=function(){function b(a){this._glTexture=null;this._refCount=0;this._glTexture=a}b.prototype.incRefCnt=function(){++this._refCount};b.prototype.decRefCnt=function(){--this._refCount;a.assert(0<=this._refCount)};b.prototype.getRefCnt=function(){return this._refCount};
b.prototype.setGLTexture=function(a){this._glTexture=a};b.prototype.getGLTexture=function(){return this._glTexture};return b}();return function(){function c(a,b,c,d){this.NUM_PARALLEL=8;this.textures=a;this._programRepository=b;this.getViewportToRestore=c;this._rctx=d;this.NUM_PARALLEL=8;this.id2textureRef={};this.loading={};this._queue=[];this.listeners=[];this.maxMaxAnisotropy=(this.afExt=d.capabilities.textureFilterAnisotropic)?d.parameters.maxMaxAnisotropy:1;this.maxAnisotropy=Math.min(8,this.maxMaxAnisotropy);
this._needsRender=!0;this._fallbackTextureData=new Uint8Array(256);this._fallbackTextureTransparentData=new Uint8Array(256);for(a=0;a<this._fallbackTextureData.length;++a)this._fallbackTextureData[a]=255,this._fallbackTextureTransparentData[a]=0!==(a+1)%4?255:0;this._fallbackTextureDesc={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:8,height:8,maxAnisotropy:8}}c.prototype.resetNeedsRender=function(){this._needsRender=!1};c.prototype.needsRender=function(){return this._needsRender};
c.prototype.aquire=function(c,e,n){var f=this,k=this.id2textureRef[c];if(null==k){var m=this.textures[c];a.assert(void 0!==m);m.setUnloadFunc(this._unload.bind(this));e=!0===e;var h=this._createGLTextureDescription(m),k=new g(null);a.assert(null==this.id2textureRef[c]);this.id2textureRef[c]=k;if(m.initializeThroughRender)c=m.initializeThroughRender(this._rctx,h),k.setGLTexture(c),n&&n(k);else if(m.deferredLoading())this.getLoadingCount()<this.NUM_PARALLEL?this._loadImage(c,h,n):this._queue.push([c,
h,n]);else try{m.initializeThroughUpload(this._rctx,h,this._programRepository,this.getViewportToRestore(),function(a){k.setGLTexture(a);f._needsRender=!0;n&&n(k)})}catch(t){b.error("#aquire","Error loading texture: "+t.toString())}null==k.getGLTexture()&&k.setGLTexture(e?new d(this._rctx,this._fallbackTextureDesc,this._fallbackTextureTransparentData):new d(this._rctx,this._fallbackTextureDesc,this._fallbackTextureData));this._needsRender=!0}k.incRefCnt();return k};c.prototype.release=function(b){b=
this.id2textureRef[b];void 0!==b&&(b.decRefCnt(),a.assert(0<=b.getRefCnt()))};c.prototype.getLoadingCount=function(){return Object.keys(this.loading).length};c.prototype.getIsLoaded=function(a){if(null==this.id2textureRef[a]||void 0!==this.loading[a])return!1;for(var b=0;b<this._queue.length;++b)if(this._queue[b][0]===a)return!1;return!0};c.prototype.addTextureListener=function(b){a.assert(-1===this.listeners.indexOf(b));this.listeners.push(b)};c.prototype.removeTextureListener=function(b){b=this.listeners.indexOf(b);
a.assert(-1!==b);this.listeners.splice(b,1)};c.prototype.getTexture=function(a){return this.textures[a]};c.prototype.getMaxAnisotropy=function(){return this.maxAnisotropy};c.prototype._unload=function(a){var b=this.id2textureRef[a];void 0!==b&&((b=b.getGLTexture())&&b.dispose(),delete this.id2textureRef[a]);this.next(a)};c.prototype._createGLTextureDescription=function(a){return{target:3553,pixelFormat:6408,dataType:5121,maxAnisotropy:this.afExt&&a.params&&a.params.mipmap&&!a.params.disableAnisotropy?
this.maxAnisotropy:void 0,wrapMode:a.params&&a.params.wrapClamp?33071:void 0}};c.prototype.next=function(a){if(a in this.loading){delete this.loading[a];var b=Object.keys(this.id2textureRef),c=Object.keys(this.loading);this.listeners.forEach(function(d){d(a,b,c)});this.processQueue()}};c.prototype._loadImage=function(b,c,d){var f=this;a.assert(null==this.loading[b]);this.loading[b]=!0;var e=this.textures[b];a.assert(void 0!==e);setTimeout(function(){var a=f.id2textureRef[b];a&&a.getRefCnt()&&e.initializeThroughUpload(f._rctx,
c,f._programRepository,f.getViewportToRestore(),function(c){f.next(b);f._needsRender=!0;a&&a.getRefCnt()&&(a.setGLTexture(c),d&&d(a))})},0)};c.prototype.processQueue=function(){for(var a=[],b=0;b<this._queue.length;++b){var c=this._queue[b][0],d=this.id2textureRef[c];void 0!==d&&(0===d.getRefCnt()?(d.getGLTexture().dispose(),delete this.id2textureRef[c]):a.push(this._queue[b]))}this._queue=a;a=Math.min(this.NUM_PARALLEL-Object.keys(this.loading).length,this._queue.length);for(b=0;b<a;++b)this._loadImage(this._queue[b][0],
this._queue[b][1],this._queue[b][2]);this._queue.splice(0,a)};return c}()})},"esri/views/3d/webgl-engine/lib/HighlightHelper":function(){define("require exports dojo/text!../materials/internal/highlight.xml ../../support/debugFlags ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./gl-matrix ./glUtil3D ./Util ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/Util ../../../webgl/VertexArrayObject".split(" "),function(q,h,e,a,d,b,g,c,f,
k,n,l,p,m){return function(){function h(a,b,c){this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0};this.blur1Fbo=this.blur0Fbo=this.quadVAO=null;this._rctx=c;this.viewportToRestore=g.vec4d.create();this.programRep=a;this.defaultOptions={color:new Float32Array([1,0,1,1]),haloOpacity:1,fillOpacity:.2,haloOpacityOccluded:.25,fillOpacityOccluded:.05}}Object.defineProperty(h.prototype,"enabled",{get:function(){return null!==
this.blur0Fbo},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"profilingCallback",{get:function(){return a.HIGHLIGHTS_PROFILE_TO_CONSOLE?function(a){return console.log(a)}:null},enumerable:!0,configurable:!0});h.prototype.setDefaultOptions=function(a){this.defaultOptions=a};h.prototype.render=function(b,c,d){var e=!a.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED,k=a.HIGHLIGHTS_VISUALIZE_BLOCKS,l=this._rctx;f.assert(this.enabled);g.vec4d.set(b.fullViewport,
this.viewportToRestore);b=Math.ceil(d.width/1);var m=Math.ceil(d.height/1);this.blur0Fbo.resize(b,m);this.blur1Fbo.resize(b,m);l.bindVAO(this.quadVAO);l.setDepthWriteEnabled(!1);l.setDepthTestEnabled(!1);l.setBlendingEnabled(!1);var n=null,h=n=null,u=null;if(e){var r=this._grid;this._gridUpdateResources(d,32);this._gridComputeMipmap();h=r.vao;u=4;n=this.programRep.get("highlight-blur-grid-5");l.bindProgram(n);l.bindTexture(r.coverageMipmap[r.mipmapLevels].colorTexture,1);n.setUniform1i("coverageTex",
1)}else h=this.quadVAO,u=5,n=this.programRep.get("highlight-blur-5"),l.bindProgram(n);l.bindVAO(h);l.bindFramebuffer(this.blur0Fbo);l.setViewport(0,0,b,m);l.setClearColor(0,0,0,0);l.clear(l.gl.COLOR_BUFFER_BIT);n.setUniform1i("tex",0);l.bindTexture(d.colorTexture,0);n.setUniform2f("blurSize",1/b,0);l.drawArrays(u,0,p.vertexCount(h,"geometry"));l.bindFramebuffer(this.blur1Fbo);l.clear(l.gl.COLOR_BUFFER_BIT);l.bindTexture(this.blur0Fbo.colorTexture,0);n.setUniform2f("blurSize",0,1/m);l.drawArrays(u,
0,p.vertexCount(h,"geometry"));l.bindFramebuffer(c);l.setBlendingEnabled(!0);l.setBlendFunctionSeparate(770,771,1,771);l.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]);e?(n=this.programRep.get(k?"highlight-apply-grid-debug":"highlight-apply-grid"),l.bindProgram(n),n.setUniform1i("coverageTex",2),l.bindTexture(this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,2)):(n=this.programRep.get("highlight-apply"),l.bindProgram(n));
n.setUniform1i("tex",0);l.bindTexture(this.blur1Fbo.colorTexture,0);n.setUniform1i("origin",1);l.bindTexture(d.colorTexture,1);n.setUniform4fv("color",this.defaultOptions.color);n.setUniform1f("outlineSize",8.6);n.setUniform1f("blurSize",.4);n.setUniform4f("opacities",this.defaultOptions.haloOpacity,this.defaultOptions.haloOpacityOccluded,this.defaultOptions.fillOpacity,this.defaultOptions.fillOpacityOccluded);l.drawArrays(u,0,p.vertexCount(h,"geometry"));l.bindVAO(null);l.setDepthWriteEnabled(!0);
l.setDepthTestEnabled(!0);l.setBlendingEnabled(!1)};h.prototype.enable=function(){if(!this.enabled){this.quadVAO=c.createQuadVAO(this._rctx);var a={colorTarget:0,depthStencilTarget:0,width:0,height:0},b={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0};this.blur0Fbo=n.createWithAttachments(this._rctx,b,a);this.blur1Fbo=n.createWithAttachments(this._rctx,b,a)}};h.prototype.disable=function(){this.enabled&&(this.quadVAO.dispose(!0),this.blur1Fbo.dispose(),
this.blur0Fbo.dispose(),this.blur1Fbo=this.blur0Fbo=this.quadVAO=null)};h.prototype._gridUpdateResources=function(a,c){var f=this._rctx,e=this._grid,g=!1;null===e.coverageMipmap&&(e.coverageMipmap=[a],g=!0);if(e.viewportWidth!==a.width||e.viewportHeight!==a.height)g=!0,e.viewportWidth=a.width,e.viewportHeight=a.height;e.coverageMipmap[0]=a;e.cellPixelSize!==c&&(e.cellPixelSize=c,g=!0);if(g){for(c=1;c<e.coverageMipmap.length;c++)e.coverageMipmap[c].dispose();e.mipmapLevels=Math.ceil(Math.log(e.cellPixelSize)*
Math.LOG2E);e.coverageMipmap.length=e.mipmapLevels+1;for(c=0;c<e.mipmapLevels;c++)g=e.coverageMipmap[c],g=n.createWithAttachments(f,{target:3553,pixelFormat:6407,dataType:33635,samplingMode:9729,wrapMode:33071,width:Math.ceil(g.width/2),height:Math.ceil(g.height/2)},{colorTarget:0,depthStencilTarget:0,width:Math.ceil(g.width/2),height:Math.ceil(g.height/2)}),e.coverageMipmap[c+1]=g}var g=Math.ceil(a.height/e.cellPixelSize),l=Math.ceil(a.width/e.cellPixelSize);if(!e.vao||e.verticalCellCount!==g||e.horizontalCellCount!==
l){e.verticalCellCount=g;e.horizontalCellCount=l;a=g+1;c=l+1;for(var g=1/g,l=1/l,p=new Float32Array(24*a*c),h=0,u=0;u<a;u++)for(var r=0;r<c;r++)p[h+0]=(r-.5)*l*2-1,p[h+1]=(u-.5)*g*2-1,p[h+2]=r*l,p[h+3]=u*g,p[h+4]=(r+.5)*l*2-1,p[h+5]=(u-.5)*g*2-1,p[h+6]=r*l,p[h+7]=u*g,p[h+8]=(r-.5)*l*2-1,p[h+9]=(u+.5)*g*2-1,p[h+10]=r*l,p[h+11]=u*g,p[h+12]=(r-.5)*l*2-1,p[h+13]=(u+.5)*g*2-1,p[h+14]=r*l,p[h+15]=u*g,p[h+16]=(r+.5)*l*2-1,p[h+17]=(u-.5)*g*2-1,p[h+18]=r*l,p[h+19]=u*g,p[h+20]=(r+.5)*l*2-1,p[h+21]=(u+.5)*g*
2-1,p[h+22]=r*l,p[h+23]=u*g,h+=24;e.vao&&e.vao.dispose(!0);e.vao=new m(f,d.Default3D,{geometry:b.Pos2Tex},{geometry:k.createVertex(f,35044,p)})}};h.prototype._gridComputeMipmap=function(){var a=this._rctx,b=this._grid,c=this.programRep.get("conservative-downsample");a.bindVAO(this.quadVAO);for(var d=0;d<b.mipmapLevels;d++){a.bindFramebuffer(b.coverageMipmap[d+1]);a.bindTexture(b.coverageMipmap[d].colorTexture,0);var f=b.coverageMipmap[d+1].width,e=b.coverageMipmap[d+1].height;a.bindProgram(c);c.setUniform1i("tex",
0);c.setUniform2f("invFramebufferDim",1/f,1/e);a.setViewport(0,0,f,e);a.drawArrays(5,0,p.vertexCount(this.quadVAO,"geometry"))}};h.loadShaders=function(a,b,c){a._parse(e);for(var f=0,g=["3","5","7","9"];f<g.length;f++){var k=g[f];b.add("highlight-blur-"+k,new l(c,a.vsHighlightBlurFastGaussian,a.fsHighlightBlurFastGaussian,d.Default3D,{GAUSSIAN_SAMPLES:k}));b.add("highlight-blur-grid-"+k,new l(c,a.vsHighlightBlurFastGaussian,a.fsHighlightBlurFastGaussian,d.Default3D,{GAUSSIAN_SAMPLES:k,GRID_OPTIMIZATION:"true"}))}b.add("highlight-apply",
new l(c,a.vsHighlightApply,a.fsHighlightApply,d.Default3D));b.add("highlight-apply-grid",new l(c,a.vsHighlightApply,a.fsHighlightApply,d.Default3D,["GRID_OPTIMIZATION"]));b.add("highlight-apply-grid-debug",new l(c,a.vsHighlightApply,a.fsHighlightApply,d.Default3D,["GRID_OPTIMIZATION","GRID_DEBUG"]));b.add("conservative-downsample",new l(c,a.vsConservativeDownsample,a.fsConservativeDownsample,d.Default3D))};return h}()})},"esri/views/3d/webgl-engine/lib/OffscreenRenderingHelper":function(){define("require exports dojo/text!../materials/internal/offscreen.xml ./DefaultVertexAttributeLocations ./glUtil3D ./RenderTargetHelper ./Util ../../../webgl/Program ../../../webgl/Util".split(" "),
function(q,h,e,a,d,b,g,c,f){var k=[0,0,0,0],n=[0,1,0,1];return function(){function l(a,c){this.dimensions={width:4,height:4};this._enabled=!1;this._background={type:"color",color:[0,0,0,1]};this._programRep=a;this._rctx=c;a=this.renderTargetHelper=new b.RenderTargetHelper(c);this.mainColor=a.registerColorTarget({name:"mainColor"});this.mainDepth=a.registerDepthTarget({name:"mainDepth"});this.hudVisibility=a.registerColorTarget({name:"hudVisibility",dataType:32819});this.tmpColor=a.registerColorTarget({name:"tmpColor"});
this.tmpDepth=a.registerDepthTarget({name:"tmpDepth"})}l.loadShaders=function(b,d,f){b._parse(e);var g=new c(f,b.vsOffscreenRenderer,b.fsOffscreenRenderer,a.Default3D);d.add("offscreenProgram",g);b=new c(f,b.vsOffscreenRenderer,b.fsOffscreenRendererTransparentToHUDVisibility,a.Default3D);d.add("transparentToHUDVisibility",b)};Object.defineProperty(l.prototype,"width",{get:function(){return this.dimensions.width},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"height",{get:function(){return this.dimensions.height},
enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"enabled",{get:function(){return this._enabled},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"background",{get:function(){return this._background},set:function(a){this._background=a},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"framebuffer",{get:function(){return this.renderTargetHelper.getFramebuffer(this.dimensions,this.mainColor,this.mainDepth)},
enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"colorTexture",{get:function(){return this.framebuffer.colorTexture},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"depthTexture",{get:function(){return this.renderTargetHelper.getDepthTexture(this.mainDepth,this.dimensions)},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"hudVisibilityTexture",{get:function(){return this.getColorTexture(this.hudVisibility)},enumerable:!0,configurable:!0});l.prototype.initializeFrame=
function(a){g.assert(this.enabled);var b=this._rctx,c=b.gl;a=a.fullViewport;this.dimensions.width=a[2];this.dimensions.height=a[3];this.bindTarget(this.mainColor,this.mainDepth);b.setClearStencil(0);a=this._background.color;b.setClearColor(a[0]*a[3],a[1]*a[3],a[2]*a[3],a[3]);b.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT|c.STENCIL_BUFFER_BIT)};l.prototype.renderSeparateAndComposite=function(a,b,c){void 0===b&&(b=k);void 0===c&&(c="none");this.renderToTargets(a,this.tmpColor,this.mainDepth,b);this.composite(this.getColorTexture(this.tmpColor),
this.framebuffer,c)};l.prototype.renderHUDVisibility=function(a){this.renderToTargets(a,this.hudVisibility,this.mainDepth,n)};l.prototype.compositeTransparentTerrainOntoHUDVisibility=function(){var a=this,b=this._rctx;this.renderToTargets(function(){var c=a._programRep.get("transparentToHUDVisibility");b.bindProgram(c);c.setUniform1i("tex",1);b.bindTexture(a.getColorTexture(a.tmpColor),1);b.setDepthTestEnabled(!1);b.setBlendingEnabled(!1);b.setColorMask(!1,!0,!1,!1);b.bindVAO(a.quadVAO);b.drawArrays(5,
0,f.vertexCount(a.quadVAO,"geometry"));b.setColorMask(!0,!0,!0,!0);b.setDepthTestEnabled(!0)},this.hudVisibility,this.mainDepth)};l.prototype.compositeTransparentTerrainOntoMain=function(){this.composite(this.getColorTexture(this.tmpColor),this.framebuffer,"premultiplied-alpha")};l.prototype.bindFramebuffer=function(){this._rctx.bindFramebuffer(this.framebuffer)};l.prototype.renderDepthDetached=function(a){this.bindTarget(this.mainColor);a();this.bindTarget(this.mainColor,this.mainDepth)};l.prototype.composite=
function(a,b,c){void 0===a&&(a=this.framebuffer.colorTexture);void 0===b&&(b=null);void 0===c&&(c="none");var d=this._rctx,e=this._programRep.get("offscreenProgram");d.bindFramebuffer(b);d.setDepthTestEnabled(!1);d.bindProgram(e);e.setUniform1i("tex",1);d.bindTexture(a,1);switch(c){case "none":d.setBlendingEnabled(!1);break;case "alpha":d.setBlendFunctionSeparate(770,771,1,771);d.setBlendingEnabled(!0);break;case "premultiplied-alpha":d.setBlendFunction(1,771),d.setBlendingEnabled(!0)}d.bindVAO(this.quadVAO);
d.drawArrays(5,0,f.vertexCount(this.quadVAO,"geometry"));d.setDepthTestEnabled(!0);d.setBlendingEnabled(!1)};l.prototype.enable=function(){this.enabled||(this._enabled=!0,this.quadVAO=d.createQuadVAO(this._rctx))};l.prototype.disable=function(){this.enabled&&(this._enabled=!1,this.renderTargetHelper.disposeAllResource(),this.quadVAO.dispose(!0),this.quadVAO=null)};l.prototype.renderToTargets=function(a,b,c,d,f){var e=this._rctx,g=e.gl;this.bindTarget(b,c);b=0;d&&(e.setClearColor(d[0],d[1],d[2],Math.max(1E-13,
d[3])),b|=g.COLOR_BUFFER_BIT);f&&(b|=g.DEPTH_BUFFER_BIT);e.clear(b);a();g.flush();this.bindTarget(this.mainColor,this.mainDepth)};l.prototype.bindTarget=function(a,b){a=this.renderTargetHelper.getFramebuffer(this.dimensions,a,b);this._rctx.bindFramebuffer(a)};l.prototype.getColorTexture=function(a){return this.renderTargetHelper.getColorTexture(a,this.dimensions)};return l}()})},"esri/views/3d/webgl-engine/lib/RenderTargetHelper":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../webgl/FramebufferObject ../../../webgl/Renderbuffer ../../../webgl/Texture".split(" "),
function(q,h,e,a,d,b){Object.defineProperty(h,"__esModule",{value:!0});var g={dataType:5121},c={};q=function(){function f(a){this.rctx=a;this.framebuffers=new Map;this.depthTextures=new Map;this.depthBuffers=new Map;this.colorTextures=new Map;this.nextId=1;this.depthTextureSupported=a.capabilities.depthTexture}f.prototype.disposeAllResource=function(){this.depthBuffers.forEach(function(a){return a.dispose()});this.depthBuffers.clear();this.depthTextures.forEach(function(a){return a.dispose()});this.depthTextures.clear();
this.colorTextures.forEach(function(a){return a.dispose()});this.colorTextures.clear()};f.prototype.getDepthTexture=function(a,c){if(this.depthTextureSupported){var d=this.depthTextures.get(a.id);!d||d.descriptor.width===c.width&&d.descriptor.height===c.height||(d.dispose(),d=void 0);d||(d=new b(this.rctx,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:c.width,height:c.height}),this.depthTextures.set(a.id,d));return d}};f.prototype.getDepthBuffer=function(a,b){if(!this.depthTextureSupported){var c=
this.depthBuffers.get(a.id);c?c.descriptor.width===b.width&&c.descriptor.height===b.height||c.resize(b.width,b.height):(c=new d(this.rctx,e({internalFormat:34041},b)),this.depthBuffers.set(a.id,c));return c}};f.prototype.getColorTexture=function(a,c){var d=this.colorTextures.get(a.id);!d||d.descriptor.width===c.width&&d.descriptor.height===c.height||(d.dispose(),d=void 0);d||(d=new b(this.rctx,{target:3553,pixelFormat:6408,dataType:a.dataType,samplingMode:9729,wrapMode:33071,width:c.width,height:c.height}),
this.colorTextures.set(a.id,d));return d};f.prototype.registerDepthTarget=function(a){void 0===a&&(a={});var b=this.nextId++;return e({id:b},c,a)};f.prototype.registerColorTarget=function(a){void 0===a&&(a={});var b=this.nextId++;return e({id:b},g,a)};f.prototype.getFramebuffer=function(b,c,d){var f=this.getKey(c,d),e=this.framebuffers.get(f);c=this.getColorTexture(c,b);if(this.depthTextureSupported){var g=d?this.getDepthTexture(d,b):void 0;if(!e)return e=d?a.createWithAttachments(this.rctx,c,{colorTarget:0,
depthStencilTarget:4},g):a.createWithAttachments(this.rctx,c,{colorTarget:0,depthStencilTarget:0}),this.framebuffers.set(f,e),e;if(d=e.width!==b.width||e.height!==b.height||e.colorTexture!==c||e.depthStencilTexture!==g)e.detachColorTexture(),e.detachDepthStencilTexture(),e.resize(b.width,b.height),e.attachColorTexture(c),e.attachDepthStencilTexture(g)}else{g=d?this.getDepthBuffer(d,b):void 0;if(!e)return e=a.createWithAttachments(this.rctx,c,{colorTarget:0,depthStencilTarget:d?3:0},g),this.framebuffers.set(f,
e),e;if(d=e.width!==b.width||e.height!==b.height||e.colorTexture!==c)e.detachColorTexture(),e.detachDepthStencilBuffer(),e.resize(b.width,b.height),e.attachColorTexture(c),e.attachDepthStencilBuffer(g)}return e};f.prototype.getKey=function(a,b){return a.id+"_"+(b?b.id:"X")+"_"+a.name+(b?"_"+b.name:"")};return f}();h.RenderTargetHelper=q})},"esri/views/3d/webgl-engine/lib/ProgramRepository":function(){define(["require","exports","./Util"],function(q,h,e){return function(){function a(){this.shaderVariators=
{};this._nextId=0;this._programsByName={};this._namesById=[];this._programRefCount=[];this._commonUniforms={model:[],modelNormal:[],lightDirection:[],proj:[],shadowMapDistance:[],viewportPixelSz:[],lightingMainDirection:[]}}a.prototype.dispose=function(){for(var a in this._programsByName)this._programsByName[a].dispose();this._programRefCount=this._namesById=this._programsByName=null};a.prototype.add=function(a,b){e.assert(null==this._programsByName[a]);this._programsByName[a]=b;this._namesById[b.id]=
a};a.prototype.get=function(a){return this._programsByName[a]};a.prototype.addShaderVariations=function(a,b){this.shaderVariators[a]=b};a.prototype.getShaderVariations=function(a){return this.shaderVariators[a]};a.prototype.getShaderVariationsProgram=function(a,b,e,c,f){return(a=this.getShaderVariations(a))&&a.getProgram(b,e,c,f)};a.prototype.getProgramsUsingUniform=function(a){return this._commonUniforms[a]||[]};a.prototype.increaseRefCount=function(a){var b=a.id;this._programRefCount[b]?this._programRefCount[b]++:
(this._programRefCount[b]=1,this._findCommonUniforms(a))};a.prototype.decreaseRefCount=function(a){var b=a.id;1<this._programRefCount[b]?this._programRefCount[b]--:(this._forgetCommonUniforms(a),this._programRefCount[b]=0)};a.prototype._getNextId=function(){return this._nextId++};a.prototype._findCommonUniforms=function(a){for(var b in this._commonUniforms)a.hasUniform(b)&&(e.assert(-1===this._commonUniforms[b].indexOf(a),"common uniforms of program have already been determined"),this._commonUniforms[b].push(a))};
a.prototype._forgetCommonUniforms=function(a){for(var b in this._commonUniforms){var d=this._commonUniforms[b],c=d.indexOf(a);-1<c&&(d[c]=d[d.length-1],d.pop())}};return a}()})},"esri/views/3d/webgl-engine/lib/RenderOccludedHelper":function(){define("require exports dojo/text!../materials/internal/occluded.xml ./DefaultVertexAttributeLocations ./gl-matrix ./glUtil3D ./Util ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/Util".split(" "),function(q,h,e,a,d,b,g,c,f,k){return function(){function n(a,
b,c){this._quadVAO=null;this._rctx=c;this._colorFBO=void 0;this._viewportToRestore=d.vec4d.create();this.programRep=a}Object.defineProperty(n.prototype,"enabled",{get:function(){return void 0!==this._colorFBO},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});n.prototype.setupFBOs=function(a){g.assert(this.enabled);this._viewportToRestore=a=a.fullViewport;this._width=a[2];this._height=a[3];this._rctx.setViewport(0,0,this._width,this._height)};n.prototype.prepareColorPass=
function(){g.assert(this.enabled);var a=this._rctx,b=a.gl;this._colorFBO.resize(this._width,this._height);a.bindFramebuffer(this._colorFBO);a.setClearColor(0,0,0,0);a.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT)};n.prototype.finish=function(a){var b=this._rctx;b.bindFramebuffer(a);b.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])};n.prototype.apply=function(){var a=this._rctx,b=this.programRep.get("render-occluded-apply");a.bindProgram(b);
a.bindVAO(this._quadVAO);a.bindTexture(this._colorFBO.colorTexture,0);b.setUniform1i("occludedColorMap",0);a.setDepthWriteEnabled(!1);a.setDepthTestEnabled(!1);a.setBlendingEnabled(!0);a.setBlendFunction(770,771);a.drawArrays(5,0,k.vertexCount(this._quadVAO,"geometry"));a.bindVAO(null);a.setDepthWriteEnabled(!0);a.setDepthTestEnabled(!0);a.setBlendingEnabled(!1)};n.prototype.enable=function(){this.enabled||(this._quadVAO=b.createQuadVAO(this._rctx),this._colorFBO=c.createWithAttachments(this._rctx,
{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:1}))};n.prototype.disable=function(){this.enabled&&(this._quadVAO.dispose(!0),this._quadVAO=void 0,this._colorFBO.dispose(),this._colorFBO=void 0)};n.loadShaders=function(b,c,d){b._parse(e);c.add("render-occluded-apply",new f(d,b.vsRenderOccludedApply,b.fsRenderOccludedApply,a.Default3D))};return n}()})},"esri/views/3d/webgl-engine/lib/ShaderSnippets":function(){define(["require",
"exports","dojox/xml/parser","./Util"],function(q,h,e,a){return function(){function d(b){var d=a.VertexAttrConstants,c;for(c in d)this[d[c]]=a.VertexAttrConstants[c];if(b)for(var f in b)this[f]=b[f]}d.prototype._parse=function(b){b=e.parse(b).getElementsByTagName("snippet");for(var d=/\$[a-zA-Z0-9_]+[ \t]*/,c=/[\$\s]+/g,f=0;f<b.length;f++){var k=b[f].getAttribute("name");a.assert(null==this[k]);for(var n=b[f].textContent;;){var l=n.match(d);if(null==l)break;var p=this[l[0].replace(c,"")];a.assert(void 0!==
p);n=n.replace(l[0],p)}this[k]=n}};return d}()})},"dojox/xml/parser":function(){define(["dojo/_base/kernel","dojo/_base/lang","dojo/_base/array","dojo/_base/window","dojo/_base/sniff"],function(q){q.getObject("xml.parser",!0,dojox);dojox.xml.parser.parse=function(h,e){var a=q.doc,d;e=e||"text/xml";if(h&&q.trim(h)&&"DOMParser"in q.global){d=(new DOMParser).parseFromString(h,e);h=d.documentElement;if("parsererror"==h.nodeName&&"http://www.mozilla.org/newlayout/xml/parsererror.xml"==h.namespaceURI){if(a=
h.getElementsByTagNameNS("http://www.mozilla.org/newlayout/xml/parsererror.xml","sourcetext")[0])a=a.firstChild.data;throw Error("Error parsing text "+h.firstChild.data+" \n"+a);}return d}if("ActiveXObject"in q.global){a=function(a){return"MSXML"+a+".DOMDocument"};a=["Microsoft.XMLDOM",a(6),a(4),a(3),a(2)];q.some(a,function(a){try{d=new ActiveXObject(a)}catch(c){return!1}return!0});if(h&&d&&(d.async=!1,d.loadXML(h),h=d.parseError,0!==h.errorCode))throw Error("Line: "+h.line+"\nCol: "+h.linepos+"\nReason: "+
h.reason+"\nError Code: "+h.errorCode+"\nSource: "+h.srcText);if(d)return d}else if(a.implementation&&a.implementation.createDocument){if(h&&q.trim(h)&&a.createElement){e=a.createElement("xml");e.innerHTML=h;var b=a.implementation.createDocument("foo","",null);q.forEach(e.childNodes,function(a){b.importNode(a,!0)});return b}return a.implementation.createDocument("","",null)}return null};dojox.xml.parser.textContent=function(h,e){if(1<arguments.length)return dojox.xml.parser.replaceChildren(h,(h.ownerDocument||
q.doc).createTextNode(e)),e;if(void 0!==h.textContent)return h.textContent;var a="";h&&q.forEach(h.childNodes,function(d){switch(d.nodeType){case 1:case 5:a+=dojox.xml.parser.textContent(d);break;case 3:case 2:case 4:a+=d.nodeValue}});return a};dojox.xml.parser.replaceChildren=function(h,e){var a=[];q.isIE&&q.forEach(h.childNodes,function(d){a.push(d)});dojox.xml.parser.removeChildren(h);q.forEach(a,q.destroy);q.isArray(e)?q.forEach(e,function(a){h.appendChild(a)}):h.appendChild(e)};dojox.xml.parser.removeChildren=
function(h){for(var e=h.childNodes.length;h.hasChildNodes();)h.removeChild(h.firstChild);return e};dojox.xml.parser.innerXML=function(h){return h.innerXML?h.innerXML:h.xml?h.xml:"undefined"!=typeof XMLSerializer?(new XMLSerializer).serializeToString(h):null};return dojox.xml.parser})},"esri/views/3d/webgl-engine/lib/SSAOHelper":function(){define("require exports dojo/text!../materials/internal/ssao.xml ../../../../core/Logger ../../support/imageUtils ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./gl-matrix ./glUtil3D ./Util ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/Texture ../../../webgl/Util ../../../webgl/VertexArrayObject".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t){var u=a.getLogger("esri.views.3d.webgl-engine.lib.SSAOHelper");h=function(){function a(a,b,d,e){this._enabled=!1;this._BLUR_F=2;this._attenuation=.5;this._radius=3;this._samples=16;this._viewportToRestore=c.vec4d.create();this._rctx=d;this._programRep=a;this._requestRender=e;this._emptyTexture=f.createEmptyTexture(d)}a.prototype.dispose=function(){this._emptyTexture.dispose();this._emptyTexture=null};Object.defineProperty(a.prototype,"isSupported",{get:function(){var a=
this._rctx,b=-1!==a.parameters.versionString.indexOf("WebGL 0.93"),c=-1!==a.parameters.versionString.indexOf("WebGL 0.94");return a.capabilities.standardDerivatives&&!(b||c)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"enabled",{get:function(){return this._enabled},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"attenuation",{get:function(){return this._attenuation},set:function(a){this._attenuation=a},enumerable:!0,
configurable:!0});Object.defineProperty(a.prototype,"radius",{get:function(){return this._radius},set:function(a){this._radius=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"filterRadius",{get:function(){return 4},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"samples",{get:function(){return this._samples},set:function(a){this._samples=a},enumerable:!0,configurable:!0});a.prototype.computeSSAO=function(a,b,d,e){if(this._noiseTexture){k.assert(this.enabled);
var g=this._rctx,l=d.width,m=d.height,n=l/this._BLUR_F,p=m/this._BLUR_F;this._ssaoFBO.resize(l,m);this._blur0FBO.resize(n,p);this._blur1FBO.resize(n,p);n=1*l;p=1*m;g.bindFramebuffer(this._ssaoFBO);c.vec4d.set(a.fullViewport,this._viewportToRestore);g.setViewport(0,0,l,m);var h=this._programRep.get(8>=this._samples?"ssao8":16>=this._samples?"ssao16":32>=this._samples?"ssao32":"ssao64"),u=this._programRep.get("blur");h.setUniform2f("rnmScale",l/this._noiseTexture.descriptor.width,m/this._noiseTexture.descriptor.height);
h.setUniform3fv("pSphere",8>=this._samples?this._data.random8:16>=this._samples?this._data.random16:32>=this._samples?this._data.random32:this._data.random64);g.bindProgram(h);l=this._data.minDiscrepancy;h.setUniform1f("numSpiralTurns",this._samples<l.length?l[this._samples]:5779);l=v;m=x;k.inverseProjectionInfo(a.projectionMatrix,a.fullWidth,a.fullHeight,l,m);h.setUniform4fv("projInfo",l);h.setUniform2fv("zScale",m);h.setUniform2f("nearFar",a.near,a.far);l=1/a.computePixelSizeAtDist(1);h.setUniform1f("projScale",
1*l);h.setUniform2f("screenDimensions",n,p);var t=2*this._radius,m=c.vec3d.dist(a.eye,a.center),t=20*a.computePixelSizeAtDist(m),t=Math.max(.1,t);h.setUniform1f("radius",t);h.setUniform1f("intensity",4*this._attenuation/Math.pow(t,6));h.setUniform1i("rnm",0);h.setUniform1i("normalMap",1);h.setUniform1i("depthMap",2);g.bindTexture(this._noiseTexture,0);g.bindTexture(e.colorTexture,1);g.bindTexture(d.colorTexture,2);d=f.createQuadVAO(this._rctx);g.bindVAO(d);g.drawArrays(5,0,r.vertexCount(d,"geometry"));
g.bindTexture(this._ssaoFBO.colorTexture,0);g.setViewport(0,0,n/this._BLUR_F,p/this._BLUR_F);g.bindFramebuffer(this._blur0FBO);u.setUniform2f("screenDimensions",n,p);u.setUniform1i("tex",0);u.setUniform1i("normalMap",1);u.setUniform1i("depthMap",2);u.setUniform2f("blurSize",0,1*this._BLUR_F/p);u.setUniform1i("radius",4);u.setUniform1f("g_BlurFalloff",.08);u.setUniform2f("nearFar",a.near,a.far);5E4<m&&(l=Math.max(0,l-(m-5E4)));u.setUniform1f("projScale",l);u.setUniform2f("zScale",1,0);g.drawArrays(5,
0,r.vertexCount(d,"geometry"));u.setUniform2f("blurSize",1*this._BLUR_F/n,0);g.bindFramebuffer(this._blur1FBO);g.bindTexture(this._blur0FBO.colorTexture,0);g.drawArrays(5,0,r.vertexCount(d,"geometry"));g.bindFramebuffer(b);g.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])}};a.prototype.setUniforms=function(a){var b=this.enabled&&this._noiseTexture,c=this._rctx;c.bindTexture(b?this._blur1FBO.colorTexture:this._emptyTexture,6);
c.setActiveTexture(0);a.setUniform1i("ssaoTex",6);b?a.setUniform4f("viewportPixelSz",this._viewportToRestore[0],this._viewportToRestore[1],1/this._ssaoFBO.width,1/this._ssaoFBO.height):a.setUniform4f("viewportPixelSz",-1,-1,-1,-1)};a.prototype.bindAll=function(a){a=a.getProgramsUsingUniform("viewportPixelSz");for(var b=0;b<a.length;b++)this.setUniforms(a[b])};a.prototype.drawQuad=function(a){k.assert(this.enabled);var c=this._programRep.get("showDepth");this._debugQuadVAO||(this._debugQuadVAO=new t(this._rctx,
b.Default3D,{geometry:g.Pos2Tex},{geometry:n.createVertex(this._rctx,35044,A)}));var d=this._rctx;d.setDepthTestEnabled(!1);c.setUniformMatrix4fv("proj",new Float32Array(a));c.setUniform1i("depthTex",0);d.bindTexture(this._ssaoFBO.colorTexture,0);d.bindVAO(this._debugQuadVAO);d.drawArrays(5,0,r.vertexCount(this._debugQuadVAO,"geometry"));d.setDepthTestEnabled(!0)};a.prototype.enable=function(){var a=this;this.enabled||(this.isSupported?(this._enabled=!0,this.loadResources(function(){a._enabled&&a.initialize()})):
u.warn("SSAO is not supported for this browser or hardware"))};a.prototype.loadResources=function(a){var b=this;this._data?a():q(["./SSAOHelperData"],function(c){b._data=c;a()})};a.prototype.initialize=function(){var a=this,b={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0},c={colorTarget:0,depthStencilTarget:0};this._ssaoFBO=l.createWithAttachments(this._rctx,b,c);this._blur0FBO=l.createWithAttachments(this._rctx,b,c);this._blur1FBO=l.createWithAttachments(this._rctx,
b,c);d.requestImage(this._data.noiseTexture).then(function(b){a._enabled&&(a._noiseTexture=new m(a._rctx,{target:3553,pixelFormat:6408,dataType:5121,hasMipmap:!0,width:b.width,height:b.height},b),a._requestRender())})};a.prototype.disable=function(){this.enabled&&(this._enabled=!1,this._quadVAO&&(this._quadVAO.dispose(!0),this._quadVAO=null),this._noiseTexture&&(this._noiseTexture.dispose(),this._noiseTexture=null),this._blur1FBO&&(this._blur1FBO.dispose(),this._blur1FBO=null),this._blur0FBO&&(this._blur0FBO.dispose(),
this._blur0FBO=null),this._ssaoFBO&&(this._ssaoFBO.dispose(),this._ssaoFBO=null))};a.loadShaders=function(a,c,d){k.assert(null==a.samples);a._parse(e);var f=new p(d,a.vertexShaderShowDepth,a.fragmentShaderShowDepth,b.Default3D),g=a.createFsSSAOSrcObscurance,l=new p(d,a.vsUVQuad,g,b.Default3D,{NUM_TAP_SAMPLES:"8"}),m=new p(d,a.vsUVQuad,g,b.Default3D,{NUM_TAP_SAMPLES:"16"}),n=new p(d,a.vsUVQuad,g,b.Default3D,{NUM_TAP_SAMPLES:"32"}),g=new p(d,a.vsUVQuad,g,b.Default3D,{NUM_TAP_SAMPLES:"64"});a=new p(d,
a.vsUVQuad,a.fsBlurEdgeAware,b.Default3D,{RADIUS:(4).toString()});c.add("showDepth",f);c.add("ssao8",l);c.add("ssao16",m);c.add("ssao32",n);c.add("ssao64",g);c.add("blur",a)};return a}();var x=c.vec2d.create(),v=c.vec4d.create(),A=new Float32Array([0,0,0,0,512,0,1,0,0,512,0,1,512,512,1,1]);return h})},"esri/views/3d/webgl-engine/lib/tracer":function(){define(["require","exports","./webgl-debug","../../../webgl/capabilities/isWebGL2Context"],function(q,h,e,a){Object.defineProperty(h,"__esModule",{value:!0});
var d=null,b=[];h.enabled=!1;h.begin=function(){h.enabled&&(d=[])};h.trace=function(a){h.enabled&&null!=d&&d.push(a)};h.end=function(){if(h.enabled){var a=d;d=null;a&&(b.forEach(function(b){return b(a)}),b.length=0);return a}};h.instrumentContext=function(b){return h.enabled?a.default(b)?(console.warn("WebGL tracer is not supported on a WebGL2 Context"),b):e.makeDebugContext(b,void 0,function(a,b){h.enabled&&d&&d.push("gl."+a+"("+e.glFunctionArgsToString(a,b)+")")}):b};h.request=function(a){b.push(a)}})},
"esri/views/3d/webgl-engine/lib/webgl-debug":function(){define([],function(){function q(a){if(null==f){f={};k={};for(var b in a)"number"==typeof a[b]&&(f[a[b]]=b,k[b]=a[b])}}function h(){if(null==f)throw"WebGLDebugUtils.init(ctx) not called";}function e(a){h();var b=f[a];return void 0!==b?"gl."+b:"/*UNKNOWN WebGL ENUM*/ 0x"+a.toString(16)+""}function a(a,b,d,f){a=c[a];if(void 0!==a&&(a=a[b],void 0!==a&&a[d])){if("object"===typeof a[d]&&void 0!==a[d].enumBitwiseOr){b=a[d].enumBitwiseOr;d=0;a=[];for(var g=
0;g<b.length;++g){var l=k[b[g]];0!==(f&l)&&(d|=l,a.push(e(l)))}return d===f?a.join(" | "):e(f)}return e(f)}return null===f?"null":void 0===f?"undefined":f.toString()}function d(a,b,c){a.__defineGetter__(c,function(){return b[c]});a.__defineSetter__(c,function(a){b[c]=a})}function b(c,f,g,k){function l(a,b){return function(){g&&g(b,arguments);var c=a[b].apply(a,arguments),d=k.getError();0!=d&&(m[d]=!0,f(d,b,arguments));return c}}k=k||c;q(c);f=f||function(b,c,d){for(var f="",g=d.length,k=0;k<g;++k)f+=
(0==k?"":", ")+a(c,g,k,d[k]);b="WebGL error "+e(b)+" in "+c+"("+f+")";window.console&&window.console.error?window.console.error(b):window.console&&window.console.log&&window.console.log(b)};var m={},n={},h;for(h in c)if("function"==typeof c[h])if("getExtension"!=h)n[h]=l(c,h);else{var p=l(c,h);n[h]=function(){var a=p.apply(c,arguments);return b(a,f,g,k)}}else d(n,c,h);n.getError=function(){for(var a in m)if(m.hasOwnProperty(a)&&m[a])return m[a]=!1,a;return c.NO_ERROR};return n}function g(a){var b=
a.getParameter(a.MAX_VERTEX_ATTRIBS),c=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,c);for(var d=0;d<b;++d)a.disableVertexAttribArray(d),a.vertexAttribPointer(d,4,a.FLOAT,!1,0,0),a.vertexAttrib1f(d,0);a.deleteBuffer(c);b=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);for(d=0;d<b;++d)a.activeTexture(a.TEXTURE0+d),a.bindTexture(a.TEXTURE_CUBE_MAP,null),a.bindTexture(a.TEXTURE_2D,null);a.activeTexture(a.TEXTURE0);a.useProgram(null);a.bindBuffer(a.ARRAY_BUFFER,null);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null);
a.bindFramebuffer(a.FRAMEBUFFER,null);a.bindRenderbuffer(a.RENDERBUFFER,null);a.disable(a.BLEND);a.disable(a.CULL_FACE);a.disable(a.DEPTH_TEST);a.disable(a.DITHER);a.disable(a.SCISSOR_TEST);a.blendColor(0,0,0,0);a.blendEquation(a.FUNC_ADD);a.blendFunc(a.ONE,a.ZERO);a.clearColor(0,0,0,0);a.clearDepth(1);a.clearStencil(-1);a.colorMask(!0,!0,!0,!0);a.cullFace(a.BACK);a.depthFunc(a.LESS);a.depthMask(!0);a.depthRange(0,1);a.frontFace(a.CCW);a.hint(a.GENERATE_MIPMAP_HINT,a.DONT_CARE);a.lineWidth(1);a.pixelStorei(a.PACK_ALIGNMENT,
4);a.pixelStorei(a.UNPACK_ALIGNMENT,4);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);a.UNPACK_COLORSPACE_CONVERSION_WEBGL&&a.pixelStorei(a.UNPACK_COLORSPACE_CONVERSION_WEBGL,a.BROWSER_DEFAULT_WEBGL);a.polygonOffset(0,0);a.sampleCoverage(1,!1);a.scissor(0,0,a.canvas.width,a.canvas.height);a.stencilFunc(a.ALWAYS,0,4294967295);a.stencilMask(4294967295);a.stencilOp(a.KEEP,a.KEEP,a.KEEP);a.viewport(0,0,a.canvas.width,a.canvas.height);for(a.clear(a.COLOR_BUFFER_BIT|
a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT);a.getError(););}var c={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},
texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},
framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,
1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},f=null,k=null;return{init:q,mightBeEnum:function(a){h();return void 0!==f[a]},glEnumToString:e,glFunctionArgToString:a,glFunctionArgsToString:function(b,c){for(var d="",f=c.length,e=0;e<f;++e)d+=(0==e?"":", ")+a(b,f,e,c[e]);return d},makeDebugContext:b,
makeLostContextSimulatingCanvas:function(a){function b(a){return"function"==typeof a?a:function(b){a.handleEvent(b)}}function c(){for(var a=Object.keys(H),b=0;b<a.length;++b)delete H[a]}function f(){++J;B||E==J&&a.loseContext()}function e(a,b){var c=a[b];return function(){f();if(!B)return c.apply(a,arguments)}}function k(a){return{statusMessage:a,preventDefault:function(){F=!0}}}function n(a){for(var b in a)"function"==typeof a[b]?v[b]=e(a,b):d(v,a,b);v.getError=function(){f();if(!B)for(var a;a=h.getError();)H[a]=
!0;for(a in H)if(H[a])return delete H[a],a;return v.NO_ERROR};var c="createBuffer createFramebuffer createProgram createRenderbuffer createShader createTexture".split(" ");for(b=0;b<c.length;++b){var g=c[b];v[g]=function(b){return function(){f();if(B)return null;var c=b.apply(a,arguments);c.__webglDebugContextLostId__=C;q.push(c);return c}}(a[g])}c="getActiveAttrib getActiveUniform getBufferParameter getContextAttributes getAttachedShaders getFramebufferAttachmentParameter getParameter getProgramParameter getProgramInfoLog getRenderbufferParameter getShaderParameter getShaderInfoLog getShaderSource getTexParameter getUniform getUniformLocation getVertexAttrib".split(" ");
for(b=0;b<c.length;++b)g=c[b],v[g]=function(b){return function(){f();return B?null:b.apply(a,arguments)}}(v[g]);c="isBuffer isEnabled isFramebuffer isProgram isRenderbuffer isShader isTexture".split(" ");for(b=0;b<c.length;++b)g=c[b],v[g]=function(b){return function(){f();return B?!1:b.apply(a,arguments)}}(v[g]);v.checkFramebufferStatus=function(b){return function(){f();return B?v.FRAMEBUFFER_UNSUPPORTED:b.apply(a,arguments)}}(v.checkFramebufferStatus);v.getAttribLocation=function(b){return function(){f();
return B?-1:b.apply(a,arguments)}}(v.getAttribLocation);v.getVertexAttribOffset=function(b){return function(){f();return B?0:b.apply(a,arguments)}}(v.getVertexAttribOffset);v.isContextLost=function(){return B};return v}var h,v,A=[],y=[];v={};var C=1,B=!1,q=[],E=0,J=0,F=!1,M=0,H={};a.getContext=function(b){return function(){var c=b.apply(a,arguments);if(c instanceof WebGLRenderingContext){if(c!=h){if(h)throw"got different context";h=c;v=n(h)}return v}return c}}(a.getContext);(function(a){var c=a.addEventListener;
a.addEventListener=function(d,f,e){switch(d){case "webglcontextlost":A.push(b(f));break;case "webglcontextrestored":y.push(b(f));break;default:c.apply(a,arguments)}}})(a);a.loseContext=function(){if(!B){B=!0;E=0;for(++C;h.getError(););c();H[h.CONTEXT_LOST_WEBGL]=!0;var b=k("context lost"),d=A.slice();setTimeout(function(){for(var c=0;c<d.length;++c)d[c](b);0<=M&&setTimeout(function(){a.restoreContext()},M)},0)}};a.restoreContext=function(){B&&y.length&&setTimeout(function(){if(!F)throw"can not restore. webglcontestlost listener did not call event.preventDefault";
for(var a=0;a<q.length;++a){var b=q[a];b instanceof WebGLBuffer?h.deleteBuffer(b):b instanceof WebGLFramebuffer?h.deleteFramebuffer(b):b instanceof WebGLProgram?h.deleteProgram(b):b instanceof WebGLRenderbuffer?h.deleteRenderbuffer(b):b instanceof WebGLShader?h.deleteShader(b):b instanceof WebGLTexture&&h.deleteTexture(b)}g(h);B=!1;J=0;F=!1;for(var a=y.slice(),b=k("context restored"),c=0;c<a.length;++c)a[c](b)},0)};a.loseContextInNCalls=function(a){if(B)throw"You can not ask a lost contet to be lost";
E=J+a};a.getNumCalls=function(){return J};a.setRestoreTimeout=function(a){M=a};return a},resetToInitialState:g}})},"esri/views/webgl/capabilities/isWebGL2Context":function(){define(["require","exports"],function(q,h){Object.defineProperty(h,"__esModule",{value:!0});h.default=function(e){return window.WebGL2RenderingContext&&e instanceof window.WebGL2RenderingContext}})},"esri/views/3d/webgl-engine/materials/repository":function(){define("require exports dojo/text!./internal/hud.xml dojo/text!./internal/util.xml ../lib/edgeRendering/EdgeView ./CheckerBoardMaterial ./ColorMaterial ./DefaultMaterial ./HUDMaterial ./LineCalloutMaterial ./MeasurementArrowMaterial ./RibbonLineMaterial ./internal/BlendLayers ./internal/SimpleGLMaterial ./internal/TexOnlyGLMaterial".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r){Object.defineProperty(h,"__esModule",{value:!0});h.initializeShaders=function(h,u,x){h._parse(a);h._parse(e);m.loadShaders(h,u,x);r.loadShaders(h,u,x);c.loadShaders(h,u,x);f.loadShaders(h,u,x);k.loadShaders(h,u,x);l.loadShaders(h,u,x);p.loadShaders(h,u,x);g.loadShaders(h,u,x);n.loadShaders(h,u,x);d.EdgeView.loadShaders(h,u,x);b.loadShaders(h,u,x)}})},"esri/views/3d/webgl-engine/materials/CheckerBoardMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/text!./CheckerBoardMaterial.xml ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/ShaderVariations ../lib/Util ./internal/MaterialUtil ./internal/MaterialUtil".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n){var l=[{name:f.VertexAttrConstants.POSITION,count:3,type:5126,offset:0,stride:20,normalized:!1},{name:f.VertexAttrConstants.UV0,count:2,type:5126,offset:12,stride:20,normalized:!1}],p={size:[1,1],color1:[.75,.75,.75,1],color2:[.5,.5,.5,1],transparent:!1,polygonOffset:!1};q=function(b){function d(a,c){c=b.call(this,c)||this;c.canBeMerged=!1;c.params=k.copyParameters(a,p);return c}e(d,b);d.prototype.dispose=function(){};d.prototype.getParameterValues=function(){var a=
this.params;return{size:a.size,color1:a.color1,color2:a.color2,transparent:a.transparent,polygonOffset:a.polygonOffset}};d.prototype.setParameterValues=function(a){k.updateParameters(this.params,a)&&this.notifyDirty("matChanged")};d.prototype.getParams=function(){return this.params};d.prototype.getOutputAmount=function(a){return 5*a};d.prototype.getInstanceBufferLayout=function(){};d.prototype.getVertexBufferLayout=function(){return l};d.prototype.fillInterleaved=function(a,b,c,d,f,e){n.fillInterleaved(a,
b,c,d,l,f,e)};d.prototype.intersect=function(a,b,c,d,f,e,g,k){return n.intersectTriangleGeometry(a,b,c,d,f,e,g)};d.prototype.getGLMaterials=function(){return{color:m,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:void 0}};d.prototype.getAllTextureIds=function(){return[]};d.loadShaders=function(b,d,f){b._parse(a);b=new c("checker-board",["vsCheckerBoard","fsCheckerBoard"],null,d,b,f);d.addShaderVariations("checker-board-material-shader-variations",b)};return d}(b);var m=function(a){function b(b,
c,d){d=a.call(this,b,c)||this;d.programRep=c;d.params=k.copyParameters(b.getParams());d.selectProgram();return d}e(b,a);b.prototype.selectProgram=function(){this.program=this.programRep.getShaderVariationsProgram("checker-board-material-shader-variations",[])};b.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram()};b.prototype.beginSlot=function(a){return a===(this.params.transparent?g.TRANSPARENT_MATERIAL:g.OPAQUE_MATERIAL)};b.prototype.getProgram=
function(){return this.program};b.prototype.getDrawMode=function(a){return a.gl.TRIANGLES};b.prototype.bind=function(a,b){b=this.program;a.setDepthTestEnabled(!0);a.setDepthWriteEnabled(!1);a.setFaceCullingEnabled(!1);this.params.transparent&&(a.setBlendingEnabled(!0),a.setBlendFunctionSeparate(a.gl.SRC_ALPHA,a.gl.ONE_MINUS_SRC_ALPHA,a.gl.ONE,a.gl.ONE_MINUS_SRC_ALPHA));this.params.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(0,-25));a.bindProgram(b);b.setUniform2fv("size",
this.params.size);b.setUniform4fv("color1",this.params.color1);b.setUniform4fv("color2",this.params.color2)};b.prototype.bindView=function(a,b){a=b.origin;var c=this.getProgram();k.bindView(a,b.view,c)};b.prototype.bindInstance=function(a,b){this.getProgram().setUniformMatrix4fv("model",b.transformation)};b.prototype.release=function(a){a.setDepthWriteEnabled(!0);this.params.transparent&&a.setBlendingEnabled(!1);this.params.polygonOffset&&a.setPolygonOffsetFillEnabled(!1)};return b}(d);return q})},
"esri/views/3d/webgl-engine/materials/ColorMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/text!./ColorMaterial.xml ../lib/DefaultVertexBufferLayouts ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/ShaderVariations ../lib/Util ./internal/MaterialUtil ../../../webgl/Util".split(" "),function(q,h,e,a,d,b,g,c,f,k,n,l){var p=d.Pos3Col,m=l.getStride(p)/4,r={color:[1,1,1,1],transparent:!1,vertexColors:!1,polygonOffset:!1};q=function(b){function c(a,
c){c=b.call(this,c)||this;c.supportsEdges=!0;c.params=n.copyParameters(a,r);return c}e(c,b);c.prototype.getParams=function(){return this.params};c.prototype.getParameterValues=function(){return n.copyParameters(this.params)};c.prototype.setColor=function(a){this.params.color=a;this.notifyDirty("matChanged")};c.prototype.getColor=function(){return this.params.color};c.prototype.setTransparent=function(a){this.params.transparent=a;this.notifyDirty("matChanged")};c.prototype.getTransparent=function(){return this.params.transparent};
c.prototype.getOutputAmount=function(a){return a*m*1};c.prototype.getVertexBufferLayout=function(){return p};c.prototype.getInstanceBufferLayout=function(){};c.prototype.fillInterleaved=function(a,b,c,d,f,e,g){n.fillInterleaved(a,b,c,d,p,f,e,g)};c.prototype.intersect=function(a,b,c,d,f,e,g,k){n.intersectTriangleGeometry(a,b,c,d,f,e,g)};c.prototype.getGLMaterials=function(){return{color:t,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:u}};c.prototype.getAllTextureIds=function(){return[]};
c.loadShaders=function(b,c,d){b._parse(a);b=new f("colorMaterial",["vertexShaderColorMaterial","fragmentShaderColorMaterial"],null,c,b,d);b.addDefine("Color","VERTEXCOLORS");c.addShaderVariations("colorMaterial",b)};return c}(g);var t=function(a){function b(b,c,d){b=a.call(this,b,c)||this;b.updateParameters();return b}e(b,a);b.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram()};b.prototype.selectProgram=function(){this.program=this.programRep.getShaderVariationsProgram("colorMaterial",
[this.params.vertexColors])};b.prototype.beginSlot=function(a){return a===(1>this.params.color[3]?c.TRANSPARENT_MATERIAL:c.OPAQUE_MATERIAL)};b.prototype.getProgram=function(){return this.program};b.prototype.bind=function(a,b){b=this.program;var c=this.params;a.bindProgram(b);b.setUniform4fv("eColor",c.color);a.setFaceCullingEnabled(!1);c.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(1,1));c.transparent&&(a.setBlendingEnabled(!0),a.setBlendFunctionSeparate(a.gl.SRC_ALPHA,a.gl.ONE_MINUS_SRC_ALPHA,
a.gl.ONE,a.gl.ONE_MINUS_SRC_ALPHA));a.setDepthTestEnabled(!0)};b.prototype.release=function(a){var b=this.params;a.setPolygonOffsetFillEnabled(!1);b.transparent&&a.setBlendingEnabled(!1)};b.prototype.bindView=function(a,b){n.bindView(b.origin,b.view,this.program)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(a){return a.gl.TRIANGLES};return b}(b),u=function(a){function b(b,c,d){b=a.call(this,b,c)||this;b.updateParameters();
return b}e(b,a);b.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram()};b.prototype.selectProgram=function(){this.program=this.programRep.getShaderVariationsProgram("colorMaterial",[this.params.vertexColors])};b.prototype.beginSlot=function(a){return a===c.OPAQUE_MATERIAL};b.prototype.getProgram=function(){return this.program};b.prototype.bind=function(a,b){b=this.program;var c=this.params;a.bindProgram(b);b.setUniform4fv("eColor",c.color);a.setFaceCullingEnabled(!1);
c.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(1,1))};b.prototype.release=function(a){a.setPolygonOffsetFillEnabled(!1)};b.prototype.bindView=function(a,b){n.bindView(b.origin,b.view,this.program)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(a){return a.gl.TRIANGLES};return b}(b);return q})},"esri/views/3d/webgl-engine/materials/DefaultMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/has dojo/text!./DefaultMaterial.xml ../../layers/graphics/graphicUtils ../../support/buffer/glUtil ../../support/buffer/InterleavedLayout ../lib/DefaultVertexAttributeLocations ../lib/gl-matrix ../lib/GLMaterialTexture ../lib/Material ../lib/RenderSlot ../lib/ShaderVariations ../lib/Util ./internal/MaterialUtil ../../../webgl/Program ../../../webgl/Util".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u,x){function v(a,b){var c=a.gl;(b.cullFace?"none"===b.cullFace:b.transparent)?a.setFaceCullingEnabled(!1):(a.setFaceCullingEnabled(!0),"front"===b.cullFace&&a.setCullFace(c.FRONT))}function A(a,b){var c=a.gl;(b.cullFace?"none"===b.cullFace:b.transparent)?a.setFaceCullingEnabled(!0):(a.setFaceCullingEnabled(!1),"front"===b.cullFace&&a.setCullFace(c.BACK))}function y(a,b){return a?p.TRANSPARENT_MATERIAL:b?p.STENCIL_MATERIAL:p.OPAQUE_MATERIAL}function C(a,c){var d=
c.vvSizeEnabled;c.vvSizeEnabled?(a.setUniform3fv("vvSizeMinSize",c.vvSizeMinSize),a.setUniform3fv("vvSizeMaxSize",c.vvSizeMaxSize),a.setUniform3fv("vvSizeOffset",c.vvSizeOffset),a.setUniform3fv("vvSizeFactor",c.vvSizeFactor)):d&&a.setUniform3fv("vvSizeValue",c.vvSizeValue);d&&(a.setUniform3fv("vvSymbolAnchor",c.vvSymbolAnchor),b.computeObjectRotation(c.vvSymbolRotation[2],c.vvSymbolRotation[0],c.vvSymbolRotation[1],F.identity(X)),a.setUniformMatrix3fv("vvSymbolRotation",F.toMat3(X,G)));c.vvColorEnabled&&
(a.setUniform1fv("vvColorValues",c.vvColorValues),a.setUniform4fv("vvColorColors",c.vvColorColors))}function B(a,b){a.vvSizeEnabled=b.vvSizeEnabled;a.vvSizeMinSize=b.vvSizeMinSize;a.vvSizeMaxSize=b.vvSizeMaxSize;a.vvSizeOffset=b.vvSizeOffset;a.vvSizeFactor=b.vvSizeFactor;a.vvSizeValue=b.vvSizeValue;a.vvSymbolAnchor=b.vvSymbolAnchor;a.vvSymbolRotation=b.vvSymbolRotation}var D=k.vec3d,E=k.vec4d,J=k.mat3d,F=k.mat4d,M=r.assert;q=function(a){function b(c,d){d=a.call(this,d)||this;d.supportsEdges=!0;d.params=
t.copyParameters(c,L);d.instanced=!!c.instanced;d.vertexBufferLayout=b.getVertexBufferLayout(d.params);d.instanceBufferLayout=d.instanced?b.getInstanceBufferLayout(d.params):null;return d}e(b,a);b.prototype.isVisible=function(){var b=this.params;if(!a.prototype.isVisible.call(this)||0===b.layerOpacity)return!1;var c=U&&b.instanced,d=b.vertexColors,f=b.symbolColors,c=!!c&&-1<c.indexOf("color"),e=b.vvColorEnabled,g="replace"===b.colorMixMode,k=0<b.opacity,b=b.externalColor&&0<b.externalColor[3];return d&&
(c||e||f)?g?!0:k:d?g?b:k:c||e||f?g?!0:k:g?b:k};b.prototype.getParams=function(){return this.params};b.prototype.getParameterValues=function(){var a=this.params;return{textureId:a.textureId,ambient:a.ambient,diffuse:a.diffuse,specular:a.specular,externalColor:a.externalColor,colorMixMode:a.colorMixMode,opacity:a.opacity,layerOpacity:a.layerOpacity,transparent:a.transparent,polygonOffset:a.polygonOffset,atlasRegions:a.atlasRegions,flipV:a.flipV,doubleSided:a.doubleSided,doubleSidedType:a.doubleSidedType,
cullFace:a.cullFace,writeStencil:a.writeStencil,receiveSSAO:a.receiveSSAO,castShadows:a.castShadows,verticalOffset:a.verticalOffset,screenSizePerspective:a.screenSizePerspective,vvSizeEnabled:a.vvSizeEnabled,vvSizeMinSize:a.vvSizeMinSize,vvSizeMaxSize:a.vvSizeMaxSize,vvSizeOffset:a.vvSizeOffset,vvSizeFactor:a.vvSizeFactor,vvSizeValue:a.vvSizeValue,vvColorEnabled:a.vvColorEnabled,vvColorValues:a.vvColorValues,vvColorColors:a.vvColorColors,instancedDoublePrecision:a.instancedDoublePrecision,compressedNormals:a.compressedNormals,
groundNormalShading:a.groundNormalShading,vvSymbolAnchor:a.vvSymbolAnchor,vvSymbolRotation:a.vvSymbolRotation}};b.prototype.setParameterValues=function(a){var b=this.params,c;for(c in a)"textureId"===c&&M(b.textureId,"Can only change texture of material that already has a texture"),"castShadows"===c&&M(a.castShadows===b.castShadows,"Can not change shadow casting behavior."),b[c]=a[c];this.notifyDirty("matChanged")};b.prototype.getOutputAmount=function(a){var b=x.getStride(this.vertexBufferLayout)/
4;return a*b};b.prototype.getVertexBufferLayout=function(){return this.vertexBufferLayout};b.prototype.getInstanceBufferLayout=function(){return this.instanceBufferLayout};b.prototype.fillInterleaved=function(a,b,c,d,f,e,g){t.fillInterleaved(a,b,c,d,this.vertexBufferLayout,f,e,g)};b.prototype.intersect=function(a,b,c,d,f,e,g,k){if(null!==this.params.verticalOffset){k=d.camera;D.set3(c[12],c[13],c[14],ba);var l=D.subtract(ba,k.eye,ca),m=D.length(l),n=D.scale(l,1/m),h=null,l=null;switch(d.viewingMode){case "global":l=
D.normalize(ba,R);break;case "local":l=D.set(fa,R)}this.params.screenSizePerspective&&(h=D.dot(l,n));k=t.verticalOffsetAtDistance(k,m,this.params.verticalOffset,h,this.params.screenSizePerspective);D.scale(l,k);J.multiplyVec3(d.transformInverseRotation,l,da);f=D.subtract(f,da,Z);e=D.subtract(e,da,ea)}t.intersectTriangleGeometry(a,b,c,d,f,e,g)};b.prototype.getGLMaterials=function(){return{color:H,depthShadowMap:this.params.castShadows?K:null,normal:O,depth:I,highlight:P}};b.prototype.getAllTextureIds=
function(){var a=this.params,b=[];a.textureId&&b.push(a.textureId);return b};b.loadShaders=function(a,b,c){a._parse(d);U=null!==c.capabilities.instancing;var e=new m("phong",["vsPhong","fsPhong"],null,b,a,c);e.addNaryShaderSnippetSuffix([{value:"none",programNameSuffix:"",shaderSnippetSuffix:""},{value:"Textured"},{value:"AtlasTextured"}]);e.addDefine("Color","VERTEXCOLORS");e.addDefine("symbolColor","SYMBOLVERTEXCOLORS");e.addDefine("FlipV","FLIPV");e.addDefine("DoubleSided","DOUBLESIDED");e.addDefine("WindingOrderDoubleSided",
"WINDINGORDERDOUBLESIDED");e.addDefine("Instanced","INSTANCED");e.addDefine("instancedDoublePrecision","INSTANCED_DOUBLE_PRECISION");e.addDefine("InstColor","INSTANCEDCOLOR");e.addDefine("ReceiveShadows","RECEIVE_SHADOWS");e.addDefine("ReceiveSSAO","RECEIVE_SSAO");e.addDefine("vvSize","VV_SIZE");e.addDefine("vvColor","VV_COLOR");e.addDefine("VerticalOffset","VERTICAL_OFFSET");e.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");e.addDefine("groundNormalShading","GROUND_NORMAL_SHADING");
e.addDefine("compressedNormals","COMPRESSED_NORMALS");e.addDefine("componentColor","COMPONENTCOLORS");e.addDefine("transparencyDiscard","TRANSPARENCY_DISCARD");e.addDefine("alphaCoverageCorrection","ALPHA_COVERAGE_CORRECTION");b.addShaderVariations(S,e);e=new m("depth",["vsDepth","fsDepth"],null,b,a,c);e.addNaryShaderSnippetSuffix([{value:"none",programNameSuffix:"",shaderSnippetSuffix:""},{value:"Textured"},{value:"AtlasTextured"}]);e.addDefine("FlipV","FLIPV");e.addDefine("Instanced","INSTANCED");
e.addDefine("instancedDoublePrecision","INSTANCED_DOUBLE_PRECISION");e.addDefine("ShadowMap","BIAS_SHADOWMAP");e.addDefine("vvSize","VV_SIZE");e.addDefine("VerticalOffset","VERTICAL_OFFSET");e.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");e.addDefine("transparencyDiscard","TRANSPARENCY_DISCARD");e.addDefine("alphaCoverageCorrection","ALPHA_COVERAGE_CORRECTION");b.addShaderVariations(aa,e);e=new m("normal",["vsNormal","fsNormal"],null,b,a,c);e.addNaryShaderSnippetSuffix([{value:"none",
programNameSuffix:"",shaderSnippetSuffix:""},{value:"Textured"},{value:"AtlasTextured"}]);e.addDefine("FlipV","FLIPV");e.addDefine("Instanced","INSTANCED");e.addDefine("instancedDoublePrecision","INSTANCED_DOUBLE_PRECISION");e.addDefine("vvSize","VV_SIZE");e.addDefine("VerticalOffset","VERTICAL_OFFSET");e.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");e.addDefine("compressedNormals","COMPRESSED_NORMALS");e.addDefine("transparencyDiscard","TRANSPARENCY_DISCARD");e.addDefine("alphaCoverageCorrection",
"ALPHA_COVERAGE_CORRECTION");b.addShaderVariations(V,e);e=new m("highlight",["vsHighlight","fsHighlight"],null,b,a,c);e.addNaryShaderSnippetSuffix([{value:"none",programNameSuffix:"",shaderSnippetSuffix:""},{value:"Textured"},{value:"AtlasTextured"}]);e.addDefine("FlipV","FLIPV");e.addDefine("Instanced","INSTANCED");e.addDefine("instancedDoublePrecision","INSTANCED_DOUBLE_PRECISION");e.addDefine("vvSize","VV_SIZE");e.addDefine("VerticalOffset","VERTICAL_OFFSET");e.addDefine("screenSizePerspective",
"SCREEN_SIZE_PERSPECTIVE");e.addDefine("transparencyDiscard","TRANSPARENCY_DISCARD");e.addDefine("alphaCoverageCorrection","ALPHA_COVERAGE_CORRECTION");b.addShaderVariations(T,e);var e=new u(c,a.vsDepth,a.fsDepth,f.Default3D,["BIAS_SHADOWMAP 1"]),g=new u(c,a.vsDepthTextured,a.fsDepthTextured,f.Default3D,["BIAS_SHADOWMAP 1"]),k=new u(c,a.vsDepth,a.fsDepth,f.Default3D),l=new u(c,a.vsDepthTextured,a.fsDepthTextured,f.Default3D),n=new u(c,a.vsNormal,a.fsNormal,f.Default3D),h=new u(c,a.vsNormalTextured,
a.fsNormalTextured,f.Default3D),p=new u(c,a.vsHighlight,a.fsHighlight,f.Default3D);a=new u(c,a.vsHighlightTextured,a.fsHighlightTextured,f.Default3D);b.add("depthShadowMap",e);b.add("depthTexturedShadowMap",g);b.add("depth",k);b.add("depthTextured",l);b.add("normal",n);b.add("normalTextured",h);b.add("highlight",p);b.add("highlightTextured",a)};b.getVertexBufferLayout=function(a){var b=c.newLayout().vec3f("position");a.groundNormalShading||(b=a.compressedNormals?b.vec2i16("normalCompressed",{glNormalized:!0}):
b.vec3f("normal"));a.textureId&&(b=b.vec2f("uv0"),a.atlasRegions&&(b=b.vec4u16("region")));a.vertexColors&&(b=b.vec4u8("color"));a.symbolColors&&(b=b.vec4u8("symbolColor"));a.componentIndices&&(b=b.u16("componentIndex").u16("_padding",{glPadding:!0}));return g.glLayout(b)};b.getInstanceBufferLayout=function(a){var b=c.newLayout(),b=a.instancedDoublePrecision?b.vec3f("modelOriginHi").vec3f("modelOriginLo").mat3f("model").mat3f("modelNormal"):b.mat4f("model").mat4f("modelNormal");a.instanced&&-1<a.instanced.indexOf("color")&&
(b=b.vec4f("instanceColor"));a.instanced&&-1<a.instanced.indexOf("featureAttribute")&&(b=b.vec4f("instanceFeatureAttribute"));return g.glLayout(b,{divisor:1})};return b}(l);var H=function(a){function b(b,c,d){c=a.call(this,b,c,d,b.getParams().textureId)||this;c.programs=[[null,null],[null,null]];c.params=t.copyParameters(b.getParams());c.slot=y(c.params.transparent,c.params.writeStencil);b=c.params;c.texturing=b.textureId?b.atlasRegions?"AtlasTextured":"Textured":"none";d=U&&b.instanced;c.instanced=
!!d;c.instancedColor=!!d&&-1<d.indexOf("color");c.pseudoInstancedColor=!U&&b.instanced&&-1<b.instanced.indexOf("color");c._loadPrograms();return c}e(b,a);b.prototype._loadPrograms=function(){this.programs[0][0]=this._loadProgram(!1,!1);this.programs[1][0]=this._loadProgram(!0,!1);this.params.receiveSSAO?(this.programs[0][1]=this._loadProgram(!1,!0),this.programs[1][1]=this._loadProgram(!0,!0),this.allPrograms=this.programs[0].concat(this.programs[1])):(this.programs[0][1]=this.programs[0][0],this.programs[1][1]=
this.programs[1][0],this.allPrograms=[this.programs[0][0],this.programs[1][0]])};b.prototype._loadProgram=function(a,b){var c=this.params;return this.programRep.getShaderVariationsProgram(S,[this.texturing,c.vertexColors,c.symbolColors,c.flipV,c.doubleSided&&"normal"===c.doubleSidedType,c.doubleSided&&"winding-order"===c.doubleSidedType,!!this.instanced,c.instancedDoublePrecision,this.instancedColor,a,b,c.vvSizeEnabled,c.vvColorEnabled,null!==c.verticalOffset,null!==c.screenSizePerspective,c.groundNormalShading,
c.compressedNormals,null!=c.componentColorBuffer,c.transparent,N])};b.prototype.beginSlot=function(a){return a===this.slot};b.prototype.getProgram=function(){return this.program||this.programs[0][0]};b.prototype.getPrograms=function(){return this.allPrograms};b.prototype.updateParameters=function(){var a=this.material.getParams(),b=this.params;b.ambient=a.ambient;b.diffuse=a.diffuse;b.specular=a.specular;b.externalColor=a.externalColor;b.colorMixMode=a.colorMixMode;b.opacity=a.opacity;b.layerOpacity=
a.layerOpacity;b.polygonOffset=a.polygonOffset;b.flipV=a.flipV;b.doubleSided=a.doubleSided;b.doubleSidedType=a.doubleSidedType;b.cullFace=a.cullFace;b.receiveSSAO=a.receiveSSAO;b.castShadows=a.castShadows;b.verticalOffset=a.verticalOffset;b.screenSizePerspective=a.screenSizePerspective;B(b,a);b.vvColorEnabled=a.vvColorEnabled;b.vvColorValues=a.vvColorValues;b.vvColorColors=a.vvColorColors;b.transparent!==a.transparent&&(this.slot=y(a.transparent,a.writeStencil),b.transparent=a.transparent);b.instancedDoublePrecision=
a.instancedDoublePrecision;b.compressedNormals=a.compressedNormals;b.groundNormalShading=a.groundNormalShading;this.updateTexture(a.textureId);a.atlasRegions&&(b.atlasRegions=a.atlasRegions);b.blendModeOneOne=a.blendModeOneOne;b.inverseWindingOrder=a.inverseWindingOrder;this._loadPrograms()};b.prototype.bind=function(a,b){var c=a.gl,d=this.params,f=this.program=this.programs[b.shadowMappingEnabled?1:0][b.ssaoEnabled?1:0];a.bindProgram(f);f.setUniform3fv("ambient",d.ambient);f.setUniform3fv("diffuse",
d.diffuse);f.setUniform3fv("specular",d.specular);f.setUniform4fv("externalColor",d.externalColor);f.setUniform1i("colorMixMode",t.colorMixModes[d.colorMixMode]);f.setUniform1f("opacity",d.opacity);f.setUniform1f("layerOpacity",d.layerOpacity);t.bindVerticalOffset(d.verticalOffset,b,f);t.bindScreenSizePerspective(d.screenSizePerspective,f);C(f,d);this.bindTexture(a,f);"none"!==this.texturing&&this.bindTextureSize(a,f);a.setBlendFunctionSeparate(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA);
d.inverseWindingOrder&&a.setFrontFace(c.CW);d.transparent?(a.setBlendingEnabled(!0),d.blendModeOneOne?(a.setBlendFunction(c.ONE,c.ONE),a.setDepthWriteEnabled(!1)):a.setBlendFunctionSeparate(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA)):a.setBlendingEnabled(!1);d.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(2,2));v(a,d);a.setDepthTestEnabled(!0);d.componentIndices&&d.componentColorBuffer&&(d.componentColorBuffer.updateTexture(),d.componentColorBuffer.bind(f,
{texName:"uComponentColorTex",invDimName:"uComponentColorTexInvDim",unit:1}))};b.prototype.release=function(a,b){b=a.gl;a.setPolygonOffsetFillEnabled(!1);A(a,this.params);a.setBlendingEnabled(!1);a.setBlendFunctionSeparate(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA,b.ONE,b.ONE_MINUS_SRC_ALPHA);a.setDepthWriteEnabled(!0);a.setFrontFace(b.CCW)};b.prototype.bindView=function(a,b){a=this.program=this.programs[b.shadowMappingEnabled?1:0][b.ssaoEnabled?1:0];var c=this.params,d=c.instancedDoublePrecision?[b.viewInvTransp[3],
b.viewInvTransp[7],b.viewInvTransp[11]]:b.origin;t.bindView(d,b.view,a);t.bindCamPos(d,b.viewInvTransp,a);c.instancedDoublePrecision&&t.bindViewOriginDouble(d,a);b.shadowMappingEnabled&&b.shadowMap.bindView(a,d)};b.prototype.bindInstance=function(a,b){a=this.program;a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal);b.instanceParameters&&this.pseudoInstancedColor&&(b=b.instanceParameters.color)&&(E.multiply(b,this.params.externalColor,Q),a.setUniform4fv("externalColor",
Q))};b.prototype.getDrawMode=function(a){return a.gl.TRIANGLES};return b}(n),I=function(a){function b(b,c,d,f){void 0===f&&(f=!1);d=a.call(this,b,c,d,b.getParams().textureId)||this;d.params=t.copyParameters(b.getParams());d.instanced=U&&!!d.params.instanced;d.texturing=x.hasAttribute(b.getVertexBufferLayout(),"uv0")?"Textured":"none";d.program=c.getShaderVariationsProgram(aa,[d.texturing,d.params.flipV,d.instanced,d.params.instancedDoublePrecision,f,d.params.vvSizeEnabled,null!==d.params.verticalOffset,
null!==d.params.screenSizePerspective,d.params.transparent,N]);d.slot=y(d.params.transparent,d.params.writeStencil);return d}e(b,a);b.prototype.beginSlot=function(a){return a===this.slot};b.prototype.getProgram=function(){return this.program};b.prototype.updateParameters=function(){var a=this.material.getParams(),b=this.params;b.cullFace=a.cullFace;b.inverseWindingOrder=a.inverseWindingOrder;b.flipV=a.flipV;B(b,a);this.updateTexture(a.textureId);b.instancedDoublePrecision=a.instancedDoublePrecision};
b.prototype.bind=function(a,b){var c=a.gl,d=this.program,f=this.params;a.bindProgram(d);d.setUniform2fv("nearFar",b.nearFar);f.inverseWindingOrder&&a.setFrontFace(c.CW);t.bindVerticalOffset(f.verticalOffset,b,d);t.bindScreenSizePerspective(f.screenSizePerspective,d);C(d,f);this.bindTexture(a,d);v(a,f);a.setDepthTestEnabled(!0)};b.prototype.release=function(a){var b=a.gl,c=this.params;A(a,c);c.inverseWindingOrder&&a.setFrontFace(b.CCW)};b.prototype.bindView=function(a,b){a=this.program;var c=this.params,
d=c.instancedDoublePrecision?[b.viewInvTransp[3],b.viewInvTransp[7],b.viewInvTransp[11]]:b.origin;t.bindView(d,b.view,a);c.screenSizePerspective&&t.bindCamPos(d,b.viewInvTransp,a);c.instancedDoublePrecision&&t.bindViewOriginDouble(d,a)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(a){return a.gl.TRIANGLES};return b}(n),K=function(a){function b(b,c,d){return a.call(this,b,c,d,!0)||this}e(b,a);return b}(I),O=function(a){function b(b,
c,d,f){void 0===f&&(f=!1);d=a.call(this,b,c,d,b.getParams().textureId)||this;d.params=t.copyParameters(b.getParams());d.instanced=U&&!!d.params.instanced;d.texturing=x.hasAttribute(b.getVertexBufferLayout(),"uv0")?"Textured":"none";d.program=c.getShaderVariationsProgram(V,[d.texturing,d.params.flipV,d.instanced,d.params.instancedDoublePrecision,d.params.vvSizeEnabled,null!==d.params.verticalOffset,null!==d.params.screenSizePerspective,d.params.compressedNormals,d.params.transparent,N]);d.slot=y(d.params.transparent,
d.params.writeStencil);return d}e(b,a);b.prototype.beginSlot=function(a){return a===this.slot};b.prototype.getProgram=function(){return this.program};b.prototype.updateParameters=function(){var a=this.material.getParams(),b=this.params;b.cullFace=a.cullFace;b.inverseWindingOrder=a.inverseWindingOrder;b.flipV=a.flipV;B(b,a);this.updateTexture(a.textureId);b.instancedDoublePrecision=a.instancedDoublePrecision};b.prototype.bind=function(a,b){var c=a.gl,d=this.program,f=this.params;a.bindProgram(d);this.bindTexture(a,
d);t.bindVerticalOffset(f.verticalOffset,b,d);t.bindScreenSizePerspective(f.screenSizePerspective,d);C(d,f);v(a,f);f.inverseWindingOrder&&a.setFrontFace(c.CW);a.setDepthTestEnabled(!0)};b.prototype.release=function(a){var b=a.gl,c=this.params;A(a,c);c.inverseWindingOrder&&a.setFrontFace(b.CCW)};b.prototype.bindView=function(a,b){a=this.program;var c=this.params,d=c.instancedDoublePrecision?[b.viewInvTransp[3],b.viewInvTransp[7],b.viewInvTransp[11]]:b.origin;t.bindView(d,b.view,a);a.setUniformMatrix4fv("viewNormal",
b.viewInvTransp);c.screenSizePerspective&&t.bindCamPos(d,b.viewInvTransp,a);c.instancedDoublePrecision&&t.bindViewOriginDouble(d,a)};b.prototype.bindInstance=function(a,b){a=this.program;a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};b.prototype.getDrawMode=function(a){return a.gl.TRIANGLES};return b}(n),P=function(a){function b(b,c,d,f){void 0===f&&(f=!1);d=a.call(this,b,c,d,b.getParams().textureId)||this;d.params=t.copyParameters(b.getParams());
d.instanced=U&&!!d.params.instanced;d.texturing=x.hasAttribute(b.getVertexBufferLayout(),"uv0")?"Textured":"none";d.program=c.getShaderVariationsProgram(T,[d.texturing,d.params.flipV,d.instanced,d.params.instancedDoublePrecision,d.params.vvSizeEnabled,null!==d.params.verticalOffset,null!==d.params.screenSizePerspective,d.params.transparent,N]);d.slot=y(d.params.transparent,d.params.writeStencil);return d}e(b,a);b.prototype.beginSlot=function(a){return a===this.slot};b.prototype.getProgram=function(){return this.program};
b.prototype.updateParameters=function(){var a=this.material.getParams(),b=this.params;b.cullFace=a.cullFace;b.inverseWindingOrder=a.inverseWindingOrder;b.flipV=a.flipV;B(b,a);this.updateTexture(a.textureId);b.instancedDoublePrecision=a.instancedDoublePrecision};b.prototype.bind=function(a,b){var c=a.gl,d=this.program,f=this.params;a.bindProgram(d);this.bindTexture(a,d);t.bindVerticalOffset(f.verticalOffset,b,d);t.bindScreenSizePerspective(f.screenSizePerspective,d);C(d,f);v(a,f);f.inverseWindingOrder&&
a.setFrontFace(c.CW);a.setDepthTestEnabled(!0)};b.prototype.release=function(a){var b=a.gl,c=this.params;A(a,c);c.inverseWindingOrder&&a.setFrontFace(b.CW)};b.prototype.bindView=function(a,b){a=this.program;var c=this.params,d=c.instancedDoublePrecision?[b.viewInvTransp[3],b.viewInvTransp[7],b.viewInvTransp[11]]:b.origin;t.bindView(d,b.view,a);c.screenSizePerspective&&t.bindCamPos(d,b.viewInvTransp,a);c.instancedDoublePrecision&&t.bindViewOriginDouble(d,a)};b.prototype.bindInstance=function(a,b){a=
this.program;a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};b.prototype.getDrawMode=function(a){return a.gl.TRIANGLES};return b}(n),L={textureId:void 0,ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,0],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,blendModeOneOne:!1,inverseWindingOrder:!1,vertexColors:!1,symbolColors:!1,componentIndices:!1,componentColorBuffer:null,flipV:!1,doubleSided:!1,doubleSidedType:"normal",
cullFace:void 0,instanced:void 0,instancedDoublePrecision:!1,compressedNormals:!1,groundNormalShading:!1,writeStencil:!1,receiveSSAO:!0,castShadows:!0,verticalOffset:null,screenSizePerspective:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotation:[0,0,
0],transparent:!1,polygonOffset:!1,atlasRegions:!1},U,N=!!a("enable-feature:skallweit/lod-rendering"),S="material",aa="material-depth",V="material-normal",T="material-highlight",Q=E.create(),G=J.create(),X=F.create(),Z=D.create(),ea=D.create(),fa=D.createFrom(0,0,1),R=D.create(),da=D.create(),ba=D.create(),ca=D.create();return q})},"esri/views/3d/webgl-engine/materials/LineCalloutMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/text!./LineCalloutMaterial.xml ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/ShaderVariations ../lib/Util ./internal/MaterialUtil ../../../webgl/Util".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n){function l(a,b,c){3===c.length?a.setUniform4f(b,c[0],c[1],c[2],1):a.setUniform4fv(b,c)}var p=f.VertexAttrConstants,m=[{name:"position",count:3,type:5126,offset:0,stride:48,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:48,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:48,normalized:!1},{name:"auxpos1",count:4,type:5126,offset:32,stride:48,normalized:!1}],r={verticalOffset:null,screenSizePerspective:null,screenOffset:[0,0],color:[0,0,
0,1],size:1,borderColor:null,occlusionTest:!1,shaderPolygonOffset:1E-5,depthHUDAlignStart:!1,centerOffsetUnits:"world"};q=function(b){function d(a,c){c=b.call(this,c)||this;c.params=k.copyParameters(a,r);c._uniqueMaterialIdentifier=d.uniqueMaterialIdentifier(c.params);return c}e(d,b);Object.defineProperty(d.prototype,"uniqueMaterialIdentifier",{get:function(){return this._uniqueMaterialIdentifier},enumerable:!0,configurable:!0});d.prototype.dispose=function(){};d.prototype.getGLMaterials=function(){return{color:t,
depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:void 0}};d.prototype.getAllTextureIds=function(){return[]};d.prototype.fillAttributeData=function(a,b,c,d,f,e){var g=a.indices[b];a=a.vertexAttr[b].data;if(g&&a)for(b=c+n.findAttribute(m,b).offset/4,c=0;c<g.length;c++)for(var l=d*g[c],h=0;6>h;h++)k.fill(a,l,e,b,f,d),b+=12};d.prototype.fillInterleaved=function(a,b,c,d,f,e,g){this.fillAttributeData(a,p.POSITION,e,3,b,f);this.fillAttributeData(a,p.NORMAL,e,3,c,f);this.fillAttributeData(a,p.AUXPOS1,
e,4,null,f);a=e+n.findAttribute(m,p.UV0).offset/4;b=0;for(c=u;b<c.length;b++)d=c[b],f[a+0]=d[0],f[a+1]=d[1],a+=12};d.prototype.getOutputAmount=function(a){return 288*a};d.prototype.getInstanceBufferLayout=function(){};d.prototype.getVertexBufferLayout=function(){return m};d.prototype.intersect=function(a,b,c,d,f,e,g,k){};d.prototype.getParameterValues=function(){var a=this.params;return{verticalOffset:a.verticalOffset,screenSizePerspective:a.screenSizePerspective,screenOffset:a.screenOffset,centerOffsetUnits:a.centerOffsetUnits,
color:[a.color[0],a.color[1],a.color[2],a.color[3]],size:a.size,borderColor:a.borderColor,occlusionTest:a.occlusionTest,shaderPolygonOffset:a.shaderPolygonOffset,depthHUDAlignStart:a.depthHUDAlignStart}};d.prototype.setParameterValues=function(a){k.updateParameters(this.params,a)&&(this._uniqueMaterialIdentifier=d.uniqueMaterialIdentifier(this.params),this.notifyDirty("matChanged"))};d.uniqueMaterialIdentifier=function(a){return JSON.stringify({screenOffset:a.screenOffset||[0,0],centerOffsetUnits:a.centerOffsetUnits||
"world"})};d.loadShaders=function(b,d,f){b._parse(a);b=new c("lineCallout",["vertexShaderLineCallout","fragmentShaderLineCallout"],null,d,b,f);b.addDefine("occlTest","OCCL_TEST");b.addDefine("verticalOffset","VERTICAL_OFFSET");b.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");b.addDefine("depthHud","DEPTH_HUD");b.addDefine("depthHudAlignStart","DEPTH_HUD_ALIGN_START");b.addDefine("centerOffsetUnitsScreen","CENTER_OFFSET_UNITS_SCREEN");d.addShaderVariations("line-callout-material-shader-variations",
b)};return d}(b);var t=function(a){function b(b,c,d){b=a.call(this,b,c)||this;b.isRenderSlot=!0;b.updateParameters();return b}e(b,a);b.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram()};b.prototype.selectProgram=function(){var a=this.params;this.renderProgram=this.programRep.getShaderVariationsProgram("line-callout-material-shader-variations",[!!a.occlusionTest,!!a.verticalOffset,!!a.screenSizePerspective,!1,!!a.depthHUDAlignStart,"screen"===
a.centerOffsetUnits]);this.depthProgram=this.programRep.getShaderVariationsProgram("line-callout-material-shader-variations",[!!a.occlusionTest,!!a.verticalOffset,!!a.screenSizePerspective,!0,!!a.depthHUDAlignStart,"screen"===a.centerOffsetUnits])};b.prototype.beginSlot=function(a){switch(a){case g.LINE_CALLOUTS:return this.isRenderSlot=!0;case g.LINE_CALLOUTS_HUD_DEPTH:return this.isRenderSlot=!1,!0}return!1};Object.defineProperty(b.prototype,"program",{get:function(){return this.isRenderSlot?this.renderProgram:
this.depthProgram},enumerable:!0,configurable:!0});b.prototype.getProgram=function(){return this.program};b.prototype.getPrograms=function(){return[this.renderProgram,this.depthProgram]};b.prototype.getDrawMode=function(a){return a.gl.TRIANGLES};b.prototype.bind=function(a,b){var c=b.cameraAboveGround?1:-1,d=this.program,f=this.params;a.bindProgram(d);d.setUniform1f("cameraGroundRelative",c);d.setUniform1f("polygonOffset",f.shaderPolygonOffset);d.setUniform4fv("viewport",b.viewport);d.setUniformMatrix4fv("viewNormal",
b.viewInvTransp);d.setUniform1i("hudVisibilityTexture",0);a.bindTexture(b.hudVisibilityTexture,0);l(d,"color",f.color);d.setUniform2f("screenOffset",f.screenOffset[0],f.screenOffset[1]);this.bindBorder(a,b);k.bindVerticalOffset(f.verticalOffset,b,d);this.bindSizing(a,b);k.bindScreenSizePerspective(f.screenSizePerspective,d);this.isRenderSlot?this.bindRender(a,b):this.bindHUDDepth(a,b)};b.prototype.bindRender=function(a,b){a.setBlendFunctionSeparate(1,771,770,771);a.setBlendingEnabled(!0);a.setDepthWriteEnabled(!1)};
b.prototype.bindHUDDepth=function(a,b){a.setColorMask(!1,!1,!1,!1);a.setDepthWriteEnabled(!0);a.setBlendingEnabled(!1);a.setDepthTestEnabled(!0)};b.prototype.bindView=function(a,b){a=this.program;k.bindView(b.origin,b.view,a);k.bindCamPos(b.origin,b.viewInvTransp,a)};b.prototype.bindInstance=function(a,b){a=this.program;a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};b.prototype.release=function(a,b){this.isRenderSlot?this.releaseRender(a,
b):this.releaseHUDDepth(a,b)};b.prototype.releaseRender=function(a,b){a.setBlendingEnabled(!1);a.setBlendFunction(770,771);a.setDepthWriteEnabled(!0)};b.prototype.releaseHUDDepth=function(a,b){a.setColorMask(!0,!0,!0,!0)};b.prototype.bindSizing=function(a,b){a=this.program;var c=this.params;a.setUniform2f("pixelToNDC",2/b.viewport[2],2/b.viewport[3]);a.setUniform1f("lineSize",Math.ceil(c.size))};b.prototype.bindBorder=function(a,b){a=this.program;b=this.params;null!==b.borderColor?(l(a,"borderColor",
b.borderColor),a.setUniform1f("borderSize",1)):(a.setUniform4f("borderColor",0,0,0,0),a.setUniform1f("borderSize",0))};return b}(d),u=[[0,0],[1,0],[0,1],[1,0],[1,1],[0,1]];return q})},"esri/views/3d/webgl-engine/materials/MeasurementArrowMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/text!./MeasurementArrowMaterial.xml ../lib/gl-matrix ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/ShaderVariations ../lib/Util ./internal/MaterialUtil ../../../webgl/Util".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l){var p=d.vec3d,m=d.mat4d,r=[{name:k.VertexAttrConstants.POSITION,count:3,type:5126,offset:0,stride:36,normalized:!1},{name:k.VertexAttrConstants.NORMAL,count:3,type:5126,offset:12,stride:36,normalized:!1},{name:k.VertexAttrConstants.UV0,count:2,type:5126,offset:24,stride:36,normalized:!1},{name:k.VertexAttrConstants.AUXPOS1,count:1,type:5126,offset:32,stride:36,normalized:!1}],t={width:32,outlineSize:.2,outlineColor:[1,.5,0,1],stripeLength:1,stripeEvenColor:[1,1,1,
1],stripeOddColor:[1,.5,0,1],polygonOffset:!1};q=function(b){function c(a,c){c=b.call(this,c)||this;c.params=n.copyParameters(a,t);return c}e(c,b);c.prototype.dispose=function(){};c.prototype.getParameterValues=function(){var a=this.params;return{width:a.width,outlineSize:a.outlineSize,outlineColor:a.outlineColor,stripeLength:a.stripeLength,stripeEvenColor:a.stripeEvenColor,stripeOddColor:a.stripeOddColor,polygonOffset:a.polygonOffset}};c.prototype.setParameterValues=function(a){n.updateParameters(this.params,
a)&&this.notifyDirty("matChanged")};c.prototype.getParams=function(){return this.params};c.prototype.getOutputAmount=function(a){return 18*(a/2+1)};c.prototype.getInstanceBufferLayout=function(){};c.prototype.getVertexBufferLayout=function(){return r};c.prototype.fillInterleaved=function(a,b,c,d,f,e){d=a.vertexAttr[k.VertexAttrConstants.POSITION].data;var g=a.vertexAttr[k.VertexAttrConstants.NORMAL].data,h=d.length/3;(a=a&&a.indices&&a.indices.position)&&a.length!==2*(h-1)&&console.warn("MeasurementArrowMaterial does not support indices");
a=e+l.findAttribute(r,k.VertexAttrConstants.POSITION).offset/4;var u=e+l.findAttribute(r,k.VertexAttrConstants.NORMAL).offset/4,t=e+l.findAttribute(r,k.VertexAttrConstants.UV0).offset/4;e+=l.findAttribute(r,k.VertexAttrConstants.AUXPOS1).offset/4;for(var B=x,q=v,D=A,E=y,I=C,T=0,Q=0;Q<h;++Q){var G=3*Q;p.set3(d[G],d[G+1],d[G+2],B);Q<h-1&&(G=3*(Q+1),p.set3(d[G],d[G+1],d[G+2],q),p.set3(g[G],g[G+1],g[G+2],I),p.normalize(I),p.subtract(q,B,D),p.normalize(D),p.cross(I,D,E),p.normalize(E));G=p.dist(B,q);b&&
c&&(m.multiplyVec3(b,B),m.multiplyVec3(b,q),m.multiplyVec3(c,E));n.fill(B,0,f,a,void 0,3);a+=9;n.fill(B,0,f,a,void 0,3);a+=9;n.fill(E,0,f,u,void 0,3);u+=9;n.fill(E,0,f,u,void 0,3);u+=9;f[t]=T;f[t+1]=-1;t+=9;f[t]=T;f[t+1]=1;t+=9;Q<h-1&&(T+=G)}for(Q=0;Q<h;++Q)f[e]=T,e+=9,f[e]=T,e+=9};c.prototype.intersect=function(a,b,c,d,f,e,g,k){};c.prototype.getGLMaterials=function(){return{color:u,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:void 0}};c.prototype.getAllTextureIds=function(){return[]};
c.loadShaders=function(b,c,d){b._parse(a);b=new f("measurement-arrow",["vsMeasurementArrow","fsMeasurementArrow"],null,c,b,d);c.addShaderVariations("measurement-arrow-material-shader-variations",b)};return c}(g);var u=function(a){function b(b,c,d){c=a.call(this,b,c)||this;c.params=n.copyParameters(b.getParams());c.selectProgram();return c}e(b,a);b.prototype.selectProgram=function(){this.program=this.programRep.getShaderVariationsProgram("measurement-arrow-material-shader-variations",[])};b.prototype.updateParameters=
function(){this.params=this.material.getParameterValues();this.selectProgram()};b.prototype.beginSlot=function(a){return a===c.OPAQUE_MATERIAL};b.prototype.getProgram=function(){return this.program};b.prototype.getDrawMode=function(a){return a.gl.TRIANGLE_STRIP};b.prototype.bind=function(a,b){b=this.program;a.setDepthTestEnabled(!0);a.setDepthWriteEnabled(!0);a.setFaceCullingEnabled(!1);a.setBlendingEnabled(!1);this.params.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(0,-4));
a.bindProgram(b);b.setUniform1f("width",this.params.width);b.setUniform1f("outlineSize",this.params.outlineSize);b.setUniform4fv("outlineColor",this.params.outlineColor);b.setUniform1f("stripeLength",this.params.stripeLength);b.setUniform4fv("stripeEvenColor",this.params.stripeEvenColor);b.setUniform4fv("stripeOddColor",this.params.stripeOddColor)};b.prototype.bindView=function(a,b){a=b.origin;var c=this.getProgram();n.bindView(a,b.view,c)};b.prototype.bindInstance=function(a,b){this.getProgram().setUniformMatrix4fv("model",
b.transformation)};b.prototype.release=function(a){a.setDepthTestEnabled(!0);a.setDepthWriteEnabled(!0);a.setBlendingEnabled(!1);this.params.polygonOffset&&a.setPolygonOffsetFillEnabled(!1)};return b}(b),x=p.create(),v=p.create(),A=p.create(),y=p.create(),C=p.create();b=m.create();m.identity(b);return q})},"esri/views/3d/webgl-engine/materials/RibbonLineMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/text!./RibbonLineMaterial.xml ../../../../core/Logger ../../support/geometryUtils ../lib/ComponentUtils ../lib/DefaultVertexBufferLayouts ../lib/gl-matrix ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/ShaderVariations ../lib/Util ./internal/MaterialUtil ../../../webgl/Util".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t){var u=m.VertexAttrConstants,x=d.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");q=function(c){function d(a,b){b=c.call(this,b)||this;b.params=r.copyParameters(a,aa);"miter"!==b.params.join&&(b.params.miterLimit=0);b.numVertsAtJoin="wall"===b.params.type?2:4;b.numVertsAtCap=2;b.canBeMerged="screen"===b.params.type&&null==b.params.stippleLength;return b}e(d,c);d.prototype.setColor=function(a){this.params.color=a;this.notifyDirty("matChanged")};
d.prototype.getColor=function(){return this.params.color};d.prototype.dispose=function(){};d.prototype.getParams=function(){return this.params};d.prototype.getParameterValues=function(){var a=this.params;return{color:a.color,width:a.width,type:a.type,join:a.join,polygonOffset:a.polygonOffset,miterLimit:a.miterLimit,stippleLength:a.stippleLength}};d.prototype.setParameterValues=function(a){for(var b in a)m.assert("type"!==b,"RibbonLineMaterial: type cannot be changed after creation"),m.assert("stippleLength"!==
b||null!=a[b]===(null!=this.params[b]),"RibbonLineMaterial: stippleLength on/off cannot be changed after creation"),this.params[b]=a[b];"miter"!==this.params.join&&(this.params.miterLimit=0);this.notifyDirty("matChanged")};d.prototype.getOutputAmount=function(a){a=(a/2+1-2)*this.numVertsAtJoin+2*this.numVertsAtCap;this.canBeMerged&&(a+=2);return a*t.getStride(T)/4};d.prototype.getInstanceBufferLayout=function(){};d.prototype.getVertexBufferLayout=function(){return"wall"===this.params.type?V:T};d.prototype.fillInterleaved=
function(a,b,c,d,f,e){c=a.vertexAttr[u.POSITION].data;d=a.vertexAttr[u.COLOR]?a.vertexAttr[u.COLOR].data:y;var g=a.vertexAttr[u.SIZE]?a.vertexAttr[u.SIZE].data:C;(a=a.indices&&a.indices[u.POSITION])&&a.length!==2*(c.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");"wall"===this.params.type?this.fillWithoutAuxpos(c,b,f,e):this.fillWithAuxpos(c,d,g,b,f,e)};d.prototype.intersect=function(a,c,d,e,k,l,n,h){if(e.isSelection&&!g.isAllHidden(c.componentVisibilities,a.data.componentOffsets))if(m.isTranslationMatrix(d)){c=
a.getData();a=c.getVertexAttr()[u.POSITION].data;c=c.getVertexAttr()[u.SIZE];l=e.camera;h=e.point;c=((c&&c.data[0])+this.params.width)/2+4;f.vec3d.set3(h[0]-c,h[1]+c,0,O[0]);f.vec3d.set3(h[0]+c,h[1]+c,0,O[1]);f.vec3d.set3(h[0]+c,h[1]-c,0,O[2]);f.vec3d.set3(h[0]-c,h[1]-c,0,O[3]);for(var p=0;4>p;p++)l.unprojectPoint(O[p],P[p]);b.plane.fromPoints(l.eye,P[0],P[1],L);b.plane.fromPoints(l.eye,P[1],P[2],U);b.plane.fromPoints(l.eye,P[2],P[3],N);b.plane.fromPoints(l.eye,P[3],P[0],S);k=Number.MAX_VALUE;for(p=
0;p<a.length-5;p+=3)if(B[0]=a[p]+d[12],B[1]=a[p+1]+d[13],B[2]=a[p+2]+d[14],D[0]=a[p+3]+d[12],D[1]=a[p+4]+d[13],D[2]=a[p+5]+d[14],!(0>b.plane.distance(L,B)&&0>b.plane.distance(L,D)||0>b.plane.distance(U,B)&&0>b.plane.distance(U,D)||0>b.plane.distance(N,B)&&0>b.plane.distance(N,D)||0>b.plane.distance(S,B)&&0>b.plane.distance(S,D))){l.projectPoint(B,F);l.projectPoint(D,M);if(0>F[2]&&0<M[2]){f.vec3d.subtract(B,D,E);var r=l.frustumPlanes,t=-b.plane.distance(r[4],B),r=t/f.vec3d.dot(E,r[4]);f.vec3d.scale(E,
r,E);f.vec3d.add(B,E,B);l.projectPoint(B,F)}else if(0<F[2]&&0>M[2])f.vec3d.subtract(D,B,E),r=l.frustumPlanes,t=-b.plane.distance(r[4],D),r=t/f.vec3d.dot(E,r[4]),f.vec3d.scale(E,r,E),f.vec3d.add(D,E,D),l.projectPoint(D,M);else if(0>F[2]&&0>M[2])continue;r=m.pointLineSegmentDistanceSquared2D(F,M,h);r<k&&(k=r,f.vec3d.set(B,H),f.vec3d.set(D,I))}d=e.p0;e=e.p1;k<c*c&&(a=m.lineLineDistanceSquared3D(H,I,d,e,K),c=Number.MAX_VALUE,a.success&&(f.vec3d.subtract(a.pa,d,J),a=f.vec3d.length(J),f.vec3d.scale(J,1/
a),c=a/f.vec3d.dist(d,e)),n(c,J))}else x.error("intersection assumes a translation-only matrix")};d.prototype.getGLMaterials=function(){return{color:v,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:A}};d.prototype.getAllTextureIds=function(){return[]};d.prototype.fillWithAuxpos=function(a,b,c,d,f,e){var g=a.length/3,k=a[0],l=a[1],m=a[2],n=0,h=e,p=t.getStride(this.getVertexBufferLayout())/4;this.canBeMerged&&(e+=p);d&&(k=d[0]*k+d[4]*l+d[8]*m+d[12],l=d[1]*k+d[5]*l+d[9]*m+d[13],m=d[2]*k+
d[6]*l+d[10]*m+d[14]);var u=k,r=l,v=m,y=a[3],x=a[4],A=a[5];d&&(y=d[0]*y+d[4]*x+d[8]*A+d[12],x=d[1]*y+d[5]*x+d[9]*A+d[13],A=d[2]*y+d[6]*x+d[10]*A+d[14]);for(var C=0;C<g;C++){var B=3*C;C<g-1&&(y=a[B+3],x=a[B+4],A=a[B+5],d&&(y=d[0]*y+d[4]*x+d[8]*A+d[12],x=d[1]*y+d[5]*x+d[9]*A+d[13],A=d[2]*y+d[6]*x+d[10]*A+d[14]));n+=Math.sqrt((u-k)*(u-k)+(r-l)*(r-l)+(v-m)*(v-m));f[e++]=u;f[e++]=r;f[e++]=v;f[e++]=n;f[e++]=0===C?-1.2:-1;f[e++]=k;f[e++]=l;f[e++]=m;f[e++]=y;f[e++]=x;f[e++]=A;f[e++]=b[0];f[e++]=b[1];f[e++]=
b[2];f[e++]=b[3];f[e++]=c[0];f[e++]=u;f[e++]=r;f[e++]=v;f[e++]=n;f[e++]=0===C?1.2:1;f[e++]=k;f[e++]=l;f[e++]=m;f[e++]=y;f[e++]=x;f[e++]=A;f[e++]=b[0];f[e++]=b[1];f[e++]=b[2];f[e++]=b[3];f[e++]=c[0];0<C&&C<g-1&&(f[e++]=u,f[e++]=r,f[e++]=v,f[e++]=n,f[e++]=-1.2,f[e++]=k,f[e++]=l,f[e++]=m,f[e++]=y,f[e++]=x,f[e++]=A,f[e++]=b[0],f[e++]=b[1],f[e++]=b[2],f[e++]=b[3],f[e++]=c[0],f[e++]=u,f[e++]=r,f[e++]=v,f[e++]=n,f[e++]=1.2,f[e++]=k,f[e++]=l,f[e++]=m,f[e++]=y,f[e++]=x,f[e++]=A,f[e++]=b[0],f[e++]=b[1],f[e++]=
b[2],f[e++]=b[3],f[e++]=c[0]);k=u;l=r;m=v;u=y;r=x;v=A}if(this.canBeMerged){for(C=h;C<h+p;C++)f[C]=f[C+p];a=e-p;for(C=0;C<p;C++)f[e++]=f[a++]}};d.prototype.fillWithoutAuxpos=function(a,b,c,d){for(var f=a.length/3,e=0,g=a[0],k=a[1],l=a[2],m,n,h,p=0;p<f;p++){var u=3*p;m=g;n=k;h=l;g=a[u];k=a[u+1];l=a[u+2];b&&(g=b[0]*g+b[4]*k+b[8]*l+b[12],k=b[1]*g+b[5]*k+b[9]*l+b[13],l=b[2]*g+b[6]*k+b[10]*l+b[14]);e+=Math.sqrt((g-m)*(g-m)+(k-n)*(k-n)+(l-h)*(l-h));c[d++]=g;c[d++]=k;c[d++]=l;c[d++]=e;c[d++]=-1;c[d++]=g;
c[d++]=k;c[d++]=l;c[d++]=e;c[d++]=1}};d.loadShaders=function(b,c,d){b._parse(a);var f=function(a){a.addDefine("Screen","SCREENSCALE");a.addDefine("Strip","STRIP");a.addDefine("Wall","WALL");a.addDefine("Stipple","STIPPLE")},e=new p("ribbon-line",["vsRibbonLine","fsRibbonLine"],null,c,b,d);f(e);c.addShaderVariations("ribbon-line-material-shader-variations",e);b=new p("ribbon-line",["vsRibbonLine","fsRibbonLineHighlight"],null,c,b,d);f(b);c.addShaderVariations("ribbon-line-material-highlight-shader-variations",
b)};return d}(n);var v=function(a){function b(b,c){var d=a.call(this,b,c)||this;d.params=r.copyParameters(b.getParams());delete d.params.join;d.program=c.getShaderVariationsProgram("ribbon-line-material-shader-variations",["screen"===d.params.type,"strip"===d.params.type,"wall"===d.params.type,null!=d.params.stippleLength]);return d}e(b,a);b.prototype.updateParameters=function(){var a=this.material.getParams(),b=this.params;b.polygonOffset=a.polygonOffset;b.color=a.color;b.width=a.width;b.miterLimit=
"miter"===a.join?a.miterLimit:0;b.stippleLength=a.stippleLength};b.prototype.beginSlot=function(a){return a===l.TRANSPARENT_MATERIAL};b.prototype.getProgram=function(){return this.program};b.prototype.bind=function(a,b){var c=this.program,d=this.params;a.bindProgram(c);c.setUniform4fv("eColor",d.color);c.setUniform1f("miterLimit",d.miterLimit);c.setUniform1f("nearPlane",b.nearFar[0]);"screen"===d.type?(c.setUniform2fv("screenSize",[b.viewport[2],b.viewport[3]]),c.setUniform1f("extLineWidth",d.width*
b.pixelRatio)):c.setUniform1f("extLineWidth",d.width);null!=d.stippleLength&&c.setUniform1f("stippleLengthDoubleInv",d.stippleLength?1/(2*d.stippleLength):0);d.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(0,-4));a.setFaceCullingEnabled(!1);a.setBlendingEnabled(!0);a.setBlendFunctionSeparate(a.gl.SRC_ALPHA,a.gl.ONE_MINUS_SRC_ALPHA,a.gl.ONE,a.gl.ONE_MINUS_SRC_ALPHA);a.setDepthTestEnabled(!0);a.setDepthWriteEnabled(1<=d.color[3])};b.prototype.release=function(a){this.params.polygonOffset&&
a.setPolygonOffsetFillEnabled(!1);a.setBlendingEnabled(!1);a.setDepthWriteEnabled(!0)};b.prototype.bindView=function(a,b){r.bindView(b.origin,b.view,this.program)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(a){return a.gl.TRIANGLE_STRIP};return b}(k),A=function(a){function b(b,c){var d=a.call(this,b,c)||this;d.params=r.copyParameters(b.getParams());delete d.params.join;d.program=c.getShaderVariationsProgram("ribbon-line-material-highlight-shader-variations",
["screen"===d.params.type,"strip"===d.params.type,"wall"===d.params.type,null!=d.params.stippleLength]);return d}e(b,a);b.prototype.updateParameters=function(){var a=this.material.getParams(),b=this.params;b.polygonOffset=a.polygonOffset;b.color=a.color;b.width=a.width;b.miterLimit="miter"===a.join?a.miterLimit:0;b.stippleLength=a.stippleLength};b.prototype.beginSlot=function(a){return a===l.OPAQUE_MATERIAL};b.prototype.getProgram=function(){return this.program};b.prototype.bind=function(a,b){var c=
this.program,d=this.params;a.bindProgram(c);c.setUniform4fv("eColor",d.color);c.setUniform1f("miterLimit",d.miterLimit);c.setUniform1f("nearPlane",b.nearFar[0]);"screen"===d.type?(c.setUniform2fv("screenSize",[b.viewport[2],b.viewport[3]]),c.setUniform1f("extLineWidth",d.width*b.pixelRatio)):c.setUniform1f("extLineWidth",d.width);null!=d.stippleLength&&c.setUniform1f("stippleLengthDoubleInv",d.stippleLength?1/(2*d.stippleLength):0);d.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(0,
-4));a.setFaceCullingEnabled(!1);a.setDepthTestEnabled(!0);a.setDepthWriteEnabled(1<=d.color[3])};b.prototype.release=function(a){this.params.polygonOffset&&a.setPolygonOffsetFillEnabled(!1);a.setDepthWriteEnabled(!0)};b.prototype.bindView=function(a,b){r.bindView(b.origin,b.view,this.program)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(a){return a.gl.TRIANGLE_STRIP};return b}(k),y=[255,255,255,255],C=[0,0,0,
0],B=f.vec3d.create(),D=f.vec3d.create(),E=f.vec3d.create(),J=f.vec3d.create(),F=f.vec3d.create(),M=f.vec3d.create(),H=f.vec3d.create(),I=f.vec3d.create(),K={success:!1,dist2:0,pa:f.vec3d.create(),pb:f.vec3d.create()},O=[f.vec3d.create(),f.vec3d.create(),f.vec3d.create(),f.vec3d.create()],P=[f.vec3d.create(),f.vec3d.create(),f.vec3d.create(),f.vec3d.create()],L=b.plane.create(),U=b.plane.create(),N=b.plane.create(),S=b.plane.create(),aa={color:[1,1,1,1],width:0,type:"screen",join:"miter",miterLimit:5,
polygonOffset:!1,stippleLength:null},V=c.Pos3Tex,T=[{name:"position",count:3,type:5126,offset:0,stride:64,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:64,normalized:!1},{name:"auxpos1",count:3,type:5126,offset:20,stride:64,normalized:!1},{name:"auxpos2",count:3,type:5126,offset:32,stride:64,normalized:!1},{name:"color",count:4,type:5126,offset:44,stride:64,normalized:!1},{name:"size",count:1,type:5126,offset:60,stride:64,normalized:!1}];return q})},"esri/views/3d/webgl-engine/materials/internal/BlendLayers":function(){define(["require",
"exports","dojo/text!./BlendLayers.xml","../../lib/DefaultVertexAttributeLocations","../../../../webgl/Program"],function(q,h,e,a,d){return function(){function b(){}b.loadShaders=function(b,c,f){b._parse(e);b=new d(f,b.vertexShaderBlendLayers,b.fragmentShaderBlendLayers,a.Default3D);c.add("blendLayers",b)};return b}()})},"esri/views/3d/webgl-engine/materials/internal/SimpleGLMaterial":function(){define("require exports dojo/text!./SimpleGLMaterial.xml ../../lib/DefaultVertexAttributeLocations ../../lib/RenderSlot ./MaterialUtil ../../../../webgl/Program".split(" "),
function(q,h,e,a,d,b,g){return function(){function c(a,b,c,d){void 0===d&&(d=4);this.program=a.get("simple");this.color=b;this.depthFunc=c;this.drawMode=d}c.prototype.beginSlot=function(a){return a===d.INTERNAL_MATERIAL};c.prototype.getProgram=function(){return this.program};c.prototype.bind=function(a,c){a.bindProgram(this.program);this.program.setUniformMatrix4fv("model",b.IDENTITY);this.program.setUniformMatrix4fv("proj",c.proj);this.program.setUniform4fv("color",this.color);a.setBlendingEnabled(!0);
a.setBlendFunctionSeparate(a.gl.SRC_ALPHA,a.gl.ONE_MINUS_SRC_ALPHA,a.gl.ONE,a.gl.ONE_MINUS_SRC_ALPHA);a.setDepthTestEnabled(!0);void 0!==this.depthFunc&&a.setDepthFunction(this.depthFunc)};c.prototype.release=function(a){void 0!==this.depthFunc&&a.setDepthFunction(513);a.setBlendingEnabled(!1)};c.prototype.bindView=function(a,c){b.bindView(c.origin,c.view,this.program)};c.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};c.prototype.getDrawMode=function(a){return this.drawMode};
c.loadShaders=function(b,c,d){b._parse(e);b=new g(d,b.vertexShaderSimple,b.fragmentShaderSimple,a.Default3D);c.add("simple",b)};return c}()})},"esri/views/3d/webgl-engine/parts/Viewport":function(){define("require exports dojo/has ../../support/geometryUtils ../lib/Camera ../lib/gl-matrix ../lib/PerformanceTimer ../lib/Util ./Visualizer".split(" "),function(q,h,e,a,d,b,g,c,f){var k=[0,0],n=b.mat4d.create(),l=[a.plane.create(),a.plane.create(),a.plane.create(),a.plane.create(),a.plane.create(),a.plane.create()];
return function(){function a(a,c,e,g,k){this._content=new Map;this._frustumCullingEnabled=!0;this._maxFarNearRatio=2E4;this._stats={renderGeometriesTotal:0,renderGeometriesVisible:0,visualizerRenderTimer:null,viewportRenderTimer:null};this._needsRender=!0;this._rctx=k;this._gl=k.gl;this._visualizer=new f(a,c,e,g,this._rctx);this._camera=new d(b.vec3.createFrom(0,100,-100),b.vec3.createFrom(0,0,0))}Object.defineProperty(a.prototype,"isLoadingResources",{get:function(){return this._visualizer.isLoadingResources},
enumerable:!0,configurable:!0});a.prototype.getCombinedStats=function(){var a={},b=this._visualizer.getCombinedStats(),c;for(c in b)a[c]=b[c];a.renderGeometriesTotal=this._stats.renderGeometriesTotal;a.renderGeometriesVisible=this._stats.renderGeometriesVisible;void 0!==this._gl.getUsedTextureMemory&&(a.textureMemory=this._gl.getUsedTextureMemory());void 0!==this._gl.getUsedRenderbufferMemory&&(a.renderbufferMemory=this._gl.getUsedRenderbufferMemory());void 0!==this._gl.getUsedVBOMemory&&(a.VBOMemory=
this._gl.getUsedVBOMemory());if(void 0!==this._gl.getUsedTextureMemoryStats){var b=this._gl.getUsedTextureMemoryStats(),d;for(d in b)a["texMem type: "+d]=b[d]}return a};a.prototype.dispose=function(){this._visualizer.dispose();this._visualizer=null};a.prototype.setLighting=function(a){this._visualizer.setLighting(a)};a.prototype.getViewParams=function(a){var b=this._visualizer.getViewParams(a);if(!a||a.frustumCullingEnabled)b.frustumCullingEnabled=this._frustumCullingEnabled;if(!a||a.maxFarNearRatio)b.maxFarNearRatio=
this._maxFarNearRatio;return b};a.prototype.setViewParams=function(a){void 0!==a.frustumCullingEnabled&&(this._frustumCullingEnabled=a.frustumCullingEnabled);void 0!==a.maxFarNearRatio&&(this._maxFarNearRatio=-1===a.maxFarNearRatio?2E4:a.maxFarNearRatio);this._visualizer.setViewParams(a);this._needsRender=!0};a.prototype.setRenderParams=function(a){this._visualizer.setRenderParams(a)};a.prototype.getRenderParams=function(){return this._visualizer.getRenderParams()};a.prototype.getEdgeView=function(){return this._visualizer.getEdgeView()};
a.prototype.modify=function(a,b,c,d){this._visualizer.modify(a,b,c,d);this._content=this._visualizer.getContent()};a.prototype.getContent=function(){return this._content};a.prototype.setCamera=function(a){this._camera.copyFrom(a);this._updateNearFar();this._needsRender=!0};a.prototype.getCamera=function(){return this._camera};a.prototype.getPickRay=function(a,b,c){return this.pickRayWithBeginPoint(a,void 0,this._camera.viewMatrix,b,c)};a.prototype.pickRayWithBeginPoint=function(a,b,c,d,f){return this._visualizer.getPickRay(a,
b,this._camera,c,d,f)};a.prototype.addExternalRenderer=function(a,b){return this._visualizer.addExternalRenderer(a,b)};a.prototype.removeExternalRenderer=function(a){return this._visualizer.removeExternalRenderer(a)};a.prototype.getExternalRenderers=function(){return this._visualizer.getExternalRenderers()};a.prototype.render=function(a,b){this._updateNearFar();this._visualizer.render(this._camera,a,b)};a.prototype.resetNeedsRender=function(){this._needsRender=!1;this._visualizer.resetNeedsRender()};
a.prototype.needsRender=function(){return this._needsRender||this._visualizer.needsRender()};a.prototype._updateNearFar=function(){if(this._frustumCullingEnabled||0<this._maxFarNearRatio)k[1]=0,this._computeFrustumCullingAndNearFar(this._camera.eye,k),0<this._maxFarNearRatio&&0<k[1]&&(this._camera.far=k[1],this._camera.near=Math.max(k[0],this._camera.far/this._maxFarNearRatio))};a.prototype._computeFrustumCullingAndNearFar=function(a,d){var f=this;b.mat4d.perspective(this._camera.fovY,this._camera.aspect,
1,10,n);c.matrixToFrustumPlanes(this._camera.viewMatrix,n,l);this._stats.renderGeometriesTotal=0;this._stats.renderGeometriesVisible=0;var e=-Number.MAX_VALUE,g=-Number.MAX_VALUE,k=l[0][0],m=l[0][1],h=l[0][2],p=l[0][3],r=l[1][0],q=l[1][1],E=l[1][2],J=l[1][3],F=l[2][0],M=l[2][1],H=l[2][2],I=l[2][3],K=l[3][0],O=l[3][1],P=l[3][2],L=l[3][3],U=l[4][0],N=l[4][1],S=l[4][2];a=l[4][3];var aa=l[5][3];this._content.forEach(function(a){f._stats.renderGeometriesTotal++;var b=a.center,c=b[0],d=b[1],b=b[2];a=a.bsRadius;
k*c+m*d+h*b+p>a||r*c+q*d+E*b+J>a||F*c+M*d+H*b+I>a||K*c+O*d+P*b+L>a||(d=U*c+N*d+S*b,c=d+a,d=-d+a,c>e&&(e=c),d>g&&(g=d),f._stats.renderGeometriesVisible++)});var V=e!==-Number.MAX_VALUE,e=e+a,g=g+aa;0<this._stats.renderGeometriesVisible&&V&&(d[0]=.99*Math.max(1-e,2),d[1]=1.01*Math.max(10+g,d[0]+1))};return a}()})},"esri/views/3d/webgl-engine/parts/Visualizer":function(){define("require exports ../../../../core/TimeProfiler ../../support/debugFlags ../lib/depthRange ../lib/depthRangeUtils ../lib/gl-matrix ../lib/HighlightHelper ../lib/OffscreenRenderingHelper ../lib/Renderer ../lib/RenderOccludedHelper ../lib/RenderPass ../lib/ShadowMap ../lib/SSAOHelper ../lib/Util".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r){var t=g.vec3d,u=g.mat4d,x=r.assert;return function(){function g(a,b,d,e,g){this._drawSSAOMapDebugQuad=this._drawShadowMapDebugQuad=!1;this._needsRender=!0;this._content=new Map;this._stage=a;this._rctx=g;this._renderer=new k(b,d,e,this._rctx,!1);this._programRep=b;this._helpers={shadowMap:new p(b,this._rctx),ssao:new m(b,e,this._rctx,this.setNeedsRender.bind(this)),highlight:new c(b,e,this._rctx),renderOccluded:new n(b,e,this._rctx),offscreenRendering:new f(b,
this._rctx)}}Object.defineProperty(g.prototype,"isLoadingResources",{get:function(){return this._renderer.isLoadingResources},enumerable:!0,configurable:!0});g.prototype.getCombinedStats=function(){return this._renderer.getCombinedStats()};g.prototype.dispose=function(){this._renderer.dispose();this._helpers.shadowMap.enabled=!1;this._helpers.shadowMap.dispose();this._helpers.ssao.enabled=!1;this._helpers.ssao.dispose();this._helpers.highlight.enabled=!1;this._helpers.renderOccluded.enabled=!1;this._helpers.offscreenRendering.enabled=
!1};g.prototype.setLighting=function(a){this._renderer.setLighting(a)};g.prototype.getViewParams=function(a){var b=a||{};if(!a||a.pixelRatio)b.pixelRatio=this._renderer.getPixelRatio();return b};g.prototype.setViewParams=function(a){null!=a.pixelRatio&&this._renderer.setPixelRatio(a.pixelRatio)};g.prototype.setRenderParams=function(a){void 0!==a.shadowMapResolution&&!1===this._helpers.shadowMap.enabled&&(this._helpers.shadowMap.textureResolution=a.shadowMapResolution);void 0!==a.shadowMap&&(this._helpers.shadowMap.enabled=
a.shadowMap);void 0!==a.shadowMapMaxCascades&&(this._helpers.shadowMap.maxCascades=a.shadowMapMaxCascades);this._helpers.highlight.enabled=!0;void 0!==a.ssao&&(this._helpers.ssao.enabled=a.ssao);void 0!==a.ssaoAttenuation&&(this._helpers.ssao.attenuation=a.ssaoAttenuation);void 0!==a.ssaoRadius&&(this._helpers.ssao.radius=a.ssaoRadius);void 0!==a.ssaoFilterRadius&&console.error("The property ssaoFilterRadius is no longer supported as a render parameter.");void 0!==a.ssaoSamples&&(this._helpers.ssao.samples=
a.ssaoSamples);void 0!==a.drawShadowMapDebugQuad&&(this._drawShadowMapDebugQuad=a.drawShadowMapDebugQuad);void 0!==a.drawSSAODebugQuad&&(this._drawSSAOMapDebugQuad=a.drawSSAODebugQuad);this._renderer.ssaoEnabled=this._helpers.ssao.enabled;void 0!==a.offscreenRendering&&(this._helpers.offscreenRendering.enabled=a.offscreenRendering);a.background&&(this._helpers.offscreenRendering.background=a.background);void 0!==a.antialiasingEnabled&&(this._renderer.renderOptions.antialiasing=a.antialiasingEnabled?
"smaa":"none");void 0!==a.earlyOcclusionPixelDraw&&(this._renderer.renderOptions.earlyOcclusionPixelDraw=a.earlyOcclusionPixelDraw);void 0!==a.defaultHighlightOptions&&this._helpers.highlight.setDefaultOptions(a.defaultHighlightOptions);this._needsRender=!0};g.prototype.getRenderParams=function(){var a={};this._helpers.shadowMap.isSupported&&(a.shadowMap=this._helpers.shadowMap.enabled,a.shadowMapResolution=this._helpers.shadowMap.textureResolution,a.shadowMapMaxCascades=this._helpers.shadowMap.maxCascades);
this._helpers.ssao.isSupported&&(a.ssao=this._helpers.ssao.enabled,a.ssaoAttenuation=this._helpers.ssao.attenuation,a.ssaoRadius=this._helpers.ssao.radius,a.ssaoFilterRadius=this._helpers.ssao.filterRadius,a.ssaoSamples=this._helpers.ssao.samples);return a};g.prototype.modify=function(a,b,c,d){this._renderer.modify(a,b,c,d);for(d=0;d<b.length;++d)this._content.delete(b[d].uniqueName);for(d=0;d<a.length;++d)this._content.set(a[d].uniqueName,a[d]);for(d=0;d<c.length;++d)x(this._content.get(c[d].renderGeometry.uniqueName)===
c[d].renderGeometry)};g.prototype.getContent=function(){return this._content};g.prototype.getPickRay=function(a,b,c,d,f,e){t.unproject(t.createFrom(a[0],a[1],0),d,c.projectionMatrix,c.fullViewport,f);t.unproject(t.createFrom(a[0],a[1],1),d,c.projectionMatrix,c.fullViewport,e)};g.prototype.getProjectionMatrix=function(a,b,c,d,f){b=r.fovx2fovy(b,a[2],a[3]);u.perspective(180*b/Math.PI,a[2]/a[3],c,d,f)};g.prototype.addExternalRenderer=function(a,b){return this._renderer.addExternalRenderer(a,b)};g.prototype.removeExternalRenderer=
function(a){return this._renderer.removeExternalRenderer(a)};g.prototype.getExternalRenderers=function(){return this._renderer.getExternalRenderers()};g.prototype.resetNeedsRender=function(){this._needsRender=!1;this._renderer.resetNeedsRender()};g.prototype.needsRender=function(){return this._needsRender||this._renderer.needsRender()};g.prototype.setNeedsRender=function(){this._needsRender=!0};g.prototype.render=function(b,c,d){var f=b.viewport;this._renderer.prepareRender(b);if(this._helpers.shadowMap.enabled){a.ENABLE_PROFILE_DEPTH_RANGE&&
e.begin("depthRange");var g=this.computeDepthRange(b);a.ENABLE_PROFILE_DEPTH_RANGE&&e.end("depthRange");this._helpers.shadowMap.prepare(b,c,this._content,g);c=this._helpers.shadowMap.getCascades();for(g=0;g<c.length;++g){var k=c[g];k.camera.setGLViewport(this._rctx);this._renderer.renderGeometryPass(l.MATERIAL_DEPTH_SHADOWMAP,k.camera)}this._helpers.shadowMap.finish(d);b.setGLViewport(this._rctx)}this._helpers.shadowMap.bindAll(this._programRep);this._renderer.renderAuxiliaryBuffers(b,d,this._helpers);
this._renderer.render(b,d,this._helpers);this._drawShadowMapDebugQuad&&this._helpers.shadowMap.enabled&&(b=u.ortho(f[0],f[2],f[1],f[3],-1,1),this._helpers.shadowMap.drawDebugQuad(b));this._drawSSAOMapDebugQuad&&this._helpers.ssao.enabled&&(b=u.ortho(f[0],f[2],f[1],f[3],-1,1),this._helpers.ssao.drawQuad(b))};g.prototype.getEdgeView=function(){return this._renderer.edgeView};g.prototype.computeDepthRange=function(a){var c=b.depthRangeFromScene(a,this._content,this._stage.getLayers());d.union(c,this.getExternalRenderers().queryDepthRange(a));
c.near=Math.max(a.near,c.near);c.far=Math.min(a.far,c.far);return c};return g}()})},"esri/core/TimeProfiler":function(){define(["require","exports"],function(q,h){q=function(){function e(a,d){void 0===d&&(d=.9);this._alpha=.9;this._name=a;this._alpha=d;this.reset()}e.prototype.reset=function(){this._smooth=this._sum=this._count=0;this._min=Infinity;this._max=0};Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,
"count",{get:function(){return this._count},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"average",{get:function(){return 0<this._count?this._sum/this._count:0},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"smooth",{get:function(){return this._smooth},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"min",{get:function(){return this._min},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"max",{get:function(){return this._max},
enumerable:!0,configurable:!0});e.prototype.begin=function(){this._startTime=performance.now()};e.prototype.end=function(){var a=performance.now()-this._startTime;this._count+=1;this._sum+=a;this._smooth=this._alpha*a+(1-this._alpha)*this._smooth;this._min=Math.min(this._min,a);this._max=Math.max(this._max,a)};e.prototype.toJSON=function(){return{name:this.name,count:this.count,average:this.average,smooth:this.smooth,min:this.min,max:this.max}};return e}();(function(e){function a(a){a in b||(b[a]=
new e(a));return b[a]}function d(b){console.log(a(b).toJSON())}var b={},g={};e.get=a;e.begin=function(b){a(b).begin()};e.end=function(b,f){void 0===f&&(f=!0);a(b).end();var c=performance.now();!f||b in g&&!(c>=g[b]+1E3)||(d(b),g[b]=c)};e.log=d;e.logAll=function(){for(var a in b)d(a)}})(q||(q={}));return q})},"esri/views/3d/webgl-engine/lib/depthRangeUtils":function(){define("require exports ../../../../core/PooledArray ../../support/intersectionUtils ./ComponentUtils ./depthRange ./gl-matrix ./Util".split(" "),
function(q,h,e,a,d,b,g,c){function f(a,c){var d=b.empty(),f=c.getObjects();c.getSpatialQueryAccelerator()?k(d,a,c.getSpatialQueryAccelerator()):n(d,a,f);return d}function k(a,c,d){var f=c.eye,e=c.viewForward,g=c.frustumPlanes,k=function(a){return!a.areAllComponentsHidden()},n=d.objectCount;500>n?(b.set(v,c.near,Math.min(a.near,c.far)),d.forEachInDepthRange(f,e,"front-to-back",v,function(b,d){l(a,c,b);v.far=a.near;d.setRange(v)},g,k),b.set(v,Math.max(a.far,c.near),c.far),d.forEachInDepthRange(f,e,
"back-to-front",v,function(b,d){l(a,c,b);v.near=a.far;d.setRange(v)},g,k)):(n=Math.max(Math.min(n,500),Math.ceil(.1*n)),f=d.findClosest(e,"front-to-back",g,k,n),d=d.findClosest(e,"back-to-front",g,k,n),f&&d&&(m(a,c,f.getCenter(),f.getBSRadius()),m(a,c,d.getCenter(),d.getBSRadius())))}function n(a,c,d){A.clear();d.forEach(function(a){a.areAllComponentsHidden()||A.add(a)});A.empty||(A.sort(c),b.set(v,c.near,Math.min(a.near,c.far)),A.forEachInDepthRange(v,"front-to-back",function(b,d,f){d<a.near&&l(a,
c,b)}),b.set(v,Math.max(a.far,c.near),c.far),A.forEachInDepthRange(v,"back-to-front",function(b,c,d){a.far=Math.max(a.far,d)}))}function l(b,c,d){if(!d.areAllComponentsHidden()&&a.frustumSphere(c.frustumPlanes,d.getCenter(),d.getBSRadius())){var f=d.objectTransformation,e=x;d.geometryRecords.forEach(function(a){g.mat4d.multiply(f,a.getShaderTransformation(),e);var d=g.mat4d.maxScale(e);a=a.geometry.getBoundingInfo();p(b,c,a,e,d)})}}function p(b,c,d,f,e){var k=c.eye,l=c.viewForward;g.mat4d.multiplyVec3(f,
d.center,u);k=l[0]*(u[0]-k[0])+l[1]*(u[1]-k[1])+l[2]*(u[2]-k[2]);l=d.bsRadius*e;if(!(k-l>b.near&&k+l<b.far)&&a.frustumSphere(c.frustumPlanes,u,l))if(100<d.bsRadius&&d.getChildren())for(d=d.getChildren(),k=0;8>k;++k)d[k]&&p(b,c,d[k],f,e);else C.unionDepthRangeWithAABB(b,c.viewProjectionMatrix,f,d.bbMin,d.bbMax)}function m(a,b,c,d){var f=b.eye;b=b.viewForward;c=(c[0]-f[0])*b[0]+(c[1]-f[1])*b[1]+(c[2]-f[2])*b[2];a.near=Math.min(a.near,c-d);a.far=Math.max(a.far,c+d)}Object.defineProperty(h,"__esModule",
{value:!0});h.depthRangeFromScene=function(a,c,d){if(1E4>c.size)return y.compute(a,c);c=b.empty();for(var e in d)b.union(c,f(a,d[e]));return c};h.depthRangeFromLayer=f;q=function(){function a(){this._items=new e({allocator:function(){return{obj:null,distance:0,near:0,far:0}}})}Object.defineProperty(a.prototype,"length",{get:function(){return this._items.length},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"empty",{get:function(){return 0===this._items.length},enumerable:!0,configurable:!0});
a.prototype.clear=function(){this._items.clear()};a.prototype.add=function(a){this._items.pushNew().obj=a};a.prototype.sort=function(a){var b=a.eye,c=a.viewForward;this._items.forEach(function(a){var d=a.obj,f=d.getCenter(),d=d.getBSRadius(),f=(f[0]-b[0])*c[0]+(f[1]-b[1])*c[1]+(f[2]-b[2])*c[2];a.distance=f;a.near=f-d;a.far=f+d});this._items.sort(function(a,b){return a.distance-b.distance})};a.prototype.forEachInDepthRange=function(a,b,c){if("front-to-back"===b)for(b=0;b<this._items.length;++b){var d=
this._items.data[b];d.far<a.near||d.near>a.far||c(d.obj,d.near,d.far)}else for(b=this._items.length-1;0<=b;--b)d=this._items.data[b],d.far<a.near||d.near>a.far||c(d.obj,d.near,d.far)};return a}();var r=function(){function a(){this.view=g.mat4d.create();this.viewProj=g.mat4d.create();this.planes=[g.vec4d.create(),g.vec4d.create(),g.vec4d.create(),g.vec4d.create(),g.vec4d.create(),g.vec4d.create()];this.geometries=[];this.near=[];this.far=[];this.nearCandidates=[];this.farCandidates=[];this.range={near:0,
far:0};this.looseRange={near:0,far:0}}a.prototype.compute=function(a,b){var c=this;this.reset();g.mat4d.set(a.viewMatrix,this.view);g.mat4d.multiply(a.projectionMatrix,this.view,this.viewProj);a.copyFrustumPlanes(this.planes);a=this.view;var f=a[2],e=a[6],k=a[10],l=a[14];a=this.range;var m=0;b.forEach(function(a){if(!d.isAllHidden(a.instanceParameters.componentVisibilities,a.componentOffsets)&&a.castShadow){var b,g;a.hasShaderTransformation?(b=a.getBoundingSphere(a.getShaderTransformation(),1,u),
g=u):(b=a.bsRadius,g=a.center);g=f*g[0]+e*g[1]+k*g[2]+l;c.geometries[m]=a;c.near[m]=-(g+b);c.far[m]=-(g-b);++m}});if(0===this.geometries.length)return a;for(b=0;b<this.geometries.length;++b)this.near[b]>a.far&&(a.far=this.near[b]),2<this.near[b]&&this.far[b]<a.near&&(a.near=this.far[b]);var n=this.looseRange;n.near=Math.max(.5*a.near,2);n.far=2*a.far;var h=0,p=0;for(b=0;b<this.geometries.length;++b)this.near[b]<a.near&&(this.near[b]>=n.near?a.near=this.near[b]:this.nearCandidates[h++]=b),this.far[b]>
a.far&&(this.far[b]<=n.far?a.far=this.far[b]:this.farCandidates[p++]=b);if(0===this.nearCandidates.length&&0===this.farCandidates.length)return a;this.nearCandidates.sort(function(a,b){return c.near[a]<c.near[b]?-1:c.near[a]>c.near[b]?1:0});this.farCandidates.sort(function(a,b){return c.far[a]<c.far[b]?1:c.far[a]>c.far[b]?-1:0});for(b=0;b<this.nearCandidates.length;++b)n=this.nearCandidates[b],this.near[n]<a.near&&(n=this.geometries[n],h=n.boundingInfo,this.includeNearBoundingInfoRec(h,n.getShaderTransformation()));
for(b=0;b<this.farCandidates.length;++b)n=this.farCandidates[b],this.far[n]>a.far&&(n=this.geometries[n],h=n.boundingInfo,this.includeFarBoundingInfoRec(h,n.getShaderTransformation()));return a};a.prototype.reset=function(){this.geometries.length=0;this.near.length=0;this.far.length=0;this.nearCandidates.length=0;this.farCandidates.length=0;this.range.near=Number.MAX_VALUE;this.range.far=-Number.MAX_VALUE};a.prototype.includeNearBoundingInfoRec=function(a,b){var c=a.getBSRadius(),d=a.getCenter();
g.mat4d.multiplyVec3(b,d,u);var d=g.mat4d.maxScale(b),f=u[0],e=u[1],k=u[2],c=c*d;if(!(this.planes[0][0]*f+this.planes[0][1]*e+this.planes[0][2]*k+this.planes[0][3]>c||this.planes[1][0]*f+this.planes[1][1]*e+this.planes[1][2]*k+this.planes[1][3]>c||this.planes[2][0]*f+this.planes[2][1]*e+this.planes[2][2]*k+this.planes[2][3]>c||this.planes[3][0]*f+this.planes[3][1]*e+this.planes[3][2]*k+this.planes[3][3]>c||(d=this.view[2]*f+this.view[6]*e+this.view[10]*k+this.view[14],f=d+c,2>-(d-c)||-f>=this.range.near)))if(-f>
this.looseRange.near)this.range.near=-f;else{if(100<c&&(c=a.getChildren(),void 0!==c)){for(a=0;8>a;++a)void 0!==c[a]&&this.includeNearBoundingInfoRec(c[a],b);return}C.unionDepthRangeWithAABB(this.range,this.viewProj,b,a.getBBMin(),a.getBBMax())}};a.prototype.includeFarBoundingInfoRec=function(a,b){var c=a.getBSRadius(),d=a.getCenter();g.mat4d.multiplyVec3(b,d,u);var d=g.mat4d.maxScale(b),f=u[0],e=u[1],k=u[2],c=c*d;if(!(this.planes[0][0]*f+this.planes[0][1]*e+this.planes[0][2]*k+this.planes[0][3]>
c||this.planes[1][0]*f+this.planes[1][1]*e+this.planes[1][2]*k+this.planes[1][3]>c||this.planes[2][0]*f+this.planes[2][1]*e+this.planes[2][2]*k+this.planes[2][3]>c||this.planes[3][0]*f+this.planes[3][1]*e+this.planes[3][2]*k+this.planes[3][3]>c||(d=this.view[2]*f+this.view[6]*e+this.view[10]*k+this.view[14]-c,-d<=this.range.far)))if(-d<this.looseRange.far)this.range.far=-d;else{if(100<c&&(c=a.getChildren(),void 0!==c)){for(a=0;8>a;++a)void 0!==c[a]&&this.includeFarBoundingInfoRec(c[a],b);return}C.unionDepthRangeWithAABB(this.range,
this.viewProj,b,a.getBBMin(),a.getBBMax())}};return a}();h.DepthRangeFromRenderGeometries=r;h=function(){function a(){this.modelViewProj=g.mat4d.create();this.clipPosition=[g.vec4d.create(),g.vec4d.create(),g.vec4d.create(),g.vec4d.create(),g.vec4d.create(),g.vec4d.create(),g.vec4d.create(),g.vec4d.create()]}a.prototype.unionDepthRangeWithAABB=function(a,b,c,d,f){var e=this.modelViewProj;g.mat4d.multiply(b,c,e);b=!1;for(c=0;8>c;++c){var k=this.clipPosition[c],l=0===c||3===c||4===c||7===c?d[0]:f[0],
m=0===c||1===c||4===c||5===c?d[1]:f[1],n=4>c?d[2]:f[2];k[0]=e[0]*l+e[4]*m+e[8]*n+e[12];k[1]=e[1]*l+e[5]*m+e[9]*n+e[13];k[2]=e[2]*l+e[6]*m+e[10]*n+e[14];k[3]=e[3]*l+e[7]*m+e[11]*n+e[15]}for(c=0;12>c;++c){d=this.clipTriangle(this.clipPosition[t[c][0]],this.clipPosition[t[c][1]],this.clipPosition[t[c][2]]);f=!0;for(e=0;e<d.length;++e)if(k=d[e][3],2<=k){f=!1;break}if(!f)for(b=!0,e=0;e<d.length;++e)k=d[e][3],k<a.near&&(a.near=k),k>a.far&&(a.far=k)}return b};a.prototype.inside=function(a,b){if(0===b)return a[0]>=
-a[3];if(1===b)return a[1]>=-a[3];if(2===b)return a[0]<=a[3];if(3===b)return a[1]<=a[3];c.assert(!1)};a.prototype.intersect=function(a,b,c){var d=0;0===c?d=(-a[3]-a[0])/(b[0]-a[0]+b[3]-a[3]):1===c?d=(-a[3]-a[1])/(b[1]-a[1]+b[3]-a[3]):2===c?d=(a[3]-a[0])/(b[0]-a[0]-b[3]+a[3]):3===c&&(d=(a[3]-a[1])/(b[1]-a[1]-b[3]+a[3]));return g.vec4d.lerp(a,b,d,g.vec4d.create())};a.prototype.clipTriangle=function(a,b,c){a=[a,b,c];for(b=0;4>b;++b){c=a;a=[];for(var d=0;d<c.length;++d){var f=c[d],e=c[(d+1)%c.length];
this.inside(e,b)?(this.inside(f,b)||a.push(this.intersect(f,e,b)),a.push(e)):this.inside(f,b)&&a.push(this.intersect(f,e,b))}}return a};return a}();var t=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],u=g.vec3d.create(),x=g.mat4d.create(),v=b.empty(),A=new q,y=new r,C=new h})},"esri/views/3d/webgl-engine/lib/ShadowMap":function(){define("require exports ../../../../core/Logger ./Camera ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./gl-matrix ./glUtil3D ./Util ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util ../../../webgl/VertexArrayObject".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m){function r(a,b){g.vec3d.set3(a[b],a[b+3],a[b+6],ea);return ea}var t=e.getLogger("esri.views.3d.webgl-engine.lib.ShadowMap"),u=function(){return function(){this.camera=new a;this.lightMat=g.mat4d.create()}}();q=function(){function a(a,b){this.doShadowMapMipmapsWork=!1;this.textureRes=4096;this.numCascades=1;this.maxNumCascades=2;this.cascadeDistances=[0,0,0,0,0];this.cascades=[];this.programRep=a;this.rctx=b;this.emptyTexture=c.createEmptyTexture(b);for(a=0;4>
a;++a)this.cascades.push(new u)}a.prototype.dispose=function(){this.emptyTexture.dispose();this.emptyTexture=null};Object.defineProperty(a.prototype,"isSupported",{get:function(){return this.rctx.capabilities.standardDerivatives},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"textureResolution",{get:function(){return this.textureRes},set:function(a){this.textureRes=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maxCascades",{get:function(){return this.maxNumCascades},
set:function(a){this.maxNumCascades=f.clamp(Math.floor(a),1,4)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"enabled",{get:function(){return!!this.depthTexture},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});a.prototype.getDepthTexture=function(){return this.depthTexture};a.prototype.getCascades=function(){for(var a=0;a<this.numCascades;++a)O[a]=this.cascades[a];O.length=this.numCascades;return O};a.prototype.prepare=function(a,b,c,d){f.assert(this.enabled);
g.mat4d.multiply(a.projectionMatrix,a.viewMatrix,v);var e=d.near,k=d.far;2>e&&(e=2);2>k&&(k=2);e>=k&&(e=2,k=4);this.numCascades=Math.min(1+Math.floor(f.logWithBase(k/e,4)),this.maxNumCascades);c=Math.pow(k/e,1/this.numCascades);for(d=0;d<this.numCascades+1;++d)this.cascadeDistances[d]=e*Math.pow(c,d);g.mat4d.inverse(v,A);g.mat4d.lookAt([0,0,0],[-b[0],-b[1],-b[2]],[0,1,0],I);c=a.viewMatrix;a=a.projectionMatrix;for(d=0;d<this.numCascades;++d){var l=this.cascades[d],k=-this.cascadeDistances[d],e=-this.cascadeDistances[d+
1],k=(a[10]*k+a[14])/Math.abs(a[11]*k+a[15]),e=(a[10]*e+a[14])/Math.abs(a[11]*e+a[15]);f.assert(k<e);for(var m=0;8>m;++m){g.vec4d.set4(0===m%4||3===m%4?-1:1,0===m%4||1===m%4?-1:1,4>m?k:e,1,y);g.mat4d.multiplyVec4(A,y,C[m]);for(var n=0;3>n;++n)C[m][n]/=C[m][3]}g.vec3d.negate(C[0],K);g.mat4d.translate(I,K,x);l.camera.viewMatrix=x;for(m=0;8>m;++m)g.mat4d.multiplyVec3(l.camera.viewMatrix,C[m]);g.vec3d.set(C[0],B);g.vec3d.set(C[0],D);for(m=1;8>m;++m)for(n=0;3>n;++n)B[n]=Math.min(B[n],C[m][n]),D[n]=Math.max(D[n],
C[m][n]);B[2]-=200;D[2]+=200;l.camera.near=-D[2];l.camera.far=-B[2];e=1/C[0][3];k=1/C[4][3];f.assert(e<k);var n=e+Math.sqrt(e*k),m=Math.sin(Math.acos(c[2]*b[0]+c[6]*b[1]+c[10]*b[2])),n=n/m,e=C,h=n,p=m,m=E,u=J,t=F,q=M,n=H;g.vec2d.set2(0,0,U);for(var L=0;4>L;++L)g.vec2d.add(U,e[L],U);g.vec2d.scale(U,.25);g.vec2d.set2(0,0,N);for(L=4;8>L;++L)g.vec2d.add(N,e[L],N);g.vec2d.scale(N,.25);g.vec2d.lerp(e[4],e[5],.5,S[0]);g.vec2d.lerp(e[5],e[6],.5,S[1]);g.vec2d.lerp(e[6],e[7],.5,S[2]);g.vec2d.lerp(e[7],e[4],
.5,S[3]);for(var P=0,O=g.vec2d.dist2(S[0],U),L=1;4>L;++L){var ea=g.vec2d.dist2(S[L],U);ea<O&&(O=ea,P=L)}g.vec2d.subtract(S[P],e[P+4],aa);L=aa[0];aa[0]=-aa[1];aa[1]=L;g.vec2d.subtract(N,U,V);g.vec2d.lerp(aa,V,p);g.vec2d.normalize(aa);P=p=void 0;p=P=g.vec2d.dot(g.vec2d.subtract(e[0],U,T),aa);for(L=1;8>L;++L)O=g.vec2d.dot(g.vec2d.subtract(e[L],U,T),aa),O<p?p=O:O>P&&(P=O);g.vec2d.set(U,m);g.vec2d.scale(aa,p-h,T);g.vec2d.add(m,T,m);for(var ea=-1,ga=1,L=h=O=0;8>L;++L){g.vec2d.subtract(e[L],m,Q);g.vec2d.normalize(Q);
var Ha=aa[0]*Q[1]-aa[1]*Q[0];0<Ha?Ha>ea&&(ea=Ha,O=L):Ha<ga&&(ga=Ha,h=L)}f.verify(0<ea,"leftArea");f.verify(0>ga,"rightArea");g.vec2d.scale(aa,p,G);g.vec2d.add(G,U,G);g.vec2d.scale(aa,P,X);g.vec2d.add(X,U,X);Z[0]=-aa[1];Z[1]=aa[0];u=f.rayRay2D(m,e[h],X,g.vec2d.add(X,Z,T),1,u);t=f.rayRay2D(m,e[O],X,T,1,t);q=f.rayRay2D(m,e[O],G,g.vec2d.add(G,Z,T),1,q);e=f.rayRay2D(m,e[h],G,T,1,n);f.verify(u,"rayRay");f.verify(t,"rayRay");f.verify(q,"rayRay");f.verify(e,"rayRay");t=E;e=J;m=M;q=H;n=l.camera.projectionMatrix;
g.vec2d.scale(g.vec2d.subtract(m,q,fa),.5);R[0]=fa[0];R[1]=fa[1];R[2]=0;R[3]=fa[1];R[4]=-fa[0];R[5]=0;R[6]=fa[0]*fa[0]+fa[1]*fa[1];R[7]=fa[0]*fa[1]-fa[1]*fa[0];R[8]=1;R[6]=-g.vec2d.dot(r(R,0),t);R[7]=-g.vec2d.dot(r(R,1),t);t=g.vec2d.dot(r(R,0),m)+R[6];u=g.vec2d.dot(r(R,1),m)+R[7];L=g.vec2d.dot(r(R,0),q)+R[6];q=g.vec2d.dot(r(R,1),q)+R[7];t=-(t+L)/(u+q);R[0]+=R[1]*t;R[3]+=R[4]*t;R[6]+=R[7]*t;t=1/(g.vec2d.dot(r(R,0),m)+R[6]);u=1/(g.vec2d.dot(r(R,1),m)+R[7]);R[0]*=t;R[3]*=t;R[6]*=t;R[1]*=u;R[4]*=u;R[7]*=
u;R[2]=R[1];R[5]=R[4];R[8]=R[7];R[7]+=1;t=g.vec2d.dot(r(R,1),e)+R[7];u=g.vec2d.dot(r(R,2),e)+R[8];L=g.vec2d.dot(r(R,1),m)+R[7];q=g.vec2d.dot(r(R,2),m)+R[8];t=-.5*(t/u+L/q);R[1]+=R[2]*t;R[4]+=R[5]*t;R[7]+=R[8]*t;t=g.vec2d.dot(r(R,1),e)+R[7];u=g.vec2d.dot(r(R,2),e)+R[8];L=-u/t;R[1]*=L;R[4]*=L;R[7]*=L;n[0]=R[0];n[1]=R[1];n[2]=0;n[3]=R[2];n[4]=R[3];n[5]=R[4];n[6]=0;n[7]=R[5];n[8]=0;n[9]=0;n[10]=1;n[11]=0;n[12]=R[6];n[13]=R[7];n[14]=0;n[15]=R[8];l.camera.projectionMatrix[10]=2/(B[2]-D[2]);l.camera.projectionMatrix[14]=
-(B[2]+D[2])/(B[2]-D[2]);g.mat4d.multiply(l.camera.projectionMatrix,l.camera.viewMatrix,l.lightMat);e=this.textureRes/2;l.camera.viewport[0]=0===d%2?0:e;l.camera.viewport[1]=0===Math.floor(d/2)?0:e;l.camera.viewport[2]=e;l.camera.viewport[3]=e}this.lastOrigin=null;this.cascadeDistances[this.numCascades]=100*k;b=this.rctx;d=b.gl;b.bindFramebuffer(this.fbo);b.bindTexture(null,7);b.setClearColor(1,1,1,1);b.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT);b.setBlendingEnabled(!1)};a.prototype.finish=function(a){f.assert(this.enabled);
this.rctx.bindFramebuffer(a);this.doShadowMapMipmapsWork&&this.depthTexture.generateMipmap()};a.prototype.bind=function(a){var b=this.rctx,c=this.enabled;b.bindTexture(c?this.depthTexture:this.emptyTexture,7);b.bindProgram(a);a.setUniform1i("depthTex",7);a.setUniform1f("depthHalfPixelSz",c?.5/this.textureRes:-1);a.setUniform1i("shadowMapNum",this.numCascades);a.setUniform4f("shadowMapDistance",this.cascadeDistances[0],this.cascadeDistances[1],this.cascadeDistances[2],this.cascadeDistances[3])};a.prototype.bindAll=
function(a){a=a.getProgramsUsingUniform("shadowMapDistance");for(var b=0;b<a.length;b++)this.bind(a[b])};a.prototype.bindView=function(a,b){if(this.enabled){var c=this.lastOrigin;if(!c||c[0]!==b[0]||c[1]!==b[1]||c[2]!==b[2])for(this.lastOrigin=this.lastOrigin||g.vec3d.create(),g.vec3d.set(b,this.lastOrigin),c=0;c<this.numCascades;++c){g.mat4d.translate(this.cascades[c].lightMat,b,P);for(var d=0;16>d;++d)L[16*c+d]=P[d]}a.setUniformMatrix4fv("shadowMapMatrix",L)}};a.prototype.drawDebugQuad=function(a){f.assert(this.enabled);
var c=this.rctx,e=c.gl;if(!this.debugQuadVAO){var g=new Float32Array([0,0,0,0,256,0,1,0,0,256,0,1,256,256,1,1]);this.debugQuadVAO=new m(c,d.Default3D,{geometry:b.Pos2Tex},{geometry:k.createVertex(c,e.STATIC_DRAW,g)})}var g=this.programRep.get("showDepth"),l=this.debugQuadVAO;c.setDepthTestEnabled(!1);c.bindProgram(g);g.setUniformMatrix4fv("proj",a);g.setUniform1i("depthTex",0);c.bindTexture(this.depthTexture,0);c.bindVAO(l);p.assertCompatibleVertexAttributeLocations(l,g);c.drawArrays(e.TRIANGLE_STRIP,
0,p.vertexCount(l,"geometry"));c.setDepthTestEnabled(!0)};a.prototype.enable=function(){if(!this.enabled)if(this.isSupported){var a=this.rctx.gl;this.depthTexture=new l(this.rctx,{target:a.TEXTURE_2D,pixelFormat:a.RGBA,dataType:a.UNSIGNED_BYTE,wrapMode:a.CLAMP_TO_EDGE,samplingMode:a.NEAREST,flipped:!0,width:this.textureRes,height:this.textureRes});this.fbo=n.createWithAttachments(this.rctx,this.depthTexture,{colorTarget:0,depthStencilTarget:1,width:this.textureRes,height:this.textureRes})}else t.warn("Shadow maps are not supported for this browser or hardware")};
a.prototype.disable=function(){this.enabled&&this.fbo&&(this.fbo.dispose(),this.depthTexture=this.fbo=null)};return a}();var x=g.mat4d.create(),v=g.mat4d.create(),A=g.mat4d.create(),y=g.vec4d.create(),C=[];for(h=0;8>h;++h)C.push(g.vec4d.create());var B=g.vec3d.create(),D=g.vec3d.create(),E=g.vec2d.create(),J=g.vec2d.create(),F=g.vec2d.create(),M=g.vec2d.create(),H=g.vec2d.create(),I=g.mat4d.create(),K=g.vec3d.create(),O=[],P=g.mat4d.create(),L=new Float32Array(64),U=g.vec2d.create(),N=g.vec2d.create(),
S=[g.vec2d.create(),g.vec2d.create(),g.vec2d.create(),g.vec2d.create()],aa=g.vec2d.create(),V=g.vec2d.create(),T=g.vec2d.create(),Q=g.vec2d.create(),G=g.vec2d.create(),X=g.vec2d.create(),Z=g.vec2d.create(),ea=g.vec3d.create(),fa=g.vec2d.create(),R=g.mat3d.create();return q})},"esri/views/support/screenshotUtils":function(){define(["require","exports","../../core/tsSupport/assignHelper"],function(q,h,e){Object.defineProperty(h,"__esModule",{value:!0});h.adjustScreenshotSettings=function(a,d){a=e({format:"png",
quality:100},a);var b,g;a.includePadding?(b=d.width,g=d.height):(b=d.width-d.padding.left-d.padding.right,g=d.height-d.padding.top-d.padding.bottom);var c=b/g;void 0!==a.width&&void 0===a.height?a.height=a.width/c:void 0!==a.height&&void 0===a.width&&(a.width=c*a.height);void 0!==a.height&&(a.height=Math.floor(a.height));void 0!==a.width&&(a.width=Math.floor(a.width));a.area||a.includePadding||(a.area={x:d.padding.left,y:d.padding.top,width:b,height:g});return a};h.resampleHermite=function(a,d,b,
e,c,f,k){void 0===k&&(k=!0);var g=d/c;b/=f;for(var l=Math.ceil(g/2),h=Math.ceil(b/2),m=0;m<f;m++)for(var r=0;r<c;r++){for(var t=4*(r+(k?f-m-1:m)*c),u=0,x=0,v=0,A=0,y=0,C=0,B=0,q=(m+.5)*b,E=Math.floor(m*b);E<(m+1)*b;E++)for(var J=Math.abs(q-(E+.5))/h,F=(r+.5)*g,J=J*J,M=Math.floor(r*g);M<(r+1)*g;M++){var H=Math.abs(F-(M+.5))/l,u=Math.sqrt(J+H*H);-1<=u&&1>=u&&(u=2*u*u*u-3*u*u+1,0<u&&(H=4*(M+E*d),B+=u*a[H+3],v+=u,255>a[H+3]&&(u=u*a[H+3]/250),A+=u*a[H],y+=u*a[H+1],C+=u*a[H+2],x+=u))}e[t]=A/x;e[t+1]=y/
x;e[t+2]=C/x;e[t+3]=B/v}}})},"esri/views/webgl/RenderingContext":function(){define("require exports dojo/has ./enums ./InstanceCounter ./capabilities/isWebGL2Context ./capabilities/load".split(" "),function(q,h,e,a,d,b,g){return function(){function c(a,c){this.gl=null;this._blendEnabled=!1;this._blendColorState={r:0,g:0,b:0,a:0};this._blendFunctionState={srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0};this._blendEquationState={mode:32774,modeAlpha:32774};this._colorMaskState={r:!0,g:!0,b:!0,a:!0};this._polygonCullingEnabled=
!1;this._cullFace=1029;this._frontFace=2305;this._scissorTestEnabled=!1;this._scissorRect={x:0,y:0,width:0,height:0};this._depthTestEnabled=!1;this._depthFunction=513;this._clearDepth=1;this._depthWriteEnabled=!0;this._depthRange={zNear:0,zFar:1};this._viewport=null;this._polygonOffsetFillEnabled=this._stencilTestEnabled=!1;this._polygonOffset=[0,0];this._stencilFunction={face:1032,func:519,ref:0,mask:1};this._clearStencil=0;this._stencilWriteMask=1;this._stencilOperation={face:1032,fail:7680,zFail:7680,
zPass:7680};this._lineWidth=1;this._clearColor={r:0,g:0,b:0,a:0};this._activeRenderbuffer=this._activeFramebuffer=this._activeIndexBuffer=this._activeVertexBuffer=this._activeShaderProgram=null;this._activeTextureUnit=0;this._textureUnitMap={};this.contextVersion=b.default(a)?"webgl2":"webgl";this.gl=a;a instanceof WebGLRenderingContext&&this.gl.getExtension("OES_element_index_uint");this._capabilities=g.loadCapabilities(a,c);a=this.gl.getParameter(this.gl.VIEWPORT);this._viewport={x:a[0],y:a[1],
width:a[2],height:a[3]};a=this.capabilities.textureFilterAnisotropic;this._parameters={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:a?this.gl.getParameter(a.MAX_TEXTURE_MAX_ANISOTROPY):void 0,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS)};this.enforceState()}Object.defineProperty(c.prototype,
"contextAttributes",{get:function(){return this.gl.getContextAttributes()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"parameters",{get:function(){return this._parameters},enumerable:!0,configurable:!0});c.prototype.dispose=function(){this.bindVAO(null);this.unbindBuffer(34962);this.unbindBuffer(34963);this._textureUnitMap={};this.gl=null};c.prototype.setBlendingEnabled=function(a){this._blendEnabled!==a&&(!0===a?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),
this._blendEnabled=a)};c.prototype.setBlendColor=function(a,b,c,d){if(a!==this._blendColorState.r||b!==this._blendColorState.g||c!==this._blendColorState.b||d!==this._blendColorState.a)this.gl.blendColor(a,b,c,d),this._blendColorState.r=a,this._blendColorState.g=b,this._blendColorState.b=c,this._blendColorState.a=d};c.prototype.setBlendFunction=function(a,b){if(a!==this._blendFunctionState.srcRGB||b!==this._blendFunctionState.dstRGB)this.gl.blendFunc(a,b),this._blendFunctionState.srcRGB=a,this._blendFunctionState.srcAlpha=
a,this._blendFunctionState.dstRGB=b,this._blendFunctionState.dstAlpha=b};c.prototype.setBlendFunctionSeparate=function(a,b,c,d){if(this._blendFunctionState.srcRGB!==a||this._blendFunctionState.srcAlpha!==c||this._blendFunctionState.dstRGB!==b||this._blendFunctionState.dstAlpha!==d)this.gl.blendFuncSeparate(a,b,c,d),this._blendFunctionState.srcRGB=a,this._blendFunctionState.srcAlpha=c,this._blendFunctionState.dstRGB=b,this._blendFunctionState.dstAlpha=d};c.prototype.setBlendEquation=function(a){this._blendEquationState.mode!==
a&&(this.gl.blendEquation(a),this._blendEquationState.mode=a,this._blendEquationState.modeAlpha=a)};c.prototype.setBlendEquationSeparate=function(a,b){if(this._blendEquationState.mode!==a||this._blendEquationState.modeAlpha!==b)this.gl.blendEquationSeparate(a,b),this._blendEquationState.mode=a,this._blendEquationState.modeAlpha=b};c.prototype.setColorMask=function(a,b,c,d){if(this._colorMaskState.r!==a||this._colorMaskState.g!==b||this._colorMaskState.b!==c||this._colorMaskState.a!==d)this.gl.colorMask(a,
b,c,d),this._colorMaskState.r=a,this._colorMaskState.g=b,this._colorMaskState.b=c,this._colorMaskState.a=d};c.prototype.setClearColor=function(a,b,c,d){if(this._clearColor.r!==a||this._clearColor.g!==b||this._clearColor.b!==c||this._clearColor.a!==d)this.gl.clearColor(a,b,c,d),this._clearColor.r=a,this._clearColor.g=b,this._clearColor.b=c,this._clearColor.a=d};c.prototype.setFaceCullingEnabled=function(a){this._polygonCullingEnabled!==a&&(!0===a?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),
this._polygonCullingEnabled=a)};c.prototype.setPolygonOffsetFillEnabled=function(a){this._polygonOffsetFillEnabled!==a&&(!0===a?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._polygonOffsetFillEnabled=a)};c.prototype.setPolygonOffset=function(a,b){if(this._polygonOffset[0]!==a||this._polygonOffset[1]!==b)this._polygonOffset[0]=a,this._polygonOffset[1]=b,this.gl.polygonOffset(a,b)};c.prototype.setCullFace=function(a){this._cullFace!==a&&(this.gl.cullFace(a),
this._cullFace=a)};c.prototype.setFrontFace=function(a){this._frontFace!==a&&(this.gl.frontFace(a),this._frontFace=a)};c.prototype.setScissorTestEnabled=function(a){this._scissorTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._scissorTestEnabled=a)};c.prototype.setScissorRect=function(a,b,c,d){if(this._scissorRect.x!==a||this._scissorRect.y!==b||this._scissorRect.width!==c||this._scissorRect.height!==d)this.gl.scissor(a,b,c,d),this._scissorRect.x=
a,this._scissorRect.y=b,this._scissorRect.width=c,this._scissorRect.height=d};c.prototype.setDepthTestEnabled=function(a){this._depthTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._depthTestEnabled=a)};c.prototype.setClearDepth=function(a){this._clearDepth!==a&&(this.gl.clearDepth(a),this._clearDepth=a)};c.prototype.setDepthFunction=function(a){this._depthFunction!==a&&(this.gl.depthFunc(a),this._depthFunction=a)};c.prototype.setDepthWriteEnabled=
function(a){this._depthWriteEnabled!==a&&(this.gl.depthMask(a),this._depthWriteEnabled=a)};c.prototype.setDepthRange=function(a,b){if(this._depthRange.zNear!==a||this._depthRange.zFar!==b)this.gl.depthRange(a,b),this._depthRange.zNear=a,this._depthRange.zFar=b};c.prototype.setStencilTestEnabled=function(a){this._stencilTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._stencilTestEnabled=a)};c.prototype.setClearStencil=function(a){a!==this._clearStencil&&
(this.gl.clearStencil(a),this._clearStencil=a)};c.prototype.setStencilFunction=function(a,b,c){if(this._stencilFunction.func!==a||this._stencilFunction.ref!==b||this._stencilFunction.mask!==c)this.gl.stencilFunc(a,b,c),this._stencilFunction.face=1032,this._stencilFunction.func=a,this._stencilFunction.ref=b,this._stencilFunction.mask=c};c.prototype.setStencilFunctionSeparate=function(a,b,c,d){if(this._stencilFunction.face!==a||this._stencilFunction.func!==b||this._stencilFunction.ref!==c||this._stencilFunction.mask!==
d)this.gl.stencilFuncSeparate(a,b,c,d),this._stencilFunction.face=a,this._stencilFunction.func=b,this._stencilFunction.ref=c,this._stencilFunction.mask=d};c.prototype.setStencilWriteMask=function(a){this._stencilWriteMask!==a&&(this.gl.stencilMask(a),this._stencilWriteMask=a)};c.prototype.setStencilOp=function(a,b,c){if(this._stencilOperation.fail!==a||this._stencilOperation.zFail!==b||this._stencilOperation.zPass!==c)this.gl.stencilOp(a,b,c),this._stencilOperation.face=1032,this._stencilOperation.fail=
a,this._stencilOperation.zFail=b,this._stencilOperation.zPass=c};c.prototype.setStencilOpSeparate=function(a,b,c,d){if(this._stencilOperation.face!==a||this._stencilOperation.fail!==b||this._stencilOperation.zFail!==c||this._stencilOperation.zPass!==d)this.gl.stencilOpSeparate(a,b,c,d),this._stencilOperation.face=a,this._stencilOperation.face=a,this._stencilOperation.fail=b,this._stencilOperation.zFail=c,this._stencilOperation.zPass=d};c.prototype.setLineWidth=function(a){var b=this._lineWidth;this._lineWidth!==
a&&(this.gl.lineWidth(a),this._lineWidth=a);return b};c.prototype.setActiveTexture=function(b){var c=this._activeTextureUnit;0<=b&&b!==this._activeTextureUnit&&(this.gl.activeTexture(a.BASE_TEXTURE_UNIT+b),this._activeTextureUnit=b);return c};c.prototype.clear=function(a){a&&this.gl.clear(a)};c.prototype.drawArrays=function(a,b,c){this.gl.drawArrays(a,b,c)};c.prototype.drawElements=function(a,b,c,d){5123===c?this.gl.drawElements(a,b,c,d):5125===c&&this.gl.drawElements(a,b,c,d)};Object.defineProperty(c.prototype,
"capabilities",{get:function(){return this._capabilities},enumerable:!0,configurable:!0});c.prototype.setViewport=function(a,b,c,d){var f=this._viewport;if(f.x!==a||f.y!==b||f.width!==c||f.height!==d)f.x=a,f.y=b,f.width=c,f.height=d,this.gl.viewport(a,b,c,d)};c.prototype.getViewport=function(){return{x:this._viewport.x,y:this._viewport.y,width:this._viewport.width,height:this._viewport.height}};c.prototype.bindProgram=function(a){a?this._activeShaderProgram!==a&&(a.initialize(),this.gl.useProgram(a.glName),
this._activeShaderProgram=a):(this.gl.useProgram(null),this._activeShaderProgram=null)};c.prototype.bindTexture=function(a,b){void 0===b&&(b=0);-1===c._MAX_TEXTURE_IMAGE_UNITS&&(c._MAX_TEXTURE_IMAGE_UNITS=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS));(b>=c._MAX_TEXTURE_IMAGE_UNITS||0>b)&&console.error("Input texture unit is out of range of available units!");var d=this._textureUnitMap[b];this.setActiveTexture(b);null==a||null==a.glName?(null!=d&&(this.gl.bindTexture(d.descriptor.target,null),
d.setBoundToUnit(b,!1)),this._textureUnitMap[b]=null):d&&d.id===a.id?a.applyChanges():(this.gl.bindTexture(a.descriptor.target,a.glName),a.setBoundToUnit(b,!0),a.applyChanges(),this._textureUnitMap[b]=a)};c.prototype.bindFramebuffer=function(a){a?this._activeFramebuffer!==a&&(a.initialize()||this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,a.glName),this._activeFramebuffer=a):(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this._activeFramebuffer=null)};c.prototype.bindBuffer=function(a){a&&(34962===
a.bufferType?this._activeVertexBuffer=c._bindBuffer(this.gl,a,a.bufferType,this._activeVertexBuffer):this._activeIndexBuffer=c._bindBuffer(this.gl,a,a.bufferType,this._activeIndexBuffer))};c.prototype.bindRenderbuffer=function(a){var b=this.gl;a||(b.bindRenderbuffer(b.RENDERBUFFER,null),this._activeRenderbuffer=null);this._activeRenderbuffer!==a&&(b.bindRenderbuffer(b.RENDERBUFFER,a.glName),this._activeRenderbuffer=a)};c.prototype.unbindBuffer=function(a){34962===a?this._activeVertexBuffer=c._bindBuffer(this.gl,
null,a,this._activeVertexBuffer):this._activeIndexBuffer=c._bindBuffer(this.gl,null,a,this._activeIndexBuffer)};c.prototype.bindVAO=function(a){a?this._activeVertexArrayObject&&this._activeVertexArrayObject.id===a.id||(a.bind(),this._activeVertexArrayObject=a):this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null)};c.prototype.getBoundTexture=function(a){return this._textureUnitMap[a]};c.prototype.getBoundFramebufferObject=function(){return this._activeFramebuffer};
c.prototype.getBoundVAO=function(){return this._activeVertexArrayObject};c.prototype.resetState=function(){this.bindProgram(null);this.bindVAO(null);this.bindFramebuffer(null);this.unbindBuffer(34962);this.unbindBuffer(34963);for(var a=0;a<this.parameters.maxTextureImageUnits;a++)this.bindTexture(null,a);this.setBlendingEnabled(!1);this.setBlendFunction(1,0);this.setBlendEquation(32774);this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);this.setCullFace(1029);this.setFrontFace(2305);this.setPolygonOffsetFillEnabled(!1);
this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(513);this.setDepthRange(0,1);this.setStencilTestEnabled(!1);this.setStencilFunction(519,0,0);this.setStencilOp(7680,7680,7680);this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,!0);this.setStencilWriteMask(4294967295);this.setDepthWriteEnabled(!0);this.setViewport(0,0,this.gl.canvas.width,
this.gl.canvas.height)};c.prototype.enforceState=function(){var b=this.gl,c=this._capabilities.vao;c&&c.bindVertexArray(null);for(var d=0;d<this.parameters.maxVertexAttributes;d++)b.disableVertexAttribArray(d);this._activeVertexBuffer?b.bindBuffer(this._activeVertexBuffer.bufferType,this._activeVertexBuffer.glName):b.bindBuffer(34962,null);this._activeIndexBuffer?b.bindBuffer(this._activeIndexBuffer.bufferType,this._activeIndexBuffer.glName):b.bindBuffer(34963,null);if(c&&this._activeVertexArrayObject){if(c=
this._activeVertexArrayObject)this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null;this.bindVAO(c)}b.bindFramebuffer(b.FRAMEBUFFER,this._activeFramebuffer?this._activeFramebuffer.glName:null);b.useProgram(this._activeShaderProgram?this._activeShaderProgram.glName:null);b.blendColor(this._blendColorState.r,this._blendColorState.g,this._blendColorState.b,this._blendColorState.a);b.bindRenderbuffer(b.RENDERBUFFER,this._activeRenderbuffer?this._activeRenderbuffer.glName:null);!0===
this._blendEnabled?b.enable(this.gl.BLEND):b.disable(this.gl.BLEND);b.blendEquationSeparate(this._blendEquationState.mode,this._blendEquationState.modeAlpha);b.blendFuncSeparate(this._blendFunctionState.srcRGB,this._blendFunctionState.dstRGB,this._blendFunctionState.srcAlpha,this._blendFunctionState.dstAlpha);b.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a);b.clearDepth(this._clearDepth);b.clearStencil(this._clearStencil);b.colorMask(this._colorMaskState.r,
this._colorMaskState.g,this._colorMaskState.b,this._colorMaskState.a);b.cullFace(this._cullFace);b.depthFunc(this._depthFunction);b.depthRange(this._depthRange.zNear,this._depthRange.zFar);!0===this._depthTestEnabled?b.enable(b.DEPTH_TEST):b.disable(b.DEPTH_TEST);b.depthMask(this._depthWriteEnabled);b.frontFace(this._frontFace);b.lineWidth(this._lineWidth);!0===this._polygonCullingEnabled?b.enable(b.CULL_FACE):b.disable(b.CULL_FACE);b.polygonOffset(this._polygonOffset[0],this._polygonOffset[1]);!0===
this._polygonOffsetFillEnabled?b.enable(b.POLYGON_OFFSET_FILL):b.disable(b.POLYGON_OFFSET_FILL);b.scissor(this._scissorRect.x,this._scissorRect.y,this._scissorRect.width,this._scissorRect.height);!0===this._scissorTestEnabled?b.enable(b.SCISSOR_TEST):b.disable(b.SCISSOR_TEST);b.stencilFunc(this._stencilFunction.func,this._stencilFunction.ref,this._stencilFunction.mask);b.stencilOpSeparate(this._stencilOperation.face,this._stencilOperation.fail,this._stencilOperation.zFail,this._stencilOperation.zPass);
!0===this._stencilTestEnabled?b.enable(b.STENCIL_TEST):b.disable(b.STENCIL_TEST);b.stencilMask(this._stencilWriteMask);for(c=0;c<this.parameters.maxTextureImageUnits;c++)b.activeTexture(a.BASE_TEXTURE_UNIT+c),b.bindTexture(3553,null),(d=this._textureUnitMap[c])&&b.bindTexture(d.descriptor.target,d.glName);b.activeTexture(a.BASE_TEXTURE_UNIT+this._activeTextureUnit);b.viewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height)};c._bindBuffer=function(a,b,c,d){if(!b)return a.bindBuffer(c,
null),null;if(d===b)return d;a.bindBuffer(c,b.glName);return b};c._MAX_TEXTURE_IMAGE_UNITS=-1;return c}()})},"esri/views/webgl/enums":function(){define(["require","exports"],function(q,h){Object.defineProperty(h,"__esModule",{value:!0});h.BASE_TEXTURE_UNIT=33984})},"esri/views/webgl/InstanceCounter":function(){define(["require","exports"],function(q,h){return function(){function e(){this._instanceCount={textureCount:0,bufferCount:0,vaoCount:0,programCount:0,framebufferCount:0,renderBufferCount:0}}
e.prototype.incrementCount=function(a){switch(a){case 0:this._instanceCount.textureCount++;break;case 1:this._instanceCount.bufferCount++;break;case 2:this._instanceCount.vaoCount++;break;case 3:this._instanceCount.programCount++;break;case 4:this._instanceCount.framebufferCount++;break;case 5:this._instanceCount.renderBufferCount++}};e.prototype.decrementCount=function(a){switch(a){case 0:this._instanceCount.textureCount--;break;case 1:this._instanceCount.bufferCount--;break;case 2:this._instanceCount.vaoCount--;
break;case 3:this._instanceCount.programCount--;break;case 4:this._instanceCount.framebufferCount--;break;case 5:this._instanceCount.renderBufferCount--}};e.prototype.printResourceCount=function(){console.log("Live objects:");console.log("Textures: "+this._instanceCount.textureCount);console.log("Buffers: "+this._instanceCount.bufferCount);console.log("VAOs: "+this._instanceCount.vaoCount);console.log("Programs: "+this._instanceCount.programCount);console.log("Framebuffers: "+this._instanceCount.framebufferCount);
console.log("Renderbuffers: "+this._instanceCount.renderBufferCount)};return e}()})},"esri/views/webgl/capabilities/load":function(){define("require exports ./DisjointTimerQuery ./Instancing ./isWebGL2Context ./VertexArrayObjects".split(" "),function(q,h,e,a,d,b){function g(a,b,e,g,l){if(g&&d.default(a))return!0;if(b[e])return!1;for(b=0;b<l.length;b++)if(a.getExtension(l[b]))return!0;return!1}Object.defineProperty(h,"__esModule",{value:!0});h.loadCapabilities=function(c,f){f=f&&f.disabledExtensions||
{};var k=a.load(c,f),n=b.load(c,f),l;l=f.compressedTextureS3TC?null:(l=c.getExtension("WEBGL_compressed_texture_s3tc"))?{COMPRESSED_RGB_S3TC_DXT1:l.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:l.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:l.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:l.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null;var h;h=f.textureFilterAnisotropic?null:(h=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||
c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"))?{MAX_TEXTURE_MAX_ANISOTROPY:h.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:h.TEXTURE_MAX_ANISOTROPY_EXT}:null;var m=e.load(c,f),r;if(d.default(c))r=f.colorBufferFloat||!c.getExtension("EXT_color_buffer_float")?null:{R16F:c.R16F,RG16F:c.RG16F,RGBA16F:c.RGBA16F,R32F:c.R32F,RG32F:c.RG32F,RGBA32F:c.RGBA32F,R11F_G11F_B10F:c.R11F_G11F_B10F};else if(c instanceof WebGLRenderingContext){r=!f.colorBufferFloat&&c.getExtension("EXT_color_buffer_half_float");
var t=!f.colorBufferFloat&&c.getExtension("WEBGL_color_buffer_float");r=r||t?{RGBA16F:r?r.RGBA16F_EXT:void 0,RGBA32F:t?t.RGBA32F_EXT:void 0}:null}else r=void 0;t=d.default(c)?{MIN:c.MIN,MAX:c.MAX}:f.blendMinMax?null:(t=c.getExtension("EXT_blend_minmax"))?{MIN:t.MIN_EXT,MAX:t.MAX_EXT}:null;return{instancing:k,vao:n,compressedTextureS3TC:l,textureFilterAnisotropic:h,disjointTimerQuery:m,colorBufferFloat:r,blendMinMax:t,depthTexture:g(c,f,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture",
"WEBKIT_WEBGL_depth_texture"]),standardDerivatives:g(c,f,"standardDerivatives",!0,["OES_standard_derivatives"]),shaderTextureLOD:g(c,f,"shaderTextureLOD",!0,["EXT_shader_texture_lod"]),textureFloatLinear:g(c,f,"textureFloatLinear",!1,["OES_texture_float_linear"]),fragDepth:g(c,f,"fragDepth",!0,["EXT_frag_depth"])}}})},"esri/views/webgl/capabilities/DisjointTimerQuery":function(){define(["require","exports","./isWebGL2Context"],function(q,h,e){Object.defineProperty(h,"__esModule",{value:!0});h.load=
function(a,d){if(d.disjointTimerQuery)return null;var b=a.getExtension("EXT_disjoint_timer_query")||a.getExtension("EXT_disjoint_timer_query_webgl2");return b?e.default(a)?{createQuery:function(){return a.createQuery()},resultAvailable:function(b){return a.getQueryParameter(b,a.QUERY_RESULT_AVAILABLE)},getResult:function(b){return a.getQueryParameter(b,a.QUERY_RESULT)},disjoint:function(){return a.getParameter(b.GPU_DISJOINT_EXT)},beginTimeElapsed:function(d){return a.beginQuery(b.TIME_ELAPSED_EXT,
d)},endTimeElapsed:function(){return a.endQuery(b.TIME_ELAPSED_EXT)},createTimestamp:function(a){return b.queryCounterEXT(a,b.TIMESTAMP_EXT)},timestampBits:function(){return a.getQuery(b.TIMESTAMP_EXT,b.QUERY_COUNTER_BITS_EXT)}}:{createQuery:function(){return b.createQueryEXT()},resultAvailable:function(a){return b.getQueryObjectEXT(a,b.QUERY_RESULT_AVAILABLE_EXT)},getResult:function(a){return b.getQueryObjectEXT(a,b.QUERY_RESULT_EXT)},disjoint:function(){return a.getParameter(b.GPU_DISJOINT_EXT)},
beginTimeElapsed:function(a){return b.beginQueryEXT(b.TIME_ELAPSED_EXT,a)},endTimeElapsed:function(){return b.endQueryEXT(b.TIME_ELAPSED_EXT)},createTimestamp:function(a){return b.queryCounterEXT(a,b.TIMESTAMP_EXT)},timestampBits:function(){return b.getQueryEXT(b.TIMESTAMP_EXT,b.QUERY_COUNTER_BITS_EXT)}}:null}})},"esri/views/webgl/capabilities/Instancing":function(){define(["require","exports","./isWebGL2Context"],function(q,h,e){Object.defineProperty(h,"__esModule",{value:!0});h.load=function(a,
d){return e.default(a)?{drawArraysInstanced:a.drawArraysInstanced.bind(a),drawElementsInstanced:a.drawElementsInstanced.bind(a),vertexAttribDivisor:a.vertexAttribDivisor.bind(a)}:d.angleInstancedArrays?null:(a=a.getExtension("ANGLE_instanced_arrays"))?{drawArraysInstanced:a.drawArraysInstancedANGLE.bind(a),drawElementsInstanced:a.drawElementsInstancedANGLE.bind(a),vertexAttribDivisor:a.vertexAttribDivisorANGLE.bind(a)}:null}})},"esri/views/webgl/capabilities/VertexArrayObjects":function(){define(["require",
"exports","./isWebGL2Context"],function(q,h,e){Object.defineProperty(h,"__esModule",{value:!0});h.load=function(a,d){return e.default(a)?{createVertexArray:a.createVertexArray.bind(a),deleteVertexArray:a.deleteVertexArray.bind(a),bindVertexArray:a.bindVertexArray.bind(a)}:d.vao?null:(a=a.getExtension("OES_vertex_array_object")||a.getExtension("MOZ_OES_vertex_array_object")||a.getExtension("WEBKIT_OES_vertex_array_object"))?{createVertexArray:a.createVertexArrayOES.bind(a),deleteVertexArray:a.deleteVertexArrayOES.bind(a),
bindVertexArray:a.bindVertexArrayOES.bind(a)}:null}})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../core/Logger ../../../../core/scheduling ../../../../layers/graphics/dehydratedFeatures ./constants ./ElevationContext ./featureExpressionInfoUtils ./Graphics3DSymbolCommonCode ./graphicUtils ../../support/mathUtils ../../support/PromiseLightweight".split(" "),function(q,h,e,a,d,b,g,c,f,
k,n,l,p,m){function r(a,b){a=null!=a?b.attributes[a]:0;return null!=a&&isFinite(a)?a:0}var t=new f,u=d.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer"),x={mode:"on-the-ground",offset:0,unit:"meters"},v={mode:"absolute-height",offset:0,unit:"meters"};return function(d){function m(a,b,c,e){var g=d.call(this)||this;g._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};g.symbolContainer=a;g.symbol=b;g._context=c;g._symbolLayerOrder=c.layerOrder;g._symbolLayerOrderDelta=
c.layerOrderDelta;g._elevationContext=new f;g._material=null;g._geometryCreationWarningHandle=null;g._updateDrivenProperties(e);g._updateElevationContext();g._prepareResources();return g}e(m,d);m.prototype._logWarning=function(a){u.warn(a)};m.prototype._logGeometryCreationWarnings=function(a,c,d,f){var e=this;if(null==this._geometryCreationWarningHandle){var g=a.geometryData&&a.geometryData.polygons;f+=" geometry failed to be created";var k=null;a.projectionSuccess?!c.length||1===c.length&&!c[0].length?
k=f+" (no "+d+" were defined)":Array.isArray(c)&&Array.isArray(c[0])?c.some(function(a){return 1===a.length})?k=f+" ("+d+" should contain at least 2 vertices)":g&&0===g.length&&"rings"===d&&(k=f+" (filled "+d+" should use clockwise winding - try reversing the order of vertices)"):k=f+" ("+d+" should be defined as a 2D array)":k=f+" (failed to project geometry to view spatial reference)";k&&(this._geometryCreationWarningHandle=b.schedule(function(){return e._onNextTick()}),this._logWarning(k))}};m.prototype._onNextTick=
function(){this._geometryCreationWarningHandle=null};m.prototype._validateGeometry=function(a){return"point"!==a.type||p.isFinite(a.x)&&p.isFinite(a.y)?!0:(this._logWarning("point coordinate is not a valid number, graphic skipped"),!1)};m.prototype._prepareResources=function(a){throw Error("This is an abstract base class");};m.prototype._defaultElevationInfoNoZ=function(){return x};m.prototype._defaultElevationInfoZ=function(){return v};m.prototype._updateElevationContext=function(){this._elevationContext.setDefaults();
var a=this._context.layer.elevationInfo;a&&this._elevationContext.mixinApi(a);(a=this.symbol&&this.symbol.elevationInfo)&&this._elevationContext.mixinApi(a);this._elevationContext.featureExpressionInfoContext=this._context.featureExpressionInfoContext};m.prototype.getGraphicElevationContext=function(a){var b=g.hasZ(a.geometry)?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ();t.setUnit(null!=this._elevationContext.unit?this._elevationContext.unit:b.unit);t.mode=this._elevationContext.mode||
b.mode;t.setOffsetMeters(null!=this._elevationContext.meterUnitOffset?this._elevationContext.meterUnitOffset:b.offset);t.featureExpressionInfoContext=this._elevationContext.featureExpressionInfoContext;t.hasOffsetAdjustment=!1;this._elevationOptions.supportsOnTheGround||"on-the-ground"!==t.mode||(t.mode="relative-to-ground",t.setOffsetMeters(0),t.featureExpressionInfoContext=k.zeroContext);b=k.createFeature(a,this._context.layer);k.setContextFeature(t.featureExpressionInfoContext,b);n.needsOffsetAdjustment(t,
this._elevationOptions,a.geometry,this.symbolContainer)&&(t.setOffsetRenderUnits(c.defaultIconElevationOffset),t.hasOffsetAdjustment=!0);return t};m.prototype._getDrapedZ=function(){return-2};m.prototype._updateDrivenProperties=function(a){var b={color:!1,opacity:!1,size:!1};!a&&(a=this._context.renderer)&&(b.color=!!a.colorInfo,b.size=!!a.sizeInfo,a.visualVariables&&a.visualVariables.forEach(function(a){switch(a.type){case "color":b.color=!0;if(a.colors)for(var c=0;c<a.colors.length;c++){var d=a.colors[c];
d&&(Array.isArray(d)&&3<d.length&&255!==d[3]||void 0!==d.a&&255!==d.a)&&(b.opacity=!0)}if(a.stops)for(c=0;c<a.stops.length;c++)(d=a.stops[c].color)&&(Array.isArray(d)&&3<d.length&&255!==d[3]||void 0!==d.a&&255!==d.a)&&(b.opacity=!0);break;case "opacity":b.opacity=!0;break;case "size":b.size=!0}}));this._drivenProperties=b};m.prototype._isPropertyDriven=function(a){return this._drivenProperties[a]};m.prototype._getLayerOpacity=function(){if(this._context.layerView&&"fullOpacity"in this._context.layerView)return this._context.layerView.fullOpacity;
var a=this._context.layer.opacity;return null==a?1:a};m.prototype._getMaterialOpacity=function(){var a;a=1*this._getLayerOpacity();var b=this.symbol&&this.symbol.material;b&&!this._isPropertyDriven("opacity")&&b.color&&(a*=b.color.a);return a};m.prototype._getMaterialOpacityAndColor=function(){var b=this.symbol&&this.symbol.material,c=this._getMaterialOpacity(),b=!this._isPropertyDriven("color")&&b&&b.color?a.toUnitRGB(b.color):null;return l.mixinColorAndOpacity(b,c)};m.prototype._getVertexOpacityAndColor=
function(a,b,c){var d=this._isPropertyDriven("color")?a.color:null;a=this._isPropertyDriven("opacity")?a.opacity:null;d=l.mixinColorAndOpacity(d,a);c&&(d[0]*=c,d[1]*=c,d[2]*=c,d[3]*=c);return b?new b(d):d};m.prototype._getStageIdHint=function(){return this._context.layer.id+"_symbol"};m.prototype.isFastUpdatesEnabled=function(){return this._fastUpdates&&this._fastUpdates.enabled};m.prototype.updateSymbolLayerOrder=function(a,b){this._symbolLayerOrder=a;this._symbolLayerOrderDelta=b};m.prototype.setDrawOrder=
function(a,b,c){this.updateSymbolLayerOrder(a,b);this._material&&(this._material.renderPriority=a,c.add(this._material.id))};m.prototype.createGraphics3DGraphic=function(a){for(var b=1;b<arguments.length;b++);throw Error("This is an abstract base class");};m.prototype.destroy=function(){this._geometryCreationWarningHandle&&(this._geometryCreationWarningHandle.remove(),this._geometryCreationWarningHandle=null)};m.prototype.layerPropertyChanged=function(a,b,c){return!1};m.prototype.applyRendererDiff=
function(a,b,c,d){return!1};m.prototype.getFastUpdateAttrValues=function(a){if(!this._fastUpdates.enabled)return null;var b=this._fastUpdates.visualVariables,c=b.size?r(b.size.field,a):0;a=b.color?r(b.color.field,a):0;return[c,a,0,0]};return m}(m.Promise)})},"esri/views/3d/support/PromiseLightweight":function(){(function(q){function h(a){this._callbacks=[];this._errbacks=[];this._cancelCallback=a;this._iserr=this._isdone=this._iscancelled=!1}function e(a,b){var d=new h;0===a.length?d.done.apply(d,
b):a[0].apply(null,b).then(function(){a.splice(0,1);e(a,arguments).then(function(){d.done.apply(d,arguments)})});return d}h.prototype.cancel=function(a){this._callbacks=[];this._errbacks=[];this._iscancelled=!0;this._cancelCallback&&this._cancelCallback(a)};h.prototype.then=function(a,b,e){var c;if(!this._iscancelled)return this._isdone?c=a.apply(e,this.result):this._iserr&&b?c=b.apply(e,this.result):(this._callbacks.push(function(){return a.apply(e,arguments)}),b&&this._errbacks.push(function(){return b.apply(e,
arguments)})),c};h.prototype.done=function(){this.result=arguments;this._isdone=!0;for(var a=0;a<this._callbacks.length;a++)this._callbacks[a].apply(null,arguments);this._callbacks=[];this._errbacks=[]};h.prototype.resolve=h.prototype.done;h.prototype.reject=function(){if(!this._iscancelled){this.result=arguments;this._iserr=!0;for(var a=0;a<this._errbacks.length;a++)this._errbacks[a].apply(null,arguments);this._callbacks=[];this._errbacks=[]}};h.prototype.isRejected=function(){return this._iserr};
h.prototype.isFulfilled=function(){return this._isdone||this._iserr};h.prototype.isResolved=function(){return this._isdone};h.prototype.isCancelled=function(){return this._iscancelled};var a={Promise:h,join:function(a){function b(a,b){return function(){b&&(n=!0);f+=1;e[a]=Array.prototype.slice.call(arguments);f===c&&(n?d.reject():d.done(e))}}for(var d=new h,c=a.length,f=0,e=[],n=!1,l=0;l<c;l++)a[l].then(b(l,!1),b(l,!0));0===a.length&&d.done();return d},chain:e};"function"===typeof define&&define.amd?
define(function(){return a}):q.promise=a})(this)},"esri/views/3d/webgl-engine/lib/Geometry":function(){define("require exports ./BoundingInfo ./ComponentUtils ./geometryDataUtils ./IdGen ./Util ./Util".split(" "),function(q,h,e,a,d,b,g,c){return function(){function f(a,b,c){this.singleUse=!1;this.componentAABB=null;this.id=f.__idGen.gen(b);this.data=a;this._boundingInfo=c}f.prototype.getData=function(){return this.data};f.prototype.getComponentCount=function(){return a.componentCount(this.data.componentOffsets)};
f.prototype.getComponentAABB=function(a,b){null==this.componentAABB&&(this.componentAABB=this._computeComponentAABB());for(var c=0;6>c;c++)b[c]=this.componentAABB[6*a+c];return b};f.prototype._computeComponentAABB=function(){for(var a=this.getComponentCount(),b=new Float32Array(6*a),c=0;c<a;c++)this._calculateAABB(c,b,6*c);return b};f.prototype._calculateAABB=function(a,b,d){void 0===d&&(d=0);var f=this.data.getIndices(c.VertexAttrConstants.POSITION),e=this.data.getAttribute(c.VertexAttrConstants.POSITION),
g=this.data.componentOffsets,k=g.length?g[a+1]:f.length,l=Infinity,h=Infinity,n=Infinity,A=-Infinity,y=-Infinity,C=-Infinity,B=e.offsetIdx,q=e.strideIdx;for(a=g.length?g[a]:0;a<k;a++)var E=B+q*f[a],g=e.data[E],J=e.data[E+1],E=e.data[E+2],l=Math.min(l,g),h=Math.min(h,J),n=Math.min(n,E),A=Math.max(A,g),y=Math.max(y,J),C=Math.max(C,E);b?(b[d]=l,b[d+1]=h,b[d+2]=n,b[d+3]=A,b[d+4]=y,b[d+5]=C):b=[l,h,n,A,y,C];return b};f.prototype.calculateBoundingInfo=function(){var a=this.data.getIndices(c.VertexAttrConstants.POSITION),
b=this.data.getAttribute(c.VertexAttrConstants.POSITION),f="triangle"===this.data.primitiveType?3:1;if(0===a.length)for(var a=new Uint32Array(f),h=0;h<f;++h)a[h]=h;h=a.length;g.assert(0===h%f);h=d.generateDefaultIndexArray(h/f);return new e(h,f,a,b)};f.prototype.getBoundingInfo=function(){null==this._boundingInfo&&(this._boundingInfo=this.calculateBoundingInfo());return this._boundingInfo};f.prototype.invalidateBoundingInfo=function(){this._boundingInfo=null};f.__idGen=new b;return f}()})},"esri/views/3d/webgl-engine/lib/BoundingInfo":function(){define(["require",
"exports","./gl-matrix","./Util"],function(q,h,e,a){var d=e.vec3d;return function(){function b(b,c,f,e){a.assert(1<=b.length);a.assert(0===f.length%c);a.assert(f.length>=b.length*c);a.assert(3===e.size||4===e.size);this.primitiveIndices=b;this.indices=f;this._position=e;this._numIndexPerPrimitive=c;var g=e.data,k=e.offsetIdx;e=e.strideIdx;var h=b.length,m=k+e*f[c*b[0]];this.bbMin=d.createFrom(g[m],g[m+1],g[m+2]);this.bbMax=d.create(this.bbMin);for(m=0;m<h;++m)for(var r=c*b[m],t=0;t<c;++t){var u=k+
e*f[r+t];this.bbMin[0]=Math.min(g[u],this.bbMin[0]);this.bbMax[0]=Math.max(g[u],this.bbMax[0]);++u;this.bbMin[1]=Math.min(g[u],this.bbMin[1]);this.bbMax[1]=Math.max(g[u],this.bbMax[1]);++u;this.bbMin[2]=Math.min(g[u],this.bbMin[2]);this.bbMax[2]=Math.max(g[u],this.bbMax[2])}this.center=d.create();d.lerp(this.bbMin,this.bbMax,.5,this.center);this.bsRadius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);for(var x=this.bsRadius*this.bsRadius,
m=0;m<h;++m)for(r=c*b[m],t=0;t<c;++t){var u=k+e*f[r+t],v=g[u]-this.center[0],A=g[u+1]-this.center[1],u=g[u+2]-this.center[2],y=v*v+A*A+u*u;if(!(y<=x)){var y=Math.sqrt(y),C=.5*(y-this.bsRadius);this.bsRadius+=C;x=this.bsRadius*this.bsRadius;y=C/y;this.center[0]+=v*y;this.center[1]+=A*y;this.center[2]+=u*y}}}b.prototype.getCenter=function(){return this.center};b.prototype.getBSRadius=function(){return this.bsRadius};b.prototype.getBBMin=function(){return this.bbMin};b.prototype.getBBMax=function(){return this.bbMax};
b.prototype.getPrimitiveIndices=function(){return this.primitiveIndices};b.prototype.getIndices=function(){return this.indices};b.prototype.getPosition=function(){return this._position};b.prototype.getChildren=function(){if(this.children)return this.children;if(1<d.dist2(this.bbMin,this.bbMax)){for(var a=d.lerp(this.bbMin,this.bbMax,.5,d.create()),c=this.primitiveIndices.length,f=new Uint8Array(c),e=Array(8),h=0;8>h;++h)e[h]=0;for(var h=this._position,l=h.data,p=h.offsetIdx,m=h.strideIdx,h=0;h<c;++h){for(var r=
0,t=this._numIndexPerPrimitive*this.primitiveIndices[h],u=p+m*this.indices[t],x=l[u],v=l[u+1],A=l[u+2],y=1;y<this._numIndexPerPrimitive;++y){var u=p+m*this.indices[t+y],C=l[u],B=l[u+1],u=l[u+2];C<x&&(x=C);B<v&&(v=B);u<A&&(A=u)}x<a[0]&&(r|=1);v<a[1]&&(r|=2);A<a[2]&&(r|=4);f[h]=r;++e[r]}for(h=a=0;8>h;++h)0<e[h]&&++a;if(2>a)return;a=Array(8);for(h=0;8>h;++h)a[h]=0<e[h]?new Uint32Array(e[h]):void 0;for(h=0;8>h;++h)e[h]=0;for(h=0;h<c;++h)r=f[h],a[r][e[r]++]=this.primitiveIndices[h];this.children=Array(8);
for(h=0;8>h;++h)void 0!==a[h]&&(this.children[h]=new b(a[h],this._numIndexPerPrimitive,this.indices,this._position))}return this.children};return b}()})},"esri/views/3d/layers/graphics/Graphics3DSymbol":function(){define("require exports ../../../../core/tsSupport/extendsHelper ./Graphics3DGraphic ./Graphics3DSymbolLayerFactory ../../support/PromiseLightweight".split(" "),function(q,h,e,a,d,b){return function(b){function c(a,c,e){var f=b.call(this)||this;f.symbol=a;a=a.symbolLayers;e&&(a=e.concat(a));
e=a.length;f.childGraphics3DSymbols=Array(a.length);f.childGraphics3DSymbolPromises=Array(a.length);for(var g=c.layerOrder,k=0,h=0,n=!1,u=function(a,b){b&&(this.childGraphics3DSymbols[a]=b,h++);k--;!this.isRejected()&&n&&1>k&&(0<h?this.resolve():this.reject())},x=0;x<e;x++){var v=a.getItemAt(x);!1!==v.enabled&&(c.layerOrder=g+(1-(1+x)/e),c.layerOrderDelta=1/e,v=d.make(f.symbol,v,c,v._ignoreDrivers))&&(k++,f.childGraphics3DSymbolPromises[x]=v,v.then(u.bind(f,x,v),u.bind(f,x,null)))}c.layerOrder=g;
n=!0;!f.isRejected()&&1>k&&f.resolve();return f}e(c,b);c.prototype.createGraphics3DGraphic=function(b,c){for(var d=b.graphic,f=Array(this.childGraphics3DSymbols.length),e=0;e<this.childGraphics3DSymbols.length;e++){var g=this.childGraphics3DSymbols[e];g&&(f[e]=g.createGraphics3DGraphic(b))}return new a(d,c||this,f,b.layer)};Object.defineProperty(c.prototype,"numberOfVertices",{get:function(){for(var a=0,b=0;b<this.childGraphics3DSymbols.length;++b){var c=this.childGraphics3DSymbols[b];c&&(a+=c.numberOfVertices)}return a},
enumerable:!0,configurable:!0});c.prototype.layerPropertyChanged=function(a,b){for(var c=this.childGraphics3DSymbols.length,d=function(c){var d=f.childGraphics3DSymbols[c],e=function(a){return a._graphics[c]};if(d&&!d.layerPropertyChanged(a,b,e))return{value:!1}},f=this,e=0;e<c;e++){var g=d(e);if("object"===typeof g)return g.value}return!0};c.prototype.applyRendererDiff=function(a,b,c){return this.isResolved()?this.childGraphics3DSymbols.reduce(function(d,f,e){return d&&(!f||f.applyRendererDiff(a,
b,c,e))},!0):!1};c.prototype.getFastUpdateStatus=function(){var a=0,b=0,c=0;this.childGraphics3DSymbolPromises.forEach(function(d){d&&!d.isFulfilled()?a++:d&&d.isFastUpdatesEnabled()?c++:d&&b++});return{loading:a,slow:b,fast:c}};c.prototype.setDrawOrder=function(a,b){for(var c=this.childGraphics3DSymbols.length,d=1/c,f=0;f<c;f++){var e=this.childGraphics3DSymbols[f];e&&e.setDrawOrder(a+(1-(1+f)/c),d,b)}};c.prototype.destroy=function(){this.isFulfilled()||this.reject();for(var a=0;a<this.childGraphics3DSymbolPromises.length;a++)this.childGraphics3DSymbolPromises[a]&&
this.childGraphics3DSymbolPromises[a].destroy()};return c}(b.Promise)})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayerFactory":function(){define("require exports dojo/has ../../../../core/Logger ./Graphics3DExtrudeSymbolLayer ./Graphics3DIconSymbolLayer ./Graphics3DLineSymbolLayer ./Graphics3DMeshFillSymbolLayer ./Graphics3DObjectSymbolLayer ./Graphics3DObjectSymbolLayerLod ./Graphics3DPathSymbolLayer ./Graphics3DPolygonFillSymbolLayer ./Graphics3DTextSymbolLayer".split(" "),function(q,h,e,
a,d,b,g,c,f,k,n,l,p){Object.defineProperty(h,"__esModule",{value:!0});var m=a.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory");h.make=function(a,b,c,d){var f=t[a.type]&&t[a.type][b.type]||r[b.type];return f?new f(a,b,c,d):(m.error("GraphicsLayerFactory#make","unknown symbol type "+b.type),null)};var r={icon:b,object:e("enable-feature:skallweit/lod-rendering")?k:f,line:g,path:n,fill:l,extrude:d,text:p},t={"mesh-3d":{fill:c}}})},"esri/views/3d/layers/graphics/Graphics3DExtrudeSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/earcut/earcut ../../../../geometry/Point ../../../../geometry/Polygon ../../../../layers/graphics/dehydratedFeatures ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ../support/edgeUtils ../../lib/glMatrix ../../support/projectionUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Util ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u,x,v,A){function y(a,b,c,d,f,e,g,k,l,m,h,n,p,u){var r=c.length/3,t=0;h+=2*d.count;var v=d.index,y=d.count,x=l,A=h;E.set(p,M);var C=0<n?1:-1,v=3*v,q=x;p=3*q;for(var Q=x+y,x=3*Q,G=0;G<y;++G)u&&(M[0]=a[v+0],M[1]=a[v+1],M[2]=a[v+2],E.normalize(M)),f[p+0]=a[v+0],f[p+1]=a[v+1],f[p+2]=a[v+2],e[p+0]=b[v+0],e[p+1]=b[v+1],e[p+2]=b[v+2],g[p+0]=-C*M[0],g[p+1]=-C*M[1],g[p+2]=-C*M[2],k[q]=0,f[x+0]=a[v+0]+n*M[0],f[x+1]=a[v+1]+n*M[1],f[x+2]=a[v+2]+n*M[2],e[x+0]=b[v+0],e[x+
1]=b[v+1],e[x+2]=b[v+2],g[x+0]=C*M[0],g[x+1]=C*M[1],g[x+2]=C*M[2],k[Q]=n,p+=3,x+=3,v+=3,q+=1,Q+=1;v=0;p=3*A;x=3*(A+r);p=3*(A+r);x=3*A;a=H;b=I;0>n&&(a=I,b=H);for(G=0;G<r;++G)m[p+0]=c[v+a[0]],m[p+1]=c[v+a[1]],m[p+2]=c[v+a[2]],m[x+0]=c[v+b[0]]+y,m[x+1]=c[v+b[1]]+y,m[x+2]=c[v+b[2]]+y,p+=3,x+=3,v+=3;l+=2*d.count;h=h+2*r-(2*d.count+2*r);B(f,e,k,g,t,d.pathLengths[0],d.count,l,m,h,n);l+=4*d.pathLengths[0];h+=2*d.pathLengths[0];t+=d.pathLengths[0];for(c=1;c<d.pathLengths.length;++c)B(f,e,k,g,t,d.pathLengths[c],
d.count,l,m,h,n),l+=4*d.pathLengths[c],h+=2*d.pathLengths[c],t+=d.pathLengths[c]}function C(a,b,c,d,f,e,g){d[e]=d[g];g*=3;e*=3;a[e+0]=a[g+0];a[e+1]=a[g+1];a[e+2]=a[g+2];b[e+0]=b[g+0];b[e+1]=b[g+1];b[e+2]=b[g+2];c[e+0]=f[0];c[e+1]=f[1];c[e+2]=f[2]}function B(a,b,c,d,f,e,g,k,l,m,h){var n=f,p=f+1,u=f+g,r=f+g+1,t=k,v=k+1,y=k+2*e;k=k+2*e+1;0>h&&(n=f+g+1,r=f);m*=3;for(var x=0;x<e;++x){x===e-1&&(0<h?(p=f,r=f+g):(p=f,n=f+g));var A=a,B=n,q=p,Q=u,G=P,B=3*B,q=3*q,Q=3*Q;E.set3(A[B++],A[B++],A[B++],L);E.set3(A[q++],
A[q++],A[q++],U);E.set3(A[Q++],A[Q++],A[Q++],N);E.subtract(U,L,S);E.subtract(N,L,aa);E.cross(aa,S,G);E.normalize(G,G);C(a,b,d,c,P,t,n);C(a,b,d,c,P,v,p);C(a,b,d,c,P,y,u);C(a,b,d,c,P,k,r);l[m++]=t;l[m++]=y;l[m++]=k;l[m++]=t;l[m++]=k;l[m++]=v;n++;p++;u++;r++;t+=2;v+=2;y+=2;k+=2}}var D=v.VertexAttrConstants,E=p.vec3d,J=p.mat4d,F=E.create(),M=E.create(),H=[0,2,1],I=[0,1,2],K=new d,O={verticalDistanceToGround:0,terrainElevation:0};q=function(d){function k(){var a=null!==d&&d.apply(this,arguments)||this;
a._edgeStageObjects=new Set;return a}e(k,d);k.prototype._prepareResources=function(){if(!this._isPropertyDriven("size")){var a=n.validateSymbolLayerSize(this._getSymbolSize());if(a){this._logWarning(a);this.reject();return}}var a=this._getStageIdHint(),b=this._getMaterialOpacityAndColor(),c=E.create(b),b=b[3],c={diffuse:c,ambient:c,opacity:b,transparent:1>b||this._isPropertyDriven("opacity"),vertexColors:!0};this._material=new A(c,a+"_3dlinemat");this._context.stage.add(r.ModelContentType.MATERIAL,
this._material);this.resolve()};k.prototype.destroy=function(){d.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&this._context.stage.remove(r.ModelContentType.MATERIAL,this._material.id)};k.prototype.createGraphics3DGraphic=function(a){var b=a.renderingInfo;a=a.graphic;var c=a.geometry;if("polygon"!==c.type&&"extent"!==c.type)return this._logWarning("unsupported geometry type for extrude symbol: "+c.type),null;if(!this._validateGeometry(c))return null;var c="polygon"===
c.type||"extent"===c.type?"rings":"paths",d="graphic"+a.uid,f=this._getVertexOpacityAndColor(b,Float32Array,255),e=this.getGraphicElevationContext(a);return this._createAs3DShape(a,c,b,f,e,d,a.uid)};k.prototype.layerPropertyChanged=function(a,b,c){if("opacity"===a){b=this._getMaterialOpacity();c=1>b||this._isPropertyDriven("opacity");this._material.setParameterValues({opacity:b,transparent:c});if(0<this._edgeStageObjects.size){var d=this._context.stage.view.getEdgeView(),e=this._getLayerOpacity();
this._edgeStageObjects.forEach(function(a){d.updateAllComponentOpacities(a,[e])})}return!0}if("elevationInfo"===a){this._updateElevationContext();for(var g in b){var k=b[g];if(a=c(k))k=this.getGraphicElevationContext(k.graphic),a.needsElevationUpdates=f.needsElevationUpdates3D(k.mode),a.elevationContext.set(k)}return!0}return!1};Object.defineProperty(k.prototype,"numberOfVertices",{get:function(){return 0},enumerable:!0,configurable:!0});k.prototype._getExtrusionSize=function(a){a=a.size&&this._isPropertyDriven("size")?
f.getSingleSizeDriver(a.size,2):this._getSymbolSize();return a/=this._context.renderCoordsHelper.unitInMeters};k.prototype._getSymbolSize=function(){return this.symbol.size||1};k.prototype._createAs3DShape=function(d,e,k,h,n,p,u){var r=this,v=d.geometry;"extent"===v.type&&(v=b.fromExtent(v));d=v[e];var A=[],C=[],B=[],q=E.create(),Q=Array(6),G=this._context.renderSpatialReference===m.SphericalECEFSpatialReference,w=this._getExtrusionSize(k),I=E.create();G||this._context.renderCoordsHelper.worldUpAtPosition(null,
I);k=f.getGeometryVertexData3D(d,g.hasZ(v),v.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,n);this._logGeometryCreationWarnings(k,d,e,"ExtrudeSymbol3DLayer");if(0<d.length){var L=k.geometryData.polygons,P=k.eleVertexData,H=k.vertexData;e=H.length/3;var Z=new Float64Array(18*e),X=new Float64Array(18*e),U=new Float64Array(18*e),M=new Float64Array(6*e),aa=0;e=function(b){var c=L[b],d=c.count,e=c.index;if(ea._context.clippingExtent&&
(f.computeBoundingBox(P,e,d,Q),f.boundingBoxClipped(Q,ea._context.clippingExtent)))return"continue";var g=new Float64Array(P.buffer,3*e*Z.BYTES_PER_ELEMENT,3*d),k=c.holeIndices.map(function(a){return a-e}),g=a(g,k,3);if(0<g.length){f.chooseOrigin(H,e,d,q);var k=new Uint32Array(6*d+2*g.length),l=6*d,m=new Float64Array(Z.buffer,3*aa*Z.BYTES_PER_ELEMENT,3*l),n=new Float64Array(X.buffer,3*aa*X.BYTES_PER_ELEMENT,3*l),u=new Float64Array(U.buffer,3*aa*U.BYTES_PER_ELEMENT,3*l),r=new Float64Array(M.buffer,
1*aa*M.BYTES_PER_ELEMENT,1*l);y(H,P,g,c,m,u,n,r,0,k,0,w,I,G);f.subtractCoordinates(m,0,l,q);aa+=6*d;c=ea._createExtrudeGeometry(k,{positions:m,elevation:u,normals:n,heights:r},h);b=new t(c,p+"path"+b);b.singleUse=!0;A.push(b);C.push([ea._material]);b=J.identity();J.translate(b,q,b);B.push(b)}};var ea=this;for(d=0;d<L.length;++d)e(d);if(0<A.length){var S=new x({geometries:A,materials:C,transformations:B,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicUid:u},idHint:p}),N=function(a){var b=
r._context.stage.view.getEdgeView();if(b){b.removeObject(a);r._edgeStageObjects.delete(a);var c=l.createMaterial(b,r.symbol,r._getLayerOpacity());c&&(r._edgeStageObjects.add(a),b.addObject(a,[c]))}};N(S);u=new c(this,S,A,null,null,function(a,b,c,d){a=a.stageObject;var e=d.setAltitude;K.spatialReference=c.spatialReference;for(var g=a.getGeometryRecords(),k=g.length,l="absolute-height"!==b.mode,m=0,h=0;h<k;h++){var n=g[h].geometry,p=g[h].transformation,u=n.getData();T[0]=p[12];T[1]=p[13];T[2]=p[14];
n.invalidateBoundingInfo();for(var u=u.getVertexAttr(),n=u[D.POSITION].data,p=u[D.SIZE].data,u=u.mapPos.data,r=n.length/3,t=0,v=0,y=!1,x=0,A=0;A<r;A++){K.x=u[v];K.y=u[v+1];K.z=u[v+2];V[0]=n[t];V[1]=n[t+1];V[2]=n[t+2];var C=f.computeElevation(c,K,b,d,l?O:null);l&&(x+=O.terrainElevation);F[0]=n[t]+T[0];F[1]=n[t+1]+T[1];F[2]=n[t+2]+T[2];e(C+p[t/3],F);n[t]=F[0]-T[0];n[t+1]=F[1]-T[1];n[t+2]=F[2]-T[2];C=.01/d.unitInMeters;if(Math.abs(V[0]-n[t])>C||Math.abs(V[1]-n[t+1])>C||Math.abs(V[2]-n[t+2])>C)y=!0;v+=
3;t+=3}y&&a.geometryVertexAttrsUpdated(h);m+=x/r}b=m/k;N(S);return b},n);u.alignedTerrainElevation=k.terrainElevation;u.needsElevationUpdates=f.needsElevationUpdates3D(n.mode);return u}}return null};k.prototype._createExtrudeGeometry=function(a,b,c){for(var d=a.length,f=new Uint32Array(d),e=0;e<d;e++)f[e]=0;d={};e={};d[D.POSITION]=a;d[D.NORMAL]=a;d[D.COLOR]=f;e[D.POSITION]={size:3,data:b.positions};e[D.NORMAL]={size:3,data:b.normals};e[D.COLOR]={size:4,data:c};e[D.SIZE]={size:1,data:b.heights};b.elevation&&
(e.mapPos={size:3,data:b.elevation},d.mapPos=a);return new u(e,d)};return k}(k);var P=E.create(),L=E.create(),U=E.create(),N=E.create(),S=E.create(),aa=E.create(),V=E.create(),T=E.create();return q})},"esri/views/3d/layers/support/edgeUtils":function(){define(["require","exports","../../../../Color","../../../../core/screenUtils"],function(q,h,e,a){Object.defineProperty(h,"__esModule",{value:!0});h.createMaterial=function(d,b,g){b=b&&b.enabled&&b.edges;if(!b)return null;var c=e.toUnitRGBA(b.color);
switch(b.type){case "solid":return d.createSolidEdgeMaterial({color:c,size:a.pt2px(b.size),extensionLength:a.pt2px(b.extensionLength),opacity:g});case "sketch":return d.createSketchEdgeMaterial({color:c,size:a.pt2px(b.size),extensionLength:a.pt2px(b.extensionLength),opacity:g})}}})},"esri/views/3d/layers/graphics/Graphics3DIconSymbolLayer":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper dojo/when dojo/errors/CancelError ../../../../Color ../../../../core/Error ../../../../core/lang ../../../../core/screenUtils ../../../../core/sniff ../../../../core/urlUtils ../../../../symbols/support/symbolUtils ./ElevationAligners ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./SignedDistanceFunctions ../support/FastSymbolUpdates ../../lib/glMatrix ../../support/projectionUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/HUDMaterial".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u,x,v,A,y,C,B,D,E,J,F,M,H){function I(a){return"cross"===a||"x"===a}function K(a){var b;"primitive:"===a.substring(0,10)&&(a=a.substring(10));switch(a){case T.PRIM_CIRCLE:b=A.computeSignedDistancefieldCicle(128,64);break;case T.PRIM_SQUARE:b=A.computeSignedDistancefieldSquare(128,64,!1);break;case T.PRIM_KITE:b=A.computeSignedDistancefieldSquare(128,64,!0);break;case T.PRIM_CROSS:b=A.computeSignedDistancefieldCrossAndX(128,64,!1);break;case T.PRIM_X:b=A.computeSignedDistancefieldCrossAndX(128,
64,!0)}return new M(b,"sdf_"+a,{mipmap:!1,wrapClamp:!0,width:128,height:128,components:4})}var O=C.vec3d;q=C.vec4d;var P=C.mat4d.identity(),L=[0,0,1],U=[0,0,0,0],N=[0,0,0],S=[1,1,1],aa="center bottom top left right bottom-left bottom-right top-left top-right".split(" "),V=[.25,.25,.75,.75],T={PRIM_CIRCLE:"circle",PRIM_SQUARE:"square",PRIM_CROSS:"cross",PRIM_X:"x",PRIM_KITE:"kite"},Q=[64,64];x=function(h){function x(){var a=null!==h&&h.apply(this,arguments)||this;a._elevationOptions={supportsOffsetAdjustment:!0,
supportsOnTheGround:!0};return a}a(x,h);x.prototype._prepareResources=function(){var a=this.symbol,b=Math.round(null!=a.size?k.pt2px(a.size):16);this._size=null;this._symbolTextureRatio=1;this._primitive=null;var c=this._getStageIdHint();if(!this._isPropertyDriven("size")){var d=v.validateSymbolLayerSize(b);if(d){this._logWarning(d);this.reject();return}}this._isPropertyDriven("size")&&64>b&&(b=64);var f=a.resource||{primitive:"circle",href:void 0},d={anchorPos:this._getAnchorPos(a)},e=this.symbolContainer;
if(this._hasVisibleVerticalOffset(e)){var e=e.verticalOffset,g=e.minWorldLength,l=e.maxWorldLength;d.verticalOffset={screenLength:k.pt2px(e.screenLength),minWorldLength:g||0,maxWorldLength:null!=l?l:Infinity}}this._context.screenSizePerspectiveEnabled&&(d.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);f.href?(this._outlineSize=this._getOutlineSize(a,null),d.color=this._getFillColor(a,null),d.outlineColor=this._getOutlineColor(a),d.outlineSize=this._outlineSize,
d.textureIsSignedDistanceField=!1,this._prepareImageResources(b,d,c)):(f=f.primitive||"circle",e="primitive:"+f,this._primitive=f,this._outlineSize=this._getOutlineSize(a,f),d.color=this._getFillColor(a,f),d.outlineColor=this._getOutlineColor(a),d.outlineSize=this._outlineSize,I(f)&&0===d.outlineSize?this.reject():(this.texture=this._context.sharedResources.textures.acquire(e,K),this._textureURI=e,d.textureIsSignedDistanceField=!0,d.distanceFieldBoundingBox=V,d.textureId=this.texture.id,this._size=
[b,b],this._symbolTextureRatio=2,this._createMaterialsAndAddToStage(d,this._context.stage,c),this.resolve()))};x.prototype._getOutlineSize=function(a,b){var c=0,c=a.outline&&null!=a.outline.size?k.pt2px(a.outline.size):I(b)?1.5:0;return Math.max(c,0)};x.prototype._getOutlineColor=function(a){var b=this._getLayerOpacity();if(a.outline&&null!=a.outline.color){var c=g.toUnitRGB(a.outline.color);return[c[0],c[1],c[2],a.outline.color.a*b]}return[0,0,0,b]};x.prototype._getFillColor=function(a,b){return I(b)?
U:this._getMaterialOpacityAndColor()};x.prototype._getAnchorPos=function(a){return-1<aa.indexOf(a.anchor)?a.anchor:"center"};x.prototype._prepareImageResources=function(a,f,e){var g=this,k=p.getIconHref(this.symbolContainer,this.symbol);!n("esri-canvas-svg-support")&&l.isSVG(k)?(this._logWarning("IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)"),this.reject(new c("SVG Not Supported","IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)"))):(d(this._context.sharedResources.textures.acquire(k,
null,a),function(b){if(!g.isRejected()){var c=b.params,d=c.width/c.height;g._size=a?1<d?[a,Math.round(a/d)]:[Math.round(a*d),a]:[c.width,c.height];f.textureId=b.id;g._createMaterialsAndAddToStage(f,g._context.stage,e);g.resolve()}},function(a){a instanceof b?g.reject():(a="IconSymbol3DLayer failed to load (Request for icon resource failed: "+k+")",g._logWarning(a),g.reject(new c("Request Failed",a)))}),this._textureURI=k)};x.prototype._createMaterialsAndAddToStage=function(a,b,c){this._fastUpdates=
y.initFastSymbolUpdatesState(this._context.renderer,this._supportsShaderVisualVariables(),this._fastVisualVariableConvertOptions());this._fastUpdates.enabled&&f.mixin(a,this._fastUpdates.materialParameters);var d=e({},a);d.verticalOffset=null;d.screenSizePerspective=null;d.occlusionTest=!1;d.shaderPolygonOffset=0;this._drapedMaterial=new H(d,c+"_iconDraped");b.add(D.ModelContentType.MATERIAL,this._drapedMaterial);a.occlusionTest=!0;this._material=new H(a,c+"_icon");b.add(D.ModelContentType.MATERIAL,
this._material)};x.prototype.destroy=function(){h.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(D.ModelContentType.MATERIAL,this._material.id),this._material=null);this._drapedMaterial&&(this._context.stage.remove(D.ModelContentType.MATERIAL,this._drapedMaterial.id),this._drapedMaterial=null);this._textureURI&&(this._context.sharedResources.textures.release(this._textureURI),this._textureURI=null)};x.prototype._getScaleFactor=function(a){if(this._isPropertyDriven("size")&&
a.size){for(var b=0;3>b;b++){var c=a.size[b];c&&"symbolValue"!==c&&"proportional"!==c&&(a.size[b]=k.pt2px(c))}b=this._size[0]>this._size[1]?this._size[0]:this._size[1];if("symbolValue"!==a.size[0]){if(isFinite(+a.size[0]))return+a.size[0]/b;if(isFinite(+a.size[2]))return+a.size[2]/b}}return 1};x.prototype.createGraphics3DGraphic=function(a){var b=a.renderingInfo;a=a.graphic;if(!this._validateGeometry(a.geometry))return null;var c=u.placePointOnGeometry(a.geometry);if(!c)return this._logWarning("unsupported geometry type for icon symbol: "+
a.geometry.type),null;var d="graphic"+a.uid,f=this._getVertexOpacityAndColor(b),e=1;this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||(e=this._getScaleFactor(b));e*=this._symbolTextureRatio;b=[this._size[0]*e,this._size[1]*e];e=this.getGraphicElevationContext(a);return"on-the-ground"===e.mode?this._createAsOverlay(a,c,f,b,e,d,a.uid):this._createAs3DShape(a,c,f,b,e,d,a.uid)};x.prototype.layerPropertyChanged=function(a,b,c){if("opacity"===a)return b=this._getFillColor(this.symbol,this._primitive),
this._drapedMaterial.setParameterValues({color:b}),this._material.setParameterValues({color:b}),b=this._getOutlineColor(this.symbol),this._drapedMaterial.setParameterValues({outlineColor:b}),this._material.setParameterValues({outlineColor:b}),!0;if("elevationInfo"===a){a=this._elevationContext.mode;this._updateElevationContext();var d=this._elevationContext.mode;if("on-the-ground"===a&&"on-the-ground"===d)return!0;if(a!==d&&("on-the-ground"===a||"on-the-ground"===d))return!1;a=u.needsElevationUpdates2D(d)||
"absolute-height"===d;for(var f in b){var e=b[f];(d=c(e))&&"object3d"===d.type&&(e=this.getGraphicElevationContext(e.graphic),d.needsElevationUpdates=a,d.elevationContext.set(e))}return!0}return!1};x.prototype.applyRendererDiff=function(a,b,c,d){for(var f in a.diff)switch(f){case "visualVariables":if(y.updateFastSymbolUpdatesState(this._fastUpdates,b,this._fastVisualVariableConvertOptions()))this._material.setParameterValues(this._fastUpdates.materialParameters),this._drapedMaterial.setParameterValues(this._fastUpdates.materialParameters);
else return!1;break;default:return!1}return!0};x.prototype.setDrawOrder=function(a,b,c){this.updateSymbolLayerOrder(a,b);this._drapedMaterial&&(this._drapedMaterial.renderPriority=a,c.add(this._drapedMaterial.id))};Object.defineProperty(x.prototype,"numberOfVertices",{get:function(){return 6},enumerable:!0,configurable:!0});x.prototype._defaultElevationInfoNoZ=function(){return G};x.prototype._createAs3DShape=function(a,b,c,d,f,e,g){var k=this,l=this.getFastUpdateAttrValues(a);a=l?function(a){return y.evaluateModelTransform(k._fastUpdates.materialParameters,
l,a)}:null;c=J.createPointGeometry(L,null,c,d,X,null,l);c=[new E(c,e)];e=u.createStageObjectForPoint.call(this,b,c,[[this._material]],null,null,f,e,this._context.layer.uid,g,!0,a);if(null===e)return null;var h=new t(this,e.object,c,null,null,m.perObjectElevationAligner,f);h.alignedTerrainElevation=e.terrainElevation;h.needsElevationUpdates=u.needsElevationUpdates2D(f.mode)||"absolute-height"===f.mode;h.getScreenSize=this._createScreenSizeGetter(d,a);h.calculateRelativeScreenBounds=function(a){return k._material.calculateRelativeScreenBounds(h.getScreenSize(),
1,a)};u.extendPointGraphicElevationContext(h,b,this._context.elevationProvider);return h};x.prototype._createAsOverlay=function(a,b,c,d,f,e,g){var k=this;this._drapedMaterial.renderPriority=this._symbolLayerOrder;f=O.create();B.pointToVector(b,f,this._context.overlaySR);f[2]=this._getDrapedZ();if((b=this._context.clippingExtent)&&!u.pointInBox2D(f,b))return null;var l=this.getFastUpdateAttrValues(a);a=l?function(a){return y.evaluateModelTransform(k._fastUpdates.materialParameters,l,a)}:null;c=J.createPointGeometry(L,
f,c,d,null,null,l);b=new F(c);b.material=this._drapedMaterial;b.center=f;b.bsRadius=0;b.transformation=P;b.name=e;b.uniqueName=e+"#"+c.id;var m=new r(this,[b],null);m.getScreenSize=this._createScreenSizeGetter(d,a);m.calculateRelativeScreenBounds=function(a){return k._drapedMaterial.calculateRelativeScreenBounds(m.getScreenSize(),1,a)};return m};x.prototype._createScreenSizeGetter=function(a,b){var c=this._outlineSize+2;if(this._fastUpdates.enabled){var d=a[0]/this._symbolTextureRatio,f=a[1]/this._symbolTextureRatio;
return function(a){void 0===a&&(a=Array(2));var e=b(P);a[0]=e[0]*d+c;a[1]=e[5]*f+c;return a}}var e=a[0]/this._symbolTextureRatio+c,g=a[1]/this._symbolTextureRatio+c;return function(a){void 0===a&&(a=Array(2));a[0]=e;a[1]=g;return a}};x.prototype._supportsShaderVisualVariables=function(){return!0};x.prototype._fastVisualVariableConvertOptions=function(){var a=this._size[0]>this._size[1]?this._size[0]:this._size[1],b=[a,a,a],c=k.px2pt(1),a=a*c;return{modelSize:b,symbolSize:[a,a,a],unitInMeters:c,transformation:{anchor:N,
scale:S,rotation:N}}};x.prototype._hasVisibleVerticalOffset=function(a){return this.symbolContainer&&"point-3d"===this.symbolContainer.type&&this.symbolContainer.hasVisibleVerticalOffset()};x.PRIMITIVE_SIZE=Q;x.VALID_ANCHOR_STRINGS=aa;return x}(x);var G={mode:"relative-to-ground",offset:0},X=q.createFrom(0,0,0,1);return x})},"esri/symbols/support/symbolUtils":function(){define(["require","exports","../../core/sniff"],function(q,h,e){Object.defineProperty(h,"__esModule",{value:!0});h.isVolumetricSymbol=
function(a){return(a=a&&a.symbolLayers)?a.some(function(a){a=a.type;return"object"===a||"path"===a||"extrude"===a}):!1};h.getIconHref=function(d,b){b=b.resource.href;return!e("esri-canvas-svg-support")&&d.styleOrigin&&a.test(b)?b.replace(a,"/resource/png/$1.png"):b};var a=/\/resource\/(.*?)\.svg$/})},"esri/views/3d/layers/graphics/Graphics3DDrapedGraphicLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./graphicUtils".split(" "),
function(q,h,e,a,d,b,g,c){q=function(){function e(a,b,c){this.type="draped";this.graphics3DSymbolLayer=a;this.renderGeometries=b;this.boundingBox=c;this.stage=null;this._visible=!1}e.prototype.initialize=function(a,b){this.stage=b};e.prototype.setVisibility=function(a){if(null!=this.stage)return this._visible!==a?((this._visible=a)?this.stage.getDrapedTextureRenderer().addRenderGeometries(this.renderGeometries):this.stage.getDrapedTextureRenderer().removeRenderGeometries(this.renderGeometries),!0):
!1};e.prototype.destroy=function(){this.stage&&this._visible&&this.stage.getDrapedTextureRenderer().removeRenderGeometries(this.renderGeometries);this._visible=!1;this.stage=null};e.prototype.getBSRadius=function(){return this.renderGeometries.reduce(function(a,b){return Math.max(a,b.bsRadius)},0)};e.prototype.getCenterObjectSpace=function(){return[0,0,0]};e.prototype.addHighlight=function(a,b){var c=this.stage.getDrapedTextureRenderer();this.renderGeometries.forEach(function(d){var f=c.addRenderGeometryHighlight(d,
b);a.addRenderGeometry(d,c,f)})};e.prototype.removeHighlight=function(a){this.renderGeometries.forEach(function(b){a.removeRenderGeometry(b)})};e.prototype.getProjectedBoundingBox=function(e,g,k,l){return d(this,void 0,void 0,function(){var d,m,h,p;return a(this,function(a){switch(a.label){case 0:b.empty(k);for(d=0;d<this.renderGeometries.length;d++)m=this.renderGeometries[d],this._getRenderGeometryProjectedBoundingRect(m,f,e,l),b.expand(k,f);if(!g)return[3,5];b.center(k,n);h=void 0;p=c.demResolutionForBoundingBox(k,
g);a.label=1;case 1:return a.trys.push([1,3,,4]),[4,g.service.queryElevation(n[0],n[1],p)];case 2:return h=a.sent(),[3,4];case 3:return a.sent(),h=null,[3,4];case 4:null!=h&&(k[2]=Math.min(k[2],h),k[5]=Math.max(k[5],h)),a.label=5;case 5:return[2,k]}})})};e.prototype._getRenderGeometryProjectedBoundingRect=function(a,c,d,f){if(this.boundingBox)b.set(k,this.boundingBox);else{var e=a.center;a=a.bsRadius;k[0]=e[0]-a;k[1]=e[1]-a;k[2]=e[2]-a;k[3]=e[0]+a;k[4]=e[1]+a;k[5]=e[2]+a}d(k,0,2);this.calculateRelativeScreenBounds&&
f.push({location:b.center(k),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()});return b.toRect(k,c)};return e}();var f=g.create(),k=b.create(),n=[0,0,0];return q})},"esri/views/3d/layers/graphics/SignedDistanceFunctions":function(){define(["require","exports","../../webgl-engine/lib/Util"],function(q,h,e){Object.defineProperty(h,"__esModule",{value:!0});h.computeSignedDistancefieldCicle=function(a,d){var b=new Uint8Array(4*a*a),g=a/2-.5;d/=2;for(var c=0;c<a;c++)for(var f=0;f<a;f++){var k=
f+a*c,h=f-g,l=c-g,h=Math.sqrt(h*h+l*l)-d,h=h/a+.5;e.packFloatRGBA(h,b,4*k)}return b};h.computeSignedDistancefieldSquare=function(a,d,b){b&&(d/=Math.SQRT2);for(var g=new Uint8Array(4*a*a),c=0;c<a;c++)for(var f=0;f<a;f++){var k=f-.5*(a-.5),h=c-.5*(a-.5),l=c*a+f;if(b)var p=(k+h)/Math.SQRT2,h=(h-k)/Math.SQRT2,k=p;k=Math.max(Math.abs(k),Math.abs(h))-.5*d;k=k/a+.5;e.packFloatRGBA(k,g,4*l)}return g};h.computeSignedDistancefieldCrossAndX=function(a,d,b){b&&(d*=Math.SQRT2);d*=.5;for(var g=new Uint8Array(4*
a*a),c=0;c<a;c++)for(var f=0;f<a;f++){var k=f-.5*a,h=c-.5*a,l=c*a+f;if(b)var p=(k+h)/Math.SQRT2,h=(h-k)/Math.SQRT2,k=p;p=void 0;k=Math.abs(k);h=Math.abs(h);p=k>h?k>d?Math.sqrt((k-d)*(k-d)+h*h):h:h>d?Math.sqrt(k*k+(h-d)*(h-d)):k;p=p/a+.5;e.packFloatRGBA(p,g,4*l)}return g}})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define(["require","exports","../../../../renderers/support/utils","../graphics/graphicUtils","../../lib/glMatrix"],function(q,h,e,a,d){function b(a){return null!==a&&
void 0!==a}function g(a){return"number"===typeof a}function c(a,b){a&&a.push(b)}function f(a,d,f,l,m){var h=a.minSize,n=a.maxSize;if(a.expression)return c(m,"Could not convert size info: expression not supported"),!1;if(a.useSymbolValue)return a=l.symbolSize[f],d.minSize[f]=a,d.maxSize[f]=a,d.offset[f]=d.minSize[f],d.factor[f]=0,d.type[f]=1,!0;if(b(a.field)){if(b(a.stops)){if(2===a.stops.length&&g(a.stops[0].size)&&g(a.stops[1].size))return k(a.stops[0].size,a.stops[1].size,a.stops[0].value,a.stops[1].value,
d,f),d.type[f]=1,!0;c(m,"Could not convert size info: stops only supported with 2 elements");return!1}if(g(h)&&g(n)&&b(a.minDataValue)&&b(a.maxDataValue))return k(h,n,a.minDataValue,a.maxDataValue,d,f),d.type[f]=1,!0;if(null!=e.meterIn[a.valueUnit])return d.minSize[f]=-Infinity,d.maxSize[f]=Infinity,d.offset[f]=0,d.factor[f]=1/e.meterIn[a.valueUnit],d.type[f]=1,!0;"unknown"===a.valueUnit?c(m,"Could not convert size info: proportional size not supported"):c(m,"Could not convert size info: scale-dependent size not supported");
return!1}if(!b(a.field)){if(a.stops&&a.stops[0]&&g(a.stops[0].size))return d.minSize[f]=a.stops[0].size,d.maxSize[f]=a.stops[0].size,d.offset[f]=d.minSize[f],d.factor[f]=0,d.type[f]=1,!0;if(g(h))return d.minSize[f]=h,d.maxSize[f]=h,d.offset[f]=h,d.factor[f]=0,d.type[f]=1,!0}c(m,"Could not convert size info: unsupported variant of sizeInfo");return!1}function k(a,b,c,d,f,e){d=0<Math.abs(d-c)?(b-a)/(d-c):0;f.minSize[e]=0<d?a:b;f.maxSize[e]=0<d?b:a;f.offset[e]=a-c*d;f.factor[e]=d}function n(a,b,d,e){if(a.normalizationField||
a.valueRepresentation)return c(e,"Could not convert size info: unsupported property"),null;var g=a.field;if(null!=g&&"string"!==typeof g)return c(e,"Could not convert size info: field is not a string"),null;if(!b.size)b.size={field:a.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[0,0,0]};else if(a.field)if(!b.size.field)b.size.field=a.field;else if(a.field!==b.size.field)return c(e,"Could not convert size info: multiple fields in use"),null;switch(a.axis){case "width":return(g=
f(a,b.size,0,d,e))?b:null;case "height":return(g=f(a,b.size,2,d,e))?b:null;case "depth":return(g=f(a,b.size,1,d,e))?b:null;case "width-and-depth":return(g=f(a,b.size,0,d,e))&&f(a,b.size,1,d,e),g?b:null;case null:case void 0:case "all":return(g=(g=(g=f(a,b.size,0,d,e))&&f(a,b.size,1,d,e))&&f(a,b.size,2,d,e))?b:null;default:return c(e,'Could not convert size info: unknown axis "'+a.axis+'""'),null}}function l(a,b,d){for(var f=0;3>f;++f){var e=b.unitInMeters;1===a.type[f]&&(e*=b.modelSize[f],a.type[f]=
2);a.minSize[f]/=e;a.maxSize[f]/=e;a.offset[f]/=e;a.factor[f]/=e}if(0!==a.type[0])b=0;else if(0!==a.type[1])b=1;else if(0!==a.type[2])b=2;else return c(d,"No size axis contains a valid size or scale"),!1;for(f=0;3>f;++f)0===a.type[f]&&(a.minSize[f]=a.minSize[b],a.maxSize[f]=a.maxSize[b],a.offset[f]=a.offset[b],a.factor[f]=a.factor[b],a.type[f]=a.type[b]);return!0}function p(a,b,c){a[4*b+0]=c.r/255;a[4*b+1]=c.g/255;a[4*b+2]=c.b/255;a[4*b+3]=c.a}function m(a,d,f){if(a.normalizationField)return c(f,
"Could not convert color info: unsupported property"),null;if("string"===typeof a.field)if(a.stops){if(8<a.stops.length)return c(f,"Could not convert color info: too many color stops"),null;d.color={field:a.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};a=a.stops;for(f=0;8>f;++f){var e=a[Math.min(f,a.length-1)];d.color.values[f]=e.value;p(d.color.colors,f,e.color)}}else if(a.colors){if(!b(a.minDataValue)||!b(a.maxDataValue))return c(f,"Could not convert color info: missing data values"),
null;if(2!==a.colors.length)return c(f,"Could not convert color info: invalid colors array"),null;d.color={field:a.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};d.color.values[0]=a.minDataValue;p(d.color.colors,0,a.colors[0]);d.color.values[1]=a.maxDataValue;p(d.color.colors,1,a.colors[1]);for(f=2;8>f;++f)d.color.values[f]=a.maxDataValue,p(d.color.colors,f,a.colors[1])}else return c(f,"Could not convert color info: missing stops or colors"),
null;else if(a.stops&&0<=a.stops.length||a.colors&&0<=a.colors.length)for(a=a.stops&&0<=a.stops.length?a.stops[0].color:a.colors[0],d.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},f=0;8>f;f++)d.color.values[f]=Infinity,p(d.color.colors,f,a);else return c(f,"Could not convert color info: no field and no colors/stops"),null;return d}function r(a,b,c,d){a=2===c&&"arithmetic"===a.rotationType;b.offset[c]=a?90:0;b.factor[c]=a?-1:1;
b.type[c]=1}function t(a,b,d){if("string"!==typeof a.field)return c(d,"Could not convert rotation info: field is not a string"),null;if(!b.rotation)b.rotation={field:a.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};else if(a.field)if(!b.rotation.field)b.rotation.field=a.field;else if(a.field!==b.rotation.field)return c(d,"Could not convert rotation info: multiple fields in use"),null;switch(a.axis){case "tilt":return r(a,b.rotation,0,d),b;case "roll":return r(a,b.rotation,1,d),b;case null:case void 0:case "heading":return r(a,
b.rotation,2,d),b;default:return c(d,'Could not convert rotation info: unknown axis "'+a.axis+'""'),null}}function u(a,b,d){if(!a)return null;var f=!b.supportedTypes||!!b.supportedTypes.size,e=!b.supportedTypes||!!b.supportedTypes.color,g=!b.supportedTypes||!!b.supportedTypes.rotation;return(a=a.reduce(function(a,k){if(!a)return a;if(k.valueExpression)return c(d,"Could not convert visual variables: arcade expressions not supported"),null;switch(k.type){case "size":return f?n(k,a,b,d):a;case "color":return e?
m(k,a,d):a;case "rotation":return g?t(k,a,d):a;default:return c(d,"Could not convert visual variables: unsupported type "+k.type),null}},{size:null,color:null,rotation:null}))&&a.size&&!l(a.size,b,d)?null:a}function x(a,b,c){if(!!a!==!!b||a&&a.field!==b.field)return!1;if(a&&"rotation"===c)for(c=0;3>c;c++)if(a.type[c]!==b.type[c]||a.offset[c]!==b.offset[c]||a.factor[c]!==b.factor[c])return!1;return!0}function v(a,b){var c={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,
vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvSymbolAnchor:null,vvSymbolRotation:null},d=a&&null!=a.size;a&&a.size?(c.vvSizeEnabled=!0,c.vvSizeMinSize=a.size.minSize,c.vvSizeMaxSize=a.size.maxSize,c.vvSizeOffset=a.size.offset,c.vvSizeFactor=a.size.factor):a&&d&&(c.vvSizeValue=b.transformation.scale);a&&d&&(c.vvSymbolAnchor=b.transformation.anchor,c.vvSymbolRotation=b.transformation.rotation);a&&a.color&&(c.vvColorEnabled=!0,c.vvColorValues=a.color.values,c.vvColorColors=
a.color.colors);return c}Object.defineProperty(h,"__esModule",{value:!0});h.convertVisualVariables=u;h.initFastSymbolUpdatesState=function(a,b,c){return b&&a&&!a.disableFastUpdates?(a=u(a.visualVariables,c))?{enabled:!0,visualVariables:a,materialParameters:v(a,c),customTransformation:a&&null!=a.size}:{enabled:!1}:{enabled:!1}};h.updateFastSymbolUpdatesState=function(a,b,c){if(!b||!a.enabled)return!1;var d=a.visualVariables;b=u(b.visualVariables,c);if(!(b&&x(d.size,b.size,"size")&&x(d.color,b.color,
"color")&&x(d.rotation,b.rotation,"rotation")))return!1;a.visualVariables=b;a.materialParameters=v(b,c);a.customTransformation=b&&null!=b.size;return!0};h.getMaterialParams=v;var A;(function(b){var c=d.mat4d,f=d.vec3,e=c.create(),g=f.create();b.evaluateModelTransform=function(b,d,f){if(!b.vvSizeEnabled)return f;c.set(f,e);a.computeObjectRotation(b.vvSymbolRotation[2],b.vvSymbolRotation[0],b.vvSymbolRotation[1],e);if(b.vvSizeEnabled){for(f=0;3>f;++f){var k=b.vvSizeOffset[f]+d[0]*b.vvSizeFactor[f],
l=f;var m=b.vvSizeMinSize[f],h=b.vvSizeMaxSize[f],k=k<m?m:k>h?h:k;g[l]=k}c.scale(e,g,e)}else c.scale(e,b.vvSizeValue,e);c.translate(e,b.vvSymbolAnchor,e);return e}})(A||(A={}));h.evaluateModelTransform=A.evaluateModelTransform})},"esri/views/3d/webgl-engine/lib/Texture":function(){define("require exports ../../../../core/Logger ../../../3d/support/imageUtils ../../../3d/support/buffer/typedArrayUtil ./DDSUtil ./DefaultVertexBufferLayouts ./gl-matrix ./glUtil3D ./IdGen ./Util ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m){function r(b,c,d,f,e,g,k){k=!1!==k;a.requestImage(c).then(function(a){n.assert(1<=a.width&&1<=a.height);d.samplingMode=k?9987:9729;d.hasMipmap=k;!k&&33071===d.wrapMode||n.isPowerOfTwo(a.width)&&n.isPowerOfTwo(a.height)?(d.width=a.width,d.height=a.height,a=new p(b,d,a)):a=t(b,a,d,f,e);b.bindTexture(a);g(a)}).catch(function(a){var b=200<c.length?c.slice(0,100)+"..."+c.slice(c.length-100):c;u.error("Failed to load image from uri",b,a);g(null)})}function t(a,b,c,
d,e){var k=n.nextHighestPowerOfTwo(b.width),h=n.nextHighestPowerOfTwo(b.height);n.assert(k!==b.width||h!==b.height);c.width=k;c.height=h;var u=new p(a,c),r=l.createWithAttachments(a,u,{colorTarget:0,depthStencilTarget:0});b=new p(a,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!!c.flipped,maxAnisotropy:8,preMultiplyAlpha:c.preMultiplyAlpha},b);a.bindFramebuffer(r);void 0===e&&(e=a.getViewport(),e=[e.x,e.y,e.width,e.height]);a.setViewport(0,0,k,h);d=d.get("texOnly");
k=x.identity();a.bindProgram(d);d.setUniformMatrix4fv("model",k);d.setUniformMatrix4fv("view",k);d.setUniformMatrix4fv("proj",k);d.setUniform4f("color",1,1,1,1);d.setUniform1i("tex",0);d=f.createQuadVAO(a,g.Pos3Tex);a.bindTexture(b,0);a.bindVAO(d);a.setDepthTestEnabled(!1);a.setBlendingEnabled(!1);a.drawArrays(5,0,m.vertexCount(d,"geometry"));a.setDepthTestEnabled(!0);a.bindFramebuffer(null);a.setViewport(e[0],e[1],e[2],e[3]);d.dispose(!0);b.dispose();a.bindFramebuffer(null);r.detachColorTexture();
r.dispose();c.hasMipmap&&u.generateMipmap();return u}var u=e.getLogger("esri.views.3d.webgl-engine.lib.Texture"),x=c.mat4d;return function(){function a(b,c,d){this.data=b;this.id=a.idGen.gen(c);this.unloadFunc=void 0;this.params=d||{};this.params.wrapClamp=this.params.wrapClamp||!1;this.params.mipmap=!1!==this.params.mipmap;this.params.noUnpackFlip=this.params.noUnpackFlip||!1;this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1;this.estimatedTexMemRequiredMB=a.estimateTexMemRequiredMB(this.data,
this.params)}a.estimateTexMemRequiredMB=function(a,b){return null==a?0:d.isArrayBuffer(a)||d.isUint8Array(a)?a.byteLength/1E6:a instanceof Image||a instanceof ImageData||a instanceof HTMLCanvasElement?(b.mipmap?4/3:1)*a.width*a.height*4/1E6:(b.mipmap?4/3:1)*b.width*b.height*4/1E6||0};a.prototype.getEstimatedTexMemRequiredMB=function(){return this.estimatedTexMemRequiredMB};a.prototype.dispose=function(){this.data=void 0};a.prototype.deferredLoading=function(){return"string"===typeof this.data};a.prototype.getWidth=
function(){return this.params.width};a.prototype.getHeight=function(){return this.params.height};a.prototype.initializeThroughUpload=function(c,f,e,g,k){var l=this.data;f.flipped=!this.params.noUnpackFlip;f.samplingMode=this.params.mipmap?9987:9729;f.hasMipmap=this.params.mipmap;f.wrapMode=this.params.wrapClamp?33071:10497;f.preMultiplyAlpha=this.params.preMultiplyAlpha;if("string"===typeof l)r(c,l,f,e,g,k,this.params.mipmap);else{if(l instanceof Image||l instanceof ImageData||l instanceof HTMLCanvasElement)this.params.width=
l.width,this.params.height=l.height,!this.params.mipmap&&this.params.wrapClamp||n.isPowerOfTwo(l.width)&&n.isPowerOfTwo(l.height)?(f.width=l.width,f.height=l.height,f=new p(c,f,l)):f=t(c,l,f,e,g);else if(d.isArrayBuffer(l)&&this.params.encoding===a.DDS_ENCODING)f=b.createDDSTexture(c,f,l,this.params.mipmap);else if(d.isUint8Array(l)&&this.params.encoding===a.DDS_ENCODING)f=b.createDDSTexture(c,f,l.buffer,this.params.mipmap);else if(d.isUint8Array(l))n.assert(0<this.params.width&&0<this.params.height),
f.pixelFormat=1===this.params.components?6409:6408,f.width=this.params.width,f.height=this.params.height,f=new p(c,f,l);else{if(null!==l)throw console.warn("Unsupported image data"),Error("Unsupported image data");f=new p(c,f,null)}c.bindTexture(f);k(f)}this.data=void 0};a.prototype.setUnloadFunc=function(a){this.unloadFunc=a};a.prototype.unload=function(){void 0!==this.unloadFunc&&(this.unloadFunc(this.id),this.unloadFunc=void 0)};a.createEmpty=function(b){void 0===b&&(b="emptyTexture");return new a(new Uint8Array([0,
0,0,0]),b,{width:1,height:1,wrapClamp:!0})};a.idGen=new k;a.DDS_ENCODING="image/vnd-ms.dds";return a}()})},"esri/views/3d/webgl-engine/lib/DDSUtil":function(){define(["require","exports","../../../webgl/Texture"],function(q,h,e){function a(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}Object.defineProperty(h,"__esModule",{value:!0});var d=a("DXT1"),b=a("DXT3"),g=a("DXT5");h.createDDSTexture=function(a,f,k,h){var c=new Int32Array(k,0,31);if(542327876!==
c[0])return console.error("Invalid magic number in DDS header"),null;if(!(c[20]&4))return console.error("Unsupported format, must contain a FourCC code"),null;var n=c[21],m;switch(n){case d:n=8;m=33776;break;case b:n=16;m=33778;break;case g:n=16;m=33779;break;default:return console.error("Unsupported FourCC code:",String.fromCharCode(n&255,n>>8&255,n>>16&255,n>>24&255)),null}var r=1;c[2]&131072&&!1!==h&&(r=Math.max(1,c[7]));h=c[4];var t=c[3],u=c[1]+4,x,v;f.samplingMode=1<r?9987:9729;f.hasMipmap=1<
r;f.width=c[4];f.height=c[3];f=new e(a,f);a.bindTexture(f);for(c=0;;++c){c<r&&(v=Math.floor((h+3)/4)*Math.floor((t+3)/4)*n,x=new Uint8Array(k,u,v));a.gl.compressedTexImage2D(a.gl.TEXTURE_2D,c,m,h,t,0,x);u+=v;if(1===h&&1===t||1===r)break;h=Math.max(1,h>>1);t=Math.max(1,t>>1)}return f}})},"esri/views/3d/layers/graphics/Graphics3DLineSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../../../geometry/Polygon ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ./ElevationAligners ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./lineUtils ../../lib/glMatrix ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u,x,v){var A=r.vec3d,y=r.mat4d;return function(l){function h(){return null!==l&&l.apply(this,arguments)||this}e(h,l);h.prototype._prepareResources=function(){var a=this.symbol,b=this._isPropertyDriven("size")||this._isPropertyDriven("color")||this._isPropertyDriven("opacity"),a={idHint:this._getStageIdHint(),width:this._getWidth(a),color:this._getMaterialOpacityAndColor()};if(!this._isPropertyDriven("size")){var c=p.validateSymbolLayerSize(a.width);if(c){this._logWarning(c);
this.reject();return}}if(b||1.5<=a.width)this._isPropertyDriven("size")&&(a.width=0),this._material=m.createRibbonMaterial(a);else if(0<a.width)this._material=m.createNativeMaterial(a);else{this.reject();return}this._context.stage.add(t.ModelContentType.MATERIAL,this._material);this.resolve()};h.prototype._getWidth=function(b){return null!=b.size?a.pt2px(b.size):1};h.prototype.destroy=function(){l.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(t.ModelContentType.MATERIAL,
this._material.id),this._material=null)};h.prototype.createGraphics3DGraphic=function(b){var c=b.renderingInfo;b=b.graphic;var d=b.geometry;if("polyline"!==d.type&&"polygon"!==d.type&&"extent"!==d.type)return this._logWarning("unsupported geometry type for line symbol: "+d.type),null;if(!this._validateGeometry(d))return null;var d="polygon"===d.type||"extent"===d.type?"rings":"paths",f="graphic"+b.uid,e=this._getVertexOpacityAndColor(c,Float32Array,255),g=0;c.size&&this._isPropertyDriven("size")&&
(g=n.getSingleSizeDriver(c.size),g=a.pt2px(g));c=this.getGraphicElevationContext(b);return"on-the-ground"===c.mode?this._createAsOverlay(b,d,e,g,c,f):this._createAs3DShape(b,d,e,g,c,f,b.uid)};h.prototype.layerPropertyChanged=function(a,b,c){if("opacity"===a)return b=this._material.getColor(),this._material.setColor([b[0],b[1],b[2],this._getMaterialOpacity()]),!0;if("elevationInfo"===a){a=this._elevationContext.mode;this._updateElevationContext();var d=this._elevationContext.mode;if(null==a||null==
d)return!1;if("on-the-ground"===a&&"on-the-ground"===d)return!0;if(a!==d&&("on-the-ground"===a||"on-the-ground"===d))return!1;a=n.needsElevationUpdates2D(d);for(var f in b){var e=b[f];(d=c(e))&&"object3d"===d.type&&(e=e.graphic,d.needsElevationUpdates=a,d.elevationContext.set(this.getGraphicElevationContext(e)))}return!0}return!1};Object.defineProperty(h.prototype,"numberOfVertices",{get:function(){return 0},enumerable:!0,configurable:!0});h.prototype._getOutlineGeometry=function(a,b){return b};h.prototype._getGeometry=
function(a){a=a.geometry;"extent"===a.type&&(a=d.fromExtent(a));return a};h.prototype._createAs3DShape=function(a,b,d,f,e,l,h){var p=this._getGeometry(a),r=p[b],t=this._getOutlineGeometry(p,r);a=[];var v=[],q=[],C=A.create(),B=Array(6),p=n.getGeometryVertexData3D(t,g.hasZ(p),p.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,e);this._logGeometryCreationWarnings(p,r,b,"LineSymbol3DLayer");if(0<t.length){for(var r=p.geometryData.outlines,
t=p.eleVertexData,I=p.vertexData,H=0;H<r.length;++H){var T=r[H];if(!(1>=T.count)){var Q=T.index,G=T.count;if(this._context.clippingExtent&&(n.computeBoundingBox(t,Q,G,B),n.boundingBoxClipped(B,this._context.clippingExtent)))continue;n.chooseOrigin(I,Q,G,C);n.subtractCoordinates(I,Q,G,C);T=new Float64Array(t.buffer,3*Q*t.BYTES_PER_ELEMENT,3*G);Q=new Float64Array(I.buffer,3*Q*I.BYTES_PER_ELEMENT,3*G);Q=m.createPolylineGeometry(Q,T,"rings"===b,d,f);Q=new u(Q,l+"path"+H);Q.singleUse=!0;a.push(Q);v.push([this._material]);
Q=y.identity();y.translate(Q,C,Q);q.push(Q)}}if(0<a.length)return b=new x({geometries:a,materials:v,transformations:q,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:h},idHint:l}),b=new k(this,b,a,null,null,c.perVertexElevationAligner,e),b.alignedTerrainElevation=p.terrainElevation,b.needsElevationUpdates=n.needsElevationUpdates2D(e.mode),b}return null};h.prototype._createAsOverlay=function(a,c,d,e,g,k){var l=this._getGeometry(a);this._material.renderPriority=this._symbolLayerOrder;
var h=l[c],p=this._getOutlineGeometry(l,h);a=[];g=Array(6);var u=b.empty(),r=A.create(),l=n.getGeometryVertexDataDraped(p,l.spatialReference,this._context.overlaySR);this._logGeometryCreationWarnings(l,h,c,"LineSymbol3DLayer");if(0<p.length){h=l.vertexData;p=l.geometryData.outlines;for(l=0;l<p.length;++l){var t=p[l],x=t.index,t=t.count;n.computeBoundingBox(h,x,t,g);if(!n.boundingBoxClipped(g,this._context.clippingExtent)){b.expand(u,g);n.chooseOrigin(h,x,t,r);n.subtractCoordinates(h,x,t,r);n.setZ(h,
x,t,this._getDrapedZ());t=new Float64Array(h.buffer,3*x*h.BYTES_PER_ELEMENT,3*t);x=y.identity();y.translate(x,r,x);var t=m.createPolylineGeometry(t,null,"rings"===c,d,e),q=new v(t);q.material=this._material;q.center=[.5*(g[0]+g[3]),.5*(g[1]+g[4]),0];q.bsRadius=.5*Math.sqrt((g[3]-g[0])*(g[3]-g[0])+(g[4]-g[1])*(g[4]-g[1]));q.transformation=x;q.name=k;q.uniqueName=k+"#"+t.id;a.push(q)}}return new f(this,a,u)}return null};return h}(l)})},"esri/views/3d/layers/graphics/lineUtils":function(){define("require exports ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Util ../../webgl-engine/materials/NativeLineMaterial ../../webgl-engine/materials/RibbonLineMaterial".split(" "),
function(q,h,e,a,d,b){function g(a){var b=a.length;return a[0]===a[b-3]&&a[1]===a[b-2]&&a[2]===a[b-1]}Object.defineProperty(h,"__esModule",{value:!0});var c=a.VertexAttrConstants;h.createRibbonMaterial=function(a){var c={width:a.width,color:a.color,miterLimit:a.miterLimit,polygonOffset:!0};"miter"===a.join||"bevel"===a.join?c.join=a.join:(c.join="miter",a.join&&console.warn("unsupported join type for line symbol: "+a.join));return new b(c,a.idHint+"_ribbonlinemat")};h.createNativeMaterial=function(a){return new d({color:a.color},
a.idHint+"_nativelinemat")};h.isClosed=g;h.createPolylineGeometry=function(a,b,d,l,h){var f,k,n;if(d=d&&!g(a)){d=new Float32Array(a.length+3);for(k=0;k<a.length;k++)d[k]=a[k];k=d.length;d[k-3]=a[0];d[k-2]=a[1];d[k-1]=a[2];f=a.length/3+1;k=new Uint32Array(2*(f-1));n=new Uint32Array(2*(f-1))}else f=a.length/3,k=new Uint32Array(2*(f-1)),n=new Uint32Array(2*(f-1)),d=a;a=new Float32Array(1);a[0]=h;for(var p=h=0,x=0;x<f-1;x++)k[h++]=x,k[h++]=x+1,n[p++]=0,n[p++]=0;h={};f={};h[c.POSITION]=k;h[c.COLOR]=n;
h[c.SIZE]=n;f[c.POSITION]={size:3,data:d,offsetIdx:0,strideIdx:3};f[c.COLOR]={size:4,data:l,offsetIdx:0,strideIdx:4};f[c.SIZE]={size:1,data:a,offsetIdx:0,strideIdx:1};b&&(h.mapPos=k,f.mapPos={size:3,data:b,offsetIdx:0,strideIdx:3});return new e(f,h,e.DefaultOffsets,"line")}})},"esri/views/3d/webgl-engine/materials/NativeLineMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Logger ../../support/geometryUtils ../lib/ComponentUtils ../lib/DefaultVertexBufferLayouts ../lib/gl-matrix ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/Util ./internal/MaterialUtil ../../../webgl/Util".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m){var r=l.VertexAttrConstants,t=g.Pos3,u=m.getStride(t)/4,x={color:[1,1,1,1]},v=a.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");q=function(a){function f(b,c){c=a.call(this,c)||this;c.params=p.copyParameters(b,x);c.canBeMerged=!0;return c}e(f,a);f.prototype.setColor=function(a){this.params.color=a;this.notifyDirty("matChanged")};f.prototype.getColor=function(){return this.params.color};f.prototype.getParameterValues=function(){return{color:this.params.color}};
f.prototype.getOutputAmount=function(a){return a*u};f.prototype.getInstanceBufferLayout=function(){};f.prototype.getVertexBufferLayout=function(){return t};f.prototype.fillInterleaved=function(a,b,c,d,f,e,g){c=a.vertexAttr[r.POSITION].data;if(b)for(g=c,c=S,d=0;d<g.length;d+=3){var k=g[d],l=g[d+1],m=g[d+2];c[d]=b[0]*k+b[4]*l+b[8]*m+b[12];c[d+1]=b[1]*k+b[5]*l+b[9]*m+b[13];c[d+2]=b[2]*k+b[6]*l+b[10]*m+b[14]}a=a.indices[r.POSITION];for(d=0;d<a.length;d++)b=3*a[d],f[e++]=c[b],f[e++]=c[b+1],f[e++]=c[b+
2]};f.prototype.intersect=function(a,f,e,g,k,m,h,n){if(g.isSelection&&!b.isAllHidden(f.componentVisibilities,a.data.componentOffsets))if(l.isTranslationMatrix(e)){f=a.getData().getVertexAttr().position.data;k=g.camera;m=g.point;c.vec3d.set3(m[0]-2,m[1]+2,0,K[0]);c.vec3d.set3(m[0]+2,m[1]+2,0,K[1]);c.vec3d.set3(m[0]+2,m[1]-2,0,K[2]);c.vec3d.set3(m[0]-2,m[1]-2,0,K[3]);for(n=0;4>n;n++)k.unprojectPoint(K[n],O[n]);d.plane.fromPoints(k.eye,O[0],O[1],P);d.plane.fromPoints(k.eye,O[1],O[2],L);d.plane.fromPoints(k.eye,
O[2],O[3],U);d.plane.fromPoints(k.eye,O[3],O[0],N);a=Number.MAX_VALUE;for(n=0;n<f.length-5;n+=3)if(C[0]=f[n]+e[12],C[1]=f[n+1]+e[13],C[2]=f[n+2]+e[14],B[0]=f[n+3]+e[12],B[1]=f[n+4]+e[13],B[2]=f[n+5]+e[14],!(0>d.plane.distance(P,C)&&0>d.plane.distance(P,B)||0>d.plane.distance(L,C)&&0>d.plane.distance(L,B)||0>d.plane.distance(U,C)&&0>d.plane.distance(U,B)||0>d.plane.distance(N,C)&&0>d.plane.distance(N,B))){k.projectPoint(C,J);k.projectPoint(B,F);if(0>J[2]&&0<F[2]){c.vec3d.subtract(C,B,D);var p=k.frustumPlanes,
u=-d.plane.distance(p[4],C),p=u/c.vec3d.dot(D,p[4]);c.vec3d.scale(D,p,D);c.vec3d.add(C,D,C);k.projectPoint(C,J)}else if(0<J[2]&&0>F[2])c.vec3d.subtract(B,C,D),p=k.frustumPlanes,u=-d.plane.distance(p[4],B),p=u/c.vec3d.dot(D,p[4]),c.vec3d.scale(D,p,D),c.vec3d.add(B,D,B),k.projectPoint(B,F);else if(0>J[2]&&0>F[2])continue;p=l.pointLineSegmentDistanceSquared2D(J,F,m);p<a&&(a=p,c.vec3d.set(C,M),c.vec3d.set(B,H))}e=g.p0;g=g.p1;4>a&&(a=l.lineLineDistanceSquared3D(M,H,e,g,I),f=Number.MAX_VALUE,a.success&&
(c.vec3d.subtract(a.pa,e,E),a=c.vec3d.length(E),c.vec3d.scale(E,1/a),f=a/c.vec3d.dist(e,g)),h(f,E))}else v.error("intersection assumes a translation-only matrix")};f.prototype.getGLMaterials=function(){return{color:A,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:y}};f.prototype.getAllTextureIds=function(){return[]};return f}(k);var A=function(a){function b(b,c,d){b=a.call(this,b,c)||this;b.program=c.get("simple");b.updateParameters();return b}e(b,a);b.prototype.updateParameters=function(){this.params=
this.material.getParameterValues()};b.prototype.beginSlot=function(a){return a===n.OPAQUE_MATERIAL};b.prototype.getProgram=function(){return this.program};b.prototype.bind=function(a,b){b=this.program;var c=this.params;a.bindProgram(b);b.setUniform4fv("color",c.color);a.setBlendingEnabled(1>c.color[3]);a.setBlendFunctionSeparate(a.gl.SRC_ALPHA,a.gl.ONE_MINUS_SRC_ALPHA,a.gl.ONE,a.gl.ONE_MINUS_SRC_ALPHA);a.setDepthTestEnabled(!0)};b.prototype.release=function(a){1>this.params.color[3]&&a.setBlendingEnabled(!1)};
b.prototype.bindView=function(a,b){p.bindView(b.origin,b.view,this.program)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(a){return a.gl.LINES};return b}(f),y=function(a){function b(b,c,d){b=a.call(this,b,c)||this;b.program=c.get("highlight");return b}e(b,a);b.prototype.updateParameters=function(){};b.prototype.beginSlot=function(a){return a===n.OPAQUE_MATERIAL};b.prototype.getProgram=function(){return this.program};
b.prototype.bind=function(a,b){a.bindProgram(this.program);a.setDepthTestEnabled(!0)};b.prototype.release=function(a){};b.prototype.bindView=function(a,b){p.bindView(b.origin,b.view,this.program)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(a){return a.gl.LINES};return b}(f),C=c.vec3d.create(),B=c.vec3d.create(),D=c.vec3d.create(),E=c.vec3d.create(),J=c.vec3d.create(),F=c.vec3d.create(),M=c.vec3d.create(),H=c.vec3d.create(),
I={success:!1,dist2:0,pa:c.vec3d.create(),pb:c.vec3d.create()},K=[c.vec3d.create(),c.vec3d.create(),c.vec3d.create(),c.vec3d.create()],O=[c.vec3d.create(),c.vec3d.create(),c.vec3d.create(),c.vec3d.create()],P=d.plane.create(),L=d.plane.create(),U=d.plane.create(),N=d.plane.create(),S=[];return q})},"esri/views/3d/layers/graphics/Graphics3DMeshFillSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/MeshComponent ../../../../geometry/support/webMercatorUtils ../../../../geometry/support/meshUtils/projection ./ElevationAligners ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ../support/edgeUtils ../support/symbolColorUtils ../../lib/glMatrix ../../support/debugFlags ../../support/projectionUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Texture ../../webgl-engine/lib/Util ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/NativeLineMaterial".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u,x,v,A,y,C,B,D,E){var J=B.VertexAttrConstants;q=function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;a._edgeStageObjects=new Set;a._materials={};a._textures={};return a}e(d,b);d.prototype._prepareResources=function(){t.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new E({color:[1,0,1,1]},"debugVertexNormal"),this._debugFaceNormalMaterial=new E({color:[0,1,1,1]},"debugFAceNormal"));this.resolve()};d.prototype.destroy=function(){b.prototype.destroy.call(this);
this.isFulfilled()||this.reject();for(var a in this._materials)this._context.stage.remove(x.ModelContentType.MATERIAL,this._materials[a].material.id);for(a in this._textures)this._context.stage.remove(x.ModelContentType.TEXTURE,this._textures[a].id);this._materials={};this._textures={}};d.prototype.createGraphics3DGraphic=function(a){var b=a.graphic;if("mesh"!==b.geometry.type)return this._logWarning("unsupported geometry type for fill on mesh-3d symbol: "+b.geometry.type),null;if(!this._validateGeometry(b.geometry))return null;
var c="graphic"+b.uid,d=this.getGraphicElevationContext(b);return this._createAs3DShape(b,a.renderingInfo,d,c,b.uid)};d.prototype.layerPropertyChanged=function(a,b,c){if("opacity"===a){b=this._getLayerOpacity();for(var d in this._materials){c=this._materials[d];c.material.setParameterValues({layerOpacity:b});var f=c.material.getParameterValues();this._setMaterialTransparentParameter(f);c.material.setParameterValues({transparent:f.transparent})}if(0<this._edgeStageObjects.size){var e=this._context.stage.view.getEdgeView(),
g=this._getLayerOpacity();this._edgeStageObjects.forEach(function(a){e.updateAllComponentOpacities(a,[g])})}return!0}if("elevationInfo"===a){this._updateElevationContext();for(f in b)if(a=b[f],d=c(a))a=this.getGraphicElevationContext(a.graphic),d.needsElevationUpdates=n.needsElevationUpdates3D(a.mode),d.elevationContext.set(a);return!0}return!1};Object.defineProperty(d.prototype,"numberOfVertices",{get:function(){return 0},enumerable:!0,configurable:!0});d.prototype._requiresVertexColors=function(){return this._isPropertyDriven("color")||
this._isPropertyDriven("opacity")};d.prototype._colorUid=function(a){a=a.material&&a.material.color;if(!a)return"-";if(a)switch(a.type){case "value":return a.value.toHex();case "image":return a.uid}};d.prototype._materialProperties=function(a,b){a=this._requiresVertexColors();var c=b.material&&b.material.color;b=this._colorUid(b);return{hasVertexColors:a,color:c,uid:"vc:"+a+",cmuid:"+b}};d.prototype._setInternalColorValueParameters=function(b,c){c.diffuse=a.toUnitRGB(b.value);c.opacity=b.value.a};
d.prototype._setInternalColorImageParameters=function(a,b,c){var d=a.url;if(d){var f=this._textures[a.uid];f||(f=new C(d,b+"_"+a.uid+"_tex",{mipmap:!0,wrapClamp:!1,noUnpackFlip:!0}),this._textures[a.uid]=f,this._context.stage.add(x.ModelContentType.TEXTURE,f));c.textureId=f.id}};d.prototype._setInternalMaterialParameters=function(a,b,c){if(a=a.material&&a.material.color)switch(a.type){case "value":this._setInternalColorValueParameters(a,c);break;case "image":this._setInternalColorImageParameters(a,
b,c)}};d.prototype._setExternalMaterialParameters=function(b){if(this._isPropertyDriven("color"))b.externalColor=M;else{var c=this.symbol.material?a.toUnitRGBA(this.symbol.material.color):M;b.externalColor=c}if(c=this.symbol.material&&this.symbol.material.colorMixMode)b.colorMixMode=c};d.prototype._getOrCreateMaterial=function(a,b){a=this._materialProperties(a,b);var c=this._materials[a.uid];if(c)return c.material;var c=this._getStageIdHint(),d={specular:H,symbolColors:a.hasVertexColors,ambient:H,
diffuse:F,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:"none",layerOpacity:this._getLayerOpacity()};this._setInternalMaterialParameters(b,c,d);this._setExternalMaterialParameters(d);this._setMaterialTransparentParameter(d);c=new D(d,c+"_"+a.uid+"_mat");b=b.material&&b.material.color&&"value"===b.material.color.type&&b.material.color.value;this._materials[a.uid]={geometryOpacity:b?b.a:1,material:c};this._context.stage.add(x.ModelContentType.MATERIAL,c);return c};d.prototype._setMaterialTransparentParameter=
function(a){this._isPropertyDriven("opacity")&&(a.transparent=!0);a.transparent=1>a.layerOpacity||1>a.opacity||a.externalColor&&1>a.externalColor[3]};d.prototype._addDebugNormals=function(a,b,c,d){var f,e,g,k,l=b.length,m=a.spatialReference.isWGS84?20015077/180:1,h=.1*Math.max(a.extent.width*m,a.extent.height*m,a.extent.zmax-a.extent.zmin),n=[],p=[];a=[];for(var m=[],u=0;u<l;u++)for(var t=b[u],x=t.data.getAttribute(J.POSITION),y=t.data.getAttribute(J.NORMAL),q=t.data.getIndices(J.POSITION),t=t.data.getIndices(J.NORMAL),
x=x.data,y=y.data,C=0;C<q.length;C++){for(var B=3*q[C],Q=3*t[C],G=0;3>G;G++)n.push(x[B+G]);for(G=0;3>G;G++)n.push(x[B+G]+y[Q+G]*h);p.push(p.length);p.push(p.length);if(0===C%3){this._calculateFaceNormal(x,q,C,L);this._getFaceVertices(x,q,C,K,O,P);r.vec3d.add(K,O);r.vec3d.add(K,P);r.vec3d.scale(K,1/3);for(G=0;3>G;G++)a.push(K[G]);for(G=0;3>G;G++)a.push(K[G]+L[G]*h);m.push(m.length);m.push(m.length)}}l=(f={},f[J.POSITION]={data:new Float64Array(n),size:3},f);f=(e={},e[J.POSITION]=new Uint32Array(p),
e);e=new A(l,f,void 0,"line");e=new v(e,"debugVertexNormal");e.singleUse=!0;b.push(e);c.push([this._debugVertexNormalMaterial]);d.push(r.mat4d.create(d[0]));l=(g={},g[J.POSITION]={data:new Float64Array(a),size:3},g);f=(k={},k[J.POSITION]=new Uint32Array(m),k);e=new A(l,f,void 0,"line");e=new v(e,"debugFaceNormal");e.singleUse=!0;b.push(e);c.push([this._debugFaceNormalMaterial]);d.push(r.mat4d.create(d[0]))};d.prototype._createAs3DShape=function(a,b,c,d,e){var g=this;a=a.geometry;if("mesh"!==a.type)return null;
var l=this._createGeometryInfo(a,b,d);if(!l)return null;b=l.geometries;var m=l.materials,h=l.transformations,l=l.objectTransformation;t.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(a,b,m,h);var u=new y({geometries:b,materials:m,transformations:h,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicUid:e},idHint:d});u.setObjectTransformation(l);var r=function(a){var b=g._context.stage.view.getEdgeView();if(b){b.removeObject(a);g._edgeStageObjects.delete(a);var c=p.createMaterial(b,
g.symbol,g._getLayerOpacity());c&&(g._edgeStageObjects.add(a),b.addObject(a,[c],{mergeGeometries:!0}))}};r(u);d=function(a,b,c,d,e){a=f.perObjectElevationAligner(a,b,c,d,e);r(u);return a};e=new k(this,u,b,null,null,d,c);e.needsElevationUpdates=n.needsElevationUpdates3D(c.mode);c=a.extent.center.clone();c.z=0;e.elevationContext.centerPointInElevationSR=c;e.alignedTerrainElevation=d(e,e.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper,this._context.featureExpressionInfoContext);
return e};d.prototype._createComponentNormals=function(a,b,c,d){switch(c.shading||"flat"){case "source":return this._createComponentNormalsSource(a,b,c,d);case "flat":return this._createComponentNormalsFlat(a,c,d);case "smooth":return this._createComponentNormalsSmooth(a,c,d)}};d.prototype._createComponentNormalsSource=function(a,b,c,d){if(!b)return this._createComponentNormalsFlat(a,c,d);c=!1;for(var f=0;f<d.length;f+=3){this._calculateFaceNormal(a,d,f,L);for(var e=0;3>e;e++){var g=3*d[f+e];K[0]=
b[g+0];K[1]=b[g+1];K[2]=b[g+2];0>r.vec3d.dot(L,K)&&(b[g+0]=-b[g+0],b[g+1]=-b[g+1],b[g+2]=-b[g+2],c=!0)}}return{normals:b,indices:d,didFlipNormals:c}};d.prototype._createComponentNormalsFlat=function(a,b,c){b=new Float32Array(c.length);for(var d=new Uint32Array(3*c.length),f=0;f<c.length;f+=3)for(var e=this._calculateFaceNormal(a,c,f,L),g=0;3>g;g++)b[f+g]=e[g],d[f+g]=f/3;return{normals:b,indices:d,didFlipNormals:!1}};d.prototype._createComponentNormalsSmooth=function(a,b,c){b={};for(var d=0;d<c.length;d+=
3)for(var f=this._calculateFaceNormal(a,c,d,L),e=0;3>e;e++){var g=c[d+e],k=b[g];k||(k={normal:r.vec3d.create(),count:0},b[g]=k);r.vec3d.add(k.normal,f);k.count++}a=new Float32Array(3*c.length);f=new Uint32Array(3*c.length);for(d=0;d<c.length;d++){g=c[d];k=b[g];1!==k.count&&(r.vec3d.normalize(r.vec3d.scale(k.normal,1/k.count)),k.count=1);for(e=0;3>e;e++)a[3*d+e]=k.normal[e];f[d]=d}return{normals:a,indices:f,didFlipNormals:!1}};d.prototype._getFaceVertices=function(a,b,c,d,f,e){var g=3*b[c+0],k=3*b[c+
1];b=3*b[c+2];d[0]=a[g+0];d[1]=a[g+1];d[2]=a[g+2];f[0]=a[k+0];f[1]=a[k+1];f[2]=a[k+2];e[0]=a[b+0];e[1]=a[b+1];e[2]=a[b+2]};d.prototype._calculateFaceNormal=function(a,b,c,d){this._getFaceVertices(a,b,c,K,O,P);r.vec3d.subtract(O,K);r.vec3d.subtract(P,K);r.vec3d.cross(O,P,K);r.vec3d.normalize(K,d);return d};d.prototype._getOrCreateComponents=function(a){return a.components?a.components:aa};d.prototype._createPositionBuffer=function(a){var b=a.vertexAttributes.position,c=new Float64Array(b.length);n.reproject(a.vertexAttributes.position,
0,a.spatialReference,c,0,this._context.renderSpatialReference,b.length/3);return c};d.prototype._createNormalBuffer=function(a,b){var d=a.vertexAttributes.normal;if(!d)return null;if("local"===this._context.layerView.view.viewingMode)return d;var f=a.vertexAttributes.position,e=new Float32Array(d.length);return c.projectNormalToECEF(d,f,b,a.spatialReference,e)};d.prototype._createColorBuffer=function(a){if(this._requiresVertexColors()){a=this._getVertexOpacityAndColor(a);var b=this.symbol.material&&
this.symbol.material.colorMixMode||null,c=new Uint8Array(4);m.encodeSymbolColor(a,b,c);return c}return null};d.prototype._createColorIndices=function(a,b){a=new Uint32Array(b.length);for(b=0;b<a.length;b++)a[b]=0;return a};d.prototype._createBuffers=function(a,b){var c=a.vertexAttributes&&a.vertexAttributes.position;if(!c)return this._logWarning("Mesh geometry must contain position vertex attributes"),null;var d=a.vertexAttributes.normal,f=a.vertexAttributes.uv;if(d&&d.length!==c.length)return this._logWarning("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),
null;if(f&&f.length/2!==c.length/3)return this._logWarning("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;c=this._createPositionBuffer(a);b=this._createColorBuffer(b);d=this._createNormalBuffer(a,c);a=this._transformCenterLocal(a,c,d);return{positionBuffer:c,normalBuffer:d,uvBuffer:f,colorBuffer:b,objectTransformation:a}};d.prototype._transformCenterLocal=function(a,b,c){var d=a.extent.center,f=this._context.renderSpatialReference;I[0]=d.x;I[1]=d.y;I[2]=
0;d=r.mat4d.create();u.computeLinearTransformation(a.spatialReference,I,d,f);r.mat4d.inverse(d,U);for(a=0;a<b.length;a+=3)K[0]=b[a+0],K[1]=b[a+1],K[2]=b[a+2],r.mat4d.multiplyVec3(U,K),b[a+0]=K[0],b[a+1]=K[1],b[a+2]=K[2];if(c)for(r.mat4d.toMat3(d,N),r.mat3d.transpose(N,N),a=0;a<c.length;a+=3)K[0]=c[a+0],K[1]=c[a+1],K[2]=c[a+2],r.mat3d.multiplyVec3(N,K),c[a+0]=K[0],c[a+1]=K[1],c[a+2]=K[2];return d};d.prototype._validateFaces=function(a,b){a=a.vertexAttributes.position.length/3;if(b=b.faces){for(var c=
-1,d=0;d<b.length;d++){var f=b[d];f>c&&(c=f)}if(a<=c)return this._logWarning("Vertex index "+c+" is out of bounds of the mesh position buffer"),!1}else if(0!==a%3)return this._logWarning("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0};d.prototype._getOrCreateFaces=function(a,b){if(b.faces)return b.faces;a=new Uint32Array(a.vertexAttributes.position.length/3);for(b=0;b<a.length;b++)a[b]=b;return a};
d.prototype._isOutsideClippingArea=function(a){if(!this._context.clippingExtent)return!1;var b=a.vertexAttributes&&a.vertexAttributes.position;if(!b)return!1;var c=this._context.elevationProvider.spatialReference,d=b.length/3;a.spatialReference.equals(c)||(b=new Float64Array(b.length),n.reproject(a.vertexAttributes.position,0,a.spatialReference,b,0,c,d));n.computeBoundingBox(b,0,d,S);return n.boundingBoxClipped(S,this._context.clippingExtent)};d.prototype._createGeometryInfo=function(a,b,c){var d,
f;if(!g.canProject(a,this._context.layerView.view.spatialReference))return this._logWarning("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(a))return null;var e=this._createBuffers(a,b);if(!e)return null;b=e.positionBuffer;for(var k=e.uvBuffer,l=e.colorBuffer,m=e.normalBuffer,e=e.objectTransformation,h=[],n=[],p=[],u=!1,t=0,x=this._getOrCreateComponents(a);t<x.length;t++){var y=x[t];if(!this._validateFaces(a,y))return null;var q=this._getOrCreateFaces(a,
y);if(0!==q.length){var C=this._createComponentNormals(b,m,y,q);C.didFlipNormals&&(u=!0);var B=(d={},d[J.POSITION]={size:3,data:b},d[J.NORMAL]={size:3,data:C.normals},d),C=(f={},f[J.POSITION]=q,f[J.NORMAL]=C.indices,f);l&&(B[J.SYMBOLCOLOR]={size:4,data:l},C[J.SYMBOLCOLOR]=this._createColorIndices(y,q));a.vertexAttributes.uv&&(B[J.UV0]={size:2,data:k},C[J.UV0]=q);q=new A(B,C);q=new v(q,c+"_mesh");q.singleUse=!0;h.push(q);n.push(r.mat4d.identity());p.push([this._getOrCreateMaterial(a,y)])}}u&&this._logWarning("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals.");
return{geometries:h,transformations:n,materials:p,objectTransformation:e}};return d}(l);var F=[1,1,1],M=[1,1,1,1],H=[0,0,0],I=r.vec3d.create(),K=r.vec3d.create(),O=r.vec3d.create(),P=r.vec3d.create(),L=r.vec3d.create(),U=r.mat4d.create(),N=r.mat3d.create(),S=d.create(),aa=[new b];return q})},"esri/views/3d/layers/support/symbolColorUtils":function(){define(["require","exports"],function(q,h){Object.defineProperty(h,"__esModule",{value:!0});h.encodeSymbolColor=function(e,a,d){null==e||"ignore"===a?
(d[0]=255,d[1]=255,d[2]=255,d[3]=255):(d[0]=Math.floor(255*e[0]),d[1]=Math.floor(255*e[1]),d[2]=Math.floor(255*e[2]),e=Math.floor(85*e[3]),d[3]=0===e?0:"tint"===a?e:"replace"===a?e+85:e+170)}})},"esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/errors/CancelError ../../../../Color ../../../../core/lang ../../../../core/screenUtils ../../../../geometry/support/aaBoundingBox ../../../../symbols/ObjectSymbol3DLayer ./ElevationAligners ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./objectResourceUtils ./primitiveObjectSymbolUtils ../support/FastSymbolUpdates ../../lib/glMatrix ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Util ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u,x,v,A,y,C){var B=x.mat4d,D=x.vec3d,E=[v.ModelContentType.MATERIAL,v.ModelContentType.TEXTURE,v.ModelContentType.GEOMETRY],J=[1,1,1],F=[1,1,1,1],M=[0,0,0];return function(h){function p(){return null!==h&&h.apply(this,arguments)||this}e(p,h);p.prototype._prepareResources=function(){var a=this.symbol,b=this._getStageIdHint();if(!this._isPropertyDriven("size")){var c=m.validateSymbolLayerSize(this.symbol);if(c){this._logWarning(c);this.reject();return}}a.resource&&
a.resource.href?this._prepareModelResources(a.resource.href,b):this._preparePrimitiveResources(a.resource?a.resource.primitive:"sphere",b)};p.prototype._preparePrimitiveResources=function(a,f){if(t.isValidPrimitive(a)){var e=this.symbol;this._geometry=new A(t.primitiveGeometryData(a),f);this._context.stage.add(v.ModelContentType.GEOMETRY,this._geometry);this._resourceBoundingBox=t.primitiveBoundingBox(a);this._resourceSize=c.size(this._resourceBoundingBox);this._symbolSize=m.computeSizeWithResourceSize(this._resourceSize,
e);a=this._getMaterialOpacity();a={specular:[0,0,0],opacity:a,transparent:1>a||this._isPropertyDriven("opacity"),instanced:["transformation"],ambient:J,diffuse:J};var k=this.symbolContainer;if("point-3d"===k.type&&k.verticalOffset){var k=k.verticalOffset,l=k.minWorldLength,h=k.maxWorldLength;a.verticalOffset={screenLength:g.pt2px(k.screenLength),minWorldLength:l||0,maxWorldLength:null!=h?h:Infinity};a.castShadows=!1}this._context.screenSizePerspectiveEnabled&&(a.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);
this._isPropertyDriven("color")?a.externalColor=F:(e=e.material?d.toUnitRGBA(e.material.color):F,a.externalColor=e);this._fastUpdates=u.initFastSymbolUpdatesState(this._context.renderer,this._supportsShaderVisualVariables(),this._fastVisualVariableConvertOptions());this._fastUpdates.enabled?(b.mixin(a,this._fastUpdates.materialParameters),a.instanced.push("featureAttribute")):this._hasPerInstanceColor()&&a.instanced.push("color");this._material=new C(a,f+"_objectmat");this._context.stage.add(v.ModelContentType.MATERIAL,
this._material);this.resolve()}else this._logWarning("Unknown object symbol primitive: "+a),this.reject()};p.prototype._prepareModelResources=function(d,f){var e=this,k=["transformation"];f={materialParamsMixin:{instanced:k},idHint:f,streamDataSupplier:this._context.streamDataSupplier};this._fastUpdates=u.initFastSymbolUpdatesState(this._context.renderer,this._supportsShaderVisualVariables(),this._fastVisualVariableConvertOptions());this._fastUpdates.enabled?(b.mixin(f.materialParamsMixin,this._fastUpdates.materialParameters),
k.push("featureAttribute")):this._hasPerInstanceColor()&&k.push("color");k=this.symbolContainer;if("point-3d"===k.type&&k.verticalOffset){var k=k.verticalOffset,l=k.minWorldLength,h=k.maxWorldLength;f.materialParamsMixin.verticalOffset={screenLength:g.pt2px(k.screenLength),minWorldLength:l||0,maxWorldLength:null!=h?h:Infinity};f.materialParamsMixin.castShadows=!1}this._symbolLoaderPromise=r.fetch(d,f);this._symbolLoaderPromise.then(function(a){e._symbolLoaderPromise=null;if(!e.isRejected()){var b=
e._context,d=a.stageResources,f=b.stage,g=e._getExternalColorParameters(e.symbol.material),k=e._getMaterialOpacity(),l=e._isPropertyDriven("opacity"),h=d[v.ModelContentType.MATERIAL];a.originalMaterialOpacities=Array(h.length);h.forEach(function(c,d){var f=c.getParameterValues();c.setParameterValues(g);a.originalMaterialOpacities[d]=f.opacity;d=f.opacity*k;c.setParameterValues({opacity:d,transparent:1>d||l||f.transparent});b.screenSizePerspectiveEnabled&&c.setParameterValues({screenSizePerspective:b.sharedResources.screenSizePerspectiveSettings})});
E.forEach(function(a){for(var b=d[a],c=0;b&&c<b.length;c++)f.add(a,b[c])});e._resourceBoundingBox=r.computeBoundingBox(a);e._resourceSize=c.size(e._resourceBoundingBox);e._pivotOffset=a.pivotOffset;e._symbolSize=m.computeSizeWithResourceSize(e._resourceSize,e.symbol);e._i3sModel=a;u.updateFastSymbolUpdatesState(e._fastUpdates,e._context.renderer,e._fastVisualVariableConvertOptions())&&h.forEach(function(a){return a.setParameterValues(e._fastUpdates.materialParameters)});e.resolve()}},function(b){e._symbolLoaderPromise=
null;if(!e.isFulfilled()){if(!(b instanceof a)){var c="ObjectSymbol3DLayer failed to load";b&&b.message&&(c+=" ("+b.message+")");e._logWarning(c)}e.reject()}})};p.prototype._forEachMaterial=function(a){this._i3sModel?this._i3sModel.stageResources[v.ModelContentType.MATERIAL].forEach(a):a(this._material)};p.prototype._getExternalColorParameters=function(a){var b={};this._isPropertyDriven("color")?b.externalColor=F:a&&a.color?b.externalColor=d.toUnitRGBA(a.color):(b.externalColor=F,b.colorMixMode="ignore");
return b};p.prototype.destroy=function(){h.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._symbolLoaderPromise&&this._symbolLoaderPromise.cancel();var a=this._context.stage;if(this._i3sModel){var b=this._i3sModel.stageResources;E.forEach(function(c){for(var d=b[c],f=0;d&&f<d.length;f++)a.remove(c,d[f].id)})}else this._material&&a.remove(v.ModelContentType.MATERIAL,this._material.id),this._geometry&&a.remove(v.ModelContentType.GEOMETRY,this._geometry.id)};p.prototype.createGraphics3DGraphic=
function(a){var b=a.graphic;if(!this._validateGeometry(b.geometry))return null;var c=l.placePointOnGeometry(b.geometry);if(!c)return this._logWarning("unsupported geometry type for icon symbol: "+b.geometry.type),null;var d="graphic"+b.uid,f=this.getGraphicElevationContext(b);return this._createAs3DShape(b,c,a.renderingInfo,f,d,b.uid)};p.prototype.layerPropertyChanged=function(a,b,c){var d=this;if("opacity"===a){var f=this._isPropertyDriven("opacity");if(this._i3sModel){var e=this._getMaterialOpacity();
this._i3sModel.stageResources[v.ModelContentType.MATERIAL].forEach(function(a,b){b=d._i3sModel.originalMaterialOpacities[b]*e;a.setParameterValues({opacity:b,transparent:1>b||f})})}else b=this._getMaterialOpacity(),this._material.setParameterValues({opacity:b,transparent:1>b||f});return!0}if("elevationInfo"===a){this._updateElevationContext();for(var g in b){var k=b[g];if(a=c(k))k=this.getGraphicElevationContext(k.graphic),a.needsElevationUpdates=l.needsElevationUpdates3D(k.mode),a.elevationContext.set(k)}return!0}return!1};
p.prototype.applyRendererDiff=function(a,b,c,d){var f=this,e;for(e in a.diff)switch(e){case "visualVariables":if(u.updateFastSymbolUpdatesState(this._fastUpdates,b,this._fastVisualVariableConvertOptions()))this._forEachMaterial(function(a){return a.setParameterValues(f._fastUpdates.materialParameters)});else return!1;break;default:return!1}return!0};Object.defineProperty(p.prototype,"numberOfVertices",{get:function(){return this._i3sModel?this._i3sModel.numberOfVertices:this._geometry.data.getIndices(y.VertexAttrConstants.POSITION).length},
enumerable:!0,configurable:!0});p.prototype._createAs3DShape=function(a,b,c,d,f,e){var g=this,h=null,p=null,r=this.getFastUpdateAttrValues(a);r&&(h={featureAttribute:r},p=function(a){return u.evaluateModelTransform(g._fastUpdates.materialParameters,r,a)});!this._fastUpdates.enabled&&this._hasPerInstanceColor()&&(h=h||{},h.color=m.mixinColorAndOpacity(c.color,c.opacity));a=this._context.layer.uid;var t=B.identity();this._applyObjectRotation(c,t);this._applyObjectRotation(this.symbol,t);this._applyObjectScale(c,
t);this._applyAnchor(t);if(this._i3sModel){c=this._i3sModel.stageResources[v.ModelContentType.GEOMETRY];for(var x=this._i3sModel.materialsByComponent,A=Array(c.length),y=0;y<A.length;y++)A[y]=t;f=l.createStageObjectForPoint.call(this,b,c,x,A,h,d,f,a,e,null,p)}else f=l.createStageObjectForPoint.call(this,b,[this._geometry],[[this._material]],[t],h,d,f,a,e,null,p);if(null===f)return null;if(this._fastUpdates.enabled){var q=u.getMaterialParams(this._fastUpdates.visualVariables,this._fastVisualVariableConvertOptions());
this._forEachMaterial(function(a){return a.setParameterValues(q)})}f.object.setCastShadow(!0);e=new n(this,f.object,null,null,null,k.perObjectElevationAligner,d,n.VisibilityModes.REMOVE_OBJECT);e.alignedTerrainElevation=f.terrainElevation;e.needsElevationUpdates=l.needsElevationUpdates3D(d.mode);l.extendPointGraphicElevationContext(e,b,this._context.elevationProvider);return e};p.prototype._applyObjectScale=function(a,b){this._fastUpdates.enabled&&this._fastUpdates.customTransformation||(a=this._isPropertyDriven("size")&&
a.size?a.size:this._symbolSize,a=m.computeObjectScale(a,this._symbolSize,this._resourceSize,this._context.renderCoordsHelper.unitInMeters),1===a[0]&&1===a[1]&&1===a[2]||B.scale(b,a))};p.prototype._applyObjectRotation=function(a,b){if(!(this._fastUpdates.enabled&&this._fastUpdates.customTransformation&&a instanceof f))return m.computeObjectRotation(a.heading,a.tilt,a.roll,b)};p.prototype._computeAnchor=function(){switch(this.symbol.anchor){case "center":return D.scale(c.center(this._resourceBoundingBox),
-1);case "top":var a=c.center(this._resourceBoundingBox);return[-a[0],-a[1],-this._resourceBoundingBox[5]];case "bottom":return a=c.center(this._resourceBoundingBox),[-a[0],-a[1],-this._resourceBoundingBox[2]];default:return this._pivotOffset?D.scale(this._pivotOffset,-1,Array(3)):M}};p.prototype._applyAnchor=function(a){if(!this._fastUpdates.enabled||!this._fastUpdates.customTransformation){var b=this._computeAnchor();b&&B.translate(a,b)}};p.prototype._hasPerInstanceColor=function(){return this._isPropertyDriven("color")||
this._isPropertyDriven("opacity")};p.prototype._supportsShaderVisualVariables=function(){return this._context.stage.has("instancedRendering")?!0:!1};p.prototype._fastVisualVariableConvertOptions=function(){var a=this._resourceBoundingBox?c.size(this._resourceBoundingBox):J,b=this._resourceBoundingBox?this._computeAnchor():M,d=this._context.renderCoordsHelper.unitInMeters,f=m.computeObjectScale(this._symbolSize,this._symbolSize,this._resourceSize,d);return{modelSize:a,symbolSize:this._symbolSize||
J,unitInMeters:d,transformation:{anchor:b,scale:f,rotation:[this.symbol.tilt||0,this.symbol.roll||0,this.symbol.heading||0]}}};return p}(p)})},"esri/views/3d/layers/graphics/objectResourceUtils":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/sniff dojo/errors/CancelError ../../../../request ../../../../core/Error ../../../../core/lang ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../core/Version ../../../../geometry/support/aaBoundingBox ../../lib/glMatrix ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Texture ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u,x,v){function A(a,b){b.lods&&b.lods.length===a.length&&a.forEach(function(a,c){a.lodMetrics=b.lods[c].metrics});return a}function y(a,c){c=c||{};var f=c.streamDataSupplier;if(f){var e=f.request(a,"json");return k.create(function(a,b){e.then(function(b,c){a(c)},function(a){b(a instanceof d?a:C(a))})},function(){f.cancelRequest(e)})}var g=b(a);return k.create(function(a,b){g.then(function(b){a(b.data)},function(a){b(a instanceof d?a:C(a))})},function(){g.cancel()})}
function C(a){return new g("","Request for object resource failed: "+a)}function B(b,d){var f,e,g=[],k=[],h=[],m=[],n=[],p=l.Version.parse(b.version||"1.0","wosr");E.validate(p);var p="meshsymbol_"+b.model.name,r=b.textureDefinitions,A={},y;for(y in r){var q=r[y],C=q.images[0].data;C?(f=q.encoding+";base64,"+C,C="/textureDefinitions/"+y,e={noUnpackFlip:!0,wrapClamp:!1},a("enable-feature:jkieboom/alpha-channel-usage")&&(e.wrapClamp=!0),f=new x(f,p,e),n.push(f),A[C]={engineTexObj:f,alphaChannelUsage:"rgba"===
q.channels?q.alphaChannelUsage||"transparency":"none"}):D.warn("Externally referenced texture data is not yet supported")}y=b.model.geometries;r=b.materialDefinitions;for(C=q=0;C<y.length;C++){var B=y[C];e=B;var G=e.params,F=G.topology;f=!0;G.vertexAttributes||(D.warn("Geometry must specify vertex attributes"),f=!1);switch(G.topology){case "PerAttributeArray":break;case "Indexed":case null:case void 0:F=G.faces;if(!F)D.warn("Indexed geometries must specify faces"),f=!1;else if(G.vertexAttributes){var Z=
void 0;for(Z in G.vertexAttributes)(G=F[Z])&&G.values?(null!=G.valueType&&"UInt32"!==G.valueType&&(D.warn("Unsupported indexed geometry indices type '"+G.valueType+"', only UInt32 is currently supported"),f=!1),null!=G.valuesPerElement&&1!==G.valuesPerElement&&(D.warn("Unsupported indexed geometry values per element '"+G.valuesPerElement+"', only 1 is currently supported"),f=!1)):(D.warn("Indexed geometry does not specify face indices for '"+Z+"' attribute"),f=!1)}break;default:D.warn("Unsupported topology '"+
F+"'"),f=!1}e.params.material||(D.warn("Geometry requires material"),f=!1);e=e.params.vertexAttributes;G=void 0;for(G in e)e[G].values||(D.warn("Geometries with externally defined attributes are not yet supported"),f=!1);if(f){e=B.params;f=e.material;e=e.texture;var F=B.params.vertexAttributes,G={},J;for(J in F)Z=F[J],G[J]={data:Z.values,size:Z.valuesPerElement};h.push([]);F={};if("PerAttributeArray"===B.params.topology){for(var B=G.position.data.length/G.position.size,Z=new Uint32Array(B),fa=0;fa<
B;fa++)Z[fa]=fa;var B=Z,R;for(R in G)F[R]=B}else{var B=B.params.faces,da;for(da in B)F[da]=new Uint32Array(B[da].values)}B=e?A[e]:null;Z=m[f]?m[f][e]:null;Z||(Z=f.substring(f.lastIndexOf("/")+1),Z=r[Z].params,1===Z.transparency&&(Z.transparency=0),Z={ambient:Z.diffuse,diffuse:Z.diffuse,specular:[0,0,0],opacity:1-(Z.transparency||0),transparent:0<Z.transparency,textureId:B?B.engineTexObj.id:void 0,doubleSided:!0,cullFace:"none",flipV:!1,colorMixMode:Z.externalColorMixMode||"tint"},a("enable-feature:jkieboom/alpha-channel-usage")&&
B&&("transparency"===B.alphaChannelUsage||"maskAndTransparency"===B.alphaChannelUsage)&&(Z.transparent=!0),d&&d.materialParamsMixin&&c.mixin(Z,d.materialParamsMixin),Z=new v(Z,p),m[f]||(m[f]={}),m[f][e]=Z,k.push(Z));h[C].push(Z);f=new t(new u(G,F),p);q+=F.position?F.position.length:0;g.push(f)}}return{stageResources:{textures:n,materials:k,geometries:g},materialsByComponent:h,pivotOffset:b.model.pivotOffset,numberOfVertices:q}}Object.defineProperty(h,"__esModule",{value:!0});var D=f.getLogger("esri.views.3d.layers.graphics.objectResourceUtils"),
E=new l.Version(1,2,"wosr");h.fetch=function(a,b){return y(a,b).then(function(a){return B(a,b)})};h.fetchLod=function(a,b){var c=n.removeFile(a);return y(a,b).then(function(a){return a.lods?k.all(a.lods.map(function(b){return b.href?y(n.makeAbsolute(b.href,c)):a})).then(function(c){return A(c.map(function(a){return B(a,b)}),a)}):A([B(a,b)],a)})};h.computeBoundingBox=function(a){a=a.stageResources[r.ModelContentType.GEOMETRY];for(var b=p.empty(),c=[0,0,0],d=[0,0,0],f=0;f<a.length;f++){var e=a[f].getBoundingInfo();
m.vec3d.set(e.getBBMin(),c);m.vec3d.set(e.getBBMax(),d);for(e=0;3>e;++e)b[e]=Math.min(b[e],c[e]),b[e+3]=Math.max(b[e+3],d[e])}return b};h.createStageResources=B})},"esri/core/Version":function(){define(["require","exports","./Error"],function(q,h,e){Object.defineProperty(h,"__esModule",{value:!0});q=function(){function a(a,b,e){void 0===e&&(e="");this.major=a;this.minor=b;this._context=e}a.prototype.lessThan=function(a,b){return this.major<a||a===this.major&&this.minor<b};a.prototype.since=function(a,
b){return!this.lessThan(a,b)};a.prototype.validate=function(a){if(this.major!==a.major)throw new e((this._context&&this._context+":")+"unsupported-version","Required major "+(this._context&&this._context+" ")+"version is '"+this.major+"', but got '${version.major}.${version.minor}'",{version:a});};a.prototype.clone=function(){return new a(this.major,this.minor,this._context)};a.parse=function(d,b){void 0===b&&(b="");var g=d.split("."),c=g[0],g=g[1],f=/^\s*\d+\s*$/;if(!c||!c.match||!c.match(f))throw new e((b&&
b+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:d});if(!g||!g.match||!g.match(f))throw new e((b&&b+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:d});d=parseInt(c,10);c=parseInt(g,10);return new a(d,c,b)};return a}();h.Version=q})},"esri/views/3d/layers/graphics/primitiveObjectSymbolUtils":function(){define(["require","exports","../../../../geometry/support/aaBoundingBox","../../webgl-engine/lib/Geometry",
"../../webgl-engine/lib/GeometryUtil"],function(q,h,e,a,d){Object.defineProperty(h,"__esModule",{value:!0});var b=e.fromValues(-.5,-.5,-.5,.5,.5,.5),g=e.fromValues(-.5,-.5,0,.5,.5,1),c=e.fromValues(-.5,-.5,0,.5,.5,.5);h.isValidPrimitive=function(a){switch(a){case "sphere":case "cube":case "diamond":case "cylinder":case "cone":case "inverted-cone":case "tetrahedron":return!0}return!1};h.primitiveBoundingBox=function(a){switch(a){case "sphere":case "cube":case "diamond":return b;case "cylinder":case "cone":case "inverted-cone":return g;
case "tetrahedron":return c}};h.primitiveGeometryData=function(a){switch(a){case "sphere":return d.createPolySphereGeometry(.5,2,!0);case "cube":return d.createBoxGeometry(1);case "cylinder":return d.createCylinderGeometry(1,.5,32,[0,0,1],[0,0,.5]);case "cone":return d.cgToGIS(d.createConeGeometry(1,.5,15,!1));case "inverted-cone":return d.cgToGIS(d.createConeGeometry(1,.5,15,!0));case "tetrahedron":return d.cgToGIS(d.createTetrahedronGeometry(1));case "diamond":return d.cgToGIS(d.createDiamondGeometry(1))}};
h.primitiveLodResources=function(b,c,e){var f=function(b,f,g){void 0===g&&(g=!1);return{levels:b.map(function(b,k){var l=f(b.tesselation);g&&d.cgToGIS(l);return{components:[{geometry:new a(l,e+("_lod"+k)),material:c}],faceCount:l.indexCount/3,minScreenSpaceRadius:b.minScreenSpaceRadius}})}};switch(b){case "sphere":return f([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:5},{tesselation:2,minScreenSpaceRadius:15}],function(a){return d.createPolySphereGeometry(.5,a,!0)});
case "cube":return f([{tesselation:0,minScreenSpaceRadius:0}],function(a){return d.createBoxGeometry(1)});case "cone":return f([{tesselation:4,minScreenSpaceRadius:0},{tesselation:8,minScreenSpaceRadius:10},{tesselation:16,minScreenSpaceRadius:20}],function(a){return d.createConeGeometry(1,.5,a,!1)},!0);case "inverted-cone":return f([{tesselation:4,minScreenSpaceRadius:0},{tesselation:8,minScreenSpaceRadius:10},{tesselation:16,minScreenSpaceRadius:20}],function(a){return d.createConeGeometry(1,.5,
a,!0)},!0);case "cylinder":return f([{tesselation:4,minScreenSpaceRadius:0},{tesselation:8,minScreenSpaceRadius:10},{tesselation:32,minScreenSpaceRadius:20}],function(a){return d.createCylinderGeometry(1,.5,a,[0,0,1],[0,0,.5])});case "tetrahedron":return f([{tesselation:0,minScreenSpaceRadius:0}],function(a){return d.createTetrahedronGeometry(1)},!0);case "diamond":return f([{tesselation:0,minScreenSpaceRadius:0}],function(a){return d.createDiamondGeometry(1)},!0)}}})},"esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayerLod":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/errors/CancelError ../../../../Color ../../../../core/lang ../../../../core/screenUtils ../../../../geometry/support/aaBoundingBox ../../../../symbols/ObjectSymbol3DLayer ./ElevationAligners ./Graphics3DLodInstanceGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./lodResourceUtils ./primitiveObjectSymbolUtils ../support/FastSymbolUpdates ../../lib/glMatrix ../../support/projectionUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Util ../../webgl-engine/lib/lodRendering/LodRenderer ../../webgl-engine/lib/lodRendering/LodResources ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u,x,v,A,y,C,B,D){q=function(h){function p(){var a=null!==h&&h.apply(this,arguments)||this;a._instanceIndexToGraphicUid={};return a}e(p,h);Object.defineProperty(p.prototype,"lodRenderer",{get:function(){return this._lodRenderer},enumerable:!0,configurable:!0});p.prototype._prepareResources=function(){var a=this.symbol,b=this._getStageIdHint();this._optionalFields=[];if(!this._isPropertyDriven("size")){var c=m.validateSymbolLayerSize(this.symbol);if(c){this._logWarning(c);
this.reject();return}}a.resource&&a.resource.href?this._prepareModelResources(a.resource.href,b):this._preparePrimitiveResources(a.resource?a.resource.primitive:"sphere",b)};p.prototype._preparePrimitiveResources=function(a,f){if(t.isValidPrimitive(a)){var e=this.symbol,k=this._getMaterialOpacity(),k={specular:[0,0,0],opacity:k,transparent:1>k||this._isPropertyDriven("opacity"),instanced:["transformation"],ambient:E,diffuse:E},l=this.symbolContainer;if("point-3d"===l.type&&l.verticalOffset){var l=
l.verticalOffset,h=l.minWorldLength,n=l.maxWorldLength;k.verticalOffset={screenLength:g.pt2px(l.screenLength),minWorldLength:h||0,maxWorldLength:null!=n?n:Infinity};k.castShadows=!1}this._context.screenSizePerspectiveEnabled&&(k.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);this._isPropertyDriven("color")?k.externalColor=J:(l=e.material?d.toUnitRGBA(e.material.color):J,k.externalColor=l);this._fastUpdates=u.initFastSymbolUpdatesState(this._context.renderer,!0,
this._fastVisualVariableConvertOptions());this._fastUpdates.enabled?(b.mixin(k,this._fastUpdates.materialParameters),k.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(k.instanced.push("color"),this._optionalFields.push("color"));k=new D(k,f+"_objectmat");(this._lodResources=t.primitiveLodResources(a,k,f))?(this._resourceBoundingBox=c.create(t.primitiveBoundingBox(a)),this._resourceSize=c.size(this._resourceBoundingBox),this._symbolSize=
m.computeSizeWithResourceSize(this._resourceSize,e),this.finalizeSymbolResources(),this.initializeLodRenderer(),this.resolve()):(this._logWarning("Unknown object symbol primitive: "+a),this.reject())}else this._logWarning("Unknown object symbol primitive: "+a),this.reject()};p.prototype._prepareModelResources=function(d,f){var e=this,k=["transformation"];f={materialParamsMixin:{instanced:k},idHint:f,streamDataSupplier:this._context.streamDataSupplier};this._fastUpdates=u.initFastSymbolUpdatesState(this._context.renderer,
!0,this._fastVisualVariableConvertOptions());this._fastUpdates.enabled?(b.mixin(f.materialParamsMixin,this._fastUpdates.materialParameters),k.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(k.push("color"),this._optionalFields.push("color"));k=this.symbolContainer;if("point-3d"===k.type&&k.verticalOffset){var k=k.verticalOffset,l=k.minWorldLength,h=k.maxWorldLength;f.materialParamsMixin.verticalOffset={screenLength:g.pt2px(k.screenLength),minWorldLength:l||
0,maxWorldLength:null!=h?h:Infinity};f.materialParamsMixin.castShadows=!1}this._symbolLoaderPromise=r.fetchObjectLodResources(d,f);this._symbolLoaderPromise.then(function(a){e._symbolLoaderPromise=null;if(!e.isRejected()){r.fillEstimatedMinScreenSpaceRadius(a);e._lodResources=a;var b=e._context,d=e._getExternalColorParameters(e.symbol.material),f=e._getMaterialOpacity(),g=e._isPropertyDriven("opacity");a=B.materialsFromLodResources(e._lodResources);e._originalOpacities=a.map(function(a){return a.getParameterValues().opacity||
1});a.forEach(function(a){var c=a.getParameterValues();a.setParameterValues(d);var e=c.opacity*f;a.setParameterValues({opacity:e,transparent:1>e||g||c.transparent});b.screenSizePerspectiveEnabled&&a.setParameterValues({screenSizePerspective:b.sharedResources.screenSizePerspectiveSettings})});e._resourceBoundingBox=B.computeBoundingBox(e._lodResources.levels[0]);e._resourceSize=c.size(e._resourceBoundingBox);e._pivotOffset=e._lodResources.levels[0].pivotOffset;e._symbolSize=m.computeSizeWithResourceSize(e._resourceSize,
e.symbol);e.finalizeSymbolResources();e.initializeLodRenderer();u.updateFastSymbolUpdatesState(e._fastUpdates,e._context.renderer,e._fastVisualVariableConvertOptions())&&e._materials.forEach(function(a){return a.setParameterValues(e._fastUpdates.materialParameters)});e.resolve()}},function(b){e._symbolLoaderPromise=null;if(!e.isFulfilled()){if(!(b instanceof a)){var c="ObjectSymbol3DLayer failed to load";b&&b.message&&(c+=" ("+b.message+")");e._logWarning(c)}e.reject()}})};p.prototype.finalizeSymbolResources=
function(){var a=this._context.stage;this._materials=B.materialsFromLodResources(this._lodResources);this._originalOpacities||(this._originalOpacities=this._materials.map(function(a){return a.getParameterValues().opacity||1}));this._materials.forEach(function(b){a.add(A.ModelContentType.MATERIAL,b)});this._textures=B.texturesFromLodResources(this._lodResources);this._textures.forEach(function(b){a.add(A.ModelContentType.TEXTURE,b)});this._geometries=B.geometriesFromLodResources(this._lodResources);
this._geometries.forEach(function(b){a.add(A.ModelContentType.GEOMETRY,b)})};p.prototype.initializeLodRenderer=function(){var a=this,b=this._context.stage;this._lodRenderer=new C.LodRenderer(this._lodResources,this._optionalFields,function(b){return{layerUid:a._context.layer.uid,graphicUid:a._instanceIndexToGraphicUid[b]}});b.addExternalRenderer(this._lodRenderer.slots,this._lodRenderer)};p.prototype._getExternalColorParameters=function(a){var b={};this._isPropertyDriven("color")?b.externalColor=
J:a&&a.color?b.externalColor=d.toUnitRGBA(a.color):(b.externalColor=J,b.colorMixMode="ignore");return b};p.prototype.destroy=function(){h.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._symbolLoaderPromise&&this._symbolLoaderPromise.cancel();var a=this._context.stage;this._lodRenderer&&(a.removeExternalRenderer(this._lodRenderer),this._lodRenderer.destroy());this._materials&&this._materials.forEach(function(b){return a.remove(A.ModelContentType.MATERIAL,b.id)});this._textures&&
this._textures.forEach(function(b){return a.remove(A.ModelContentType.TEXTURE,b.id)});this._geometries&&this._geometries.forEach(function(b){return a.remove(A.ModelContentType.GEOMETRY,b.id)})};p.prototype.createGraphics3DGraphic=function(a){var b=a.graphic;if(!this._validateGeometry(b.geometry))return null;var c=l.placePointOnGeometry(b.geometry);if(!c)return this._logWarning("unsupported geometry type for icon symbol: "+b.geometry.type),null;var d="graphic"+b.uid,f=this.getGraphicElevationContext(b);
return this._createAs3DShape(b,c,a.renderingInfo,f,d,b.uid)};p.prototype.notifyDestroyGraphicLayer=function(a){delete this._instanceIndexToGraphicUid[a.instanceIndex]};p.prototype.graphicLayerToGraphicId=function(a){return 0};p.prototype.layerPropertyChanged=function(a,b,c){var d=this;if("opacity"===a){var f=this._isPropertyDriven("opacity");this._materials.forEach(function(a,b){b=d._getMaterialOpacity()*d._originalOpacities[b];a.setParameterValues({opacity:b,transparent:1>b||f})});return!0}if("elevationInfo"===
a){this._updateElevationContext();for(var e in b){var g=b[e];if(a=c(g))g=this.getGraphicElevationContext(g.graphic),a.needsElevationUpdates=l.needsElevationUpdates3D(g.mode),a.elevationContext.set(g)}return!0}return!1};p.prototype.applyRendererDiff=function(a,b,c,d){var f=this,e;for(e in a.diff)switch(e){case "visualVariables":if(u.updateFastSymbolUpdatesState(this._fastUpdates,b,this._fastVisualVariableConvertOptions()))this._materials.forEach(function(a){return a.setParameterValues(f._fastUpdates.materialParameters)});
else return!1;break;default:return!1}return!0};Object.defineProperty(p.prototype,"numberOfVertices",{get:function(){return B.geometriesFromLodLevelResources(this._lodResources.levels[0]).reduce(function(a,b){return a+b.data.getIndices(y.VertexAttrConstants.POSITION).length},0)},enumerable:!0,configurable:!0});p.prototype._createAs3DShape=function(a,b,c,d,f,e){var g=this,h=this.getFastUpdateAttrValues(a);a=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?m.mixinColorAndOpacity(c.color,c.opacity):
null;h?function(a){return u.evaluateModelTransform(g._fastUpdates.materialParameters,h,a)}:null;f=this._context.clippingExtent;v.pointToVector(b,M,this._context.elevationProvider.spatialReference);if(f&&!l.pointInBox2D(M,f))return null;v.pointToVector(b,M,this._context.renderSpatialReference);f="absolute-height"!==d.mode;var p=l.computeElevation(this._context.elevationProvider,b,d,this._context.renderCoordsHelper,f?K:null),r=H,t=I;x.mat4d.identity(H);this._applyObjectRotation(c,r);this._applyObjectRotation(this.symbol,
r);this._applyObjectScale(c,r);this._applyAnchor(r);M[0]=b.x;M[1]=b.y;M[2]=p;v.computeLinearTransformation(b.spatialReference,M,t,this._context.renderSpatialReference)||console.warn("Could not locate symbol object properly, it might be misplaced");c=this._lodRenderer.instanceData;x.mat4d.multiply(t,r,t);r=c.addInstance();this._instanceIndexToGraphicUid[r]=e;c.setTransform(r,t);h&&c.setFeatureAttribute(r,h);a&&c.setColor(r,a);e=new n(this,r,k.perLodInstanceElevationAligner,d);f&&(e.alignedTerrainElevation=
K.terrainElevation);e.needsElevationUpdates=l.needsElevationUpdates3D(d.mode);l.extendPointGraphicElevationContext(e,b,this._context.elevationProvider);return e};p.prototype._applyObjectScale=function(a,b){this._fastUpdates.enabled&&this._fastUpdates.customTransformation||(a=this._isPropertyDriven("size")&&a.size?a.size:this._symbolSize,a=m.computeObjectScale(a,this._symbolSize,this._resourceSize,this._context.renderCoordsHelper.unitInMeters),1===a[0]&&1===a[1]&&1===a[2]||x.mat4d.scale(b,a))};p.prototype._applyObjectRotation=
function(a,b){if(!(this._fastUpdates.enabled&&this._fastUpdates.customTransformation&&a instanceof f))return m.computeObjectRotation(a.heading,a.tilt,a.roll,b)};p.prototype._computeAnchor=function(){switch(this.symbol.anchor){case "center":return x.vec3d.scale(c.center(this._resourceBoundingBox),-1);case "top":var a=c.center(this._resourceBoundingBox);return[-a[0],-a[1],-this._resourceBoundingBox[5]];case "bottom":return a=c.center(this._resourceBoundingBox),[-a[0],-a[1],-this._resourceBoundingBox[2]];
default:return this._pivotOffset?x.vec3d.scale(this._pivotOffset,-1,Array(3)):F}};p.prototype._applyAnchor=function(a){if(!this._fastUpdates.enabled||!this._fastUpdates.customTransformation){var b=this._computeAnchor();b&&x.mat4d.translate(a,b)}};p.prototype._hasPerInstanceColor=function(){return this._isPropertyDriven("color")||this._isPropertyDriven("opacity")};p.prototype._fastVisualVariableConvertOptions=function(){var a=this._resourceBoundingBox?c.size(this._resourceBoundingBox):E,b=this._resourceBoundingBox?
this._computeAnchor():F,d=this._context.renderCoordsHelper.unitInMeters,f=m.computeObjectScale(this._symbolSize,this._symbolSize,this._resourceSize,d);return{modelSize:a,symbolSize:this._symbolSize||E,unitInMeters:d,transformation:{anchor:b,scale:f,rotation:[this.symbol.tilt||0,this.symbol.roll||0,this.symbol.heading||0]}}};return p}(p);var E=[1,1,1],J=[1,1,1,1],F=[0,0,0],M=x.vec3d.create(),H=x.mat4d.create(),I=x.mat4d.create(),K={verticalDistanceToGround:0,terrainElevation:0};return q})},"esri/views/3d/layers/graphics/Graphics3DLodInstanceGraphicLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../geometry/support/aaBoundingBox ./featureExpressionInfoUtils ./Graphics3DGraphicElevationContext ./graphicUtils ../../lib/glMatrix ../../webgl-engine/lib/HighlightUtils".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n){q=function(){function e(a,b,d,f){this.type="lod-instance";this.alignedTerrainElevation=0;this.needsElevationUpdates=!1;this.graphics3DSymbolLayer=a;this.instanceIndex=b;this.elevationAligner=d;this.elevationContext=new c(f)}e.prototype.initialize=function(a,b){};e.prototype.setVisibility=function(a){var b=this.lodRenderer.instanceData;return a!==b.getVisible(this.instanceIndex)?(b.setVisible(this.instanceIndex,a),!0):!1};e.prototype.destroy=function(){null!=this.instanceIndex&&
(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))};e.prototype.alignWithElevation=function(a,b,c){this.elevationAligner&&(g.setContextFeature(this.elevationContext.featureExpressionInfoContext,c),a=this.elevationAligner(this,this.elevationContext,a,b),null!=a&&(this.alignedTerrainElevation=a))};e.prototype.getBSRadius=function(){var a=this.lodRenderer;return a.baseBoundingSphere.radius*a.instanceData.getScaleFactor(this.instanceIndex)};
e.prototype.getCenterObjectSpace=function(){return this.lodRenderer.baseBoundingSphere.center};e.prototype.getBoundingBoxObjectSpace=function(a){a=a||b.create();b.set(a,this.lodRenderer.baseBoundingBox);return a};e.prototype.getProjectedBoundingBox=function(c,e,g,h){return d(this,void 0,void 0,function(){var d,n,u,v,x,A,y,q,I;return a(this,function(a){switch(a.label){case 0:d=this.getBoundingBoxObjectSpace(g);n=r;u=b.isPoint(d)?1:n.length;this.lodRenderer.instanceData.getTransform(this.instanceIndex,
t);for(v=0;v<u;v++)x=n[v],p[0]=d[x[0]],p[1]=d[x[1]],p[2]=d[x[2]],k.mat4d.multiplyVec3(t,p),l[3*v+0]=p[0],l[3*v+1]=p[1],l[3*v+2]=p[2];if(!c(l,0,u))return[2,null];b.empty(d);A=null;this.calculateRelativeScreenBounds&&(A=this.calculateRelativeScreenBounds());for(v=0;v<3*u;v+=3){for(y=0;3>y;y++)d[y]=Math.min(d[y],l[v+y]),d[y+3]=Math.max(d[y+3],l[v+y]);A&&h.push({location:l.slice(v,v+3),screenSpaceBoundingRect:A})}if(!e)return[3,5];b.center(d,m);if("absolute-height"===this.elevationContext.mode)return[3,
5];q=void 0;I=f.demResolutionForBoundingBox(d,e);a.label=1;case 1:return a.trys.push([1,3,,4]),[4,e.service.queryElevation(m[0],m[1],I)];case 2:return q=a.sent(),[3,4];case 3:return a.sent(),q=null,[3,4];case 4:null!=q&&b.offset(d,0,0,-this.alignedTerrainElevation+q),a.label=5;case 5:return[2,d]}})})};e.prototype.addHighlight=function(a,b){var c=this;this.highlightId=n.generateHighlightId();this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0);a.addExternal(function(a){c.lodRenderer.instanceData.setHighlight(c.instanceIndex,
!1);c.highlightId=null},this.highlightId)};e.prototype.removeHighlight=function(a){this.highlightId&&a.remove(this.highlightId)};Object.defineProperty(e.prototype,"lodRenderer",{get:function(){return this.graphics3DSymbolLayer.lodRenderer},enumerable:!0,configurable:!0});return e}();var l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],p=k.vec3d.create(),m=k.vec3d.create(),r=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],t=k.mat4d.create();return q})},"esri/views/3d/layers/graphics/lodResourceUtils":function(){define(["require",
"exports","./objectResourceUtils","../../webgl-engine/lib/lodRendering/LodResources"],function(q,h,e,a){function d(a){var b=[];a.stageResources.geometries.forEach(function(c,d){b.push({material:a.materialsByComponent[d][0],geometry:c,textures:a.stageResources.textures})});return{components:b,faceCount:a.lodMetrics?a.lodMetrics.faceCount:null,minScreenSpaceRadius:null,pivotOffset:a.pivotOffset}}function b(a){return{levels:a.map(function(a){return d(a)})}}function g(b,d){void 0===d&&(d=c);b=a.computeFaceCount(b);
return Math.sqrt(b/(d*Math.PI))}Object.defineProperty(h,"__esModule",{value:!0});h.makeLodLevelResources=d;h.makeLodResources=b;h.fetchObjectLodResources=function(a,c){return e.fetchLod(a,c).then(function(a){return b(a)})};h.estimateMinScreenSpaceRadius=g;h.fillEstimatedMinScreenSpaceRadius=function(a){a.levels.forEach(function(a){a.minScreenSpaceRadius=g(a)});a.levels[0].minScreenSpaceRadius=Math.min(2,a.levels[0].minScreenSpaceRadius)};var c=.05})},"esri/views/3d/webgl-engine/lib/lodRendering/LodResources":function(){define(["require",
"exports","../../../../../core/arrayUtils","../../../../../geometry/support/aaBoundingBox"],function(q,h,e,a){function d(a){var b=[];a.components.forEach(function(a){b.push(a.geometry)});return e.unique(b)}Object.defineProperty(h,"__esModule",{value:!0});h.materialsFromLodResources=function(a){var b=[];a.levels.forEach(function(a){a.components.forEach(function(a){b.push(a.material)})});return e.unique(b)};h.texturesFromLodResources=function(a){var b=[];a.levels.forEach(function(a){a.components.forEach(function(a){a.textures&&
b.push.apply(b,a.textures)})});return e.unique(b)};h.geometriesFromLodLevelResources=d;h.geometriesFromLodResources=function(a){var b=[];a.levels.forEach(function(a){a.components.forEach(function(a){b.push(a.geometry)})});return e.unique(b)};h.computeBoundingBox=function(b){var e=a.empty();d(b).forEach(function(b){b=b.getBoundingInfo();a.expand(e,b.getBBMin());a.expand(e,b.getBBMax())});return e};h.computeFaceCount=function(a){var b=0;d(a).forEach(function(a){b+=a.data.indexCount/3});return b}})},
"esri/views/3d/webgl-engine/lib/lodRendering/LodRenderer":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../geometry/support/aaBoundingBox ../Camera ../DefaultVertexAttributeLocations ../gl-matrix ../RenderSlot ./InstanceData ./InstanceOctree ./LevelSelector ./RenderInstanceData ./utils ../../materials/DefaultMaterial ../../../../webgl/BufferObject ../../../../webgl/Util ../../../../webgl/VertexArrayObject".split(" "),function(q,h,e,a,d,b,g,c,f,k,n,l,p,
m,r,t,u){function x(a,b,c,d){p.encodeDoubleVec3(a.modelOrigin,b,c.modelOriginHi,c.modelOriginLo,d);a.model.getMat(b,D);c.model.setMat(d,D);a.modelNormal.getMat(b,D);c.modelNormal.setMat(d,D);a.color&&c.color&&(a.color.getVec(b,B),c.color.setVec(d,B));a.featureAttribute&&c.featureAttribute&&(a.featureAttribute.getVec(b,B),c.featureAttribute.setVec(d,B))}Object.defineProperty(h,"__esModule",{value:!0});var v=t.assert,A=function(){function a(a,c){this.glMaterials={};var d=a.rctx,f=c.geometry;c=c.material;
var e=f.data.toRenderData();this.materialRep=a.materialRep;c.setParameterValues({instancedDoublePrecision:!0});a=c.getVertexBufferLayout();var g=e.indices.position.length,k=new Float32Array(a[0].stride/4*g);c.fillInterleaved(e,void 0,void 0,void 0,k,0);this.geometry=f;this.material=c;this.glMaterials=p.acquireGLMaterials(c,this.materialRep);this.vertexBufferLayout=a;this.vbo=r.createVertex(d,35044,k);this.vao=new u(d,b.Default3D,{geometry:a},{geometry:this.vbo});this.vertexCount=g}a.prototype.destroy=
function(){p.releaseGLMaterials(this.material,this.materialRep);this.vbo.dispose();this.vao.dispose()};Object.defineProperty(a.prototype,"boundingInfo",{get:function(){return this.geometry.getBoundingInfo()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"triangleCount",{get:function(){return this.vertexCount/3},enumerable:!0,configurable:!0});a.prototype.intersect=function(a,b,c,d,f){var e=this.geometry.id,g=d.toString();this.material.intersect(this.geometry,null,F,a,b,c,function(b,
c,k,l,h,m){if(0<=b){h={type:"external",metadata:f(d)};if(null==a.minResult.priority||l>=a.minResult.priority)if(null==a.minResult.dist||b<a.minResult.dist)a.minResult.set(h,g,b,c,l,null,e,k),a.minResult.setIntersector("LodRenderer");if(null==a.maxResult.priority||l>=a.maxResult.priority)if(null==a.maxResult.dist||b>a.maxResult.dist)a.maxResult.set(h,g,b,c,l,null,e,k),a.minResult.setIntersector("LodRenderer")}},null)};return a}();h.LodComponentData=A;var y=function(){function b(a,b){var c=this;this.components=
[];this.minScreenSpaceRadius=b.minScreenSpaceRadius;b.components.forEach(function(b){c.components.push(new A(a,b))})}b.prototype.destroy=function(){this.components.forEach(function(a){a.destroy()})};b.prototype.intersect=function(a,b,c,d,f){this.components.forEach(function(e){e.intersect(a,b,c,d,f)})};Object.defineProperty(b.prototype,"boundingBox",{get:function(){if(!this._boundingBox){var b=a.empty();this.components.forEach(function(c){a.expand(b,c.boundingInfo.bbMin);a.expand(b,c.boundingInfo.bbMax)});
this._boundingBox=b}return this._boundingBox},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"boundingSphere",{get:function(){if(!this._boundingSphere){var b=this.boundingBox,c=g.vec3d.create();a.center(b,c);this._boundingSphere={center:c,radius:.5*a.diameter(b)}}return this._boundingSphere},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"triangleCount",{get:function(){return this.components.reduce(function(a,b){return a+b.triangleCount},0)},enumerable:!0,configurable:!0});
return b}();h.LodLevelData=y;q=function(){function a(a,b,c){var e=this;this._levels=[];this._renderInstanceData=[];this._highlightRenderInstanceData=[];this._instanceIndex=0;this._lastCamera=new d;this._updateCyclesWithStaticCamera=-1;this.didRender=this._needFullCycle=!1;this._symbol=a;this._optionalFields=b;this._instanceToMetadata=c;this._instanceBufferLayout=m.getInstanceBufferLayout({instancedDoublePrecision:!0,instanced:b});this._instanceData=new f.InstanceData(this._optionalFields);this._instanceData.on("instance-added",
function(a){e.resetUpdateCycle()});this._instanceData.on("instance-removed",function(a){e.resetUpdateCycle()});this._instanceData.on("instance-transform-changed",function(a){e.resetUpdateCycle()});this._instanceData.on("instance-visibility-changed",function(a){e.resetUpdateCycle();e.requestFullCycle()});this._instanceData.on("instance-highlight-changed",function(a){e.resetUpdateCycle();e.requestFullCycle()});h.lodRenderers.push(this);window.lodRenderer=this}a.prototype.destroy=function(){h.lodRenderers.splice(h.lodRenderers.indexOf(this),
1)};Object.defineProperty(a.prototype,"baseBoundingBox",{get:function(){return this._levels[0].boundingBox},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"baseBoundingSphere",{get:function(){return this._levels[0].boundingSphere},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"instanceData",{get:function(){return this._instanceData},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"memoryUsage",{get:function(){var a={cpu:0,gpu:0};this._renderInstanceData.forEach(function(b){b=
b.memoryUsage;a.cpu+=b.cpu;a.gpu+=b.gpu});this._highlightRenderInstanceData.forEach(function(b){b=b.memoryUsage;a.cpu+=b.cpu;a.gpu+=b.gpu});return a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"renderStats",{get:function(){var a=this,b=this._instanceData.size,c=[];this._levels.forEach(function(b,d){d=a._renderInstanceData[d].size+a._highlightRenderInstanceData[d].size;b=b.triangleCount;c.push({renderedInstances:d,renderedTriangles:d*b,trianglesPerInstance:b})});return{totalInstances:b,
renderedInstances:c.reduce(function(a,b){return a+b.renderedInstances},0),renderedTriangles:c.reduce(function(a,b){return a+b.renderedTriangles},0),levels:c}},enumerable:!0,configurable:!0});a.prototype.initializeRenderContext=function(a){var b=this,c=a.rctx;this._symbol.levels.forEach(function(d){b._levels.push(new y(a,d));b._renderInstanceData.push(new l.RenderInstanceData(c,b._optionalFields,b._instanceBufferLayout));b._highlightRenderInstanceData.push(new l.RenderInstanceData(c,b._optionalFields,
b._instanceBufferLayout))});var d=this._levels[0].boundingSphere.radius,f=this._levels.map(function(a){return a.minScreenSpaceRadius});this._levelSelector=new n.LevelSelector(d,f);this._octree=new k.InstanceOctree(this._instanceData,this._levels[0].boundingSphere)};a.prototype.uninitializeRenderContext=function(a){this._levels.forEach(function(a){a.destroy()});this._renderInstanceData.forEach(function(a){a.destroy()});this._highlightRenderInstanceData.forEach(function(a){a.destroy()})};Object.defineProperty(a.prototype,
"slots",{get:function(){return[c.OPAQUE_EXTERNAL,c.TRANSPARENT_EXTERNAL]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"needsHighlight",{get:function(){return 0<this._highlightRenderInstanceData.reduce(function(a,b){return a+b.size},0)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"needsRender",{get:function(){return 1>this._updateCyclesWithStaticCamera},enumerable:!0,configurable:!0});a.prototype.resetNeedsRender=function(){this.didRender&&(this.didRender=
!1)};a.prototype.prepareRender=function(a){var b=a.equivalent(this._lastCamera);this._lastCamera.copyFrom(a);b||this.resetUpdateCycle();b=this._needFullCycle?this._instanceData.size:2E3;this._needFullCycle=!1;this.updateInstances(a,b)};a.prototype.render=function(a){var b=a.slot===c.OPAQUE_EXTERNAL?c.OPAQUE_MATERIAL:a.slot===c.TRANSPARENT_EXTERNAL?c.TRANSPARENT_MATERIAL:null;if(b){var d={view:a.camera.viewMatrix,proj:a.camera.projectionMatrix,origin:[0,0,0],viewInvTransp:a.camera.viewInverseTransposeMatrix,
lightingData:a.lightingData,viewport:a.camera.viewport,fovY:a.camera.fovY,nearFar:[a.camera.near,a.camera.far],framebufferTex:a.offscreenRenderingHelper?a.offscreenRenderingHelper.colorTexture:null,shadowMap:a.shadowMap,shadowMappingEnabled:!!a.shadowMap&&a.shadowMap.enabled,ssaoEnabled:!!a.ssaoHelper&&a.ssaoHelper.enabled,pixelRatio:a.pixelRatio,cameraAboveGround:a.camera.aboveGround,hudVisibilityTexture:a.offscreenRenderingHelper?a.offscreenRenderingHelper.hudVisibilityTexture:null};a.rctx.bindVAO();
if(a.isHighlightPass)for(var f=0;f<this._levels.length;++f)this.renderLevel(a,b,d,this._highlightRenderInstanceData[f],this._levels[f]);else for(f=0;f<this._levels.length;++f)this.renderLevel(a,b,d,this._renderInstanceData[f],this._levels[f]);return!0}};a.prototype.intersect=function(a,b,c,d){var e=this;d=g.vec3d.create();g.vec3d.subtract(c,b,d);this._octree.forEachAlongRay(b,d,function(d){e._instanceData.getTranslation(d,C);e._instanceData.getModel(d,D);g.vec3d.subtract(b,C,E);g.vec3d.subtract(c,
C,J);g.mat3d.inverse(D,D);g.mat3d.multiplyVec3(D,E);g.mat3d.multiplyVec3(D,J);var k=e._instanceData.getState(d),l=e._instanceData.getLodLevel(d);v(k&f.StateFlags.ACTIVE,"invalid instance state");v(0<=l&&l<e._levels.length,"invaid lod level");e._levels[l].intersect(a,E,J,d,e._instanceToMetadata)})};a.prototype.queryDepthRange=function(a){return this.queryDepthRangeOctree(a)};a.prototype.queryDepthRangeOctree=function(a){var b=a.eye,c=a.viewForward,d=this._octree.findClosest(c,"front-to-back",a.frustumPlanes),
f=this._octree.findClosest(c,"back-to-front",a.frustumPlanes);return null!=d&&null!=f?(this._instanceData.view.boundingSphere.getVec(d,B),g.vec3d.subtract(B,b),d=g.vec3d.dot(B,c)-B[3],this._instanceData.view.boundingSphere.getVec(f,B),g.vec3d.subtract(B,b),b=g.vec3d.dot(B,c)+B[3],{near:Math.max(a.near,d),far:Math.min(a.far,b)}):{near:Infinity,far:-Infinity}};a.prototype.updateInstances=function(a,b){var c=this._levelSelector;c.updateCamera(a);this._renderInstanceData.forEach(function(a){a.beginUpdate()});
this._highlightRenderInstanceData.forEach(function(a){a.beginUpdate()});a=this._instanceData;var d=this._instanceData.view,e=a.capacity,g=this._instanceIndex;b=Math.min(a.size,b);for(var k=0;k<b;++k){0===g&&this.startUpdateCycle();var l=d.state.get(g),h=0;if(l&f.StateFlags.ALLOCATED){var m=d.lodLevel.get(g);l&f.StateFlags.ACTIVE&&this._renderInstanceData[m].freeTail();l&f.StateFlags.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[m].freeTail();if(l&f.StateFlags.REMOVE)a.notifyRemoved(g);else if(l&
f.StateFlags.VISIBLE){d.modelOrigin.getVec(g,C);m=c.selectLevel(C,d.modelScaleFactor.get(g));h=l&~(f.StateFlags.ACTIVE|f.StateFlags.HIGHLIGHT_ACTIVE|f.StateFlags.TRANSFORM_CHANGED);if(0<=m){var n=this._renderInstanceData[m],p=n.allocateHead();x(d,g,n.view,p);h|=f.StateFlags.ACTIVE;l&f.StateFlags.HIGHLIGHT&&(n=this._highlightRenderInstanceData[m],p=n.allocateHead(),x(d,g,n.view,p),h|=f.StateFlags.HIGHLIGHT_ACTIVE)}d.state.set(g,h);d.lodLevel.set(g,m)}else h=l&~(f.StateFlags.ACTIVE|f.StateFlags.HIGHLIGHT_ACTIVE|
f.StateFlags.TRANSFORM_CHANGED),d.state.set(g,h);m=!!(l&f.StateFlags.ACTIVE);h=!!(h&f.StateFlags.ACTIVE);!m&&h?this._octree.addInstance(g):m&&!h?this._octree.removeInstance(g):m&&h&&l&f.StateFlags.TRANSFORM_CHANGED&&(this._octree.removeInstance(g),this._octree.addInstance(g));g=(g+1)%e}else g=(g+1)%e,b++}this._instanceIndex=g;this._renderInstanceData.forEach(function(a){a.endUpdate()});this._highlightRenderInstanceData.forEach(function(a){a.endUpdate()})};a.prototype.startUpdateCycle=function(){this._updateCyclesWithStaticCamera++;
this._renderInstanceData.forEach(function(a){a.startUpdateCylce()});this._highlightRenderInstanceData.forEach(function(a){a.startUpdateCylce()})};a.prototype.resetUpdateCycle=function(){this._updateCyclesWithStaticCamera=-1};a.prototype.requestFullCycle=function(){this._needFullCycle=!0};a.prototype.renderLevel=function(a,b,c,d,f){var e=this;f.components.forEach(function(f){e.renderComponent(a,b,c,d,f)})};a.prototype.renderComponent=function(a,d,f,e,g){var k=g.glMaterials[a.pass];if(k&&k.beginSlot(d)&&
k.isVisible&&0!==e.size){var l=a.rctx,h=l.capabilities.instancing,m=k.getDrawMode(l);f.origin=[0,0,0];d===c.STENCIL_MATERIAL&&(a.stencilRenderingHelper.enabled=!0,a.stencilRenderingHelper.prepareStencilWritePass());k.bind(l,f);l.bindVAO(g.vao);d=k.getProgram();t.assertCompatibleVertexAttributeLocations(g.vao,d);a.isHighlightPass&&(l.bindTexture(a.offscreenRenderingHelper?a.offscreenRenderingHelper.depthTexture:null,5),d.setUniform1i("depthTex",5),d.setUniform4f("highlightViewportPixelSz",0,0,1/f.viewport[2],
1/f.viewport[3]));k.bindView(l,f);a=e.capacity;d=e.headIndex;var n=e.tailIndex,p=e.firstIndex,u=this._instanceBufferLayout,r=function(a,c){t.bindVertexBufferLayout(l,b.Default3D,e.buffer,u,a);h.drawArraysInstanced(m,0,g.vertexCount,c-a);t.unbindVertexBufferLayout(l,b.Default3D,e.buffer,u)};g.material.getParams().transparent&&null!=p?d>n?(v(p>=n&&p<=d,"invalid firstIndex"),r(p,d),r(n,p)):d<n&&(p<=d?(v(0<=p&&p<=d,"invalid firstIndex"),r(p,d),r(n,a),r(0,p)):(v(p>=n&&p<=a,"invalid firstIndex"),r(p,a),
r(0,d),r(n,p))):d>n?r(n,d):d<n&&(r(0,d),r(n,a));l.bindVAO(null);k.release(l,f)}};return a}();h.LodRenderer=q;h.lodRenderers=[];var C=g.vec3d.create(),B=g.vec4d.create(),D=g.mat3d.create(),E=g.vec3d.create(),J=g.vec3d.create(),F=g.mat4d.identity()})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceData":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../support/Evented ../../../support/buffer/BufferView ../gl-matrix ../../../../webgl/Util".split(" "),function(q,
h,e,a,d,b,g){Object.defineProperty(h,"__esModule",{value:!0});var c=g.assert,f;(function(a){a[a.ALLOCATED=1]="ALLOCATED";a[a.ACTIVE=2]="ACTIVE";a[a.VISIBLE=4]="VISIBLE";a[a.HIGHLIGHT=8]="HIGHLIGHT";a[a.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE";a[a.REMOVE=32]="REMOVE";a[a.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED"})(f=h.StateFlags||(h.StateFlags={}));var k=function(){return function(a,b,c){var f=0;this.modelOrigin=new d.BufferViewVec3f64(a,f,c);f+=24;this.model=new d.BufferViewMat3f(a,f,c);f+=36;this.modelNormal=
new d.BufferViewMat3f(a,f,c);f+=36;this.modelScaleFactor=new d.BufferViewFloat(a,f,c);f+=4;this.boundingSphere=new d.BufferViewVec4f(a,f,c);f+=16;0<=b.indexOf("color")&&(this.color=new d.BufferViewVec4f(a,f,c),f+=16);0<=b.indexOf("featureAttribute")&&(this.featureAttribute=new d.BufferViewVec4f(a,f,c),f+=16);this.state=new d.BufferViewUint8(a,f,c);this.lodLevel=new d.BufferViewUint8(a,f+1,c)}}();h.View=k;q=function(a){function d(b){var c=a.call(this)||this;c._capacity=0;c._size=0;c._next=0;c._optionalFields=
b;c._elementSize=d.BASE_ELEMENT_SIZE;0<=c._optionalFields.indexOf("color")&&(c._elementSize+=16);0<=c._optionalFields.indexOf("featureAttribute")&&(c._elementSize+=16);return c}e(d,a);Object.defineProperty(d.prototype,"elementSize",{get:function(){return this._elementSize},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"size",{get:function(){return this._size},enumerable:!0,
configurable:!0});Object.defineProperty(d.prototype,"buffer",{get:function(){return this._buffer},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!0});d.prototype.addInstance=function(){this._size+1>this._capacity&&this.grow();var a=this.findSlot();this._view.state.set(a,f.ALLOCATED);this._size++;this.emit("instance-added",{index:a});return a};d.prototype.removeInstance=function(a){var b=this._view.state;c(0<=a&&
a<this._capacity&&b.get(a)&f.ALLOCATED,"invalid instance handle");this.getStateFlag(a,f.ACTIVE)?this.setStateFlags(a,f.REMOVE):this.notifyRemoved(a)};d.prototype.notifyRemoved=function(a){var b=this._view.state;c(0<=a&&a<this._capacity&&b.get(a)&f.ALLOCATED,"invalid instance handle");b.set(a,0);this._size--;this.emit("instance-removed",{index:a})};d.prototype.setTransform=function(a,c){var d=this._view,e=p,g=m;b.vec3d.set3(c[12],c[13],c[14],e);d.modelOrigin.setVec(a,e);b.mat4d.toMat3(c,g);d.model.setMat(a,
g);d.modelScaleFactor.set(a,b.mat4d.maxScale(c));b.mat3d.inverse(g,g);b.mat3d.transpose(g,g);d.modelNormal.setMat(a,g);this.setStateFlags(a,f.TRANSFORM_CHANGED);this.emit("instance-transform-changed",{index:a})};d.prototype.getTransform=function(a,b){var c=this._view;c.model.getMat(a,m);c.modelOrigin.getVec(a,p);b[0]=m[0];b[1]=m[1];b[2]=m[2];b[3]=0;b[4]=m[3];b[5]=m[4];b[6]=m[5];b[7]=0;b[8]=m[6];b[9]=m[7];b[10]=m[8];b[11]=0;b[12]=p[0];b[13]=p[1];b[14]=p[2];b[15]=0};d.prototype.setTranslation=function(a,
b){this._view.modelOrigin.setVec(a,b);this.emit("instance-transform-changed",{index:a})};d.prototype.getTranslation=function(a,b){this._view.modelOrigin.getVec(a,b)};d.prototype.getModel=function(a,b){this._view.model.getMat(a,b)};d.prototype.getScaleFactor=function(a){return this._view.modelScaleFactor.get(a)};d.prototype.setFeatureAttribute=function(a,b){this._view.featureAttribute.setVec(a,b)};d.prototype.setColor=function(a,b){this._view.color.setVec(a,b)};d.prototype.getColor=function(a,b){this._view.color.getVec(a,
b)};d.prototype.getFeatureAttribute=function(a,b){this._view.featureAttribute.getVec(a,b)};d.prototype.setVisible=function(a,b){b!==this.getVisible(a)&&(this.setStateFlag(a,f.VISIBLE,b),this.emit("instance-visibility-changed",{index:a}))};d.prototype.getVisible=function(a){return this.getStateFlag(a,f.VISIBLE)};d.prototype.setHighlight=function(a,b){b!==this.getHighlight(a)&&(this.setStateFlag(a,f.HIGHLIGHT,b),this.emit("instance-highlight-changed",{index:a}))};d.prototype.getHighlight=function(a){return this.getStateFlag(a,
f.HIGHLIGHT)};d.prototype.getState=function(a){return this._view.state.get(a)};d.prototype.getLodLevel=function(a){return this._view.lodLevel.get(a)};d.prototype.countFlags=function(a){for(var b=0,c=0;c<this._capacity;++c)this.getState(c)&a&&++b;return b};d.prototype.setStateFlags=function(a,b){var c=this._view.state;b|=c.get(a);c.set(a,b)};d.prototype.clearStateFlags=function(a,b){var c=this._view.state;b=c.get(a)&~b;c.set(a,b)};d.prototype.setStateFlag=function(a,b,c){c?this.setStateFlags(a,b):
this.clearStateFlags(a,b)};d.prototype.getStateFlag=function(a,b){return!!(this._view.state.get(a)&b)};d.prototype.grow=function(){var a=Math.max(n,Math.floor(this._capacity*l)),b=new ArrayBuffer(a*this.elementSize);if(this._buffer){var c=new Uint8Array(this._buffer);(new Uint8Array(b)).set(c)}this._capacity=a;this._buffer=b;this._view=new k(this._buffer,this._optionalFields,this.elementSize)};d.prototype.findSlot=function(){for(var a=this._view.state,b=this._next;a.get(b)&f.ALLOCATED;)b=(b+1)%this._capacity;
this._next=(b+1)%this._capacity;return b};d.BASE_ELEMENT_SIZE=120;return d}(a.Evented);h.InstanceData=q;var n=1024,l=2,p=b.vec3d.create(),m=b.mat3d.create()})},"esri/views/3d/support/Evented":function(){define(["require","exports"],function(q,h){Object.defineProperty(h,"__esModule",{value:!0});q=function(){function e(){this._listeners={}}e.prototype.hasEventListener=function(a){return null!=this._listeners[a]&&0<this._listeners[a].size};e.prototype.on=function(a,d){var b=this;null==this._listeners[a]&&
(this._listeners[a]=new Map);var e={};this._listeners[a].set(e,d);return{remove:function(){return b._listeners[a].delete(e)}}};e.prototype.emit=function(a,d){null!=this._listeners[a]&&this._listeners[a].forEach(function(a){return a(d)})};return e}();h.Evented=q})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceOctree":function(){define(["require","exports","../../../../../core/tsSupport/extendsHelper","../gl-matrix","../Octree"],function(q,h,e,a,d){Object.defineProperty(h,"__esModule",{value:!0});
q=function(b){function d(c,d){var f=b.call(this,[0,0,0],1,{getCenter:function(a){var b=f._instanceData.view.boundingSphere,c=f._tmpCenter;c[0]=b.get(a,0);c[1]=b.get(a,1);c[2]=b.get(a,2);return c},getRadius:function(a){return f._instanceData.view.boundingSphere.get(a,3)}},{maximumDepth:25})||this;f._instanceData=c;f._boundingSphere=d;f._tmpCenter=a.vec3d.create();f._tmpTranslation=a.vec3d.create();f._tmpModel=a.mat3d.create();return f}e(d,b);d.prototype.addInstance=function(b){var c=this._instanceData.view.boundingSphere,
d=this._tmpCenter;this._instanceData.getModel(b,this._tmpModel);a.mat3d.multiplyVec3(this._tmpModel,this._boundingSphere.center,d);this._instanceData.getTranslation(b,this._tmpTranslation);a.vec3d.add(d,this._tmpTranslation);var e=this._boundingSphere.radius*this._instanceData.getScaleFactor(b);c.set(b,0,d[0]);c.set(b,1,d[1]);c.set(b,2,d[2]);c.set(b,3,e);this.add(b)};d.prototype.removeInstance=function(a){this.remove(a)};return d}(d);h.InstanceOctree=q})},"esri/views/3d/webgl-engine/lib/Octree":function(){define(["require",
"exports","../../../../core/PooledArray","./gl-matrix","./Util"],function(q,h,e,a,d){function b(a,b,c){c=c||a;c[0]=a[0]+b;c[1]=a[1]+b;c[2]=a[2]+b;return c}function g(a,b,c){var d=a[0],f=a[1];a=a[2];return c[0][0]*d+c[0][1]*f+c[0][2]*a+c[0][3]>b||c[1][0]*d+c[1][1]*f+c[1][2]*a+c[1][3]>b||c[2][0]*d+c[2][1]*f+c[2][2]*a+c[2][3]>b||c[3][0]*d+c[3][1]*f+c[3][2]*a+c[3][3]>b||c[4][0]*d+c[4][1]*f+c[4][2]*a+c[4][3]>b||c[5][0]*d+c[5][1]*f+c[5][2]*a+c[5][3]>b}function c(a,b,c){if(!F.length)for(var d=0;8>d;++d)F[d]=
{index:0,distance:0};for(d=0;8>d;++d){var f=p[d];F[d].index=d;F[d].distance=k(a,b,f)}F.sort(function(a,b){return a.distance-b.distance});for(d=0;8>d;++d)c[d]=F[d].index;return c}function f(a,b){for(var c=Infinity,d=null,f=0;8>f;++f){var e=k(a,b,m[f]);e<c&&(c=e,d=m[f])}return d}function k(a,b,c){return b*(a[0]*c[0]+a[1]*c[1]+a[2]*c[2])}q=function(){function h(b,c,d,f){this._maximumObjectsPerNode=10;this._maximumDepth=20;this._degenerateObjects=new Set;this._objectCount=0;this._objectToBoundingSphere=
d;f&&(void 0!==f.maximumObjectsPerNode&&(this._maximumObjectsPerNode=f.maximumObjectsPerNode),void 0!==f.maximumDepth&&(this._maximumDepth=f.maximumDepth));isNaN(b[0])||isNaN(b[1])||isNaN(b[2])||isNaN(c)?this._root=new n(null,a.vec3d.createFrom(0,0,0),.5):this._root=new n(null,b,c/2)}Object.defineProperty(h.prototype,"center",{get:function(){return this._root.center},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"size",{get:function(){return 2*this._root.halfSize},enumerable:!0,
configurable:!0});Object.defineProperty(h.prototype,"root",{get:function(){return this._root.node},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"maximumObjectsPerNode",{get:function(){return this._maximumObjectsPerNode},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"maximumDepth",{get:function(){return this._maximumDepth},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"objectCount",{get:function(){return this._objectCount},enumerable:!0,
configurable:!0});h.prototype.add=function(a,b){a=this._objectOrObjectsArray(a);b=null==b?a.length:b;this._objectCount+=b;this._grow(a);for(var c=n.acquire(),d=0;d<b;d++){var f=a[d];c.init(this._root);this._isDegenerate(f)?this._degenerateObjects.add(f):this._add(f,c)}n.release(c)};h.prototype.remove=function(a,b){a=this._objectOrObjectsArray(a);this._objectCount-=a.length;for(var c=n.acquire(),d=0;d<a.length;d++){var f=a[d],e=b||this._boundingSphereFromObject(f,C);this._isValidRadius(e.radius)?(c.init(this._root),
this._remove(f,e,c)):this._degenerateObjects.delete(f)}n.release(c);this._shrink()};h.prototype.update=function(a,b){if(this._isValidRadius(b.radius)||!this._isDegenerate(a))this.remove(a,b),this.add(a)};h.prototype.forEachAlongRay=function(a,b,c){var d=this;this._forEachNode(this._root,function(f){if(!d._intersectsNode(a,b,f))return!1;f=f.node;f.terminals.forEach(function(f){d._intersectsObject(a,b,f)&&c(f)});null!==f.residents&&f.residents.forEach(function(f){d._intersectsObject(a,b,f)&&c(f)});
return!0})};h.prototype.forEachDegenerateObject=function(a){this._degenerateObjects.forEach(a)};h.prototype.findClosest=function(a,b,c,d,f){return this._findClosest(a,"front-to-back"===b?l.FRONT_TO_BACK:l.BACK_TO_FRONT,c,d,f)};h.prototype.forEachInDepthRange=function(a,b,c,d,f,e,g,k){this._forEachInDepthRange(a,b,"front-to-back"===c?l.FRONT_TO_BACK:l.BACK_TO_FRONT,d,f,e,g,k)};h.prototype.forEachNode=function(a){this._forEachNode(this._root,function(b){return a(b.node,b.center,2*b.halfSize)})};h.prototype._intersectsNode=
function(a,c,f){b(f.center,2*-f.halfSize,v);b(f.center,2*f.halfSize,A);return d.rayBoxTest(a,c,v,A)};h.prototype._intersectsObject=function(a,b,c){var f=this._objectToBoundingSphere.getRadius(c);return 0<f?d.raySphere(a,b,this._objectToBoundingSphere.getCenter(c),f):!0};h.prototype._forEachNode=function(a,b){a=n.acquire().init(a);for(var c=[a];0!==c.length;){a=c.pop();if(b(a)&&!a.isLeaf())for(var d=0;d<a.node.children.length;d++)a.node.children[d]&&c.push(n.acquire().init(a).advance(d));n.release(a)}};
h.prototype._forEachNodeDepthOrdered=function(a,b,d,f){void 0===f&&(f=l.FRONT_TO_BACK);a=n.acquire().init(a);var e=[a];for(d=c(d,f,M);0!==e.length;){a=e.pop();if(b(a)&&!a.isLeaf())for(f=7;0<=f;--f){var g=d[f];g>=a.node.children.length||a.node.children[g]&&e.push(n.acquire().init(a).advance(g))}n.release(a)}};h.prototype._findClosest=function(b,c,d,e,l){var h=this,m=Infinity,n=Infinity,p=null,u=f(b,c),t=0,v=function(a){++t;if(!e||e(a)){var f=h._objectToBoundingSphere.getCenter(a),l=h._objectToBoundingSphere.getRadius(a);
if(!d||!g(f,l,d)){var f=k(b,c,f),u=f-l;u<m&&(m=u,n=f+l,p=a)}}};this._forEachNodeDepthOrdered(this._root,function(f){if(null!=l&&t>=l||d&&g(f.center,f.halfSize*r,d))return!1;a.vec3d.scale(u,f.halfSize,x);a.vec3d.add(x,f.center);if(k(b,c,x)>n)return!1;f=f.node;f.terminals.forEach(function(a){v(a)});null!==f.residents&&f.residents.forEach(function(a){v(a)});return!0},b,c);return p};h.prototype._forEachInDepthRange=function(b,c,d,e,h,m,n,p){var u=this,t=-Infinity,v=Infinity,A={setRange:function(a){d===
l.FRONT_TO_BACK?(t=Math.max(t,a.near),v=Math.min(v,a.far)):(t=Math.max(t,-a.far),v=Math.min(v,-a.near))}};A.setRange(e);var y=k(c,d,b),q=f(c,d),C=f(c,-1*d),B=0,D=function(a){++B;if(!n||n(a)){var b=u._objectToBoundingSphere.getCenter(a),f=u._objectToBoundingSphere.getRadius(a),e=k(c,d,b)-y;e-f>v||e+f<t||m&&g(b,f,m)||h(a,A)}};this._forEachNodeDepthOrdered(this._root,function(b){if(null!=p&&B>=p||m&&g(b.center,b.halfSize*r,m))return!1;a.vec3d.scale(q,b.halfSize,x);a.vec3d.add(x,b.center);if(k(c,d,x)-
y>v)return!1;a.vec3d.scale(C,b.halfSize,x);a.vec3d.add(x,b.center);if(k(c,d,x)-y<t)return!1;b=b.node;b.terminals.forEach(function(a){D(a)});null!==b.residents&&b.residents.forEach(function(a){D(a)});return!0},c,d)};h.prototype._objectOrObjectsArray=function(a){if(Array.isArray(a))return a;t[0]=a;return t};h.prototype._remove=function(a,b,c){y.length=0;b=c.advanceTo(b,function(a,b){y.push(a.node,b)})?c.node.terminals:c.node.residents;b.removeUnordered(a);if(0===b.length)for(a=y.length-2;0<=a&&this._purge(y[a],
y[a+1]);a-=2);};h.prototype._nodeIsEmpty=function(a){if(0!==a.terminals.length)return!1;if(null!==a.residents)return 0===a.residents.length;for(var b=0;b<a.children.length;b++)if(a.children[b])return!1;return!0};h.prototype._purge=function(a,b){0<=b&&(a.children[b]=null);return this._nodeIsEmpty(a)?(null===a.residents&&(a.residents=new e({shrink:!0})),!0):!1};h.prototype._add=function(a,b){b.advanceTo(this._boundingSphereFromObject(a,C))?b.node.terminals.push(a):(b.node.residents.push(a),b.node.residents.length>
this._maximumObjectsPerNode&&b.depth<this._maximumDepth&&this._split(b))};h.prototype._split=function(a){var b=a.node.residents;a.node.residents=null;for(var c=0;c<b.length;c++){var d=n.acquire().init(a);this._add(b.data[c],d);n.release(d)}};h.prototype._grow=function(b){var c=this;if(0!==b.length&&(b=this._boundingSphereFromObjects(b,function(a,b){return c._boundingSphereFromObject(a,b)},B),this._isValidRadius(b.radius)&&!this._fitsInsideTree(b)))if(this._nodeIsEmpty(this._root.node))a.vec3d.set(b.center,
this._root.center),this._root.halfSize=1.25*b.radius;else{var d=n.acquire();this._rootBoundsForRootAsSubNode(b,d);this._placingRootViolatesMaxDepth(d)?this._rebuildTree(b,d):this._growRootAsSubNode(d);n.release(d)}};h.prototype._rebuildTree=function(b,c){var d=this;a.vec3d.set(c.center,D.center);D.radius=c.halfSize;b=this._boundingSphereFromObjects([b,D],function(a){return a},E);c=n.acquire().init(this._root);this._root.initFrom(null,b.center,1.25*b.radius);this._forEachNode(c,function(a){d.add(a.node.terminals.data,
a.node.terminals.length);null!==a.node.residents&&d.add(a.node.residents.data,a.node.residents.length);return!0});n.release(c)};h.prototype._placingRootViolatesMaxDepth=function(a){var b=0;this._forEachNode(this._root,function(a){b=Math.max(b,a.depth);return!0});return b+Math.log(a.halfSize/this._root.halfSize)*Math.LOG2E>this._maximumDepth};h.prototype._rootBoundsForRootAsSubNode=function(a,b){var c=a.radius,d=a.center;a=-Infinity;for(var f=this._root.center,e=this._root.halfSize,g=0;3>g;g++){var k=
Math.max(0,Math.ceil((f[g]-e-(d[g]-c))/(2*e))),l=Math.max(0,Math.ceil((d[g]+c-(f[g]+e))/(2*e)))+1;a=Math.max(a,Math.pow(2,Math.ceil(Math.log(k+l)*Math.LOG2E)));J[g].min=k;J[g].max=l}for(g=0;3>g;g++)k=J[g].min,l=J[g].max,c=(a-(k+l))/2,k+=Math.ceil(c),l+=Math.floor(c),u[g]=f[g]-e-k*e*2+(l+k)*e;return b.initFrom(null,u,a*e,0)};h.prototype._growRootAsSubNode=function(b){var c=this._root.node;a.vec3d.set(this._root.center,B.center);B.radius=this._root.halfSize;this._root.init(b);b.advanceTo(B,null,!0);
b.node.children=c.children;b.node.residents=c.residents;b.node.terminals=c.terminals};h.prototype._shrink=function(){for(;;){var a=this._findShrinkIndex();if(-1===a)break;this._root.advance(a);this._root.depth=0}};h.prototype._findShrinkIndex=function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;for(var a=null,b=this._root.node.children,c=0,d=0;d<b.length&&null==a;)c=d++,a=b[c];for(;d<b.length;)if(b[d++])return-1;return c};h.prototype._isDegenerate=function(a){a=this._objectToBoundingSphere.getRadius(a);
return!this._isValidRadius(a)};h.prototype._isValidRadius=function(a){return!isNaN(a)&&-Infinity!==a&&Infinity!==a&&0<a};h.prototype._fitsInsideTree=function(a){var b=this._root.center,c=this._root.halfSize,d=a.center;return a.radius<=c&&d[0]>=b[0]-c&&d[0]<=b[0]+c&&d[1]>=b[1]-c&&d[1]<=b[1]+c&&d[2]>=b[2]-c&&d[2]<=b[2]+c};h.prototype._boundingSphereFromObject=function(b,c){a.vec3d.set(this._objectToBoundingSphere.getCenter(b),c.center);c.radius=this._objectToBoundingSphere.getRadius(b);return c};h.prototype._boundingSphereFromObjects=
function(b,c,d){if(1===b.length){var f=c(b[0],B);a.vec3d.set(f.center,d.center);d.radius=f.radius}else{v[0]=Infinity;v[1]=Infinity;v[2]=Infinity;A[0]=-Infinity;A[1]=-Infinity;A[2]=-Infinity;for(var e=0;e<b.length;e++)if(f=c(b[e],B),this._isValidRadius(f.radius)){var g=v,k=f.center,l=f.radius;g[0]=Math.min(g[0],k[0]-l);g[1]=Math.min(g[1],k[1]-l);g[2]=Math.min(g[2],k[2]-l);g=A;k=f.center;f=f.radius;g[0]=Math.max(g[0],k[0]+f);g[1]=Math.max(g[1],k[1]+f);g[2]=Math.max(g[2],k[2]+f)}a.vec3d.scale(a.vec3d.add(v,
A,d.center),.5);d.radius=Math.max(A[0]-v[0],A[1]-v[1],A[2]-v[2])/2}return d};return h}();var n=function(){function b(b,c,d,f){void 0===d&&(d=0);void 0===f&&(f=0);this.center=a.vec3d.create();this.initFrom(b,c,d,0)}b.prototype.init=function(a){return this.initFrom(a.node,a.center,a.halfSize,a.depth)};b.prototype.initFrom=function(c,d,f,e){void 0===c&&(c=null);void 0===f&&(f=this.halfSize);void 0===e&&(e=this.depth);this.node=c||b.createEmptyNode();d&&a.vec3d.set(d,this.center);this.halfSize=f;this.depth=
e;return this};b.prototype.advance=function(a){var c=this.node.children[a];c||(c=b.createEmptyNode(),this.node.children[a]=c);this.node=c;this.halfSize/=2;this.depth++;a=p[a];this.center[0]+=a[0]*this.halfSize;this.center[1]+=a[1]*this.halfSize;this.center[2]+=a[2]*this.halfSize;return this};b.prototype.advanceTo=function(a,b,c){for(void 0===c&&(c=!1);;){if(this.isTerminalFor(a))return b&&b(this,-1),!0;if(this.isLeaf()&&!c)return b&&b(this,-1),!1;this.isLeaf()&&(this.node.residents=null);var d=this._childIndex(a);
b&&b(this,d);this.advance(d)}};b.prototype.isLeaf=function(){return null!=this.node.residents};b.prototype.isTerminalFor=function(a){return a.radius>this.halfSize/2};b.prototype._childIndex=function(a){a=a.center;for(var b=this.center,c=0,d=0;3>d;d++)b[d]<a[d]&&(c|=1<<d);return c};b.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:new e({shrink:!0}),residents:new e({shrink:!0})}};b.acquire=function(){if(0===this._pool.length)return new b;var a=this._pool[this._pool.length-
1];this._pool.length--;return a};b.release=function(a){this._pool.push(a)};b._pool=[];return b}(),l;(function(a){a[a.FRONT_TO_BACK=1]="FRONT_TO_BACK";a[a.BACK_TO_FRONT=-1]="BACK_TO_FRONT"})(l||(l={}));var p=[[-1,-1,-1],[1,-1,-1],[-1,1,-1],[1,1,-1],[-1,-1,1],[1,-1,1],[-1,1,1],[1,1,1]],m=[[-1,-1,-1],[-1,-1,1],[-1,1,-1],[-1,1,1],[1,-1,-1],[1,-1,1],[1,1,-1],[1,1,1]],r=Math.sqrt(3),t=[null],u=a.vec3d.create(),x=a.vec3d.create(),v=a.vec3d.create(),A=a.vec3d.create(),y=[],C={center:a.vec3d.create(),radius:0},
B={center:a.vec3d.create(),radius:0},D={center:a.vec3d.create(),radius:0},E={center:a.vec3d.create(),radius:0},J=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],F=[],M=[];return q})},"esri/views/3d/webgl-engine/lib/lodRendering/LevelSelector":function(){define(["require","exports","../Camera"],function(q,h,e){Object.defineProperty(h,"__esModule",{value:!0});q=function(){function a(a,b){this._camera=new e;this._worldSpaceRadius=a;this._thresholds=b.map(function(a){return a})}a.prototype.updateCamera=function(a){this._camera.copyFrom(a)};
a.prototype.selectLevel=function(a,b){a=this._camera.computePixelSizeAt(a);b=this._worldSpaceRadius*b/a;a=this._thresholds;for(var d=-1,c=0;c<a.length;++c)b>=a[c]&&(d=c);return d};return a}();h.LevelSelector=q})},"esri/views/3d/webgl-engine/lib/lodRendering/RenderInstanceData":function(){define(["require","exports","../../../support/buffer/BufferView","./BackedBufferObject","../../../../webgl/Util"],function(q,h,e,a,d){Object.defineProperty(h,"__esModule",{value:!0});var b=d.assert,g=function(){return function(a,
b,c){var d=0;this.modelOriginHi=new e.BufferViewVec3f(a,d,c);d+=12;this.modelOriginLo=new e.BufferViewVec3f(a,d,c);d+=12;this.model=new e.BufferViewMat3f(a,d,c);d+=36;this.modelNormal=new e.BufferViewMat3f(a,d,c);d+=36;0<=b.indexOf("color")&&(this.color=new e.BufferViewVec4f(a,d,c),d+=16);0<=b.indexOf("featureAttribute")&&(this.featureAttribute=new e.BufferViewVec4f(a,d,c),d+=16)}}();h.View=g;q=function(){function d(a,b,c){this._tailIndex=this._headIndex=0;this._captureFirstIndex=!0;this._updating=
!1;this._prevHeadIndex=0;this._resized=!1;this._rctx=a;this._optionalFields=b;this._elementSize=c[0].stride;this._capacity=1}d.prototype.destroy=function(){this._buffer&&this._buffer.destroy()};Object.defineProperty(d.prototype,"buffer",{get:function(){return this._buffer.buffer},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"capacity",{get:function(){return this._capacity},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"size",{get:function(){var a=this._headIndex,b=this._tailIndex;return a>=b?a-b:a+this._capacity-b},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"isEmpty",{get:function(){return this._headIndex===this._tailIndex},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"isFull",{get:function(){return this._tailIndex===(this._headIndex+1)%this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"headIndex",{get:function(){return this._headIndex},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"tailIndex",{get:function(){return this._tailIndex},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"firstIndex",{get:function(){return this._firstIndex},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"memoryUsage",{get:function(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}},enumerable:!0,configurable:!0});d.prototype.reset=function(){this._tailIndex=
this._headIndex=0;this._firstIndex=null};d.prototype.startUpdateCylce=function(){this._captureFirstIndex=!0};d.prototype.beginUpdate=function(){b(!this._updating,"already updating");this._updating=!0;this._prevHeadIndex=this._headIndex};d.prototype.endUpdate=function(){b(this._updating,"not updating");this.size<k*this.capacity&&this.shrink();this._resized?(this._buffer.transferAll(),this._resized=!1):this.transferRange(this._prevHeadIndex,this._headIndex);this._updating=!1};d.prototype.allocateHead=
function(){b(this._updating,"not updating");this.isFull&&this.grow();var a=this.headIndex;this._captureFirstIndex&&(this._firstIndex=a,this._captureFirstIndex=!1);this.incrementHead();b(this._headIndex!==this._tailIndex,"invalid pointers");return a};d.prototype.freeTail=function(){b(this._updating,"not updating");b(0<this.size,"invalid size");var a=this._tailIndex===this._firstIndex;this.incrementTail();a&&(this._firstIndex=this._tailIndex)};d.prototype.grow=function(){this.resize(Math.max(c,Math.floor(this._capacity*
f)))};d.prototype.shrink=function(){l&&this.resize(Math.max(c,Math.floor(this._capacity*n)))};d.prototype.resize=function(c){b(this._updating,"not updating");if(c!==this._capacity){var d=new a(this._rctx,34962,35044,this._elementSize,c);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);var f=this.size,e=this.compactInstances(d);b(e===f,"invalid compaction");this._buffer.destroy();this._tailIndex=0;this._headIndex=e;this._prevHeadIndex=
0}this._resized=!0;this._capacity=c;this._buffer=d;this._view=new g(this._buffer.array,this._optionalFields,this._elementSize)}};d.prototype.compactInstances=function(a){var b=this._headIndex,c=this._tailIndex;return c<b?(this._buffer.copyRange(c,b,a),b-c):c>b?(this._buffer.copyRange(c,this._capacity,a),0<b&&this._buffer.copyRange(0,b,a,this._capacity-c),b+(this._capacity-c)):0};d.prototype.incrementHead=function(a){void 0===a&&(a=1);this._headIndex=(this._headIndex+a)%this._capacity};d.prototype.incrementTail=
function(a){void 0===a&&(a=1);this._tailIndex=(this._tailIndex+a)%this._capacity};d.prototype.transferRange=function(a,b){a<b?this._buffer.transferRange(a,b):a>b&&(0<b&&this._buffer.transferRange(0,b),this._buffer.transferRange(a,this._capacity))};return d}();h.RenderInstanceData=q;var c=1024,f=2,k=.3,n=.5,l=!0})},"esri/views/3d/webgl-engine/lib/lodRendering/BackedBufferObject":function(){define(["require","exports","../../../../webgl/BufferObject"],function(q,h,e){return function(){function a(a,
b,g,c,f){this._elementSize=c;this._buffer=new e(a,b,g);this.resize(f)}a.prototype.destroy=function(){this._buffer.dispose()};Object.defineProperty(a.prototype,"elementSize",{get:function(){return this._elementSize},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"array",{get:function(){return this._array},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"buffer",{get:function(){return this._buffer},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"memoryUsage",{get:function(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}},enumerable:!0,configurable:!0});a.prototype.copyRange=function(a,b,e,c){void 0===c&&(c=0);a=new Uint8Array(this.array,a*this.elementSize,(b-a)*this.elementSize);(new Uint8Array(e.array,c*this.elementSize)).set(a)};a.prototype.transferAll=function(){this._buffer.setData(this._array)};
a.prototype.transferRange=function(a,b){a*=this._elementSize;this._buffer.setSubData(this._array,a,a,b*this._elementSize)};a.prototype.resize=function(a){var b=a*this._elementSize,d=new ArrayBuffer(b);this._array&&(a>=this._capacity?(new Uint8Array(d)).set(new Uint8Array(this._array)):(new Uint8Array(d)).set((new Uint8Array(this._array)).subarray(0,a*this._elementSize)));this._array=d;this._buffer.setData(b);this._capacity=a};return a}()})},"esri/views/3d/webgl-engine/lib/lodRendering/utils":function(){define(["require",
"exports","../doublePrecisionUtils","../RenderPass"],function(q,h,e,a){Object.defineProperty(h,"__esModule",{value:!0});h.acquireGLMaterials=function(b,c){var d={};d[a.MATERIAL]=c.aquire(b);d[a.MATERIAL_DEPTH_SHADOWMAP]=c.aquireDepthShadowMap(b);d[a.MATERIAL_NORMAL]=c.aquireNormal(b);d[a.MATERIAL_DEPTH]=c.aquireDepth(b);d[a.MATERIAL_HIGHLIGHT]=c.aquireHighlight(b);return d};h.releaseGLMaterials=function(a,b){b.release(a.id);b.releaseDepthShadowMap(a.id);b.releaseNormal(a.id);b.releaseDepth(a.id);
b.releaseHighlight(a.id)};h.encodeDoubleVec3=function(a,c,f,k,h){d[0]=a.get(c,0);d[1]=a.get(c,1);d[2]=a.get(c,2);e.encodeDoubleArray(d,b,3);f.set(h,0,b[0]);k.set(h,0,b[1]);f.set(h,1,b[2]);k.set(h,1,b[3]);f.set(h,2,b[4]);k.set(h,2,b[5])};var d=new Float64Array(3),b=new Float32Array(6)})},"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../geometry/Point ../../../../layers/graphics/dehydratedFeatures ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ../../../../views/3d/lib/glMatrix ../../support/projectionUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Util ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u){function x(a,b,c,d){a=a.stageObject;for(var f=a.getGeometryRecords(),e=f.length,k="absolute-height"!==b.mode,l=0,h=0;h<e;h++){var m=f[h].geometry,n=[f[h].transformation[12],f[h].transformation[13],f[h].transformation[14]],p=m.getData().getVertexAttr(),u=p[C.POSITION].data,r=p.zOffset.data,p=p.mapPos.data,t=p.length/3;y(u.length/3===t*J+2,"unexpected tube geometry");var v=0,x=0;D.spatialReference=c.spatialReference;for(var A=0,q=0;q<t;q++){D.x=p[3*q];D.y=
p[3*q+1];D.z=p[3*q+2];var F=g.computeElevation(c,D,b,d,k?E:null);k&&(A+=E.terrainElevation);var I=J;0!==q&&q!==t-1||I++;for(var H=0;H<I;H++)B[0]=u[v]+n[0],B[1]=u[v+1]+n[1],B[2]=u[v+2]+n[2],d.setAltitude(F+r[x],B),u[v]=B[0]-n[0],u[v+1]=B[1]-n[1],u[v+2]=B[2]-n[2],v+=3,x+=1;m.invalidateBoundingInfo()}a.geometryVertexAttrsUpdated(h);l+=A/t}return l/e}var v=k.vec3d,A=k.mat4d,y=t.assert;q=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}e(c,a);c.prototype._prepareResources=function(){if(!this._isPropertyDriven("size")){var a=
f.validateSymbolLayerSize(this._getSymbolSize());if(a){this._logWarning(a);this.reject();return}}var a=this._getStageIdHint(),b=this._getMaterialOpacityAndColor(),c=v.create(b),b=b[3],c={diffuse:c,ambient:c,opacity:b,transparent:1>b||this._isPropertyDriven("opacity"),vertexColors:this._isPropertyDriven("color")||this._isPropertyDriven("opacity")};this._material=new u(c,a+"_3dlinemat");this._context.stage.add(l.ModelContentType.MATERIAL,this._material);this.resolve()};c.prototype.destroy=function(){a.prototype.destroy.call(this);
this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(l.ModelContentType.MATERIAL,this._material.id),this._material=null)};c.prototype.createGraphics3DGraphic=function(a){var b=a.graphic;if("polyline"!==b.geometry.type)return this._logWarning("unsupported geometry type for path symbol: "+b.geometry.type),null;if(!this._validateGeometry(b.geometry))return null;var c="graphic"+b.uid,d=this.getGraphicElevationContext(b);return this._createAs3DShape(b,a.renderingInfo,d,c,b.uid)};
c.prototype.layerPropertyChanged=function(a,b,c){if("opacity"===a)return b=this._getMaterialOpacity(),c=1>b||this._isPropertyDriven("opacity"),this._material.setParameterValues({opacity:b,transparent:c}),!0;if("elevationInfo"===a){this._updateElevationContext();for(var d in b){var f=b[d];if(a=c(f))f=this.getGraphicElevationContext(f.graphic),a.needsElevationUpdates=g.needsElevationUpdates3D(f.mode),a.elevationContext.set(f)}return!0}return!1};Object.defineProperty(c.prototype,"numberOfVertices",{get:function(){return 0},
enumerable:!0,configurable:!0});c.prototype._getPathSize=function(a){a=a.size&&this._isPropertyDriven("size")?g.getSingleSizeDriver(a.size):this._getSymbolSize();return a/=this._context.renderCoordsHelper.unitInMeters};c.prototype._getSymbolSize=function(){return this.symbol.size||1};c.prototype._createAs3DShape=function(a,c,f,e,k){var l=a.geometry,h=l.paths;a=[];var u=[],t=[],y=v.create(),q=this._context.renderSpatialReference===n.SphericalECEFSpatialReference,C=Array(6),B=this._getPathSize(c),l=
g.getGeometryVertexData3D(h,d.hasZ(l),l.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,f);this._logGeometryCreationWarnings(l,h,"paths","PathSymbol3DLayer");if(0<h.length){for(var h=l.geometryData.outlines,G=l.eleVertexData,D=l.vertexData,E=0;E<h.length;++E){var F=h[E];if(!(1>=F.count)){var P=F.index,I=F.count;if(this._context.clippingExtent&&(g.computeBoundingBox(G,P,I,C),g.boundingBoxClipped(C,this._context.clippingExtent)))continue;
g.chooseOrigin(D,P,I,y);g.subtractCoordinates(D,P,I,y);F=new Float64Array(G.buffer,3*P*G.BYTES_PER_ELEMENT,3*I);P=g.flatArrayToArrayOfArrays(D,P,I);P=m.createTubeGeometry(P,.5*B,J,q,y);P.getVertexAttr().mapPos={size:3,data:F,offsetIdx:0,strideIdx:3};this._material.getParams().vertexColors&&(F=this._getVertexOpacityAndColor(c),P=m.addVertexColors(P,F));F=new p(P,e+"path"+E);F.singleUse=!0;a.push(F);u.push([this._material]);F=A.identity();A.translate(F,y,F);t.push(F)}}if(0<a.length)return c=new r({geometries:a,
materials:u,transformations:t,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicUid:k},idHint:e}),c=new b(this,c,a,null,null,x,f),c.alignedTerrainElevation=l.terrainElevation,c.needsElevationUpdates=g.needsElevationUpdates3D(f.mode),c}return null};return c}(c);var C=t.VertexAttrConstants,B=v.create(),D=new a,E={verticalDistanceToGround:0,terrainElevation:0},J=10;return q})},"esri/views/3d/layers/graphics/Graphics3DPolygonFillSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../core/screenUtils ../../../../core/libs/earcut/earcut ../../../../geometry/Polygon ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ./ElevationAligners ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./lineUtils ../../lib/glMatrix ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Util ../../webgl-engine/materials/ColorMaterial".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u,x,v,A,y,C,B,D){var E=B.VertexAttrConstants;q=u.vec3d;var J=u.mat4d;m=function(h){function m(){var a=null!==h&&h.apply(this,arguments)||this;a._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};return a}e(m,h);m.prototype._prepareResources=function(){this._prepareFillResources();this._prepareOutlineResources();this.resolve()};m.prototype._prepareFillResources=function(){var a=this._getStageIdHint(),b=this._getMaterialOpacityAndColor(),
b={color:b,transparent:1>b[3]||this._isPropertyDriven("opacity"),polygonOffset:!1,vertexColors:!0};this._material=new D(b,a+"_colormat");this._context.stage.add(x.ModelContentType.MATERIAL,this._material)};m.prototype._prepareOutlineResources=function(){var a=this.symbol.outline;if(this._hasOutline=!!(a&&a.size&&0<a.size&&a.color))a={idHint:this._getStageIdHint()+"_outline",color:this._getOutlineColor(),width:d.pt2px(a.size)},this._outlineMaterial=1.5<=a.width?t.createRibbonMaterial(a):t.createNativeMaterial(a),
this._context.stage.add(x.ModelContentType.MATERIAL,this._outlineMaterial)};m.prototype.destroy=function(){h.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(x.ModelContentType.MATERIAL,this._material.id),this._material=null);this._outlineMaterial&&(this._context.stage.remove(x.ModelContentType.MATERIAL,this._outlineMaterial.id),this._outlineMaterial=null)};m.prototype.createGraphics3DGraphic=function(a){var b=a.graphic,c=b.geometry.type;if("polyline"!==
c&&"polygon"!==c&&"extent"!==c)return this._logWarning("unsupported geometry type for fill symbol: "+c),null;if(!this._validateGeometry(b.geometry))return null;c="graphic"+b.uid;a=this._getVertexOpacityAndColor(a.renderingInfo,Uint8Array,255);var d=this.getGraphicElevationContext(b);return"on-the-ground"===d.mode?this._createAsOverlay(b,a,d,c):this._createAs3DShape(b,a,d,c,b.uid)};m.prototype.layerPropertyChanged=function(a,b,c){if("opacity"===a)return b=this._material.getColor(),c=this._getMaterialOpacity(),
this._material.setColor([b[0],b[1],b[2],c]),this._material.setTransparent(1>c),this._outlineMaterial&&(b=this._outlineMaterial.getColor(),this._outlineMaterial.setColor([b[0],b[1],b[2],this._getOutlineOpacity()])),!0;if("elevationInfo"===a){a=this._elevationContext.mode;this._updateElevationContext();var d=this._elevationContext.mode;if(null==a||null==d)return!1;if("on-the-ground"===a&&"on-the-ground"===d)return!0;if(a!==d&&("on-the-ground"===a||"on-the-ground"===d))return!1;a=p.needsElevationUpdates2D(d);
for(var f in b){var e=b[f];(d=c(e))&&"object3d"===d.type&&(e=e.graphic,d.needsElevationUpdates=a,d.elevationContext.set(this.getGraphicElevationContext(e)))}return!0}return!1};m.prototype.setDrawOrder=function(a,b,c){this.updateSymbolLayerOrder(a,b);this._material&&(this._material.renderPriority=a+b/2,c.add(this._material.id));this._outlineMaterial&&(this._outlineMaterial.renderPriority=a,c.add(this._outlineMaterial.id))};m.prototype._createAs3DShape=function(a,b,c,d,e){var g=this._getPolyGeometry(a);
a=g.rings;var h=this._getOutlineGeometry(g,a),g=p.getGeometryVertexData3D(h,f.hasZ(g),g.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,c);I.idHint=d;I.color=b;I.data=g;var m;this._hasOutline&&(m=new g.vertexData.constructor(g.vertexData));I.outNum=0;I.outGeometries=[];I.outTransforms=[];I.outMaterials=[];this._createAs3DShapeFill(I);I.data.vertexData=m;this._createAs3DShapeOutline(I);this._logGeometryCreationWarnings(I.data,a,
"rings","FillSymbol3DLayer");if(0===I.outNum)return null;b=new y({geometries:I.outGeometries,materials:I.outMaterials,transformations:I.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:e},idHint:d});b=new l(this,b,I.outGeometries,null,null,k.perVertexElevationAligner,c);b.alignedTerrainElevation=g.terrainElevation;b.needsElevationUpdates=p.needsElevationUpdates2D(c.mode);return b};m.prototype._createAs3DShapeFill=function(a){for(var c=a.data.geometryData.polygons,
d=a.data.eleVertexData,f=a.data.vertexData,e=function(e){var k=c[e];e=k.count;var l=k.index;if(g._context.clippingExtent&&(p.computeBoundingBox(d,l,e,F),p.boundingBoxClipped(F,g._context.clippingExtent)))return"continue";var h=new Float64Array(d.buffer,3*l*d.BYTES_PER_ELEMENT,3*e),m=new Float64Array(f.buffer,3*l*f.BYTES_PER_ELEMENT,3*e),k=k.holeIndices.map(function(a){return a-l}),k=b(h,k,3);if(0===k.length)return"continue";p.chooseOrigin(f,l,e,M);p.subtractCoordinates(f,l,e,M);e=g._createFillGeometry(k,
0,m,h,a.color);e=new v(e,a.idHint);e.singleUse=!0;h=J.identity();J.translate(h,M,h);a.outGeometries.push(e);a.outMaterials.push([g._material]);a.outTransforms.push(h);a.outNum++},g=this,k=0;k<c.length;++k)e(k)};m.prototype._createAs3DShapeOutline=function(a){if(this._hasOutline)for(var b=a.data.geometryData.outlines,c=a.data.eleVertexData,d=a.data.vertexData,f=0;f<b.length;++f){var e=b[f],g=e.index,k=e.count;if(this._context.clippingExtent&&(p.computeBoundingBox(c,g,k,F),p.boundingBoxClipped(F,this._context.clippingExtent)))continue;
p.chooseOrigin(d,g,k,M);p.subtractCoordinates(d,g,k,M);e=new Float64Array(c.buffer,3*g*c.BYTES_PER_ELEMENT,3*k);g=new Float64Array(d.buffer,3*g*d.BYTES_PER_ELEMENT,3*k);g=t.createPolylineGeometry(g,e,a.isRings,H,0);g=new v(g,a.idHint+"outline"+f);g.singleUse=!0;e=J.identity();J.translate(e,M,e);a.outGeometries.push(g);a.outMaterials.push([this._outlineMaterial]);a.outTransforms.push(e);a.outNum++}};m.prototype._createAsOverlay=function(a,b,d,f){d=this._getPolyGeometry(a);a=d.rings;var e=this._getOutlineGeometry(d,
a);this._material.renderPriority=this._symbolLayerOrder+this._symbolLayerOrderDelta/2;this._hasOutline&&(this._outlineMaterial.renderPriority=this._symbolLayerOrder);d=p.getGeometryVertexDataDraped(e,d.spatialReference,this._context.overlaySR);I.idHint=f;I.color=b;I.data=d;var g;this._hasOutline&&(g=new d.vertexData.constructor(d.vertexData));I.outNum=0;I.outGeometries=[];I.outBoundingBox=c.empty();this._createAsOverlayFill(I);I.data.vertexData=g;this._createAsOverlayOutline(I);this._logGeometryCreationWarnings(I.data,
a,"rings","FillSymbol3DLayer");return 0<I.outNum?new n(this,I.outGeometries,I.outBoundingBox):null};m.prototype._createAsOverlayFill=function(a){for(var d=a.data.vertexData,f=a.data.geometryData.polygons,e=function(e){var k=f[e];e=k.count;var l=k.index,h=new Float64Array(d.buffer,3*l*d.BYTES_PER_ELEMENT,3*e),k=k.holeIndices.map(function(a){return a-l}),h=b(h,k,3);if(0===h.length)return"continue";p.computeBoundingBox(d,l,e,F);if(p.boundingBoxClipped(F,g._context.clippingExtent))return"continue";c.expand(a.outBoundingBox,
F);p.chooseOrigin(d,l,e,M);p.subtractCoordinates(d,l,e,M);p.setZ(d,l,e,g._getDrapedZ());e=J.identity();J.translate(e,M,e);h=g._createFillGeometry(h,l,d,null,a.color);k=new C(h);k.material=g._material;var m=F;k.center=[.5*(m[0]+m[3]),.5*(m[1]+m[4]),0];k.bsRadius=.5*Math.sqrt((m[3]-m[0])*(m[3]-m[0])+(m[4]-m[1])*(m[4]-m[1]));k.transformation=e;k.name=a.idHint;k.uniqueName=a.idHint+"#"+h.id;a.outGeometries.push(k);a.outNum++},g=this,k=0;k<f.length;++k)e(k)};m.prototype._createAsOverlayOutline=function(a){if(this._hasOutline)for(var b=
a.data.vertexData,d=a.data.geometryData.outlines,f=0;f<d.length;++f){var e=d[f],g=e.index,e=e.count;p.computeBoundingBox(b,g,e,F);if(!p.boundingBoxClipped(F,this._context.clippingExtent)){c.expand(a.outBoundingBox,F);p.chooseOrigin(b,g,e,M);p.subtractCoordinates(b,g,e,M);p.setZ(b,g,e,this._getDrapedZ());e=new Float64Array(b.buffer,3*g*b.BYTES_PER_ELEMENT,3*e);g=J.identity();J.translate(g,M,g);var e=t.createPolylineGeometry(e,null,!0,H,0),k=new C(e);k.material=this._outlineMaterial;var l=F;k.center=
[.5*(l[0]+l[3]),.5*(l[1]+l[4]),0];k.bsRadius=.5*Math.sqrt((l[3]-l[0])*(l[3]-l[0])+(l[4]-l[1])*(l[4]-l[1]));k.transformation=g;k.name=a.idHint+"outline";k.uniqueName=a.idHint+"outline#"+e.id;a.outGeometries.push(k);a.outNum++}}};m.prototype._getOutlineGeometry=function(a,b){return b};m.prototype._getOutlineOpacity=function(){return this._getLayerOpacity()*this.symbol.outline.color.a};m.prototype._getOutlineColor=function(){var b=this.symbol.outline.color,c=this._getOutlineOpacity();return r.mixinColorAndOpacity(a.toUnitRGB(b),
c)};m.prototype._getPolyGeometry=function(a){a=a.geometry;return"extent"===a.type?g.fromExtent(a):a};m.prototype._createFillGeometry=function(a,b,c,d,f){for(var e=a.length,g=new Uint32Array(e),k=new Uint32Array(e),l=0;l<e;l++)g[l]=a[l]+b,k[l]=0;a={};b={};a[E.POSITION]=g;a[E.COLOR]=k;b[E.POSITION]={size:3,data:c};b[E.COLOR]={size:4,data:f};d&&(b.mapPos={size:3,data:d},a.mapPos=g);return new A(b,a)};Object.defineProperty(m.prototype,"numberOfVertices",{get:function(){return 0},enumerable:!0,configurable:!0});
return m}(m);var F=c.create(),M=q.create(),H=new Float32Array([255,255,255,255]),I={idHint:null,color:null,data:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};return m})},"esri/views/3d/layers/graphics/Graphics3DTextSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../core/screenUtils ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/TextTexture ../../webgl-engine/materials/HUDMaterial".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r){var t=[1,1,1,1],u=[0,0,1],x={mode:"relative-to-ground",offset:0},v=[0,0,0,1];return function(k){function h(){var a=null!==k&&k.apply(this,arguments)||this;a._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};return a}e(h,k);h.prototype._prepareResources=function(){if(!this._isPropertyDriven("size")){var a=n.validateSymbolLayerSize(this._getTextSize());if(a){this._logWarning(a);this.reject();return}}this._anchor="center";this.resolve()};h.prototype.destroy=
function(){k.prototype.destroy.call(this);this.isFulfilled()||this.reject()};h.prototype.createGraphics3DGraphic=function(a,b,c,d){void 0===b&&(b={});a=a.graphic;var e=f.placePointOnGeometry(a.geometry);if(!e)return this._logWarning("unsupported geometry type for text symbol: "+a.geometry.type),null;var g=b.text||this.symbol.text;if(!g||1>g.length)return null;null!=b.needsOffsetAdjustment&&(this._elevationOptions.needsOffsetAdjustment=b.needsOffsetAdjustment);var k=this.getGraphicElevationContext(a,
b.elevationOffset||0);return this._createAs3DShape(this.symbol,e,g,k,this._context.layer.id+"_label_"+a.uid,a.uid,b,c,d,"polyline"===a.geometry.type)};h.prototype.getGraphicElevationContext=function(a,b){void 0===b&&(b=0);a=k.prototype.getGraphicElevationContext.call(this,a);a.addOffsetRenderUnits(b);return a};h.prototype.layerPropertyChanged=function(a,b,c){if("opacity"===a)this._logWarning("layer opacity change not yet implemented in Graphics3DTextSymbolLayer");else if("elevationInfo"===a){this._updateElevationContext();
if(b)for(var d in b){a=b[d];var f=c(a);f&&this.updateGraphicElevationContext(a.graphic,f)}return!0}return!1};h.prototype.updateGraphicElevationContext=function(a,b){a=this.getGraphicElevationContext(a,b.metadata.elevationOffset);b.elevationContext.set(a);b.needsElevationUpdates=f.needsElevationUpdates2D(a.mode)||"absolute-height"===a.mode};Object.defineProperty(h.prototype,"numberOfVertices",{get:function(){return 6},enumerable:!0,configurable:!0});h.prototype._defaultElevationInfoNoZ=function(){return x};
h.prototype._createAs3DShape=function(e,k,h,n,x,A,y,q,I,K){var C=y.centerOffset||v,B=y.screenOffset||[0,0],D=y.debugDrawBorder||!1,E=y.translation||[0,0,0],F=y.anchor||this._anchor||"center";this._anchor=F;var H=e.material?a.toUnitRGBA(e.material.color):t,M=e.halo&&e.halo.color&&0<e.halo.size,V=M?a.toUnitRGBA(e.halo.color):t,M=M?d.pt2px(e.halo.size):0,T=this._getTextSize(e),Q=new m(h,{size:T,color:H,font:{family:e.font&&e.font.family?e.font.family:"sans-serif",weight:e.font&&e.font.weight?e.font.weight:
"normal",style:e.font&&e.font.style?e.font.style:"normal"},halo:{size:M,color:V}},x),G;q?G=y:b.isCalloutSupport(this.symbolContainer)&&this.symbolContainer.hasVisibleVerticalOffset()&&(G=this.symbolContainer);e={textureId:I?I.textureId:Q.id,texCoordScale:I?[1,1]:Q.texcoordScale,occlusionTest:!0,screenOffset:B,anchorPos:F,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:y.centerOffsetUnits,debugDrawBorder:D,drawInSecondSlot:!0};G&&G.verticalOffset&&(G=G.verticalOffset,B=G.minWorldLength,D=G.maxWorldLength,
e.verticalOffset={screenLength:d.pt2px(G.screenLength),minWorldLength:B||0,maxWorldLength:null!=D?D:Infinity});this._context.screenSizePerspectiveEnabled&&(G=this._context.sharedResources,B=G.screenSizePerspectiveSettings,e.screenSizePerspective=G.screenSizePerspectiveSettingsLabels.overridePadding(M),e.screenSizePerspectiveAlignment=B);K&&(e.shaderPolygonOffset=1E-4);K=null;M=JSON.stringify(e);null!=q?(K=q.getMaterial(M),null==K&&(K=new r(e,x),q.addMaterial(M,K))):K=new r(e,x);K=[K];C=p.createPointGeometry(u,
E,void 0,I?[0,0]:[Q.textWidth,Q.textHeight],C,I?[0,0]:null);C=[new l(C,x)];x=f.createStageObjectForPoint.call(this,k,C,[K],null,null,n,x,this._context.layer.uid,A,!0);if(null===x)return null;q=new c(this,x.object,C,null==q?K:null,I?null:[Q],g.perObjectElevationAligner,n);q.alignedTerrainElevation=x.terrainElevation;q.needsElevationUpdates=f.needsElevationUpdates2D(n.mode)||"absolute-height"===n.mode;q.getScreenSize=function(a){void 0===a&&(a=Array(2));a[0]=I?Q.textWidth:Q.width;a[1]=I?Q.textHeight:
Q.height;return a};q.metadata={labelText:h,elevationOffset:y.elevationOffset||0};f.extendPointGraphicElevationContext(q,k,this._context.elevationProvider);return q};h.prototype._getTextSize=function(a){return d.pt2px((a||this.symbol).size)||12};return h}(k)})},"esri/views/3d/webgl-engine/lib/TextTexture":function(){define(["require","exports","./Texture","./Util","../../../webgl/Texture"],function(q,h,e,a,d){function b(){var a=document.createElement("canvas");a.width=512;a.height=512;return a}function g(a){return"rgb("+
a.slice(0,3).map(function(a){return Math.floor(255*a)}).toString()+")"}function c(a){return"rgba("+a.slice(0,3).map(function(a){return Math.floor(255*a)}).toString()+","+a[3]+")"}q=function(){function k(a,b,c,d){void 0===d&&(d=!0);this._idHint=c;this._text=a;this._textLines=a.split(/\r?\n/);this._params=b;this._haloSize=Math.round(this._params.halo.size);this._autoScale=d}Object.defineProperty(k.prototype,"id",{get:function(){null==this._id&&(this._id=e.idGen.gen(this._idHint));return this._id},enumerable:!0,
configurable:!0});k.prototype.getParams=function(){return this._params};k.prototype.getText=function(){return this._text};k.prototype.deferredLoading=function(){return!1};Object.defineProperty(k.prototype,"width",{get:function(){this._width||(this._width=a.nextHighestPowerOfTwo(this.renderedWidth));return this._width},enumerable:!0,configurable:!0});k.prototype.getWidth=function(){return this.width};Object.defineProperty(k.prototype,"height",{get:function(){this._height||(this._height=a.nextHighestPowerOfTwo(this.renderedHeight));
return this._height},enumerable:!0,configurable:!0});k.prototype.getHeight=function(){return this.height};Object.defineProperty(k.prototype,"lineHeight",{get:function(){this._lineHeight||(this._lineHeight=this._computeLineHeight());return this._lineHeight},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"textWidth",{get:function(){this._textWidth||(this._textWidth=this._computeTextWidth());return this._textWidth},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,
"textHeight",{get:function(){this._textHeight||(this._textHeight=this._computeTextHeight());return this._textHeight},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"renderedWidth",{get:function(){this._renderedWidth||(this._renderedWidth=Math.round(this.textWidth*this.scaleFactor));return this._renderedWidth},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"renderedHeight",{get:function(){this._renderedHeight||(this._renderedHeight=Math.round(this.textHeight*this.scaleFactor));
return this._renderedHeight},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"scaleFactor",{get:function(){this._scaleFactor||(this._scaleFactor=this._autoScale?Math.min(1,Math.min(2048/this.textWidth,2048/this.textHeight)):1,this._autoScale&&a.assert(2048>=this.renderedWidth&&2048>=this.renderedHeight));return this._scaleFactor},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"texcoordScale",{get:function(){return[this.renderedWidth/this.width,this.renderedHeight/
this.height]},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"fillStyle",{get:function(){this._fillStyle||(this._fillStyle=c(this._params.color));return this._fillStyle},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"haloStyle",{get:function(){this._haloStyle||(this._haloStyle=g(this._params.halo.color));return this._haloStyle},enumerable:!0,configurable:!0});k.prototype.initializeThroughRender=function(a,b){var c=this._getTextCanvas();c.width=this._width;c.height=
this._height;var f=c.getContext("2d");f.save();b.samplingMode=9987;b.wrapMode=33071;b.flipped=!0;b.preMultiplyAlpha=!0;b.hasMipmap=!0;this.renderText(this._renderedWidth,this._renderedHeight,f,0,this._height-this._renderedHeight);a=new d(a,b,c);f.restore();return a};k.prototype.setUnloadFunc=function(a){this._unloadFunc=a};k.prototype.unload=function(){this._unloadFunc&&(this._unloadFunc(this._id),this._unloadFunc=null)};k.prototype.renderText=function(a,b,c,d,e){void 0===d&&(d=0);void 0===e&&(e=
0);b=this.lineHeight*this.scaleFactor;var g=this._haloSize,k=c.textAlign;a=("center"===k?.5*a:"right"===k?a:0)+g;c.save();var l=3>g;if(0<g){var k=g,h=this._getHaloCanvas();h.width=Math.max(512,this.renderedWidth);h.height=Math.max(512,this.renderedHeight);var m=h.getContext("2d");m.clearRect(0,0,h.width,h.height);this._setFontProperties(m,this._params.size*this.scaleFactor);m.fillStyle=this.haloStyle;m.strokeStyle=this.haloStyle;m.lineJoin=l?"miter":"round";if(l)for(var n=0,p=this._textLines;n<p.length;n++){for(var l=
p[n],r=0,q=f;r<q.length;r++){var E=q[r];m.fillText(l,a+g*E[0],g+g*E[1])}k+=b}else for(n=0,p=this._textLines;n<p.length;n++){l=p[n];r=2*g;for(q=0;5>q;q++)m.lineWidth=(.6+.1*q)*r,m.strokeText(l,a,k);k+=b}c.globalAlpha=this._params.halo.color[3];c.drawImage(h,d,e);h.width=512;h.height=512;c.globalAlpha=1}this._setFontProperties(c,this._params.size*this._scaleFactor);k=e+g;e=0;for(g=this._textLines;e<g.length;e++)l=g[e],c.globalCompositeOperation="destination-out",c.fillStyle="rgb(0, 0, 0)",c.fillText(l,
d+a,k),c.globalCompositeOperation="source-over",c.fillStyle=this.fillStyle,c.fillText(l,d+a,k),k+=b;c.restore()};k.preferredAtlasSize=function(){return 512};k.prototype._getTextCanvas=function(){null==k._textCanvas2D&&(k._textCanvas2D=b());return k._textCanvas2D};k.prototype._getHaloCanvas=function(){null==k._haloCanvas2D&&(k._haloCanvas2D=b());return k._haloCanvas2D};k.prototype._setFontProperties=function(a,b){var c=this._params.font;a.font=c.style+" "+c.weight+" "+b+"px "+c.family;a.textAlign=
"left";a.textBaseline="top"};k.prototype._computeTextWidth=function(){var a=this._getTextCanvas().getContext("2d");this._setFontProperties(a,this._params.size);for(var b=0,c=0,d=this._textLines;c<d.length;c++){var f=a.measureText(d[c]).width;f>b&&(b=f)}c=this._params.font;if("italic"===c.style||"oblique"===c.style||"string"===typeof c.weight&&("bold"===c.weight||"bolder"===c.weight)||"number"===typeof c.weight&&600<c.weight)b+=.3*a.measureText("A").width;b+=2*this._haloSize;return b=Math.round(b)};
k.prototype._computeLineHeight=function(){return Math.floor(1.275*this._params.size+2*this._haloSize)};k.prototype._computeTextHeight=function(){return this._computeLineHeight()*this._textLines.length};return k}();var f=[];for(h=0;360>h;h+=22.5)f.push([Math.cos(Math.PI*h/180),Math.sin(Math.PI*h/180)]);return q})},"esri/views/3d/layers/graphics/Graphics3DWebStyleSymbol":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../support/PromiseLightweight"],function(q,
h,e,a){return function(a){function b(b,c){var d=a.call(this)||this;d.symbol=b;d.graphics3DSymbol=null;b.fetchSymbol().then(function(a){if(d.isRejected())throw Error();a.id=d.symbol.id;d.graphics3DSymbol=c(a)}).then(function(){if(d.isRejected())throw Error();d.graphics3DSymbol.then(function(){d.isRejected()||d.resolve()},function(a){d.isRejected()||d.reject(a)})}).catch(function(a){d.isRejected()||d.reject(a)});return d}e(b,a);b.prototype.createGraphics3DGraphic=function(a){return this.graphics3DSymbol.createGraphics3DGraphic(a,
this)};Object.defineProperty(b.prototype,"numberOfVertices",{get:function(){return this.graphics3DSymbol?this.graphics3DSymbol.numberOfVertices:0},enumerable:!0,configurable:!0});b.prototype.layerPropertyChanged=function(a,b){return this.graphics3DSymbol.layerPropertyChanged(a,b)};b.prototype.applyRendererDiff=function(a,b,d){return this.graphics3DSymbol.applyRendererDiff(a,b,d)};b.prototype.getFastUpdateStatus=function(){return this.graphics3DSymbol?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,
fast:0,slow:0}};b.prototype.setDrawOrder=function(a,b){if(this.graphics3DSymbol)return this.graphics3DSymbol.setDrawOrder(a,b)};b.prototype.destroy=function(){this.isFulfilled()||this.reject();this.graphics3DSymbol&&this.graphics3DSymbol.destroy()};return b}(a.Promise)})},"esri/views/3d/support/PropertiesPool":function(){define(["require","exports","../../../core/ObjectPool","../../../core/accessorSupport/watch"],function(q,h,e,a){Object.defineProperty(h,"__esModule",{value:!0});q=function(){function d(b,
d){var c=this;this.owner=d;this.properties={};this.afterDispatchHandle=null;for(var f in b)d=new e(b[f],null,null,2,2),this.properties[f]={pool:d,acquired:[]};this.afterDispatchHandle=a.afterDispatch(function(){return c.release()})}d.prototype.destroy=function(){this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null);this.owner=null};d.prototype.get=function(a){var b=this.owner._get(a);a=this.properties[a];var c=a.pool.acquire();for(a.acquired.push(c);c===b;)a.acquired.push(c),
c=a.pool.acquire();return c};d.prototype.release=function(){for(var b in this.properties){for(var d=this.properties[b],c=0,f=0,e=d.acquired;f<e.length;f++){var h=e[f];a.isValueInUse(h)?d.acquired[c++]=h:d.pool.release(h)}d.acquired.length=c}};return d}();h.PropertiesPool=q;h.default=q})},"esri/views/3d/webgl-engine/lib/FloatingBoxLocalOriginFactory":function(){define(["require","exports","./gl-matrix"],function(q,h,e){var a=e.vec3d;q=function(){function b(a,b){this._origins=[];this._boxSize=a;this._maxNumOrigins=
b}b.prototype.getOrigin=function(e){for(var c=this._origins.length,f,g=!1,h=Number.MAX_VALUE,l=0;l<c;l++){var p=this._origins[l];a.subtract(e,p.vec3,d);d[0]=Math.abs(d[0]);d[1]=Math.abs(d[1]);d[2]=Math.abs(d[2]);var m=d[0]+d[1]+d[2];m<h&&(f=p,h=m,g=d[0]<this._boxSize&&d[1]<this._boxSize&&d[2]<this._boxSize)}g||f&&null!=this._maxNumOrigins&&!(this._origins.length<this._maxNumOrigins)||(c=b.OFFSET,p=[e[0]+c,e[1]+c,e[2]+c],f={vec3:p,id:this.getOriginId(p)},this._origins.push(f));return f};b.prototype.getOriginId=
function(a){return""+b.ORIGIN_PREFIX+a[0]+"/"+a[1]+"/"+a[2]};b.OFFSET=1.11;b.ORIGIN_PREFIX="fb_";return b}();var d=a.create();return q})},"esri/views/3d/webgl-engine/lib/Layer":function(){define("require exports ../../../../core/arrayUtils ./gl-matrix ./IdGen ./ModelContentType ./Octree".split(" "),function(q,h,e,a,d,b,g){var c=a.vec3d;return function(){function a(b,d,f){this._parentStages=[];this._children=new Set;this.id=a._idGen.gen(f);this.name=b;d=d||{};this.group=d.group||"";this.isPickable=
null!=d.isPickable?d.isPickable:!0;this.translation=c.create(d.translation);this._extent=[c.createFrom(0,0,0),c.createFrom(1E3,1E3,1E3)];this._extentDirty=!0}a.prototype.getParentStages=function(){return this._parentStages};a.prototype.addParentStage=function(a){-1===this._parentStages.indexOf(a)&&this._parentStages.push(a)};a.prototype.removeParentStage=function(a){a=this._parentStages.indexOf(a);-1<a&&this._parentStages.splice(a,1)};a.prototype.getName=function(){return this.name};a.prototype.getGroup=
function(){return this.group};a.prototype.getTranslation=function(){return this.translation};a.prototype.getObjectIds=function(){return e.keysOfSet(this._children,function(a){return a.id})};a.prototype.getObjects=function(){return e.keysOfSet(this._children)};a.prototype.getExtent=function(){this._updateExtent();return this._extent};a.prototype.addObject=function(a){this._children.add(a);a.addParentLayer(this);this.notifyDirty("layObjectAdded",a);this._invalidateExtent();this._octree&&this._octree.add(a)};
a.prototype.hasObject=function(a){return this._children.has(a)};a.prototype.removeObject=function(a){return this._children.delete(a)?(a.removeParentLayer(this),this.notifyDirty("layObjectRemoved",a),this._invalidateExtent(),this._octree&&this._octree.remove(a),!0):!1};a.prototype.notifyObjectBBChanged=function(a,b){this._octree&&this._octree.update(a,b)};a.prototype.getCenter=function(){this._updateExtent();var a=c.create();return c.lerp(this._extent[0],this._extent[1],.5,a)};a.prototype.getBSRadius=
function(){this._updateExtent();return.5*c.dist(this._extent[0],this._extent[1])};a.prototype.getSpatialQueryAccelerator=function(){!this._octree&&50<this._children.size&&this._createOctree();return this._octree};a.prototype.shaderTransformationChanged=function(){this.notifyDirty("shaderTransformationChanged",null)};a.prototype.invalidateSpatialQueryAccelerator=function(){this._octree=null};a.prototype.notifyDirty=function(a,c,d,f){d=d||b.LAYER;f=f||this;for(var e=0;e<this._parentStages.length;e++)this._parentStages[e].notifyDirty(d,
f,a,c)};a.prototype._createOctree=function(){for(var a=this.getExtent(),b=0,d=0;3>d;d++)b=Math.max(b,a[1][d]-a[0][d]);d=c.create();c.lerp(a[0],a[1],.5,d);this._octree=new g(d,1.2*b,{getRadius:function(a){return a.getBSRadius()},getCenter:function(a){return a.getCenter()}});this._octree.add(e.keysOfSet(this._children))};a.prototype._invalidateExtent=function(){this._extentDirty=!0};a.prototype._updateExtent=function(){var a=this;if(this._extentDirty)if(this._extentDirty=!1,0===this._children.size)this._extent=
[[0,0,0],[0,0,0]];else{var b=null;this._children.forEach(function(d){var f=d.getBBMin();d=d.getBBMax();if(b)for(var e=0;3>e;++e)a._extent[0][e]=Math.min(a._extent[0][e],f[e]),a._extent[1][e]=Math.max(a._extent[1][e],d[e]);else b=[c.create(f),c.create(d)]});this._extent=b}};a._idGen=new d;return a}()})},"esri/views/3d/layers/graphics/Graphics3DElevationAlignment":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/PooledArray ../../../../core/accessorSupport/decorators ../../../../geometry/support/aaBoundingRect".split(" "),
function(q,h,e,a,d,b,g,c){var f=function(){function a(){this.extents=new b({initialSize:32,allocator:function(){return c.create()}});this.tempExtent=c.create()}Object.defineProperty(a.prototype,"count",{get:function(){return this.extents.length},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"area",{get:function(){var a=0;this.extents.forEach(function(b){a+=c.area(b)});return a},enumerable:!0,configurable:!0});a.prototype.clear=function(){this.extents.clear()};a.prototype.add=function(a){this.contains(a)||
(this.removeContained(a),c.set(this.extents.pushNew(),a))};a.prototype.pop=function(){return this.extents.pop()};a.prototype.forEach=function(a){this.extents.forEach(function(b){return a(b)})};a.prototype.mergeAll=function(){for(;1<this.extents.length;){var a=this.extents.length-1;c.expand(this.extents.data[a-1],this.extents.data[a]);this.extents.pop()}};a.prototype.mergeTight=function(){for(var a=this.extents,b=this.tempExtent,d=!1;!d;)for(var d=!0,f=0;f<a.length;++f){for(var e=f,g=a.data[e],k=c.area(g),
h=!1,v=a.length-1;v>e;--v){var A=a.data[v],y=c.area(A);c.expand(g,A,b);A=k+y;.05>(c.area(b)-A)/A&&(c.set(g,b),k=c.area(g),a.swapElements(v,a.length-1),a.pop(),h=!0)}if(h){d=!1;break}}};a.prototype.toArray=function(){return this.extents.toArray()};a.prototype.contains=function(a){return this.extents.some(function(b){return c.contains(b,a)})};a.prototype.removeContained=function(a){for(var b=this.extents.length-1;0<=b;--b)c.contains(a,this.extents.data[b])&&(this.extents.swapElements(b,this.extents.length-
1),this.extents.pop())};return a}();return function(c){function d(){var a=c.call(this)||this;a.dirtyExtents=new f;a.globalDirty=!1;a.dirtyGraphicsQueue=new b;a.elevationUpdateEventHandle=null;a.eventHandles=[];a.updateElevation=!1;a.layerView=null;a.graphicsCore=null;return a}e(d,c);Object.defineProperty(d.prototype,"updating",{get:function(){return this.hasPendingOperations()},enumerable:!0,configurable:!0});d.prototype.setup=function(a,b,c,d){var f=this;this.layerView=a;this.graphicsCore=c;this.elevationProvider=
d;this.queryGraphicUIDsInExtent=b;this.elevationUpdateEventHandle=d.on("elevation-change",function(a){return f.elevationUpdateHandler(a)});this.eventHandles.push(this.layerView.watch("suspended",function(){return f.suspendedChange()}))};d.prototype.destroy=function(){this.dirtyGraphicsQueue=null;this.elevationUpdateEventHandle&&(this.elevationUpdateEventHandle.remove(),this.elevationUpdateEventHandle=null);this.eventHandles.forEach(function(a){return a.remove()});this.queryGraphicUIDsInExtent=this.graphicsCore=
this.layerView=this.eventHandles=null};d.prototype.clear=function(){this.dirtyGraphicsQueue.clear();this.notifyChange("updating")};d.prototype.suspendedChange=function(){!0===this.layerView.suspended?this.updateElevation=!1:!1===this.layerView.suspended&&this.updateElevation&&this.markAllGraphicsElevationDirty()};d.prototype.elevationInfoChange=function(){this.markAllGraphicsElevationDirty()};d.prototype.needsIdleUpdate=function(){return this.hasPendingOperations()};d.prototype.idleUpdate=function(a){var b=
this;this.globalDirty&&(this.markAllGraphicsElevationDirty(),this.globalDirty=!1);for(var c=this.layerView.view,d=this.graphicsCore.stageLayer.id,f=this.graphicsCore.labelsEnabled?c.labeler.labelStageLayerId:null,e=!1;this.hasPendingOperations()&&!a.done();){for(;0<this.dirtyGraphicsQueue.length&&!a.done();){for(var g=Math.min(this.dirtyGraphicsQueue.length,100),k=0;k<g;k++){var l=this.dirtyGraphicsQueue.pop();(l=this.graphicsCore.graphics[l])&&l.alignWithElevation(this.elevationProvider,c.renderCoordsHelper)}c._stage.processDirtyLayer(d);
null!=f&&c._stage.processDirtyLayer(f)}for(;0<this.dirtyExtents.count&&100>this.dirtyGraphicsQueue.length&&!a.done();)e||(this.dirtyExtents.mergeTight(),e=!0),g=this.dirtyExtents.pop(),this.queryGraphicUIDsInExtent(g,this.spatialReference,function(a){var c=b.graphicsCore.graphics[a];c&&c.needsElevationUpdates()&&b.dirtyGraphicsQueue.push(a)})}c.deconflictor.setDirty();c.labeler.setDirty();this.notifyChange("updating")};d.prototype.markAllGraphicsElevationDirty=function(){this.dirtyExtents.clear();
this.dirtyGraphicsQueue.clear();for(var a in this.graphicsCore.graphics)this.dirtyGraphicsQueue.push(+a);this.notifyChange("updating")};d.prototype.hasPendingOperations=function(){return 0<this.dirtyGraphicsQueue.length||0<this.dirtyExtents.count||this.globalDirty};d.prototype.elevationUpdateHandler=function(a){var b=a.extent;this.layerView.suspended?this.updateElevation||(a=this.graphicsCore.computedExtent)&&b[2]>a.xmin&&b[0]<a.xmax&&b[3]>a.ymin&&b[1]<a.ymax&&(this.updateElevation=!0):(-Infinity===
b[0]?this.globalDirty=!0:this.dirtyExtents.add(b),this.spatialReference=a.spatialReference,this.notifyChange("updating"))};a([g.property({readOnly:!0})],d.prototype,"updating",null);return d=a([g.subclass("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],d)}(g.declared(d))})},"esri/views/3d/layers/graphics/Graphics3DScaleVisibility":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/accessorSupport/decorators".split(" "),
function(q,h,e,a,d,b){function g(a,b){return null!==a&&0<a&&8E7>a||50<b}return function(c){function d(){var a=c.call(this)||this;a._scaleRangeActive=!1;a._layerScaleRangeVisibilityDirty=!0;a.layerScaleRangeVisibilityQuery=!1;a.scaleChangeEventHandle=null;a.layerView=null;a.layer=null;a.queryGraphicUIDsInExtent=null;a.extent=null;a.graphicsCore=null;a.basemapTerrain=null;a.suspended=!1;return a}e(d,c);Object.defineProperty(d.prototype,"layerScaleRangeVisibilityDirty",{get:function(){return this._layerScaleRangeVisibilityDirty},
set:function(a){this._layerScaleRangeVisibilityDirty!==a&&(this._layerScaleRangeVisibilityDirty=a,this.notifyChange("updating"))},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"updating",{get:function(){return this.layerView.view.basemapTerrain&&this.layerScaleRangeVisibilityDirty},enumerable:!0,configurable:!0});d.prototype.setup=function(a,b,c,d,f){this.layerView=a;this.layer=b;this.queryGraphicUIDsInExtent=c;this.graphicsCore=d;this.basemapTerrain=f;this.updateScaleRangeActive()};
d.prototype.destroy=function(){this.scaleChangeEventHandle&&(this.scaleChangeEventHandle.remove(),this.scaleChangeEventHandle=null);this.graphicsCore=this.queryGraphicUIDsInExtent=this.extent=this.layerView=null};d.prototype.needsIdleUpdate=function(){return this.layerView.view.basemapTerrain&&this.layerScaleRangeVisibilityDirty};d.prototype.setExtent=function(a){this.extent=a;this.layerScaleRangeVisibilityDirty=!0};d.prototype.idleUpdate=function(a){this.layerView.view.basemapTerrain&&!a.done()&&
this.layerScaleRangeVisibilityDirty&&(this.updateSuspendScaleVisible(),this.layerScaleRangeVisibilityDirty=!1)};d.prototype.scaleRangeActive=function(){return this._scaleRangeActive};d.prototype.updateScaleRangeActive=function(){var a=this,b=this.layer,c=!1;b.labelingInfo&&(c=c||b.labelingInfo.some(function(a){return a&&g(a.minScale,a.maxScale)}));c=c||g(b.minScale,b.maxScale);b=this._scaleRangeActive!==c;(this._scaleRangeActive=c)&&!this.scaleChangeEventHandle&&this.basemapTerrain?this.scaleChangeEventHandle=
this.basemapTerrain.on("scale-change",function(b){return a.scaleUpdateHandler(b)}):!c&&this.scaleChangeEventHandle&&(this.scaleChangeEventHandle.remove(),this.scaleChangeEventHandle=null);return b};d.prototype.updateSuspendScaleVisibleFinish=function(a){this.layerScaleRangeVisibilityQuery=!1;this._set("suspended",!a)};d.prototype.updateSuspendScaleVisible=function(){var a=this,b=this.layerView.view.basemapTerrain;this.extent&&b&&this._scaleRangeActive?this.layerScaleRangeVisibilityQuery||(this.layerScaleRangeVisibilityQuery=
!0,b.queryVisibleScaleRange(this.extent,this.layer.minScale,this.layer.maxScale,function(b){return a.updateSuspendScaleVisibleFinish(b)})):this.updateSuspendScaleVisibleFinish(!0)};d.prototype.visibleAtScale=function(a,b,c){return null==a?!0:a>c&&(!b||a<b)};d.prototype.visibleAtLayerScale=function(a){return this.visibleAtScale(a,this.layer.minScale,this.layer.maxScale)};d.prototype.visibleAtLabelScale=function(a,b){return this.visibleAtScale(a,b.minScale,b.maxScale)};d.prototype.graphicScale=function(a){var b;
a.centroid?b=a.centroid:"point"===a.graphic.geometry.type&&(b=a.graphic.geometry);return b?this.layerView.view.basemapTerrain?this.layerView.view.basemapTerrain.getScale(b):1:null};d.prototype.graphicVisible=function(a){a=this.graphicScale(a);return this.visibleAtLayerScale(a)};d.prototype.updateGraphicScaleVisibility=function(a){if(this._scaleRangeActive){var b=this.graphicVisible(a);return a.setVisibilityFlag(1,b)}return!1};d.prototype.updateGraphicLabelScaleVisibility=function(a){if(!this._scaleRangeActive||
!a._labelGraphics||0===a._labelGraphics.length)return!1;var b=this.graphicScale(a);if(a=this.updateLabelScaleVisibility(a,b))this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty();return a};d.prototype.updateLabelScaleVisibility=function(a,b){if(!a._labelGraphics||0===a._labelGraphics.length)return!1;var c=a._labelGraphics[0]._labelClass;return c&&null!=c.minScale&&null!=c.maxScale&&(b=this.visibleAtLabelScale(b,c),a.setVisibilityFlag(1,b,1))?!0:!1};d.prototype.scaleUpdateHandler=
function(a){var b=this;if(!this.layerView.suspended){var c=a.extent,d=a.scale,f=this.visibleAtLayerScale(d),e=!1;this.queryGraphicUIDsInExtent(c,a.spatialReference,function(a){if(a=b.graphicsCore.getGraphics3DGraphicById(a)){var g=a.centroid;g&&(c[0]>g.x||c[1]>g.y||c[2]<g.x||c[3]<g.y)||(g=!1,a.setVisibilityFlag(1,f)&&(g=!0),b.updateLabelScaleVisibility(a,d)&&(g=!0),g&&(e=!0))}});e&&(this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty())}this.layerScaleRangeVisibilityDirty=
!0};d.prototype.layerMinMaxScaleChangeHandler=function(){this.updateScaleRangeActive()&&(this._scaleRangeActive?this.graphicsCore.updateAllGraphicsVisibility():this.graphicsCore.forEachGraphics3DGraphic(function(a){return a.setVisibilityFlag(1,void 0)}));this.layerScaleRangeVisibilityDirty=!0};a([b.property({readOnly:!0})],d.prototype,"suspended",void 0);a([b.property({readOnly:!0})],d.prototype,"updating",null);return d=a([b.subclass("esri.views.3d.layers.graphics.Graphics3DScaleVisibility")],d)}(b.declared(d))})},
"esri/views/3d/layers/graphics/Graphics3DSpatialIndex":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/PooledArray ../../../../core/sniff ../../../../core/accessorSupport/decorators ../../../../core/libs/rbush/PooledRBush".split(" "),function(q,h,e,a,d,b,g,c,f){q=function(b){function d(a){a=b.call(this)||this;a.index=new f.default(9,g("csp-restrictions")?function(a){return{minX:a.extent[0],
minY:a.extent[1],maxX:a.extent[2],maxY:a.extent[3]}}:[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]);a.spatialReference=null;return a}e(d,b);d.prototype.destroy=function(){this.index.clear();this.index=null};d.prototype.queryGraphicUIDsInExtent=function(a,b,c){b.equals(this.spatialReference)&&(n.minX=a[0],n.minY=a[1],n.maxX=a[2],n.maxY=a[3],this.index.search(n,function(a){c(a.graphic.uid)}))};d.prototype.add=function(a){!a.addedToSpatialIndex&&a.computeExtent(this.spatialReference)&&(this.index.insert(a),
a.addedToSpatialIndex=!0)};d.prototype.addMany=function(a,b){void 0===b&&(b=a.length);k.clear();for(var c=0;c<b;c++){var d=a[c];!d.addedToSpatialIndex&&d.computeExtent(this.spatialReference)&&(k.push(d),d.addedToSpatialIndex=!0)}this.index.load(k.data,k.length)};d.prototype.remove=function(a){a.addedToSpatialIndex&&(a.addedToSpatialIndex=!1,this.index.remove(a))};d.prototype.removeMany=function(a){for(var b=0;b<a.length;b++)this.remove(a[b])};d.prototype.clear=function(){this.index.clear()};a([c.property({constructOnly:!0})],
d.prototype,"spatialReference",void 0);return d=a([c.subclass("esri.views.3d.layers.graphics.Graphics3DSpatialIndex")],d)}(c.declared(d));var k=new b({initialSize:50}),n={minX:0,minY:0,maxX:0,maxY:0};return q})},"esri/core/libs/rbush/PooledRBush":function(){define(["require","exports","../../PooledArray","../quickselect/quickselect"],function(q,h,e,a){function d(a,c){b(a,0,a.children.length,c,a)}function b(a,b,c,d,f){f||(f=m(null,!0));f.minX=Infinity;f.minY=Infinity;f.maxX=-Infinity;f.maxY=-Infinity;
for(var e=void 0;b<c;b++)e=a.children[b],g(f,a.leaf?d(e):e);return f}function g(a,b){a.minX=Math.min(a.minX,b.minX);a.minY=Math.min(a.minY,b.minY);a.maxX=Math.max(a.maxX,b.maxX);a.maxY=Math.max(a.maxY,b.maxY);return a}function c(a,b){return a.minX-b.minX}function f(a,b){return a.minY-b.minY}function k(a){return(a.maxX-a.minX)*(a.maxY-a.minY)}function n(a){return a.maxX-a.minX+(a.maxY-a.minY)}function l(a,b){return a.minX<=b.minX&&a.minY<=b.minY&&b.maxX<=a.maxX&&b.maxY<=a.maxY}function p(a,b){return b.minX<=
a.maxX&&b.minY<=a.maxY&&b.maxX>=a.minX&&b.maxY>=a.minY}function m(a,b){return{children:a,height:1,leaf:b,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity}}function r(b,c,d,f,e){for(var g=[c,d];g.length;)if(d=g.pop(),c=g.pop(),!(d-c<=f)){var k=c+Math.ceil((d-c)/f/2)*f;a(b,k,c,d,e);g.push(c,k,k,d)}}Object.defineProperty(h,"__esModule",{value:!0});q=function(){function a(a,b){void 0===a&&(a=9);this.compareMinX=c;this.compareMinY=f;this.toBBox=function(a){return a};this._maxEntries=Math.max(4,
a||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));b&&("function"===typeof b?this.toBBox=b:this._initFormat(b));this.clear()}a.prototype.all=function(a){this._all(this.data,a)};a.prototype.search=function(a,b){var c=this.data,d=this.toBBox;if(p(a,c))for(t.clear();c;){for(var f=0,e=c.children.length;f<e;f++){var g=c.children[f],k=c.leaf?d(g):g;p(a,k)&&(c.leaf?b(g):l(a,k)?this._all(g,b):t.push(g))}c=t.pop()}};a.prototype.collides=function(a){var b=this.data,c=this.toBBox;if(!p(a,b))return!1;
for(t.clear();b;){for(var d=0,f=b.children.length;d<f;d++){var e=b.children[d],g=b.leaf?c(e):e;if(p(a,g)){if(b.leaf||l(a,g))return!0;t.push(e)}}b=t.pop()}return!1};a.prototype.load=function(a,b){void 0===b&&(b=a.length);if(!b)return this;if(b<this._minEntries){for(var c=0;c<b;c++)this.insert(a[c]);return this}a=this._build(a.slice(0,b),0,b-1,0);this.data.children.length?this.data.height===a.height?this._splitRoot(this.data,a):(this.data.height<a.height&&(c=this.data,this.data=a,a=c),this._insert(a,
this.data.height-a.height-1,!0)):this.data=a;return this};a.prototype.insert=function(a){a&&this._insert(a,this.data.height-1);return this};a.prototype.clear=function(){this.data=m([],!0);return this};a.prototype.remove=function(a,b){if(!a)return this;var c=this.data,d,f,e,g,k=this.toBBox(a);x.clear();for(v.clear();c||x.length;){c||(c=x.pop(),d=x.data[x.length-1],f=v.pop(),e=!0);if(c.leaf){a:{g=a;var h=c.children,m=b;if(m){for(var n=0;n<h.length;n++)if(m(g,h[n])){g=n;break a}g=-1}else g=h.indexOf(g)}if(-1!==
g){c.children.splice(g,1);x.push(c);this._condense(x);break}}e||c.leaf||!l(c,k)?d?(f++,c=d.children[f],e=!1):c=null:(x.push(c),v.push(f),f=0,d=c,c=c.children[0])}return this};a.prototype.toJSON=function(){return this.data};a.prototype.fromJSON=function(a){this.data=a;return this};a.prototype._all=function(a,b){for(u.clear();a;){if(!0===a.leaf){var c=0;for(a=a.children;c<a.length;c++)b(a[c])}else u.pushArray(a.children);a=u.pop()}};a.prototype._build=function(a,b,c,f){var e=c-b+1,g=this._maxEntries,
k;if(e<=g)return k=m(a.slice(b,c+1),!0),d(k,this.toBBox),k;f||(f=Math.ceil(Math.log(e)/Math.log(g)),g=Math.ceil(e/Math.pow(g,f-1)));k=m([],!1);k.height=f;e=Math.ceil(e/g);g=e*Math.ceil(Math.sqrt(g));for(r(a,b,c,g,this.compareMinX);b<=c;b+=g){var l=Math.min(b+g-1,c);r(a,b,l,e,this.compareMinY);for(var h=b;h<=l;h+=e)k.children.push(this._build(a,h,Math.min(h+e-1,l),f-1))}d(k,this.toBBox);return k};a.prototype._chooseSubtree=function(a,b,c,d){for(;;){d.push(b);if(!0===b.leaf||d.length-1===c)break;for(var f=
Infinity,e=Infinity,g=void 0,l=0,h=b.children.length;l<h;l++){var m=b.children[l],n=k(m),p=(Math.max(m.maxX,a.maxX)-Math.min(m.minX,a.minX))*(Math.max(m.maxY,a.maxY)-Math.min(m.minY,a.minY))-n;p<e?(e=p,f=n<f?n:f,g=m):p===e&&n<f&&(f=n,g=m)}b=g||b.children[0]}return b};a.prototype._insert=function(a,b,c){var d=this.toBBox;c=c?a:d(a);x.clear();d=this._chooseSubtree(c,this.data,b,x);d.children.push(a);for(g(d,c);0<=b;)if(x.data[b].children.length>this._maxEntries)this._split(x,b),b--;else break;this._adjustParentBBoxes(c,
x,b)};a.prototype._split=function(a,b){var c=a.data[b],f=c.children.length,e=this._minEntries;this._chooseSplitAxis(c,e,f);f=this._chooseSplitIndex(c,e,f);f=m(c.children.splice(f,c.children.length-f),c.leaf);f.height=c.height;d(c,this.toBBox);d(f,this.toBBox);b?a.data[b-1].children.push(f):this._splitRoot(c,f)};a.prototype._splitRoot=function(a,b){this.data=m([a,b],!1);this.data.height=a.height+1;d(this.data,this.toBBox)};a.prototype._chooseSplitIndex=function(a,c,d){var f,e,g;f=e=Infinity;for(var l=
c;l<=d-c;l++){var h=b(a,0,l,this.toBBox),m=b(a,l,d,this.toBBox),n;n=Math.max(0,Math.min(h.maxX,m.maxX)-Math.max(h.minX,m.minX))*Math.max(0,Math.min(h.maxY,m.maxY)-Math.max(h.minY,m.minY));h=k(h)+k(m);n<f?(f=n,g=l,e=h<e?h:e):n===f&&h<e&&(e=h,g=l)}return g};a.prototype._chooseSplitAxis=function(a,b,d){var e=a.leaf?this.compareMinX:c,g=a.leaf?this.compareMinY:f,k=this._allDistMargin(a,b,d,e);b=this._allDistMargin(a,b,d,g);k<b&&a.children.sort(e)};a.prototype._allDistMargin=function(a,c,d,f){a.children.sort(f);
f=this.toBBox;for(var e=b(a,0,c,f),k=b(a,d-c,d,f),l=n(e)+n(k),h=c;h<d-c;h++){var m=a.children[h];g(e,a.leaf?f(m):m);l+=n(e)}for(h=d-c-1;h>=c;h--)m=a.children[h],g(k,a.leaf?f(m):m),l+=n(k);return l};a.prototype._adjustParentBBoxes=function(a,b,c){for(;0<=c;c--)g(b.data[c],a)};a.prototype._condense=function(a){for(var b=a.length-1,c=void 0;0<=b;b--)0===a.data[b].children.length?0<b?(c=a.data[b-1].children,c.splice(c.indexOf(a.data[b]),1)):this.clear():d(a.data[b],this.toBBox)};a.prototype._initFormat=
function(a){var b=["return a"," - b",";"];this.compareMinX=new Function("a","b",b.join(a[0]));this.compareMinY=new Function("a","b",b.join(a[1]));this.toBBox=new Function("a","return {minX: a"+a[0]+", minY: a"+a[1]+", maxX: a"+a[2]+", maxY: a"+a[3]+"};")};return a}();h.PooledRBush=q;var t=new e({initialSize:50}),u=new e({initialSize:50}),x=new e({initialSize:10}),v=new e({initialSize:10});h.default=q})},"esri/core/libs/quickselect/quickselect":function(){define([],function(){function q(a,d,b,e,c){for(;e>
b;){if(600<e-b){var f=e-b+1,g=d-b+1,n=Math.log(f),l=.5*Math.exp(2*n/3),n=.5*Math.sqrt(n*l*(f-l)/f)*(0>g-f/2?-1:1);q(a,d,Math.max(b,Math.floor(d-g*l/f+n)),Math.min(e,Math.floor(d+(f-g)*l/f+n)),c)}f=a[d];g=b;l=e;h(a,b,d);for(0<c(a[e],f)&&h(a,b,e);g<l;){h(a,g,l);g++;for(l--;0>c(a[g],f);)g++;for(;0<c(a[l],f);)l--}0===c(a[b],f)?h(a,b,l):(l++,h(a,l,e));l<=d&&(b=l+1);d<=l&&(e=l-1)}}function h(a,d,b){var e=a[d];a[d]=a[b];a[b]=e}function e(a,d){return a<d?-1:a>d?1:0}return function(a,d,b,g,c){q(a,d,b||0,g||
a.length-1,c||e)}})},"esri/views/layers/GraphicsView":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),function(q,h,e,a,d,b){return function(d){function c(){var a=null!==d&&d.apply(this,arguments)||this;a.graphics=null;a.renderer=null;a.view=null;return a}e(c,d);a([b.property()],c.prototype,"graphics",void 0);a([b.property()],c.prototype,"renderer",void 0);a([b.property()],
c.prototype,"view",void 0);return c=a([b.subclass("esri.views.layers.GraphicsView")],c)}(b.declared(d))})},"esri/views/3d/layers/graphics/Deconflictor":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Handles ../../../../core/Logger ../../../../core/now ../../../../core/PooledArray ../../../../geometry/support/aaBoundingRect ./deconflictorDebug ../../lib/glMatrix ../../support/ResourceController ../../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl-engine/lib/Util ../../webgl-engine/materials/HUDMaterial ../../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r){function t(a){return!!a&&"selection"===a.type}q=k.vec2d;k=k.vec4d;var u=p.VertexAttrConstants,x=d.getLogger("esri.views.3d.graphics.Deconflictor"),v=k.create(),A=k.create(),y=k.create(),C=k.create(),B=c.create(),D=c.create(),E=new Set,J=p.lerp,F=function(){function a(a,b){this.creator=a;this.disposer=b;this.list=[];this.currentIndex=0}a.prototype.alloc=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];this.currentIndex>=this.list.length&&
this.list.push(new this.creator(a));return this.list[this.currentIndex++]};a.prototype.freeAll=function(){for(var a=this.currentIndex,b=this.disposer,c=this.list;0<=--a;)b(c[a]);this.currentIndex=0};return a}(),M=function(){function a(){this.graphics3DGraphic=null;this.posView=this.yMax=this.yMin=this.xMax=this.xMin=0;this.graphicsOwner=null;this.id=0}a.release=function(a){a.graphics3DGraphic=null;a.graphicsOwner=null};a.copyMetadata=function(a,b){b.graphics3DGraphic=a.graphics3DGraphic;b.graphicsOwner=
a.graphicsOwner;b.iconDeconflictionEnabled=a.iconDeconflictionEnabled;b.labelDeconflictionEnabled=a.labelDeconflictionEnabled;return b};return a}(),H;(function(a){a[a.Idle=0]="Idle";a[a.Collect=1]="Collect";a[a.Process=2]="Process";a[a.SortIcons=3]="SortIcons";a[a.SortLabels=4]="SortLabels";a[a.Deconflict=5]="Deconflict"})(H||(H={}));d=function(){function d(b){var c=this;this.graphicsOwners=[];this.lastRunTimestamp=0;this.nextRunTimestamp=Number.POSITIVE_INFINITY;this.syncBudget=null;this.state=H.Idle;
this.collectIndex=0;this.collectGraphics=null;this.collectGraphicsIndex=0;this.handles=new a;this.graphicInfosToProcess=new g;this.graphicInfoPool=new F(M,M.release);this.nextGraphicInfoId=0;this.visibleObjects={icons:new g,labels:new g};this.accBinsNumX=15;this.accBinsNumY=20;this.accBinsSizeY=this.accBinsSizeX=0;this.accBins=null;this.accNumTests=0;this.iconMarginFactor=-.1;this.view=b;this.handles.add([b.watch("state.camera",function(){c.setDirty({async:!0,forceMaxIntervalRun:!0})})]);this.frameWorker=
b.resourceController.registerFrameWorker(function(a){return c.run(a)})}d.prototype.destroy=function(){this.handles.destroy();this.handles=null;this.graphicInfoPool.freeAll();this.graphicInfoPool=null;this.frameWorker&&(this.frameWorker.remove(),this.frameWorker=null);this.view=null};d.prototype.addGraphicsOwner=function(a){var b=this;this.graphicsOwners.push(a);this.setDirty();a.layer&&"function"===typeof a.layer.watch&&a.layer.watch("featureReduction",function(c,d){t(c)?(b._setIconVisibilityFlags(a,
!1),b.setDirty()):t(d)&&(b._setIconVisibilityFlags(a,void 0),b.setDirty())})};d.prototype.removeGraphicsOwner=function(a){a=this.graphicsOwners.indexOf(a);0<=a&&this.graphicsOwners.splice(a,1);this.setDirty()};Object.defineProperty(d.prototype,"isDirty",{get:function(){return this.nextRunTimestamp!==Number.POSITIVE_INFINITY},enumerable:!0,configurable:!0});d.prototype.setDirty=function(a){var c=a?a.async:!0;a=a?a.forceMaxIntervalRun:!1;this.state!==H.Idle&&(this.state=H.Idle);var d=b();this.nextRunTimestamp=
a&&1E3<d-this.lastRunTimestamp?this.lastRunTimestamp=d:d+200;c||this.syncBudget||(this.syncBudget=new n.Budget(b),this.syncBudget.enabled=!1)};d.prototype.setClean=function(){this.graphicInfoPool.freeAll();this.graphicInfosToProcess.clear();this.nextGraphicInfoId=0;this.state=H.Idle;this.lastRunTimestamp=b();this.nextRunTimestamp=Number.POSITIVE_INFINITY;this.syncBudget=null};d.prototype.setInitialIconVisibilityFlag=function(a,b){a=!t(a?a.featureReduction:null);b.setVisibilityFlag(2,a)};d.prototype.doesIntersectExistingPoly=
function(a){var b=a.graphics3DGraphic.graphic.uid;E.clear();for(var c=Math.floor(a.xMin/this.accBinsSizeX);c<=Math.floor(a.xMax/this.accBinsSizeX);c++)if(!(0>c||c>=this.accBinsNumX))for(var d=Math.floor(a.yMin/this.accBinsSizeY);d<=Math.floor(a.yMax/this.accBinsSizeY);d++)if(!(0>d||d>=this.accBinsNumY))for(var f=this.accBins[c][d],e=0;e<f.length;e++){var g=f.data[e];if(g.graphics3DGraphic.graphic.uid!==b&&(this.accNumTests++,!(g.xMin>a.xMax||g.xMax<a.xMin||g.yMin>a.yMax||g.yMax<a.yMin)))return!0}return!1};
d.prototype.initBins=function(a,b){if(null==this.accBins){this.accBins=[];for(var c=0;c<this.accBinsNumX;c++){this.accBins.push([]);for(var d=this.accBins[this.accBins.length-1],f=0;f<this.accBinsNumY;f++)d.push(new g({initialSize:10}))}}for(c=0;c<this.accBinsNumX;c++)for(f=0;f<this.accBinsNumY;f++)this.accBins[c][f].clear();this.accBinsSizeX=a/this.accBinsNumX;this.accBinsSizeY=b/this.accBinsNumY;this.accNumTests=0};d.prototype.addToBins=function(a){for(var b=Math.floor(a.xMin/this.accBinsSizeX);b<=
Math.floor(a.xMax/this.accBinsSizeX);b++)if(!(0>b||b>=this.accBinsNumX))for(var c=Math.floor(a.yMin/this.accBinsSizeY);c<=Math.floor(a.yMax/this.accBinsSizeY);c++)0>c||c>=this.accBinsNumY||this.accBins[b][c].push(a)};d.prototype.run=function(a){if(this.view.ready&&!(a.now()<this.nextRunTimestamp))switch(f.prepare(this.view),this.syncBudget&&(a=this.syncBudget),this.state){case H.Idle:this.collectIndex=0,this.collectGraphics=null,this.visibleObjects.icons.clear(),this.visibleObjects.labels.clear(),
this.graphicInfosToProcess.clear();case H.Collect:this.state=H.Collect;if(!this._collectVisibleObjects(a))break;if(0===this.graphicInfosToProcess.length){this.setClean();break}case H.Process:this.state=H.Process;if(a.done())break;for(;this.graphicInfosToProcess.length&&!a.done();)this._processVisibleObject(this.graphicInfosToProcess.pop());if(0<this.graphicInfosToProcess.length)break;case H.SortIcons:this.state=H.SortIcons;if(a.done())break;this.visibleObjects.icons.sort(function(a,b){return a.posView-
b.posView});case H.SortLabels:this.state=H.SortLabels;if(a.done())break;this.visibleObjects.labels.sort(function(a,b){return a.posView-b.posView});case H.Deconflict:this.state=H.Deconflict,a.done()||(this._deconflictVisibleObjects(this.visibleObjects.icons,!1,a),this.visibleObjects.labels.length&&this._deconflictVisibleObjects(this.visibleObjects.labels,!0,a),f.drawAccelerationStruct(this,this.visibleObjects.icons),f.drawAccelerationStruct(this,this.visibleObjects.labels),0===this.visibleObjects.icons.length&&
0===this.visibleObjects.labels.length&&this.setClean())}};d.prototype._collectVisibleObjects=function(a){for(var b=this.view.state.camera,c=b.fullWidth,b=b.fullHeight;this.collectIndex<this.graphicsOwners.length;++this.collectIndex){var d=this.graphicsOwners[this.collectIndex],f=d.graphics3DGraphics;if(f){var e=d.labelsEnabled,g=t(d.layer?d.layer.featureReduction:null);if(e||g)if(this.collectGraphics||(this.collectGraphics=d.graphics3DGraphicsKeys,this.collectGraphicsIndex=0),this.collectGraphics){if(this.collectGraphics!==
d.graphics3DGraphicsKeys)return this.collectIndex=0,this.collectGraphics=null,!1;for(;this.collectGraphicsIndex<this.collectGraphics.length&&!a.done();++this.collectGraphicsIndex){var k=f[this.collectGraphics[this.collectGraphicsIndex]];if(k&&k.areVisibilityFlagsSet(void 0,2)){var l=this.graphicInfoPool.alloc();l.id=this.nextGraphicInfoId++;l.graphicsOwner=d;l.graphics3DGraphic=k;l.iconDeconflictionEnabled=g;l.labelDeconflictionEnabled=e;this.graphicInfosToProcess.push(l)}}this.collectGraphicsIndex>=
this.collectGraphics.length&&(this.collectGraphics=null)}}}if(this.collectIndex===this.graphicsOwners.length&&!this.collectGraphics){this.collectIndex=0;if(0===this.graphicInfosToProcess.length)return!0;this.initBins(c,b);return!0}this.collectGraphics&&--this.collectIndex;return!1};d.prototype._processVisibleObject=function(a){var b=this.view.state.camera;a.iconDeconflictionEnabled&&this._collectGraphics(a,b,0);a.labelDeconflictionEnabled&&(a=a.iconDeconflictionEnabled?M.copyMetadata(a,this.graphicInfoPool.alloc()):
a,a.id=this.nextGraphicInfoId++,this._collectGraphics(a,b,1))};d.prototype._collectGraphics=function(a,b,d){var f=a.graphics3DGraphic,e=a.graphicsOwner,g=1===d,k=g?this.visibleObjects.labels:this.visibleObjects.icons,h=g?f._labelGraphics:f._graphics,g=g?0:this.iconMarginFactor;if(h.length){for(var n=c.empty(B),p,t,q=0;q<h.length;q++){var E=h[q];if(E&&"object3d"===E.type){var F=E.stageObject,L=F?F.getNumGeometryRecords():0;if(!(1>L)){var H=F.getGeometryRecord(0),M=H.materials[0];if(M instanceof m)if(1<
L)x.warn("Graphic objects with more than 1 geometry record are not supported");else{L=H.geometry.getData().getVertexAttr();if(!t){t=F.getCenter();H=H.origin.vec3;r.transformToWorld(t,H,v);r.transformToView(v,H,b.viewMatrix,A);M.applyVerticalOffsetTransformation(A,L[u.NORMAL].data,F.objectTransformation,b,I);F=L[u.AUXPOS1].data;H="screen"!==M.getParams().centerOffsetUnits;r.transformToProjection(A,b.projectionMatrix,H?F:[0,0,0],y);t=r.transformToNDC(y,C);H||(t[0]+=F[0]/b.fullWidth*2,t[1]+=F[1]/b.fullHeight*
2);if(-1>t[0]||-1>t[1]||-1>t[2]||1<=t[0]||1<=t[1])break;p=A[2];f.areVisibilityFlagsSet(2,void 0,d)&&(p*=.7)}E=E.getScreenSize(K);l.applyPrecomputedScaleFactorVec2(E,I.factor,E);M=c.offset(M.calculateRelativeScreenBounds(E,I.scaleAlignment,D),J(0,b.fullWidth,.5+.5*t[0]),J(0,b.fullHeight,.5+.5*t[1]));0!==g&&(E=g*Math.min(c.width(M),c.height(M)),M[0]-=E,M[1]-=E,M[2]+=E,M[3]+=E);c.expand(n,M)}}}}null!=p&&(a.xMin=n[0],a.yMin=n[1],a.xMax=n[2],a.yMax=n[3],a.graphics3DGraphic=f,a.posView=p,a.graphicsOwner=
e,k.push(a))}};d.prototype._deconflictVisibleObjects=function(a,b,c){for(var d=b?1:0;0<a.length&&!c.done();){var e=a.pop(),g=e.graphics3DGraphic,k=!(b&&!1===g.areVisibilityFlagsSet(2))&&!this.doesIntersectExistingPoly(e);k&&this.addToBins(e);g.setVisibilityFlag(2,k,d);b&&this.view.labeler.setLabelGraphicVisibility(g,k);f.drawPoly(e,k?"green":"red")}};d.prototype._setIconVisibilityFlags=function(a,b){var c=a.graphics3DGraphics;a=a.graphics3DGraphicsKeys;if(null!=c&&null!=a)for(var d=0;d<a.length;d++)c[a[d]].setVisibilityFlag(2,
b)};return d}();var I={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},scaleAlignment:0,minPixelSizeAlignment:0},K=q.create();return d})},"esri/views/3d/layers/graphics/deconflictorDebug":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../support/debugFlags"],function(q,h,e,a){function d(a,b,d,e,g){var k=c.height,l=f;l.beginPath();l.lineWidth=1;l.strokeStyle=g;l.moveTo(a,k-d);l.lineTo(b,k-d);l.stroke();l.lineTo(b,k-e);l.stroke();l.lineTo(b,k-d);l.stroke();
l.lineTo(a,k-d);l.stroke();l.lineTo(a,k-d);l.stroke();l.closePath()}Object.defineProperty(h,"__esModule",{value:!0});var b=!1,g=!1,c,f;h.drawAccelerationStruct=function(a,b){if(g&&f){for(var c=f,e=0,k=0;k<a.accBinsNumX;k++)for(var h=0;h<a.accBinsNumY;h++){var n=a.accBins[k][h],e=e+n.length,u=k*a.accBinsSizeX,x=(k+1)*a.accBinsSizeX,v=h*a.accBinsSizeY,q=(h+1)*a.accBinsSizeY;c.fillText(n.length.toFixed(),u+5,v+15);d(u,x,v,q,"blue")}c.fillText("total totalShownLabels: "+e,70,40);c.fillText("total visible labels: "+
b.length,70,50);c.fillText("total numTests: "+a.accNumTests,70,30)}};h.prepare=function(d){b=a.DECONFLICTOR_SHOW_OUTLINES;g=a.DECONFLICTOR_SHOW_GRID;if(b||g)null==c&&(c=document.createElement("canvas"),c.setAttribute("id","canvas2d"),d.surface.parentElement.style.position="relative",d.surface.parentElement.appendChild(c)),c.setAttribute("width",d.width+"px"),c.setAttribute("height",d.height+"px"),c.setAttribute("style","position:absolute;left:0px;top:0px;display:block;pointer-events:none;"),f=c.getContext("2d"),
f.clearRect(0,0,d.width,d.height),f.font="8px Arial"};h.drawPoly=function(a,c){b&&d(a.xMin,a.xMax,a.yMin,a.yMax,c)}})},"esri/views/3d/support/ResourceController":function(){define("require exports ../../../core/Handles ../../../core/now ../../../core/scheduling ./MemoryController ./StreamDataLoader ./StreamDataSupplier ../webgl-engine/lib/Util".split(" "),function(q,h,e,a,d,b,g,c,f){function k(){var a={},b;for(b in n.ClientType)a[n.ClientType[b]]=0;a[n.ClientType.TERRAIN]=15;a[n.ClientType.SCENE]=
20;a[n.ClientType.SYMBOLOGY]=5;return new g(a)}var n=function(){function g(c,f,h){void 0===f&&(f=d);void 0===h&&(h=a);var l=this;this._view=c;this._memoryController=this._budget=null;this._streamDataLoader=k();this._frameWorkers=[];this._nextFrameWorker=0;this._idleWorkers=[];this._nextIdleWorker=0;this._idleUpdatesStartFired=!1;this._lastTargetChangeTime=0;this._handles=new e;this._frameTask=null;this.idleTimeout=300;this.idleBudget=100;this._budget=new g.Budget(h);this._lastTargetChangeTime=h();
this._memoryController=new b(this._view);this._handles.add(this._view.watch("state.camera",function(){return l.cameraChangedHandler()},!0));this._frameTask=f.addFrameTask({update:function(a){return l.frameUpdate(a)}})}g.prototype.destroy=function(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null);this._handles.remove();this._streamDataLoader&&(this._streamDataLoader.destroy(),this._streamDataLoader=null)};Object.defineProperty(g.prototype,"enableBudget",{set:function(a){this._budget.enabled=
a},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"updating",{get:function(){return this._memoryController.updating},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"maxGpuMemory",{set:function(a){this._memoryController.setMaxGpuMemory(a)},enumerable:!0,configurable:!0});g.prototype.setMemoryDirty=function(){this._memoryController.setDirty()};Object.defineProperty(g.prototype,"memoryFactor",{get:function(){return this._memoryController.getMemoryFactor()},enumerable:!0,
configurable:!0});Object.defineProperty(g.prototype,"usedMemory",{get:function(){return this._memoryController.getUsedMemory()},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"memoryEvents",{get:function(){return this._memoryController.events},enumerable:!0,configurable:!0});g.prototype.getStreamDataSupplier=function(a,b){return new c(a,this._streamDataLoader,b)};g.prototype.registerIdleFrameWorker=function(a){var b=this;f.assert(!a.idleFrame||a.needsUpdate,"needsUpdate has to be specified if idleFrame is specified");
var c={callbacks:a};this.addIdleFrameWorker(c);return{remove:function(){b.removeIdleFrameWorker(c)}}};g.prototype.registerFrameWorker=function(a){var b=this,c={callback:a};this.addFrameWorker(c);return{remove:function(){b.removeFrameWorker(c)}}};g.prototype.addIdleFrameWorker=function(a){this._idleWorkers.push(a);this.isIdle()&&this._idleUpdatesStartFired&&a.callbacks.idleBegin&&a.callbacks.idleBegin()};g.prototype.removeIdleFrameWorker=function(a){var b=this._idleWorkers,c=b.indexOf(a);f.assert(0<=
c,"worker not registered");this._idleUpdatesStartFired&&a.callbacks.idleEnd&&a.callbacks.idleEnd();b.splice(c,1);this._nextIdleWorker>=b.length&&(this._nextIdleWorker=0)};g.prototype.addFrameWorker=function(a){this._frameWorkers.push(a)};g.prototype.removeFrameWorker=function(a){var b=this._frameWorkers;a=b.indexOf(a);f.assert(0<=a,"worker not registerted");b.splice(a,1);this._nextFrameWorker>=this._frameWorkers.length&&(this._nextFrameWorker=0)};g.prototype.cameraChangedHandler=function(){this._lastTargetChangeTime=
this._budget.now();this.setMemoryDirty();this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this.callIdleFrameWorkersEnd())};g.prototype.frameUpdate=function(a){var b=Math.max(a.frameDuration-a.elapsedFrameTime-5,5),c=this.idleBudget-a.elapsedFrameTime;this._view._stage&&!this._view._stage.getRenderParams().idleSuspend&&(c=b);b=this.isIdle()?c:b;this._budget.reset(b);this._view.stateManager&&this._view.stateManager.step(a.deltaTime/1E3);this._memoryController.update();for(a=0;a<this._frameWorkers.length;++a)if(b=
(this._nextFrameWorker+a)%this._frameWorkers.length,this._frameWorkers[b].callback(this._budget),3>this._budget.remaining()){this._nextFrameWorker=(b+1)%this._frameWorkers.length;break}this.isIdle()&&!this._budget.done()&&(this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this.callIdleFrameWorkersBegin()),this.callIdleFrameWorkers())};g.prototype.isIdle=function(){return this._budget.now()-this._lastTargetChangeTime>this.idleTimeout};g.prototype.callIdleFrameWorkersBegin=function(){this._idleWorkers.forEach(function(a){a.callbacks.idleBegin&&
a.callbacks.idleBegin()})};g.prototype.callIdleFrameWorkersEnd=function(){this._idleWorkers.forEach(function(a){a.callbacks.idleEnd&&a.callbacks.idleEnd()})};g.prototype.callIdleFrameWorkers=function(){for(var a=0;a<this._idleWorkers.length;++a){var b=(this._nextIdleWorker+a)%this._idleWorkers.length;if(this._budget.done()){this._nextIdleWorker=b;break}b=this._idleWorkers[b];b.callbacks.needsUpdate&&b.callbacks.needsUpdate()&&b.callbacks.idleFrame(this._budget)}};return g}();(function(a){(function(a){a.TERRAIN=
"terrain";a.SCENE="scene";a.SYMBOLOGY="symbology"})(a.ClientType||(a.ClientType={}));var b=function(){function a(a){this._nowFunc=a;this.enabled=!0;this.budget=this.begin=0}a.prototype.now=function(){return this._nowFunc()};a.prototype.reset=function(a){this.begin=this.now();this.budget=this.enabled?a:Number.MAX_VALUE};a.prototype.done=function(){return this.enabled&&this.elapsed()>=this.budget};a.prototype.remaining=function(){return this.enabled?Math.max(this.budget-this.elapsed(),0):Number.POSITIVE_INFINITY};
a.prototype.elapsed=function(){return this.now()-this.begin};return a}();a.Budget=b})(n||(n={}));return n})},"esri/views/3d/support/MemoryController":function(){define(["require","exports","../../../core/Logger","../layers/support/MemoryManagedLayerView","./Evented"],function(q,h,e,a,d){var b=e.getLogger("esri.views.3d.support.MemoryController");return function(){function e(a){this._view=a;this._minQuality=.1;this._memoryHWM=this._maxQuality=1;this._memoryLWM=.75;this._divideRate=1.3;this._throttle=
5;this.events=new d.Evented;this._maxMemory=500;this._quality=1;this._memoryCached=this._memoryCommitted=this._memoryUsed=this._throttled=this._stableQuality=0;this.updating=!1}e.prototype.setMaxGpuMemory=function(a){a&&0<a&&(this._maxMemory=a,this.setDirty())};e.prototype.getMemoryFactor=function(){return this._quality};e.prototype._updateQuality=function(a){a=Math.min(Math.max(a,this._minQuality),this._maxQuality);if(a===this._quality)return!1;this._quality=a;this.events.emit("quality-changed",
this._quality);return!0};e.prototype.getUsedMemory=function(){return this._memoryUsed};e.prototype.setDirty=function(){this._stableQuality=0};e.prototype.update=function(){this._updateMemory();if(!(0>=this._memoryCommitted)){this._unloadSuspended();this._throttled=Math.max(0,this._throttled-1);var a=this._layersUpdating();if(a){if(this._quality<=this._minQuality)return;if(this._memoryCommitted>1.1*this._memoryHWM||this._memoryUsed>this._memoryHWM)if(0<this._stableQuality)this._updateQuality(this._stableQuality);
else if(0===this._throttled||1.05<this._memoryUsed)this._updateQuality(this._quality/this._divideRate),this._throttled=this._throttle}else this._memoryUsed>this._memoryHWM&&(this._stableQuality=0,a=this._updateQuality(this._quality/this._divideRate)),this._memoryCommitted<this._memoryLWM&&this._quality<this._maxQuality&&this._stableQuality!==this._quality&&(this._stableQuality=this._quality,a=this._updateQuality(this._quality+.1*(this._memoryLWM-this._memoryCommitted+.1)));this.updating!==a&&(this.updating=
a,this.events.emit("updating-changed",this.updating))}};e.prototype._layersUpdating=function(){var a=!1;this._view.allLayerViews.forEach(function(b){a=a||b.updating});return a};e.prototype._unloadSuspended=function(){var b=this,d=function(){return 0===b._memoryCached?!1:b._memoryCommitted>1.1*b._memoryHWM||b._memoryUsed>b._memoryHWM||b._memoryUsed>=b._memoryLWM&&.9>b._quality};if(d())for(var e=this._view.allLayerViews.toArray().filter(function(b){return a.isMemoryManagedLayerView(b)&&(0<b.getCachedMemory()||
b.suspended)}),g=function(){var b=null,c=-1;e.forEach(function(d){if(a.isMemoryManagedLayerView(d)){var f=d.getCachedMemory()+(d.suspended?d.getUsedMemory():0);f>c&&(c=f,b=d)}});if(!b)return{value:void 0};b.removeCachedData();h._updateMemory()},h=this;d()&&0<e.length;){var p=g();if("object"===typeof p)return p.value}};e.prototype._updateMemory=function(){var c=0,d=0,e=0;this._view.basemapTerrain&&this._view.basemapTerrain.getUsedMemory&&(c+=this._view.basemapTerrain.getUsedMemory());var g=this._view._stage&&
this._view._stage.view&&this._view._stage.view.getEdgeView();g&&(c+=g.getGpuMemoryUsage());this._view.allLayerViews&&this._view.allLayerViews.forEach(function(b){if(a.isMemoryManagedLayerView(b)){var f=b.getUsedMemory();b.suspended?e+=f:c+=f;d+=b.getUnloadedMemory();e+=b.getCachedMemory()}});if(c>this._maxMemory&&c!==this._warnMemoryUsage){this._warnMemoryUsage=c;var g=function(a){return a.toLocaleString(void 0,{maximumFractionDigits:1})+" Mb"},h=Math.round(100*this._quality);b.warn("GPU Memory Limit exceeded! Limit: "+
g(this._maxMemory)+" Current: "+g(c)+" Projected: "+g(c+d)+" Quality: "+h+"%")}this._memoryUsed=(c+e)/this._maxMemory;this._memoryCommitted=(c+d)/this._maxMemory;this._memoryCached=e/this._maxMemory};return e}()})},"esri/views/3d/layers/support/MemoryManagedLayerView":function(){define(["require","exports"],function(q,h){Object.defineProperty(h,"__esModule",{value:!0});h.isMemoryManagedLayerView=function(e){return"function"===typeof e.getUsedMemory}})},"esri/views/3d/support/StreamDataLoader":function(){define("require exports ../../../request ../../../core/arrayUtils ../../../core/lang ./AsyncQuotaRoundRobinQueue ./PromiseLightweight ../webgl-engine/lib/Performance ../webgl-engine/lib/Util".split(" "),
function(q,h,e,a,d,b,g,c,f){var k;(function(a){a[a.QUEUED=1]="QUEUED";a[a.DOWNLOADING=2]="DOWNLOADING";a[a.CANCELLED=4]="CANCELLED"})(k||(k={}));return function(){function h(a){this.tasks=new Map;this.clientPromiseToTask=new Map;this.loadQueue=new b(this.startLoading.bind(this),this.doneLoadingCallback,this,a)}h.prototype.destroy=function(){var a=this;this.tasks.forEach(function(b){for(var c=0,d=b.clientPromises;c<d.length;c++){var f=d[c];f.isRejected()||f.reject(b.url,null);a.cancelTask(f)}});this.loadQueue.clear();
this.clientPromiseToTask=this.tasks=this.loadQueue=null};h.prototype.request=function(a,b,c){var d=this,f=new g.Promise(function(){d.cancel(f)});this.createOrUpdateTask(a,b,c,f);return f};h.prototype.createTask=function(a,b,c,d,f){a={url:a,docType:b,clientType:c,key:d,result:null,status:k.QUEUED,clientPromises:[],downloadObj:null,_cancelledInQueue:!1,startTime:0,duration:0,size:0};this.updateTask(a,f);this.tasks.set(d,a);this.loadQueue.push(a)};h.prototype.cancel=function(a){this.cancelTask(a)};h.prototype.hasPendingDownloads=
function(){return 0<this.tasks.size};Object.defineProperty(h.prototype,"tests",{get:function(){return{loadQueue:this.loadQueue}},enumerable:!0,configurable:!0});h.prototype.taskKey=function(a,b,c){return a+":"+b+":"+c};h.prototype.updateTask=function(a,b){this.clientPromiseToTask.set(b,a);a.clientPromises.push(b)};h.prototype.createOrUpdateTask=function(a,b,c,d){var f=this.taskKey(a,b,c),e=this.tasks.get(f);e?this.updateTask(e,d):this.createTask(a,b,c,f,d)};h.prototype.cancelTask=function(b){var c=
this.clientPromiseToTask.get(b);c&&(a.removeUnordered(c.clientPromises,b),this.clientPromiseToTask.delete(b),0===c.clientPromises.length&&(c.status===k.DOWNLOADING&&(this.loadQueue.workerCancelled(c),c.status=k.CANCELLED,c.downloadObj.cancel(),c.downloadObj=null),c.status=k.CANCELLED,this.tasks.delete(c.key)))};h.prototype.doneLoadingCallback=function(a,b){f.assert(a.status===k.DOWNLOADING);for(var c=a.result,e=0,g=a.clientPromises;e<g.length;e++){var h=g[e];this.clientPromiseToTask.delete(h);b?h.isRejected()||
h.reject(a.url,b):(c||(c=d.clone(a.result)),h.done(a.url,c),c instanceof HTMLImageElement||(c=null))}this.tasks.delete(a.key)};h.prototype.startLoading=function(a,b){if(a.status===k.CANCELLED)return!1;a.status=k.DOWNLOADING;var d,f;switch(a.docType){case "binary":f="array-buffer";d=0;break;case "image":f="image";break;default:f="json"}a.startTime=c.now();a.downloadObj=e(a.url,{responseType:f,timeout:d,allowImageDataAccess:"image"===a.docType});a.downloadObj.then(function(d){a.duration=c.now()-a.startTime;
a.size="binary"===a.docType?d.data.byteLength:0;a.result=d.data;b(a)},function(c){a.downloadObj.isCanceled()||b(a,c)});return!0};return h}()})},"esri/views/3d/support/AsyncQuotaRoundRobinQueue":function(){define(["require","exports","../../../core/arrayUtils","../webgl-engine/lib/Util"],function(q,h,e,a){return function(){function d(a,d,c,f){this.workerFunc=a;this.robin=0;this.type2id={};this.tasks=[];this.typeNumWorkers=[];this.typeWorkerQuota=[];this.typeStatistics=[];this.numTypes=this.maxTotalNumWorkers=
this.totalNumWorkers=0;for(var b in f)this.tasks[this.robin]=[],this.typeNumWorkers[this.robin]=0,this.typeStatistics[this.robin]={requests:0,size:0,duration:0,speed:0},this.typeWorkerQuota[this.robin]=f[b],this.type2id[b]=this.robin++,this.maxTotalNumWorkers+=f[b];this.numTypes=this.tasks.length;this.robin=0;var e=this;this.taskCallback=function(a){a._cancelledInQueue||(d.apply(c,arguments),e.taskFinished(a))}}d.prototype.setWorkerQuota=function(b){a.assert(e.equals(Object.keys(this.typeWorkerAllication),
Object.keys(b)));this.typeWorkerAllication=b;this.maxTotalNumWorkers=0;for(var d in b)this.typeWorkerQuota[this.type2id[d]]=b[d],this.maxTotalNumWorkers+=b[d]};d.prototype.setWorkerFunc=function(a){this.workerFunc=a};d.prototype.push=function(a){var b=this.type2id[a.clientType];this.totalNumWorkers<this.maxTotalNumWorkers?(this.typeNumWorkers[b]++,this.totalNumWorkers++,this.workerFunc(a,this.taskCallback)):this.tasks[b].push(a)};d.prototype._getStatsForType=function(a){a=this.type2id[a];return{quota:this.typeWorkerQuota[a],
workers:this.typeNumWorkers[a],queueSize:this.tasks[a].length,requestStats:this.typeStatistics[a]}};d.prototype.removeTasks=function(a,d){for(var b=[],f=0,e=this.tasks[this.type2id[d]];f<e.length;f++){var g=e[f];-1===a.indexOf(g)&&b.push(g)}this.tasks[this.type2id[d]]=b};d.prototype.workerCancelled=function(a){this.taskFinished(a);a._cancelledInQueue=!0};d.prototype.clear=function(){for(var a=0;a<this.tasks.length;a++)this.tasks[a]=[]};d.prototype.taskFinished=function(b){var d=this.type2id[b.clientType];
this.typeNumWorkers[d]--;this.totalNumWorkers--;this.typeStatistics[d].requests++;this.typeStatistics[d].size+=b.size||0;this.typeStatistics[d].duration+=b.duration||0;this.typeStatistics[d].speed=0<this.typeStatistics[d].duration?this.typeStatistics[d].size/this.typeStatistics[d].duration:0;a.assert(0<=this.typeNumWorkers[d]);this.next()};d.prototype.next=function(){var a=this.robin,d=!1;do this.typeNumWorkers[a]<this.typeWorkerQuota[a]&&this.processQueue(a)&&(d=!0),a=(a+1)%this.numTypes;while(!d&&
a!==this.robin);if(!d){do this.processQueue(a)&&(d=!0),a=(a+1)%this.numTypes;while(!d&&a!==this.robin)}this.robin=a};d.prototype.processQueue=function(a){for(;0<this.tasks[a].length;)if(this.workerFunc(this.tasks[a].shift(),this.taskCallback))return this.typeNumWorkers[a]++,this.totalNumWorkers++,!0;return!1};return d}()})},"esri/views/3d/support/StreamDataSupplier":function(){define(["require","exports"],function(q,h){return function(){function e(a,d,b){this._clientType=a;this._loader=d;this._activeRequests=
null;b&&b.trackRequests&&(this._activeRequests=new Map)}e.prototype.request=function(a,d){var b=this;d=this._loader.request(a,d,this._clientType);if(this._activeRequests){this._activeRequests.set(a,d);var e=function(){b._activeRequests.delete(a)};d.then(e,e)}return d};e.prototype.cancelRequest=function(a){this._loader.cancel(a)};e.prototype.cancelAll=function(){var a=this;this._activeRequests&&(this._activeRequests.forEach(function(d){a._loader.cancel(d)}),this._activeRequests.clear())};e.prototype.hasPendingDownloads=
function(){return this._loader.hasPendingDownloads()};return e}()})},"esri/views/3d/layers/graphics/Labeler":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper dojo/promise/all ../../../../Color ../../../../core/Accessor ../../../../core/Handles ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators ../../../../layers/support/LabelClass ../../../../symbols/callouts/calloutUtils ./Graphics3DCalloutSymbolLayerFactory ./Graphics3DWebStyleSymbol ./labelPlacement ../../support/debugFlags ../../webgl-engine/Stage ../../webgl-engine/lib/Layer ../../webgl-engine/lib/MaterialCollection ../../webgl-engine/lib/TextTexture ../../webgl-engine/lib/TextTextureAtlas".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u,x,v,A,y,C){Object.defineProperty(h,"__esModule",{value:!0});q=function(g){function h(a){a=g.call(this)||this;a.labelStageLayer=null;a.labels={};a.labelsToAdd={};a.labelsToRemove={};a.labelingContexts=[];a.idHint="__labeler";a.dirty=!1;return a}e(h,g);q=h;h.prototype.setup=function(){var a=this;this.handles||(this.handles=new c,this.handles.add([this.view.watch("state.camera",function(){return a.setDirty()})]));this.labelStageLayer||(this.labelStageLayer=
new v(this.idHint,{isPickable:!1},this.idHint+"_labels"),this.view._stage.add(x.ModelContentType.LAYER,this.labelStageLayer),this.view._stage.addToViewContent([this.labelStageLayer.id]),this.textTextureAtlas=new C(this.idHint+"_atlas",this.view),this.hudMaterialCollection=new A(this.view._stage),this.calloutMaterialCollection=new A(this.view._stage));this.handles.add(this.view.resourceController.registerIdleFrameWorker({needsUpdate:function(){return a.needsIdleUpdate()},idleFrame:function(b){return a.idleUpdate(b)}}))};
h.prototype.dispose=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.labelStageLayer&&(this.view._stage.removeFromViewContent([this.labelStageLayer.id]),this.view._stage.remove(x.ModelContentType.LAYER,this.labelStageLayer.id),this.labelStageLayer=null,this.textTextureAtlas.dispose(),this.textTextureAtlas=null,this.hudMaterialCollection.dispose(),this.hudMaterialCollection=null,this.calloutMaterialCollection.dispose(),this.calloutMaterialCollection=null);this.labelingContexts=
[];this.labels={};this.labelsToAdd={};this.labelsToRemove={}};h.prototype.isActiveLabelingContext=function(a){return a.active&&this.labelsEnabled(a)};h.prototype.activateLabelingContext=function(a){for(var b in a.labels){var c=a.labels[b];this.labels[b]=c;c.graphics3DGraphic.setVisibilityFlag(0,!0,1)}a.active=!0};h.prototype.deactivateLabelingContext=function(a){for(var b in a.labels){var c=a.labels[b];c.graphics3DGraphic.setVisibilityFlag(0,!1,1);c.rendered&&(this.labelsToRemove[b]=a.labels[b]);
delete this.labels[b];delete this.labelsToAdd[b]}a.active=!1};h.prototype.addLabelTextureToAtlas=function(a){for(var b=0;b<a.graphics3DGraphic._labelGraphics.length;b++)a.textTextures[b]&&this.textTextureAtlas.addTextTexture(a.textTextures[b],a.graphics3DGraphic._labelGraphics[b].stageObject);a.rendered=!0};h.prototype.removeLabelTextureFromAtlas=function(a){for(var b=0;b<a.graphics3DGraphic._labelGraphics.length;b++)a.textTextures[b]&&this.textTextureAtlas.removeTextTexture(a.textTextures[b],a.graphics3DGraphic._labelGraphics[b].stageObject);
a.rendered=!1};h.prototype.needsIdleUpdate=function(){return this.isDirty};h.prototype.idleUpdate=function(a){if(this.view.ready){for(var b=!!a,c=!1,d=0,f=this.labelingContexts;d<f.length;d++){var e=f[d];if(this.isActiveLabelingContext(e)){if(!this.hasValidLabelClassContext(e)){if(this.hasInvalidLabelClassContext(e)){this.deactivateLabelingContext(e);continue}this.createLabelClassContext(e);if(this.hasPendingLabelClassContext(e)){c=!0;continue}if(!this.hasValidLabelClassContext(e))continue}for(var g in e.labelsToInitialize){if(b&&
a.done())return;var k=e.labelsToInitialize[g];!k.hasGraphics3DResources&&this.createGraphics3DResources(k)&&(this.labels[g]=k,b&&this.view.deconflictor.setDirty());k.hasGraphics3DResources&&!k.hasTextTextureResources&&k.visible&&this.createTextTextureResources(k);(k.visible&&k.hasTextTextureResources||!k.visible&&k.hasGraphics3DResources)&&delete e.labelsToInitialize[g]}}}for(g in this.labelsToRemove)this.removeLabelTextureFromAtlas(this.labelsToRemove[g]),delete this.labelsToRemove[g];for(g in this.labelsToAdd)this.addLabelTextureToAtlas(this.labelsToAdd[g]),
delete this.labelsToAdd[g];c||(this.dirty=!1)}};h.prototype.hasPendingLabelClassContext=function(a){return a.labelClassPromise&&!a.labelClassPromise.isResolved()};h.prototype.hasValidLabelClassContext=function(a){return a.labelClassContexts&&a.labelClassContexts.length};h.prototype.hasInvalidLabelClassContext=function(a){return null===a.labelClassContexts};h.prototype.createLabelClassContext=function(a){if(a.labelClassPromise)return a.labelClassPromise;a.labelClassPromise=a.layer.when(function(){a.scaleVisibility&&
a.scaleVisibility.updateScaleRangeActive();var b=a.graphics3DCore,c=b.layer.labelingInfo&&b.layer.labelingInfo.filter(function(a){return!!a.symbol});if(!c||0===c.length)return null;var f=Array(c.length),c=c.map(function(a,c){var d=a.symbol,e;e=b.getOrCreateGraphics3DSymbol(d);e=e instanceof r?e.graphics3DSymbol:e;var g=null;p.isCalloutSupport(d)&&d.hasVisibleCallout()&&(g=m.make(d,b.symbolCreationContext));f[c]={labelClass:a,graphics3DSymbol:e,graphics3DCalloutSymbolLayer:g,options:a.getOptions()};
return e});return d(c).then(function(){return f})}).then(function(b){b&&(a.labelClassContexts=b)}).catch(function(){a.labelClassContexts=null});return a.labelClassPromise};h.prototype.destroyLabelClassContext=function(a){a.labelClassContexts=[];a.labelClassPromise=null};h.prototype.createLabelText=function(a,b,c,d){if(!l.evaluateWhere(b.where,a.attributes))return null;b=b.getLabelExpression();return b.expression?l.buildLabelText(b.expression,a,d.fields,c):null};h.prototype.createTextSymbolGraphic=
function(a,b,c,d,f){a={text:a,centerOffset:c.centerOffset,translation:c.translation,elevationOffset:c.elevationOffset,screenOffset:c.screenOffset,anchor:c.anchor,needsOffsetAdjustment:c.needsOffsetAdjustment,centerOffsetUnits:c.centerOffsetUnits,verticalOffset:c.verticalOffset,debugDrawBorder:u.LABELS_SHOW_BORDER};q.tmpGraphicCreationContext.graphic=b;q.tmpGraphicCreationContext.renderingInfo=null;q.tmpGraphicCreationContext.layer=d;return f.createGraphics3DGraphic(q.tmpGraphicCreationContext,a,this.hudMaterialCollection,
this.textTextureAtlas)};h.prototype.createLineCalloutGraphic=function(a,b,c,d,f){q.tmpGraphicCreationContext.graphic=a;q.tmpGraphicCreationContext.renderingInfo={symbol:b,needsOffsetAdjustment:d.needsOffsetAdjustment,translation:d.translation,elevationOffset:d.elevationOffset,screenOffset:d.screenOffset,centerOffset:d.centerOffset,centerOffsetUnits:d.centerOffsetUnits,materialCollection:this.calloutMaterialCollection};q.tmpGraphicCreationContext.layer=f;return c.createGraphics3DGraphic(q.tmpGraphicCreationContext)};
h.prototype.createGraphics3DResources=function(a){var b=a.labelingContext,c=!1,d=a.graphics3DGraphic,f=d.graphic,e=b.labelClassContexts,g=b.layer,k=this.labelsEnabled(b);if(e&&0!==e.length&&d._graphics[0]){for(var h=0;h<e.length;h++){var l=e[h],m=l.labelClass,n=this.createLabelText(f,m,l.options,g);if(n){var p=null;l.graphics3DSymbol&&l.graphics3DSymbol.symbol&&"label-3d"===l.graphics3DSymbol.symbol.type&&(p=l.graphics3DSymbol.symbol);var u=l.graphics3DSymbol.childGraphics3DSymbols[0],r=t.get({graphics3DGraphic:d,
labelSymbol:p,labelClass:l.labelClass});if(u&&r.isValid){if(c=this.createTextSymbolGraphic(n,f,r,g,u)){if(c._labelClass=m,d.addLabelGraphic(c,this.labelStageLayer,this.view._stage),b.spatialIndex&&b.spatialIndex.add(d),d.setVisibilityFlag(0,k,1),d.setVisibilityFlag(1,void 0,1),d.setVisibilityFlag(2,!1,1),c=!0,l.graphics3DCalloutSymbolLayer&&r.hasLabelVerticalOffset&&(f=this.createLineCalloutGraphic(f,p,l.graphics3DCalloutSymbolLayer,r,g)))l.calloutSymbolLayerIndex=d._labelGraphics.length,d.addLabelGraphic(f,
this.labelStageLayer,this.view._stage)}else return!1;break}}}b.scaleVisibility&&c&&b.scaleVisibility.updateGraphicLabelScaleVisibility(d);return a.hasGraphics3DResources=!0}};h.prototype.destroyGraphics3DResources=function(a){a.graphics3DGraphic.clearLabelGraphics();a.hasGraphics3DResources=!1};h.prototype.createTextTextureResources=function(a){var c=a.labelingContext,d=a.graphics3DGraphic,f=c.labelClassContexts,c=c.layer,e=d.graphic;if(f&&0!==f.length&&d._graphics[0]){for(d=0;d<f.length;d++){var g=
f[d],h=this.createLabelText(e,g.labelClass,g.options,c)||e.symbol&&e.symbol.text;if(h&&!(1>h.length)){var g=g.graphics3DSymbol.childGraphics3DSymbols[0].symbol,l=g.material?b.toUnitRGBA(g.material.color):B,m=g.halo&&g.halo.color&&0<g.halo.size,n=m?b.toUnitRGBA(g.halo.color):B,m=m?k.pt2px(g.halo.size):0,p=k.pt2px(g.size)||12,h=new y(h,{size:p,color:l,font:{family:g.font&&g.font.family?g.font.family:"sans-serif",weight:g.font&&g.font.weight?g.font.weight:"normal",style:g.font&&g.font.style?g.font.style:
"normal"},halo:{size:m,color:n}},c.id+"_label_"+e.uid);a.textTextures.push(h)}}a.hasTextTextureResources=!0}};h.prototype.destroyTextTextureResources=function(a){a.textTextures=[];a.hasTextTextureResources=!1};h.prototype.addGraphic=function(a,b){var c={hasGraphics3DResources:!1,hasTextTextureResources:!1,visible:!1,rendered:!1,labelingContext:a,graphics3DGraphic:b,textTextures:[]};b=b.graphic.uid;a.labels[b]=c;this.isActiveLabelingContext(a)&&this.hasValidLabelClassContext(a)&&this.createGraphics3DResources(c)?
this.labels[b]=c:a.labelsToInitialize[b]=c;a=a.graphics3DCore.asyncUpdates;this.setDirty(a);this.view.deconflictor.setDirty({async:a})};h.prototype.removeGraphic=function(a,b){b=b.graphic.uid;var c=a.labels[b];c&&(this.labels[b]&&(this.removeLabelTextureFromAtlas(c),delete this.labels[b],delete this.labelsToAdd[b],delete this.labelsToRemove[b]),c.hasTextTextureResources&&this.destroyTextTextureResources(c),c.hasGraphics3DResources&&this.destroyGraphics3DResources(c),delete a.labels[b],delete a.labelsToInitialize[b],
a=a.graphics3DCore.asyncUpdates,this.setDirty(a),this.view.deconflictor.setDirty({async:a}))};h.prototype.labelsEnabled=function(a){return!0===a.layer.labelsVisible};h.prototype.elevationInfoChange=function(a){for(var b=function(b){b.graphics3DSymbol.layerPropertyChanged("elevationInfo",{});if(b.graphics3DCalloutSymbolLayer){var c={},d;for(d in a.labels){var f=a.labels[d].graphics3DGraphic;c[f.graphic.uid]=f}b.graphics3DCalloutSymbolLayer.layerPropertyChanged("elevationInfo",c,function(a){return a._labelGraphics[b.calloutSymbolLayerIndex]})}},
c=0,d=a.labelClassContexts;c<d.length;c++)b(d[c])};h.prototype.visibilityInfoChange=function(a){var b=a.layer.labelsVisible;b&&!a.active&&this.activateLabelingContext(a);!b&&a.active&&this.deactivateLabelingContext(a);a=a.graphics3DCore.asyncUpdates;this.setDirty(a);this.view.deconflictor.setDirty({async:a})};h.prototype.resetLabels=function(a){for(var b in a.labels){var c=a.labels[b];this.labels[b]&&(this.removeLabelTextureFromAtlas(c),delete this.labels[b],delete this.labelsToAdd[b],delete this.labelsToRemove[b]);
c.hasTextTextureResources&&this.destroyTextTextureResources(c);c.hasGraphics3DResources&&this.destroyGraphics3DResources(c);c.visible=!1;c.rendered=!1;a.labelsToInitialize[b]=c}this.destroyLabelClassContext(a);this.labelStageLayer.invalidateSpatialQueryAccelerator();a=a.graphics3DCore.asyncUpdates;this.setDirty(a);this.view.deconflictor.setDirty({async:a})};h.prototype.findLabelingContext=function(a){for(var b=0;b<this.labelingContexts.length;b++)if(this.labelingContexts[b].graphics3DCore===a)return this.labelingContexts[b];
return null};h.prototype.addGraphicsOwner=function(a,b,c){var d=this;if(!this.findLabelingContext(a)){var e={graphics3DCore:a,layer:a.layer,scaleVisibility:b,spatialIndex:c,active:a.layer.labelsVisible,labelClassPromise:null,labelClassContexts:[],labels:{},labelsToInitialize:{}};this.labelingContexts.push(e);this.setDirty();return{addGraphic:function(a){return d.addGraphic(e,a)},removeGraphic:function(a){return d.removeGraphic(e,a)},layerLabelsEnabled:function(){return d.labelsEnabled(e)},labelingInfoChange:function(a){if(a){for(var b=
0;b<a.length;b++){var c=e.labels[a[b]];c&&(d.removeGraphic(e,c.graphics3DGraphic),d.addGraphic(e,c.graphics3DGraphic))}return f.create(function(a){return!0})}d.resetLabels(e);return d.createLabelClassContext(e)},elevationInfoChange:function(){d.elevationInfoChange(e)},visibilityInfoChange:function(){d.visibilityInfoChange(e)},clear:function(){d.resetLabels(e)}}}};h.prototype.removeGraphicsOwner=function(a){if(a=this.findLabelingContext(a)){var b=this.labelingContexts.indexOf(a);this.labelingContexts.splice(b,
1);for(var c in a.labels)this.removeGraphic(a,a.labels[c].graphics3DGraphic);this.setDirty()}};h.prototype.setLabelGraphicVisibility=function(a,b){a=a.graphic.uid;var c=this.labels[a];c&&(b&&!c.rendered?(this.labelsToAdd[a]=c,c.hasTextTextureResources||(c.labelingContext.labelsToInitialize[a]=c)):!b&&c.rendered&&(this.labelsToRemove[a]=c),c.visible=b,this.setDirty(c.labelingContext.graphics3DCore.asyncUpdates))};Object.defineProperty(h.prototype,"labelStageLayerId",{get:function(){return this.labelStageLayer.id},
enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"isDirty",{get:function(){return this.dirty||this.textTextureAtlas&&this.textTextureAtlas.isDirty},enumerable:!0,configurable:!0});h.prototype.setDirty=function(a){void 0===a&&(a=!0);this.dirty=!0;a||this.idleUpdate()};Object.defineProperty(h.prototype,"updating",{get:function(){return this.labelingContexts.some(function(a){return a.labelClassPromise&&!a.labelClassPromise.isResolved()})},enumerable:!0,configurable:!0});var q;h.tmpGraphicCreationContext=
{graphic:null,renderingInfo:null,layer:null};a([n.property({constructOnly:!0})],h.prototype,"view",void 0);a([n.property({type:Boolean,readOnly:!0})],h.prototype,"updating",null);return h=q=a([n.subclass()],h)}(n.declared(g));h.Labeler=q;var B=[0,0,0,1]})},"esri/views/3d/layers/graphics/labelPlacement":function(){define("require exports ../../../../core/Logger ../../../../core/scheduling ./Graphics3DWebStyleSymbol ../../lib/glMatrix ../../webgl-engine/materials/HUDMaterial".split(" "),function(q,
h,e,a,d,b,g){function c(a,c){switch(c.graphics3DGraphic.graphic.geometry.type){case "polyline":case "polygon":case "extent":case "multipoint":a.anchor="center";break;case "point":var d=c.graphics3DGraphic,e=k(d.graphics3DSymbol).symbol.symbolLayers.getItemAt(0),d=d.getCenterObjectSpace();b.vec3d.set(d,a.translation);switch(e.type){case "icon":case "text":d=c.graphics3DGraphic;e=d._graphics[0].getScreenSize();d.isDraped()?a.hasLabelVerticalOffset||(a.anchor="center"):(d=void 0,void 0===d&&(d=v),c=
c.graphics3DGraphic._graphics[0].stageObject.getGeometryRecords()[0].materials[0],c instanceof g?(c=c.getParams().anchorPos,d[0]=2*(c[0]-.5),d[1]=2*(c[1]-.5)):(d[0]=0,d[1]=0),c=d,x[0]=e[0]/2*(a.normalizedOffset[0]-c[0]),x[1]=e[1]/2*(a.normalizedOffset[1]-c[1]),a.screenOffset[0]=x[0],a.hasLabelVerticalOffset?(a.centerOffset[1]=x[1],a.centerOffsetUnits="screen"):a.screenOffset[1]=x[1]);break;case "object":f(a,c)}break;case "mesh":f(a,c)}}function f(a,c){c=c.graphics3DGraphic._graphics[0].getBoundingBoxObjectSpace();
c=[c[3]-c[0],c[4]-c[1],c[5]-c[2]];a.centerOffset[0]=1.1*Math.max(c[0],c[1])/2*a.normalizedOffset[0];var d=c[2]/2*a.normalizedOffset[1]+a.translation[2];a.translation[2]=d*(1.1-1);a.elevationOffset=d;c=b.vec3d.length(c);a.centerOffset[2]=1.1*c/2*a.normalizedOffset[2]}function k(a){return a instanceof d?a.graphics3DSymbol:a}function n(a,b){var c=b.labelSymbol;b=b.graphics3DGraphic;var d=k(b.graphics3DSymbol).symbol;if("point-3d"===d.type&&d.supportsCallout()&&d.hasVisibleVerticalOffset()&&!b.isDraped())a.verticalOffset=
l(d.verticalOffset);else if(c&&c.hasVisibleVerticalOffset()&&("point-3d"!==d.type||!d.supportsCallout()||!d.verticalOffset||b.isDraped())){a:switch(a.placement){case "above-center":b=!0;break a;default:b=!1}b?(a.verticalOffset=l(c.verticalOffset),a.anchor="bottom",a.normalizedOffset=[0,a.normalizedOffset[1],0],a.hasLabelVerticalOffset=!0):(p.error("verticalOffset","Callouts and vertical offset on labels are currently only supported with above-center label placement (not with "+a.placement+" placement)"),
a.isValid=!1)}}function l(a){return{screenLength:a.screenLength,minWorldLength:a.minWorldLength,maxWorldLength:a.maxWorldLength}}Object.defineProperty(h,"__esModule",{value:!0});var p=e.getLogger("esri.views.3d.layers.graphics.labelPlacement"),m=null;h.get=function(b){var d=b.labelClass.labelPlacement,f=r[d];f||(null!=d&&null==m&&(p.warn("labelPlacement","'"+d+"' is not a valid label placement"),m=a.schedule(function(){m.remove();m=null})),f=r["default"]);var d=b.graphics3DGraphic._graphics[0],e=
d.graphics3DSymbolLayer.getGraphicElevationContext(b.graphics3DGraphic.graphic),f={placement:f.placement,anchor:f.anchor,normalizedOffset:f.normalizedOffset,needsOffsetAdjustment:"draped"===d.type?void 0:e.hasOffsetAdjustment,verticalOffset:null,screenOffset:[0,0],centerOffset:[0,0,0,-1],centerOffsetUnits:"world",translation:[0,0,0],elevationOffset:0,hasLabelVerticalOffset:!1,isValid:!0};n(f,b);c(f,b);return f};var r={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},
"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},
"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},t={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],
"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};q=function(a){var b=r[a];t[a].forEach(function(a){r[a]=b})};for(var u in t)q(u);Object.freeze&&(Object.freeze(r),Object.keys(r).forEach(function(a){Object.freeze(r[a]);Object.freeze(r[a].normalizedOffset)}));var x=[0,0],v=[0,0]})},"esri/views/3d/webgl-engine/lib/MaterialCollection":function(){define(["require","exports",
"./ModelContentType"],function(q,h,e){return function(){function a(a){this.materials={};this.stage=a}a.prototype.getMaterial=function(a){return this.materials[a]};a.prototype.addMaterial=function(a,b){this.materials[a]=b;this.stage.add(e.MATERIAL,b)};a.prototype.dispose=function(){for(var a in this.materials)this.stage.remove(e.MATERIAL,this.materials[a].id);this.materials={}};return a}()})},"esri/views/3d/webgl-engine/lib/TextTextureAtlas":function(){define("require exports ../../../../core/arrayUtils ./ModelContentType ./Texture ./Util ../../../webgl/Texture".split(" "),
function(q,h,e,a,d,b,g){return function(){function c(b,c){this.dirty=!1;this.elementsToAdd={};this.elementsToRemove={};this.elementsToRender={};this.elements={};this.stageObjects={};this.id=d.idGen.gen(b);this.stage=c._stage;this.controller=c.resourceController;this.canvas=this.create2DCanvas();this.ctx=this.canvas.getContext("2d");this.stage.add(a.TEXTURE,this);b=this.computeAtlasResolution(c.width,c.height);this.createAtlasRegion(b);this.update2DCanvasSize()}c.prototype.setUnloadFunc=function(a){this.unloadFunc=
a};c.prototype.unload=function(){null!=this.unloadFunc&&(this.unloadFunc(this.id),this.unloadFunc=null)};c.prototype.deferredLoading=function(){return!1};c.prototype.getWidth=function(){return this.atlas.size.width};c.prototype.getHeight=function(){return this.atlas.size.height};c.prototype.initializeThroughRender=function(a,b){b.wrapMode=33071;b.samplingMode=9987;b.flipped=!0;b.preMultiplyAlpha=!0;b.hasMipmap=!0;return this.glTexture=new g(a,b,this.canvas)};c.prototype.dispose=function(){this.elementsToRender=
this.elementsToRemove=this.elementsToAdd=this.elements=null;this.glTexture&&(this.glTexture=null,this.stage.remove(a.TEXTURE,this.id))};c.prototype.create2DCanvas=function(){var a=document.createElement("canvas");a.setAttribute("id","canvas2d");a.setAttribute("style","display:none");a.setAttribute("width",(512).toString());a.setAttribute("height",(512).toString());return a};c.prototype.update2DCanvasSize=function(){this.canvas.setAttribute("width",this.atlas.size.width.toString());this.canvas.setAttribute("height",
this.atlas.size.height.toString())};c.prototype.generateTextId=function(a){return JSON.stringify(a.getParams())+"_"+a.getText()};c.prototype.createAtlasRegion=function(a){void 0===a&&(a=512);this.atlas={size:{width:a,height:a},cursor:{x:0,y:0},lineHeight:0}};c.prototype.computeAtlasResolution=function(a,c){a=Math.max(a,c);a=b.nextHighestPowerOfTwo(a+256);return a=Math.min(a,4096)};c.prototype.resizeAtlas=function(a,b){b=b||a;var c=this.atlas;c.size.width=a;c.size.height=b;this.glTexture&&this.glTexture.resize(a,
b);this.update2DCanvasSize()};c.prototype.resetAtlasCursor=function(){var a=this.atlas;a.cursor.x=0;a.cursor.y=0;a.lineHeight=0};c.prototype.getAtlasUsage=function(){var a=this.atlas;return(a.cursor.x+a.cursor.y*a.size.width)/(a.size.width*a.size.height)};c.prototype.getExpectedAtlasUsage=function(){var a=Object.keys(this.elementsToRemove).length,b=Object.keys(this.elementsToAdd).length,c=Object.keys(this.elements).length;return this.getAtlasUsage()/c*(c+b-a)};c.prototype.addAtlasElement=function(a,
b,c,d,e){var f=this.atlas;a.placement.offset.x=f.cursor.x;a.placement.offset.y=f.cursor.y;a.placement.size.width=b;a.placement.size.height=c;a.placement.uvMinMax=[a.placement.offset.x/f.size.width,1-(a.placement.offset.y+c)/f.size.height,(a.placement.offset.x+b)/f.size.width,1-a.placement.offset.y/f.size.height];f.cursor.x+=d;f.lineHeight=Math.max(f.lineHeight,e)};c.prototype.removeAtlasElement=function(a){if(a&&this.elements[a.textId]){var b=a.placement.offset,c=a.placement.size;this.ctx.clearRect(b.x,
b.y,c.width,c.height);delete this.elements[a.textId]}};c.prototype.addStageObject=function(a,b){this.stageObjects[a]||(this.stageObjects[a]=[]);-1===this.stageObjects[a].indexOf(b)&&this.stageObjects[a].push(b)};c.prototype.removeStageObject=function(a,b){this.stageObjects[a]&&e.removeUnordered(this.stageObjects[a],b)&&(b.geometries[0].data.vertexAttributes.size.data=new Float32Array([0,0]),b.geometryVertexAttrsUpdated(0))};c.prototype.processAdditionRequest=function(a){var b=this.atlas,c=a.textId,
d=a.textTexture.renderedWidth,f=a.textTexture.renderedHeight,e=d+2,g=f+2+2;if(b.cursor.x+e<b.size.width&&b.cursor.y+g<b.size.height)this.addAtlasElement(a,d,f,e,g),this.elements[c]=a,this.elementsToRender[c]=a,delete this.elementsToAdd[c];else if(b.cursor.y+g+b.lineHeight<b.size.height)b.cursor.x=2,b.cursor.y+=b.lineHeight,b.lineHeight=0,this.addAtlasElement(a,d,f,e,g),this.elements[c]=a,this.elementsToRender[c]=a,delete this.elementsToAdd[c];else{a=this.getExpectedAtlasUsage();.85<a&&4096>b.size.width&&
this.resizeAtlas(2*b.size.width,2*b.size.height);for(var h in this.elementsToRemove)0===this.stageObjects[h].length&&this.removeAtlasElement(this.elementsToRemove[h]),delete this.elementsToRemove[h];if(!(.95<a&&4096===b.size.width)){for(var u in this.elements)b=this.elements[u],b.rendered=!1,this.elementsToAdd[u]=b,delete this.elements[u];this.resetAtlasCursor();this.elementsToRender={}}}};c.prototype.processRenderingRequest=function(a){var b=a.textId;this.ctx.clearRect(a.placement.offset.x,a.placement.offset.y,
a.placement.size.width,a.placement.size.height);a.textTexture.renderText(a.placement.size.width,a.placement.size.height,this.ctx,a.placement.offset.x,a.placement.offset.y);for(var c=0,b=this.stageObjects[b];c<b.length;c++){var d=b[c];d.geometries[0].data.vertexAttributes.uv0.data=new Float32Array(a.placement.uvMinMax);d.geometries[0].data.vertexAttributes.size.data=new Float32Array([a.placement.size.width,a.placement.size.height]);d.geometryVertexAttrsUpdated(0)}a.rendered=!0};c.prototype.run=function(a){if(this.dirty){for(var b in this.elementsToAdd)if(this.elements[b]&&
this.elements[b].rendered){for(var c=0,d=this.stageObjects[b];c<d.length;c++){var f=d[c],e=f.geometries[0].data.vertexAttributes;e.uv0.data=new Float32Array(this.elements[b].placement.uvMinMax);e.size.data=new Float32Array([this.elements[b].placement.size.width,this.elements[b].placement.size.height]);f.geometryVertexAttrsUpdated(0)}delete this.elementsToAdd[b]}else this.processAdditionRequest(this.elementsToAdd[b]);c=!1;for(b in this.elementsToRender){if(!a.remaining()){c&&this.glTexture.setData(this.canvas);
return}this.processRenderingRequest(this.elementsToRender[b]);delete this.elementsToRender[b];c=!0}c&&this.glTexture.setData(this.canvas);this.dirty=!1;this.frameWorker.remove();this.frameWorker=null}};c.prototype.addTextTexture=function(a,b){var c=this.generateTextId(a);this.elementsToAdd[c]||(this.elementsToAdd[c]={textId:c,placement:{offset:{x:0,y:0},size:{width:0,height:0},uvMinMax:[]},textTexture:a,rendered:!1});this.addStageObject(c,b);delete this.elementsToRemove[c];this.setDirty()};c.prototype.removeTextTexture=
function(a,b){a=this.generateTextId(a);this.elementsToRemove[a]=this.elements[a];this.removeStageObject(a,b);delete this.elementsToAdd[a]};Object.defineProperty(c.prototype,"textureId",{get:function(){return this.id},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"isDirty",{get:function(){return this.dirty},enumerable:!0,configurable:!0});c.prototype.setDirty=function(){var a=this;this.dirty||(this.dirty=!0,this.frameWorker=this.controller.registerFrameWorker(function(b){return a.run(b)}))};
return c}()})},"esri/views/3d/layers/support/FeatureTileTree3D":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Collection ../../../../core/Handles ../../../../core/Logger ../../../../core/throttle ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/support/aaBoundingRect ./FeatureTileDescriptor3D ./FeatureTileMeasurements3D ../../support/projectionUtils".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r){Object.defineProperty(h,"__esModule",{value:!0});var t=c.getLogger("esri.views.3d.layers.support.FeatureTileFetcher3D");q=function(c){function d(a){a=c.call(this,a)||this;a.tiles=new b;a.tileSize=512;a.disableThrottling=!1;a.idToTile=new Map;a.handles=new g;a.clients=new Set;a.geometryEnginePromise=null;return a}e(d,c);Object.defineProperty(d.prototype,"tilingScheme",{get:function(){var a=this.tilingSchemeOwner.tilingScheme;return a?a.clone():null},enumerable:!0,
configurable:!0});Object.defineProperty(d.prototype,"filterExtent",{set:function(a){if(a&&!a.spatialReference.equals(this.viewState.spatialReference))t.error("#extent","extent spatial reference needs to be in the same spatial reference as the view");else{var b=this._get("filterExtent");b===a||b&&a&&b.equals(a)||(a=a?a.clone():null,this._set("filterExtent",a),this.update())}},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"filterExtentRect",{get:function(){if(!this.filterExtent||
!this.tilingScheme)return null;var a=l.create();r.extentToBoundingRect(this.filterExtent,a,this.tilingScheme.spatialReference);return a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"rootTileIds",{get:function(){return this.filterExtentRect?this.tilingScheme.rootTilesInExtent(this.filterExtentRect):[[0,0,0]]},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"suspended",{set:function(a){a!==this._get("suspended")&&(this._set("suspended",a),a||this.update())},enumerable:!0,
configurable:!0});Object.defineProperty(d.prototype,"updating",{get:function(){return this.throttledUpdate.hasPendingUpdates()||null!=this.geometryEnginePromise},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"changeId",{get:function(){var a=this._get("changeId")||0;return!this.hasClients||this.suspended?a:a+1},enumerable:!0,configurable:!0});d.prototype.initialize=function(){var a=this;this.throttledUpdate=f.throttle(this.update,function(){return a.notifyChange("updating")},1E3,
this);var b=this.disableThrottling?function(){return a.update}:this.throttledUpdate;this.handles.add(this.watch(["tilingScheme","tileSize"],function(){return a.tileMeasurements=null},!0));this.handles.add(k.init(this,"changeId",b))};d.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};d.prototype.addClient=function(){var a=this,b=u++;this.clients.add(b);1===this.clients.size&&this.update();return{remove:function(){return a.removeClient(b)}}};d.prototype.removeClient=
function(a){this.clients.delete(a);this.hasClients||this.update()};Object.defineProperty(d.prototype,"hasClients",{get:function(){return 0<this.clients.size},enumerable:!0,configurable:!0});d.prototype.update=function(){if(!this.suspended)if(this.tilingScheme&&this.hasClients){this.tileMeasurements||(this.tileMeasurements=new m.FeatureTileMeasurements3D({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize,maxVerticalScreenSize:v}));var a=this.cameraOnSurface.location;
this.tileMeasurements.begin(this.viewState.camera,this.focus?this.focus.locationOnSurface:a,a.z);this.updateTiles(this.subdivideTilesForView(this.getRootTiles()));this.tileMeasurements.end()}else this.tiles.removeAll(),this.idToTile.clear();this.notifyChange("updating")};d.prototype.getRootTiles=function(){var a=this;return this.rootTileIds.map(function(b){return new p.FeatureTileDescriptor3D(b[0],b[1],b[2],a.tilingScheme)})};d.prototype.purgeHorizonTiles=function(a){a.sort(function(a,b){return b.measures.screen.rect[1]-
a.measures.screen.rect[1]});l.empty(x);for(var b=0;b<a.length;b++)if(l.expand(x,a[b].measures.screen.rect),l.height(x)>v)return a.slice(b);return[]};d.prototype.subdivideTilesForView=function(a){a=a.slice();for(var b=[];0<a.length;){var c=a.pop();if(!this.filterExtentRect||l.intersects(this.filterExtentRect,c.extent))this.tileMeasurements.updateTile(c),0!==c.measures.visibility&&(c.measures.shouldSplit?(this.tilingScheme.ensureMaxLod(c.lij[0]+1),a.push.apply(a,c.getChildren())):b.push(c))}return this.purgeHorizonTiles(b)};
d.prototype.updateTiles=function(a){for(var b=this,c=0,d=this.tiles.items;c<d.length;c++)d[c].used=!1;a=a.filter(function(a){var c=b.idToTile.get(a.id);c?(c.copyMeasurementsFrom(a),c.used=!0):b.idToTile.set(a.id,a);return!c});c=this.tiles.items.filter(function(a){if(a.used)return!1;b.idToTile.delete(a.id);return!0});this.tiles.removeMany(c);this.tiles.addMany(a);this.sortTiles()};d.prototype.sortTiles=function(){this.tiles.sort(function(a,b){return a.measures.visibility!==b.measures.visibility?2===
a.measures.visibility?-1:1:a.measures.distance-b.measures.distance});this.tiles.forEach(function(a,b){return a.loadPriority=b})};a([n.property({constructOnly:!0})],d.prototype,"renderCoordsHelper",void 0);a([n.property({constructOnly:!0})],d.prototype,"tilingSchemeOwner",void 0);a([n.property({constructOnly:!0})],d.prototype,"cameraOnSurface",void 0);a([n.property({constructOnly:!0})],d.prototype,"focus",void 0);a([n.property({constructOnly:!0})],d.prototype,"viewState",void 0);a([n.property()],d.prototype,
"tiles",void 0);a([n.property()],d.prototype,"tileSize",void 0);a([n.property({readOnly:!0,dependsOn:["tilingSchemeOwner.tilingScheme"]})],d.prototype,"tilingScheme",null);a([n.property()],d.prototype,"filterExtent",null);a([n.property({readOnly:!0,dependsOn:["filterExtent","tilingScheme"]})],d.prototype,"filterExtentRect",null);a([n.property({readOnly:!0,dependsOn:["filterExtentRect"]})],d.prototype,"rootTileIds",null);a([n.property({value:!1})],d.prototype,"suspended",null);a([n.property()],d.prototype,
"updating",null);a([n.property({readOnly:!0,dependsOn:["tileSize","cameraOnSurface.location","tilingScheme","viewState.camera","focus.locationOnSurface"]})],d.prototype,"changeId",null);a([n.property({constructOnly:!0})],d.prototype,"disableThrottling",void 0);return d=a([n.subclass()],d)}(n.declared(d));h.FeatureTileTree3D=q;var u=0,x=l.create(),v=10;h.default=q})},"esri/core/throttle":function(){define(["require","exports"],function(q,h){function e(a,d,b,e){var c=null,f=1E3;"number"===typeof d?
(f=d,e=b):(c=d,f=b);var g=0,h,l=function(){g=0;a.apply(e,h)};d=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];c&&c.apply(e,a);h=a;f?g||(g=setTimeout(l,f)):l()};d.remove=function(){g&&(clearTimeout(g),g=0)};d.forceUpdate=function(){g&&(clearTimeout(g),l())};d.hasPendingUpdates=function(){return!!g};return d}Object.defineProperty(h,"__esModule",{value:!0});h.throttle=e;h.default=e})},"esri/views/3d/layers/support/FeatureTileDescriptor3D":function(){define(["require","exports",
"../../../../geometry/support/aaBoundingRect"],function(q,h,e){Object.defineProperty(h,"__esModule",{value:!0});q=function(){function a(a,b,g,c){void 0===c&&(c=null);this.lij=[0,0,0];this.extent=e.create();this.loadPriority=this.resolution=0;this.measures={visibility:2,screen:{rect:e.create()},distance:0,shouldSplit:!1};this.used=!1;c&&this.acquire(a,b,g,c)}a.prototype.acquire=function(d,b,e,c){this.tilingScheme=c;this.id=a.id(d,b,e);this.lij[0]=d;this.lij[1]=b;this.lij[2]=e;c.getExtent(d,b,e,this.extent);
this.resolution=c.resolutionAtLevel(d)};a.prototype.release=function(){this.tilingScheme=null};a.prototype.getChildren=function(d){var b=this.lij[0]+1,e=2*this.lij[1],c=2*this.lij[2];return d?(d[0].acquire(b,e,c,this.tilingScheme),d[1].acquire(b,e+1,c,this.tilingScheme),d[2].acquire(b,e,c+1,this.tilingScheme),d[3].acquire(b,e+1,c+1,this.tilingScheme),d):[new a(b,e,c,this.tilingScheme),new a(b,e+1,c,this.tilingScheme),new a(b,e,c+1,this.tilingScheme),new a(b,e+1,c+1,this.tilingScheme)]};a.prototype.copyMeasurementsFrom=
function(a){this.measures.visibility=a.measures.visibility;this.measures.shouldSplit=a.measures.shouldSplit;this.measures.distance=a.measures.distance;e.set(a.measures.screen.rect,this.measures.screen.rect)};a.id=function(a,b,e){return a+"/"+b+"/"+e};return a}();h.FeatureTileDescriptor3D=q;h.default=q})},"esri/views/3d/layers/support/FeatureTileMeasurements3D":function(){define("require exports ../../../../geometry/support/aaBoundingRect ./FeatureTileVisibility3D ../../lib/glMatrix ../../support/geometryUtils".split(" "),
function(q,h,e,a,d,b){Object.defineProperty(h,"__esModule",{value:!0});q=function(){function h(b){this.pointOfInterestInMap=[0,0];this.screenRect=e.create();this.tileSize=b.tileSize;this.maxVerticalScreenSize=b.maxVerticalScreenSize;this.renderCoordsHelper=b.renderCoordsHelper;this.tilingScheme=b.tilingScheme;this.visibility=new a.FeatureTileVisibility3D({renderCoordsHelper:b.renderCoordsHelper})}h.prototype.begin=function(a,b,c){this.camera=a;this.z=c;this.pointOfInterestInMap[0]=b.x;this.pointOfInterestInMap[1]=
b.y;e.fromValues(0,0,a.fullWidth,a.fullHeight,this.screenRect);this.visibility.begin(a,c)};h.prototype.end=function(){this.visibility.end()};h.prototype.updateTile=function(a){a.measures.visibility=this.visibility.calculate(a);0!==a.measures.visibility&&this.updateScreenMeasure(a);this.updateDistanceMeasure(a)};h.prototype.updateDistanceMeasure=function(a){a.measures.distance=e.distance(a.extent,this.pointOfInterestInMap)};h.prototype.updateScreenMeasure=function(a){var b=f,c=1<<b,d=a.measures.screen.rect;
e.empty(d);for(var g=0,k=a.lij[0]+b,h=a.lij[1]<<b,b=a.lij[2]<<b,l=this.tileSizeWithBias(a),l=l*l,m=!1,n=0;n<c;n++){for(var p=0;p<c&&!(m=this.computeScreenArea(a,k,h+n,b+p,d),g+=m.area,m=g>l&&e.height(d)>this.maxVerticalScreenSize);p++);if(m)break}a.measures.shouldSplit=g>l};h.prototype.tileSizeWithBias=function(a){return 1===a.measures.visibility?this.tileSize*k:this.tileSize};h.prototype.computeScreenArea=function(a,d,f,k,h){var l=n.points;this.projectToScreen(d,f,k,1===a.measures.visibility,l);
e.empty(g);for(a=0;4>a;a++)e.expandPointInPlace(g,l[a]);e.expand(h,g);e.intersection(g,this.screenRect,c);n.screenOverlap=e.area(c)/e.area(g);n.area=b.triangle.areaPoints2d(l[0],l[1],l[2])+b.triangle.areaPoints2d(l[0],l[2],l[3]);return n};h.prototype.projectToScreen=function(a,b,c,d,f){this.tilingScheme.ensureMaxLod(a);this.tilingScheme.getExtent(a,b,c,l);this.toRenderCoords(l,0,3,m[0]);this.toRenderCoords(l,2,3,m[1]);this.toRenderCoords(l,2,1,m[2]);this.toRenderCoords(l,0,1,m[3]);d&&(this.projectToPlane(m,
this.camera.frustumPlanes[4]),this.projectToPlane(m,this.camera.frustumPlanes[3]),this.projectToPlane(m,this.camera.frustumPlanes[2]));for(a=0;4>a;a++)this.camera.projectPoint(m[a],f[a])};h.prototype.projectToPlane=function(a,c){for(var f=0;4>f;f++)r[f]=b.plane.distance(c,a[f]);f=Math.max(r[0],r[1],r[2],r[3]);if(0<f)for(c=d.vec3d.scale(c,-f,p),f=0;4>f;f++)d.vec3d.add(a[f],c)};h.prototype.toRenderCoords=function(a,b,c,d){p[0]=a[b];p[1]=a[c];p[2]=this.z;this.renderCoordsHelper.toRenderCoords(p,this.tilingScheme.spatialReference,
d);return d};return h}();h.FeatureTileMeasurements3D=q;var g=e.create(),c=e.create(),f=2,k=5,n={points:[d.vec3d.create(),d.vec3d.create(),d.vec3d.create(),d.vec3d.create()],area:0,screenOverlap:0},l=e.create(),p=d.vec3d.create(),m=[d.vec3d.create(),d.vec3d.create(),d.vec3d.create(),d.vec3d.create()],r=[0,0,0,0];h.default=q})},"esri/views/3d/layers/support/FeatureTileVisibility3D":function(){define("require exports ../../../../core/ObjectPool ./FeatureTileDescriptor3D ../../lib/glMatrix ../../state/Frustum ../../support/FrustumExtentIntersection ../../support/geometryUtils ../../support/mathUtils".split(" "),
function(q,h,e,a,d,b,g,c,f){Object.defineProperty(h,"__esModule",{value:!0});q=function(){function a(a){this.surfaceElevation=0;this.cache=new Map;a=a.renderCoordsHelper;this.frustum=new b.Frustum({renderCoordsHelper:a});this.extendedFrustum=new b.Frustum({renderCoordsHelper:a});this.intersector=new g.FrustumExtentIntersection({renderCoordsHelper:a});this.renderCoordsHelper=a}a.prototype.begin=function(a,b){this.surfaceElevation=b;this.aboveGround=this.renderCoordsHelper.getAltitude(a.eye)>b;this.frustum.update(a);
this.shortenFrustumFarPlane(this.frustum);this.updateExtendedFrustum(a,b)};a.prototype.end=function(){this.cache.clear()};a.prototype.calculate=function(a){if(this.allTilesInvisible)return 0;var b="global"===this.renderCoordsHelper.type&&a.lij[0]>=k&&a.lij[0]<n,c=this.getOrCalculateSingleTileVisibility(a,!b);return 0!==c&&b?this.calculateAggregatedChildrenVisibility(a):c};a.prototype.shortenFrustumFarPlane=function(a){for(var c=a.points,f=0,e=b.Frustum.nearFarLineIndices;f<e.length;f++){var g=e[f],
k=g[1],g=c[g[0]];d.vec3d.add(g,d.vec3d.scale(d.vec3d.subtract(c[k],g,m),p),c[k])}a.updatePoints(c)};a.prototype.calculateAggregatedChildrenVisibility=function(a){var b=0,c=this.cache.get(a.id);if(null!=c)return c;c=r.acquire();a.getChildren(c);for(var d=0;d<c.length;d++){var f=this.calculate(c[d]);if(0!==f&&(b=f,2===f))break}r.release(c);this.cache.set(a.id,b);return b};a.prototype.getOrCalculateSingleTileVisibility=function(a,b){var c=this.cache.get(a.id);if(null!=c)return c;c=this.calculateSingleTileVisibility(a);
b&&this.cache.set(a.id,c);return c};a.prototype.calculateSingleTileVisibility=function(a){if(!this.aboveGround&&"global"===this.renderCoordsHelper.type&&a.lij[0]<l){if(0===this.calculateSingleTileVisibilitySided(a,!1))return this.calculateSingleTileVisibilitySided(a,!0)}else return this.calculateSingleTileVisibilitySided(a,this.aboveGround)};a.prototype.calculateSingleTileVisibilitySided=function(a,b){this.intersector.update(a.extent,a.tilingScheme.spatialReference,this.surfaceElevation,b);return this.intersector.isVisibleInFrustum(this.extendedFrustum)?
this.intersector.isVisibleInFrustum(this.frustum,!0)?2:1:0};a.prototype.updateExtendedFrustum=function(a,b){var e=this.renderCoordsHelper;this.extendedFrustum.update(a);this.shortenFrustumFarPlane(this.extendedFrustum);var g=this.renderCoordsHelper.worldUpAtPosition(a.eye,m);this.aboveGround||d.vec3d.negate(g);g=f.acos(-d.vec3d.dot(g,a.viewForward));this.allTilesInvisible=g>(Math.PI+a.fovY)/2;if(!this.allTilesInvisible&&(this.hasExtendedFrustum=g>a.fovY/2)){a=this.extendedFrustumParameters(b);b=this.extendedFrustum.points;
for(g=0;4>g;g++){var k=a.pointIndices[g],h=b[k],l=e.getAltitude(h);if(a.needsAltitudeAdjustment(l)){this.renderCoordsHelper.worldUpAtPosition(h,m);switch(k){case 4:case 7:case 0:case 3:c.plane.projectVector(this.extendedFrustum.planes[0],m);break;case 5:case 6:case 1:case 2:c.plane.projectVector(this.extendedFrustum.planes[1],m)}d.vec3d.scale(m,a.direction);this.renderCoordsHelper.intersectManifold(h,m,a.zWithMargin,h)}}this.extendedFrustum.updatePoints(b);0>d.vec3d.dot(this.extendedFrustum.planes[4],
this.frustum.planes[4])&&(e=this.extendedFrustum.points,this.aboveGround?(a=[e[1],e[0]],e[0]=a[0],e[1]=a[1]):(a=[e[2],e[3]],e[3]=a[0],e[2]=a[1]),this.extendedFrustum.updatePoints(e))}};a.prototype.extendedFrustumParameters=function(a){return this.aboveGround?this.extendedFrustumParametersAboveSurface(a,1):this.extendedFrustumParametersBelowSurface(a,1)};a.prototype.extendedFrustumParametersAboveSurface=function(a,c){var d=a-c;return{zWithMargin:d,pointIndices:b.Frustum.planePointIndices.bottom,direction:-1,
needsAltitudeAdjustment:function(a){return a>d}}};a.prototype.extendedFrustumParametersBelowSurface=function(a,c){var d=a+c;return{zWithMargin:d,pointIndices:b.Frustum.planePointIndices.top,direction:1,needsAltitudeAdjustment:function(a){return a<d}}};return a}();h.FeatureTileVisibility3D=q;var k=2,n=6,l=12,p=.95,m=d.vec3d.create(),r=new e(Array,function(b){4!==b.length&&(b[0]=new a.FeatureTileDescriptor3D,b[1]=new a.FeatureTileDescriptor3D,b[2]=new a.FeatureTileDescriptor3D,b[3]=new a.FeatureTileDescriptor3D)},
function(a){a[0].release();a[1].release();a[2].release();a[3].release()});h.default=q})},"esri/views/3d/state/Frustum":function(){define("require exports ../lib/glMatrix ../support/geometryUtils ../support/intersectionUtils ../webgl-engine/lib/Util".split(" "),function(q,h,e,a,d,b){Object.defineProperty(h,"__esModule",{value:!0});q=function(){function g(b){this.planes=Array(6);this.points=Array(8);this.lines=Array(12);this.origin=e.vec3d.create();this.direction=e.vec3d.create();this._altitude=null;
this.renderCoordsHelper=b?b.renderCoordsHelper:null;for(b=0;6>b;b++)this.planes[b]=a.plane.create();for(b=0;8>b;b++)this.points[b]=e.vec3d.create();for(b=0;12>b;b++)this.lines[b]={origin:null,direction:e.vec3d.create(),endpoint:null}}g.prototype.update=function(a){b.matrixToFrustumPoints(a.viewMatrix,a.projectionMatrix,this.points);this.updatePoints(this.points);e.vec3d.set(a.eye,this.origin);e.vec3d.set(a.viewForward,this.direction);this._altitude=this.renderCoordsHelper.getAltitude(this.origin);
this.updateLines()};g.prototype.updatePoints=function(a){if(a!==this.points)for(var c=0;c<this.points.length;c++)e.vec3d.set(a[c],this.points[c]);b.frustumPointsToPlanes(this.points,this.planes);this.updateLines()};Object.defineProperty(g.prototype,"altitude",{get:function(){return this._altitude},enumerable:!0,configurable:!0});g.prototype.intersectsSphere=function(a,b){return d.frustumSphere(this.planes,a,b)};g.prototype.intersectsRay=function(a,b,e){return d.frustumRay(this.planes,a,b,e)};g.prototype.intersectsLineSegment=
function(a,b,e){return d.frustumLineSegment(this.planes,a,b,e)};g.prototype.intersectsPoint=function(a){return d.frustumPoint(this.planes,a)};g.prototype.updateLines=function(){for(var a=0;4>a;a++){var b=a,d=a+4;this.updateLine(this.lines[a],this.points[b],this.points[d]);this.updateLine(this.lines[a+4],this.points[b],3===a?this.points[0]:this.points[b+1]);this.updateLine(this.lines[a+8],this.points[d],3===a?this.points[4]:this.points[d+1])}};g.prototype.updateLine=function(a,b,d){a.origin=b;a.endpoint=
d;e.vec3d.direction(d,b,a.direction)};g.planePointIndices={bottom:[5,1,0,4],near:[0,1,2,3],far:[5,4,7,6],right:[1,5,6,2],left:[4,0,3,7],top:[7,3,2,6]};g.nearFarLineIndices=[[0,4],[1,5],[2,6],[3,7]];return g}();h.Frustum=q;h.default=q})},"esri/views/3d/support/FrustumExtentIntersection":function(){define("require exports ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../lib/glMatrix ./earthUtils ./geometryUtils ./intersectionUtils ./mathUtils ./projectionUtils".split(" "),
function(q,h,e,a,d,b,g,c,f,k){Object.defineProperty(h,"__esModule",{value:!0});q=.5*Math.PI;var n=q/Math.PI*180,l=q*b.earthRadius,p=.9*b.earthRadius;b=function(){function b(a){this.renderCoordsHelper=a.renderCoordsHelper;this.extent=Array(4);this.planes=Array(6);this.maxSpan=0;this.center={origin:d.vec3d.create(),direction:d.vec3d.create()};for(a=0;4>a;a++)this.extent[a]={origin:d.vec3d.create(),direction:d.vec3d.create(),cap:{next:null,direction:d.vec3d.create()}},this.planes[a]=g.plane.create();
this.planes[4]=g.plane.create();this.planes[5]=g.plane.create();this.planesWithoutFar=this.planes.slice(0,5)}b.prototype.update=function(a,b,c,f){void 0===f&&(f=!0);var e=this.extent;this.toRenderBoundingExtent(a,b,c);d.vec3d.add(e[0].origin,e[2].origin,this.center.origin);d.vec3d.scale(this.center.origin,.5);this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction);f||d.vec3d.scale(this.center.direction,-1);for(c=0;4>c;c++){var k=e[c];this.renderCoordsHelper.worldUpAtPosition(k.origin,
k.direction);var h=e[3===c?0:c+1];k.cap.next=h.origin;d.vec3d.direction(h.origin,k.origin,k.cap.direction);g.plane.fromVectorsAndPoint(k.direction,k.cap.direction,k.origin,this.planes[c]);f||d.vec3d.scale(k.direction,-1)}g.plane.fromVectorsAndPoint(e[0].cap.direction,e[1].cap.direction,e[0].origin,this.planes[4]);f?g.plane.negate(this.planes[4],this.planes[5]):(g.plane.set(this.planes[5],this.planes[4]),g.plane.negate(this.planes[4]));this.maxSpan=Math.max(Math.abs(a[0]-a[2]),Math.abs(a[1]-a[3]));
this.maxSpanSpatialReference=b};b.prototype.isVisibleInFrustum=function(a,b){void 0===b&&(b=!1);if("global"===this.renderCoordsHelper.type){if(this.maxSpan>(this.maxSpanSpatialReference.isWGS84?n:l))return!0;if(a.altitude>=p)return this.isVisibleInFrustumGlobal(a)}for(var d=0;d<this.extent.length;d++){var f=this.extent[d];if(!b&&a.intersectsRay(f.origin,null,f.direction)||a.intersectsLineSegment(f.origin,f.cap.next,f.cap.direction))return!0}b=b?this.planes:this.planesWithoutFar;for(d=0;d<a.lines.length;d++)if(f=
a.lines[d],c.frustumLineSegment(b,f.origin,f.endpoint,f.direction))return!0;return!1};b.prototype.toRenderBoundingExtentGlobal=function(b,c,g){a.center(b,r);r[2]=g;k.computeLinearTransformation(c,r,t,this.renderCoordsHelper.spatialReference);d.mat4d.inverse(t,u);e.empty(x);for(var h=0,l=m;h<l.length;h++)for(var n=l[h],p=n.x0,v=n.x1,q=n.y0,n=n.y1,A=0;5>A;A++){var y=A/4;r[0]=f.lerp(b[p],b[v],y);r[1]=f.lerp(b[q],b[n],y);r[2]=g;k.vectorToVector(r,c,r,this.renderCoordsHelper.spatialReference);d.mat4d.multiplyVec3(u,
r);e.expandPointInPlace(x,r)}d.mat4d.multiplyVec3(t,d.vec3d.set3(x[0],x[1],x[2],this.extent[0].origin));d.mat4d.multiplyVec3(t,d.vec3d.set3(x[3],x[1],x[2],this.extent[1].origin));d.mat4d.multiplyVec3(t,d.vec3d.set3(x[3],x[4],x[2],this.extent[2].origin));d.mat4d.multiplyVec3(t,d.vec3d.set3(x[0],x[4],x[2],this.extent[3].origin))};b.prototype.toRenderBoundingExtentLocal=function(a,b,c){d.vec3d.set3(a[0],a[1],c,this.extent[0].origin);d.vec3d.set3(a[2],a[1],c,this.extent[1].origin);d.vec3d.set3(a[2],a[3],
c,this.extent[2].origin);d.vec3d.set3(a[0],a[3],c,this.extent[3].origin)};b.prototype.toRenderBoundingExtent=function(a,b,c){switch(this.renderCoordsHelper.type){case "global":this.toRenderBoundingExtentGlobal(a,b,c);break;case "local":this.toRenderBoundingExtentLocal(a,b,c)}};b.prototype.isVisibleInFrustumGlobal=function(a){if(0>d.vec3d.dot(this.center.direction,a.direction))return!0;for(var b=0;4>b;b++)if(0>d.vec3d.dot(this.extent[b].direction,a.direction))return!0;return!1};return b}();h.FrustumExtentIntersection=
b;var m=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],r=d.vec3d.create(),t=d.mat4d.create(),u=d.mat4d.create(),x=e.create();h.default=b})},"esri/views/3d/layers/support/FeatureTileTree3DDebugger":function(){define("require exports ../../../../Graphic ../../../../core/Handles ../../../../core/watchUtils ../../../../symbols/FillSymbol3DLayer ../../../../symbols/PointSymbol3D ../../../../symbols/PolygonSymbol3D ../../../../symbols/TextSymbol3DLayer ../../support/mathUtils".split(" "),
function(q,h,e,a,d,b,g,c,f,k){Object.defineProperty(h,"__esModule",{value:!0});var n=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]];q=function(){function h(f){var e=this;this.view=f;this.graphics=[];this.handles=new a;this._enabled=!0;this.symbols=n.map(function(a){return new c(new b({material:{color:[a[0],a[1],
a[2],.6]},outline:{color:"black",size:1}}))});this.handles.add([f.featureTiles.addClient(),d.on(f.featureTiles,"tiles","change",function(){return e.update()},function(){return e.update()})])}Object.defineProperty(h.prototype,"enabled",{get:function(){return this._enabled},set:function(a){this._enabled=a;this.update()},enumerable:!0,configurable:!0});h.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.view&&(this.clear(),this.view=null)};h.prototype.update=
function(){var a=this;this.clear();if(this._enabled){var b=this.view.featureTiles,c=b.tilingScheme,d=b.tiles.toArray().sort(function(a,b){return a.loadPriority-b.loadPriority});d.forEach(function(b,h){var l=b.lij,m=l[0],n=l[1],p=l[2],u=c.getExtentGeometry(m,n,p),l=new e({geometry:u,symbol:a.symbols[m%a.symbols.length]}),r=h/(d.length-1);h=k.lerp(0,200,r);var r=k.lerp(20,6,r),t=b.loadPriority>=d.length;b=new e({geometry:u.center,symbol:new g({verticalOffset:{screenLength:40/.75},callout:{type:"line",
color:"white",border:{color:"black"}},symbolLayers:[new f({text:m+"/"+n+"/"+p+" ("+b.loadPriority+")",halo:{color:"white",size:1/.75},material:{color:[h,t?0:h,t?0:h]},size:r/.75})]})});a.graphics.push(l,b);a.view.graphics.addMany([l,b])})}};h.prototype.clear=function(){this.view.graphics.removeMany(this.graphics);this.graphics=[]};return h}();h.FeatureTileTree3DDebugger=q;h.default=q})},"esri/views/3d/state/ViewState":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ../../../views/ViewAnimation ../lib/glMatrix ./Constraints ./controllers/AnimationController ./controllers/CameraController ../support/earthUtils ../support/Evented ../support/PropertiesPool ../webgl-engine/lib/Camera".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r){Object.defineProperty(h,"__esModule",{value:!0});q=function(d){function h(a){a=d.call(this,a)||this;a.propertiesPool=new m.default({camera:r},a);a.lastSeenCameraProjectionValues=new r;a.events=new p.Evented;a.updateQueue=new v;a.processingUpdates=!1;return a}e(h,d);h.prototype.destroy=function(){this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)};h.prototype.normalizeCtorArgs=function(a){return{camera:this.createInitialCamera(a.viewingMode),
mode:a.viewingMode,spatialReference:a.spatialReference,constraints:new f.default({mode:a.viewingMode})}};Object.defineProperty(h.prototype,"animation",{get:function(){return this.cameraController instanceof k.AnimationController?this.cameraController.viewAnimation:null},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"camera",{get:function(){return this._get("camera")},set:function(a){a!==t&&t.copyFrom(a);t.markViewDirty();t.computeUp(this.mode);u.camera=t;this.events.emit("before-camera-change",
u);a=this._get("camera");this.cameraProjectionChanged(this.lastSeenCameraProjectionValues,t)&&(this.lastSeenCameraProjectionValues.copyFrom(t),x.camera=this.lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",x));a&&a.equivalent(t)||this._set("camera",this.propertiesPool.get("camera").copyFrom(t))},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"isGlobal",{get:function(){return!this.isLocal},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,
"isLocal",{get:function(){return"local"===this.mode},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"interacting",{get:function(){return!!this.cameraController&&this.cameraController.isInteractive},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"cameraController",{get:function(){return this._get("cameraController")},set:function(a){var b=this;this.stopActiveCameraController()?(a&&(a.watch("state",function(c){if(c===n.State.Finished||c===n.State.Stopped)b._set("cameraController",
null),b.updateCamera(function(b){a.onControllerEnd(b)})},!0),a.onControllerStart(this.camera)),this._set("cameraController",a)):a&&(a.state=n.State.Rejected)},enumerable:!0,configurable:!0});h.prototype.switchCameraController=function(a){this.cameraController=a;return a.state!==n.State.Rejected};h.prototype.stopActiveCameraController=function(){return this.cameraController&&!this.cameraController.stopController()?!1:!0};h.prototype.cameraChanged=function(){this.updateCamera(function(){})};h.prototype.updateCamera=
function(a){this.updateQueue.enqueue(a);this.processUpdateQueue()};h.prototype.processUpdateQueue=function(){if(0!==this.updateQueue.length&&!this.processingUpdates){this.processingUpdates=!0;var a=this.updateQueue.dequeue();t.copyFrom(this._get("camera"));a(t);this.camera=t;this.processingUpdates=!1;this.processUpdateQueue()}};h.prototype.createInitialCamera=function(a){return"global"===a?new r(c.vec3d.createFrom(4*l.earthRadius,0,0),c.vec3d.createFrom(l.earthRadius,0,0),c.vec3d.createFrom(0,0,1)):
new r(c.vec3d.createFrom(0,0,100),c.vec3d.createFrom(0,0,0),c.vec3d.createFrom(0,1,0))};h.prototype.cameraProjectionChanged=function(a,b){return a.fov!==b.fov||a.fullViewport[0]!==b.fullViewport[0]||a.fullViewport[1]!==b.fullViewport[1]||a.fullViewport[2]!==b.fullViewport[2]||a.fullViewport[3]!==b.fullViewport[3]||a.padding[0]!==b.padding[0]||a.padding[1]!==b.padding[1]||a.padding[2]!==b.padding[2]||a.padding[3]!==b.padding[3]?!0:!1};a([b.property({readOnly:!0,type:g,dependsOn:["cameraController"]})],
h.prototype,"animation",null);a([b.property({type:r})],h.prototype,"camera",null);a([b.property({constructOnly:!0})],h.prototype,"constraints",void 0);a([b.property({readOnly:!0})],h.prototype,"events",void 0);a([b.property({readOnly:!0,dependsOn:["isLocal"]})],h.prototype,"isGlobal",null);a([b.property({readOnly:!0,dependsOn:["mode"]})],h.prototype,"isLocal",null);a([b.property({constructOnly:!0})],h.prototype,"mode",void 0);a([b.property({constructOnly:!0})],h.prototype,"spatialReference",void 0);
a([b.property({readOnly:!0,dependsOn:["cameraController"]})],h.prototype,"interacting",null);a([b.property()],h.prototype,"cameraController",null);return h=a([b.subclass()],h)}(b.declared(d));h.ViewState=q;var t=new r,u={camera:null},x={camera:null},v=function(){function a(){this.data=[];this.length=this.ptr=0}a.prototype.enqueue=function(a){this.data.push(a);this.length++};a.prototype.dequeue=function(){if(0===this.length)return null;var a=this.data[this.ptr++];this.length--;0===this.length&&(this.ptr=
this.data.length=0);return a};return a}();h.default=q})},"esri/views/3d/state/ViewStateManager":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Camera ../../../Viewpoint ../../../core/Accessor ../../../core/Error ../../../core/Handles ../../../core/Logger ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../geometry/Extent ../../../geometry/Point ../../../geometry/ScreenPoint ../../../geometry/support/webMercatorUtils ../camera/constraintUtils ../camera/intersectionUtils ../lib/glMatrix ./ConstraintsManager ./Frustum ./controllers/PointToPointAnimationController ./controllers/SurfaceCollisionCorrectionController ./helpers/PickingHelper ../support/cameraUtils ../support/PropertiesPool ../support/viewpointUtils ../webgl-engine/lib/Camera ../../animation/easing".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u,x,v,A,y,C,B,D,E,J,F,M,H,I,K){Object.defineProperty(h,"__esModule",{value:!0});var O=n.getLogger("esri.views.3d.state.ViewStateManager");q=function(c){function h(a){a=c.call(this)||this;a.propertiesPool=new M.default({frustum:B.default},a);a.handles=new k;a.cameraSetByUser=!1;a.internalSetOrder=[];a.immediateGoToPromise=null;a.animatedGoToPromise=null;a.ready=!1;return a}a(h,c);Object.defineProperty(h.prototype,"camera",{get:function(){return this.ready?F.internalToExternal(this.view,
this.view.state.camera):this._get("camera")},set:function(a){this.updatePropertyBeforeReady("camera",a)||this.setStateCamera(F.externalToInternal(this.view,a),{applyConstraints:!1})||O.error("#camera\x3d","Invalid camera",a)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"center",{get:function(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")},set:function(a){this.updatePropertyBeforeReady("center",a)||(a?this.isCompatible(a)?this.setStateCamera(this.centerToCamera(a),
{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.forceUpdate():O.error("#center\x3d","Invalid center",a):O.error("#center\x3d","Center has an incompatible spatial reference (center: "+(a.spatialReference?a.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a):O.error("#center\x3d","Center may not be null or undefined"))},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"extent",{get:function(){return this.ready?F.toExtent(this.view,null,
null,null,N):this._get("extent")},set:function(a){this.updatePropertyBeforeReady("extent",a)||(a?this.isCompatible(a)?this.setStateCamera(this.extentToCamera(a),{applyConstraints:!0})||O.error("#extent\x3d","Invalid extent",a):O.error("#extent\x3d","Extent has an incompatible spatial reference (extent: "+(a.spatialReference?a.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a):O.error("#extent\x3d","Extent may not be null or undefined"))},enumerable:!0,configurable:!0});
Object.defineProperty(h.prototype,"frustum",{get:function(){var a=this.propertiesPool.get("frustum");a.renderCoordsHelper=this.view.renderCoordsHelper;a.update(this.view.state.camera);return a},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"hasInitialView",{get:function(){return!!this.view.get("map.initialViewProperties.viewpoint")},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"scale",{get:function(){if(!this.ready)return this._get("scale");var a=this.view.pointsOfInterest.centerOnContent;
return F.distanceToScale(this.view,a.distance,a.location.latitude)},set:function(a){this.updatePropertyBeforeReady("scale",a)||this.setStateCamera(this.scaleToCamera(a),{applyConstraints:!0})||O.error("#scale\x3d","Invalid scale",a)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"padding",{get:function(){if(!this.ready)return this._get("padding");var a=this.view.state.camera.padding,b=this._get("padding");return null!==b&&b.top===a[0]&&b.right===a[1]&&b.bottom===a[2]&&b.left===
a[3]?b:{top:a[0],right:a[1],bottom:a[2],left:a[3]}},set:function(a){this.updatePropertyBeforeReady("padding",a)||(a?y.vec4d.set4(a.top||0,a.right||0,a.bottom||0,a.left||0,aa):y.vec4d.set4(0,0,0,0,aa),this.view.state.updateCamera(function(a){a.padding=aa}))},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"screenCenter",{get:function(){var a=this.padding;return new u((this.view.width-(a.left+a.right))/2+a.left,(this.view.height-(a.top+a.bottom))/2+a.top)},enumerable:!0,configurable:!0});
Object.defineProperty(h.prototype,"viewpoint",{get:function(){return this.ready?H.fromCamera(this.view,this.camera):this._get("viewpoint")},set:function(a){if(!this.updatePropertyBeforeReady("viewpoint",a))if(a)if(this.isCompatible(a))this.setStateCamera(this.viewpointToCamera(a),{applyConstraints:!a.camera})||O.error("#viewpoint\x3d","Invalid viewpoint",a);else{var b=a.camera?a.camera.position:a.targetGeometry,b=b&&b.spatialReference;O.error("#viewpoint\x3d","Viewpoint has an incompatible spatial reference (viewpoint: "+
(b?b.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a)}else O.error("#viewpoint\x3d","Viewpoint may not be null or undefined")},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"zoom",{get:function(){return this.ready?F.scaleToZoom(this.view,this.scale):this._get("zoom")},set:function(a){this.updatePropertyBeforeReady("zoom",a)||this.setStateCamera(this.zoomToCamera(a),{applyConstraints:!0})||O.error("#zoom\x3d","Invalid zoom",a)},enumerable:!0,configurable:!0});h.prototype.initialize=
function(){var a=this;this.pickingHelper=new J.PickingHelper(this.view);this.handles.add(this.view.watch("state.camera",function(b){return a.cameraChangedSync(b)},!0),p.on(this.view,"state.events","before-camera-change",function(b){return a.beforeCameraChangeHandle(b.camera)}));this.handles.add(this.view.on("resize",function(b){return a.handleResize(b.width,b.height)}));this.handles.add(this.view.watch("state.cameraController",function(){a.cameraSetByUser=!0;a.handles.remove(V);a.cancelImmediateGoTo()}));
this.handles.add(p.on(this.view,"state.events","camera-projection-changed",function(){return a.notifyChange("scale")}))};h.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)};h.prototype.init=function(){var a=this;this.constraintsManager=new C.default({view:this.view});this.handleResize(this.view.width,this.view.height);var b=this.getInitialProperties();this.cameraSetByUser=!1;this._set("ready",
!0);for(var c=0;c<b.length;c++){var d=b[c];this.set(d.name,d.value)}this.cameraSetByUser||((b=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent)&&this.isCompatible(b)?this.setInitialView(b):"local"===this.view.state.mode&&this.handles.add(p.whenOnce(this.view.basemapTerrain,"ready",function(){a.handles.remove(V);a.setInitialView(a.view.groundExtent)}),V))};h.prototype.deinit=function(){this.ready&&(this._override("padding",this.padding),this.cancelImmediateGoTo(),this.cancelAnimatedGoTo(),
this._set("ready",!1),this._clearOverride("hasInitialView"),this.internalSetOrder.length=0,this.cameraSetByUser=!1,this.handles.remove(V),this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null))};h.prototype.goTo=function(a,b){b=e({animate:!0},b);return b.animate?this.goToAnimated(a,b):this.goToImmediate(a,b)};h.prototype.debugSetCameraOnContent=function(){this.setStateCamera(A.cameraOnContentAlongViewDirection(this.view),{applyConstraints:!1})};h.prototype.step=
function(a){var b=this.view.state,c=b&&this.view.state.cameraController;c&&(b.updateCamera(function(b){c.stepController(a,b)}),c.steppingFinished&&c.finishController())};h.prototype.cancelImmediateGoTo=function(){var a=this.immediateGoToPromise;a&&(this.immediateGoToPromise=null,a.cancel())};h.prototype.cancelAnimatedGoTo=function(){var a=this.animatedGoToPromise;a&&(this.animatedGoToPromise=null,a.cancel())};h.prototype.getInitialProperties=function(){for(var a=this,b=new Set,c=[],d=0,f=L;d<f.length;d++){var e=
f[d],g=e.propertyName,e=e.overrides,k=b.has(g),h=this._isOverridden(g);!k&&h&&c.push({name:g,value:this._get(g)});this._clearOverride(g);(k||h)&&e.forEach(function(a){return b.add(a)})}return c.sort(function(b,c){b=a.internalSetOrder.indexOf(b.name);c=a.internalSetOrder.indexOf(c.name);return b<c?-1:b>c?1:0})};h.prototype.setInitialView=function(a){if(a&&!this.cameraSetByUser){var c={applyConstraints:!0};a instanceof b?c.applyConstraints=!1:a instanceof g?a.targetGeometry instanceof r?a=F.fromExtent(this.view,
a.targetGeometry,0,.5,{noReset:!0}):(a.camera&&(c.applyConstraints=!1),a=H.toCamera(this.view,a)):a=F.fromExtent(this.view,a,0,.5,{noReset:!0});this.setStateCamera(F.externalToInternal(this.view,a),c)}};h.prototype.updatePropertyBeforeReady=function(a,b){if(this.ready)return!1;this._override(a,b);var c=this.internalSetOrder.indexOf(a);-1!==c&&(this.internalSetOrder=this.internalSetOrder.splice(c,1));b&&(this.internalSetOrder.push(a),-1!==P.indexOf(a)&&this._override("hasInitialView",!0));return!0};
h.prototype.isCompatible=function(a){return a?a instanceof g?a.camera?this.isCompatible(a.camera):this.isCompatible(a.targetGeometry):a instanceof b?this.isCompatible(a.position):a.spatialReference&&x.canProject(a.spatialReference,this.view.spatialReference):!1};h.prototype.getPreservingHeadingTilt=function(a){void 0===a&&(a=U);this.cameraSetByUser?(a.heading=this.camera.heading,a.tilt=this.camera.tilt):(a.heading=0,a.tilt=.5);return a};h.prototype.centerPointAtDistanceToCamera=function(a,b,c){void 0===
c&&(c=S);var d=this.getPreservingHeadingTilt();return(a=F.eyeHeadingTiltForCenterPointAtDistance(this.view,d.heading,d.tilt,a,b))?(c.copyFrom(this.view.state.camera),c.eye=a.eye,c.center=a.center,c.up=a.up,c):null};h.prototype.centerToCamera=function(a){var b=this.view.pointsOfInterest.centerOnContent;b.forceUpdate();return this.centerPointAtDistanceToCamera(a,b.distance)};h.prototype.extentToCamera=function(a){var b=this.getPreservingHeadingTilt();if(a=F.fromExtent(this.view,a,b.heading,b.tilt,N))return F.externalToInternal(this.view,
a)};h.prototype.scaleToCamera=function(a){if(null==a)return null;var b=this.view.pointsOfInterest.centerOnContent;b.forceUpdate();var c=b.renderLocation;a=F.scaleToDistance(this.view,a,b.location.latitude);return this.centerPointAtDistanceToCamera(c,a)};h.prototype.zoomToCamera=function(a){return this.scaleToCamera(F.zoomToScale(this.view,a))};h.prototype.viewpointToCamera=function(a){return(a=H.toCamera(this.view,a))?F.externalToInternal(this.view,a):null};h.prototype.setStateCamera=function(a,b){var c=
this;if(!a||!this.view.state.stopActiveCameraController())return!1;this.cameraSetByUser=!0;this.cancelImmediateGoTo();this.view.state.updateCamera(function(d){d.copyFrom(a);b.applyConstraints&&v.applyAll(c.view,d)});b.applyConstraints||(this.view.state.cameraController=new E.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:a}));return!0};h.prototype.handleResize=function(a,b){var c=this.view.canvas;!c||c.width===a&&c.height===b||(c.width=a,c.height=b);this.view.state&&(c=this.view.state.camera,
c.fullWidth!==a||c.fullHeight!==b)&&(S.copyFrom(c),S.fullWidth=a,S.fullHeight=b,this.view.state.camera=S)};h.prototype.beforeCameraChangeHandle=function(a){this.updateCameraAboveGround(a)};h.prototype.cameraChangedSync=function(a){a&&this.view._stage&&this.view._stage.setCamera(a)};h.prototype.updateCameraAboveGround=function(a){var b=this.view.basemapTerrain,c=this.view.renderCoordsHelper.getAltitude(a.eye),b=b&&b.spatialReference?A.surfaceElevationBelowEye(this.view,a):0;a.relativeElevation=c-b};
h.prototype.createGoToCamera=function(a){var c=this;return p.whenOnce(this,"ready",null,!0).then(function(){return H.create(c.view,a)}).then(function(d){var e=!!(a instanceof g&&a.camera||a instanceof b),k=d.camera;if(!c.isCompatible(k))throw d=(d=k.position)&&d.spatialReference,new f("goto:incompatible-spatialreference","Resulting camera has an incompatible spatial reference (camera: "+(d?d.wkid:"none")+", view: "+c.view.spatialReference.wkid+")",{camera:k});k=F.externalToInternal(c.view,k);if(!k)throw new f("goto:invalid-camera",
"Resulting camera is invalid");return{viewpoint:d,camera:k,isFullySpecified:e}})};h.prototype.cancellableGoTo=function(a){var b=this,c;return l.create(function(b,d){c={resolve:b,reject:d};a.asyncResult=c},function(){b.view.state.cameraController===a&&a.active&&a.asyncResult===c&&a.stopController()})};h.prototype.goToImmediate=function(a,b){var c=this;this.cancelAnimatedGoTo();this.cancelImmediateGoTo();var d=this.createGoToCamera(a).then(function(a){c.immediateGoToPromise===d&&(c.immediateGoToPromise=
null);c.setStateCamera(a.camera,{applyConstraints:!a.isFullySpecified})}).catch(function(a){c.immediateGoToPromise===d&&(c.immediateGoToPromise=null);a instanceof f&&a.message&&O.error("#goTo()","Failed to create camera from target, "+a.message[0].toLowerCase()+a.message.slice(1));throw a;});return this.immediateGoToPromise=d};h.prototype.goToAnimatedBeforeReady=function(a,b){var c=this;this.cancelAnimatedGoTo();var d=p.whenOnce(this.view,"ready").then(function(){if(d===c.animatedGoToPromise)return c.animatedGoToPromise=
null,c.goToAnimated(a,b);throw new f("view:goto-cancelled","Cancelled");});return this.animatedGoToPromise=d};h.prototype.goToAnimated=function(a,b){var c=this;this.cancelAnimatedGoTo();if(!this.ready)return this.goToAnimatedBeforeReady(a,b);var d=this.view.state.cameraController,e;d instanceof D.PointToPointAnimationController&&(d.updateStateFromViewAnimation(),d.active&&(e=d));null==e&&(e=new D.PointToPointAnimationController(this.view.state,this.pickingHelper));var g=e.viewAnimation;a=this.createGoToCamera(a);
var k=a.then(function(a){return a.viewpoint});g.update(k);if(e!==d&&!this.view.state.switchCameraController(e))return g.stop(),O.error("#goTo()","Cannot start an animation while interacting"),l.reject(new f("view:goto-cannot-interrupt","Cannot start an animation while interacting"));var h=g.target,m=function(){return c.view.state.cameraController===e&&e.viewAnimation.target===h&&e.active};a.then(function(a){var d=a.viewpoint,f=a.camera;a=a.isFullySpecified;if(m()){e.viewAnimation.update(d);h=e.viewAnimation.target;
var k;a?(k=new E.SurfaceCollisionCorrectionController({view:c.view,desiredCamera:f}),v.applySurfaceCollision(c.view,f,1)):v.applyAll(c.view,f);e.begin(f,c.internalAnimateOptions(b));return g.when().then(function(){var a=c.view.state.cameraController;k&&(a&&a.active?a instanceof D.PointToPointAnimationController&&a.viewAnimation.target===h&&(c.view.state.cameraController=k):e.viewAnimation.target===h&&(c.view.state.cameraController=k))})}}).catch(function(a){a instanceof f&&a.message&&O.error("#goTo()",
"Failed to create camera from target, "+a.message[0].toLowerCase()+a.message.slice(1));if(m())throw c.view.state.cameraController.stopController(),a;});return this.cancellableGoTo(e)};h.prototype.internalAnimateOptions=function(a){var b={};a&&(null!=a.speedFactor&&(b.speedFactor=a.speedFactor),null!=a.duration&&(b.duration=a.duration/1E3),null!=a.maxDuration&&(b.maxDuration=a.maxDuration/1E3),null!=a.easing&&(b.easing="string"===typeof a.easing?K.named[a.easing]:a.easing));return b};d([m.property({type:b,
dependsOn:["view.state.camera","ready"]})],h.prototype,"camera",null);d([m.property({type:t,dependsOn:["view.pointsOfInterest.centerOnContent.location","ready"]})],h.prototype,"center",null);d([m.property({type:r,dependsOn:["view.state.camera","ready"]})],h.prototype,"extent",null);d([m.property({readOnly:!0,dependsOn:["view.state.camera","ready"]})],h.prototype,"frustum",null);d([m.property({readOnly:!0,dependsOn:["view.map.initialViewProperties.viewpoint"]})],h.prototype,"hasInitialView",null);
d([m.property({readOnly:!0,type:Boolean})],h.prototype,"ready",void 0);d([m.property({dependsOn:["view.pointsOfInterest.centerOnContent.distance","ready"],type:Number})],h.prototype,"scale",null);d([m.property({dependsOn:["view.state.camera","ready"]})],h.prototype,"padding",null);d([m.property({readOnly:!0,dependsOn:["view.width","view.height","padding"]})],h.prototype,"screenCenter",null);d([m.property({constructOnly:!0})],h.prototype,"view",void 0);d([m.property({type:g,dependsOn:["camera","ready"]})],
h.prototype,"viewpoint",null);d([m.property({type:Number,dependsOn:["scale"]})],h.prototype,"zoom",null);return h=d([m.subclass("esri.views.3d.state.ViewStateManager")],h)}(m.declared(c));h.ViewStateManager=q;var P="camera viewpoint extent scale center zoom".split(" "),L=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"center",overrides:[]},
{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],U={heading:0,tilt:0},N=new b,S=new I,aa=y.vec4d.create(),V="pending-initial-view";h.default=q})},"esri/views/3d/state/ConstraintsManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators ../camera/constraintUtils ../camera/intersectionUtils ./NearFarHeuristic ./SurfaceCollisionConstraint ../support/mathUtils".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p){Object.defineProperty(h,"__esModule",{value:!0});q=function(d){function h(a){var c=d.call(this)||this;c.handles=new b;c.nearFarHeuristic=n.createNearFarHeuristic(a.view.state.mode,a.view.basemapTerrain,a.view.renderCoordsHelper.spatialReference);return c}e(h,d);h.prototype.initialize=function(){var a=this;this.handles.add([this.view.watch(["constraints.clipDistance.near","constraints.clipDistance.far"],function(){return a.handleClipDistanceNearFarChanged()}),this.view.watch("constraints.clipDistance.mode",
function(){return a.handleClipDistanceModeChanged()}),this.view.state.events.on("before-camera-change",function(b){return a.cameraUpdateNearFar(b.camera)}),this.view.watch("dataExtent",function(){return a.updateNearFar()},!0)]);this.handles.add([this.view.watch(["constraints.altitude.min","constraints.altitude.max"],function(){return a.handleAltitudeMinMaxChanged()},!0)]);this.handles.add([this.view.watch("constraints.tilt.max",function(){return a.handleTiltMaxChanged()},!0),this.view.watch("constraints.tilt.mode",
function(){return a.handleTiltModeChanged()},!0),this.view.watch("state.camera",function(){return a.tiltAutoUpdateMax()},!0)]);this.handles.add(this.view.watch(["map.ground.navigationConstraint.type","constraints.collision.enabled"],function(){return a.updateCollision()},!0));this.view.state.isLocal&&this.handles.add(g.init(this.view,"dataExtent",function(b){return a.updateLocalSurfaceDistance(b)}));this.updateNearFar();"local"!==this.view.state.mode&&this.updateAltitude();this.updateTilt();this.updateCollision();
this._set("surfaceCollisionConstraint",new l.default({view:this.view}))};h.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))};h.prototype.handleClipDistanceNearFarChanged=function(){var a=this,b=this.view.constraints&&this.view.constraints.clipDistance;b&&"auto"!==b.mode&&this.view.state.updateCamera(function(c){a.cameraUpdateNearFarManual(c,
b);return!0})};h.prototype.handleClipDistanceModeChanged=function(){this.updateNearFar()};h.prototype.updateNearFar=function(){var a=this;this.view.state.updateCamera(function(b){a.cameraUpdateNearFar(b);return!0})};h.prototype.cameraUpdateNearFar=function(a){var b=this.view.constraints&&this.view.constraints.clipDistance;"manual"===(b?b.mode:"auto")?this.cameraUpdateNearFarManual(a,b):this.cameraUpdateNearFarAuto(a,b)};h.prototype.cameraUpdateNearFarAuto=function(a,b){var c=this.nearFarHeuristic.compute(a.eye,
a.center,this.view.dataExtent,k.surfaceElevationBelowEye(this.view,a),m),d=c.distance,f=c.maxFarNearRatio,c=c.minNearDistance;d/f>c?(a.far=d,a.near=a.far/f):(a.near=c,a.far=a.near*f);b&&b.autoUpdate(a.near,a.far)};h.prototype.cameraUpdateNearFarManual=function(a,b){b&&(a.near=b.near,a.far=b.far)};h.prototype.updateCollision=function(){var a=this.view.map&&this.view.map.ground&&this.view.map.ground.navigationConstraint,b=this.view.constraints&&this.view.constraints.collision.enabled,a=a?"stay-above"===
a.type:b,b=this.view.state.constraints.collision;a!==b.enabled&&((b.enabled=a)&&this.reapplyConstraints(8),(a=this.view.constraints&&this.view.constraints.tilt)&&"auto"!==a.mode||this.updateTiltAuto(a))};h.prototype.handleAltitudeMinMaxChanged=function(){this.updateAltitude()};h.prototype.updateAltitude=function(){var a=this.view.constraints&&this.view.constraints.altitude;this.view.state.constraints.altitude=a&&"local"!==this.view.state.mode?{min:a.min,max:a.max}:null;this.reapplyConstraints()};
h.prototype.handleTiltModeChanged=function(){this.updateTilt()};h.prototype.handleTiltMaxChanged=function(){var a=this.view.constraints&&this.view.constraints.tilt;a&&"auto"!==a.mode&&(this.updateTiltManual(a),this.reapplyConstraints())};h.prototype.updateTilt=function(){var a=this.view.constraints&&this.view.constraints.tilt;"manual"===(a?a.mode:"auto")?this.updateTiltManual(a):this.updateTiltAuto(a);this.reapplyConstraints()};h.prototype.updateTiltManual=function(a){var b=this.view.state.constraints;
b.tilt=b.createConstantMaxTilt(p.deg2rad(a.max))};h.prototype.updateTiltAuto=function(a){a=this.view.state.constraints;a.tilt=a.createDefaultTilt();this.tiltAutoUpdateMax()};h.prototype.tiltAutoUpdateMax=function(){var a=this.view.constraints&&this.view.constraints.tilt;if(a&&"auto"===a.mode){var b=this.view.state.constraints;b.tilt&&(b=b.tilt(this.view.state.camera.distance).max,a.autoUpdate(p.rad2deg(b)))}};h.prototype.updateLocalSurfaceDistance=function(a){var b=Math.max(a.width,a.height);0>=b||
(a.hasZ&&(b=Math.max(b,a.zmax-a.zmin)),a=this.view.state,b=3*b/Math.atan(a.camera.fov/2),b!==a.constraints.distance&&(a.constraints.distance=b))};h.prototype.reapplyConstraints=function(a){var b=this;void 0===a&&(a=15);this.view.state.updateCamera(function(c){return f.applyAll(b.view,c,{selection:a,interactionType:0,interactionFactor:null,interactionStartCamera:null,interactionDirection:null})})};a([c.property({constructOnly:!0})],h.prototype,"view",void 0);a([c.property({readOnly:!0})],h.prototype,
"surfaceCollisionConstraint",void 0);return h=a([c.subclass("esri.views.3d.state.ConstraintsManager")],h)}(c.declared(d));h.ConstraintsManager=q;var m={distance:0,maxFarNearRatio:0,minNearDistance:0};h.default=q})},"esri/views/3d/state/NearFarHeuristic":function(){define("require exports ../../../geometry/support/scaleUtils ../lib/glMatrix ../support/earthUtils ../support/mathUtils".split(" "),function(q,h,e,a,d,b){Object.defineProperty(h,"__esModule",{value:!0});h.createNearFarHeuristic=function(a,
b,d){return"global"===a?new c:new g(b,d)};var g=function(){function c(a,b){this.elevationProvider=a;this.unitInMeters=e.getMetersPerUnitForSR(b)}c.prototype.compute=function(c,e,g,h,r){r||(r={maxFarNearRatio:0,distance:0,minNearDistance:0});var u=d.earthRadius;r.maxFarNearRatio=f;r.minNearDistance=k/this.unitInMeters;var t=c[2]*this.unitInMeters,v=t;h=t-h;var x=this.elevationProvider?this.elevationProvider.getElevationBounds():null;x&&(t=0<=h?v-this.unitInMeters*x[0]:this.unitInMeters*x[1]-v);v=Math.max(g.xmax-
g.xmin,g.ymax-g.ymin,4*Math.max(g.xmax-g.xmin,g.ymax-g.ymin));a.vec3d.subtract(e,c,m);p[0]=0<m[0]?g.xmax:g.xmin;p[1]=0<m[1]?g.ymax:g.ymin;p[2]=0<m[2]?v/2:-v/2;a.vec3d.subtract(p,c);a.vec3d.normalize(m);c=1.1*a.vec3d.dot(p,m)*this.unitInMeters;u=Math.sqrt(t*(t+2*u));g=Math.max(g.xmax-g.xmin,g.ymax-g.ymin);e=g*l*this.unitInMeters;t=b.clamp((t-e)/(g*n*this.unitInMeters-e),0,1);r.distance=b.lerp(u,c,t*t*t);r.distance*=Math.max(Math.log(Math.abs(h)),1);r.distance=Math.min(r.distance,Math.max(34064E4,v));
r.distance/=this.unitInMeters;return r};return c}(),c=function(){function c(){}c.prototype.compute=function(c,e,g,h,l){l||(l={maxFarNearRatio:0,minNearDistance:0,distance:0});e=d.earthRadius;c=a.vec3d.length(c)-e;l.maxFarNearRatio=f;l.minNearDistance=k/1;c=Math.max(Math.abs(c-h),Math.abs(c));h=Math.sqrt(c*(c+2*(e+Math.min(0,h))));l.maxFarNearRatio=b.clamp(2E4-(Math.log(c)-7.983)/9.011*19E3,1E3,2E4);l.distance=1.2*h/1;return l};return c}(),f=2E4,k=2,n=.001,l=1E-4,p=a.vec3d.create(),m=a.vec3d.create()})},
"esri/views/3d/state/SurfaceCollisionConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ../camera/constraintUtils ../camera/intersectionUtils".split(" "),function(q,h,e,a,d,b,g,c,f){Object.defineProperty(h,"__esModule",{value:!0});q=function(d){function h(a){a=d.call(this)||this;a.handles=new b;return a}e(h,d);h.prototype.initialize=
function(){var a=this;this.handles.add(this.view.basemapTerrain.on("elevation-change",function(b){return a.handleElevationChangeEvent(b)}))};h.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};h.prototype.handleElevationChangeEvent=function(a){if(this.view.state.cameraController)return!1;f.eyeWithinExtent(this.view,this.view.state.camera,a.extent,a.spatialReference)&&this.applyToCurrentCamera()};h.prototype.applyToCurrentCamera=function(){var a=this;this.view.state.updateCamera(function(b){c.applySurfaceCollision(a.view,
b,1)})};a([g.property({constructOnly:!0})],h.prototype,"view",void 0);return h=a([g.subclass("esri.views.3d.state.ElevationCollisionConstraint")],h)}(g.declared(d));h.SurfaceCollisionConstraint=q;h.default=q})},"esri/views/3d/state/controllers/SurfaceCollisionCorrectionController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Handles ../../camera/constraintUtils ../../camera/intersectionUtils ./CameraController".split(" "),function(q,h,e,a,d,b,g){Object.defineProperty(h,
"__esModule",{value:!0});q=function(c){function f(b){var d=c.call(this)||this;d.handles=new a;d.view=b.view;d.desiredCamera=b.desiredCamera.copy();return d}e(f,c);Object.defineProperty(f.prototype,"canStop",{get:function(){return!0},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"constraintEnabled",{get:function(){return this.view.state.constraints.collision.enabled},enumerable:!0,configurable:!0});f.prototype.onControllerStart=function(a){var b=this;c.prototype.onControllerStart.call(this,
a);this.handles.add(this.view.basemapTerrain.on("elevation-change",function(a){return b.handleElevationChangeEvent(a)}));this.applyCorrection()};f.prototype.onControllerEnd=function(a){this.handles.removeAll();c.prototype.onControllerEnd.call(this,a)};f.prototype.handleElevationChangeEvent=function(a){b.eyeWithinExtent(this.view,this.desiredCamera,a.extent,a.spatialReference)&&this.applyCorrection()};f.prototype.applyCorrection=function(){var a=this;this.view.state.updateCamera(function(b){b.copyViewFrom(a.desiredCamera);
d.applySurfaceCollision(a.view,b,1)||a.constraintEnabled||(a.state=g.State.Stopped)})};return f}(g.CameraController);h.SurfaceCollisionCorrectionController=q})},"esri/views/3d/support/cameraUtils":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../Camera ../../../config ../../../core/Logger ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/scaleUtils ../../../geometry/support/webMercatorUtils ../camera/intersectionUtils ../lib/glMatrix ./cameraUtilsPlanar ./cameraUtilsSpherical ./earthUtils ./mathUtils ./projectionUtils ../webgl-engine/lib/Camera".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u,x){function v(a){return"global"===a.viewingMode?m:p}function A(b,d,f){var e=b.renderSpatialReference,h=l.vec3d.set(d.viewForward,H),h=D(b,d.eye,h,d.up,I);b=b.spatialReference||c.WGS84;u.vectorToVector(d.eye,e,F,b)||(b=c.WGS84,u.vectorToVector(d.eye,e,F,b));return f?(f.position.x=F[0],f.position.y=F[1],f.position.z=F[2],f.position.spatialReference=b,f.heading=h.heading,f.tilt=h.tilt,f.fov=t.rad2deg(d.fov),f):new a(new g(F,b),h.heading,h.tilt,t.rad2deg(d.fov))}
function y(a,b,c){var f=a.state.camera,e=f.fovX,f=f.width/2;"global"===a.viewingMode&&null!=c&&(b*=Math.cos(t.deg2rad(c)));b/=a.renderCoordsHelper.unitInMeters;return f/(39.37*d.screenDPI/b)/Math.tan(e/2)}function C(a,b,c){var f=a.state.camera;b=39.37*d.screenDPI/(f.width/2/(b*Math.tan(f.fovX/2)));"global"===a.viewingMode&&(b/=Math.cos(t.deg2rad(c)));return b*=a.renderCoordsHelper.unitInMeters}function B(b,d,f,e,g,h){var k=b.renderSpatialReference;d=E(b,e.heading,e.tilt,d,f,g);b=u.vectorToPoint(d.eye,
k,b.spatialReference||c.WGS84);if(!b)return null;if(!h)return new a(b,d.heading,d.tilt,e.fov);h.position=b;h.heading=d.heading;h.tilt=d.tilt;h.fov=e.fov;return h}function D(a,b,c,d,f){return v(a).directionToHeadingTilt(b,c,d,f)}function E(a,b,d,f,h,k){var m=l.vec3d.create(),n=a.renderSpatialReference;if(f)if(f instanceof g){var p=f;u.pointToVector(p,m,a.renderSpatialReference);null==p.z&&null!=a.basemapTerrain&&(p=a.basemapTerrain.getElevation(p),null!=p&&a.renderCoordsHelper.setAltitude(p,m))}else f&&
l.vec3d.set(f,m);else l.vec3d.set(a.state.camera.center,m);f&&f instanceof g||(f=u.vectorToPoint(m,n,a.spatialReference||c.WGS84));h=Math.max(h,a.state.constraints.minimumPoiDistance);n=d;d=h;if(!(p=k&&k.noReset))var p=f,r=a.engineToScreen(a.state.camera.center),t=a.toScreen(p),p=r.x-t.x,r=r.y-t.y,t=a.pointsOfInterest.centerOnSurfaceFrequent.distance,t=Math.log(Math.max(d,t)/Math.min(d,t))/Math.LN2,p=!(Math.sqrt(p*p+r*r)>5*Math.max(a.width,a.height)||8<t&&8E5<d);p?(n=v(a).eyeTiltToLookAtTilt(m,d,
n),n=a.state.constraints.clampTilt(d,n),n=v(a).lookAtTiltToEyeTilt(m,d,n)):(b=0,n=a.state.constraints.tilt(d).min);d=n;n=v(a).eyeForCenterWithHeadingTilt;b=n(m,h,b,d);m={eye:b.eye,up:b.up,center:m,heading:b.heading,tilt:b.tilt};return k&&k.noReset||"global"!==a.viewingMode||(b=a.renderCoordsHelper.fromRenderCoords(m.eye,K,a.spatialReference)?a.basemapTerrain&&(a.basemapTerrain.getElevation(K)||0)>K.z-1:!1,!b)?m:(m=a.state.constraints.tilt(h).min,E(a,0,m,f,h,e({},k,{noReset:!0})))}Object.defineProperty(h,
"__esModule",{value:!0});var J=b.getLogger("esri.views.3d.support.cameraUtils"),F=l.vec3d.create(),M=l.vec3d.create(),H=l.vec3d.create(),I={heading:0,tilt:0},K=new g,O=new t.Cyclical(-2.0037508342788905E7,2.0037508342788905E7);h.externalToInternal=function(a,b){var c=a.renderSpatialReference,d=v(a).headingTiltToDirectionUp,f=l.vec3d.create();return u.pointToVector(b.position,f,c)?(c=d(f,b.heading,b.tilt),l.vec3d.add(c.direction,f),a=n.cameraOnContentAlongViewDirection(a,f,c.direction,c.up),a.fov=
t.deg2rad(b.fov),a):null};h.internalToExternal=A;h.scaleToDistance=y;h.distanceToScale=C;h.fromCenterScale=function(a,b,c,d,f,e){c=y(a,c,b.latitude);return B(a,b,c,d,f,e)};h.fromCenterDistance=B;h.directionToHeadingTilt=D;h.eyeHeadingTiltForCenterPointAtDistance=E;h.fromExtent=function(b,d,f,e,h,l){var m;h instanceof a?(l=h,m={noReset:!1}):m=h;var n="global"===b.viewingMode;h=b.renderSpatialReference;var p=b.spatialReference||c.WGS84,t=c.WebMercator,v=d.spatialReference||t,x,q=0;null!=d.zmax&&null!=
d.zmin&&(x=(d.zmax+d.zmin)/2,q=d.zmax-d.zmin);if(n){var n=new g(d.xmin,d.ymin,v),A=new g(d.xmax,d.ymax,v),n=k.project(n,t),A=k.project(A,t);if(null===n||null===A)return;d=new g(O.center(n.x,A.x),(A.y+n.y)/2,t);null!=x&&(d.z=x);x=r.getGreatCircleSpanAt(d,n,A);t=x.lon;v=x.lat;O.diff(n.x,A.x)>O.range/2&&(t+=r.halfEarthCircumference);t=Math.min(t,r.halfEarthCircumference);v=Math.min(v,r.halfEarthCircumference)}else k.canProject(d,p)&&(d=k.project(d,p)),t=d.xmax-d.xmin,v=d.ymax-d.ymin,d=new g({x:d.xmin+
.5*t,y:d.ymin+.5*v,z:x,spatialReference:p});x=b.state.camera;f=E(b,f,e,d,Math.max(1/Math.tan(x.fovX/2)*t*.5,1/Math.tan(x.fovY/2)*v*.5,1/Math.tan(x.fov/2)*q*.5)/1,m);e=u.vectorToPoint(f.eye,h,p);if(!e)return null;l||(l=new a);l.position=e;l.heading=f.heading;l.tilt=f.tilt;l.fov=b.camera.fov;return l};h.toExtent=function(a,b,d,f,e){var g;g=a.renderSpatialReference;b||(d||(d=a.state.camera),b=A(a,d,e));if(d)e=u.vectorToPoint(d.center,g,a.spatialReference||c.WGS84),g=d.distance;else{e=a.toMap(a.screenCenter);
if(!e)return null;g=r.computeCarthesianDistance(b.position,e)}d||(d=a.state.camera);b=2*g*Math.tan(d.fovX/2)*1;d=2*g*Math.tan(d.fovY/2)*1;return"global"===a.viewingMode?m.toExtent(a,e,b,d,f):p.toExtent(a,e,b,d,f)};h.scaleToZoom=function(a,b){if(a=a.basemapTerrain&&a.basemapTerrain.tilingScheme)return a.levelAtScale(b);J.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")};h.zoomToScale=function(a,b){if(a=a.basemapTerrain&&a.basemapTerrain.tilingScheme)return a.scaleAtLevel(b);
J.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")};h.scaleToResolution=function(a,b){return a.spatialReference?f.getResolutionForScale(b,a.spatialReference):void 0};h.computeScale=function(a,b,d){var f=a.renderSpatialReference;b||(b=a.state.camera);var e;e=c.WGS84;b instanceof x?(u.vectorToVector(b.center,f,M,e),e=M[1],b=b.distance):(e=b.position.latitude,u.pointToVector(b.position,F,f),u.pointToVector(d,M,f),b=l.vec3d.dist(F,M));return C(a,b,e)}})},"esri/views/3d/support/cameraUtilsPlanar":function(){define("require exports ../../../geometry/Extent ../lib/glMatrix ./cameraUtilsInternal ./mathUtils ./projectionUtils".split(" "),
function(q,h,e,a,d,b,g){function c(c,d,e){c=a.vec3d.create();var g=a.vec3d.create();a.mat4d.identity(n);a.mat4d.rotateZ(n,-b.deg2rad(d));a.mat4d.rotateX(n,b.deg2rad(e));a.mat4d.multiplyVec3(n,k,c);a.vec3d.scale(c,-1);a.mat4d.multiplyVec3(n,f,g);return{direction:c,up:g}}Object.defineProperty(h,"__esModule",{value:!0});var f=a.vec3d.createFrom(0,1,0),k=a.vec3d.createFrom(0,0,1),n=a.mat4d.create(),l=a.vec3d.create(),p=a.vec3d.create();h.headingTiltToDirectionUp=c;h.directionToHeadingTilt=function(a,
b,c,e){return d.directionToHeadingTilt(b,c,e,k,f)};h.eyeForCenterWithHeadingTilt=function(b,d,f,e){var g=c(b,f,e);b=a.vec3d.add(a.vec3d.scale(g.direction,-d,a.vec3d.create()),b);return{up:g.up,eye:b,heading:f,tilt:e}};h.lookAtTiltToEyeTilt=function(a,c,d){return b.rad2deg(d)};h.eyeTiltToLookAtTilt=function(a,c,d){return b.deg2rad(d)};h.toExtent=function(a,b,c,d,f){var h=a.renderSpatialReference;a=a.map&&a.spatialReference||b.spatialReference;g.pointToVector(b,l,h);g.pointToVector(b,p,h);l[0]-=c/2;
p[0]+=c/2;l[1]-=d/2;p[1]+=d/2;g.vectorToVector(l,h,l,a);g.vectorToVector(p,h,p,a);f?(f.xmin=l[0],f.ymin=l[1],f.xmax=p[0],f.ymax=p[1],f.spatialReference=a):f=new e(l[0],l[1],p[0],p[1],a);return f}})},"esri/views/3d/support/cameraUtilsInternal":function(){define(["require","exports","../lib/glMatrix","./mathUtils"],function(q,h,e,a){Object.defineProperty(h,"__esModule",{value:!0});var d=e.vec3d.create(),b=e.vec3d.create();h.directionToHeadingTilt=function(g,c,f,h,n){var k=d;e.vec3d.normalize(g,k);var p=
e.vec3d.dot(k,h),m=0<p,p=Math.abs(p);.99<p&&(p=Math.abs(e.vec3d.dot(c,h)),.99>p?(e.vec3d.set(c,k),m&&e.vec3d.scale(k,-1)):k=null);c=0;k&&(e.vec3d.scale(h,e.vec3d.dot(h,k),b),e.vec3d.subtract(k,b),c=e.vec3d.dot(k,n)/(e.vec3d.length(k)*e.vec3d.length(n)),e.vec3d.cross(k,n,b),c=(0<e.vec3d.dot(b,h)?1:-1)*a.rad2deg(a.acos(c)));g=a.rad2deg(a.acos(-e.vec3d.dot(h,g)/e.vec3d.length(g)));return f?(f.heading=c,f.tilt=g,f):{heading:c,tilt:g}}})},"esri/views/3d/support/cameraUtilsSpherical":function(){define("require exports ../../../geometry/Extent ../../../geometry/SpatialReference ../../../geometry/support/webMercatorUtils ../lib/glMatrix ./cameraUtilsInternal ./earthUtils ./mathUtils".split(" "),
function(q,h,e,a,d,b,g,c,f){function k(a,c,d){var e=b.vec3d.create(),g=b.vec3d.create();b.vec3d.cross(a,p,u);0===b.vec3d.dot(u,u)&&b.vec3d.cross(a,m,u);b.mat4d.identity(t);b.mat4d.rotate(t,-f.deg2rad(c),a);b.mat4d.rotate(t,-f.deg2rad(d),u);b.vec3d.cross(u,a,g);b.vec3d.normalize(g);b.mat4d.multiplyVec3(t,g);b.vec3d.normalize(a,e);b.mat4d.multiplyVec3(t,b.vec3d.negate(e));return{direction:e,up:g}}function n(a){var b=a[1];a[1]=-a[2];a[2]=b}function l(a,b){b=k(b,a.heading,a.tilt);a.up=b.up;return a}Object.defineProperty(h,
"__esModule",{value:!0});var p=b.vec3d.createFrom(0,0,1),m=b.vec3d.normalize(b.vec3d.createFrom(1,1,1)),r=new f.Cyclical(-180,180),t=b.mat4d.create(),u=b.vec3d.create(),x=b.vec3d.create();h.headingTiltToDirectionUp=k;h.directionToHeadingTilt=function(a,c,d,f){var e=u;b.vec3d.normalize(a,e);b.vec3d.cross(e,p,x);0===b.vec3d.dot(x,x)&&b.vec3d.cross(e,m,x);b.vec3d.cross(x,e,x);return g.directionToHeadingTilt(c,d,f,e,x)};h.eyeForCenterWithHeadingTilt=function(a,c,d,e){var g={eye:b.vec3d.create(),up:null,
tilt:e,heading:d},h=u;h[0]=a[0];h[1]=a[2];h[2]=-a[1];d=f.deg2rad(d);var k=f.deg2rad(e);e=Math.sin(d);d=Math.cos(d);var m=Math.sin(k),p=Math.cos(k),r=b.vec3d.length(h);if(1E-8>Math.abs(k))k=c+r;else var t=r/m,v=f.asin(c/t),k=t*Math.sin(Math.PI-k-v);var t=m*c,p=p*c,v=d*t,x=k-p,q=x*x,A=c*c*m*m,m=d*d*A,A=e*e*A,y=h[1]*x,C=m*(m+q-h[1]*h[1]);if(0>C)return b.vec3d.scale(h,k/r,g.eye),g.tilt=0,g;var N=Math.sqrt(C),C=m+q,y=0<d?-N+y:N+y;if(1E-8>Math.abs(C))return 1E-8>r?(g.eye[0]=0,g.eye[1]=0,g.eye[2]=c):b.vec3d.scale(h,
k/r,g.eye),g.tilt=0,n(g.eye),l(g,a);g.eye[1]=y/C;C=g.eye[1]*g.eye[1];c=1-C;y=Math.sqrt(c);v=m*C+A-2*v*g.eye[1]*y*x+c*q;if(1E-8>Math.abs(v))return b.vec3d.scale(h,k/r,g.eye),g.tilt=0,n(g.eye),l(g,a);g.eye[0]=(c*(k*h[0]-p*h[0])-t*y*(h[0]*g.eye[1]*d+h[2]*e))/v;g.eye[2]=(c*(k*h[2]-p*h[2])-t*y*(h[2]*g.eye[1]*d-h[0]*e))/v;b.vec3d.scale(g.eye,k);n(g.eye);return l(g,a)};h.lookAtTiltToEyeTilt=function(a,c,d){a=b.vec3d.length(a);c=f.asin(c/(Math.sqrt(c*c+a*a-2*c*a*Math.cos(Math.PI-d))/Math.sin(d)));return f.rad2deg(d-
c)};h.eyeTiltToLookAtTilt=function(a,c,d){d=f.deg2rad(d);a=b.vec3d.length(a);return f.asin(c/(a/Math.sin(d)))+d};h.toExtent=function(b,g,h,k,l){function m(a){var b=Math.PI/2;a=f.cyclical2PI.normalize(a,-b);a>b&&(a=Math.PI-a);return a}var n;n=g.latitude;g=g.longitude;var p=c.getLonDeltaForDistance(g,n,h)/2;h=g-p;g+=p;n=f.deg2rad(n);p=c.earthRadius;n=(1+Math.sin(n))/(1-Math.sin(n));var u=(n+1)*Math.tan(k/p/2);n=1.5*Math.PI-2*Math.atan(.5*(u+Math.sqrt(4*n+u*u)));k=n+k/p;n=m(n);k=m(k);k<n&&(p=k,k=n,n=
p);n=Math.max(f.rad2deg(n),-90);k=Math.min(f.rad2deg(k),90);g=r.monotonic(h,g);180<g-h&&(p=(g-h-180)/2,h+=p,g-=p);l?(l.xmin=h,l.ymin=n,l.xmax=g,l.ymax=k,l.spatialReference=a.WGS84):l=new e(h,n,g,k,a.WGS84);b.spatialReference&&b.spatialReference.isWebMercator&&d.geographicToWebMercator(l,!1,l);return l}})},"esri/views/3d/support/viewpointUtils":function(){define("require exports ../../../Camera ../../../geometry ../../../Graphic ../../../Viewpoint ../../../core/Error ../../../core/promiseUtils ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/webMercatorUtils ../camera/intersectionUtils ../lib/glMatrix ./cameraUtils ./intersectionUtils ./mathUtils ./projectionUtils".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u){function x(a){return 360-t.cyclicalDeg.normalize(a)}function v(a){return t.cyclicalDeg.normalize(360-a)}function A(b,c,d){if(!c)return null;var f=b.spatialReference||a.SpatialReference.WGS84;if(c.camera){b=c.get("camera.position.spatialReference");if(!n.canProject(b,f))return null;c=c.camera.clone();b.equals(f)||(c.position=n.project(c.position,f));return c}var g=c.get("targetGeometry.spatialReference");if(g&&!n.canProject(g,f))return null;var g=m.internalToExternal(b,
b.state.camera),h={noReset:!1};null!=c.rotation&&(g.heading=x(c.rotation),h.noReset=!0);null!=d&&(g.tilt=d);if("point"===c.targetGeometry.type){d=c.targetGeometry;var k=void 0,l=c.targetGeometry.clone(),k=null!=c.scale?m.scaleToDistance(b,c.scale,d.latitude):b.state.camera.distance;c=m.eyeHeadingTiltForCenterPointAtDistance(b,g.heading,g.tilt,l,k,h);f=u.vectorToPoint(c.eye,b.renderSpatialReference,f);return new e(f,c.heading,c.tilt,g.fov)}return m.fromExtent(b,c.targetGeometry.extent,g.heading,g.tilt,
h)}function y(a,b){var c=b.scale;null==c&&null!=b.zoom&&(c=m.zoomToScale(a,b.zoom));return c}function C(a,b){var c=!1;null!=b.heading?(a.heading=b.heading,c=!0):null!=b.rotation&&(a.heading=x(b.rotation),c=!0);null!=b.tilt&&(a.tilt=b.tilt,c=!0);null!=b.fov&&(a.fov=b.fov);return c}function B(b,c,d){var f=b.spatialReference||a.SpatialReference.WGS84;c=c||m.externalToInternal(b,d.camera);d.targetGeometry=u.vectorToPoint(c.center,b.renderSpatialReference,f);d.scale=m.computeScale(b,c);d.rotation=v(d.camera.heading);
return d}function D(a,b,c){if(b){if(!n.canProject(b.spatialReference,a.spatialReference))throw new g("viewpointutils:incompatible-spatialreference","Spatial reference ("+(b.spatialReference?b.spatialReference.wkid:"unknown")+") is incompatible with the view ("+a.spatialReference.wkid+")",{geometry:b});var d=[];if(!b.hasZ&&a.basemapTerrain){var e=void 0;switch(b.type){case "point":e=b;break;case "multipoint":case "polyline":case "mesh":e=b.extent.center;break;case "extent":e=b.center;break;case "polygon":e=
b.centroid}e&&n.canProject(e,a.basemapTerrain.spatialReference)?P[2]=a.basemapTerrain.getElevation(e)||0:P[2]=0}(0,X[b.type])(b,function(a){d.push(a[0],a[1],a[2])},P);var h=d.length/3;if(0!==h&&(e=Array(d.length),u.bufferToBuffer(d,b.spatialReference,0,e,a.spatialReference,0,h)))for(b.hasZ&&(c.hasZ=!0),a=0;a<e.length;a+=3)b.hasZ?(P[0]=e[a+0],P[1]=e[a+1],P[2]=e[a+2]):(P[0]=e[a+0],P[1]=e[a+1]),f.expand(c.boundingBox,P)}}function E(a,b,c,d){return a.whenViewForGraphic(b).then(function(a){if(a&&a.whenGraphicBounds)return a.whenGraphicBounds(b,
{minDemResolution:c})}).then(function(a){var b=a.boundingBox;f.expand(d.boundingBox,b);a.screenSpaceObjects&&a.screenSpaceObjects.forEach(function(a){d.screenSpaceObjects.push(a)});isFinite(b[2])&&(d.hasZ=!0)}).catch(function(){D(a,b.geometry,d)})}function J(b,f,e,g){if(Array.isArray(f)&&2===f.length){var h=f[0],k=f[1];if("number"===typeof h&&"number"===typeof k)return G.x=h,G.y=k,G.z=void 0,G.spatialReference=a.SpatialReference.WGS84,D(b,G,g),c.resolve()}if(f&&"function"===typeof f.map)return c.eachAlways(f.map(function(a){return J(b,
a,e,g)}));if(f instanceof a.BaseGeometry)try{D(b,f,g)}catch(ca){return c.reject(ca)}else if(f instanceof d)return E(b,f,e,g);return c.resolve()}function F(a,b,c,d){if(b.camera)return M(a,c,b.camera,d);d.scale=b.scale;d.rotation=b.rotation;d.targetGeometry=b.targetGeometry?b.targetGeometry.clone():null;d.camera=null;null!=c.heading?d.rotation=v(c.heading):null!=c.rotation&&(d.rotation=c.rotation);b=y(a,c);null!=b&&(d.scale=b);d.camera=A(a,d,c.tilt);return d}function M(a,b,c,d){d.camera=c.clone();d.camera.fov=
a.camera.fov;b=a.spatialReference;c=d.camera.position.spatialReference;if(!n.canProject(c,b))return null;c.equals(b)||(d.camera.position=n.project(d.camera.position,b));return B(a,null,d)}function H(b,c,d,f){if(!d)return null;f.targetGeometry=d.clone();var e=l.cameraOnContentAlongViewDirection(b);if(c.position){d=f.targetGeometry;var g=b.renderSpatialReference;u.pointToVector(c.position,V,g);u.pointToVector(d,T,g);f.targetGeometry=new a.Point(d);f.camera.position=new a.Point(c.position);p.vec3d.subtract(T,
V,aa);m.directionToHeadingTilt(b,V,aa,e.up,f.camera);f.scale=m.distanceToScale(b,p.vec3d.dist(V,T),f.targetGeometry.latitude);f.rotation=v(f.camera.heading);return f}if(c.zoomFactor){var g=e.distance/c.zoomFactor,h=p.vec3d.scale(e.viewForward,-g,P);p.vec3d.add(e.center,h,e.eye);e.markViewDirty();f.scale=m.distanceToScale(b,g,d.latitude)}m.internalToExternal(b,e,f.camera);g={noReset:!1};C(f.camera,c)&&(g.noReset=!0);return c.zoomFactor||(f.scale=y(b,c),null==f.scale&&(u.pointToVector(d,P,b.renderSpatialReference),
r.frustumPoint(e.frustumPlanes,P)?f.scale=m.distanceToScale(b,p.vec3d.dist(e.eye,P),d.latitude):f.scale=m.computeScale(b,e)),m.fromCenterScale(b,f.targetGeometry,f.scale,f.camera,g,f.camera))?f:null}function I(a,b,c,d){d.targetGeometry=c.clone();var f=l.cameraOnContentAlongViewDirection(a);m.internalToExternal(a,f,d.camera);f={noReset:!1};C(d.camera,b)&&(f.noReset=!0);return m.fromExtent(a,c,d.camera.heading,d.camera.tilt,f,d.camera)?d:null}function K(a,b){if(!b||!a.spatialReference)return null;a=
{target:null};if("declaredClass"in b||Array.isArray(b))a.target=b;else{for(var c in b)a[c]=b[c];b.center&&!a.target&&(a.target=b.center)}return a}function O(a){a&&(a.rotation=v(a.camera.heading));return c.resolve(a)}Object.defineProperty(h,"__esModule",{value:!0});h.DEFAULT_FRAME_COVERAGE=.66;h.rotationToHeading=x;h.headingToRotation=v;h.toCamera=A;h.fromInternalCamera=function(a,c,d){d||(d=new b({camera:new e}));m.internalToExternal(a,c,d.camera);return B(a,c,d)};h.fromCamera=function(a,c,d){d||
(d=new b);d.camera=c.clone();return B(a,null,d)};h.create=function(d,n){var r=K(d,n);if(!r)return c.reject(new g("viewpointutils-create:no-target","Missing target for creating viewpoint"));var t=new b({camera:new e({fov:d.camera.fov})}),v=null!=r.scale||null!=r.zoom;if(r.target instanceof b)return O(F(d,r.target,r,t));if(r.target instanceof e)return O(M(d,r,r.target,t));if(r.target instanceof a.Extent)return n=r.target.xmin===r.target.xmax||r.target.ymin===r.target.ymax,v||n?O(H(d,r,r.target.center,
t)):O(I(d,r,r.target,t));var x={boundingBox:f.empty(),hasZ:!1,screenSpaceObjects:[]};n=v?m.scaleToResolution(d,y(d,r)):void 0;return J(d,r.target,n,x).then(function(){if(isFinite(x.boundingBox[0])){f.center(x.boundingBox,P);G.x=P[0];G.y=P[1];G.z=P[2];G.spatialReference=d.spatialReference;var b=void 0;isFinite(G.z)&&x.hasZ?b=f.isPoint(x.boundingBox):(G.z=void 0,b=k.isPoint(f.toRect(x.boundingBox,S)));if(v||b)return H(d,r,G,t);var c=G,b=x.boundingBox,e;e=x.screenSpaceObjects;var g=h.DEFAULT_FRAME_COVERAGE;
if(e.length){for(var n=Number.NEGATIVE_INFINITY,q=0;q<e.length;q++)var A=e[q].screenSpaceBoundingRect,n=Math.max(n,Math.abs(A[0]),Math.abs(A[1]),Math.abs(A[2]),Math.abs(A[3]));e=g-n/Math.min(d.width,d.height)*2}else e=g;g=e;t.targetGeometry=c.clone();e=l.cameraOnContentAlongViewDirection(d);n=0;c.hasZ?n=c.z:d.basemapTerrain&&(n=d.basemapTerrain.getElevation(c));p.vec3d.set3(c.x,c.y,n,P);u.computeLinearTransformation(d.spatialReference,P,L,d.renderSpatialReference);p.mat4d.toMat3(L,U);p.mat3d.transpose(U);
f.empty(N);c=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(q=0;q<c.length;q++){var A=c[q],y=b[A[2]];isFinite(y)||(y=n);p.vec3d.set3(b[A[0]],b[A[1]],y,P);u.vectorToVector(P,d.spatialReference,P,d.renderSpatialReference);f.expand(N,p.mat3d.multiplyVec3(U,P))}b=f.width(N);c=f.height(N);n=f.depth(N);q=1/Math.tan(e.fovY/2);b=Math.max(.5*Math.sqrt(b*b+n*n)*Math.max(q,1/Math.tan(e.fovX/2))+.5*c,.5*c*q+.5*Math.max(b,n))/g;m.internalToExternal(d,e,t.camera);e={noReset:!1};C(t.camera,
r)&&(e.noReset=!0);t.scale=m.distanceToScale(d,b,t.targetGeometry.latitude);b=m.fromCenterScale(d,t.targetGeometry,t.scale,t.camera,e,t.camera)?t:null;return b}if(r.position)return b=l.cameraOnContentAlongViewDirection(d),p.vec3d.set(b.viewForward,aa),m.directionToHeadingTilt(d,b.eye,aa,b.up,Q),t.camera.position=new a.Point(r.position),t.camera.heading=null!=r.heading?r.heading:Q.heading,t.camera.tilt=null!=r.tilt?r.tilt:Q.tilt,B(d,null,t);b=l.cameraOnContentAlongViewDirection(d);b=u.vectorToPoint(b.center,
d.renderSpatialReference,G,d.spatialReference);return H(d,r,b,t)}).then(function(a){return O(a)})};var P=p.vec3d.create(),L=p.mat4d.create(),U=p.mat3d.create(),N=f.create(),S=k.create(),aa=p.vec3d.create(),V=p.vec3d.create(),T=p.vec3d.create(),Q={heading:0,tilt:0},G=new a.Point,X={point:function(a,b,c){c[0]=a.x;c[1]=a.y;a.hasZ&&(c[2]=a.z);b(c)},polygon:function(a,b,c){for(var d=a.hasZ,f=0;f<a.rings.length;f++)for(var e=a.rings[f],g=0;g<e.length;g++)c[0]=e[g][0],c[1]=e[g][1],d&&(c[2]=e[g][2]),b(c)},
polyline:function(a,b,c){for(var d=a.hasZ,f=0;f<a.paths.length;f++)for(var e=a.paths[f],g=0;g<e.length;g++)c[0]=e[g][0],c[1]=e[g][1],d&&(c[2]=e[g][2]),b(c)},multipoint:function(a,b,c){var d=a.points;a=a.hasZ;for(var f=0;f<d.length;f++)c[0]=d[f][0],c[1]=d[f][1],a&&(c[2]=d[f][2]),b(c)},extent:function(a,b,c){a.hasZ?(b(p.vec3d.set3(a.xmin,a.ymin,a.zmin,c)),b(p.vec3d.set3(a.xmax,a.ymin,a.zmin,c)),b(p.vec3d.set3(a.xmin,a.ymax,a.zmin,c)),b(p.vec3d.set3(a.xmax,a.ymax,a.zmin,c)),b(p.vec3d.set3(a.xmin,a.ymin,
a.zmax,c)),b(p.vec3d.set3(a.xmax,a.ymin,a.zmax,c)),b(p.vec3d.set3(a.xmin,a.ymax,a.zmax,c)),b(p.vec3d.set3(a.xmax,a.ymax,a.zmax,c))):(b(p.vec3d.set3(a.xmin,a.ymin,c[2],c)),b(p.vec3d.set3(a.xmax,a.ymin,c[2],c)),b(p.vec3d.set3(a.xmin,a.ymax,c[2],c)),b(p.vec3d.set3(a.xmax,a.ymax,c[2],c)))},mesh:function(a,b,c){if(a=a.vertexAttributes&&a.vertexAttributes.position)for(var d=0;d<a.length;d+=3)b(p.vec3d.set3(a[d+0],a[d+1],a[d+2],c))}}})},"esri/views/3d/support/CombinedElevationProvider":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ./Evented".split(" "),
function(q,h,e,a,d,b,g){return function(c){function d(a){var b=c.call(this)||this;b.providers={im:[],ground:[],scene:[]};b.handles=new Map;b.elevationChange=function(a){b.emit("elevation-change",a)};return b}e(d,c);d.prototype.getElevation=function(a,b){var c=-Infinity,d=!1;if("scene"===b)for(var f=0,e=this.providers.im;f<e.length;f++){var g=e[f],g=g.getElevation(a,b);null!=g&&(c=Math.max(g,c),!d&&isFinite(c)&&(d=!0))}if(!d)for(d=0,f=this.providers.ground;d<f.length;d++)g=f[d],g=g.getElevation(a,
b),null!=g&&(c=Math.max(g,c));if("scene"===b)for(d=0,f=this.providers.scene;d<f.length;d++)g=f[d],g=g.getElevation(a,b),null!=g&&(c=Math.max(g,c));return isFinite(c)?c:null};d.prototype.register=function(a,b){this.handles.set(b,b.on("elevation-change",this.elevationChange));this.providers[a].push(b)};d.prototype.unregister=function(a){this.handles.has(a)&&(this.handles.get(a).remove(),this.handles.delete(a));for(var b=0,c=Object.keys(this.providers);b<c.length;b++){var d=c[b],f=this.providers[d].indexOf(a);
-1<f&&this.providers[d].splice(f,1)}};a([b.property({constructOnly:!0})],d.prototype,"view",void 0);a([b.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],d.prototype,"spatialReference",void 0);return d=a([b.subclass("esri.views.3d.support.CombinedElevationProvider")],d)}(b.declared(d,g.Evented))})},"esri/views/3d/support/DisplayQualityProfile":function(){define(["require","exports","../../../core/sniff"],function(q,h,e){var a=e("esri-mobile"),d=e("esri-iPhone");q=function(){function a(){}
a.isValidProfile=function(b){return b in a.profiles};a.getDefaultProfile=function(){return e("trident")||d?"low":"medium"};a.apply=function(b,c){b=a.profiles[b];c.graphics3D.maxTotalNumberOfFeatures=b.graphics3D.maxTotalNumberOfFeatures;c.graphics3D.maxTotalNumberOfVertices=b.graphics3D.maxTotalNumberOfVertices;c.sceneService["3dObject"].lodFactor=b.sceneService["3dObject"].lodFactor;c.sceneService.point.lodFactor=b.sceneService.point.lodFactor;c.sceneService.integratedMesh.lodFactor=b.sceneService.integratedMesh.lodFactor;
c.sceneService.pointCloud.lodFactor=b.sceneService.pointCloud.lodFactor;c.sceneService.uncompressedTextureDownsamplingEnabled=b.sceneService.uncompressedTextureDownsamplingEnabled;c.tiledSurface.lodBias=b.tiledSurface.lodBias;c.tiledSurface.angledSplitBias=b.tiledSurface.angledSplitBias;c.antialiasingEnabled=b.antialiasingEnabled;c.gpuMemoryLimit=b.gpuMemoryLimit;c.frameRate=b.frameRate};return a}();(function(b){b.profiles={low:{graphics3D:{maxTotalNumberOfFeatures:25E3,maxTotalNumberOfVertices:25E5},
sceneService:{"3dObject":{lodFactor:.2},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5},antialiasingEnabled:!1,gpuMemoryLimit:200,frameRate:0},medium:{graphics3D:{maxTotalNumberOfFeatures:5E4,maxTotalNumberOfVertices:5E6},sceneService:{"3dObject":{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,
angledSplitBias:1},antialiasingEnabled:!0,gpuMemoryLimit:a?400:500,frameRate:0},high:{graphics3D:{maxTotalNumberOfFeatures:5E4,maxTotalNumberOfVertices:5E6},sceneService:{"3dObject":{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1},antialiasingEnabled:!0,gpuMemoryLimit:a?600:1E3,frameRate:0}}})(q||(q={}));return q})},"esri/views/3d/support/HighlightOptions":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),
function(q,h,e,a,d,b,g){return function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.color=new d([0,255,255]);a.haloOpacity=1;a.fillOpacity=.25;return a}e(c,b);c.toEngineOptions=function(a){return{color:new Float32Array(d.toUnitRGBA(a.color)),haloOpacity:a.haloOpacity,haloOpacityOccluded:.25*a.haloOpacity,fillOpacity:a.fillOpacity,fillOpacityOccluded:.25*a.fillOpacity}};a([g.property({type:d})],c.prototype,"color",void 0);a([g.property()],c.prototype,"haloOpacity",void 0);a([g.property()],
c.prototype,"fillOpacity",void 0);return c=a([g.subclass()],c)}(g.declared(b))})},"esri/views/3d/support/MapCoordsHelper":function(){define("require exports ../../../geometry ../../../core/Error ../../../core/promiseUtils ../../../geometry/support/scaleUtils ../../../portal/support/geometryServiceUtils ../../../tasks/support/ProjectParameters".split(" "),function(q,h,e,a,d,b,g,c){Object.defineProperty(h,"__esModule",{value:!0});q=function(){function f(a,c,d){void 0===d&&(d=null);var f=this;this.spatialReference=
c;this.unitInMeters=b.getMetersPerUnitForSR(this.spatialReference);(this.geometryService=d)||g.create(a&&a.get("portalItem")).then(function(a){f.geometryService=a}).catch(function(){})}f.prototype.toGeographic=function(b){var f=this,g=!0;if(!this.geometryService)return d.reject(new a("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config"));Array.isArray(b[0])&&"number"!==typeof b[0]||(b=[b],g=!1);b=b.map(function(a){return a instanceof e.Point?a:new e.Point(a,f.spatialReference)});
b=new c({geometries:b,outSR:e.SpatialReference.WGS84});return this.geometryService.project(b).then(function(a){a=a.map(function(a){if("point"===a.type)return[a.x,a.y]});return g?a:a[0]})};f.prototype.canProject=function(){return!!this.geometryService};return f}();h.MapCoordsHelper=q;h.default=q})},"esri/views/3d/support/QualitySettings":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),
function(q,h,e,a,d,b){var g=function(c){function d(){var a=null!==c&&c.apply(this,arguments)||this;a.maxTotalNumberOfFeatures=5E4;a.maxTotalNumberOfVertices=5E6;return a}e(d,c);a([b.property()],d.prototype,"maxTotalNumberOfFeatures",void 0);a([b.property()],d.prototype,"maxTotalNumberOfVertices",void 0);return d=a([b.subclass("esri.views.3d.support.QualitySettings.Graphics3DSettings")],d)}(b.declared(d)),c=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}e(d,c);d.prototype.getDefaults=
function(){return{"3dObject":new f,point:new f,integratedMesh:new f,pointCloud:new f,uncompressedTextureDownsamplingEnabled:!1}};a([b.property()],d.prototype,"3dObject",void 0);a([b.property()],d.prototype,"point",void 0);a([b.property()],d.prototype,"integratedMesh",void 0);a([b.property()],d.prototype,"pointCloud",void 0);a([b.property()],d.prototype,"uncompressedTextureDownsamplingEnabled",void 0);return d=a([b.subclass("esri.views.3d.support.QualitySettings.SceneServiceSettings")],d)}(b.declared(d)),
f=function(c){function d(){var a=null!==c&&c.apply(this,arguments)||this;a.lodFactor=1;return a}e(d,c);a([b.property()],d.prototype,"lodFactor",void 0);return d=a([b.subclass("esri.views.3d.support.QualitySettings.LoDFactorSettings")],d)}(b.declared(d)),k=function(c){function d(){var a=null!==c&&c.apply(this,arguments)||this;a.lodBias=0;a.angledSplitBias=1;return a}e(d,c);a([b.property()],d.prototype,"lodBias",void 0);a([b.property()],d.prototype,"angledSplitBias",void 0);return d=a([b.subclass("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],
d)}(b.declared(d));return function(d){function f(){return null!==d&&d.apply(this,arguments)||this}e(f,d);f.prototype.getDefaults=function(){return{graphics3D:new g,sceneService:new c,tiledSurface:new k,antialiasingEnabled:!0}};a([b.property()],f.prototype,"graphics3D",void 0);a([b.property()],f.prototype,"sceneService",void 0);a([b.property()],f.prototype,"tiledSurface",void 0);a([b.property()],f.prototype,"antialiasingEnabled",void 0);a([b.property()],f.prototype,"gpuMemoryLimit",void 0);a([b.property()],
f.prototype,"frameRate",void 0);return f=a([b.subclass("esri.views.3d.support.QualitySettings.QualitySettings")],f)}(b.declared(d))})},"esri/views/3d/support/RenderCoordsHelper":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/scaleUtils ../../../layers/graphics/dehydratedFeatures ../lib/glMatrix ./earthUtils ./geometryUtils ./mathUtils ./projectionUtils ../webgl-engine/lib/Util".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p){Object.defineProperty(h,"__esModule",{value:!0});h.createRenderCoordsHelper=function(a,b){return"global"===a?new r(b):new t(b)};var m;(function(a){a[a.X=0]="X";a[a.Y=1]="Y";a[a.Z=2]="Z"})(m=h.BasisDimension||(h.BasisDimension={}));q=function(){function b(a,b){this.spatialReference=a;this.unitInMeters=b}b.prototype.toRenderCoords=function(a,b,c){return g.isPoint(a)?l.pointToVector(a,b,this.spatialReference):l.vectorToVector(a,b,c,this.spatialReference)};b.prototype.fromRenderCoords=
function(b,c,f){return c instanceof a?l.vectorToPoint(b,this.spatialReference,c,f):c instanceof d?l.vectorToPoint(b,this.spatialReference,c):l.vectorToVector(b,this.spatialReference,c,f)};return b}();h.RenderCoordsHelper=q;var r=function(a){function b(b){b=a.call(this,b||l.SphericalECEFSpatialReference,1)||this;b.type="global";return b}e(b,a);b.prototype.getAltitude=function(a){return c.vec3d.length(a)-f.earthRadius};b.prototype.setAltitude=function(a,b){a=(a+f.earthRadius)/c.vec3d.length(b);c.vec3d.scale(b,
a)};b.prototype.setAltitudeOfTransformation=function(a,b){var c=b[12],d=b[13],e=b[14];a=(a+f.earthRadius)/Math.sqrt(c*c+d*d+e*e);b[12]=c*a;b[13]=d*a;b[14]=e*a};b.prototype.worldUpAtPosition=function(a,b){return this.worldBasisAtPosition(a,m.Z,b)};b.prototype.worldBasisAtPosition=function(a,b,d){switch(b){case m.X:return n.cartesianToSpherical(a||A,x),a=x[2],c.vec3d.set3(-Math.sin(a),Math.cos(a),0,d);case m.Y:n.cartesianToSpherical(a||A,x);b=x[1];a=x[2];var f=Math.sin(b);return c.vec3d.set3(-f*Math.cos(a),
-f*Math.sin(a),Math.cos(b),d);case m.Z:return c.vec3d.normalize(a||A,d)}};b.prototype.intersectManifold=function(a,b,d,e){void 0===e&&(e=c.vec3d.create());if(!p.raySphere(a,b,null,f.earthRadius+d,x)||0>c.vec3d.dot(c.vec3d.direction(x,a,v),b))return!1;c.vec3d.set(x,e);return!0};return b}(q),t=function(a){function d(c){c=a.call(this,c,b.getMetersPerUnitForSR(c))||this;c.type="local";c.worldX=[1,0,0];c.worldY=[0,1,0];c.worldZ=[0,0,1];return c}e(d,a);d.prototype.getAltitude=function(a,b){return b?a[b+
2]:a[2]};d.prototype.setAltitude=function(a,b){b[2]=a};d.prototype.setAltitudeOfTransformation=function(a,b){b[14]=a};d.prototype.worldUpAtPosition=function(a,b){return c.vec3d.set(this.worldZ,b)};d.prototype.worldBasisAtPosition=function(a,b,d){switch(b){case m.X:return c.vec3d.set(this.worldX,d);case m.Y:return c.vec3d.set(this.worldY,d);case m.Z:return c.vec3d.set(this.worldZ,d)}};d.prototype.intersectManifold=function(a,b,d,f){void 0===f&&(f=c.vec3d.create());k.plane.fromNormalAndOffset(this.worldZ,
-d,u);if(!k.plane.intersectRay(u,a,b,x)||0>c.vec3d.dot(c.vec3d.direction(x,a,v),b))return!1;c.vec3d.set(x,f);return!0};return d}(q),u=k.plane.create(),x=c.vec3d.create(),v=c.vec3d.create(),A=[0,0,0]})},"esri/views/3d/support/SharedSymbolResources":function(){define("require exports ../../../core/arrayUtils ../../../core/Handles ./ResourceController ./TextureCollection ../webgl-engine/lib/screenSizePerspectiveUtils".split(" "),function(q,h,e,a,d,b,g){Object.defineProperty(h,"__esModule",{value:!0});
q=function(){function f(a){this.streamDataSupplier=this.textures=null;this.graphicsOwners=[];this.screenSizePerspectiveHandles=null;var c=d.ClientType.SYMBOLOGY;this.viewState=a.viewState;this.stage=a.stage;this.pointsOfInterest=a.pointsOfInterest;this.resourceController=a.resourceController;this.streamDataSupplier=this.resourceController.getStreamDataSupplier(c);this.textures=new b(this.streamDataSupplier,a.stage,{preMultiplyAlpha:!0,wrapClamp:!0});this.screenSizePerspectiveSettings=g.getSettings(a.viewingMode);
this.screenSizePerspectiveSettingsLabels=g.getLabelSettings(a.viewingMode)}f.prototype.destroy=function(){this.streamDataSupplier=this.textures=this.streamDataSupplier=null};f.prototype.addGraphicsOwner=function(a){var b=this;if(!a)return{remove:function(){}};this.graphicsOwners.push(a);var c="layer"in a?a.watch("layer.screenSizePerspectiveEnabled",function(){return b.updateScreenSizePerspectiveEnabled()}):null;this.updateScreenSizePerspectiveEnabled();return{remove:function(){c&&(c.remove(),e.removeUnordered(b.graphicsOwners,
a),b.updateScreenSizePerspectiveEnabled())}}};f.prototype.updateScreenSizePerspectiveEnabled=function(){var b=this,c=this.graphicsOwners.some(function(a){return!0===a.get("layer.screenSizePerspectiveEnabled")});c&&!this.screenSizePerspectiveHandles?(this.screenSizePerspectiveHandles=new a,c=function(){return b.updateScreenSizePerspectiveSettings()},this.screenSizePerspectiveHandles.add([this.pointsOfInterest.centerOnSurfaceInfrequent.watch("distance",c,!0),this.viewState.events.on("camera-projection-changed",
c)]),this.updateScreenSizePerspectiveSettings()):!c&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),this.screenSizePerspectiveHandles=null)};f.prototype.updateScreenSizePerspectiveSettings=function(){c.distance=this.pointsOfInterest.centerOnSurfaceInfrequent.distance;c.fovY=this.viewState.camera.fovY;this.screenSizePerspectiveSettings.update(c);this.screenSizePerspectiveSettingsLabels.update(c);this.stage.setNeedsRender()};return f}();h.SharedSymbolResources=q;var c=
{distance:0,fovY:0};h.default=q})},"esri/views/3d/support/TextureCollection":function(){define("../../../core/declare ../../../core/lang ../../../core/urlUtils dojo/Deferred ../webgl-engine/Stage ../webgl-engine/lib/Texture ../webgl-engine/lib/Util".split(" "),function(q,h,e,a,d,b,g){var c=g.assert;return q(null,{constructor:function(a,b,c){this._streamDataSupplier=a;this._stage=b;this._textureRecords={};this._loadedHandler=this._loadedHandler.bind(this);this._errorHandler=this._errorHandler.bind(this);
this._textureOptions=c||{}},acquire:function(b,c,e){var f;if(f=this._textureRecords[b])return f.referenceCount++,f.texture||f.clientDfd;if(c)return e=c(b),this._stage.add(d.ModelContentType.TEXTURE,e),f={texture:e,referenceCount:1},this._textureRecords[b]=f,e;f=new a;c=this._streamDataSupplier.request(b,"image");this._textureRecords[b]={clientDfd:f,loaderDfd:c,texture:null,size:Math.ceil(e||0),referenceCount:1};c.then(this._loadedHandler,this._errorHandler);return f.promise},release:function(a){var b=
this._textureRecords[a];b?(1>b.referenceCount&&console.warn("TextureCollection: reference count is \x3c 1 for "+a),b.referenceCount--,1>b.referenceCount&&(b.texture?(this._stage.remove(d.ModelContentType.TEXTURE,b.texture.id),b.texture=null):this._streamDataSupplier.cancelRequest(b.loaderDfd),delete this._textureRecords[a])):console.warn("TextureCollection: texture doesn't exist: "+a)},isInUse:function(a){a=this._textureRecords[a];c(!a||0<a.referenceCount,"texture record with zero reference count");
return!!a},_loadedHandler:function(a,g){var f=this._textureRecords[a];c(f&&!f.texture);if(e.isSVG(a)&&(f.size||0===g.width&&0===g.height)){a=g.width?g.height/g.width:1;var k=f.size||64;1<a?(g.width=Math.round(k/a),g.height=k):(g.width=k,g.height=Math.round(k*a))}a=h.mixin({width:g.width,height:g.height},this._textureOptions);g=new b(g,"symbol",a);this._stage.add(d.ModelContentType.TEXTURE,g);f.texture=g;f.clientDfd.resolve(g)},_errorHandler:function(a){a=this._textureRecords[a];c(a&&!a.texture);a.clientDfd.reject()}})})},
"esri/views/3d/support/pointsOfInterest/PointsOfInterest":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/accessorSupport/decorators ../../../../geometry/Point ../../lib/glMatrix ../PropertiesPool ./CameraOnSurface ./CenterOnSurface ./ContentGeometryUpdates ./disposeMembers ./Focus ./StableSurfaceCenter ./SurfaceGeometryUpdates ../../webgl-engine/lib/Selector".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u,x){Object.defineProperty(h,"__esModule",{value:!0});var v=Array;q=function(d){function h(a){a=d.call(this,a)||this;a.handles=new b;a.surfaceAltitudeAtCenter=0;a.surfaceAltitudeAtCenterDirty=!0;a.surfaceAltitudeAtCenterWithContent=0;a.surfaceAltitudeAtCenterWithContentDirty=!0;a.propertiesPool=new k.default({pointOfView:c,renderPointOfView:v},a);a.updateSurfaceAltitudeFrequentInterval=y;a.updateSurfaceAltitudeInfrequentInterval=C;a.renderPointOfView=[0,0,
0];return a}e(h,d);h.prototype.initialize=function(){var a=this,b=this.view,c=b.state,d=b.basemapTerrain,f=b.renderCoordsHelper,b=b.map;this.surfaceSelector=new x(c.mode);this.surfaceSelector.enableBackfacesTerrain=c.isGlobal?!1:!0;this.surfaceSelector.enableInvisibleTerrain=!1;this.contentSelector=new x(c.mode);this.contentSelector.enableTerrain=!1;var e=this.estimateSurfaceAltitudeAtCenter.bind(this);this._set("centerOnSurfaceInfrequent",new l.default({state:c,surface:d,renderCoordsHelper:f,estimateSurfaceAltitudeAtCenter:e,
altitudeEstimationInterval:this.updateSurfaceAltitudeInfrequentInterval}));this._set("centerOnSurfaceFrequent",new l.default({state:c,surface:d,renderCoordsHelper:f,estimateSurfaceAltitudeAtCenter:e,altitudeEstimationInterval:this.updateSurfaceAltitudeFrequentInterval}));this._set("centerOnContent",new l.default({state:c,surface:d,renderCoordsHelper:f,estimateSurfaceAltitudeAtCenter:this.estimateSurfaceAltitudeAtCenterWithContent.bind(this),altitudeEstimationInterval:this.updateSurfaceAltitudeFrequentInterval}));
this._set("cameraOnSurface",new n.default({state:c,surface:d,renderCoordsHelper:f,altitudeEstimationInterval:this.updateSurfaceAltitudeInfrequentInterval,map:b}));this._set("surfaceGeometryUpdates",new u.default({state:c,surface:d,renderCoordsHelper:f,centerOnSurfaceInstances:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]}));this._set("contentGeometryUpdates",new p.default({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:f}));this._set("surfaceOrigin",
new t.default({view:this.view}));this._set("focus",new r.default({state:c,surface:d,renderCoordsHelper:f,centerOnSurface:this.centerOnSurfaceFrequent}));this.handles.add(c.watch("camera",function(b){return a.cameraChanged(b)},!0));this.handles.add(this.surfaceGeometryUpdates.events.on("request-update",function(){return a.updateCenterPointsOfInterest()}));this.handles.add(d.watch("extent",function(){return a.updateCenterPointsOfInterest()}));this.handles.add(this.contentGeometryUpdates.events.on("request-update",
function(){return a.updateCenterOnContent()}));this.cameraChanged(this.view.state.camera);this.forceUpdate()};h.prototype.destroy=function(){m.default(this,"handles","centerOnSurfaceInfrequent","centerOnSurfaceFrequent","cameraOnSurface","centerOnContent","surfaceOrigin","focus","propertiesPool")};Object.defineProperty(h.prototype,"pointOfView",{get:function(){var a=this.propertiesPool.get("pointOfView");this.view.renderCoordsHelper.fromRenderCoords(this.renderPointOfView,a,this.view.state.spatialReference);
return a},enumerable:!0,configurable:!0});h.prototype.forceUpdate=function(){this.surfaceGeometryUpdates.forceUpdate();this.centerOnSurfaceInfrequent.forceUpdate();this.centerOnSurfaceFrequent.forceUpdate();this.cameraOnSurface.forceUpdate();this.centerOnContent.forceUpdate();this.focus.forceUpdate()};h.prototype.hasPendingUpdates=function(){return this.surfaceGeometryUpdates.hasPendingUpdates()||this.centerOnContent.hasPendingUpdates()||this.centerOnSurfaceInfrequent.hasPendingUpdates()||this.cameraOnSurface.hasPendingUpdates()||
this.centerOnSurfaceFrequent.hasPendingUpdates()||this.focus.hasPendingUpdates()};h.prototype.estimateSurfaceAltitudeAtCenterWithContent=function(){if(!this.surfaceAltitudeAtCenterWithContentDirty)return this.surfaceAltitudeAtCenterWithContent;this.surfaceAltitudeAtCenterWithContentDirty=!1;var a=this.view.state.camera;this.view._stage.pickRay(a.eye,a.center,null,null,null,!1,this.contentSelector);this.contentSelector.minResult.getIntersectionPoint(A)?this.surfaceAltitudeAtCenterWithContent=this.view.renderCoordsHelper.getAltitude(A):
this.surfaceAltitudeAtCenterWithContent=this.estimateSurfaceAltitudeAtCenter();return this.surfaceAltitudeAtCenterWithContent};h.prototype.estimateSurfaceAltitudeAtCenter=function(){if(!this.view.basemapTerrain)return 0;if(!this.surfaceAltitudeAtCenterDirty)return this.surfaceAltitudeAtCenter;this.surfaceAltitudeAtCenterDirty=!1;var a=this.view.state.camera;this.surfaceSelector.init(null,a.eye,a.center,null,a,null,!1);this.view.basemapTerrain.intersect(this.surfaceSelector,a.eye,a.center);this.surfaceSelector.minResult.getIntersectionPoint(A)&&
(this.surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(A));return this.surfaceAltitudeAtCenter};h.prototype.cameraChanged=function(a){this.updateCenterPointsOfInterest(a);a=a.eye;this.renderPointOfView[0]===a[0]&&this.renderPointOfView[1]===a[1]&&this.renderPointOfView[2]===a[2]||this._set("renderPointOfView",f.vec3d.set(a,this.propertiesPool.get("renderPointOfView")))};h.prototype.updateCenterPointsOfInterest=function(a){void 0===a&&(a=this.view.state.camera);this.surfaceAltitudeAtCenterWithContentDirty=
this.surfaceAltitudeAtCenterDirty=!0;this.centerOnSurfaceFrequent.update(a);this.centerOnSurfaceInfrequent.update(a);this.cameraOnSurface.update(a);this.centerOnContent.update(a);this.focus.update(a)};h.prototype.updateCenterOnContent=function(){this.surfaceAltitudeAtCenterWithContentDirty=!0;this.centerOnContent.update(this.view.state.camera)};a([g.property({constructOnly:!0})],h.prototype,"updateSurfaceAltitudeFrequentInterval",void 0);a([g.property({constructOnly:!0})],h.prototype,"updateSurfaceAltitudeInfrequentInterval",
void 0);a([g.property({readOnly:!0})],h.prototype,"centerOnContent",void 0);a([g.property({readOnly:!0})],h.prototype,"centerOnSurfaceFrequent",void 0);a([g.property({readOnly:!0})],h.prototype,"centerOnSurfaceInfrequent",void 0);a([g.property({readOnly:!0})],h.prototype,"cameraOnSurface",void 0);a([g.property({readOnly:!0})],h.prototype,"focus",void 0);a([g.property({readOnly:!0})],h.prototype,"surfaceOrigin",void 0);a([g.property({readOnly:!0})],h.prototype,"contentGeometryUpdates",void 0);a([g.property({readOnly:!0,
dependsOn:["renderPointOfView"]})],h.prototype,"pointOfView",null);a([g.property({readOnly:!0})],h.prototype,"renderPointOfView",void 0);a([g.property({readOnly:!0})],h.prototype,"surfaceGeometryUpdates",void 0);a([g.property({constructOnly:!0})],h.prototype,"view",void 0);return h=a([g.subclass("esri.views.3d.support.PointsOfInterest")],h)}(g.declared(d));h.PointsOfInterest=q;var A=f.vec3d.create(),y=200,C=3E3;h.default=q})},"esri/views/3d/support/pointsOfInterest/CameraOnSurface":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/throttle ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/Point ../../lib/glMatrix ../PropertiesPool ./PointOfInterest".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n){Object.defineProperty(h,"__esModule",{value:!0});var l=Array;q=function(h){function n(a){a=h.call(this,a)||this;a.propertiesPool=new k.default({location:c,renderLocation:l},a);a.estimatedSurfaceAltitude=0;a.pendingElevationQuery=null;a.renderLocation=[0,0,0];return a}e(n,h);n.prototype.initialize=function(){var a=this;this.measureSurfaceAltitudeThrottle=d.throttle(this.measureSurfaceAltitude,this.altitudeEstimationInterval,this);this.handles.add(this.measureSurfaceAltitudeThrottle);
this.measureSurfaceAltitude();var c=function(){return a.measureSurfaceAltitudeThrottle()};this.map&&this.handles.add([b.on(this.map,"ground.layers","change",c,c,c)])};n.prototype.destroy=function(){this.cancelPendingRequest()};Object.defineProperty(n.prototype,"location",{get:function(){var a=this.propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,a,this.state.spatialReference);return a},enumerable:!0,configurable:!0});n.prototype.update=function(a){this.measureSurfaceAltitudeThrottle();
this.updateCameraOnSurface()};n.prototype.forceUpdate=function(){this.measureSurfaceAltitudeThrottle.forceUpdate();this.updateCameraOnSurface()};n.prototype.hasPendingUpdates=function(){return this.measureSurfaceAltitudeThrottle.hasPendingUpdates()||!!this.pendingElevationQuery};n.prototype.cancelPendingRequest=function(){var a=this.pendingElevationQuery;a&&(this.pendingElevationQuery=null,a.cancel())};n.prototype.measureSurfaceAltitude=function(){var a=this;this.cancelPendingRequest();if(this.map&&
this.map.ground){this.renderCoordsHelper.fromRenderCoords(this.state.camera.eye,m,this.state.spatialReference);var b=this.map.ground.queryElevation(m).then(function(b){a.updateSurfaceAltitude(b.geometry.z)}).catch(function(b){b&&"cancel"===b.dojoType||a.updateSurfaceAltitude(0)}).catch(function(){}).then(function(){a.pendingElevationQuery===b&&(a.pendingElevationQuery=null)});b.isFulfilled()||(this.pendingElevationQuery=b)}else this.updateSurfaceAltitude(0)};n.prototype.updateSurfaceAltitude=function(a){this.estimatedSurfaceAltitude!==
a&&(this.estimatedSurfaceAltitude=a,this.updateCameraOnSurface())};n.prototype.updateCameraOnSurface=function(){f.vec3d.set(this.state.camera.eye,p);this.renderCoordsHelper.setAltitude(this.estimatedSurfaceAltitude,p);var a=this._get("renderLocation");a[0]===p[0]&&a[1]===p[1]&&a[2]===p[2]||this._set("renderLocation",f.vec3d.set(p,this.propertiesPool.get("renderLocation")))};n.RELATIVE_ALTITUDE_CHANGE_THRESHOLD=.05;a([g.property({constructOnly:!0})],n.prototype,"altitudeEstimationInterval",void 0);
a([g.property({readOnly:!0,dependsOn:["renderLocation"]})],n.prototype,"location",null);a([g.property({constructOnly:!0})],n.prototype,"map",void 0);a([g.property({readOnly:!0})],n.prototype,"renderLocation",void 0);return n=a([g.subclass("esri.views.3d.support.CameraOnSurface")],n)}(g.declared(n.PointOfInterest));h.CameraOnSurface=q;var p=f.vec3d.create(),m=new c;h.default=q})},"esri/views/3d/support/pointsOfInterest/PointOfInterest":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/accessorSupport/decorators ./disposeMembers".split(" "),
function(q,h,e,a,d,b,g,c){Object.defineProperty(h,"__esModule",{value:!0});q=function(d){function f(a){a=d.call(this)||this;a.handles=new b;return a}e(f,d);f.prototype.destroy=function(){c.default(this,"handles")};a([g.property({constructOnly:!0})],f.prototype,"renderCoordsHelper",void 0);a([g.property({constructOnly:!0})],f.prototype,"surface",void 0);a([g.property({constructOnly:!0})],f.prototype,"state",void 0);return f=a([g.subclass("esri.views.3d.support.PointOfInterest")],f)}(g.declared(d));
h.PointOfInterest=q;h.default=q})},"esri/views/3d/support/pointsOfInterest/disposeMembers":function(){define(["require","exports","../../../../core/Accessor"],function(q,h,e){function a(a){for(var b=[],d=1;d<arguments.length;d++)b[d-1]=arguments[d];if(a instanceof e&&a.destroyed)try{throw Error("instance is already destroyed");}catch(k){console.warn(k.stack)}else for(d=0;d<b.length;d++){var c=b[d];if(!(c in a))throw Error("Property '"+c+"' does not exist and cannot be disposed");var f=a[c];f&&("function"===
typeof f.destroy?f.destroy():"function"===typeof f.dispose?f.dispose():"function"===typeof f.remove&&f.remove());a instanceof e&&c in a.__accessor__.metadatas?a._set(c,null):a[c]=null}}Object.defineProperty(h,"__esModule",{value:!0});h.disposeMembers=a;h.default=a})},"esri/views/3d/support/pointsOfInterest/CenterOnSurface":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/throttle ../../../../core/accessorSupport/decorators ../../../../geometry/Point ../../lib/glMatrix ../debugFlags ../earthUtils ../mathUtils ../PropertiesPool ./PointOfInterest".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p){Object.defineProperty(h,"__esModule",{value:!0});var m=Array;q=function(h){function p(a){a=h.call(this,a)||this;a.propertiesPool=new l.default({location:g,renderLocation:m},a);a.currentSurfaceAltitude=0;a.latestSurfaceAltitude=0;a.distance=0;a.renderLocation=[0,0,0];return a}e(p,h);u=p;p.prototype.initialize=function(){this.measureSurfaceAltitudeThrottle=d.throttle(this.measureSurfaceAltitude,this.altitudeEstimationInterval,this);this.handles.add(this.measureSurfaceAltitudeThrottle);
this.measureSurfaceAltitude()};Object.defineProperty(p.prototype,"location",{get:function(){var a=this.propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,a,this.state.spatialReference);return a},enumerable:!0,configurable:!0});p.prototype.update=function(a){this.measureSurfaceAltitudeThrottle();this.updateCenterOnSurface()};p.prototype.forceUpdate=function(){this.measureSurfaceAltitudeThrottle.forceUpdate();this.updateCenterOnSurface()};p.prototype.hasPendingUpdates=
function(){return this.measureSurfaceAltitudeThrottle.hasPendingUpdates()};Object.defineProperty(p.prototype,"estimatedSurfaceAltitude",{get:function(){return this.latestSurfaceAltitude},enumerable:!0,configurable:!0});p.prototype.measureSurfaceAltitude=function(){this.latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter();this.updateCenterOnSurface()};p.prototype.updateCenterOnSurface=function(){var a=r,b=this.calculateSurfaceIntersection(this.currentSurfaceAltitude,a),d=this.currentSurfaceAltitude!==
this.latestSurfaceAltitude;!b&&d&&(b=this.calculateSurfaceIntersection(this.latestSurfaceAltitude,a))&&(this.currentSurfaceAltitude=this.latestSurfaceAltitude);d=t;b&&this.latestSurfaceAltitudeChangesDistanceSignificantly(a,d)&&(c.vec3d.set(d,a),this.currentSurfaceAltitude=this.latestSurfaceAltitude);b?(b=c.vec3d.dist(this.state.camera.eye,a),b!==this._get("distance")&&this._set("distance",b)):(b=this.state.camera,c.vec3d.add(c.vec3d.scale(b.viewForward,this._get("distance"),a),b.eye));b=this._get("renderLocation");
b[0]===a[0]&&b[1]===a[1]&&b[2]===a[2]||this._set("renderLocation",c.vec3d.set(a,this.propertiesPool.get("renderLocation")))};p.prototype.calculateSurfaceIntersection=function(a,b){var d=this.state.camera;if(!this.renderCoordsHelper.intersectManifold(d.eye,d.viewForward,a,b))return!1;if(this.state.isGlobal){a=k.earthRadius+a;var f=c.vec3d.length2(d.eye),e=f<a*a,g=c.vec3d.dist(d.eye,b);e&&g>k.earthRadius/4&&c.vec3d.add(c.vec3d.scale(d.viewForward,a-Math.sqrt(f),b),d.eye)}else if(d=this.surface.ready&&
this.surface.extent)b[0]=n.clamp(b[0],d[0],d[2]),b[1]=n.clamp(b[1],d[1],d[3]);return!0};p.prototype.latestSurfaceAltitudeChangesDistanceSignificantly=function(a,b){if(this.latestSurfaceAltitude===this.currentSurfaceAltitude||null==a)return!1;if(this.calculateSurfaceIntersection(this.latestSurfaceAltitude,b)){var d=this.state.camera.eye;a=c.vec3d.dist(d,a);b=c.vec3d.dist(d,b);if(f.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS||Math.abs(b-a)/a>u.RELATIVE_ALTITUDE_CHANGE_THRESHOLD)return!0}return!1};var u;
p.RELATIVE_ALTITUDE_CHANGE_THRESHOLD=.05;a([b.property({constructOnly:!0})],p.prototype,"altitudeEstimationInterval",void 0);a([b.property({readOnly:!0})],p.prototype,"distance",void 0);a([b.property({constructOnly:!0})],p.prototype,"estimateSurfaceAltitudeAtCenter",void 0);a([b.property({readOnly:!0,dependsOn:["renderLocation"]})],p.prototype,"location",null);a([b.property({readOnly:!0})],p.prototype,"renderLocation",void 0);return p=u=a([b.subclass("esri.views.3d.support.CenterOnSurface")],p)}(b.declared(p.PointOfInterest));
h.CenterOnSurface=q;var r=c.vec3d.create(),t=c.vec3d.create();h.default=q})},"esri/views/3d/support/pointsOfInterest/ContentGeometryUpdates":function(){define(["require","exports","../../../../core/Handles","../Evented"],function(q,h,e,a){Object.defineProperty(h,"__esModule",{value:!0});q=function(){function b(b){this.handles=new e;this.events=new a.Evented;this.contentLayerViews=b.contentLayerViews;this.handles.add(this.contentLayerViews.on("change",this.layerViewsChanged.bind(this)));this.layerViewsChanged({added:this.contentLayerViews.toArray(),
removed:[],moved:[],target:this.contentLayerViews})}b.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};b.prototype.layerViewsChanged=function(a){var b=this;a.added.forEach(function(a){"esri.views.3d.layers.SceneLayerView3D"===a.declaredClass&&b.handles.add(a.on("visible-geometry-changed",b.contentChanged.bind(b)),a.uid)});a.removed.forEach(function(a){return b.handles.remove(a.uid)})};b.prototype.contentChanged=function(){this.events.emit("request-update",d)};
return b}();h.ContentGeometryUpdates=q;var d={};h.default=q})},"esri/views/3d/support/pointsOfInterest/Focus":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/accessorSupport/decorators ../../../../geometry/Point ../../lib/glMatrix ../mathUtils ../PropertiesPool ./PointOfInterest".split(" "),function(q,h,e,a,d,b,g,c,f,k){Object.defineProperty(h,"__esModule",{value:!0});var n=Array;q=function(h){function k(a){a=
h.call(this,a)||this;a.propertiesPool=new f.default({locationOnSurface:b,renderLocationOnSurface:n},a);a.centerOnSurface=null;return a}e(k,h);Object.defineProperty(k.prototype,"locationOnSurface",{get:function(){var a=this.propertiesPool.get("locationOnSurface");this.renderCoordsHelper.fromRenderCoords(this.renderLocationOnSurface,a,this.state.spatialReference);return a},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"renderLocationOnSurface",{get:function(){var a=this.centerOnSurface.renderLocation,
b=this.renderCoordsHelper,d=this.calculateScreenHorizontalEdgeOnSurface(r);g.vec3d.subtract(a,this.state.camera.eye,l);g.vec3d.normalize(l);b.worldUpAtPosition(a,p);var f=Math.abs(Math.acos(g.vec3d.dot(p,l))-.5*Math.PI),b=this.propertiesPool.get("renderLocationOnSurface"),f=1-c.clamp(f/(.5*Math.PI),0,1);g.vec3d.lerp(a,d,f*f*f,b);return b},enumerable:!0,configurable:!0});k.prototype.update=function(a){};k.prototype.forceUpdate=function(){};k.prototype.hasPendingUpdates=function(){return this.centerOnSurface.hasPendingUpdates()};
k.prototype.calculateScreenHorizontalEdgeOnSurface=function(a){var b=this.state.camera,c=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation),d=this.renderCoordsHelper.getAltitude(b.eye)>=c?b.padding[2]:b.fullHeight-b.padding[0];b.unprojectPoint([b.padding[3]+b.width/2,d,.5],m);d=g.vec3d.normalize(g.vec3d.subtract(m,b.eye,m));this.renderCoordsHelper.intersectManifold(b.eye,d,c,a)||(g.vec3d.set(b.eye,a),this.renderCoordsHelper.setAltitude(c,a));return a};a([d.property({constructOnly:!0})],
k.prototype,"centerOnSurface",void 0);a([d.property({readOnly:!0,dependsOn:["renderLocationOnSurface"]})],k.prototype,"locationOnSurface",null);a([d.property({readOnly:!0,dependsOn:["centerOnSurface.renderLocation"]})],k.prototype,"renderLocationOnSurface",null);return k=a([d.subclass("esri.views.3d.support.CenterOnSurface")],k)}(d.declared(k.PointOfInterest));h.Focus=q;var l=g.vec3d.create(),p=g.vec3d.create(),m=g.vec3d.create(),r=g.vec3d.create();h.default=q})},"esri/views/3d/support/pointsOfInterest/StableSurfaceCenter":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/Point ../../../../geometry/support/aaBoundingRect".split(" "),
function(q,h,e,a,d,b,g,c,f,k){Object.defineProperty(h,"__esModule",{value:!0});q=function(d){function h(a){a=d.call(this,a)||this;a.location=null;a._updatePromise=null;a._handles=new b;return a}e(h,d);Object.defineProperty(h.prototype,"renderLocation",{get:function(){if(!this.location)return null;var a=[0,0,0];this.view.renderCoordsHelper.toRenderCoords(this.location,a);return a},enumerable:!0,configurable:!0});h.prototype.initialize=function(){var a=this;this.view.state.isLocal&&(this._handles.add([this.watch(["surfaceView.spatialReference",
"surfaceView.extent"],function(){return a._update()}),g.on(this,"surface.layers","change",function(){return a._update()})]),this._update())};h.prototype.destroy=function(){this._handles.destroy()};h.prototype._update=function(){var a=this;this._updatePromise&&(this._updatePromise.cancel("cancel"),this._updatePromise=null);if(this.surfaceView&&this.surfaceView.extent&&this.surfaceView.spatialReference){var b=k.center(this.surfaceView.extent),b=new f({x:b[0],y:b[1],z:0,spatialReference:this.surfaceView.spatialReference});
this.surface&&0<this.surface.layers.length?(this._set("location",null),this._updatePromise=this.surface.queryElevation(b,{noDataValue:0}).then(function(b){a._updatePromise=null;a._set("location",b.geometry)}).catch(function(a){"cancel"===a||a&&"elevation-query:invalid-layer"===a.name||console.error("StableSurfaceCenter failed to update: ",a)})):this._set("location",b)}else this._set("location",null)};a([c.property({constructOnly:!0})],h.prototype,"view",void 0);a([c.property({readOnly:!0,aliasOf:"view.map.ground"})],
h.prototype,"surface",void 0);a([c.property({readOnly:!0,aliasOf:"view.basemapTerrain"})],h.prototype,"surfaceView",void 0);a([c.property({readOnly:!0})],h.prototype,"location",void 0);a([c.property({readOnly:!0,dependsOn:["location"]})],h.prototype,"renderLocation",null);return h=a([c.subclass("esri.views.3d.terrain.StableSurfaceCenter")],h)}(c.declared(d));h.StableSurfaceCenter=q;h.default=q})},"esri/views/3d/support/pointsOfInterest/SurfaceGeometryUpdates":function(){define("require exports ../../../../core/Handles ../../../../core/scheduling ../../../../geometry/support/aaBoundingRect ../../lib/glMatrix ../debugFlags ../Evented".split(" "),
function(q,h,e,a,d,b,g,c){Object.defineProperty(h,"__esModule",{value:!0});q=function(){function b(a){var b=this;this.handles=new e;this.tileGeometryUpdateExtent=d.empty();this.tileGeometryUpdateSpatialReference=null;this.hasPendingTileGeometryChanges=!0;this.events=new c.Evented;this.centerOnSurfaceInstances=a.centerOnSurfaceInstances;this.renderCoordsHelper=a.renderCoordsHelper;this.state=a.state;this.handles.add(a.surface.on("elevation-change",function(a){return b.tileGeometryChangeHandler(a)}))}
b.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};b.prototype.forceUpdate=function(){this.handles.has("tile-geometry-update")&&this.updateCenterOnGeometryUpdate();this.hasPendingTileGeometryChanges&&(this.events.emit("request-update",f),this.hasPendingTileGeometryChanges=!1)};b.prototype.hasPendingUpdates=function(){return this.handles.has("tile-geometry-update")};b.prototype.tileGeometryChangeHandler=function(b){var c=this;this.tileGeometryUpdateSpatialReference=
b.spatialReference;d.expand(this.tileGeometryUpdateExtent,b.tile.extent);this.handles.has("tile-geometry-update")||this.handles.add(a.schedule(function(){return c.updateCenterOnGeometryUpdate()}),"tile-geometry-update")};b.prototype.updateCenterOnGeometryUpdate=function(){this.handles.remove("tile-geometry-update");this.centerIntersectsExtent(this.tileGeometryUpdateExtent,this.tileGeometryUpdateSpatialReference)&&(g.DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES?this.hasPendingTileGeometryChanges=
!0:this.events.emit("request-update",f));d.empty(this.tileGeometryUpdateExtent)};b.prototype.furthestCenterOnSurface=function(){for(var a=this.centerOnSurfaceInstances[0],b=1;b<this.centerOnSurfaceInstances.length;b++){var c=this.centerOnSurfaceInstances[b];c.distance>a.distance&&(a=c)}return a};b.prototype.centerIntersectsExtent=function(a,b){var c=this.state.camera.eye,f=l,e=this.furthestCenterOnSurface();this.renderCoordsHelper.fromRenderCoords(c,k,b);this.renderCoordsHelper.fromRenderCoords(e.renderLocation,
n,b);k[0]<n[0]?(f[0]=k[0],f[2]=n[0]):(f[0]=n[0],f[2]=k[0]);k[1]<n[1]?(f[1]=k[1],f[3]=n[1]):(f[1]=n[1],f[3]=k[1]);return d.intersects(f,a)};return b}();h.SurfaceGeometryUpdates=q;var f={},k=b.vec3d.create(),n=b.vec3d.create(),l=d.empty();h.default=q})},"esri/views/3d/terrain/TerrainSurface":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/Accessor ../../../core/arrayUtils ../../../core/CollectionFlattener ../../../core/Handles ../../../core/Logger ../../../core/ObjectPool ../../../core/PooledArray ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../geometry/support/aaBoundingRect ../lib/glMatrix ../support/Evented ../support/mathUtils ../support/projectionUtils ../support/PromiseLightweight ../support/ResourceController ./OverlayManager ./PlanarTile ./SphericalTile ./SurfaceExtentHelper ./SurfaceTilingSchemeLogic ./TerrainConst ./TerrainRenderer ./terrainUtils ./TileGeometryFactory ./TilemapOnlyTile ./tileUtils ./tileUtils ../../vectorTiles/VectorTileDisplayObject ../../webgl/Texture".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u,x,v,A,y,C,B,D,E,J,F,M,H,I,K,O,P,L,U){function N(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]}function S(a){return a&&("cancel"===a||"cancel"===a.dojoType)}function aa(a,b){var c=!1;b=b||a;var d=0;for(a=a.children;d<a.length;d++){var f=a[d];if(f){for(var e in f.layerInfo)for(var g in f.layerInfo[e]){var h=f.layerInfo[e][g].upsampleFromTile;if(h&&h.tile===b)return!0}c=c||aa(f,b)}}return c}var V=t.vec3d,T=t.vec4d,Q=t.mat4d,G=H.weakAssert,X=k.getLogger("esri.views.3d.terrain.TerrainSurface");
q=function(b){function h(a,c){a=b.call(this)||this;a.defaultTileBackground=F.DEFAULT_TILE_BACKGROUND;a.hideSkirtsDistanceFromExtentMargin=Z;a.hideSkirtsMinimumCameraTilt=ea;a.hideSkirtsMaximumCameraTilt=fa;a._clippingExtent=null;a._dataExtent=null;a._elevationBounds=[0,0];a._rootExtent=r.create();a._iteratorPool=new n(P.IteratorPreorder);a._postorderIterator=new P.IteratorPostorder;a.visible=!1;a.suspended=!1;a._pendingUpdates=!1;a._lvPendingUpdates=!1;a._updateNextFrame=0;a._vectorTileLayerRequests=
0;a._memoryUsed=0;a._overlayOpacity=1;a._eyePosRenderSR=V.create();a._eyePosSurfaceSR=V.create();a._splitLimits=[0,0,0,0,0,0];a._frustumPlanes=Array(6);a._viewProjectionMatrix=Q.identity();a.tilemapStats={tilemapRequestsSent:0,tilemapRequestsPending:0,tilemapRequestErrors:0,fullTilemaps:0,emptyTilemaps:0,tilesRequested:0,tileRequestsSent:0,tileRequestErrors:0,tilesNotPresent:0};a._layerViews=[[],[]];a._layerIndexByLayerViewId=[{},{}];a._basemapLayerViewHandles={};a._handles=new f;a._frameUpdateLowerPrio=
new l({initialSize:500});a._topLevelTilemapOnlyTiles=Array(F.TILEMAP_SIZE_EXP+1);a.loaded=!1;a.maxTextureScale=1.2;a.rootTiles=null;a.backgroundImage=F.DEFAULT_TILE_BACKGROUND;a.backgroundColor=null;for(c=0;c<a._topLevelTilemapOnlyTiles.length;c++)a._topLevelTilemapOnlyTiles[c]=new K([c-F.TILEMAP_SIZE_EXP,0,0]);for(c=0;6>c;c++)a._frustumPlanes[c]=T.create();return a}e(h,b);h.prototype.normalizeCtorArgs=function(a,b){this._view=a;this._stage=a._stage;this._set("manifold",b);return{}};h.prototype.initialize=
function(){var a=this;this.tilePool="planar"===this.manifold?B.Pool:D.Pool;this._renderer=new M(this.manifold,null);this._renderer.loaded=this._setLoaded.bind(this);this._renderer.install(this._view._stage);p.init(this,"_background",function(){a._renderer.updateTileBackground(a._background)});this._handles.add(this._view.watch("pointsOfInterest",function(b){a._renderer.pointsOfInterest=b}));this._set("overlayManager",new C({terrainSurface:this,view:this._view}));this._handles.add(this.watch("overlayManager.hasHighlights",
this._handleHasHighlights.bind(this)),"overlayManager");var b={layers:this._view.map.allLayers,layerViews:this._view.allLayerViews,spatialReference:this._view.spatialReference};this.extentHelper="spherical"===this.manifold?new E.SurfaceExtentHelperGlobal(b):new E.SurfaceExtentHelperLocal(b);this._handles.add(p.init(this.extentHelper,"stencilEnabledExtents",function(b){a._renderer.setStencilEnabledLayerExtents(b)}),"extentHelper");b=this._view.defaultsFromMap?new c({root:this._view.map,rootCollectionNames:this._view.defaultsFromMap.mapCollectionPaths,
getChildrenFunction:function(a){return a.layers}}):this._view.map.allLayers;b=new J({layers:b,extentHelper:this.extentHelper,manifold:this.manifold,viewSpatialReference:this._view.spatialReference});this._set("tilingSchemeLogic",b);this._handles.add([this.tilingSchemeLogic.watch("tilingScheme",this._updateTilingSchemeAndExtent.bind(this),!0),this.tilingSchemeLogic.watch("extent",this._updateTilingSchemeAndExtent.bind(this),!0)],"tilingSchemeLogic");this._updateTilingSchemeAndExtent();this._streamDataSupplier=
this._view.resourceController.getStreamDataSupplier(y.ClientType.TERRAIN);this._handles.add(this._view.resourceController.registerFrameWorker(function(b){return a._frameUpdate(b)}));this._handles.add(this._view.resourceController.registerIdleFrameWorker({needsUpdate:function(){return a._needsIdleUpdate()},idleFrame:function(){return a._idleUpdate()}}));this._viewChangeUpdate=this._viewChangeUpdate.bind(this);this._view.resourceController.memoryEvents.on("quality-changed",function(){return a._viewChangeUpdate()});
this._handles.add([this._view.on("resize",this._viewChangeUpdate),this._view.watch("state.camera",this._viewChangeUpdate,!0),this._view.watch("qualitySettings.tiledSurface.lodBias",this._viewChangeUpdate),this._view.watch("clippingArea",this._clippingChanged.bind(this))],"view");this._handles.add(this._view.allLayerViews.on("change",this._handleLayerViewChanges.bind(this)),"allLayerViews");this._handleLayerViewChanges({added:this._view.allLayerViews.toArray(),removed:[],moved:[],target:this._view.allLayerViews});
this._updateClippingExtent();this.notifyChange("extent")};h.prototype.destroy=function(){this._handles.destroy();this._removeAllTiles();this.tilingSchemeLogic.destroy();this._set("tilingSchemeLogic",null);this.extentHelper.destroy();this.extentHelper=null;for(var a in this._basemapLayerViewHandles)this._unregisterTiledLayerView(a);this._streamDataSupplier=null;this.overlayManager&&(this.overlayManager.destroy(),this._set("overlayManager",null));this._renderer.destroy(this._stage);this._streamDataSupplier=
this._stage=this._view=this._renderer=null};Object.defineProperty(h.prototype,"renderer",{get:function(){return this._renderer},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"cullBackFaces",{set:function(a){this._renderer.cullBackFaces=a;this._set("cullBackFaces",a)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"extent",{get:function(){return this._clippingExtent||this._rootExtent},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"baseOpacity",
{set:function(a){this._renderer.opaque=1<=a;this._set("baseOpacity",a);this._updateTileTextures(!0)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"ready",{get:function(){return!!this.rootTiles},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"renderOrder",{set:function(a){this._renderer.renderOrder=a;this._set("renderOrder",a)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"skirtScale",{set:function(a){this._renderer.skirtScale=a;this._set("skirtScale",
a)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"_background",{get:function(){return null!=this.backgroundColor?this.backgroundColor:this.backgroundImage},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"velvetOverground",{set:function(a){a!==this.velvetOverground&&(this._renderer.velvetOverground=a);this._set("velvetOverground",a)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"wireframe",{set:function(a){this._renderer.setWireframe(a);
this._set("wireframe",a);this._view._stage.setRenderParams({earlyOcclusionPixelDraw:a})},enumerable:!0,configurable:!0});h.prototype.setVisibility=function(a){a!==this.visible&&(this.visible=a,this._renderer.setVisibility(a),this.setUpdatesDisabled(!a),a&&this._viewChangeUpdate())};h.prototype.isVisible=function(){return this.visible&&this.ready};h.prototype.isSeeThrough=function(){return!this._renderer.isOpaque()};h.prototype.setUpdatesDisabled=function(a){(this.suspended=a)||this._viewChangeUpdate()};
h.prototype.intersect=function(a,b,c){this._renderer.intersect(a,b,c,null)};h.prototype.getElevation=function(a){if(!this.ready)return null;var b=this.rootTiles;if(0===b[0].layerInfo[F.LayerClass.ELEVATION].length)return null;var c=ca;if(Array.isArray(a))c=a;else if("point"===a.type&&!v.pointToVector(a,c,this.tilingScheme.spatialReference))return X.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;for(var d,f=0;f<b.length;f++)if(a=b[f],O.isPosWithinTile(a,
c)){for(;a&&!a.renderData;)b=0,c[0]>.5*(a.extent[0]+a.extent[2])&&(b+=1),c[1]<.5*(a.extent[1]+a.extent[3])&&(b+=2),a=a.children[b];d=(b=a.renderData)&&b.geometryState?b.geometryState.samplerData:null;break}return d?I.elevationSampler(c[0],c[1],d):null};h.prototype.getElevationBounds=function(){return this._elevationBounds};h.prototype.getScale=function(a){if(this.tilingScheme){if(!v.pointToVector(a,ca,this.spatialReference))return X.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),
null;if(this.rootTiles)for(var b=0;b<this.rootTiles.length;b++)if(a=this.rootTiles[b],O.isPosWithinTile(a,ca)){for(;a.children[0];)b=0,ca[0]>a.children[0].extent[2]&&(b+=1),ca[1]<a.children[0].extent[1]&&(b+=2),a=a.children[b];return this._getLodBiasCorrectedScale(a.lij[0])}}return 1E100};h.prototype.queryVisibleScaleRange=function(a,b,c,d){b=b?this.tilingScheme.levelAtScale(b):0;c=c?this.tilingScheme.levelAtScale(c):Infinity;var f=this._getLodBias();this._renderer.queryVisibleLevelRange(a,b+f,c+
f,d)};h.prototype._setLoaded=function(){this.loaded||this._set("loaded",!0)};h.prototype._updateTilingSchemeAndExtent=function(){var a=this.tilingSchemeLogic.extent,b=this.tilingSchemeLogic.tilingScheme,c=!1;a&&!r.equals(a,this._dataExtent)&&(c=!0,this._dataExtent?r.set(this._dataExtent,a):this._dataExtent=r.create(a));b!==this.tilingScheme&&(G(!!b,"tiling scheme cannot be reset to undefined"),c=!0,this.tilingScheme&&this._removeAllTiles(),this._set("tilingScheme",b),this._updateClippingExtent(),
b&&(this._updateTiledLayers(),this._renderer.setTileSize(b.pixelSize[0]),this.overlayManager.setSpatialReference(b.spatialReference,"spherical"===this.manifold)));c&&this._updateRootTiles()};h.prototype._acquireTile=function(a,b,c,d){var f=this.tilePool.acquire();ja[0]=a;ja[1]=b;ja[2]=c;f.init(ja,d,this,this.tilingScheme);return f};h.prototype._releaseTile=function(a){a.dispose();a.parent=null;a.parentSurface=null;this.tilePool.release(a)};h.prototype._updateRootTiles=function(){var a=this,b=this._clippingExtent||
this._dataExtent,c=this.tilingScheme;if(b&&c){var d=ga,f=c.rootTilesInExtent(b,d,Infinity);if(this.rootTiles){if(f.length>R){X.warn(F.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR);return}var b=this.rootTiles.map(function(a){return a.lij}),e=g.difference(b,f,N);if(0<e.removed.length||0<e.added.length){var h=this.rootTiles.filter(function(b){return-1<g.findIndex(e.removed,N.bind(null,b.lij))?(a._purgeChildTiles(b),a._purgeTile(b),!1):!0});e.added.forEach(function(b){b=a._acquireTile(0,b[1],b[2],null);h.push(b);
a._loadTile(b)});this._set("rootTiles",h);this._renderer.setRootTiles(this.rootTiles)}}else f.length>R&&(X.warn(F.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR),f=c.rootTilesInExtent(b,d,R)),this._set("rootTiles",f.map(function(b){b=a._acquireTile(0,b[1],b[2],null);a._loadTile(b);return b})),this._renderer.setRootTiles(this.rootTiles);g.equals(d,this._rootExtent)||(this._rootExtent=r.create(d),this._hasFixedExtent()||this.notifyChange("extent"));this.setVisibility(!0);this._viewChangeUpdate();this.overlayManager.setOverlayDirty();
this.notifyChange("ready")}};h.prototype._viewChangeUpdate=function(){this._stage&&!this.suspended&&this.tilingScheme&&this.visible&&(this._updateViewDependentParameters(),this._updateSkirts(),this._updateOverlayOpacity(this._eyePosSurfaceSR[2]),this._updateTiles(this.rootTiles))};h.prototype._updateClippingStatus=function(a){a.updateClippingStatus(this._clippingExtent)&&a.pendingUpdates&ba.UPDATE_GEOMETRY&&(this._renderer.updateTileGeometryNeedsUpdate(a),this._updateTileGeometry(a),a.pendingUpdates&=
~ba.UPDATE_GEOMETRY)};h.prototype._updateTiles=function(a){var b=this._iteratorPool.acquire();b.reset(a);var c=this._splitLimits,d=this._frustumPlanes,f;O.hasVisibleSiblings(a)?(a=this._elevationBounds[0],f=this._elevationBounds[1]):(a=Infinity,f=-Infinity);for(;!b.done;){var e=b.next();this._updateClippingStatus(e);var g=!0;if(e.updateVisibility(d)){e.updateScreenDepth(this._viewProjectionMatrix);e.renderData&&(a=Math.min(e.elevationBounds[0],a),f=Math.max(e.elevationBounds[1],f));var h=e.shouldSplit(c,
this._eyePosRenderSR);h===ba.SPLIT?(e.pendingUpdates&=~ba.MERGE,e.renderData?(g=!1,e.pendingUpdates|=ba.SPLIT,b.skip()):g=!1):(e.pendingUpdates&=~ba.SPLIT,h===ba.VSPLITMERGE&&e.updateAgents(F.LayerClass.ELEVATION),b.skip())}else b.skip();if(g&&!e.renderData){e.pendingUpdates|=ba.MERGE;e.pendingUpdates&=~ba.SPLIT;g=this._iteratorPool.acquire();for(g.reset(e);!g.done;)h=g.next(),this._updateClippingStatus(h),h.updateVisibility(d),h.visible&&h.updateScreenDepth(this._viewProjectionMatrix);this._iteratorPool.release(g)}0!==
e.pendingUpdates&&(this._pendingUpdates=!0)}this._iteratorPool.release(b);isFinite(a)&&isFinite(f)&&(this._elevationBounds[0]!==a||this._elevationBounds[1]!==f)&&(this._elevationBounds[0]=a,this._elevationBounds[1]=f,this.emit("elevation-bounds-change",null))};h.prototype._updateViewDependentParameters=function(){var a=this._view.state.camera,b=Math.tan(.5*a.fovX),c=Math.tan(.5*a.fovY),d=this.tilingScheme.pixelSize,f=Math.pow(2,-this._getLodBias());this._splitLimits[0]=b;this._splitLimits[1]=d[0]/
a.width*this.maxTextureScale*f;this._splitLimits[2]=c;this._splitLimits[3]=d[1]/a.height*this.maxTextureScale*f;this._splitLimits[4]=this.tilingScheme.getMaxLod();this._splitLimits[5]=this._view.qualitySettings.tiledSurface.angledSplitBias;a.copyFrustumPlanes(this._frustumPlanes);Q.multiply(a.projectionMatrix,a.viewMatrix,this._viewProjectionMatrix);V.set(a.eye,this._eyePosRenderSR);v.vectorToVector(this._eyePosRenderSR,this._view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)};
h.prototype._updateSkirts=function(){H.autoUpdateSkirtsVisibility(this,this._eyePosSurfaceSR,this._view.state.camera.near)};h.prototype._setLayerViewsUpdating=function(){for(var a=0;a<F.LayerClass.LAYER_CLASS_COUNT;a++)for(var b=this._layerViews[a],c=0;c<b.length;c++)b[c].updatingChanged(this._pendingUpdates)};h.prototype._frameUpdateTraversal=function(a){if(this.suspended)return!1;this._frameUpdateLowerPrio.clear();this._pendingUpdates=!1;var b=this._renderer.resourceCounter.numTileTexturesComposited,
c=this._iteratorPool.acquire();c.reset(this.rootTiles);for(var d=!1,f=0;!(c.done||a.done()&&d)&&this._renderer.resourceCounter.numTileTexturesComposited-b<da;){var e=c.next(),f=f+e.memoryUsed;e.pendingUpdates&ba.MERGE?(this._mergeTile(e),e.pendingUpdates&=~ba.MERGE,d=!0,c.skip()):e.pendingUpdates&ba.SPLIT?(this._splitTile(e),e.pendingUpdates&=~ba.SPLIT,d=!0,c.skip()):0<e.pendingUpdates&&this._frameUpdateLowerPrio.push(e);0!==e.pendingUpdates&&(this._pendingUpdates=!0)}c.done?this._memoryUsed=f/1024/
1024:this._pendingUpdates=!0;this._iteratorPool.release(c);return d};h.prototype._updateTileGeometry=function(a){this._renderer._updateTileGeometry(a);this._elevationUpdate(a)};h.prototype._elevationUpdate=function(a){ha.spatialReference=this.spatialReference;ha.tile=a;ha.extent=a.extent;this.emit("elevation-change",ha);r.containsPoint(a.extent,this._eyePosSurfaceSR)&&this._updateSkirts()};h.prototype._updateTileTexture=function(a){this._renderer.updateTileTexture(a)};h.prototype._frameUpdate=function(a){if(this.rootTiles){for(var b=
this._frameUpdateTraversal(a);(!a.done()||!b)&&0<this._frameUpdateLowerPrio.length;){var c=this._frameUpdateLowerPrio.pop();c.pendingUpdates&ba.DECODE_ELEVATION?(this._decodeElevation(c),c.pendingUpdates&=~ba.DECODE_ELEVATION,b=!0):c.pendingUpdates&ba.UPDATE_GEOMETRY?(this._renderer.updateTileGeometryNeedsUpdate(c),this._updateTileGeometry(c),b=!0,c.pendingUpdates&=~ba.UPDATE_GEOMETRY):c.pendingUpdates&ba.UPDATE_TEXTURE&&(this._updateTileTexture(c),c.pendingUpdates&=~ba.UPDATE_TEXTURE,b=!0);0!==c.pendingUpdates&&
(this._pendingUpdates=!0)}0<this._frameUpdateLowerPrio.length&&(this._pendingUpdates=!0);if(this._streamDataSupplier.hasPendingDownloads()||0!==this._vectorTileLayerRequests)this._pendingUpdates=!0;this._pendingUpdates===this._lvPendingUpdates||!this._pendingUpdates&&20!==++this._updateNextFrame||(this._setLayerViewsUpdating(),this._lvPendingUpdates=this._pendingUpdates,this._updateNextFrame=0);b&&(this._memoryUsed=0)}};h.prototype._needsIdleUpdate=function(){return this.isVisible()&&this.overlayManager&&
this.overlayManager.overlaysNeedUpdate()};h.prototype._idleUpdate=function(){this.overlayManager.updateOverlays();this._updateOverlayOpacity(this._eyePosSurfaceSR[2])};h.prototype._updateClippingExtent=function(){if(!this.spatialReference)return!1;var a=r.create(),b=null;v.extentToBoundingRect(this._view.clippingArea,a,this.spatialReference)&&(b=a);if(g.equals(b,this._clippingExtent))return!1;this._clippingExtent=b;this._renderer.clippingExtent=b;this.notifyChange("extent");this._updateTileOverlayParams();
this.overlayManager.setOverlayDirty();return!0};h.prototype._clippingChanged=function(){this._updateClippingExtent()&&this._updateRootTiles()};h.prototype._getLodBias=function(){return Math.round(this._view.qualitySettings.tiledSurface.lodBias+2*this._view.resourceController.memoryFactor-2)};h.prototype._getLodBiasCorrectedScale=function(a){var b=this.tilingScheme.levels;a=x.clamp(a-this._getLodBias(),0,b.length-1);return b[a].scale};h.prototype._cancelTilemapRequests=function(a){for(var b=0;b<F.LayerClass.LAYER_CLASS_COUNT;b++){var c=
a.layerInfo[b];if(c)for(var d=0;d<c.length;d++){var f=c[d];f.tilemapRequest&&(f.tilemapRequest.cancel(),f.tilemapRequest=null)}}};h.prototype._removeAllTiles=function(){var a=this;this.rootTiles&&(this.rootTiles.forEach(function(b){a._purgeChildTiles(b);a._purgeTile(b)}),this._set("rootTiles",null),this.notifyChange("ready"));for(var b=0;b<this._topLevelTilemapOnlyTiles.length;b++)this._cancelTilemapRequests(this._topLevelTilemapOnlyTiles[b]);this.setVisibility(!1)};h.prototype._purgeChildTiles=function(a){var b=
this._postorderIterator;for(b.reset(a);!b.done;){for(var c=b.next(),d=0;4>d;d++)c.children[d]=null;c!==a&&this._purgeTile(c)}};h.prototype._purgeTile=function(a){a.unload(this._renderer);this._cancelTilemapRequests(a);a.parent=null;this._releaseTile(a)};h.prototype._splitTile=function(a){var b=a.lij[0]+1,c=2*a.lij[1],d=2*a.lij[2];a.children[0]=this._createTile(b,c,d,a);a.children[1]=this._createTile(b,c,d+1,a);a.children[2]=this._createTile(b,c+1,d,a);a.children[3]=this._createTile(b,c+1,d+1,a);a.unload(this._renderer);
W.spatialReference=this.spatialReference;W.extent=a.extent;W.scale=this._getLodBiasCorrectedScale(b);this.emit("scale-change",W)};h.prototype._createTile=function(a,b,c,d){G(!!d,"_createTile sanity check");a=this._acquireTile(a,b,c,d);a.updateClippingStatus(this._clippingExtent);a.updateVisibility(this._frustumPlanes);a.visible&&(a.updateScreenDepth(this._viewProjectionMatrix),a.shouldSplit(this._splitLimits,this._eyePosRenderSR)===ba.SPLIT&&(a.pendingUpdates|=ba.SPLIT,this._pendingUpdates=!0));this._loadTile(a);
return a};h.prototype._mergeTile=function(a){G(!a.renderData,"_mergeTile sanity check");this._loadTile(a);this._purgeChildTiles(a);W.spatialReference=this.spatialReference;W.extent=a.extent;W.scale=this._getLodBiasCorrectedScale(a.lij[0]);this.emit("scale-change",W)};h.prototype._loadTile=function(a){a.load(this._renderer);this.overlayManager&&this.overlayManager.hasOverlays()&&this.overlayManager.setOverlayParamsOfTile(a,a.renderData,this._overlayOpacity);this._elevationUpdate(a)};h.prototype._handleHasHighlights=
function(a){this._renderer.setNeedsHighlight(a)};h.prototype._decodeElevation=function(a){var b=a.layerInfo[F.LayerClass.ELEVATION];if(b)for(var c=0;c<b.length;c++){var d=b[c];d.pendingUpdates&=~ba.DECODE_ELEVATION;if(d.rawData){var f=a.decodeElevationData(d.rawData);d.rawData=null;if(f){d.data=f;var d=a.lij[0],e=this._iteratorPool.acquire();for(e.reset(a);!e.done;){var g=e.next();g.findElevationBoundsForLayer(c,d);g.computeElevationBounds()}this._iteratorPool.release(e);a.dataArrived(c,F.LayerClass.ELEVATION,
f);this._updateTiles(a)}}}};h.prototype._handleLayerViewChanges=function(a){var b=this,c=!1;a.added.forEach(function(a){var d=a.layer;H.isTiledLayerView(a)?(b._registerTiledLayer(a),d.loaded&&(c=!0)):a.supportsDraping&&b.overlayManager&&b.overlayManager.registerLayerView(a)});a.removed.forEach(function(a){H.isTiledLayerView(a)?(c=!0,b._unregisterTiledLayerView(a.uid)):a.supportsDraping&&b.overlayManager&&b.overlayManager.unregisterLayerView(a)});(c=c||0<a.moved.filter(H.isTiledLayerView).length)&&
this._updateTiledLayers()};h.prototype._registerTiledLayer=function(a){var b=this,c=[];c.push(a.watch("suspended",function(){b._updateTiledLayers()}));c.push(a.watch("fullOpacity",function(){return b._updateTileTextures()}));a.on("data-changed",function(){var c=H.isElevationLayerView(a)?F.LayerClass.ELEVATION:F.LayerClass.MAP,d=b._layerIndexByLayerViewId[c][a.uid];null!=d&&b._invalidateLayerData(d,c)});this._basemapLayerViewHandles[a.uid]=c};h.prototype._unregisterTiledLayerView=function(a){var b=
this._basemapLayerViewHandles[a];if(b){for(var c=0;c<b.length;c++)b[c].remove();delete this._basemapLayerViewHandles[a]}};h.prototype._updateTiledLayers=function(){var a=this;if(this.tilingScheme){var b=this._view.allLayerViews,c=[[],[]],d=F.LayerClass,f=null,e=r.empty();b.forEach(function(b){var g=b.layer;if(b.layer&&b&&!b.suspended&&H.isTiledLayerView(b)){var h=b.fullExtent;h?a.tilingScheme.compatibleWith(b.tileInfo)?(r.expand(e,h),H.isElevationLayerView(b)?c[d.ELEVATION].push(b):(Infinity!==b.maxDataLevel&&
(null===f||b.maxDataLevel>f)&&(f=b.maxDataLevel),c[d.MAP].push(b))):X.warn("Terrain: tiling scheme of layer "+g.id+" is incompatible with other tiled layers, will not be drawn"):X.warn("Terrain: Map or elevation layer does not have fullExtent: "+g.id)}},this);for(var b=function(a){var b=g._layerViews[a],f=c[a];f.reverse();var e=b.length!==f.length,h=f.length,k=Array(h),l=Array(b.length);g._layerIndexByLayerViewId[a]={};for(var m=0;m<h;m++){g._layerIndexByLayerViewId[a][f[m].uid]=m;var n=b.indexOf(f[m]);
k[m]=n;m!==n&&(e=!0);-1<n&&(l[n]=m)}if(e){g._topLevelTilemapOnlyTiles.forEach(function(b){return b.modifyLayers(l,k,a)});b=g._postorderIterator;if(g.rootTiles)for(b.reset(g.rootTiles);!b.done;)b.next().modifyLayers(l,k,a);g._layerViews[a]=f;if(g.rootTiles){for(b.reset(g.rootTiles);!b.done;)f=b.next(),f.restartAgents(a),a===d.ELEVATION&&f.computeElevationBounds();g._updateTiles(g.rootTiles)}}},g=this,h=0;h<d.LAYER_CLASS_COUNT;h++)b(h);this.tilingScheme.levels.length-1<f&&(this.tilingScheme.ensureMaxLod(f),
this._viewChangeUpdate())}};h.prototype._hasFixedExtent=function(){return!!this._clippingExtent};h.prototype.layerViewByIndex=function(a,b){return this._layerViews[b][a]};h.prototype.numLayers=function(a){return this._layerViews[a].length};h.prototype._updateTileTextures=function(a){void 0===a&&(a=!1);var b=this._iteratorPool.acquire();for(b.reset(this.rootTiles);!b.done;)b.next().updateTexture(a);this._iteratorPool.release(b)};h.prototype._invalidateLayerData=function(a,b){var c=this._iteratorPool.acquire();
for(c.reset(this.rootTiles);!c.done;)c.next().removeLayerAgent(a,b);for(c.reset(this.rootTiles);!c.done;)c.next().invalidateLayerData(a,b);this._iteratorPool.release(c)};h.prototype.setPendingUpdates=function(){this._pendingUpdates=!0};h.prototype.requestTileData=function(a,b,c){var d=this;this.tilemapStats.tilesRequested++;var f=this.layerViewByIndex(b,c),e=f.layer;if(e.tilemapCache&&!H.isVectorTileLayerView(f)){var g=this.getTilemapTile(a),h=g.layerInfo[c][b];if(h.tilemap){if(!g.tileDataAvailable(a,
b,c))return this.tilemapStats.tilesNotPresent++,this._dispatchDataEvent(a,"dataMissing",c,f,{notInTilemap:!0}),b=new A.Promise,b.reject(),b}else{h.tilemapRequest||(h.tilemapRequest=this.requestTilemap(g,b,c,f,e));var k,l=new A.Promise(function(){k&&k.cancel()});h.tilemapRequest.always(function(){h.tilemapRequest=null;if(!l.isCancelled()){var b=d._layerIndexByLayerViewId[c][f.uid];null!=b&&(g.tileDataAvailable(a,b,c)?(k=d._requestTileData(a,b,c,f),k.then(function(){return l.resolve()})):(d.tilemapStats.tilesNotPresent++,
d._dispatchDataEvent(a,"dataMissing",c,f,{notInTilemap:!0}),l.reject()))}});return l}}return this._requestTileData(a,b,c,f)};h.prototype._requestTileData=function(a,b,c,d){this.tilemapStats.tileRequestsSent++;return c===F.LayerClass.ELEVATION?this._requestElevationTileData(a,b,c,d):this._requestMapTileData(a,b,c,d)};h.prototype._requestElevationTileData=function(a,b,c,d){var f=this;if(H.isElevationLayerView(d)){var e=function(b){var e=f._layerIndexByLayerViewId[c][d.uid];null!=e?(e=a.layerInfo[c][e],
e.rawData=b,a.pendingUpdates|=ba.DECODE_ELEVATION,e.pendingUpdates|=ba.DECODE_ELEVATION,f._pendingUpdates=!0):X.warn("TerrainSurface: received data from unknown layer %d %s",c,a.lij.toString())};b=function(b){S(b)||(f.tilemapStats.tileRequestErrors++,f._dispatchDataEvent(a,"dataMissing",c,d,b))};var g=d.layer;if(H.useFetchTileForLayer(g))return g=g.fetchTile(a.lij[0],a.lij[1],a.lij[2],F.ELEVATION_NODATA_VALUE),g.then(function(a){return e(a)},b),g;g=d.getTileUrl(a.lij[0],a.lij[1],a.lij[2]);g=this._streamDataSupplier.request(g,
"binary");g.then(function(a,b){b.url=a;e(b)},b);return g}G(!1,"_requestElevationTileData can only be called for elevation layer views")};h.prototype._requestMapTileData=function(a,b,c,d){var f=this,e=function(b){return f._dispatchDataEvent(a,"dataArrived",c,d,b)};b=function(b){S(b)||(f._dispatchDataEvent(a,"dataMissing",c,d,b),f.tilemapStats.tileRequestErrors++)};if(H.isVectorTileLayerView(d)){var g=d.tileHandler,h=d.schemeHelper.getCompatibleLevelRowCol(a.lij),h=g.getVectorTileWithLRC(h[0],h[1],
h[2],0);h.then(e).catch(b).always(function(){f._vectorTileLayerRequests=g.ongoingRequestCount});this._vectorTileLayerRequests=g.ongoingRequestCount;return h}if(H.useFetchTileForLayer(d.layer)&&H.isTileLayerView(d))return h=d.layer.fetchTile(a.lij[0],a.lij[1],a.lij[2],{allowImageDataAccess:!0}),h.then(e).catch(b),h;h=d.getTileUrl(a.lij[0],a.lij[1],a.lij[2]);null!=d.refreshInterval&&d.refreshTimestamp&&(h+=(-1<h.indexOf("?")?"\x26":"?")+"_ts\x3d"+d.refreshTimestamp);h=this._streamDataSupplier.request(h,
"image");h.then(function(a,b){return e(b)},b);return h};h.prototype.requestTilemap=function(a,b,c,d,f){var e=this,g=a.lij[0]+F.TILEMAP_SIZE_EXP,h=a.lij[1]<<F.TILEMAP_SIZE_EXP,k=a.lij[2]<<F.TILEMAP_SIZE_EXP;this.tilemapStats.tilemapRequestsSent++;this.tilemapStats.tilemapRequestsPending++;return f.tilemapCache.fetchTilemap(g,h,k,{timeout:6E3}).then(function(f){e.tilemapStats.tilemapRequestsPending--;b=e._layerIndexByLayerViewId[c][d.uid];null!=b&&(a.layerInfo[c][b].tilemap=f)}).catch(function(a){e.tilemapStats.tilemapRequestsPending--;
e.tilemapStats.tilemapRequestErrors++})};h.prototype.getTilemapTile=function(a){var b=a.lij[0];return b>F.TILEMAP_SIZE_EXP?O.getTileNLevelsUp(a,F.TILEMAP_SIZE_EXP):this._topLevelTilemapOnlyTiles[b]};h.prototype._dispatchDataEvent=function(a,b,c,d,f){d=this._layerIndexByLayerViewId[c][d.uid];if(null!=d)a[b](d,c,f);else X.warn("TerrainSurface: received data from unknown layer")};h.prototype._updateTileOverlayParams=function(){if(this.rootTiles){var a=this._iteratorPool.acquire();for(a.reset(this.rootTiles);!a.done;){var b=
a.next();b.renderData&&this.overlayManager&&this.overlayManager.setOverlayParamsOfTile(b,b.renderData,this._overlayOpacity)}this._iteratorPool.release(a);this._renderer.setNeedsRender()}};h.prototype._updateOverlayOpacity=function(a){if(this.overlayManager&&(a=this.overlayManager.updateOpacity(a),!isNaN(a))){if(a!==this._overlayOpacity&&this.rootTiles){var b=this._iteratorPool.acquire();for(b.reset(this.rootTiles);!b.done;){var c=b.next();c.renderData&&(c.renderData.overlayOpacity=a)}this._iteratorPool.release(b)}this._overlayOpacity=
a;this._renderer.setNeedsRender()}};h.prototype.getStats=function(){var a=0,b=0,c=0,d=[],f=this._iteratorPool.acquire();for(f.reset(this.rootTiles);!f.done;){var e=f.next();a++;e.renderData&&(b++,e.visible&&(c++,e=e.lij[0],d[e]=null!=d[e]?d[e]+1:1))}this._iteratorPool.release(f);return{numNodes:a,numLeaves:b,numVisible:c,numVisiblePerLevel:d}};h.prototype.getUsedMemory=function(){if(!this.tilingScheme)return 0;if(0<this._memoryUsed)return this._memoryUsed;var a=this._iteratorPool.acquire();for(a.reset(this.rootTiles);!a.done;){var b=
a.next();this._memoryUsed+=b.memoryUsed}this._iteratorPool.release(a);return this._memoryUsed/=1048576};h.prototype.getMemoryUsage=function(){if(!this.tilingScheme)return{};var a=0,b=0,c=0,d=0,f=0,e=0,g=this._iteratorPool.acquire();g.reset(this.rootTiles);for(var h=this.tilingScheme.pixelSize,h=h[0]*h[1]*4;!g.done;){for(var k=g.next(),l=aa(k),m=0,n=k.layerInfo[F.LayerClass.MAP];m<n.length;m++){var p=n[m],p=p.data,r=0,u=0;p instanceof U?r+=1.3*p.descriptor.width*p.descriptor.height*4:p instanceof HTMLImageElement?
u+=h:p instanceof L&&(e+=p.getGpuMemoryUsage(),c+=p.getCpuMemoryUsage());k.renderData||l?(a+=u,d+=r):(b+=u,f+=r)}l=0;for(m=k.layerInfo[F.LayerClass.ELEVATION];l<m.length;l++)p=m[l],p=p.data,a+=p?h:0;k.renderData&&(p=k.renderData.texture,d+=p&&p.descriptor?1.3*p.descriptor.width*p.descriptor.height*4:0,k=k.renderData.estimateGeometryMemoryUsage(),e+=k,c+=k)}this._iteratorPool.release(g);return{cpuVisibleImageData:a,cpuInvisibleImageData:b,cpuGeometryData:c,gpuVisibleImageData:d,gpuInvisibleImageData:f,
gpuGeometryData:e}};h.prototype.hasPendingUpdates=function(){if(this._streamDataSupplier.hasPendingDownloads()||0!==this._vectorTileLayerRequests)return!0;var a=this._iteratorPool.acquire();for(a.reset(this.rootTiles);!a.done;)if(0<a.next().pendingUpdates)return this._iteratorPool.release(a),!0;this._iteratorPool.release(a);return!1};h.prototype.getTile=function(a){var b=a.split("/").map(function(a){return+a});if(0===b[0])return this.rootTiles.forEach(function(a){if(a.lij[1]===b[1]&&a.lij[2]===b[2])return a}),
null;var c=Math.pow(2,b[0]),d=Math.floor(b[1]/c),f=Math.floor(b[2]/c),e;this.rootTiles.some(function(a){return a.lij[1]===d&&a.lij[2]===f?(e=a,!0):!1});if(e){for(c=1<<b[0]-1;e.lij[0]<b[0];){var g=b[1]&c?2:0;0<(b[2]&c)&&g++;if(!e.children[g])return console.log("Tile "+a+" doesn't exist, smallest ancestor is "+O.tile2str(e)),null;e=e.children[g];c>>=1}G(e.lij[0]===b[0]&&e.lij[1]===b[1]&&e.lij[2]===b[2],"not the right tile?");return e}return null};h.prototype.setBorders=function(a){this._renderer.drawBorders=
a};h.prototype.setDisableRendering=function(a){this._renderer.disableRendering=a};a([m.property({value:!1})],h.prototype,"cullBackFaces",null);a([m.property({readOnly:!0})],h.prototype,"extent",null);a([m.property({readOnly:!0})],h.prototype,"loaded",void 0);a([m.property({value:1})],h.prototype,"baseOpacity",null);a([m.property({readOnly:!0})],h.prototype,"overlayManager",void 0);a([m.property({readOnly:!0})],h.prototype,"manifold",void 0);a([m.property()],h.prototype,"maxTextureScale",void 0);a([m.property({readOnly:!0})],
h.prototype,"ready",null);a([m.property({value:1})],h.prototype,"renderOrder",null);a([m.property({readOnly:!0})],h.prototype,"rootTiles",void 0);a([m.property({value:!0})],h.prototype,"skirtScale",null);a([m.property({readOnly:!0,aliasOf:"tilingScheme.spatialReference"})],h.prototype,"spatialReference",void 0);a([m.property({})],h.prototype,"backgroundImage",void 0);a([m.property({type:d})],h.prototype,"backgroundColor",void 0);a([m.property({dependsOn:["backgroundColor","backgroundImage"]})],h.prototype,
"_background",null);a([m.property({readOnly:!0})],h.prototype,"tilingScheme",void 0);a([m.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],h.prototype,"tilingSchemeLocked",void 0);a([m.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeDone"})],h.prototype,"tilingSchemeDone",void 0);a([m.property({readOnly:!0})],h.prototype,"tilingSchemeLogic",void 0);a([m.property({value:!0})],h.prototype,"velvetOverground",null);a([m.property({value:!1})],h.prototype,"wireframe",
null);return h=a([m.subclass("esri.views.3d.terrain.TerrainSurface")],h)}(m.declared(b,u.Evented));var Z=1.2,ea=80/180*Math.PI,fa=110/180*Math.PI,R=F.MAX_ROOT_TILES,da=12,ba=F.TileUpdateTypes,ca=T.create(),ga=r.create(),ja=[0,0,0],ha={spatialReference:null,tile:null,extent:null},W={spatialReference:null,extent:null,scale:0};return q})},"esri/views/3d/terrain/OverlayManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/on ../../../Graphic ../../../core/Accessor ../../../core/Handles ../../../core/Logger ../../../core/accessorSupport/decorators ../../../geometry/Point ../../../geometry/support/aaBoundingRect ../../../symbols/SimpleMarkerSymbol ../lib/glMatrix ../state/utils/viewUtils ../support/debugFlags ../support/debugFlags ../support/earthUtils ../support/mathUtils ../support/projectionUtils ../webgl-engine/lib/Selector ../webgl-engine/lib/Util".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u,x,v,A,y,C){var B=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]],D=f.getLogger("esri.views.3d.OverlayManager"),E,J=function(f){function g(){var a=null!==f&&f.apply(this,arguments)||this;a._handles=new c;a._overlaySR=null;a._renderSR=null;a._overlaySREqualsRenderSR=!0;a._connectedLayers={};a._scale=0;a._dirty=!1;a._isSpherical=!1;a._latestOriginId=0;a.opacity=0;return a}
e(g,f);Object.defineProperty(g.prototype,"hasHighlights",{get:function(){return this._renderer.hasHighlights},enumerable:!0,configurable:!0});g.prototype.initialize=function(){var a=this;this._stage=this.view._stage;this._renderer=this._stage.getDrapedTextureRenderer();this._renderer.onHasHighlightsChanged=function(){return a.onHasHighlightsChanged()};this._renderer.onContentChanged=function(){return a.setOverlayDirty()};this.groundSelector=new y(this.view.viewingMode);this.groundSelector.enableBackfacesTerrain=
!0;this.groundSelector.enableInvisibleTerrain=!0;this.groundSelector.enableHUDSelection=!1;this._handles.add(this.view.watch(["pointsOfInterest.renderPointOfView","pointsOfInterest.centerOnSurfaceFrequent.location"],function(){return a.setOverlayDirty()}));this._handles.add(this.view.on("resize",function(){return a.setOverlayDirty()}))};g.prototype.destroy=function(){for(var a in this._connectedLayers)this.unregisterLayerView(this._connectedLayers[a].layerView);this._disposeOverlays();this._handles&&
(this._handles.destroy(),this._handles=null)};g.prototype.onHasHighlightsChanged=function(){this.setOverlayDirty();this.notifyChange("hasHighlights")};g.prototype.hasOverlays=function(){return!!this._overlays};g.prototype.setSpatialReference=function(a,b){(this._overlaySR=a)?(this._renderSR=this.view.renderSpatialReference,this._overlaySREqualsRenderSR=this._overlaySR.equals(this._renderSR),this._longitudeCyclical=(this._isSpherical=b)?a.isWebMercator?new v.Cyclical(-2.0037508342788905E7,2.0037508342788905E7):
new v.Cyclical(-180,180):null):(this._disposeOverlays(),this._longitudeCyclical=null)};g.prototype.registerLayerView=function(a){var b=this,c=a.layer.uid;if(this._connectedLayers[c])D.warn("[OverlayManager#registerLayerView]: Layer "+c+" is already connected");else{var f=d(a,"draped-data-change",function(){return b.setOverlayDirty()});this._connectedLayers[c]={eventHandles:[f],layerView:a};a.setDrapingExtent&&this._overlays&&[this._overlays.inner,this._overlays.outer].forEach(function(c,d){a.setDrapingExtent(d,
c.extent,b._overlaySR,c.resolution,c.renderLocalOrigin)});this.setOverlayDirty();this._setLayerViewOverlayUpdating(a,this._dirty)}};g.prototype.unregisterLayerView=function(a){for(var b in this._connectedLayers){var c=this._connectedLayers[b];if(c.layerView===a){if(c.eventHandles)for(var d=0;d<c.eventHandles.length;d++)c.eventHandles[d].remove();delete this._connectedLayers[b];this.setOverlayDirty();a.destroyed||(a.overlayUpdating=!1)}}};g.prototype.setOverlayDirty=function(){this._dirty||(this._setOverlayUpdating(!0),
this._dirty=!0)};g.prototype._setLayerViewOverlayUpdating=function(a,b){if(!b||!a.suspended&&a.hasDraped)a.overlayUpdating=b};g.prototype._setOverlayUpdating=function(a){for(var b in this._connectedLayers)this._setLayerViewOverlayUpdating(this._connectedLayers[b].layerView,a);if(b=this.view.graphicsView)b.overlayUpdating=a};g.prototype.updateOverlays=function(){if(this._overlaySR){var a;a=Math.max(this.view.width,this.view.height);a=C.nextHighestPowerOfTwo(a+256);a=Math.min(a,2048);this._computeOverlayExtents(a,
O);this._overlays||this._initOverlays();this._updateOverlay(this._overlays.inner,0,O.inner,a);this._updateOverlay(this._overlays.outer,1,O.outer,a);this.opacity=1;this._setOverlayUpdating(!1);this._drawOverlays();this.terrainSurface._updateTileOverlayParams();this._dirty=!1}};g.prototype._updateOverlay=function(a,b,c,d){var f;a:{f=a.extent;for(var e=t.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS?0:J.EXTENTS_DIFFER_THRESHOLD*Math.max(c[2]-c[0],c[3]-c[1],f[2]-f[0],f[3]-f[1]),g=0;4>g;g++)if(Math.abs(f[g]-
c[g])>e){f=!0;break a}f=!1}if(f||d!==a.resolution){l.set(a.extent,c);a.resolution=d;a.renderLocalOrigin={id:"OV_"+this._latestOriginId++,vec3:l.center(a.extent,m.vec3d.create())};for(var h in this._connectedLayers)f=this._connectedLayers[h].layerView,f.setDrapingExtent&&f.setDrapingExtent(b,c,this._overlaySR,d,a.renderLocalOrigin)}};g.prototype.overlaysNeedUpdate=function(){return this._dirty&&!!this._overlaySR};g.prototype.updateOpacity=function(a){var b=1;if(this._overlays){var c=this._scale;3.5*
a<c&&(b=Math.sqrt(v.clamp((a-c/10)/(c/3.5-c/10),0,1)))}return b};g.prototype.setOverlayParamsOfTile=function(a,b,c){var d=this._overlays.inner,f=this._overlays.outer;a=l.intersection(a.extent,a.parentSurface.extent,P);this._rectInsideRect(a,d.extent)?(this._setTileOverlayData(a,d,b.overlays[0]),this._invalidateTileOverlayData(b.overlays[1])):this._rectanglesOverlap(a,d.extent)?(this._setTileOverlayData(a,d,b.overlays[0]),this._setTileOverlayData(a,f,b.overlays[1])):(this._rectanglesOverlap(a,f.extent)?
this._setTileOverlayData(a,f,b.overlays[0]):this._invalidateTileOverlayData(b.overlays[0]),this._invalidateTileOverlayData(b.overlays[1]));b.overlayOpacity=void 0!==c?c:1};g.prototype._setTileOverlayData=function(a,b,c){var d=b.extent;c.texScale[0]=(a[2]-a[0])/(d[2]-d[0]);c.texScale[1]=(a[3]-a[1])/(d[3]-d[1]);var f=a[0];if(this._longitudeCyclical){var f=this._longitudeCyclical.minimalMonotonic(d[0],f),e=this._longitudeCyclical.minimalMonotonic(d[0],a[2]);f>e&&(f=e-(a[2]-a[0]))}c.texOffset[0]=(f-d[0])/
(d[2]-d[0]);c.texOffset[1]=(a[1]-d[1])/(d[3]-d[1]);c.renderTargetId=b.valid?b.renderTargetId:null;c.highlightRenderTargetId=b.highlightValid?b.highlightRenderTargetId:null};g.prototype._invalidateTileOverlayData=function(a){a.renderTargetId=null;a.highlightRenderTargetId=null};g.prototype.overlayPixelSizeInMapUnits=function(a){var b;this._overlays&&(b=this._pointIsInExtent(a,this._overlays.inner.extent)?this._overlays.inner:this._overlays.outer);return b?(b.extent[2]-b.extent[0])/b.resolution:0};
g.prototype._createEmptyOverlay=function(a){var b=this._renderer.createRenderTarget("overlay"+a);a=this._renderer.createHighlightRenderTarget("overlayHighlight"+a);return{extent:l.create(),resolution:0,renderTargetId:b,valid:!1,highlightRenderTargetId:a,highlightValid:!1,renderLocalOrigin:{id:"O",vec3:[0,0,0]}}};g.prototype._initOverlays=function(){this._overlays={inner:this._createEmptyOverlay(0),outer:this._createEmptyOverlay(1)}};g.prototype._disposeOverlays=function(){this._overlays&&(this._renderer.disposeRenderTarget(this._overlays.inner.renderTargetId),
this._renderer.disposeRenderTarget(this._overlays.inner.highlightRenderTargetId),this._renderer.disposeRenderTarget(this._overlays.outer.renderTargetId),this._renderer.disposeRenderTarget(this._overlays.outer.highlightRenderTargetId),this._overlays=null)};g.prototype._intersectGroundFromView=function(a,b,c,d){var f=m.vec3d.createFrom(b*this.view.width,c*this.view.height,1);m.vec3d.unproject(f,a.viewMatrix,a.projectionMatrix,a.fullViewport,f);b=m.vec3d.createFrom(b*this.view.width,c*this.view.height,
0);m.vec3d.unproject(b,a.viewMatrix,a.projectionMatrix,a.fullViewport,b);this.groundSelector.init([],b,f,null,a,null,!1);this.view.basemapTerrain.intersect(this.groundSelector,b,f);return this.groundSelector.minResult.getIntersectionPoint(d)};g.prototype._findHorizonBasedPointOfInterest=function(a,b,c){var d=.5;if("global"===this.view.viewingMode){d=m.vec3d.create(a.eye);m.vec3d.normalize(d);m.vec3d.negate(d);b=m.vec3d.length(b);b=Math.asin(b/m.vec3d.length(a.eye));var f=Math.acos(m.vec3d.dot(a.viewForward,
d)),d=v.clamp((b-(f-.5*a.fovY))/a.fovY,0,1);b=v.clamp((-b-(f-.5*a.fovY))/a.fovY,0,1);d=1===d&&0===b?.5:b+.55*(d-b)}else d=m.mat4d.multiplyVec4(a.projectionMatrix,m.vec4d.createFrom(0,Math.tan(.5*Math.PI-Math.acos(-a.viewForward[2])),1,0))[1],d=v.clamp(.5+.5*d,0,1),d=1===d||0===d?.5:0<a.eye[2]?.55*d:1-.55*(1-d);return this._intersectGroundFromView(a,.5,d,c)?!0:!1};g.prototype._computeOverlayExtents=function(a,c){var d=this.view.state.camera,f=this.terrainSurface.extent,e=m.vec3d.create(),g=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation;
this._findHorizonBasedPointOfInterest(d,this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,e)||m.vec3d.set(g,e);this._scale=this.view.renderCoordsHelper.getAltitude(d.eye);var h=m.vec3d.dist(d.eye,e),g=r.viewAngle(this.view.renderCoordsHelper,g,d.eye),g=Math.PI/2-Math.abs(g-Math.PI/2);if(u.OVERLAY_SHOW_CENTER){var k=new p({color:[255,0,0],outline:{color:[255,255,255],width:2}}),t=new n;A.vectorToPoint(e,this._renderSR,t,this._overlaySR);k=new b({geometry:t,symbol:k});void 0!==E&&this.view.graphics.remove(E);
this.view.graphics.add(k);E=k}this._overlaySREqualsRenderSR||A.vectorToVector(e,this._renderSR,e,this._overlaySR);a=.5*a*d.perPixelRatio*h*2;t=!1;h=Infinity;this._isSpherical&&(this._overlaySR.isWebMercator?(a/=Math.cos(A.webMercator.y2lat(e[1])),h=this.terrainSurface.extent[3],h*=.999):(t=!0,a/=x.metersPerDegree,h=90),a>=h&&(a=h,e[1]=0,this._overlaySR.isWebMercator&&(e[0]=0)));k=1;t&&(k=1/Math.max(.2,Math.cos(Math.abs(v.deg2rad(e[1])))),180<a*k&&(k=180/a));var q=a*k,t=c.inner;t[0]=e[0]-q;t[1]=e[1]-
a;t[2]=e[0]+q;t[3]=e[1]+a;this._isSpherical&&this._shiftExtentToFitBounds(t,Infinity,h);c=c.outer;l.set(c,t);6*q>f[2]-f[0]?l.set(c,f):g<=.25*Math.PI?(c[0]-=q,c[1]-=a,c[2]+=q,c[3]+=a):(A.vectorToVector(d.eye,this._renderSR,K,this._overlaySR),m.vec2d.subtract(e,K,I),d=-Math.atan2(I[1],I[0])+.125*Math.PI,0>d&&(d+=2*Math.PI),m.vec4d.scale(B[Math.floor(d/(.25*Math.PI))],2*a,I),I[0]*=k,I[2]*=k,m.vec4d.add(c,I,c));this._isSpherical&&(c[0]=this._longitudeCyclical.clamp(c[0]),c[2]=this._longitudeCyclical.clamp(c[2]),
c[1]=Math.max(c[1],-h),c[3]=Math.min(c[3],h));!this._isSpherical&&f&&(d=l.intersection(t,f,P),f=l.intersection(c,f,L),l.contains(d,f)&&(c[2]=c[0],c[3]=c[1]))};g.prototype._drawOverlays=function(){var a=this._overlays.inner.extent[2]-this._overlays.inner.extent[0];this._drawOverlay(this._overlays.inner,0,a);this._drawOverlay(this._overlays.outer,1,a)};g.prototype._drawOverlay=function(a,b,c){var d=this._renderer,f=a.extent,e=a.resolution,g=this._longitudeCyclical?f[2]>this._longitudeCyclical.max:!1,
h=this._longitudeCyclical?f[0]<this._longitudeCyclical.min:!1;if(g||h){F.views=H;var h=void 0,h=g?this._longitudeCyclical.max-f[0]:this._longitudeCyclical.min-f[0],h=Math.round(h/(f[2]-f[0])*e),k=F.views[0];m.vec4d.set4(0,0,h,e,k.viewport);m.vec4d.set4(f[0],f[1],this._longitudeCyclical.max,f[3],k.extent);g||(k.extent[0]+=this._longitudeCyclical.range);k=F.views[1];m.vec4d.set4(h,0,e-h,e,k.viewport);m.vec4d.set4(this._longitudeCyclical.min,f[1],f[2],f[3],k.extent);g&&(k.extent[2]-=this._longitudeCyclical.range)}else F.views=
M,l.set(F.views[0].extent,f),m.vec4d.set4(0,0,e,e,F.views[0].viewport);F.width=e;F.height=e;F.pixelRatio=c/(f[2]-f[0]);F.index=b;a.valid=d.draw(a.renderTargetId,F);a.highlightValid=d.drawHighlights(a.highlightRenderTargetId,F)};g.prototype._rectanglesOverlap=function(a,b){return this._longitudeCyclical?(this._longitudeCyclical.contains(b[0],b[2],a[0])||this._longitudeCyclical.contains(b[0],b[2],a[2])||this._longitudeCyclical.contains(a[0],a[2],b[0]))&&!(a[1]>b[3]||a[3]<b[1]):l.intersects(a,b)};g.prototype._rectInsideRect=
function(a,b){return this._longitudeCyclical?this._longitudeCyclical.contains(b[0],b[2],a[0])&&this._longitudeCyclical.contains(b[0],b[2],a[2])&&a[1]>b[1]&&a[3]<b[3]:l.contains(b,a)};g.prototype._pointIsInExtent=function(a,b){if(this._longitudeCyclical)return this._longitudeCyclical.contains(b[0],b[2],a.x)&&a.y>=b[1]&&a.y<=b[3];var c=a.x;a=a.y;return c>b[0]&&c<b[2]&&a>b[1]&&a<b[3]};g.prototype._shiftExtentToFitBounds=function(a,b,c){var d=0,f=0;a[0]<-b?d=a[0]+b:a[2]>b&&(d=b-a[2]);a[1]<-c?f=a[1]+c:
a[3]>c&&(f=c-a[3]);l.offset(a,d,f)};g.EXTENTS_DIFFER_THRESHOLD=1E-5;a([k.property()],g.prototype,"view",void 0);a([k.property()],g.prototype,"terrainSurface",void 0);a([k.property({type:Boolean})],g.prototype,"hasHighlights",null);return g=a([k.subclass("esri.views.3d.terrain.OverlayManager")],g)}(k.declared(g)),F={width:0,height:0,pixelRatio:0,views:null,index:0},M=[{viewport:l.create(),extent:l.create()}],H=[M[0],{viewport:l.create(),extent:l.create()}],I=m.vec4d.create(),K=m.vec3d.create(),O={inner:l.create(),
outer:l.create()},P=l.create(),L=l.create();return J})},"esri/views/3d/terrain/PlanarTile":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/ObjectPool ../lib/glMatrix ../support/mathUtils ./Tile ./TileGeometryFactory".split(" "),function(q,h,e,a,d,b,g,c){q=function(d){function g(a,b,c,e){var h=d.call(this,g.NumSubdivisionsAtLevel)||this;h.tileUp=f;void 0!==a&&h.init(a,b,c,e);return h}e(g,d);g.prototype.init=function(a,c,f,e){d.prototype.init.call(this,a,c,f,e);
this.edgeLen=this.extent[2]-this.extent[0];this.curvatureHeight=0;this.centerAtSeaLevel[0]=b.lerp(this.extent[0],this.extent[2],.5);this.centerAtSeaLevel[1]=b.lerp(this.extent[1],this.extent[3],.5);this.centerAtSeaLevel[2]=0;this.updateRadiusAndCenter()};g.prototype.updateRadiusAndCenter=function(){d.prototype.updateRadiusAndCenter.call(this);var a=(this.extent[2]-this.extent[0])*Math.SQRT1_2,b=.5*(this.elevationBounds[0]-this.elevationBounds[1]);this.radius=Math.sqrt(a*a+b*b)};g.prototype.isVisible=
function(a){if(!this.intersectsClippingArea)return!1;for(var b=this.extent[0],c=this.extent[1],d=this.elevationBounds[0],f=this.extent[2],e=this.extent[3],g=this.elevationBounds[1],h=0;6>h;++h){var k=a[h];if(0<k[0]*(0<k[0]?b:f)+k[1]*(0<k[1]?c:e)+k[2]*(0<k[2]?d:g)+k[3])return!1}return!0};g.prototype.createGeometry=function(a,b,d){a.needsUpdate=!1;c.createPlanarGlobeTile(a.numVertsPerRow,this.extent,a.samplerData,b,d,a.clippingArea,this.renderData);this.updateMemoryUsed()};g.NumSubdivisionsAtLevel=
[2,2,2,2,2,2,2,2];g.Pool=new a(g);return g}(g);var f=d.vec3d.createFrom(0,0,1);return q})},"esri/views/3d/terrain/Tile":function(){define("require exports ../../../core/arrayUtils ../../../geometry/support/aaBoundingRect ../lib/glMatrix ../support/mathUtils ../support/buffer/typedArrayUtil ./ElevationData ./ElevationTileAgent ./MapTileAgent ./TerrainConst ./terrainUtils ./TileAgent ./TilePerLayerInfo ./tileUtils ../../vectorTiles/VectorTileDisplayObject ../../webgl/Texture".split(" "),function(q,
h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u){function x(a){a instanceof f?f.Pool.release(a):a instanceof k&&k.Pool.release(a)}var v=l.weakAssert,A=d.vec3d.create(),y=d.vec4d.create(),C=d.vec4d.create(),B=d.vec3d.create(),D=p.AGENT_DONE,E=n.LayerClass.LAYER_CLASS_COUNT,J=n.LayerClass.MAP,F=n.LayerClass.ELEVATION,M=n.TileUpdateTypes;return function(){function h(b){this.lij=[0,0,0];this.extent=a.create();this.elevationBounds=d.vec2d.create();this.children=[null,null,null,null];this.layerInfo=Array(E);this.extentWGS84Rad=
a.create();this.centerAtSeaLevel=d.vec3d.create();this.center=d.vec3d.create();this.tileUp=B;this.intersectsClippingArea=this.isWithinClippingArea=!0;this.clippingArea=null;this._memoryUsed=this.radius=this.edgeLen=this.renderOrder=this.screenDepth=this._maxTesselation=0;this.numSubdivisionsAtLevel=b}Object.defineProperty(h.prototype,"memoryUsed",{get:function(){return this._memoryUsed},enumerable:!0,configurable:!0});h.prototype.init=function(a,b,c,f){this.lij[0]=a[0];this.lij[1]=a[1];this.lij[2]=
a[2];f.getExtent(a[0],a[1],a[2],this.extent,this.extentWGS84Rad);this.intersectsClippingArea=this.isWithinClippingArea=!0;this.clippingArea=null;this.radius=this.edgeLen=0;this.vlevel=a?a[0]:0;b&&b.elevationBounds?d.vec2d.set(b.elevationBounds,this.elevationBounds):d.vec2d.set2(0,0,this.elevationBounds);this.parent=b;for(a=0;4>a;a++)this.children[a]=null;this.pendingUpdates=0;this.renderData=null;this.screenDepth=0;this.visible=!1;this.parentSurface=c;for(a=0;a<E;a++)if(c){b=c.numLayers(a);var e=
void 0;this.layerInfo[a]?(e=this.layerInfo[a],e.length=b):(e=Array(b),this.layerInfo[a]=e);for(var g=0;g<b;g++)e[g]=m.makeEmptyLayerInfo(a,e[g]),a===F&&this.findElevationBoundsForLayer(g,-1)}else this.layerInfo[a]=null;this.computeElevationBounds();this._maxTesselation=Math.min(f.pixelSize[0],n.MAX_TILE_TESSELATION)};h.prototype.dispose=function(){for(var a=0;a<E;a++)for(var b=this.layerInfo[a],c=0;c<b.length;c++)b[c].dispose();this.updateMemoryUsed()};h.prototype.updateMemoryUsed=function(){for(var a=
this.parentSurface.tilingScheme.pixelSize,a=a[0]*a[1]*4,b=this._memoryUsed=0,c=this.layerInfo[n.LayerClass.MAP];b<c.length;b++){var d=c[b],d=d.data;d instanceof u?this._memoryUsed+=1.3*d.descriptor.width*d.descriptor.height*4:d instanceof HTMLImageElement?this._memoryUsed+=a:d instanceof t&&(this._memoryUsed+=d.getGpuMemoryUsage()+d.getCpuMemoryUsage())}b=0;for(c=this.layerInfo[n.LayerClass.ELEVATION];b<c.length;b++)d=c[b],this._memoryUsed+=d.data?a:0;this.renderData&&(this._memoryUsed+=this.renderData.estimateGeometryMemoryUsage(),
a=this.renderData.texture?this.renderData.texture.descriptor:null)&&(this._memoryUsed+=1.3*a.width*a.height*4)};h.prototype.updateScreenDepth=function(a){d.vec3d.set(this.center,C);C[3]=1;d.mat4d.multiplyVec4(a,C,C);this.screenDepth=C[2]/C[3]};h.prototype.shouldSplit=function(a,c){var f=this.lij[0];d.vec3d.subtract(this.center,c,A);var e=d.vec3d.length(A),g=this.edgeLen/(a[0]*e*2),h=this.edgeLen/(a[2]*e*2),k=a[1],l=a[3],m=a[4];a=a[5];return e<this.edgeLen&&f<m?M.SPLIT:g<k?this.vlevel!==this.lij[0]?
(this.vlevel=this.lij[0],M.VSPLITMERGE):M.NONE:f>=m?(h=f+Math.ceil(-b.log2(k/g)),h!==this.vlevel?(this.vlevel=h,M.VSPLITMERGE):M.NONE):6<f&&(d.vec3d.scale(this.tileUp,d.vec3d.dot(this.tileUp,A),y),d.vec3d.subtract(y,A),d.vec3d.length2(y)>this.radius*this.radius&&(d.vec3d.scale(y,this.radius/d.vec3d.length(y)),d.vec3d.add(y,this.center),d.vec3d.subtract(c,y,y),c=this.elevationBounds[1]-this.elevationBounds[0],Math.min(1,(Math.abs(d.vec3d.dot(y,this.tileUp))+.5*c+this.curvatureHeight)/d.vec3d.length(y))*
h<.1/a*l))?M.NONE:M.SPLIT};h.prototype.decodeElevationData=function(a){var b;if(g.isArrayBuffer(a))try{b=c.createFromLERC(this.lij,this.extent,a,n.noDataValueOpt)}catch(O){console.warn("Error decoding raw data: %s",O.message)}else b=c.createFromFetchTileResult(this.lij,this.extent,a);return b};h.prototype.getWGS84Extent=function(){var c=this.extentWGS84Rad;return a.fromValues(b.rad2deg(c[0]),b.rad2deg(c[1]),b.rad2deg(c[2]),b.rad2deg(c[3]))};h.prototype.load=function(a){for(var b=0;b<E;b++)this.layerInfo[b]&&
this._createOrUpdateAgents(0,b);a.loadTile(this)};h.prototype.unload=function(a){this.renderData&&a.unloadTile(this);for(a=0;a<E;a++)for(var b=this.layerInfo[a],c=0;c<b.length;c++){var d=b[c];d.loadingAgent&&d.loadingAgent!==D&&(d.loadingAgent.dispose(),x(d.loadingAgent),d.loadingAgent=null);d.pendingUpdates=0}this.pendingUpdates&=~n.TileUpdateTypes.UPDATE_GEOMETRY;this.pendingUpdates&=~n.TileUpdateTypes.UPDATE_TEXTURE};h.prototype.updateClippingStatus=function(a){if(e.equals(a,this.clippingArea))return!1;
var b=this.intersectsClippingArea,c=this.isWithinClippingArea;a?(this.intersectsClippingArea=this.intersectsExtent(a),this.isWithinClippingArea=this.isWithinExtent(a)):this.isWithinClippingArea=this.intersectsClippingArea=!0;this.clippingArea=a;a=c&&this.isWithinClippingArea;b=!c&&!b&&!this.isWithinClippingArea&&!this.intersectsClippingArea;!this.renderData||a||b||this.updateGeometry();return!0};h.prototype.updateVisibility=function(a){a=this.isVisible(a)&&this.intersectsClippingArea;if(a!==this.visible){this.visible=
a;for(var b=this.layerInfo[0],c=0;c<b.length;c++){var d=b[c];d.loadingAgent&&d.loadingAgent!==D&&d.loadingAgent.setSuspension(!a)}}return a};h.prototype.getLayerInfo=function(a,b){return this.layerInfo[b][a]};h.prototype.hasLayerData=function(a,b){return(a=this.layerInfo[b][a])&&a.data&&!a.dataInvalidated};h.prototype.tileDataAvailable=function(a,b,c){return(b=this.layerInfo[c][b].tilemap)?"unavailable"!==b.getAvailability(a.lij[1],a.lij[2]):!0};h.prototype.requestLayerData=function(a,b,c){n.TILE_LOADING_DEBUGLOG&&
console.log("tile %s layer %d/%d requested by tile %s",this.lij.toString(),b,a,c.tile.lij.toString());var d=this.layerInfo[b][a];if(-1<d.waitingAgents.indexOf(c))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),c.tile.lij.toString(),b,a),!0;if(d.data&&!d.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),c.tile.lij.toString(),b,a),d.waitingAgents.push(c),
setTimeout(c.dataArrived.bind(c,this),0),!0;if(d.pendingUpdates&M.DECODE_ELEVATION)return d.waitingAgents.push(c),!0;d.waitingAgents.push(c);if(d.requestPromise)return!0;var f=this.parentSurface.requestTileData(this,a,b);if(f.isFulfilled())return!1;a=function(){d.requestPromise===f&&(d.requestPromise=null)};d.requestPromise=f;f.then(a,a);return!!f};h.prototype.descendants=function(a){a||(a=[]);for(var b=0;4>b;b++){var c=this.children[b];c&&(c.descendants(a),a.unshift(this.children[b]))}return a};
h.prototype.isLij=function(a){return this.lij[0]===a[0]&&this.lij[1]===a[1]&&this.lij[2]===a[2]};h.prototype.findByLij=function(a){if(this.isLij(a))return this;for(var b=0;4>b;b++){var c=this.children[b];if(c&&(c=c.findByLij(a)))return c}return null};h.prototype.unrequestLayerData=function(a,b,c){n.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d canceled by tile %s",this.lij.toString(),b,a,c.tile.lij.toString());var d=this.layerInfo[b][a],f=d.waitingAgents;c=null!=e.removeUnordered(f,c);v(c,
"agent has not requested this piece of map data");1>f.length&&(f=d.requestPromise,c=!1,b===J&&(c=this.parentSurface.layerViewByIndex(a,J),c=l.isVectorTileLayerView(c)),c||v(f||d.rawData,"no pending operations on layerInfo that agents were waiting for"),f&&!f.isFulfilled()&&(f.cancel(),d.requestPromise=null),n.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d request/loading canceled",this.lij.toString(),b,a),this.updateMemoryUsed())};h.prototype.dataArrived=function(a,b,c){a=this.layerInfo[b][a];
a.data=c;a.dataInvalidated=!1;for(c=0;c<a.waitingAgents.length;c++)a.waitingAgents[c].dataArrived(this);a.waitingAgents.length=0;this.updateMemoryUsed()};h.prototype.dataMissing=function(a,b,c){c.notInTilemap||console.error("Tile %s layer %d/%d error",this.lij.toString(),b,a);a=this.layerInfo[b][a];a.dataMissing=!0;for(b=0;b<a.waitingAgents.length;b++)a.waitingAgents[b].dataMissing(this);a.waitingAgents.length=0;this.updateMemoryUsed()};h.prototype.updateTexture=function(a){void 0===a&&(a=!1);this.renderData&&
(a?this.parentSurface.renderer.updateTileTexture(this):(this.pendingUpdates|=n.TileUpdateTypes.UPDATE_TEXTURE,this.parentSurface.setPendingUpdates()))};h.prototype.invalidateLayerData=function(a,b){this.layerInfo[b][a].invalidateSourceData();this.restartAgents(b)};h.prototype.computeElevationBounds=function(){d.vec2d.set2(Number.MAX_VALUE,-Number.MAX_VALUE,this.elevationBounds);for(var a=this.layerInfo[F],b=!1,c=0;c<a.length;c++){var f=a[c];f.elevationBounds&&(this.elevationBounds[0]=Math.min(this.elevationBounds[0],
f.elevationBounds[0]),this.elevationBounds[1]=Math.max(this.elevationBounds[1],f.elevationBounds[1]),b=!0)}b||d.vec2d.set2(0,0,this.elevationBounds);this.updateRadiusAndCenter()};h.prototype.updateRadiusAndCenter=function(){d.vec3d.scale(this.tileUp,.5*(this.elevationBounds[0]+this.elevationBounds[1]),y);d.vec3d.add(this.centerAtSeaLevel,y,this.center)};h.prototype.findElevationBoundsForLayer=function(a,b){var c=this.layerInfo[F][a];if(!c.elevationBounds||c.elevationBounds[2]<b)if(b=this.parentSurface.layerViewByIndex(a,
F),r.fallsWithinLayer(this,b.layer,!1)){b=!1;if(c.data){var f=c.data;d.vec2d.set(f.bounds,y);y[2]=this.lij[0];b=!0}else{for(var e=this.parent,g=0,h=null,f=c.data;e&&(!f||g<n.ELEVATION_DESIRED_RESOLUTION_LEVEL);){g=this.vlevel-e.lij[0];h=f||h;f=e.layerInfo[F][a].data;if(!f&&h&&g>=n.ELEVATION_DESIRED_RESOLUTION_LEVEL)break;e=e.parent}if(f=f||h)f.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],y),Infinity!==y[0]&&(y[2]=f.level,b=!0)}b&&(c.elevationBounds?d.vec3d.set(y,c.elevationBounds):c.elevationBounds=
[y[0],y[1],y[2]])}};h.prototype.updateGeometry=function(){this.pendingUpdates|=n.TileUpdateTypes.UPDATE_GEOMETRY;this.parentSurface.setPendingUpdates()};h.prototype.modifyLayers=function(a,b,c){for(var d=b.length,f=this.layerInfo[c],e=Array(d),g=0;g<f.length;g++){var h=f[g];h.loadingAgent&&h.loadingAgent!==D&&(h.loadingAgent.dispose(),x(h.loadingAgent),h.loadingAgent=null);h.waitingAgents.length=0}if(c===J)for(g=0;g<f.length;++g)void 0===a[g]&&(f[g].dispose(),this.updateMemoryUsed());for(g=0;g<d;g++)a=
b[g],e[g]=-1<a?f[a]:m.makeEmptyLayerInfo(c);this.layerInfo[c]=e;this.updateMemoryUsed()};h.prototype.restartAgents=function(a){if(this.renderData)if(this._createOrUpdateAgents(0,a),a===F){this.updateGeometry();a=this.layerInfo[a];for(var b=0;b<a.length;b++)a[b].pendingUpdates|=n.TileUpdateTypes.UPDATE_GEOMETRY;this.parentSurface.setPendingUpdates()}else this.updateTexture(!0)};h.prototype.updateAgents=function(a){if(this.renderData){for(var b=this.layerInfo[a],c=0;c<b.length;c++){var d=b[c];d.loadingAgent===
D&&(d.loadingAgent=null)}this._createOrUpdateAgents(0,a)}};h.prototype.removeLayerAgent=function(a,b){a=this.layerInfo[b][a];a.loadingAgent&&a.loadingAgent!==D&&a.loadingAgent.dispose();a.loadingAgent=null};h.prototype.agentDone=function(a,b){var c=this.layerInfo[b],d=c[a];d.loadingAgent=D;d.data||d.upsampleFromTile||a<c.length-1&&this._createOrUpdateAgents(a+1,b)};h.prototype._createOrUpdateAgents=function(a,b){var c;c=b===F?!1:!this.visible;for(var d=this.layerInfo[b];a<d.length;){var e=d[a],g=
!1,h=this.parentSurface.layerViewByIndex(a,b);if(null!==e.loadingAgent&&e.loadingAgent!==D)g=e.loadingAgent.update();else if(e.loadingAgent!==D&&r.fallsWithinLayer(this,h.layer,!1)){var l;l=b===n.LayerClass.ELEVATION?f.Pool.acquire():k.Pool.acquire();(g=l.init(this,a,b,c))?e.loadingAgent=l:(l.dispose(),x(l),e.loadingAgent=D)}if(g&&h.isOpaque)break;a++}};h.prototype.geometryState=function(a){var c,d=this._getElevationInfo(a?a.samplerData:null),f=this.lij[0],g=!1;d.samplerData?(c=this.vlevel-f,c=Math.max(f-
d.maxTileLevel,n.ELEVATION_DESIRED_RESOLUTION_LEVEL-c),f=this._maxTesselation,c=b.clamp((f>>c)+1,2,f+1)):c=8>f?this.numSubdivisionsAtLevel[f]+1:2;f=this.clippingArea;if(!this.intersectsClippingArea||this.isWithinClippingArea)f=null;a?(a.numVertsPerRow!==c&&(a.numVertsPerRow=c,g=!0),d.changed&&(a.samplerData=d.samplerData,g=!0),e.equals(a.clippingArea,f)||(a.clippingArea=f,g=!0),a.needsUpdate=g):a={numVertsPerRow:c,samplerData:d.samplerData,needsUpdate:!0,clippingArea:f};return a};h.prototype._getElevationInfo=
function(a){for(var b=this.layerInfo[F],c=b.length,d=Array(c),f=0,e=0,g=!1,h=0;h<c;h++){var k=b[h];if(k.upsampleFromTile){var k=k.upsampleFromTile.tile,l=k.layerInfo[F][h].data;a&&a[f]===l.samplerData||(g=!0);d[f++]=l.samplerData;e=Math.max(e,k.lij[0])}else k.data&&(l=this.parentSurface.layerViewByIndex(h,F),r.fallsWithinLayer(this,l.layer,!1)&&(l=k.data,a&&a[f]===l.samplerData||(g=!0),d[f++]=l.samplerData,e=this.lij[0]))}a&&a.length!==f&&(g=!0);0<f?d.length=f:d=null;return{changed:g,samplerData:d,
maxTileLevel:e}};h.prototype.isWithinExtent=function(a){var b=this.extent;return b[0]>=a[0]&&a[2]>=b[2]&&b[1]>=a[1]&&a[3]>=b[3]};h.prototype.intersectsExtent=function(a){var b=this.extent;return b[2]>=a[0]&&a[2]>=b[0]&&b[3]>=a[1]&&a[3]>=b[1]};return h}()})},"esri/views/3d/terrain/ElevationData":function(){define(["require","exports","../../../layers/support/rasterFormats/LercCodec","../support/mathUtils","./TerrainConst"],function(q,h,e,a,d){return function(){function b(a,b,d,e){this.samplerData=
null;this.level=a;this.i=b;this.j=d;this.extent=e}b.prototype.computeMinMaxValue=function(b,c,f,e){var g=Infinity,h=-Infinity;b-=this.level;var k=Math.pow(2,b);if(Math.floor(c/k)===this.i&&Math.floor(f/k)===this.j&&0<b){var m=this.samplerData.width,r=this.samplerData.pixelData,t=.5*d.ELEVATION_NODATA_VALUE;b=(m-1)/k;f=(f-this.j*k)*b;c=(c-this.i*k)*b;if(1>b){var k=Math.floor(f),u=Math.floor(c),q=k+u*m,v=r[q],A=r[q+1],y=r[q+m],q=r[q+m+1];if(v+A+y+q<t)return g=a.bilerp(v,A,y,q,f-k,c-u),h=a.bilerp(v,
A,y,q,f-k+b,c-u),m=a.bilerp(v,A,y,q,f-k,c-u+b),b=a.bilerp(v,A,y,q,f-k+b,c-u+b),e[0]=Math.min(g,h,m,b),e[1]=Math.max(g,h,m,b),e;f=k;c=u;b=1}else f=Math.floor(f),c=Math.floor(c),b=Math.ceil(b);for(k=f;k<=f+b;k++)for(u=c;u<=c+b;u++)q=k+u*m,v=r[q],v<t?(g=Math.min(g,v),h=Math.max(h,v)):(g=0<g?0:g,h=0>h?0:h)}e[0]=g;e[1]=h;return e};b.createFromLERC=function(a,c,d,h){d=e.decode(d,h);a=new b(a[0],a[1],a[2],c);a.samplerData={pixelData:d.pixelData,width:d.width,height:d.height,minValue:d.minValue,maxValue:d.maxValue,
noDataValue:d.noDataValue,safeWidth:.99999999*(d.width-1),dx:(d.width-1)/(a.extent[2]-a.extent[0]),dy:(d.width-1)/(a.extent[3]-a.extent[1]),x0:a.extent[0],y1:a.extent[3]};a.bounds=[a.samplerData.minValue,-3E38<a.samplerData.maxValue?a.samplerData.maxValue:0];return a};b.createFromFetchTileResult=function(a,c,d){a=new b(a[0],a[1],a[2],c);c=d.values;for(var f=d.noDataValue,e=Infinity,g=-Infinity,h=!0,m=0;m<c.length;m++){var r=c[m];r!==f&&(e=r<e?r:e,g=r>g?r:g,h=!1)}h&&(g=e=0);a.samplerData={pixelData:d.values,
width:d.width,height:d.height,minValue:e,maxValue:g,noDataValue:f,safeWidth:.99999999*(d.width-1),dx:(d.width-1)/(a.extent[2]-a.extent[0]),dy:(d.width-1)/(a.extent[3]-a.extent[1]),x0:a.extent[0],y1:a.extent[3]};a.bounds=[e,g];return a};return b}()})},"esri/views/3d/terrain/TerrainConst":function(){define(["require","exports","../../../geometry/support/aaBoundingRect","./TilingScheme"],function(q,h,e,a){Object.defineProperty(h,"__esModule",{value:!0});(function(a){a[a.MAP=0]="MAP";a[a.ELEVATION=1]=
"ELEVATION";a[a.LAYER_CLASS_COUNT=2]="LAYER_CLASS_COUNT"})(h.LayerClass||(h.LayerClass={}));(function(a){a[a.NONE=0]="NONE";a[a.SPLIT=1]="SPLIT";a[a.VSPLITMERGE=2]="VSPLITMERGE";a[a.MERGE=4]="MERGE";a[a.DECODE_ELEVATION=8]="DECODE_ELEVATION";a[a.UPDATE_GEOMETRY=16]="UPDATE_GEOMETRY";a[a.UPDATE_TEXTURE=32]="UPDATE_TEXTURE"})(h.TileUpdateTypes||(h.TileUpdateTypes={}));h.TILE_LOADING_DEBUGLOG=!1;h.MAX_ROOT_TILES=64;h.MAX_TILE_TESSELATION=512;h.ELEVATION_NODATA_VALUE=3.40282347E38/10;h.noDataValueOpt=
{noDataValue:h.ELEVATION_NODATA_VALUE};h.ELEVATION_DESIRED_RESOLUTION_LEVEL=4;h.TILEMAP_SIZE_EXP=5;h.TILEMAP_SIZE=1<<h.TILEMAP_SIZE_EXP;h.WEBMERCATOR_WORLD_EXTENT=e.create();a.WebMercatorAuxiliarySphere.getExtent(0,0,0,h.WEBMERCATOR_WORLD_EXTENT);h.GEOGRAPHIC_WORLD_EXTENT=e.create([-180,-90,180,90]);h.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR="Cannot extend surface to encompass all layers because it would result in too many root tiles.";h.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR="Surface extent is too large for tile resolution at level 0.";
h.DEFAULT_TILE_BACKGROUND="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAIAAADTED8xAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAA2JJREFUeNrs3d1O20AQgFFvRJInQLQBhHj/h0JVW34El1yQ2F73DVq3jTys55zrqUBbPrErZUSZ+vcOsto4AjK76Lqu1vr8+G3mPzjc3D/+eJj/Bcz/cd75R80fbu79BsAVCAQAAgABgABAACAAEAAIAAQAAgABQPOKfQAy83Ho+HnnHzXv49B4A4AAQAAgABAACAAEAAIAAYAAQAAgABAANM4+AKnZB4ifd/5R8/YB8AYAAYAAQAAgABAACAAEAAIAAYAAQAAgAGicfQBSsw8QP+/8o+btA+ANAAIAAYAAQAAgABAACAAEAAIAAYAAQADQOPsApGYfIH7e+UfN2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAXA201QdggAggH0AUrMPED8/jsPL03fns/y8fQC8AUAAIAAQAAgABAACAAGAAEAAIAAQAAgAGmcfgNTsA8TP2weImrcPgDcACAAEAAIAAYAAQAAgABAACAAEAAIAAUDj7AOQmn2A+Hn7AFHz9gHwBgABgABAACAAEAAIAAQAAgABgABgNS4cAf9pu9u3O1+m/n2aplKK/0j+TX86/tVP5+eZ3+729gFIfwWyDxA7bx8gat4+ANkJAAGAAEAAIAAQAAgABAACAAGAAEAAIABonn0AUrMPED9vHyBq3j4A3gAgABAACAAEAAIAAYAAQAAgABAA51VrdQgCAAHAsuwDkJp9gPj5vj+9vvx0PsvP2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAYAAoHH2AUjNPkD8vH2AqHn7AHgDgABAACAAEAAIAAQAAgABgABAACAAEAA0zj4AqdkHiJ+3DxA1bx8AbwAQACQ0DL0AyKuOowBwBYKUSikCIHUBAsAVCAQAAgABgABAALBy9gFIzT5A/Lx9gKj5y6trVyC8AUAAIAAQAAgAVq90Pg5N5gA2AsAVCAQAAgABgABAALB29gFIzT5A/Lx9gKj5q6+3rkB4A4AAQAAgABAACADWzB/IIHsCAsAVCARAlKlWhyAAEAAIABZjH4DU7APEz5+OH2+vT85n+fkvhztXILwBQAAgABAACAAEAGtWigBIHcBGALgCgQBAACAAyPMO9nHosxuHodZx5vB2t691HIdh/nx/Os7/Zsz/fvgXAAAA//8DAF1P1hM2ICMfAAAAAElFTkSuQmCC"})},
"esri/views/3d/terrain/TilingScheme":function(){define("require exports ../../../geometry ../../../core/Error ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../geometry/support/scaleUtils ../../../layers/support/TileInfo ../support/mathUtils ../support/projectionUtils".split(" "),function(q,h,e,a,d,b,g,c,f,k){var n=k.webMercator.x2lon,l=k.webMercator.y2lat;q=function(){function h(a){var b=h._checkUnsupported(a);if(b)throw b;this.spatialReference=a.spatialReference;
this._isWebMercator=this.spatialReference.isWebMercator;this._isWGS84=this.spatialReference.isWGS84;this.origin=[a.origin.x,a.origin.y];this.pixelSize=[a.size[0],a.size[1]];this.dpi=a.dpi;var c=a.lods.reduce(function(a,b,c){b.level<a.min&&(a.min=b.level,a.minIndex=c);a.max=Math.max(a.max,b.level);return a},{min:Infinity,minIndex:0,max:-Infinity}),d=a.lods[c.minIndex],f=Math.pow(2,d.level),b=d.resolution*f,d=d.scale*f;this.levels=Array(c.max+1);for(c=0;c<this.levels.length;c++)this.levels[c]={resolution:b,
scale:d,tileSize:[b*a.size[0],b*a.size[1]]},b/=2,d/=2}h.prototype.clone=function(){return new h(this.toTileInfo())};h.prototype.toTileInfo=function(){return new c({dpi:this.dpi,origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:this.pixelSize,spatialReference:this.spatialReference,lods:this.levels.map(function(a,b){return{level:b,scale:a.scale,resolution:a.resolution}})})};h.prototype.getExtent=function(a,c,d,e,g){void 0===e&&(e=b.create());var h=this.levels[a];
a=h.tileSize[0];h=h.tileSize[1];e[0]=this.origin[0]+d*a;e[2]=e[0]+a;e[3]=this.origin[1]-c*h;e[1]=e[3]-h;g&&(this._isWebMercator?(g[0]=n(e[0]),g[1]=l(e[1]),g[2]=n(e[2]),g[3]=l(e[3])):this._isWGS84&&(g[0]=f.deg2rad(e[0]),g[1]=f.deg2rad(e[1]),g[2]=f.deg2rad(e[2]),g[3]=f.deg2rad(e[3])));return e};h.prototype.getExtentGeometry=function(a,b,c,d){void 0===d&&(d=new e.Extent);this.getExtent(a,b,c,p);d.spatialReference=this.spatialReference;d.xmin=p[0];d.ymin=p[1];d.xmax=p[2];d.ymax=p[3];d.zmin=void 0;d.zmax=
void 0;return d};h.prototype.ensureMaxLod=function(a){for(;this.levels.length<=a;){var b=this.levels[this.levels.length-1],c=b.resolution/2;this.levels.push({resolution:c,scale:b.scale/2,tileSize:[c*this.pixelSize[0],c*this.pixelSize[1]]})}};h.prototype.capMaxLod=function(a){this.levels.length>a+1&&(this.levels.length=a+1)};h.prototype.getMaxLod=function(){return this.levels.length-1};h.prototype.scaleAtLevel=function(a){return this.levels[0].scale/Math.pow(2,a)};h.prototype.levelAtScale=function(a){var b=
this.levels[0].scale;return a>=b?0:Math.log(b/a)*Math.LOG2E};h.prototype.resolutionAtLevel=function(a){return this.levels[0].resolution/Math.pow(2,a)};h.prototype.compatibleWith=function(a){if(!(a instanceof h)){if(h._checkUnsupported(a))return!1;a=new h(a)}if(!a.spatialReference.equals(this.spatialReference)||a.pixelSize[0]!==this.pixelSize[0]||a.pixelSize[1]!==this.pixelSize[1])return!1;var b=Math.min(this.levels.length,a.levels.length)-1,c=this.levels[b].resolution,d=.5*c;if(!f.floatEqualAbsolute(a.origin[0],
this.origin[0],d)||!f.floatEqualAbsolute(a.origin[1],this.origin[1],d))return!1;d=.5*c/Math.pow(2,b)/Math.max(this.pixelSize[0],this.pixelSize[1])*12;return f.floatEqualAbsolute(c,a.levels[b].resolution,d)};h.prototype.rootTilesInExtent=function(a,b,c){var d=this.levels[0].tileSize;h.computeRowColExtent(a,d,this.origin,p);a=p[1];var f=p[3],e=p[0],g=p[2],k=g-e,l=f-a;k*l>c&&(c=Math.floor(Math.sqrt(c)),l>c&&(a=a+Math.floor(.5*l)-Math.floor(.5*c),f=a+c),k>c&&(e=e+Math.floor(.5*k)-Math.floor(.5*c),g=e+
c));c=Array((g-e)*(f-a));k=0;for(l=a;l<f;l++)for(var m=e;m<g;m++)c[k++]=[0,l,m];b&&(b[0]=this.origin[0]+e*d[0],b[1]=this.origin[1]-f*d[1],b[2]=this.origin[0]+g*d[0],b[3]=this.origin[1]-a*d[1]);return c};h.computeRowColExtent=function(a,b,c,d){var f=.001*(a[2]-a[0]+(a[3]-a[1]));d[0]=Math.floor((a[0]+f-c[0])/b[0]);d[2]=Math.ceil((a[2]-f-c[0])/b[0]);d[1]=Math.floor((c[1]-a[3]+f)/b[1]);d[3]=Math.ceil((c[1]-a[1]-f)/b[1])};h.isPowerOfTwo=function(a){a=a.lods;var b=a[0].resolution*Math.pow(2,a[0].level);
return!a.some(function(a){return!f.floatEqualRelative(a.resolution,b/Math.pow(2,a.level))})};h.hasGapInLevels=function(a){a=a.lods.map(function(a){return a.level});a.sort(function(a,b){return a-b});for(var b=1;b<a.length;b++)if(a[b]!==a[0]+b)return!0;return!1};h.tileSizeSupported=function(a){var b=a.size[1];return b===a.size[0]&&0===(b&b-1)&&128<=b&&512>=b};h._checkUnsupported=function(b){return b?1>b.lods.length?new a("tilingscheme:generic","Tiling scheme must have at least one level"):h.isPowerOfTwo(b)?
null:new a("tilingscheme:power-of-two","Tiling scheme must be power of two"):new a("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")};h.checkUnsupported=function(b){var c=h._checkUnsupported(b);return c?c:h.hasGapInLevels(b)?new a("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):h.tileSizeSupported(b)?null:new a("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]")};h.fromExtent=function(a,b){var d=
a[2]-a[0],f=a[3]-a[1],e=g.getMetersPerUnitForSR(b),k=1.2*Math.max(d,f);a=new h(new c({size:[256,256],origin:{x:a[0]-.5*(k-d),y:a[3]+.5*(k-f)},lods:[{level:0,resolution:k/256,scale:1/(256/96*.0254/(k*e))}],spatialReference:b}));a.ensureMaxLod(20);return a};h.makeWebMercatorAuxiliarySphere=function(a){void 0===a&&(a=19);var b=new h(h.WebMercatorAuxiliarySphereTileInfo);b.ensureMaxLod(a);return b};h.makeWGS84WithTileSize=function(a,b){void 0===b&&(b=16);var f=256/a;a=new h(new c({size:[a,a],origin:{x:-180,
y:90},spatialReference:d.WGS84,lods:[{level:0,resolution:.703125*f,scale:2.95497598570834E8*f}]}));a.ensureMaxLod(b);return a};h.WebMercatorAuxiliarySphereTileInfo=new c({size:[256,256],origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:d.WebMercator,lods:[{level:0,resolution:156543.03392800014,scale:5.91657527591555E8}]});h.WebMercatorAuxiliarySphere=h.makeWebMercatorAuxiliarySphere(19);return h}();var p=b.create();return q})},"esri/views/3d/terrain/ElevationTileAgent":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/ObjectPool ./TerrainConst ./TileAgent ./UpsampleInfo".split(" "),
function(q,h,e,a,d,b,g){return function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a._scaleRangeEnabled=!1;return a}e(c,b);c.prototype.dataArrived=function(a){a!==this.tile?this._setUpsamplingTile(a):(this._unsetUpsamplingTile(),this.updateGeometry());this._dataRequested=null;this._requestNext()};c.prototype.updateGeometry=function(){this._tileLayerInfo.pendingUpdates|=d.TileUpdateTypes.UPDATE_GEOMETRY;this.tile.updateGeometry()};c.prototype._findAncestorWithData=function(){for(var a=
this.layerClass,b=this.layerIdx,c=this.tile,f=c.vlevel,e;c&&!(c.layerInfo[a][b].data&&(e=c,f-c.lij[0]>=d.ELEVATION_DESIRED_RESOLUTION_LEVEL));)c=c.parent;return e?(a=g.Pool.acquire(),a.init(e,0,0,1),a):null};c.prototype._desiredMinLevelDelta=function(){return d.ELEVATION_DESIRED_RESOLUTION_LEVEL-(this.tile.vlevel-this.tile.lij[0])};c.prototype._setUpsamplingTile=function(a){this._unsetUpsamplingTile();var b=g.Pool.acquire();b.init(a,0,0,1);this._tileLayerInfo.upsampleFromTile=b;this.updateGeometry()};
c.Pool=new a(c);return c}(b)})},"esri/views/3d/terrain/TileAgent":function(){define(["require","exports","./tileUtils","./UpsampleInfo"],function(q,h,e,a){function d(b,c,f,e,h,l,p){if(!b.parent||6<p)return null;e*=.5;h*=.5;l*=.5;b.lij[2]&1&&(h+=.5);0===(b.lij[1]&1)&&(l+=.5);return b.parent.hasLayerData(c,f)?(c=a.Pool.acquire(),c.init(b.parent,h,l,e),c):d(b.parent,c,f,e,h,l,p+1)}var b=Error("Abstract method called on TileAgent");return function(){function g(){}g.prototype.init=function(b,d,e,g){this.tile=
b;this.layerIdx=d;this.layerClass=e;this.suspended=g;this._tileLayerInfo=b.getLayerInfo(d,e);this._dataRequested=null;(b=this._findAncestorWithData())?(this._setUpsamplingTile(b.tile),a.Pool.release(b)):(this._tileLayerInfo.upsampleFromTile&&a.Pool.release(this._tileLayerInfo.upsampleFromTile),this._tileLayerInfo.upsampleFromTile=null);return this._requestNext(!0)};g.prototype.dispose=function(){this._dataRequested&&(this._dataRequested.unrequestLayerData(this.layerIdx,this.layerClass,this),this._dataRequested=
null);this._tileLayerInfo=this.tile=null};g.prototype.setSuspension=function(a){a!==this.suspended&&((this.suspended=a)?this._dataRequested&&(this._dataRequested.unrequestLayerData(this.layerIdx,this.layerClass,this),this._dataRequested=null):this._tileLayerInfo.data||this.update())};g.prototype.update=function(){var b=this._findAncestorWithData();b&&this._tileLayerInfo.upsampleFromTile&&b.tile!==this._tileLayerInfo.upsampleFromTile.tile?this._setUpsamplingTile(b.tile):b&&a.Pool.release(b);return this._requestNext()};
g.prototype.dataArrived=function(a){throw b;};g.prototype.dataMissing=function(a){this._dataRequested=null;this._tileLayerInfo.disposeData();this._requestNext()};g.prototype._agentDone=function(){this.tile.agentDone(this.layerIdx,this.layerClass);this.dispose()};g.prototype._requestNext=function(a){void 0===a&&(a=!1);if(this.suspended)return!0;var b=this._findNextDownload();if(this._dataRequested){if(b===this._dataRequested)return!0;this._dataRequested.unrequestLayerData(this.layerIdx,this.layerClass,
this);this._dataRequested=null}b?b.requestLayerData(this.layerIdx,this.layerClass,this)&&(this._dataRequested=b):a||this._agentDone();return!!this._dataRequested};g.prototype._findNextDownload=function(){for(var a=this.layerIdx,b=this.layerClass,d=this.tile.parentSurface.layerViewByIndex(a,b),h=d.minDataLevel,l=d.maxDataLevel,p=this._desiredMinLevelDelta(),m=g.START_LOADING_LEVEL_DELTA+p,r=this._scaleRangeEnabled,t,u=this.tile,q=0,v=u.lij[0],A=this._tileLayerInfo.upsampleFromTile?this._tileLayerInfo.upsampleFromTile.tile.lij[0]:
-1,y=this.tile.parentSurface,C=y.tilemapStats,B=y.getTilemapTile(u),D=!1;u&&(!r||e.fallsWithinLayer(u,d.layer,!1))&&u.lij[0]>=h;){var E=u.layerInfo[b][a];if(E.data&&q>=p){u.lij[0]>A&&this._setUpsamplingTile(u);E.dataInvalidated&&(t=u);break}if(B&&!B.tileDataAvailable(u,a,b))D=!0;else if(u.lij[0]<=l&&!E.data&&!E.dataMissing&&(t=u,q>=m))break;(u=u.parent)&&B&&(B=B.parent||y.getTilemapTile(u));q++}t&&v-t.lij[0]<p&&this._tileLayerInfo.upsampleFromTile&&(t=null);!t&&D&&C.tilesNotPresent++;return t};g.prototype._findAncestorWithData=
function(){return d(this.tile,this.layerIdx,this.layerClass,1,0,0,0)};g.prototype._desiredMinLevelDelta=function(){throw b;};g.prototype._setUpsamplingTile=function(a){throw b;};g.prototype._unsetUpsamplingTile=function(){this._tileLayerInfo.upsampleFromTile&&a.Pool.release(this._tileLayerInfo.upsampleFromTile);this._tileLayerInfo.upsampleFromTile=null};g.START_LOADING_LEVEL_DELTA=4;g.AGENT_DONE=new g;return g}()})},"esri/views/3d/terrain/tileUtils":function(){define("require exports ../../../core/PooledArray ./UpsampleInfo ../webgl-engine/lib/gl-matrix ../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(q,h,e,a,d,b){function g(a,b){b(a);for(var c=0;4>c;c++){var d=a.children[c];d&&g(d,b)}}function c(a,b){for(var d=0;4>d;d++){var f=a.children[d];f&&c(f,b)}b(a)}Object.defineProperty(h,"__esModule",{value:!0});q=function(){function a(a){void 0===a&&(a=100);this.q=new e({initialSize:a});this._last=null;this.done=!0}a.prototype.reset=function(a){this.q.clear();a&&this.q.pushAny(a);this._last=null;this.done=0===this.q.length};a.prototype.skip=function(){this._last=null;0===this.q.length&&(this.done=
!0)};a.prototype.next=function(){if(this.done)return null;if(null!==this._last){var a=this._last.children;if(a[0])for(var b=4;0<=b;b--){var c=a[b];c&&this.q.push(c)}}this._last=this.q.pop();0!==this.q.length||this._last.children[0]||(this.done=!0);return this._last};return a}();h.IteratorPreorder=q;q=function(){function a(a){void 0===a&&(a=100);this.q=new e({initialSize:a});this.done=!0}a.prototype.reset=function(a){this.q.clear();this.q.pushAny(a);for(a=0;a<this.q.length;)for(var b=this.q.data[a++],
c=0;4>c;c++){var d=b.children[c];d&&this.q.push(d)}this.done=0===this.q.length};a.prototype.next=function(){var a=this.q.pop();this.done=0===this.q.length;return a};return a}();h.IteratorPostorder=q;h.lij2str=function(a,b,c){return a+"/"+b+"/"+c};h.tile2str=function(a){return a.lij[0]+"/"+a.lij[1]+"/"+a.lij[2]};h.traverseTilesPreorder=function(a,b){if(Array.isArray(a))for(var c=0;c<a.length;c++)g(a[c],b);else g(a,b)};h.traverseTilesPostorder=function(a,b){if(Array.isArray(a))for(var d=0;d<a.length;d++)c(a[d],
b);else c(a,b)};h.fallsWithinLayer=function(a,b,c){if(!b)return!1;var d=b.fullExtent,f=a.extent;if(c){if(f[0]<d.xmin||f[1]<d.ymin||f[2]>d.xmax||f[3]>d.ymax)return!1}else if(d.xmin>f[2]||d.ymin>f[3]||d.xmax<f[0]||d.ymax<f[1])return!1;a=a.parentSurface.tilingScheme.levels[a.lij[0]].scale;return 0<b.minScale&&a>1.00000001*b.minScale||0<b.maxScale&&a<.99999999*b.maxScale?!1:!0};h.isPosWithinTile=function(a,b){a=a.extent;return b[0]>=a[0]&&b[1]>=a[1]&&b[0]<=a[2]&&b[1]<=a[3]};h.getTileNLevelsUp=function(a,
b){for(;0<b;)a=a.parent,b--;return a};h.nextTileInAncestry=function(a,b){var c=a.lij[0]-b.lij[0]-1,d=a.lij[2]>>c,f=0;a.lij[1]>>c&1&&(f+=2);d&1&&(f+=1);return b.children[f]};h.computeUpsampleInfoForAncestor=function(b,c){for(var d=1,f=0,e=0;b!==c;)if(d*=.5,f*=.5,e*=.5,b.lij[2]&1&&(f+=.5),0===(b.lij[1]&1)&&(e+=.5),b=b.parent,null==b)throw Error("tile was not a descendant of ancestorTile");b=a.Pool.acquire();b.init(c,f,e,d);return b};var f=[null];h.hasVisibleSiblings=function(a){Array.isArray(a)||(f[0]=
a,a=f);for(var b=0;b<a.length;b++){var c=a[b],d=c.parent;if(d)for(var e=0;4>e;e++){var g=d.children[e];if(g&&g!==c&&g.visible)return!0}}return!1};var k=Math.pow(2,-52),n=d.vec3d.create(),l=d.vec3d.create();h.intersectSkirts=function(a,c,f,e,g,h,v,q,y){var m=h.data,p=h.offsetIdx;h=h.strideIdx;var r=a[0],u=a[1];a=a[2];var t=c[0]-r,x=c[1]-u;for(c=c[2]-a;f<e;f++){var A=v?v[f]:f,H=p+h*g[3*A],I=p+h*g[3*A+1],K=p+h*g[3*A+2],O=m[H],P=m[H+1],L=m[H+2];2<=m[H+3]&&(d.vec3d.set3(O,P,L,n),q(n),O+=n[0],P+=n[1],L+=
n[2]);var U=m[I],H=m[I+1],N=m[I+2];2<=m[I+3]&&(d.vec3d.set3(U,H,N,n),q(n),U+=n[0],H+=n[1],N+=n[2]);var I=m[K],S=m[K+1],aa=m[K+2];2<=m[K+3]&&(d.vec3d.set3(I,S,aa,n),q(n),I+=n[0],S+=n[1],aa+=n[2]);var K=U-O,H=H-P,N=N-L,I=I-O,S=S-P,aa=aa-L,V=x*aa-S*c,T=c*I-aa*t,Q=t*S-I*x,U=K*V+H*T+N*Q,O=r-O,G=u-P,X=a-L,L=G*N-H*X,P=X*K-N*O,Z=O*H-K*G;if(U>k){O=O*V+G*T+X*Q;if(0>O||O>U)continue;V=t*L+x*P+c*Z;if(0>V||O+V>U)continue}else if(U<-k){O=O*V+G*T+X*Q;if(0<O||O<U)continue;V=t*L+x*P+c*Z;if(0<V||O+V<U)continue}else continue;
L=(I*L+S*P+aa*Z)/U;0<=L&&(K=b.computeNormal(K,H,N,I,S,aa,l),y(L,K,A))}}})},"esri/views/3d/terrain/UpsampleInfo":function(){define(["require","exports","../../../core/ObjectPool","../lib/glMatrix"],function(q,h,e,a){var d=a.vec2d;return function(){function a(a,b,f,e){this.scale=0;this.tile=null;this.offset=d.create();void 0!==a&&this.init(a,b,f,e)}a.prototype.init=function(a,b,d,e){this.tile=a;this.offset[0]=b;this.offset[1]=d;this.scale=e};a.prototype.dispose=function(){this.tile=null;this.offset[0]=
0;this.scale=this.offset[1]=0};a.Pool=new e(a);return a}()})},"esri/views/3d/terrain/MapTileAgent":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/ObjectPool ./TileAgent ./tileUtils".split(" "),function(q,h,e,a,d,b){return function(d){function c(){var a=d.call(this)||this;a._scaleRangeEnabled=!0;return a}e(c,d);c.prototype.dataArrived=function(a){a!==this.tile?this._setUpsamplingTile(a):(this._unsetUpsamplingTile(),this.tile.updateTexture());this._dataRequested=
null;a!==this.tile&&this._requestNext()};c.prototype._desiredMinLevelDelta=function(){return 0};c.prototype._setUpsamplingTile=function(a){this._tileLayerInfo.upsampleFromTile&&this._tileLayerInfo.upsampleFromTile.tile===a||(this._unsetUpsamplingTile(),this._tileLayerInfo.upsampleFromTile=b.computeUpsampleInfoForAncestor(this.tile,a),this.tile.updateTexture())};c.Pool=new a(c);return c}(d)})},"esri/views/3d/terrain/terrainUtils":function(){define("require exports ../../../layers/ElevationLayer ../../../layers/TileLayer ../../../layers/VectorTileLayer ../../../support/basemapDefinitions ./terrainUtilsPlanar ./terrainUtilsSpherical".split(" "),
function(q,h,e,a,d,b,g,c){function f(a){return a&&"esri.views.3d.layers.TileLayerView3D"===a.declaredClass}function k(a){return a&&"esri.views.3d.layers.VectorTileLayerView3D"===a.declaredClass}function n(a){return a&&"esri.views.3d.layers.WMTSLayerView3D"===a.declaredClass}function l(a){return a&&"esri.views.3d.layers.ElevationLayerView3D"===a.declaredClass}function p(){t={};for(var a in b)b[a].baseMapLayers.forEach(function(a){t[a.url]=19});t["//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"]=
20}function m(a,b,c,d){return r["local"===d||"planar"===d?"planar":"spherical"].checkIfTileInfoSupportedForViewSR(a,b,c)}Object.defineProperty(h,"__esModule",{value:!0});var r={planar:g,spherical:c};h.weakAssert=function(a,b){a||console.warn("Terrain: "+b)};h.autoUpdateSkirtsVisibility=function(a,b,c){var d=r[a.manifold],f,e=d.isInsideExtent(a,b);e?f=a.getElevation(b):(f=a.getElevationBounds(),f=.5*(f[0]+f[1]));f=b[2]-f;c=.9*Math.abs(f)<c?0:0>f?-1:1;e||(d.isInsideExtent(a,b,a.hideSkirtsDistanceFromExtentMargin)?
(b=d.tiltToExtentEdge(a,b),b>a.hideSkirtsMinimumCameraTilt&&b<a.hideSkirtsMaximumCameraTilt&&(c=0)):c=0);a.skirtScale=c};h.isTiledLayer=function(a){return a&&"base-tile"===a.type||"tile"===a.type||"elevation"===a.type||"base-elevation"===a.type||"open-street-map"===a.type||"web-tile"===a.type||"wmts"===a.type||"vector-tile"===a.type};h.isVectorTileLayer=function(a){return a&&a.isInstanceOf(d)};h.isTileLayerView=f;h.isVectorTileLayerView=k;h.isWMTSLayerView=n;h.isElevationLayerView=l;h.isTiledLayerView=
function(a){return a&&(f(a)||l(a)||k(a)||n(a))};h.useFetchTileForLayer=function(b){return b.fetchTile&&!(b.fetchTile===a.prototype.fetchTile||b.fetchTile===e.prototype.fetchTile)};var t=null;h.getKnownTiledServiceLevelCap=function(a){t||p();a=a&&a.replace(/https?:/,"");return a in t?t[a]:Infinity};h.prepareKnownTiledServiceLevelCaps=p;h.checkIfTileInfoSupportedForView=m;h.getTiledLayerInfo=function(a,b,c){var d,f;if("wmts"===a.type){if(a=a.activeLayer){var e=a.tileMatrixSet;if(e)d=e.tileInfo,f=e.fullExtent;
else if(a=a.tileMatrixSets)if(a=a.find(function(a){return null==m(a.tileInfo,a.fullExtent,b,c)}))return{tileInfo:a.tileInfo,fullExtent:a.fullExtent}}}else d="vector-tile"===a.type?a.compatibleTileInfo256:a.tileInfo,f=a.fullExtent;return d&&f&&null==m(d,f,b,c)?{tileInfo:d,fullExtent:f}:{tileInfo:null,fullExtent:null}}})},"esri/layers/VectorTileLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../request ../core/Error ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/urlUtils ../core/accessorSupport/decorators ../geometry/Extent ../geometry/SpatialReference ./Layer ./mixins/ArcGISCachedService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./support/TileInfo ./support/TilemapCache ./support/vectorTileLayerLoader ../portal/support/jsonContext ../views/vectorTiles/SchemaHelper ../views/vectorTiles/style/StyleRepository".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u,x,v,A,y,C,B,D,E){return function(c){function h(a,b){a=c.call(this)||this;a.capabilities=null;a.currentStyleInfo=null;a.fullExtent=null;a.style=null;a.operationalLayerType="VectorTileLayer";a.tileInfo=null;a.tilemapCache=null;a.type="vector-tile";a.url=null;return a}a(h,c);h.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?e({url:a},b):a};h.prototype.load=function(){var a=this,c=this.loadFromPortal({supportedTypes:["Vector Tile Service"],
supportsData:!1}).then(function(){if(a.portalItem&&a.portalItem.id){var c=a.portalItem.itemUrl+"/resources/styles/root.json";return b(c,{query:{f:"json"}}).then(function(b){b.data&&a.read({url:c},B.createForItem(a.portalItem))})}}).always(function(){return a.loadStyle()});this.addResolvingPromise(c);return this.when()};Object.defineProperty(h.prototype,"attributionDataUrl",{get:function(){var a=this.currentStyleInfo;return(a=a&&a.serviceUrl&&n.urlToObject(a.serviceUrl))?this._getDefaultAttribution(a.path):
null},enumerable:!0,configurable:!0});h.prototype.readCapabilities=function(a,b){var c=b.capabilities&&b.capabilities.split(",").map(function(a){return a.toLowerCase().trim()});a=!!b.exportTilesAllowed;c=-1!==c.indexOf("tilemap");return{operations:{supportsExportTiles:a,supportsTileMap:c},exportTiles:a?{maxExportTilesCount:+b.maxExportTilesCount}:null}};Object.defineProperty(h.prototype,"parsedUrl",{get:function(){return this.serviceUrl?k.urlToObject(this.serviceUrl):null},enumerable:!0,configurable:!0});
Object.defineProperty(h.prototype,"serviceUrl",{get:function(){return this.currentStyleInfo&&this.currentStyleInfo.serviceUrl||null},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"spatialReference",{get:function(){return this.tileInfo&&this.tileInfo.spatialReference||null},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"styleUrl",{get:function(){return this.currentStyleInfo&&this.currentStyleInfo.styleUrl||null},enumerable:!0,configurable:!0});h.prototype.writeStyleUrl=
function(a,b){a&&n.isProtocolRelative(a)&&(a="https:"+a);b.styleUrl=a};h.prototype.readTileIndexType=function(a,b){return b.type};h.prototype.readTileIndexUrl=function(a,b){return n.join(this.serviceUrl,b.tileMap)};h.prototype.readTilemapCache=function(a,b){return b.capabilities&&-1<b.capabilities.indexOf("Tilemap")?new y({layer:this}):null};h.prototype.readTileServers=function(a,b){var c=this;a=b.tiles;this.serviceUrl&&a.forEach(function(a,b,d){n.isAbsolute(a)?d[b]=a:d[b]=n.join(c.serviceUrl,a)});
return a};h.prototype.readVersion=function(a,b){return b.version?parseFloat(b.version):parseFloat(b.currentVersion)};h.prototype.readCompatibleTileInfo256=function(a,b){return A.fromJSON(D.create256x256CompatibleTileInfo(b.tileInfo))};h.prototype.readCompatibleTileInfo512=function(a,b){return A.fromJSON(D.create512x512CompatibleTileInfo(b.tileInfo))};h.prototype.loadStyle=function(a){a=a||this.style||this.url;if(this._loadingPromise&&"string"===typeof a&&this.url===a)return this._loadingPromise;var b=
this._loadingPromise;this._loadingPromise=this._getSourceAndStyle(a);b&&!b.isFulfilled()&&b.cancel();return this._loadingPromise};h.prototype.getTileUrl=function(a,b,c){var d=this.tileServers[b%this.tileServers.length];return d=d.replace(/\{z\}/gi,a.toString()).replace(/\{y\}/gi,b.toString()).replace(/\{x\}/gi,c.toString())};h.prototype.write=function(a,b){return b&&b.origin&&!this.styleUrl?(b.messages&&b.messages.push(new g("vectortilelayer:unsupported","VectorTileLayer ("+this.title+", "+this.id+
") with style defined by JSON only are not supported",{layer:this})),null):this.inherited(arguments,[a,b])};h.prototype.importLayerViewModule=function(a){switch(a.type){case "2d":return f.create(function(a){return q(["../views/2d/layers/VectorTileLayerView2D"],a)});case "3d":return f.create(function(a){return q(["../views/3d/layers/VectorTileLayerView3D"],a)})}};h.prototype._getSourceAndStyle=function(a){var b=this;return a?C.loadMetadata(a).then(function(c){b._set("currentStyleInfo",{serviceUrl:c.serviceUrl,
styleUrl:c.styleUrl,spriteUrl:c.spriteUrl,glyphsUrl:c.glyphsUrl,style:c.style,layerDefinition:c.layerDefinition});"string"===typeof a?(b.url=a,b.style=null):(b.url=null,b.style=a);b._set("styleRepository",new E(c.style,c));b.read(c.layerDefinition,{origin:"service"})}):f.reject(Error("invalid style!"))};h.prototype._getDefaultAttribution=function(a){var b=a.match(/^https?:\/\/(basemaps|basemapsbeta|basemapsdev)\.arcgis\.com(\/[^\/]+)?\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/vectortileserver/i);
if(b&&(a=b[3]&&b[3].toLowerCase()))for(var b=b[2]||"",c=0,d=["World_Basemap","World_Basemap_v2","World_Basemap_GCS_v2","World_Basemap_WGS84"];c<d.length;c++){var f=d[c];if(-1<f.toLowerCase().indexOf(a))return n.normalize("//static.arcgis.com/attribution/Vector"+b+"/"+f)}};d([l.property({readOnly:!0,dependsOn:["currentStyleInfo"]})],h.prototype,"attributionDataUrl",null);d([l.property({readOnly:!0})],h.prototype,"capabilities",void 0);d([l.reader("capabilities",["capabilities","exportTilesAllowed",
"maxExportTilesCount"])],h.prototype,"readCapabilities",null);d([l.property({readOnly:!0})],h.prototype,"currentStyleInfo",void 0);d([l.property({type:p,readOnly:!0})],h.prototype,"fullExtent",void 0);d([l.property()],h.prototype,"style",void 0);d([l.property({readOnly:!0,dependsOn:["serviceUrl"]})],h.prototype,"parsedUrl",null);d([l.property({readOnly:!0,dependsOn:["currentStyleInfo"]})],h.prototype,"serviceUrl",null);d([l.property({type:m,dependsOn:["tileInfo"],readOnly:!0})],h.prototype,"spatialReference",
null);d([l.property({readOnly:!0})],h.prototype,"styleRepository",void 0);d([l.property({type:String,readOnly:!0,dependsOn:["currentStyleInfo"],json:{write:{ignoreOrigin:!0},origins:{"web-document":{write:{ignoreOrigin:!0,isRequired:!0}}}}})],h.prototype,"styleUrl",null);d([l.writer(["portal-item","web-document"],"styleUrl")],h.prototype,"writeStyleUrl",null);d([l.property({readOnly:!0})],h.prototype,"tileIndexType",void 0);d([l.reader("tileIndexType",["tileIndexType","type"])],h.prototype,"readTileIndexType",
null);d([l.property({readOnly:!0})],h.prototype,"tileIndexUrl",void 0);d([l.reader("tileIndexUrl",["tileIndexUrl","tileMap"])],h.prototype,"readTileIndexUrl",null);d([l.property({readOnly:!0,type:A})],h.prototype,"tileInfo",void 0);d([l.property({readOnly:!0,type:y})],h.prototype,"tilemapCache",void 0);d([l.reader("tilemapCache",["capabilities"])],h.prototype,"readTilemapCache",null);d([l.property({readOnly:!0})],h.prototype,"tileServers",void 0);d([l.reader("tileServers",["tiles"])],h.prototype,
"readTileServers",null);d([l.property({json:{read:!1},readOnly:!0,value:"vector-tile"})],h.prototype,"type",void 0);d([l.property({json:{origins:{"web-document":{read:{source:"styleUrl"}},"portal-item":{read:{source:"url"}}},write:!1,read:!1}})],h.prototype,"url",void 0);d([l.property({readOnly:!0})],h.prototype,"version",void 0);d([l.reader("version",["version","currentVersion"])],h.prototype,"readVersion",null);d([l.property({readOnly:!0})],h.prototype,"compatibleTileInfo256",void 0);d([l.reader("compatibleTileInfo256",
["tileInfo"])],h.prototype,"readCompatibleTileInfo256",null);d([l.property({readOnly:!0})],h.prototype,"compatibleTileInfo512",void 0);d([l.reader("compatibleTileInfo512",["tileInfo"])],h.prototype,"readCompatibleTileInfo512",null);return h=d([l.subclass("esri.layers.VectorTileLayer")],h)}(l.declared(r,u,x,v,c,t))})},"esri/layers/support/vectorTileLayerLoader":function(){define("require exports ../../core/tsSupport/assignHelper ../../config ../../request ../../core/promiseUtils ../../core/urlUtils".split(" "),
function(q,h,e,a,d,b,g){function c(a){a&&(a=g.getOrigin(a),g.canUseXhr(a)||-1!==n.indexOf(a)||n.push(a))}function f(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];for(var b=void 0,c=0;c<a.length;++c)g.isProtocolRelative(a[c])?b&&(b=b.split("://")[0]+":"+a[c].trim()):b=g.isAbsolute(a[c])?a[c]:g.join(b,a[c]);return b}function k(a,e,h){var l,m,n;"string"===typeof e?(e=g.normalize(e),c(e),l=g.urlToObject(e),l=d(l.path,{query:{f:"json"},responseType:"json"}),n=m=e):(l=b.resolve({data:e}),
m=e.jsonUrl||null,n=h);return l.then(function(d){var e=d.data;d.ssl&&(m&&(m=m.replace(/^http:/i,"https:")),n&&(n=n.replace(/^http:/i,"https:")));if(e.sources){a.styleUrl=m||null;d=n?g.removeFile(n):g.appBaseUrl;a.styleBase=d;a.style=e;a.styleUrl&&c(a.styleUrl);if(a.source)e=b.resolve();else{b:if(e=e.sources,e.esri)e=e.esri;else{for(var h=0,l=Object.keys(e);h<l.length;h++){var p=l[h];if("vector"===e[p].type){e=e[p];break b}}e=null}e=e.url?k(a,f(d,e.url)):k(a,e,d)}return e}if(e.sources)return b.reject("You must specify the URL or the JSON for a service or for a style.");
a.sourceUrl=m||null;d=n?g.removeTrailingSlash(n)+"/":g.appBaseUrl;a.sourceBase=d;a.source=e;if(e.hasOwnProperty("tileInfo"))h=e;else{for(var h={xmin:-2.0037507067161843E7,ymin:-2.0037507067161843E7,xmax:2.0037507067161843E7,ymax:2.0037507067161843E7,spatialReference:{wkid:102100}},p=(h.xmax-h.xmin)/512,l=[],r=e.hasOwnProperty("minzoom")?parseFloat(e.minzoom):0,u=e.hasOwnProperty("maxzoom")?parseFloat(e.maxzoom):16;r<u;r++){var t=p/Math.pow(2,r);l.push({level:r,scale:Math.floor(3779.527559055118*t),
resolution:t})}p=0;for(u=e.tiles;p<u.length;p++)c(f(d,u[p]));h={capabilities:"TilesOnly",initialExtent:h,fullExtent:h,minScale:l[0].scale,maxScale:l[l.length-1].scale,tiles:e.tiles,tileInfo:{rows:512,cols:512,dpi:96,format:"pbf",origin:{x:-2.0037508342787E7,y:2.0037508342787E7},lods:l,spatialReference:{wkid:102100}}}}a.validatedSource=h;a.sourceUrl&&c(a.sourceUrl);e=a.style?b.resolve():null==e.defaultStyles?b.reject():"string"===typeof e.defaultStyles?k(a,f(d,e.defaultStyles,"root.json")):k(a,e.defaultStyles,
f(d,"root.json"));return e})}Object.defineProperty(h,"__esModule",{value:!0});var n=a.defaults&&a.defaults.io.corsEnabledServers||a.request.corsEnabledServers;h.loadMetadata=function(a){var b={source:null,sourceBase:null,sourceUrl:null,validatedSource:null,style:null,styleBase:null,styleUrl:null},d="string"===typeof a?[a,null]:[null,a.jsonUrl],e=d[0],d=d[1],h=e?g.urlToObject(e):null;return k(b,a,d).then(function(){var a={layerDefinition:b.validatedSource,url:e,parsedUrl:h,serviceUrl:b.sourceUrl,style:b.style,
styleUrl:b.styleUrl,spriteUrl:b.style.sprite&&f(b.styleBase,b.style.sprite),glyphsUrl:b.style.glyphs&&f(b.styleBase,b.style.glyphs)};c(a.spriteUrl);c(a.glyphsUrl);return a})}})},"esri/portal/support/jsonContext":function(){define(["require","exports","../../core/urlUtils","../Portal"],function(q,h,e,a){Object.defineProperty(h,"__esModule",{value:!0});h.createForItem=function(d){return{origin:"portal-item",url:e.urlToObject(d.itemUrl),portal:d.portal||a.getDefault()}}})},"esri/views/vectorTiles/SchemaHelper":function(){define(["require",
"exports"],function(q,h){return function(){function e(a,d){this.lockedSchemaPixelSize=a;this.isWGS84=d}e.prototype.getCompatibleLevelRowCol=function(a){var d=a[0],b=a[1];a=a[2];this.isWGS84?(b>>=1,a>>=1):256===this.lockedSchemaPixelSize&&0<d&&(d--,b>>=1,a>>=1);return[d,b,a]};e.prototype.getSchemaShift=function(a,d){var b=0,e=0;if(256===this.lockedSchemaPixelSize||this.isWGS84)a[2]%2&&(b=2*d),a[1]%2&&(e=2*d);return[b,e]};e.prototype.adjustLevel=function(a){return this.isWGS84?a:256===this.lockedSchemaPixelSize?
0<a?a-1:0:a};e.create256x256CompatibleTileInfo=function(a){if(!a)return null;if(256===a.rows&&256===a.cols)return a;for(var d=a.format,b=a.compressionQuality,e=a.dpi,c=a.origin,f=a.spatialReference,h=4326===f.wkid,n=[],l,p,m=a.lods.length,r=0;r<m;r++){var t=a.lods[r];l=t.scale;p=h?t.resolution:2*t.resolution;n.push({level:t.level,scale:l,resolution:p})}return{rows:256,cols:256,dpi:e,format:d,compressionQuality:b,origin:c,spatialReference:f,lods:n}};e.create512x512CompatibleTileInfo=function(a){if(!a||
256===a.rows||256===a.cols)return null;for(var d=a.format,b=a.compressionQuality,e=a.dpi,c=a.origin,f=a.spatialReference,h=[],n,l,p=a.lods.length,m=0;m<p;m++){var r=a.lods[m];n=r.scale;l=.5*r.resolution;h.push({level:r.level,scale:n,resolution:l})}return{rows:512,cols:512,dpi:e,format:d,compressionQuality:b,origin:c,spatialReference:f,lods:h}};return e}()})},"esri/views/vectorTiles/style/StyleRepository":function(){define(["require","exports","dojo/has","./StyleLayer"],function(q,h,e,a){return function(){function d(a,
e){this.styleJSON=a;this.version=parseFloat(a.version);this.sprite=e?e.spriteUrl:a.sprite;this.glyphs=e?e.glyphsUrl:a.glyphs;this.layers=(a.layers||[]).map(d._create);this._identifyRefLayers()}d.prototype._identifyRefLayers=function(){for(var a=[],d=[],c=0,f=0,e=this.layers;f<e.length;f++){var h=e[f];if(1===h.type){var l=h,p=h.sourceLayer,p=p+("|"+JSON.stringify(h.minzoom)),p=p+("|"+JSON.stringify(h.maxzoom)),p=p+("|"+JSON.stringify(h.filter));if(l.hasDataDrivenFill||l.hasDataDrivenOutline)p+="|"+
JSON.stringify(c);a.push({key:p,layer:h})}2===h.type&&(l=h,p=h.sourceLayer,p+="|"+JSON.stringify(h.minzoom),p+="|"+JSON.stringify(h.maxzoom),p+="|"+JSON.stringify(h.filter),p+="|"+JSON.stringify(h.layout&&h.layout["line-cap"]),p+="|"+JSON.stringify(h.layout&&h.layout["line-join"]),l.hasDataDrivenLine&&(p+="|"+JSON.stringify(c)),d.push({key:p,layer:h}));++c}this._assignRefLayers(a);this._assignRefLayers(d)};d.prototype._assignRefLayers=function(a){a.sort(function(a,b){return a.key<b.key?-1:a.key>b.key?
1:0});for(var b,c,d=a.length,e=0;e<d;e++){var h=a[e];if(h.key===b)h.layer.refLayerId=c;else if(b=h.key,c=h.layer.id,1===h.layer.type&&!h.layer.getPaintProperty("fill-outline-color"))for(var l=e+1;l<d;l++){var p=a[l];if(p.key===b){if(p.layer.getPaintProperty("fill-outline-color")){a[e]=p;a[l]=h;c=p.layer.id;break}}else break}}};d._create=function(b,d,c){d=1-1/(c.length+1)*(1+d);switch(b.type){case "background":return new a.BackgroundStyleLayer(0,b,d);case "fill":return new a.FillStyleLayer(1,b,d);
case "line":return new a.LineStyleLayer(2,b,d);case "symbol":return new a.SymbolStyleLayer(3,b,d);case "raster":throw Error("Unsupported vector tile raster layer");case "circle":return new a.CircleStyleLayer(4,b,d)}throw Error("Unknown vector tile layer");};return d}()})},"esri/views/vectorTiles/style/StyleLayer":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ./Filter ./StyleDefinition ./StyleProperty".split(" "),function(q,h,e,a,d,
b,g){Object.defineProperty(h,"__esModule",{value:!0});q=function(){function a(a,c,d){this.type=a;this.id=c.id;this.source=c.source;this.sourceLayer=c["source-layer"];this.minzoom=c.minzoom;this.maxzoom=c.maxzoom;this.filter=c.filter;this.layout=c.layout;this.paint=c.paint;this.z=d;switch(a){case 0:this._layoutDefinition=b.StyleDefinition.backgroundLayoutDefinition;this._paintDefinition=b.StyleDefinition.backgroundPaintDefinition;break;case 1:this._layoutDefinition=b.StyleDefinition.fillLayoutDefinition;
this._paintDefinition=b.StyleDefinition.fillPaintDefinition;break;case 2:this._layoutDefinition=b.StyleDefinition.lineLayoutDefinition;this._paintDefinition=b.StyleDefinition.linePaintDefinition;break;case 3:this._layoutDefinition=b.StyleDefinition.symbolLayoutDefinition;this._paintDefinition=b.StyleDefinition.symbolPaintDefinition;break;case 4:this._layoutDefinition=b.StyleDefinition.circleLayoutDefinition,this._paintDefinition=b.StyleDefinition.circlePaintDefinition}this._layoutProperties=this._parseLayout(this.layout);
this._paintProperties=this._parsePaint(this.paint)}a.prototype.getFeatureFilter=function(){return void 0!==this._featureFilter?this._featureFilter:this._featureFilter=d.createFilter(this.filter)};a.prototype.getLayoutProperty=function(a){var b=this._layoutProperties;if(b)return b[a]};a.prototype.getPaintProperty=function(a){var b=this._paintProperties;if(b)return b[a]};a.prototype.getLayoutValue=function(a,b,c){var d,f=this._layoutProperties;f&&(f=f[a])&&(d=f.getValue(b,c));a=this._layoutDefinition[a];
void 0===d&&(d=a["default"]);"enum"===a.type&&(d=a.values.indexOf(d));return d};a.prototype.getPaintValue=function(a,b,c){var d,f=this._paintProperties;f&&(f=f[a])&&(d=f.getValue(b,c));a=this._paintDefinition[a];void 0===d&&(d=a["default"]);"enum"===a.type&&(d=a.values.indexOf(d));return d};a.prototype._parseLayout=function(a){var b={},c;for(c in a){var d=this._layoutDefinition[c];d&&(b[c]=new g(c,d,a[c]))}return b};a.prototype._parsePaint=function(a){var b={},c;for(c in a){var d=this._paintDefinition[c];
d&&(b[c]=new g(c,d,a[c]))}return b};return a}();h.StyleLayer=q;a=function(a){function b(b,c,d){return a.call(this,b,c,d)||this}e(b,a);return b}(q);h.BackgroundStyleLayer=a;a=function(a){function b(b,c,d){b=a.call(this,b,c,d)||this;c=b.getPaintProperty("fill-color");b.hasDataDrivenColor=c?c.isDataDriven:!1;c=b.getPaintProperty("fill-opacity");b.hasDataDrivenOpacity=c?c.isDataDriven:!1;b.hasDataDrivenFill=b.hasDataDrivenColor||b.hasDataDrivenOpacity;c=b.getPaintProperty("fill-outline-color");b.outlineUsesFillColor=
!c;b.hasDataDrivenOutlineColor=c?c.isDataDriven:!1;b.hasDataDrivenOutline=(c?b.hasDataDrivenOutlineColor:b.hasDataDrivenColor)||b.hasDataDrivenOpacity;return b}e(b,a);return b}(q);h.FillStyleLayer=a;a=function(a){function b(b,c,d){b=a.call(this,b,c,d)||this;c=b.getPaintProperty("line-color");b.hasDataDrivenColor=c?c.isDataDriven:!1;c=b.getPaintProperty("line-opacity");b.hasDataDrivenOpacity=c?c.isDataDriven:!1;c=b.getPaintProperty("line-width");b.hasDataDrivenWidth=c?c.isDataDriven:!1;b.hasDataDrivenLine=
b.hasDataDrivenColor||b.hasDataDrivenOpacity||b.hasDataDrivenWidth;return b}e(b,a);return b}(q);h.LineStyleLayer=a;a=function(a){function b(b,c,d){b=a.call(this,b,c,d)||this;c=b.getPaintProperty("icon-color");b.hasDataDrivenIconColor=c?c.isDataDriven:!1;c=b.getPaintProperty("icon-opacity");b.hasDataDrivenIconOpacity=c?c.isDataDriven:!1;c=b.getLayoutProperty("icon-size");b.hasDataDrivenIconSize=c?c.isDataDriven:!1;b.hasDataDrivenIcon=b.hasDataDrivenIconColor||b.hasDataDrivenIconOpacity||b.hasDataDrivenIconSize;
c=b.getPaintProperty("text-color");b.hasDataDrivenTextColor=c?c.isDataDriven:!1;c=b.getPaintProperty("text-opacity");b.hasDataDrivenTextOpacity=c?c.isDataDriven:!1;c=b.getLayoutProperty("text-size");b.hasDataDrivenTextSize=c?c.isDataDriven:!1;b.hasDataDrivenText=b.hasDataDrivenTextColor||b.hasDataDrivenTextOpacity||b.hasDataDrivenTextSize;return b}e(b,a);return b}(q);h.SymbolStyleLayer=a;q=function(a){function b(b,c,d){b=a.call(this,b,c,d)||this;c=b.getPaintProperty("circle-radius");b.hasDataDrivenRadius=
c?c.isDataDriven:!1;c=b.getPaintProperty("circle-color");b.hasDataDrivenColor=c?c.isDataDriven:!1;c=b.getPaintProperty("circle-opacity");b.hasDataDrivenOpacity=c?c.isDataDriven:!1;c=b.getPaintProperty("circle-stroke-width");b.hasDataDrivenStrokeWidth=c?c.isDataDriven:!1;c=b.getPaintProperty("circle-stroke-color");b.hasDataDrivenStrokeColor=c?c.isDataDriven:!1;c=b.getPaintProperty("circle-stroke-opacity");b.hasDataDrivenStrokeOpacity=c?c.isDataDriven:!1;c=b.getPaintProperty("circle-blur");b.hasDataDrivenBlur=
c?c.isDataDriven:!1;return b}e(b,a);return b}(q);h.CircleStyleLayer=q;q=function(){return function(a,b,d){this.cap=a.getLayoutValue("line-cap",b,d);this.join=a.getLayoutValue("line-join",b,d);this.miterLimit=a.getLayoutValue("line-miter-limit",b,d);this.roundLimit=a.getLayoutValue("line-round-limit",b,d)}}();h.LineLayout=q;q=function(){return function(a,b,d,e){this.allowOverlap=a.getLayoutValue("icon-allow-overlap",b,e);this.ignorePlacement=a.getLayoutValue("icon-ignore-placement",b,e);this.optional=
a.getLayoutValue("icon-optional",b,e);this.rotationAlignment=a.getLayoutValue("icon-rotation-alignment",b,e);this.size=a.getLayoutValue("icon-size",b,e);this.rotate=a.getLayoutValue("icon-rotate",b,e);this.padding=a.getLayoutValue("icon-padding",b,e);this.keepUpright=a.getLayoutValue("icon-keep-upright",b,e);this.offset=a.getLayoutValue("icon-offset",b,e);2===this.rotationAlignment&&(this.rotationAlignment=d?0:1)}}();h.IconLayout=q;q=function(){return function(a,b,d,e){this.allowOverlap=a.getLayoutValue("text-allow-overlap",
b,e);this.ignorePlacement=a.getLayoutValue("text-ignore-placement",b,e);this.optional=a.getLayoutValue("text-optional",b,e);this.rotationAlignment=a.getLayoutValue("text-rotation-alignment",b,e);this.fontArray=a.getLayoutValue("text-font",b,e);this.maxWidth=a.getLayoutValue("text-max-width",b,e);this.lineHeight=a.getLayoutValue("text-line-height",b,e);this.letterSpacing=a.getLayoutValue("text-letter-spacing",b,e);this.justify=a.getLayoutValue("text-justify",b,e);this.anchor=a.getLayoutValue("text-anchor",
b,e);this.maxAngle=a.getLayoutValue("text-max-angle",b,e);this.size=a.getLayoutValue("text-size",b,e);this.rotate=a.getLayoutValue("text-rotate",b,e);this.padding=a.getLayoutValue("text-padding",b,e);this.keepUpright=a.getLayoutValue("text-keep-upright",b,e);this.transform=a.getLayoutValue("text-transform",b,e);this.offset=a.getLayoutValue("text-offset",b,e);2===this.rotationAlignment&&(this.rotationAlignment=d?0:1)}}();h.TextLayout=q})},"esri/views/vectorTiles/style/Filter":function(){define(["require",
"exports"],function(q,h){return function(){function e(a,d,b){this._op=a;"$type"===d?(this._val=b instanceof Array?b.map(function(a){return e._types.indexOf(a)}):e._types.indexOf(b),this._op+=11):(this._key=d,this._val=b)}e.prototype.filter=function(a){switch(this._op){case 0:return this._val;case 1:return a.values[this._key]===this._val;case 2:return a.values[this._key]!==this._val;case 3:return a.values[this._key]<this._val;case 4:return a.values[this._key]>this._val;case 5:return a.values[this._key]<=
this._val;case 6:return a.values[this._key]>=this._val;case 7:return-1!==this._val.indexOf(a.values[this._key]);case 8:return-1===this._val.indexOf(a.values[this._key]);case 9:for(var d=0,b=this._val;d<b.length;d++){var e=b[d];if(e.filter(a))return!0}return!1;case 10:d=0;for(b=this._val;d<b.length;d++)if(e=b[d],!e.filter(a))return!1;return!0;case 11:d=0;for(b=this._val;d<b.length;d++)if(e=b[d],e.filter(a))return!1;return!0;case 12:return a.type===this._val;case 13:return a.type!==this._val;case 14:return a.type<
this._val;case 15:return a.type>this._val;case 16:return a.type>=this._val;case 17:return a.type<=this._val;case 18:return-1!==this._val.indexOf(a.type);case 19:return-1===this._val.indexOf(a.type)}};e.createFilter=function(a){if(!a)return new e(0,void 0,!0);var d=a[0];if(1>=a.length)return new e(0,void 0,"any"!==d);switch(d){case "\x3d\x3d":return new e(1,a[1],a[2]);case "!\x3d":return new e(2,a[1],a[2]);case "\x3e":return new e(4,a[1],a[2]);case "\x3c":return new e(3,a[1],a[2]);case "\x3e\x3d":return new e(6,
a[1],a[2]);case "\x3c\x3d":return new e(5,a[1],a[2]);case "in":return new e(7,a[1],a.slice(2));case "!in":return new e(8,a[1],a.slice(2));case "any":return new e(9,void 0,a.slice(1).map(e.createFilter.bind(this)));case "all":return new e(10,void 0,a.slice(1).map(e.createFilter.bind(this)));case "none":return new e(11,void 0,a.slice(1).map(e.createFilter.bind(this)));default:throw Error("invalid operator: "+d);}};e._types=["Unknown","Point","LineString","Polygon"];return e}()})},"esri/views/vectorTiles/style/StyleDefinition":function(){define(["require",
"exports"],function(q,h){Object.defineProperty(h,"__esModule",{value:!0});q=function(){function e(){}e.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"}};e.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"}};e.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"},"line-cap":{type:"enum",values:["butt","round","square"],default:"butt"},"line-join":{type:"enum",values:["bevel",
"round","miter"],default:"miter"},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}};e.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"},"symbol-placement":{type:"enum",values:["point","line"],default:"point"},"symbol-spacing":{type:"number",minimum:1,default:250},"symbol-avoid-edges":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-allow-overlap":{type:"boolean",default:!1},"icon-ignore-placement":{type:"boolean",
default:!1},"icon-optional":{type:"boolean",default:!1},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:"auto"},"icon-size":{type:"number",minimum:0,default:1},"icon-rotate":{type:"number",default:0},"icon-padding":{type:"number",minimum:0,default:2},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-field":{type:"string"},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:"auto"},
"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-size":{type:"number",minimum:0,default:16},"text-max-width":{type:"number",minimum:0,default:10},"text-line-height":{type:"number",default:1.2},"text-letter-spacing":{type:"number",default:0},"text-justify":{type:"enum",values:["left","center","right"],default:"center"},"text-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:"center"},
"text-max-angle":{type:"number",minimum:0,default:45},"text-rotate":{type:"number",default:0},"text-padding":{type:"number",minimum:0,default:2},"text-keep-upright":{type:"boolean",default:!0},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:"none"},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-allow-overlap":{type:"boolean",default:!1},"text-ignore-placement":{type:"boolean",default:!1},"text-optional":{type:"boolean",default:!1}};e.circleLayoutDefinition=
{visibility:{type:"enum",values:["visible","none"],default:"visible"}};e.backgroundPaintDefinition={"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-color":{type:"color",default:[0,0,0,1]},"background-pattern":{type:"string"}};e.fillPaintDefinition={"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-translate":{type:"array",
value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"fill-pattern":{type:"string"}};e.linePaintDefinition={"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-color":{type:"color",default:[0,0,0,1]},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"line-width":{type:"number",minimum:0,default:1},"line-gap-width":{type:"number",
minimum:0,default:0},"line-offset":{type:"number",default:0},"line-blur":{type:"number",minimum:0,default:0},"line-dasharray":{type:"array",value:"number",default:[]},"line-pattern":{type:"string"}};e.symbolPaintDefinition={"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-translate":{type:"array",
value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-halo-blur":{type:"number",minimum:0,default:0},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map",
"viewport"],default:"map"}};e.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}};e.circlePaintDefinition=
{"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-color":{type:"color",default:[0,0,0,1]},"circle-blur":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",
minimum:0,maximum:1,default:1}};return e}();h.StyleDefinition=q})},"esri/views/vectorTiles/style/StyleProperty":function(){define(["require","exports","../../../Color","../GeometryUtils"],function(q,h,e,a){return function(){function d(a,e,c){this.isDataDriven=!1;switch(e.type){case "number":a=!0;break;case "color":a=!0;c=d._parseColor(c);break;case "array":a="number"===e.value;break;default:a=!1}null==c&&(c=e.default);a&&"interval"===c.type&&(a=!1);var b=c&&c.stops&&0<c.stops.length;if(b)for(var g=
0,h=c.stops;g<h.length;g++){var l=h[g];l[1]=this._validate(l[1],e)}if(this.isDataDriven=c?!!c.property:!1)if(void 0!==c.default&&(c.default=this._validate(c.default,e)),b)switch(c.type){case "identity":this.getValue=this._buildIdentity(c,e);break;case "categorical":this.getValue=this._buildCategorical(c,e);break;default:this.getValue=a?this._buildInterpolate(c,e):this._buildInterval(c,e)}else this.getValue=this._buildIdentity(c,e);else b?this.getValue=a?this._buildZoomInterpolate(c):this._buildZoomInterval(c):
(c=this._validate(c,e),this.getValue=this._buildSimple(c))}d.prototype._validate=function(a,d){if("number"===d.type){if(a<d.minimum)return d.minimum;if(a>d.maximum)return d.maximum}return a};d.prototype._buildSimple=function(a){return function(){return a}};d.prototype._buildIdentity=function(a,e){var b=this;return function(c,g){var f;g&&(f=g.values[a.property],"color"===e.type&&(f=d._parseColor(f)));void 0===f&&(f=a.default);return void 0!==f?b._validate(f,e):e.default}};d.prototype._buildCategorical=
function(a,d){var b=this;return function(c,e){var f;e&&(f=e.values[a.property]);f=b._categorical(f,a.stops);return void 0!==f?f:void 0!==a.default?a.default:d.default}};d.prototype._buildInterval=function(a,d){var b=this;return function(c,e){var f;e&&(f=e.values[a.property]);return"number"===typeof f?b._interval(f,a.stops):void 0!==a.default?a.default:d.default}};d.prototype._buildInterpolate=function(a,d){var b=this;return function(c,e){var f;e&&(f=e.values[a.property]);return"number"===typeof f?
b._interpolate(f,a.stops,a.base||1):void 0!==a.default?a.default:d.default}};d.prototype._buildZoomInterpolate=function(a){var b=this;return function(c){return b._interpolate(c,a.stops,a.base||1)}};d.prototype._buildZoomInterval=function(a){var b=this;return function(c){return b._interval(c,a.stops)}};d.prototype._categorical=function(a,d){for(var b=d.length,f=0;f<b;f++)if(d[f][0]===a)return d[f][1]};d.prototype._interval=function(a,d){for(var b=d.length,f=0,e=0;e<b;e++)if(d[e][0]<=a)f=e;else break;
return d[f][1]};d.prototype._interpolate=function(b,d,c){for(var f,e,g=d.length,h=0;h<g;h++){var p=d[h];if(p[0]<=b)f=p;else{e=p;break}}if(f&&e){h=e[0]-f[0];b-=f[0];c=1===c?b/h:(Math.pow(c,b)-1)/(Math.pow(c,h)-1);if(Array.isArray(f[1])){f=f[1];e=e[1];b=[];for(h=0;h<f.length;h++)b.push(a.interpolate(f[h],e[h],c));return b}return a.interpolate(f[1],e[1],c)}if(f)return f[1];if(e)return e[1]};d._isEmpty=function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0};d._parseColor=function(a){if(Array.isArray(a))return a;
if("string"===typeof a){if(a=new e(a),!this._isEmpty(a))return e.toUnitRGBA(a)}else return a&&a.default&&(a.default=d._parseColor(a.default)),a&&a.stops&&(a.stops=a.stops.map(function(a){return[a[0],d._parseColor(a[1])]})),a};return d}()})},"esri/views/vectorTiles/GeometryUtils":function(){define(["require","exports"],function(q,h){function e(a,b){a%=b;return 0<=a?a:a+b}Object.defineProperty(h,"__esModule",{value:!0});h.C_INFINITY=Number.POSITIVE_INFINITY;h.C_PI=Math.PI;h.C_2PI=2*h.C_PI;h.C_PI_BY_2=
h.C_PI/2;h.C_RAD_TO_256=128/h.C_PI;h.C_256_TO_RAD=h.C_PI/128;h.C_DEG_TO_256=256/360;h.C_DEG_TO_RAD=h.C_PI/180;h.C_SQRT2=1.414213562;h.C_SQRT2_INV=1/h.C_SQRT2;var a=1/Math.LN2;h.positiveMod=e;h.radToByte=function(a){return e(a*h.C_RAD_TO_256,256)};h.degToByte=function(a){return e(a*h.C_DEG_TO_256,256)};h.log2=function(d){return Math.log(d)*a};h.sqr=function(a){return a*a};h.clamp=function(a,b,e){return Math.min(Math.max(a,b),e)};h.interpolate=function(a,b,e){return a*(1-e)+b*e};h.between=function(a,
b,e){return a>=b&&a<=e||a>=e&&a<=b}})},"esri/views/3d/terrain/terrainUtilsPlanar":function(){define("require exports ../../../core/Error ../../../geometry/support/aaBoundingRect ../lib/glMatrix ./TerrainConst ./TilingScheme".split(" "),function(q,h,e,a,d,b,g){function c(a,b,c,e){d.vec3d.set(c,f);f[e]=b[e];e=d.vec3d.subtract(f,b);var g=d.vec3d.subtract(a,b,k),g=d.vec3d.dot(g,e),h=d.vec3d.dot(e,e);b=0>=g?b:h<=g?c:d.vec3d.add(b,d.vec3d.scale(e,g/h),f);a=d.vec3d.subtract(a,b,f);return Math.PI/2-Math.atan(a[2]/
Math.sqrt(a[0]*a[0]+a[1]*a[1]))}Object.defineProperty(h,"__esModule",{value:!0});var f=d.vec3d.create(),k=d.vec3d.create(),n=d.vec3d.create(),l=d.vec3d.create();h.isInsideExtent=function(b,c,d){void 0===d&&(d=0);b=b.extent;return 0===d?a.containsPoint(b,c):a.containsPointWithMargin(b,c,d*Math.min(b[2]-b[0],b[3]-b[1]))};h.tiltOnEdge=c;h.tiltToExtentEdge=function(a,b){var d=a.getElevationBounds();a=a.extent;d=.5*(d[0]+d[1]);n[0]=a[0];n[1]=a[1];n[2]=d;l[0]=a[2];l[1]=a[3];l[2]=d;a=d=Infinity;b[0]<n[0]?
d=c(b,n,l,0):b[0]>l[0]&&(d=c(b,l,n,0));b[1]<n[1]?a=c(b,n,l,1):b[1]>l[1]&&(a=c(b,l,n,1));return Math.min(d,a)};h.checkIfTileInfoSupportedForViewSR=function(c,d,f){if(c.spatialReference.isGeographic)return new e("tilingscheme:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes");var h=g.checkUnsupported(c);if(h)return h;var k=c.lods,h=k[0].resolution*Math.pow(2,k[0].level),l=[h*c.size[0],h*c.size[1]],m=[c.origin.x,c.origin.y];d=a.fromExtent(d);var n=a.create();
g.computeRowColExtent(d,l,m,n);l=(n[2]-n[0])*(n[3]-n[1]);l>b.MAX_ROOT_TILES?(k=k[0].scale*Math.pow(2,k[0].level),h=Math.max((d[3]-d[1])/c.size[1],(d[2]-d[0])/c.size[0])*k/h,d=Math.floor(Math.log(h)/Math.log(10)),h=Math.ceil(h/Math.pow(10,d))*Math.pow(10,d),h=new e("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(k).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+h.toLocaleString()+".",{level0Scale:k,suggestedLevel0Scale:h,requiredNumRootTiles:l,
allowedNumRootTiles:b.MAX_ROOT_TILES})):h=null;return h?h:f&&!c.spatialReference.equals(f)?new e("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}})},"esri/views/3d/terrain/terrainUtilsSpherical":function(){define(["require","exports","../../../core/Error","./TilingScheme"],function(q,h,e,a){Object.defineProperty(h,"__esModule",{value:!0});h.isInsideExtent=function(a,b,e){void 0===e&&(e=0);return!0};h.tiltToExtentEdge=function(a,
b){return 0};h.checkIfTileInfoSupportedForViewSR=function(d,b,g){b=d.lods.length-1;if(d.spatialReference.isWebMercator){if(!a.makeWebMercatorAuxiliarySphere(b).compatibleWith(d))return new e("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else if(d.spatialReference.isWGS84){if(!a.makeWGS84WithTileSize(d.size[1],b).compatibleWith(d))return new e("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme")}else return new e("tilingscheme:global-unsupported-spatial-reference",
"The tiling scheme spatial reference is not supported in global scenes");if(g&&!d.spatialReference.equals(g))return new e("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}})},"esri/views/3d/terrain/TilePerLayerInfo":function(){define("require exports ./TerrainConst ./TileAgent ./UpsampleInfo ../../vectorTiles/VectorTileDisplayObject ../../webgl/Texture".split(" "),function(q,h,e,a,d,b,g){return function(){function c(a){this.waitingAgents=
[];this.rawData=this.requestPromise=this.loadingAgent=this.upsampleFromTile=this.tilemapRequest=this.tilemap=this.data=null;this.pendingUpdates=0;this.elevationBounds=void 0;this.init(a)}c.prototype.init=function(a){this.waitingAgents.length=0;this.data=null;this.dataInvalidated=this.dataMissing=!1;this.rawData=this.requestPromise=this.loadingAgent=this.upsampleFromTile=this.tilemapRequest=this.tilemap=null;this.pendingUpdates=0;a===e.LayerClass.ELEVATION&&(this.elevationBounds=null)};c.prototype.invalidateSourceData=
function(){this.tilemap=null;this.dataInvalidated=!0;this.dataMissing=!1;this.upsampleFromTile&&(d.Pool.release(this.upsampleFromTile),this.upsampleFromTile=null)};c.prototype.dispose=function(){this.loadingAgent&&this.loadingAgent!==a.AGENT_DONE&&(this.loadingAgent.dispose(),this.loadingAgent=null);this.requestPromise&&(this.requestPromise.cancel(),this.requestPromise=null);this.tilemap=null;this.tilemapRequest&&(this.tilemapRequest.cancel(),this.tilemapRequest=null);this.upsampleFromTile&&(d.Pool.release(this.upsampleFromTile),
this.upsampleFromTile=null);this.rawData=null;this.pendingUpdates=0;this.disposeData()};c.prototype.disposeData=function(){var a=this.data;(a instanceof g||a instanceof b)&&a.dispose();this.data=null};c.makeEmptyLayerInfo=function(a,b){return b?(b.init(a),b):new c(a)};return c}()})},"esri/views/vectorTiles/VectorTileDisplayObject":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/ObjectPool ../../core/libs/gl-matrix/mat4 ../../core/libs/gl-matrix/vec2 ../../geometry/support/spatialReferenceUtils ../2d/engine/DisplayObject ../2d/tiling/enums ../2d/tiling/TileKey ./RenderBucket ../webgl/BufferObject".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l){var p="fillVertexBuffer fillDDVertexBuffer fillIndexBuffer outlineVertexBuffer outlineDDVertexBuffer outlineIndexBuffer lineVertexBuffer lineDDVertexBuffer lineIndexBuffer iconVertexBuffer iconDDVertexBuffer iconIndexBuffer textVertexBuffer textDDVertexBuffer textIndexBuffer circleVertexBuffer circleIndexBuffer".split(" ");return function(c){function h(){for(var a,e=[],g=0;g<arguments.length;g++)e[g]=arguments[g];g=c.call(this)||this;g._renderBuckets=[];g._vectorTileData=
null;g._symbolUpdateData=null;g.status=f.TileStatus.INITIALIZED;g.coords=[0,0];g.bounds=[0,0,0,0];g.tileTransform={transform:Float32Array[16],displayCoord:Float32Array[2]};g.stencilData={mask:0,reference:0};g.status=f.TileStatus.INITIALIZED;g.tileTransform.transform=d.create();g.tileTransform.displayCoord=b.create();0<e.length&&(a=g.acquire).call.apply(a,[g].concat(e));return g}e(h,c);h.prototype.reset=function(){k.pool.release(this.key);this.refKey=this.key=null;this.coords[0]=0;this.coords[1]=0;
this.bounds[0]=0;this.bounds[1]=0;this.bounds[2]=0;this.height=this.width=this.bounds[3]=0;this.resolution=null;this.rotation=0;this.id=this.client=this.styleLayers=this._vectorTileData=null;this.tileTransform.transform.fill(0);this.tileTransform.displayCoord.fill(0);this.stencilData.mask=0;this.stencilData.reference=0;this._renderBuckets.length=0;this._symbolUpdateData=null;this.status=f.TileStatus.INITIALIZED};h.prototype.acquire=function(a,b,c,d,e){this.key=a;this.refKey=b;b=c.lodAt(a.level).resolution;
var f=c.size[0]*b,h=c.origin,k=a.col*f,l=a.row*f,m=c.spatialReference,n=0;m&&(m._isWrappable?m._isWrappable():m.isWrappable)&&(m=g.getInfo(m),n=m.valid[1]-m.valid[0]);k=h.x+k+a.world*n;h=h.y-l;this.coords[0]=k;this.coords[1]=h;this.bounds[0]=k;this.bounds[1]=h;this.bounds[2]=k+f;this.bounds[3]=h-f;this.widthInPixels=c.size[1];this.coordRange=4096;this.resolution=b;this.rotation=e;this.styleLayers=d;this.id=a.id};h.prototype.setData=function(a,b){this._vectorTileData=a;this.client=b;a&&a.bufferDataInfo||
(this.status=f.TileStatus.NO_DATA)};h.prototype.updateSymbolData=function(a){a&&(this._symbolUpdateData=a,this.requestRender())};h.prototype.dispose=function(){this.fillVertexArrayObject&&(this.fillVertexArrayObject.dispose(),this.fillVertexArrayObject=null);this.fillDDVertexArrayObject&&(this.fillDDVertexArrayObject.dispose(),this.fillDDVertexArrayObject=null);this.outlineVertexArrayObject&&(this.outlineVertexArrayObject.dispose(),this.outlineVertexArrayObject=null);this.outlineDDVertexArrayObject&&
(this.outlineDDVertexArrayObject.dispose(),this.outlineDDVertexArrayObject=null);this.lineVertexArrayObject&&(this.lineVertexArrayObject.dispose(),this.lineVertexArrayObject=null);this.lineDDVertexArrayObject&&(this.lineDDVertexArrayObject.dispose(),this.lineDDVertexArrayObject=null);this.iconVertexArrayObject&&(this.iconVertexArrayObject.dispose(),this.iconVertexArrayObject=null);this.iconDDVertexArrayObject&&(this.iconDDVertexArrayObject.dispose(),this.iconDDVertexArrayObject=null);this.textVertexArrayObject&&
(this.textVertexArrayObject.dispose(),this.textVertexArrayObject=null);this.textDDVertexArrayObject&&(this.textDDVertexArrayObject.dispose(),this.textDDVertexArrayObject=null);this.circleVertexArrayObject&&(this.circleVertexArrayObject.dispose(),this.circleVertexArrayObject=null);this.fillVertexBuffer&&(this.fillVertexBuffer.dispose(),this.fillVertexBuffer=null);this.fillDDVertexBuffer&&(this.fillDDVertexBuffer.dispose(),this.fillDDVertexBuffer=null);this.fillIndexBuffer&&(this.fillIndexBuffer.dispose(),
this.fillIndexBuffer=null);this.outlineVertexBuffer&&(this.outlineVertexBuffer.dispose(),this.outlineVertexBuffer=null);this.outlineDDVertexBuffer&&(this.outlineDDVertexBuffer.dispose(),this.outlineDDVertexBuffer=null);this.outlineIndexBuffer&&(this.outlineIndexBuffer.dispose(),this.outlineIndexBuffer=null);this.lineVertexBuffer&&(this.lineVertexBuffer.dispose(),this.lineVertexBuffer=null);this.lineDDVertexBuffer&&(this.lineDDVertexBuffer.dispose(),this.lineDDVertexBuffer=null);this.lineIndexBuffer&&
(this.lineIndexBuffer.dispose(),this.lineIndexBuffer=null);this.iconVertexBuffer&&(this.iconVertexBuffer.dispose(),this.iconVertexBuffer=null);this.iconDDVertexBuffer&&(this.iconDDVertexBuffer.dispose(),this.iconDDVertexBuffer=null);this.iconIndexBuffer&&(this.iconIndexBuffer.dispose(),this.iconIndexBuffer=null);this.textVertexBuffer&&(this.textVertexBuffer.dispose(),this.textVertexBuffer=null);this.textDDVertexBuffer&&(this.textDDVertexBuffer.dispose(),this.textDDVertexBuffer=null);this.textIndexBuffer&&
(this.textIndexBuffer.dispose(),this.textIndexBuffer=null);this.circleVertexBuffer&&(this.circleVertexBuffer.dispose(),this.circleVertexBuffer=null);this.circleIndexBuffer&&(this.circleIndexBuffer.dispose(),this.circleIndexBuffer=null);this.texture&&(this.texture.dispose(),this.texture=null);this._renderBuckets.length=0;this.status=f.TileStatus.INITIALIZED};h.prototype.getCpuMemoryUsage=function(){return null!=this._vectorTileData&&this._vectorTileData.bufferData?this._vectorTileData.bufferData.reduce(function(a,
b){return a+b.byteLength},0)+this._vectorTileData.bufferDataInfo.byteLength+this._vectorTileData.bucketDataInfo.byteLength:0};h.prototype.getGpuMemoryUsage=function(){var a=this,b=p.reduce(function(b,c){return a[c]?b+a[c].size:b},0);this.texture&&(b+=this.texture.descriptor.width*this.texture.descriptor.height*4);return b};h.prototype.attach=function(a){if(this.status!==f.TileStatus.INITIALIZED)return!0;if(0===this._renderBuckets.length)for(var b=new Uint32Array(this._vectorTileData.bucketDataInfo),
c=b.length,d=0;d<c;){var e=b[d],g=b[d+1];if(0===g)g=new n.BackgroundRenderBucket,g.layerID=e,this._renderBuckets.push(g),d+=2;else if(1===g)g=new n.FillRenderBucket,g.layerID=e,g.triangleElementStart=b[d+2],g.triangleElementCount=b[d+3],g.outlineElementStart=b[d+4],g.outlineElementCount=b[d+5],this._renderBuckets.push(g),d+=6;else if(2===g)g=new n.LineRenderBucket,g.layerID=e,g.triangleElementStart=b[d+2],g.triangleElementCount=b[d+3],this._renderBuckets.push(g),d+=4;else if(3===g){g=new n.SymbolRenderBucket;
g.layerID=e;g.isSDF=0!==b[d+2];var h=d+3,e=b[h];h++;if(0<e)for(var k=void 0,m=void 0,p=void 0,r=0;r<e;r++)k=b[h],m=b[h+1],p=b[h+2],g.markerPerPageElementsMap.set(k,[m,p]),h+=3;var t=b[h];h++;if(0<t)for(p=m=k=void 0,r=0;r<t;r++)k=b[h],m=b[h+1],p=b[h+2],g.glyphPerPageElementsMap.set(k,[m,p]),h+=3;this._renderBuckets.push(g);d+=5+3*e+3*t}else 4===g?(g=new n.CircleRenderBucket,g.layerID=e,g.triangleElementStart=b[d+2],g.triangleElementCount=b[d+3],this._renderBuckets.push(g),d+=4):console.error("Bad bucket type!")}a=
a.context;b=new Uint32Array(this._vectorTileData.bufferDataInfo);c=b.length;for(g=d=0;g<c;g+=2,d++)if(!(0>=b[g+1]||0===this._vectorTileData.bufferData[d].byteLength))switch(b[g]){case 1:this.fillVertexBuffer?this.fillVertexBuffer.setData(this._vectorTileData.bufferData[d]):this.fillVertexBuffer=l.createVertex(a,35044,this._vectorTileData.bufferData[d]);break;case 2:this.fillDDVertexBuffer?this.fillDDVertexBuffer.setData(this._vectorTileData.bufferData[d]):this.fillDDVertexBuffer=l.createVertex(a,
35044,this._vectorTileData.bufferData[d]);break;case 3:this.fillIndexBuffer?this.fillIndexBuffer.setData(this._vectorTileData.bufferData[d]):this.fillIndexBuffer=l.createIndex(a,35044,this._vectorTileData.bufferData[d]);break;case 4:this.outlineVertexBuffer?this.outlineVertexBuffer.setData(this._vectorTileData.bufferData[d]):this.outlineVertexBuffer=l.createVertex(a,35044,this._vectorTileData.bufferData[d]);break;case 5:this.outlineDDVertexBuffer?this.outlineDDVertexBuffer.setData(this._vectorTileData.bufferData[d]):
this.outlineDDVertexBuffer=l.createVertex(a,35044,this._vectorTileData.bufferData[d]);break;case 6:this.outlineIndexBuffer?this.outlineIndexBuffer.setData(this._vectorTileData.bufferData[d]):this.outlineIndexBuffer=l.createIndex(a,35044,this._vectorTileData.bufferData[d]);break;case 7:this.lineVertexBuffer?this.lineVertexBuffer.setData(this._vectorTileData.bufferData[d]):this.lineVertexBuffer=l.createVertex(a,35044,this._vectorTileData.bufferData[d]);break;case 8:this.lineDDVertexBuffer?this.lineDDVertexBuffer.setData(this._vectorTileData.bufferData[d]):
this.lineDDVertexBuffer=l.createVertex(a,35044,this._vectorTileData.bufferData[d]);break;case 9:this.lineIndexBuffer?this.lineIndexBuffer.setData(this._vectorTileData.bufferData[d]):this.lineIndexBuffer=l.createIndex(a,35044,this._vectorTileData.bufferData[d]);break;case 10:this.iconVertexBuffer?this.iconVertexBuffer.setData(this._vectorTileData.bufferData[d]):this.iconVertexBuffer=l.createVertex(a,35044,this._vectorTileData.bufferData[d]);break;case 11:this.iconDDVertexBuffer?this.iconDDVertexBuffer.setData(this._vectorTileData.bufferData[d]):
this.iconDDVertexBuffer=l.createVertex(a,35044,this._vectorTileData.bufferData[d]);break;case 12:this.iconIndexBuffer?this.iconIndexBuffer.setData(this._vectorTileData.bufferData[d]):this.iconIndexBuffer=l.createIndex(a,35044,this._vectorTileData.bufferData[d]);break;case 13:this.textVertexBuffer?this.textVertexBuffer.setData(this._vectorTileData.bufferData[d]):this.textVertexBuffer=l.createVertex(a,35044,this._vectorTileData.bufferData[d]);break;case 14:this.textDDVertexBuffer?this.textDDVertexBuffer.setData(this._vectorTileData.bufferData[d]):
this.textDDVertexBuffer=l.createVertex(a,35044,this._vectorTileData.bufferData[d]);break;case 15:this.textIndexBuffer?this.textIndexBuffer.setData(this._vectorTileData.bufferData[d]):this.textIndexBuffer=l.createIndex(a,35044,this._vectorTileData.bufferData[d]);break;case 16:this.circleVertexBuffer?this.circleVertexBuffer.setData(this._vectorTileData.bufferData[d]):this.circleVertexBuffer=l.createVertex(a,35044,this._vectorTileData.bufferData[d]);break;case 17:this.circleIndexBuffer?this.circleIndexBuffer.setData(this._vectorTileData.bufferData[d]):
this.circleIndexBuffer=l.createIndex(a,35044,this._vectorTileData.bufferData[d])}this._vectorTileData=null;this.status=f.TileStatus.READY;return!0};h.prototype.detach=function(a){this.client&&this.status!==f.TileStatus.INVALID&&this.status!==f.TileStatus.INITIALIZED&&this.client.invoke("destructTileData",this.id);this.dispose();c.prototype.detach.call(this,a)};h.prototype.doRender=function(a){if(this.visible&&this.status===f.TileStatus.READY){var b=a.context,c=a.renderer;if(b&&c){var d=a.drawphase;
this._symbolUpdateData&&this._updateSymbolData(a);b.setStencilFunction(514,this.stencilData.reference,this.stencilData.mask);var e=this.styleLayers,g=void 0!==a.layerOpacity?a.layerOpacity:1;if(0!==g){var h,k=this._renderBuckets.length,l=0;if(0===d)for(l=k-1;0<=l;l--)h=this._renderBuckets[l],3!==h.type&&4!==h.type&&h.hasData()&&c.renderBucket(b,h,a.displayLevel,a.requiredLevel,d,this,e.layers[h.layerID],g);else for(l=0;l<k;l++)h=this._renderBuckets[l],h.hasData()&&c.renderBucket(b,h,a.displayLevel,
a.requiredLevel,d,this,e.layers[h.layerID],g)}}}};h.prototype._updateSymbolData=function(a){if(!this._symbolUpdateData.bucketDataInfo)return!0;var b=new Uint32Array(this._symbolUpdateData.bucketDataInfo),c=b.length;if(0===c)return this._symbolUpdateData=null,!0;if(this.status!==f.TileStatus.READY)return this.requestRender(),!1;a=a.context;for(var d=new Uint32Array(this._symbolUpdateData.bufferDataInfo),e=d.length,g=0,h=0;h<e;h+=2,g++)switch(d[h]){case 10:this.iconVertexBuffer&&(this.iconVertexBuffer.dispose(),
this.iconVertexBuffer=null);this.iconVertexBuffer=l.createVertex(a,35044,this._symbolUpdateData.bufferData[g]);break;case 11:this.iconDDVertexBuffer&&(this.iconDDVertexBuffer.dispose(),this.iconDDVertexBuffer=null);this.iconDDVertexBuffer=l.createVertex(a,35044,this._symbolUpdateData.bufferData[g]);break;case 12:this.iconIndexBuffer&&(this.iconIndexBuffer.dispose(),this.iconIndexBuffer=null);this.iconIndexBuffer=l.createIndex(a,35044,this._symbolUpdateData.bufferData[g]);break;case 13:this.textVertexBuffer&&
(this.textVertexBuffer.dispose(),this.textVertexBuffer=null);this.textVertexBuffer=l.createVertex(a,35044,this._symbolUpdateData.bufferData[g]);break;case 14:this.textDDVertexBuffer&&(this.textDDVertexBuffer.dispose(),this.textDDVertexBuffer=null);this.textDDVertexBuffer=l.createVertex(a,35044,this._symbolUpdateData.bufferData[g]);break;case 15:this.textIndexBuffer&&(this.textIndexBuffer.dispose(),this.textIndexBuffer=null),this.textIndexBuffer=l.createIndex(a,35044,this._symbolUpdateData.bufferData[g])}a=
this._renderBuckets.length;for(d=0;d<a;d++)this._renderBuckets[d]instanceof n.SymbolRenderBucket&&(e=this._renderBuckets[d],e.markerPerPageElementsMap.clear(),e.glyphPerPageElementsMap.clear());for(a=0;a<c;){e=b[a];g=-1;h=this._renderBuckets.length;for(d=0;d<h;d++)if(this._renderBuckets[d].layerID===e){g=d;break}d=this._renderBuckets[g];d||(d=new n.SymbolRenderBucket,d.layerID=e,d.isSDF=0!==b[a+2],this._renderBuckets.push(d));var k=a+3,e=b[k];k++;if(0<e)for(var m=h=g=void 0,p=0;p<e;p++)g=b[k],h=b[k+
1],m=b[k+2],d.markerPerPageElementsMap.set(g,[h,m]),k+=3;var r=b[k];k++;if(0<r)for(m=h=g=void 0,p=0;p<r;p++)g=b[k],h=b[k+1],m=b[k+2],d.glyphPerPageElementsMap.set(g,[h,m]),k+=3;a+=5+3*e+3*r}this.iconVertexArrayObject&&(this.iconVertexArrayObject.dispose(),this.iconVertexArrayObject=null);this.iconDDVertexArrayObject&&(this.iconDDVertexArrayObject.dispose(),this.iconDDVertexArrayObject=null);this.textVertexArrayObject&&(this.textVertexArrayObject.dispose(),this.textVertexArrayObject=null);this.textDDVertexArrayObject&&
(this.textDDVertexArrayObject.dispose(),this.textDDVertexArrayObject=null);this._symbolUpdateData=null;return!0};h.pool=new a(h);return h}(c)})},"esri/core/libs/gl-matrix/mat4":function(){define(["./common"],function(q){var h={scalar:{},SIMD:{},create:function(){var e=new q.ARRAY_TYPE(16);e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=1;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=1;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e},clone:function(e){var a=new q.ARRAY_TYPE(16);a[0]=e[0];a[1]=e[1];a[2]=e[2];a[3]=e[3];
a[4]=e[4];a[5]=e[5];a[6]=e[6];a[7]=e[7];a[8]=e[8];a[9]=e[9];a[10]=e[10];a[11]=e[11];a[12]=e[12];a[13]=e[13];a[14]=e[14];a[15]=e[15];return a},copy:function(e,a){e[0]=a[0];e[1]=a[1];e[2]=a[2];e[3]=a[3];e[4]=a[4];e[5]=a[5];e[6]=a[6];e[7]=a[7];e[8]=a[8];e[9]=a[9];e[10]=a[10];e[11]=a[11];e[12]=a[12];e[13]=a[13];e[14]=a[14];e[15]=a[15];return e},fromValues:function(e,a,d,b,g,c,f,h,n,l,p,m,r,t,u,x){var k=new q.ARRAY_TYPE(16);k[0]=e;k[1]=a;k[2]=d;k[3]=b;k[4]=g;k[5]=c;k[6]=f;k[7]=h;k[8]=n;k[9]=l;k[10]=p;
k[11]=m;k[12]=r;k[13]=t;k[14]=u;k[15]=x;return k},set:function(e,a,d,b,g,c,f,h,n,l,p,m,r,t,u,q,v){e[0]=a;e[1]=d;e[2]=b;e[3]=g;e[4]=c;e[5]=f;e[6]=h;e[7]=n;e[8]=l;e[9]=p;e[10]=m;e[11]=r;e[12]=t;e[13]=u;e[14]=q;e[15]=v;return e},identity:function(e){e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=1;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=1;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e}};h.scalar.transpose=function(e,a){if(e===a){var d=a[1],b=a[2],g=a[3],c=a[6],f=a[7],h=a[11];e[1]=a[4];e[2]=a[8];e[3]=a[12];e[4]=
d;e[6]=a[9];e[7]=a[13];e[8]=b;e[9]=c;e[11]=a[14];e[12]=g;e[13]=f;e[14]=h}else e[0]=a[0],e[1]=a[4],e[2]=a[8],e[3]=a[12],e[4]=a[1],e[5]=a[5],e[6]=a[9],e[7]=a[13],e[8]=a[2],e[9]=a[6],e[10]=a[10],e[11]=a[14],e[12]=a[3],e[13]=a[7],e[14]=a[11],e[15]=a[15];return e};h.SIMD.transpose=function(e,a){var d,b,g,c,f,h;d=SIMD.Float32x4.load(a,0);b=SIMD.Float32x4.load(a,4);g=SIMD.Float32x4.load(a,8);a=SIMD.Float32x4.load(a,12);c=SIMD.Float32x4.shuffle(d,b,0,1,4,5);f=SIMD.Float32x4.shuffle(g,a,0,1,4,5);h=SIMD.Float32x4.shuffle(c,
f,0,2,4,6);c=SIMD.Float32x4.shuffle(c,f,1,3,5,7);SIMD.Float32x4.store(e,0,h);SIMD.Float32x4.store(e,4,c);c=SIMD.Float32x4.shuffle(d,b,2,3,6,7);f=SIMD.Float32x4.shuffle(g,a,2,3,6,7);d=SIMD.Float32x4.shuffle(c,f,0,2,4,6);b=SIMD.Float32x4.shuffle(c,f,1,3,5,7);SIMD.Float32x4.store(e,8,d);SIMD.Float32x4.store(e,12,b);return e};h.transpose=q.USE_SIMD?h.SIMD.transpose:h.scalar.transpose;h.scalar.invert=function(e,a){var d=a[0],b=a[1],g=a[2],c=a[3],f=a[4],h=a[5],n=a[6],l=a[7],p=a[8],m=a[9],r=a[10],t=a[11],
u=a[12],q=a[13],v=a[14];a=a[15];var A=d*h-b*f,y=d*n-g*f,C=d*l-c*f,B=b*n-g*h,D=b*l-c*h,E=g*l-c*n,J=p*q-m*u,F=p*v-r*u,M=p*a-t*u,H=m*v-r*q,I=m*a-t*q,K=r*a-t*v,O=A*K-y*I+C*H+B*M-D*F+E*J;if(!O)return null;O=1/O;e[0]=(h*K-n*I+l*H)*O;e[1]=(g*I-b*K-c*H)*O;e[2]=(q*E-v*D+a*B)*O;e[3]=(r*D-m*E-t*B)*O;e[4]=(n*M-f*K-l*F)*O;e[5]=(d*K-g*M+c*F)*O;e[6]=(v*C-u*E-a*y)*O;e[7]=(p*E-r*C+t*y)*O;e[8]=(f*I-h*M+l*J)*O;e[9]=(b*M-d*I-c*J)*O;e[10]=(u*D-q*C+a*A)*O;e[11]=(m*C-p*D-t*A)*O;e[12]=(h*F-f*H-n*J)*O;e[13]=(d*H-b*F+g*J)*
O;e[14]=(q*y-u*B-v*A)*O;e[15]=(p*B-m*y+r*A)*O;return e};h.SIMD.invert=function(e,a){var d,b,g,c,f,h,n,l;f=SIMD.Float32x4.load(a,0);h=SIMD.Float32x4.load(a,4);n=SIMD.Float32x4.load(a,8);l=SIMD.Float32x4.load(a,12);a=SIMD.Float32x4.shuffle(f,h,0,1,4,5);b=SIMD.Float32x4.shuffle(n,l,0,1,4,5);d=SIMD.Float32x4.shuffle(a,b,0,2,4,6);b=SIMD.Float32x4.shuffle(b,a,1,3,5,7);a=SIMD.Float32x4.shuffle(f,h,2,3,6,7);c=SIMD.Float32x4.shuffle(n,l,2,3,6,7);g=SIMD.Float32x4.shuffle(a,c,0,2,4,6);c=SIMD.Float32x4.shuffle(c,
a,1,3,5,7);a=SIMD.Float32x4.mul(g,c);a=SIMD.Float32x4.swizzle(a,1,0,3,2);f=SIMD.Float32x4.mul(b,a);h=SIMD.Float32x4.mul(d,a);a=SIMD.Float32x4.swizzle(a,2,3,0,1);f=SIMD.Float32x4.sub(SIMD.Float32x4.mul(b,a),f);h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(d,a),h);h=SIMD.Float32x4.swizzle(h,2,3,0,1);a=SIMD.Float32x4.mul(b,g);a=SIMD.Float32x4.swizzle(a,1,0,3,2);f=SIMD.Float32x4.add(SIMD.Float32x4.mul(c,a),f);l=SIMD.Float32x4.mul(d,a);a=SIMD.Float32x4.swizzle(a,2,3,0,1);f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(c,
a));l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(d,a),l);l=SIMD.Float32x4.swizzle(l,2,3,0,1);a=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b,2,3,0,1),c);a=SIMD.Float32x4.swizzle(a,1,0,3,2);g=SIMD.Float32x4.swizzle(g,2,3,0,1);f=SIMD.Float32x4.add(SIMD.Float32x4.mul(g,a),f);n=SIMD.Float32x4.mul(d,a);a=SIMD.Float32x4.swizzle(a,2,3,0,1);f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(g,a));n=SIMD.Float32x4.sub(SIMD.Float32x4.mul(d,a),n);n=SIMD.Float32x4.swizzle(n,2,3,0,1);a=SIMD.Float32x4.mul(d,b);a=SIMD.Float32x4.swizzle(a,
1,0,3,2);n=SIMD.Float32x4.add(SIMD.Float32x4.mul(c,a),n);l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(g,a),l);a=SIMD.Float32x4.swizzle(a,2,3,0,1);n=SIMD.Float32x4.sub(SIMD.Float32x4.mul(c,a),n);l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(g,a));a=SIMD.Float32x4.mul(d,c);a=SIMD.Float32x4.swizzle(a,1,0,3,2);h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(g,a));n=SIMD.Float32x4.add(SIMD.Float32x4.mul(b,a),n);a=SIMD.Float32x4.swizzle(a,2,3,0,1);h=SIMD.Float32x4.add(SIMD.Float32x4.mul(g,a),h);n=SIMD.Float32x4.sub(n,
SIMD.Float32x4.mul(b,a));a=SIMD.Float32x4.mul(d,g);a=SIMD.Float32x4.swizzle(a,1,0,3,2);h=SIMD.Float32x4.add(SIMD.Float32x4.mul(c,a),h);l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(b,a));a=SIMD.Float32x4.swizzle(a,2,3,0,1);h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(c,a));l=SIMD.Float32x4.add(SIMD.Float32x4.mul(b,a),l);d=SIMD.Float32x4.mul(d,f);d=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(d,2,3,0,1),d);d=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(d,1,0,3,2),d);a=SIMD.Float32x4.reciprocalApproximation(d);
d=SIMD.Float32x4.sub(SIMD.Float32x4.add(a,a),SIMD.Float32x4.mul(d,SIMD.Float32x4.mul(a,a)));d=SIMD.Float32x4.swizzle(d,0,0,0,0);if(!d)return null;SIMD.Float32x4.store(e,0,SIMD.Float32x4.mul(d,f));SIMD.Float32x4.store(e,4,SIMD.Float32x4.mul(d,h));SIMD.Float32x4.store(e,8,SIMD.Float32x4.mul(d,n));SIMD.Float32x4.store(e,12,SIMD.Float32x4.mul(d,l));return e};h.invert=q.USE_SIMD?h.SIMD.invert:h.scalar.invert;h.scalar.adjoint=function(e,a){var d=a[0],b=a[1],g=a[2],c=a[3],f=a[4],h=a[5],n=a[6],l=a[7],p=a[8],
m=a[9],r=a[10],t=a[11],u=a[12],q=a[13],v=a[14];a=a[15];e[0]=h*(r*a-t*v)-m*(n*a-l*v)+q*(n*t-l*r);e[1]=-(b*(r*a-t*v)-m*(g*a-c*v)+q*(g*t-c*r));e[2]=b*(n*a-l*v)-h*(g*a-c*v)+q*(g*l-c*n);e[3]=-(b*(n*t-l*r)-h*(g*t-c*r)+m*(g*l-c*n));e[4]=-(f*(r*a-t*v)-p*(n*a-l*v)+u*(n*t-l*r));e[5]=d*(r*a-t*v)-p*(g*a-c*v)+u*(g*t-c*r);e[6]=-(d*(n*a-l*v)-f*(g*a-c*v)+u*(g*l-c*n));e[7]=d*(n*t-l*r)-f*(g*t-c*r)+p*(g*l-c*n);e[8]=f*(m*a-t*q)-p*(h*a-l*q)+u*(h*t-l*m);e[9]=-(d*(m*a-t*q)-p*(b*a-c*q)+u*(b*t-c*m));e[10]=d*(h*a-l*q)-f*(b*
a-c*q)+u*(b*l-c*h);e[11]=-(d*(h*t-l*m)-f*(b*t-c*m)+p*(b*l-c*h));e[12]=-(f*(m*v-r*q)-p*(h*v-n*q)+u*(h*r-n*m));e[13]=d*(m*v-r*q)-p*(b*v-g*q)+u*(b*r-g*m);e[14]=-(d*(h*v-n*q)-f*(b*v-g*q)+u*(b*n-g*h));e[15]=d*(h*r-n*m)-f*(b*r-g*m)+p*(b*n-g*h);return e};h.SIMD.adjoint=function(e,a){var d,b,g,c,f,h,n,l;d=SIMD.Float32x4.load(a,0);b=SIMD.Float32x4.load(a,4);g=SIMD.Float32x4.load(a,8);c=SIMD.Float32x4.load(a,12);h=SIMD.Float32x4.shuffle(d,b,0,1,4,5);f=SIMD.Float32x4.shuffle(g,c,0,1,4,5);a=SIMD.Float32x4.shuffle(h,
f,0,2,4,6);f=SIMD.Float32x4.shuffle(f,h,1,3,5,7);h=SIMD.Float32x4.shuffle(d,b,2,3,6,7);b=SIMD.Float32x4.shuffle(g,c,2,3,6,7);d=SIMD.Float32x4.shuffle(h,b,0,2,4,6);b=SIMD.Float32x4.shuffle(b,h,1,3,5,7);h=SIMD.Float32x4.mul(d,b);h=SIMD.Float32x4.swizzle(h,1,0,3,2);g=SIMD.Float32x4.mul(f,h);c=SIMD.Float32x4.mul(a,h);h=SIMD.Float32x4.swizzle(h,2,3,0,1);g=SIMD.Float32x4.sub(SIMD.Float32x4.mul(f,h),g);c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,h),c);c=SIMD.Float32x4.swizzle(c,2,3,0,1);h=SIMD.Float32x4.mul(f,
d);h=SIMD.Float32x4.swizzle(h,1,0,3,2);g=SIMD.Float32x4.add(SIMD.Float32x4.mul(b,h),g);l=SIMD.Float32x4.mul(a,h);h=SIMD.Float32x4.swizzle(h,2,3,0,1);g=SIMD.Float32x4.sub(g,SIMD.Float32x4.mul(b,h));l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,h),l);l=SIMD.Float32x4.swizzle(l,2,3,0,1);h=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,2,3,0,1),b);h=SIMD.Float32x4.swizzle(h,1,0,3,2);d=SIMD.Float32x4.swizzle(d,2,3,0,1);g=SIMD.Float32x4.add(SIMD.Float32x4.mul(d,h),g);n=SIMD.Float32x4.mul(a,h);h=SIMD.Float32x4.swizzle(h,
2,3,0,1);g=SIMD.Float32x4.sub(g,SIMD.Float32x4.mul(d,h));n=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,h),n);n=SIMD.Float32x4.swizzle(n,2,3,0,1);h=SIMD.Float32x4.mul(a,f);h=SIMD.Float32x4.swizzle(h,1,0,3,2);n=SIMD.Float32x4.add(SIMD.Float32x4.mul(b,h),n);l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(d,h),l);h=SIMD.Float32x4.swizzle(h,2,3,0,1);n=SIMD.Float32x4.sub(SIMD.Float32x4.mul(b,h),n);l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(d,h));h=SIMD.Float32x4.mul(a,b);h=SIMD.Float32x4.swizzle(h,1,0,3,2);c=SIMD.Float32x4.sub(c,
SIMD.Float32x4.mul(d,h));n=SIMD.Float32x4.add(SIMD.Float32x4.mul(f,h),n);h=SIMD.Float32x4.swizzle(h,2,3,0,1);c=SIMD.Float32x4.add(SIMD.Float32x4.mul(d,h),c);n=SIMD.Float32x4.sub(n,SIMD.Float32x4.mul(f,h));h=SIMD.Float32x4.mul(a,d);h=SIMD.Float32x4.swizzle(h,1,0,3,2);c=SIMD.Float32x4.add(SIMD.Float32x4.mul(b,h),c);l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(f,h));h=SIMD.Float32x4.swizzle(h,2,3,0,1);c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(b,h));l=SIMD.Float32x4.add(SIMD.Float32x4.mul(f,h),l);SIMD.Float32x4.store(e,
0,g);SIMD.Float32x4.store(e,4,c);SIMD.Float32x4.store(e,8,n);SIMD.Float32x4.store(e,12,l);return e};h.adjoint=q.USE_SIMD?h.SIMD.adjoint:h.scalar.adjoint;h.determinant=function(e){var a=e[0],d=e[1],b=e[2],g=e[3],c=e[4],f=e[5],h=e[6],n=e[7],l=e[8],p=e[9],m=e[10],r=e[11],t=e[12],u=e[13],q=e[14];e=e[15];return(a*f-d*c)*(m*e-r*q)-(a*h-b*c)*(p*e-r*u)+(a*n-g*c)*(p*q-m*u)+(d*h-b*f)*(l*e-r*t)-(d*n-g*f)*(l*q-m*t)+(b*n-g*h)*(l*u-p*t)};h.SIMD.multiply=function(e,a,d){var b=SIMD.Float32x4.load(a,0),g=SIMD.Float32x4.load(a,
4),c=SIMD.Float32x4.load(a,8);a=SIMD.Float32x4.load(a,12);var f=SIMD.Float32x4.load(d,0),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,0,0,0,0),b),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,1,1,1,1),g),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,2,2,2,2),c),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,3,3,3,3),a))));SIMD.Float32x4.store(e,0,f);f=SIMD.Float32x4.load(d,4);f=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,0,0,0,
0),b),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,1,1,1,1),g),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,2,2,2,2),c),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,3,3,3,3),a))));SIMD.Float32x4.store(e,4,f);f=SIMD.Float32x4.load(d,8);f=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,0,0,0,0),b),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,1,1,1,1),g),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,2,2,2,2),c),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,
3,3,3,3),a))));SIMD.Float32x4.store(e,8,f);d=SIMD.Float32x4.load(d,12);b=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,0,0,0,0),b),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,1,1,1,1),g),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,2,2,2,2),c),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,3,3,3,3),a))));SIMD.Float32x4.store(e,12,b);return e};h.scalar.multiply=function(e,a,d){var b=a[0],g=a[1],c=a[2],f=a[3],h=a[4],n=a[5],l=a[6],p=a[7],m=a[8],r=a[9],
t=a[10],u=a[11],q=a[12],v=a[13],A=a[14];a=a[15];var y=d[0],C=d[1],B=d[2],D=d[3];e[0]=y*b+C*h+B*m+D*q;e[1]=y*g+C*n+B*r+D*v;e[2]=y*c+C*l+B*t+D*A;e[3]=y*f+C*p+B*u+D*a;y=d[4];C=d[5];B=d[6];D=d[7];e[4]=y*b+C*h+B*m+D*q;e[5]=y*g+C*n+B*r+D*v;e[6]=y*c+C*l+B*t+D*A;e[7]=y*f+C*p+B*u+D*a;y=d[8];C=d[9];B=d[10];D=d[11];e[8]=y*b+C*h+B*m+D*q;e[9]=y*g+C*n+B*r+D*v;e[10]=y*c+C*l+B*t+D*A;e[11]=y*f+C*p+B*u+D*a;y=d[12];C=d[13];B=d[14];D=d[15];e[12]=y*b+C*h+B*m+D*q;e[13]=y*g+C*n+B*r+D*v;e[14]=y*c+C*l+B*t+D*A;e[15]=y*f+C*
p+B*u+D*a;return e};h.multiply=q.USE_SIMD?h.SIMD.multiply:h.scalar.multiply;h.mul=h.multiply;h.scalar.translate=function(e,a,d){var b=d[0],g=d[1];d=d[2];var c,f,h,n,l,p,m,r,t,u,q,v;a===e?(e[12]=a[0]*b+a[4]*g+a[8]*d+a[12],e[13]=a[1]*b+a[5]*g+a[9]*d+a[13],e[14]=a[2]*b+a[6]*g+a[10]*d+a[14],e[15]=a[3]*b+a[7]*g+a[11]*d+a[15]):(c=a[0],f=a[1],h=a[2],n=a[3],l=a[4],p=a[5],m=a[6],r=a[7],t=a[8],u=a[9],q=a[10],v=a[11],e[0]=c,e[1]=f,e[2]=h,e[3]=n,e[4]=l,e[5]=p,e[6]=m,e[7]=r,e[8]=t,e[9]=u,e[10]=q,e[11]=v,e[12]=
c*b+l*g+t*d+a[12],e[13]=f*b+p*g+u*d+a[13],e[14]=h*b+m*g+q*d+a[14],e[15]=n*b+r*g+v*d+a[15]);return e};h.SIMD.translate=function(e,a,d){var b=SIMD.Float32x4.load(a,0),g=SIMD.Float32x4.load(a,4),c=SIMD.Float32x4.load(a,8),f=SIMD.Float32x4.load(a,12);d=SIMD.Float32x4(d[0],d[1],d[2],0);a!==e&&(e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],e[4]=a[4],e[5]=a[5],e[6]=a[6],e[7]=a[7],e[8]=a[8],e[9]=a[9],e[10]=a[10],e[11]=a[11]);b=SIMD.Float32x4.mul(b,SIMD.Float32x4.swizzle(d,0,0,0,0));g=SIMD.Float32x4.mul(g,SIMD.Float32x4.swizzle(d,
1,1,1,1));c=SIMD.Float32x4.mul(c,SIMD.Float32x4.swizzle(d,2,2,2,2));a=SIMD.Float32x4.add(b,SIMD.Float32x4.add(g,SIMD.Float32x4.add(c,f)));SIMD.Float32x4.store(e,12,a);return e};h.translate=q.USE_SIMD?h.SIMD.translate:h.scalar.translate;h.scalar.scale=function(e,a,d){var b=d[0],g=d[1];d=d[2];e[0]=a[0]*b;e[1]=a[1]*b;e[2]=a[2]*b;e[3]=a[3]*b;e[4]=a[4]*g;e[5]=a[5]*g;e[6]=a[6]*g;e[7]=a[7]*g;e[8]=a[8]*d;e[9]=a[9]*d;e[10]=a[10]*d;e[11]=a[11]*d;e[12]=a[12];e[13]=a[13];e[14]=a[14];e[15]=a[15];return e};h.SIMD.scale=
function(e,a,d){var b;d=SIMD.Float32x4(d[0],d[1],d[2],0);b=SIMD.Float32x4.load(a,0);SIMD.Float32x4.store(e,0,SIMD.Float32x4.mul(b,SIMD.Float32x4.swizzle(d,0,0,0,0)));b=SIMD.Float32x4.load(a,4);SIMD.Float32x4.store(e,4,SIMD.Float32x4.mul(b,SIMD.Float32x4.swizzle(d,1,1,1,1)));b=SIMD.Float32x4.load(a,8);SIMD.Float32x4.store(e,8,SIMD.Float32x4.mul(b,SIMD.Float32x4.swizzle(d,2,2,2,2)));e[12]=a[12];e[13]=a[13];e[14]=a[14];e[15]=a[15];return e};h.scale=q.USE_SIMD?h.SIMD.scale:h.scalar.scale;h.rotate=function(e,
a,d,b){var g=b[0],c=b[1];b=b[2];var f=Math.sqrt(g*g+c*c+b*b),h,n,l,p,m,r,t,u,x,v,A,y,C,B,D,E,J,F,M,H;if(Math.abs(f)<q.EPSILON)return null;f=1/f;g*=f;c*=f;b*=f;h=Math.sin(d);n=Math.cos(d);l=1-n;d=a[0];f=a[1];p=a[2];m=a[3];r=a[4];t=a[5];u=a[6];x=a[7];v=a[8];A=a[9];y=a[10];C=a[11];B=g*g*l+n;D=c*g*l+b*h;E=b*g*l-c*h;J=g*c*l-b*h;F=c*c*l+n;M=b*c*l+g*h;H=g*b*l+c*h;g=c*b*l-g*h;c=b*b*l+n;e[0]=d*B+r*D+v*E;e[1]=f*B+t*D+A*E;e[2]=p*B+u*D+y*E;e[3]=m*B+x*D+C*E;e[4]=d*J+r*F+v*M;e[5]=f*J+t*F+A*M;e[6]=p*J+u*F+y*M;e[7]=
m*J+x*F+C*M;e[8]=d*H+r*g+v*c;e[9]=f*H+t*g+A*c;e[10]=p*H+u*g+y*c;e[11]=m*H+x*g+C*c;a!==e&&(e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]);return e};h.scalar.rotateX=function(e,a,d){var b=Math.sin(d);d=Math.cos(d);var g=a[4],c=a[5],f=a[6],h=a[7],n=a[8],l=a[9],p=a[10],m=a[11];a!==e&&(e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]);e[4]=g*d+n*b;e[5]=c*d+l*b;e[6]=f*d+p*b;e[7]=h*d+m*b;e[8]=n*d-g*b;e[9]=l*d-c*b;e[10]=p*d-f*b;e[11]=m*d-h*b;return e};h.SIMD.rotateX=
function(e,a,d){var b=SIMD.Float32x4.splat(Math.sin(d));d=SIMD.Float32x4.splat(Math.cos(d));a!==e&&(e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]);var g=SIMD.Float32x4.load(a,4);a=SIMD.Float32x4.load(a,8);SIMD.Float32x4.store(e,4,SIMD.Float32x4.add(SIMD.Float32x4.mul(g,d),SIMD.Float32x4.mul(a,b)));SIMD.Float32x4.store(e,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,d),SIMD.Float32x4.mul(g,b)));return e};h.rotateX=q.USE_SIMD?h.SIMD.rotateX:h.scalar.rotateX;h.scalar.rotateY=
function(e,a,d){var b=Math.sin(d);d=Math.cos(d);var g=a[0],c=a[1],f=a[2],h=a[3],n=a[8],l=a[9],p=a[10],m=a[11];a!==e&&(e[4]=a[4],e[5]=a[5],e[6]=a[6],e[7]=a[7],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]);e[0]=g*d-n*b;e[1]=c*d-l*b;e[2]=f*d-p*b;e[3]=h*d-m*b;e[8]=g*b+n*d;e[9]=c*b+l*d;e[10]=f*b+p*d;e[11]=h*b+m*d;return e};h.SIMD.rotateY=function(e,a,d){var b=SIMD.Float32x4.splat(Math.sin(d));d=SIMD.Float32x4.splat(Math.cos(d));a!==e&&(e[4]=a[4],e[5]=a[5],e[6]=a[6],e[7]=a[7],e[12]=a[12],e[13]=a[13],
e[14]=a[14],e[15]=a[15]);var g=SIMD.Float32x4.load(a,0);a=SIMD.Float32x4.load(a,8);SIMD.Float32x4.store(e,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(g,d),SIMD.Float32x4.mul(a,b)));SIMD.Float32x4.store(e,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(g,b),SIMD.Float32x4.mul(a,d)));return e};h.rotateY=q.USE_SIMD?h.SIMD.rotateY:h.scalar.rotateY;h.scalar.rotateZ=function(e,a,d){var b=Math.sin(d);d=Math.cos(d);var g=a[0],c=a[1],f=a[2],h=a[3],n=a[4],l=a[5],p=a[6],m=a[7];a!==e&&(e[8]=a[8],e[9]=a[9],e[10]=a[10],e[11]=
a[11],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]);e[0]=g*d+n*b;e[1]=c*d+l*b;e[2]=f*d+p*b;e[3]=h*d+m*b;e[4]=n*d-g*b;e[5]=l*d-c*b;e[6]=p*d-f*b;e[7]=m*d-h*b;return e};h.SIMD.rotateZ=function(e,a,d){var b=SIMD.Float32x4.splat(Math.sin(d));d=SIMD.Float32x4.splat(Math.cos(d));a!==e&&(e[8]=a[8],e[9]=a[9],e[10]=a[10],e[11]=a[11],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]);var g=SIMD.Float32x4.load(a,0);a=SIMD.Float32x4.load(a,4);SIMD.Float32x4.store(e,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(g,d),
SIMD.Float32x4.mul(a,b)));SIMD.Float32x4.store(e,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,d),SIMD.Float32x4.mul(g,b)));return e};h.rotateZ=q.USE_SIMD?h.SIMD.rotateZ:h.scalar.rotateZ;h.fromTranslation=function(e,a){e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=1;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=1;e[11]=0;e[12]=a[0];e[13]=a[1];e[14]=a[2];e[15]=1;return e};h.fromScaling=function(e,a){e[0]=a[0];e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=a[1];e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=a[2];e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=
1;return e};h.fromRotation=function(e,a,d){var b=d[0],g=d[1];d=d[2];var c=Math.sqrt(b*b+g*g+d*d),f;if(Math.abs(c)<q.EPSILON)return null;c=1/c;b*=c;g*=c;d*=c;c=Math.sin(a);a=Math.cos(a);f=1-a;e[0]=b*b*f+a;e[1]=g*b*f+d*c;e[2]=d*b*f-g*c;e[3]=0;e[4]=b*g*f-d*c;e[5]=g*g*f+a;e[6]=d*g*f+b*c;e[7]=0;e[8]=b*d*f+g*c;e[9]=g*d*f-b*c;e[10]=d*d*f+a;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e};h.fromXRotation=function(e,a){var d=Math.sin(a);a=Math.cos(a);e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=a;e[6]=d;e[7]=
0;e[8]=0;e[9]=-d;e[10]=a;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e};h.fromYRotation=function(e,a){var d=Math.sin(a);a=Math.cos(a);e[0]=a;e[1]=0;e[2]=-d;e[3]=0;e[4]=0;e[5]=1;e[6]=0;e[7]=0;e[8]=d;e[9]=0;e[10]=a;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e};h.fromZRotation=function(e,a){var d=Math.sin(a);a=Math.cos(a);e[0]=a;e[1]=d;e[2]=0;e[3]=0;e[4]=-d;e[5]=a;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=1;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e};h.fromRotationTranslation=function(e,a,d){var b=
a[0],g=a[1],c=a[2],f=a[3],h=b+b,n=g+g,l=c+c;a=b*h;var p=b*n,b=b*l,m=g*n,g=g*l,c=c*l,h=f*h,n=f*n,f=f*l;e[0]=1-(m+c);e[1]=p+f;e[2]=b-n;e[3]=0;e[4]=p-f;e[5]=1-(a+c);e[6]=g+h;e[7]=0;e[8]=b+n;e[9]=g-h;e[10]=1-(a+m);e[11]=0;e[12]=d[0];e[13]=d[1];e[14]=d[2];e[15]=1;return e};h.getTranslation=function(e,a){e[0]=a[12];e[1]=a[13];e[2]=a[14];return e};h.getRotation=function(e,a){var d=a[0]+a[5]+a[10],b=0;0<d?(b=2*Math.sqrt(d+1),e[3]=.25*b,e[0]=(a[6]-a[9])/b,e[1]=(a[8]-a[2])/b,e[2]=(a[1]-a[4])/b):a[0]>a[5]&a[0]>
a[10]?(b=2*Math.sqrt(1+a[0]-a[5]-a[10]),e[3]=(a[6]-a[9])/b,e[0]=.25*b,e[1]=(a[1]+a[4])/b,e[2]=(a[8]+a[2])/b):a[5]>a[10]?(b=2*Math.sqrt(1+a[5]-a[0]-a[10]),e[3]=(a[8]-a[2])/b,e[0]=(a[1]+a[4])/b,e[1]=.25*b,e[2]=(a[6]+a[9])/b):(b=2*Math.sqrt(1+a[10]-a[0]-a[5]),e[3]=(a[1]-a[4])/b,e[0]=(a[8]+a[2])/b,e[1]=(a[6]+a[9])/b,e[2]=.25*b);return e};h.fromRotationTranslationScale=function(e,a,d,b){var g=a[0],c=a[1],f=a[2],h=a[3],n=g+g,l=c+c,p=f+f;a=g*n;var m=g*l,g=g*p,r=c*l,c=c*p,f=f*p,n=h*n,l=h*l,h=h*p,p=b[0],t=
b[1];b=b[2];e[0]=(1-(r+f))*p;e[1]=(m+h)*p;e[2]=(g-l)*p;e[3]=0;e[4]=(m-h)*t;e[5]=(1-(a+f))*t;e[6]=(c+n)*t;e[7]=0;e[8]=(g+l)*b;e[9]=(c-n)*b;e[10]=(1-(a+r))*b;e[11]=0;e[12]=d[0];e[13]=d[1];e[14]=d[2];e[15]=1;return e};h.fromRotationTranslationScaleOrigin=function(e,a,d,b,g){var c=a[0],f=a[1],h=a[2],n=a[3],l=c+c,p=f+f,m=h+h;a=c*l;var r=c*p,c=c*m,t=f*p,f=f*m,h=h*m,l=n*l,p=n*p,n=n*m,m=b[0],u=b[1];b=b[2];var q=g[0],v=g[1];g=g[2];e[0]=(1-(t+h))*m;e[1]=(r+n)*m;e[2]=(c-p)*m;e[3]=0;e[4]=(r-n)*u;e[5]=(1-(a+h))*
u;e[6]=(f+l)*u;e[7]=0;e[8]=(c+p)*b;e[9]=(f-l)*b;e[10]=(1-(a+t))*b;e[11]=0;e[12]=d[0]+q-(e[0]*q+e[4]*v+e[8]*g);e[13]=d[1]+v-(e[1]*q+e[5]*v+e[9]*g);e[14]=d[2]+g-(e[2]*q+e[6]*v+e[10]*g);e[15]=1;return e};h.fromQuat=function(e,a){var d=a[0],b=a[1],g=a[2];a=a[3];var c=d+d,f=b+b,h=g+g,d=d*c,n=b*c,b=b*f,l=g*c,p=g*f,g=g*h,c=a*c,f=a*f;a*=h;e[0]=1-b-g;e[1]=n+a;e[2]=l-f;e[3]=0;e[4]=n-a;e[5]=1-d-g;e[6]=p+c;e[7]=0;e[8]=l+f;e[9]=p-c;e[10]=1-d-b;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e};h.frustum=function(e,
a,d,b,g,c,f){var h=1/(d-a),n=1/(g-b),l=1/(c-f);e[0]=2*c*h;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=2*c*n;e[6]=0;e[7]=0;e[8]=(d+a)*h;e[9]=(g+b)*n;e[10]=(f+c)*l;e[11]=-1;e[12]=0;e[13]=0;e[14]=f*c*2*l;e[15]=0;return e};h.perspective=function(e,a,d,b,g){a=1/Math.tan(a/2);var c=1/(b-g);e[0]=a/d;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=a;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=(g+b)*c;e[11]=-1;e[12]=0;e[13]=0;e[14]=2*g*b*c;e[15]=0;return e};h.perspectiveFromFieldOfView=function(e,a,d,b){var g=Math.tan(a.upDegrees*Math.PI/180),
c=Math.tan(a.downDegrees*Math.PI/180),f=Math.tan(a.leftDegrees*Math.PI/180);a=Math.tan(a.rightDegrees*Math.PI/180);var h=2/(f+a),n=2/(g+c);e[0]=h;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=n;e[6]=0;e[7]=0;e[8]=-((f-a)*h*.5);e[9]=(g-c)*n*.5;e[10]=b/(d-b);e[11]=-1;e[12]=0;e[13]=0;e[14]=b*d/(d-b);e[15]=0;return e};h.ortho=function(e,a,d,b,g,c,f){var h=1/(a-d),n=1/(b-g),l=1/(c-f);e[0]=-2*h;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=-2*n;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=2*l;e[11]=0;e[12]=(a+d)*h;e[13]=(g+b)*n;e[14]=(f+c)*
l;e[15]=1;return e};h.lookAt=function(e,a,d,b){var g,c,f,k,n,l,p,m,r=a[0],t=a[1];a=a[2];f=b[0];k=b[1];c=b[2];p=d[0];b=d[1];g=d[2];if(Math.abs(r-p)<q.EPSILON&&Math.abs(t-b)<q.EPSILON&&Math.abs(a-g)<q.EPSILON)return h.identity(e);d=r-p;b=t-b;p=a-g;m=1/Math.sqrt(d*d+b*b+p*p);d*=m;b*=m;p*=m;g=k*p-c*b;c=c*d-f*p;f=f*b-k*d;(m=Math.sqrt(g*g+c*c+f*f))?(m=1/m,g*=m,c*=m,f*=m):f=c=g=0;k=b*f-p*c;n=p*g-d*f;l=d*c-b*g;(m=Math.sqrt(k*k+n*n+l*l))?(m=1/m,k*=m,n*=m,l*=m):l=n=k=0;e[0]=g;e[1]=k;e[2]=d;e[3]=0;e[4]=c;e[5]=
n;e[6]=b;e[7]=0;e[8]=f;e[9]=l;e[10]=p;e[11]=0;e[12]=-(g*r+c*t+f*a);e[13]=-(k*r+n*t+l*a);e[14]=-(d*r+b*t+p*a);e[15]=1;return e};h.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"};h.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],
2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))};h.add=function(e,a,d){e[0]=a[0]+d[0];e[1]=a[1]+d[1];e[2]=a[2]+d[2];e[3]=a[3]+d[3];e[4]=a[4]+d[4];e[5]=a[5]+d[5];e[6]=a[6]+d[6];e[7]=a[7]+d[7];e[8]=a[8]+d[8];e[9]=a[9]+d[9];e[10]=a[10]+d[10];e[11]=a[11]+d[11];e[12]=a[12]+d[12];e[13]=a[13]+d[13];e[14]=a[14]+d[14];e[15]=a[15]+d[15];return e};h.subtract=function(e,a,d){e[0]=a[0]-d[0];e[1]=a[1]-d[1];e[2]=a[2]-d[2];e[3]=a[3]-
d[3];e[4]=a[4]-d[4];e[5]=a[5]-d[5];e[6]=a[6]-d[6];e[7]=a[7]-d[7];e[8]=a[8]-d[8];e[9]=a[9]-d[9];e[10]=a[10]-d[10];e[11]=a[11]-d[11];e[12]=a[12]-d[12];e[13]=a[13]-d[13];e[14]=a[14]-d[14];e[15]=a[15]-d[15];return e};h.sub=h.subtract;h.multiplyScalar=function(e,a,d){e[0]=a[0]*d;e[1]=a[1]*d;e[2]=a[2]*d;e[3]=a[3]*d;e[4]=a[4]*d;e[5]=a[5]*d;e[6]=a[6]*d;e[7]=a[7]*d;e[8]=a[8]*d;e[9]=a[9]*d;e[10]=a[10]*d;e[11]=a[11]*d;e[12]=a[12]*d;e[13]=a[13]*d;e[14]=a[14]*d;e[15]=a[15]*d;return e};h.multiplyScalarAndAdd=function(e,
a,d,b){e[0]=a[0]+d[0]*b;e[1]=a[1]+d[1]*b;e[2]=a[2]+d[2]*b;e[3]=a[3]+d[3]*b;e[4]=a[4]+d[4]*b;e[5]=a[5]+d[5]*b;e[6]=a[6]+d[6]*b;e[7]=a[7]+d[7]*b;e[8]=a[8]+d[8]*b;e[9]=a[9]+d[9]*b;e[10]=a[10]+d[10]*b;e[11]=a[11]+d[11]*b;e[12]=a[12]+d[12]*b;e[13]=a[13]+d[13]*b;e[14]=a[14]+d[14]*b;e[15]=a[15]+d[15]*b;return e};h.exactEquals=function(e,a){return e[0]===a[0]&&e[1]===a[1]&&e[2]===a[2]&&e[3]===a[3]&&e[4]===a[4]&&e[5]===a[5]&&e[6]===a[6]&&e[7]===a[7]&&e[8]===a[8]&&e[9]===a[9]&&e[10]===a[10]&&e[11]===a[11]&&
e[12]===a[12]&&e[13]===a[13]&&e[14]===a[14]&&e[15]===a[15]};h.equals=function(e,a){var d=e[0],b=e[1],g=e[2],c=e[3],f=e[4],h=e[5],n=e[6],l=e[7],p=e[8],m=e[9],r=e[10],t=e[11],u=e[12],x=e[13],v=e[14];e=e[15];var A=a[0],y=a[1],C=a[2],B=a[3],D=a[4],E=a[5],J=a[6],F=a[7],M=a[8],H=a[9],I=a[10],K=a[11],O=a[12],P=a[13],L=a[14];a=a[15];return Math.abs(d-A)<=q.EPSILON*Math.max(1,Math.abs(d),Math.abs(A))&&Math.abs(b-y)<=q.EPSILON*Math.max(1,Math.abs(b),Math.abs(y))&&Math.abs(g-C)<=q.EPSILON*Math.max(1,Math.abs(g),
Math.abs(C))&&Math.abs(c-B)<=q.EPSILON*Math.max(1,Math.abs(c),Math.abs(B))&&Math.abs(f-D)<=q.EPSILON*Math.max(1,Math.abs(f),Math.abs(D))&&Math.abs(h-E)<=q.EPSILON*Math.max(1,Math.abs(h),Math.abs(E))&&Math.abs(n-J)<=q.EPSILON*Math.max(1,Math.abs(n),Math.abs(J))&&Math.abs(l-F)<=q.EPSILON*Math.max(1,Math.abs(l),Math.abs(F))&&Math.abs(p-M)<=q.EPSILON*Math.max(1,Math.abs(p),Math.abs(M))&&Math.abs(m-H)<=q.EPSILON*Math.max(1,Math.abs(m),Math.abs(H))&&Math.abs(r-I)<=q.EPSILON*Math.max(1,Math.abs(r),Math.abs(I))&&
Math.abs(t-K)<=q.EPSILON*Math.max(1,Math.abs(t),Math.abs(K))&&Math.abs(u-O)<=q.EPSILON*Math.max(1,Math.abs(u),Math.abs(O))&&Math.abs(x-P)<=q.EPSILON*Math.max(1,Math.abs(x),Math.abs(P))&&Math.abs(v-L)<=q.EPSILON*Math.max(1,Math.abs(v),Math.abs(L))&&Math.abs(e-a)<=q.EPSILON*Math.max(1,Math.abs(e),Math.abs(a))};return h})},"esri/core/libs/gl-matrix/common":function(){define([],function(){var q={EPSILON:1E-6};q.ARRAY_TYPE="undefined"!==typeof Float32Array?Float32Array:Array;q.RANDOM=Math.random;q.ENABLE_SIMD=
!1;q.SIMD_AVAILABLE=q.ARRAY_TYPE===Float32Array&&"SIMD"in this;q.USE_SIMD=q.ENABLE_SIMD&&q.SIMD_AVAILABLE;q.setMatrixArrayType=function(e){q.ARRAY_TYPE=e};var h=Math.PI/180;q.toRadian=function(e){return e*h};q.equals=function(e,a){return Math.abs(e-a)<=q.EPSILON*Math.max(1,Math.abs(e),Math.abs(a))};return q})},"esri/core/libs/gl-matrix/vec2":function(){define(["./common"],function(q){var h={create:function(){var e=new q.ARRAY_TYPE(2);e[0]=0;e[1]=0;return e},clone:function(e){var a=new q.ARRAY_TYPE(2);
a[0]=e[0];a[1]=e[1];return a},fromValues:function(e,a){var d=new q.ARRAY_TYPE(2);d[0]=e;d[1]=a;return d},copy:function(e,a){e[0]=a[0];e[1]=a[1];return e},set:function(e,a,d){e[0]=a;e[1]=d;return e},add:function(e,a,d){e[0]=a[0]+d[0];e[1]=a[1]+d[1];return e},subtract:function(e,a,d){e[0]=a[0]-d[0];e[1]=a[1]-d[1];return e}};h.sub=h.subtract;h.multiply=function(e,a,d){e[0]=a[0]*d[0];e[1]=a[1]*d[1];return e};h.mul=h.multiply;h.divide=function(e,a,d){e[0]=a[0]/d[0];e[1]=a[1]/d[1];return e};h.div=h.divide;
h.ceil=function(e,a){e[0]=Math.ceil(a[0]);e[1]=Math.ceil(a[1]);return e};h.floor=function(e,a){e[0]=Math.floor(a[0]);e[1]=Math.floor(a[1]);return e};h.min=function(e,a,d){e[0]=Math.min(a[0],d[0]);e[1]=Math.min(a[1],d[1]);return e};h.max=function(e,a,d){e[0]=Math.max(a[0],d[0]);e[1]=Math.max(a[1],d[1]);return e};h.round=function(e,a){e[0]=Math.round(a[0]);e[1]=Math.round(a[1]);return e};h.scale=function(e,a,d){e[0]=a[0]*d;e[1]=a[1]*d;return e};h.scaleAndAdd=function(e,a,d,b){e[0]=a[0]+d[0]*b;e[1]=
a[1]+d[1]*b;return e};h.distance=function(e,a){var d=a[0]-e[0];e=a[1]-e[1];return Math.sqrt(d*d+e*e)};h.dist=h.distance;h.squaredDistance=function(e,a){var d=a[0]-e[0];e=a[1]-e[1];return d*d+e*e};h.sqrDist=h.squaredDistance;h.length=function(e){var a=e[0];e=e[1];return Math.sqrt(a*a+e*e)};h.len=h.length;h.squaredLength=function(e){var a=e[0];e=e[1];return a*a+e*e};h.sqrLen=h.squaredLength;h.negate=function(e,a){e[0]=-a[0];e[1]=-a[1];return e};h.inverse=function(e,a){e[0]=1/a[0];e[1]=1/a[1];return e};
h.normalize=function(e,a){var d=a[0],b=a[1],d=d*d+b*b;0<d&&(d=1/Math.sqrt(d),e[0]=a[0]*d,e[1]=a[1]*d);return e};h.dot=function(e,a){return e[0]*a[0]+e[1]*a[1]};h.cross=function(e,a,d){a=a[0]*d[1]-a[1]*d[0];e[0]=e[1]=0;e[2]=a;return e};h.lerp=function(e,a,d,b){var g=a[0];a=a[1];e[0]=g+b*(d[0]-g);e[1]=a+b*(d[1]-a);return e};h.random=function(e,a){a=a||1;var d=2*q.RANDOM()*Math.PI;e[0]=Math.cos(d)*a;e[1]=Math.sin(d)*a;return e};h.transformMat2=function(e,a,d){var b=a[0];a=a[1];e[0]=d[0]*b+d[2]*a;e[1]=
d[1]*b+d[3]*a;return e};h.transformMat2d=function(e,a,d){var b=a[0];a=a[1];e[0]=d[0]*b+d[2]*a+d[4];e[1]=d[1]*b+d[3]*a+d[5];return e};h.transformMat3=function(e,a,d){var b=a[0];a=a[1];e[0]=d[0]*b+d[3]*a+d[6];e[1]=d[1]*b+d[4]*a+d[7];return e};h.transformMat4=function(e,a,d){var b=a[0];a=a[1];e[0]=d[0]*b+d[4]*a+d[12];e[1]=d[1]*b+d[5]*a+d[13];return e};h.forEach=function(){var e=h.create();return function(a,d,b,g,c,f){d||(d=2);b||(b=0);for(g=g?Math.min(g*d+b,a.length):a.length;b<g;b+=d)e[0]=a[b],e[1]=
a[b+1],c(e,e,f),a[b]=e[0],a[b+1]=e[1];return a}}();h.str=function(e){return"vec2("+e[0]+", "+e[1]+")"};h.exactEquals=function(e,a){return e[0]===a[0]&&e[1]===a[1]};h.equals=function(e,a){var d=e[0];e=e[1];var b=a[0];a=a[1];return Math.abs(d-b)<=q.EPSILON*Math.max(1,Math.abs(d),Math.abs(b))&&Math.abs(e-a)<=q.EPSILON*Math.max(1,Math.abs(e),Math.abs(a))};return h})},"esri/views/2d/engine/DisplayObject":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","./Evented"],function(q,
h,e,a){return function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b._renderRequestedCalled=!1;b._attached=!1;b._opacity=1;b.renderRequested=!1;b._visible=!0;return b}e(b,a);Object.defineProperty(b.prototype,"attached",{get:function(){return this._attached},set:function(a){this._attached!==a&&((this._attached=a)?this.hasEventListener("attach")&&this.emit("attach"):this.hasEventListener("detach")&&this.emit("detach"))},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"opacity",{get:function(){return this._opacity},set:function(a){this._opacity!==a&&(this._opacity=a,this.requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"visible",{get:function(){return this._visible},set:function(a){this._visible!==a&&(this._visible=a,this.requestRender())},enumerable:!0,configurable:!0});b.prototype.attach=function(a){return!0};b.prototype.detach=function(a){};b.prototype.processRender=function(a){this._renderRequestedCalled=!1;this.doRender(a);
this._renderRequestedCalled||(this.renderRequested=!1);this.hasEventListener("post-render")&&this.emit("post-render")};b.prototype.requestRender=function(){var a=this.renderRequested;this.renderRequested=this._renderRequestedCalled=!0;this.parent&&this.parent.requestChildRender(this);a!==this.renderRequested&&this.hasEventListener("will-render")&&this.emit("will-render")};b.prototype.dispose=function(){};return b}(a.Evented)})},"esri/views/2d/engine/Evented":function(){define(["require","exports",
"../../../core/tsSupport/extendsHelper","dojo/aspect","dojo/on"],function(q,h,e,a,d){Object.defineProperty(h,"__esModule",{value:!0});q=function(){function b(){}b.prototype.on=function(b,c){return a.after(this,"on"+b,c,!0)};b.prototype.once=function(a,b){return d.once(this,a,b)};b.prototype.emit=function(a){d.emit(this,a,this)};b.prototype.hasEventListener=function(a){a="on"+a;return!(!this[a]||!this[a].after)};return b}();h.Evented=q;h.EventedMixin=function(b){return function(b){function c(){return null!==
b&&b.apply(this,arguments)||this}e(c,b);c.prototype.on=function(b,c){return a.after(this,"on"+b,c,!0)};c.prototype.once=function(a,b){return d.once(this,a,b)};c.prototype.emit=function(a,b){d.emit(this,a,b)};c.prototype.hasEventListener=function(a){a="on"+a;return!(!this[a]||!this[a].after)};return c}(b)}})},"esri/views/vectorTiles/RenderBucket":function(){define(["require","exports","../../core/tsSupport/extendsHelper","../../core/tsSupport/decorateHelper"],function(q,h,e,a){Object.defineProperty(h,
"__esModule",{value:!0});q=function(){return function(a){this.type=a}}();h.RenderBucket=q;a=function(a){function b(){var b=a.call(this,2)||this;b.triangleElementStart=0;b.triangleElementCount=0;return b}e(b,a);b.prototype.hasData=function(){return 0<this.triangleElementCount};return b}(q);h.LineRenderBucket=a;a=function(a){function b(){var b=a.call(this,1)||this;b.triangleElementStart=0;b.triangleElementCount=0;b.outlineElementStart=0;b.outlineElementCount=0;return b}e(b,a);b.prototype.hasData=function(){return 0<
this.triangleElementCount||0<this.outlineElementCount};return b}(q);h.FillRenderBucket=a;a=function(a){function b(){var b=a.call(this,3)||this;b.markerPerPageElementsMap=new Map;b.glyphPerPageElementsMap=new Map;b.isSDF=!1;return b}e(b,a);b.prototype.hasData=function(){return 0<this.markerPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size};return b}(q);h.SymbolRenderBucket=a;a=function(a){function b(){var b=a.call(this,4)||this;b.triangleElementStart=0;b.triangleElementCount=0;return b}
e(b,a);b.prototype.hasData=function(){return 0<this.triangleElementCount};return b}(q);h.CircleRenderBucket=a;q=function(a){function b(){return a.call(this,0)||this}e(b,a);b.prototype.hasData=function(){return!0};return b}(q);h.BackgroundRenderBucket=q})},"esri/views/3d/terrain/TileGeometryFactory":function(){define("require exports ../../../geometry/support/aaBoundingBox ../lib/glMatrix ../support/ArrayPool ../support/earthUtils ../support/mathUtils ./TerrainConst".split(" "),function(q,h,e,a,d,
b,g,c){function f(a,b,d){for(var e=0;e<d.length;e++){var f=d[e];if(f){var h=f.safeWidth,k=f.width,l=f.pixelData,m=g.clamp(f.dy*(f.y1-b),0,h),f=g.clamp(f.dx*(a-f.x0),0,h),h=Math.floor(m),n=Math.floor(f),p=h*k+n,r=p+k,u=l[p],k=l[r],p=l[p+1],l=l[r+1];if(u+k+p+l<.5*c.ELEVATION_NODATA_VALUE)return m-=h,f-=n,a=u+(p-u)*f,a+(k+(l-k)*f-a)*m}}return null}function k(a,b,c,d){var e=0<(c&2),f=b+(d?1024:0)+(e?2048:0),g=r[f];if(!g){var g=b-1,h=b-1,k=b*b,l=2*g+2*h,m=g*h*6,n=6*l,u=6*(2*g+h-1);d&&(m*=2,n*=2,u*=2);
for(var l=65536<k+l?new Uint32Array(m+n):new Uint16Array(m+n),t=0,v=0,q=m,x,A,y,B,C=0,Q=0;Q<=h;Q++){e&&(C=0===Q?u:Q===h?-u:0);for(var q=q+C,G=0;G<=g;G++)y=p(G,Q,g,h),-1<y&&(B=0===Q&&G!==g?1:G===g&&Q!==h?g+1:Q===h&&0!==G?-1:0===G&&0!==Q?-(g+1):0,0!==B&&(x=t,A=k+y,y=k+(0===G&&1===Q?0:y+1),B=t+B,d?(l[q+0]=x,l[q+1]=A,l[q+2]=A,l[q+3]=y,l[q+4]=y,l[q+5]=x,l[q+6]=y,l[q+7]=B,l[q+8]=B,l[q+9]=x,l[q+10]=x,l[q+11]=y,q+=12):(l[q+0]=x,l[q+1]=A,l[q+2]=y,l[q+3]=y,l[q+4]=B,l[q+5]=x,q+=6))),++t,G<g&&Q<h&&(x=Q*(g+1)+
G,A=x+1,y=A+(g+1),B=y-1,d?(l[v+0]=x,l[v+1]=A,l[v+2]=A,l[v+3]=y,l[v+4]=y,l[v+5]=x,l[v+6]=y,l[v+7]=B,l[v+8]=B,l[v+9]=x,l[v+10]=x,l[v+11]=y,v+=12):(l[v+0]=x,l[v+1]=A,l[v+2]=y,l[v+3]=y,l[v+4]=B,l[v+5]=x,v+=6));q-=C}g={values:l,numSurfaceIndices:m,numSkirtIndices:n};r[f]=g}a.indices=g.values;a.numSurfaceIndices=g.numSurfaceIndices;a.numSkirtIndices=g.numSkirtIndices;a.numWithoutSkirtIndices=a.numSurfaceIndices+(c?6*(b-1)*(d?2:1):0)}function n(a,b,c,d){a<d[0]&&(d[0]=a);a>d[3]&&(d[3]=a);b<d[1]&&(d[1]=b);
b>d[4]&&(d[4]=b);c<d[2]&&(d[2]=c);c>d[5]&&(d[5]=c)}function l(a,b){var c=b>a?1:0;return 2+4*c+(1-2*c)*(a+b)}function p(a,b,c,d){return 0===b?a:a===c?c+b:b===d?c+d+(c-a):0===a&&0<b?2*c+d+(d-b):-1}Object.defineProperty(h,"__esModule",{value:!0});var m=new d.ArrayPool(Float32Array);h.releaseGeometry=function(a){m.put(a.vertexAttributes);a.vertexAttributes=null;a.indices=null};h.elevationSampler=f;h.createSphericalGlobeTile=function(c,d,h,r,q,E,J,F,M){var A=h[0],y=h[1],B=h[2];h=h[3];var C=.1*b.earthRadius*
(h-y),D=c-1,L=c-1,U=c*c,N=m.get(5*(U+(2*D+2*L))),S=M.geometryInfo.boundingBox;e.empty(S);var aa=d[2]-d[0],V=d[3]-d[1],T=B-A,B=E[0],Q=E[1];E=E[2];for(var G=0;G<=D;G++){var X=G/D,Z=A+X*T;t[G]=Math.sin(Z);u[G]=Math.cos(Z);x[G]=X;v[G]=d[0]+X*aa}A=r&&!!(J&1);aa=r&&!!(J&2);for(Z=T=0;Z<=L;Z++){var ea=Z/L,G=g.lerp(y,h,ea),fa=Math.cos(G),R=Math.sin(G),da=void 0;r?(da=b.earthRadius/2*Math.log((1+R)/(1-R)),ea=(da-d[1])/V):da=180*G/Math.PI;for(G=0;G<=D;G++){var X=x[G],ba=t[G],ca=u[G],ga=b.earthRadius;q&&(ga+=
f(v[G],da,q)||0);ca=ca*fa*ga-B;ba=ba*fa*ga-Q;ga=R*ga-E;n(ca,ba,ga,S);var ja=5*T;N[ja+0]=ca;N[ja+1]=ba;N[ja+2]=ga;N[ja+3]=X;N[ja+4]=ea;ja=p(G,Z,D,L);if(-1<ja){var ja=5*(U+ja),ha=A&&0===Z?-1:aa&&Z===L?1:0,ca=0===ha?ca:-B,ba=0===ha?ba:-Q,ga=0===ha?ga:b.earthRadius*ha-E;N[ja+0]=ca;N[ja+1]=ba;N[ja+2]=ga;N[ja+3]=0===ha?l(X,ea):X;N[ja+4]=0===ha?C:ea;0!==ha&&n(ca,ba,ga,S)}++T}}M.geometryInfo.numVertsPerRow=c;M.geometryInfo.vertexAttributes=N;M.geometryInfo.skirtLength=C;a.vec4d.set4(0,0,1,1,M.geometryInfo.uvOffsetAndScale);
k(M.geometryInfo,c,r?J:0,F)};h.createPlanarGlobeTile=function(b,c,d,g,h,r,u){var t=c[0],v=c[1],q=c[2]-t,x=c[3]-v,A=r?Math.max(0,(r[0]-c[0])/q):0,y=r?Math.max(0,(r[1]-c[1])/x):0,B=r?Math.min(1,(r[2]-c[0])/q):1;c=r?Math.min(1,(r[3]-c[1])/x):1;var C=B>A?1/(B-A):1,D=c>y?1/(c-y):1,E=-A*C,J=-y*D,aa=.1*q,V=b-1,T=b-1,Q=b*b,G=m.get(5*(Q+(2*V+2*T))),X=u.geometryInfo.boundingBox;e.empty(X);for(var Z=0,ea=0;ea<=T;ea++){var fa=ea/T,R=J+fa*D,fa=v+fa*x;r&&(fa<r[1]?(fa=r[1],R=0):fa>r[3]&&(fa=r[3],R=1));for(var da=
0;da<=V;da++){var ba=da/V,ca=E+ba*C,ba=t+ba*q;r&&(ba<r[0]?(ba=r[0],ca=0):ba>r[2]&&(ba=r[2],ca=1));var ga=d?f(ba,fa,d)||0:0,ba=ba-g[0],ja=fa-g[1],ga=ga-g[2];n(ba,ja,ga,X);G[5*Z]=ba;G[5*Z+1]=ja;G[5*Z+2]=ga;G[5*Z+3]=ca;G[5*Z+4]=R;var ha=p(da,ea,V,V);-1<ha&&(ha=5*(Q+ha),G[ha]=ba,G[ha+1]=ja,G[ha+2]=ga,G[ha+3]=l(ca,R),G[ha+4]=aa);++Z}}u.geometryInfo.numVertsPerRow=b;u.geometryInfo.vertexAttributes=G;u.geometryInfo.skirtLength=aa;a.vec4d.set4(A,y,B-A,c-y,u.geometryInfo.uvOffsetAndScale);k(u.geometryInfo,
b,0,h)};var r=[],t=Array(c.MAX_TILE_TESSELATION+1),u=Array(c.MAX_TILE_TESSELATION+1),x=Array(c.MAX_TILE_TESSELATION+1),v=Array(c.MAX_TILE_TESSELATION+1)})},"esri/views/3d/support/ArrayPool":function(){define(["require","exports"],function(q,h){Object.defineProperty(h,"__esModule",{value:!0});q=function(){function e(a,d){void 0===d&&(d=50);this.arrayConstructor=a;this.maxPoolSizePerCount=d;this.pool={}}e.prototype.get=function(a){var d=this.pool[a];d||(d={ptr:0,data:Array(this.maxPoolSizePerCount)},
this.pool[a]=d);0<d.ptr?(a=d.data[--d.ptr],d.data[d.ptr]=null):a=new this.arrayConstructor(a);return a};e.prototype.put=function(a){var d=this.pool[a.length];d.ptr<d.data.length&&(d.data[d.ptr++]=a)};return e}();h.ArrayPool=q})},"esri/views/3d/terrain/SphericalTile":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/ObjectPool ../lib/glMatrix ../support/earthUtils ../support/mathUtils ./Tile ./TileGeometryFactory".split(" "),function(q,h,e,a,d,b,g,c,f){function k(a,
c,d,e){d=b.earthRadius+d;var f=Math.cos(a);e[0]=Math.cos(c)*f*d;e[1]=Math.sin(c)*f*d;e[2]=Math.sin(a)*d}return function(c){function h(a,b,e,f){var g=c.call(this,h.NumSubdivisionsAtLevel)||this;g.obb=[];g.isWebMercator=!1;g.tileUp=d.vec3d.create();g.obb=Array(8);for(var k=0;8>k;k++)g.obb[k]=d.vec3d.create();void 0!==a&&g.init(a,b,e,f);return g}e(h,c);h.prototype.init=function(a,e,f,h){c.prototype.init.call(this,a,e,f,h);this.isWebMercator=h.spatialReference.isWebMercator;e=this.extentWGS84Rad[0];f=
this.extentWGS84Rad[1];h=this.extentWGS84Rad[2];var l=this.extentWGS84Rad[3];a=a[0];var m=g.lerp(f,l,.5),n=g.lerp(e,h,.5);this.edgeLen=(h-e)*Math.cos(0===a?0:Math.min(Math.abs(f),Math.abs(l)))*b.earthRadius;this.curvatureHeight=b.earthRadius-Math.sqrt(b.earthRadius*b.earthRadius-this.edgeLen*this.edgeLen/4);k(m,n,0,this.centerAtSeaLevel);d.vec3d.set(this.centerAtSeaLevel,this.tileUp);d.vec3d.normalize(this.tileUp);this._updateOBB();this.updateRadiusAndCenter()};h.prototype.updateRadiusAndCenter=function(){if(0===
this.lij[0])d.vec3d.set3(0,0,0,this.center),this.radius=b.earthRadius+this.elevationBounds[1];else{c.prototype.updateRadiusAndCenter.call(this);var a=Math.max(d.vec3d.dist2(this.center,this.obb[0]),d.vec3d.dist2(this.center,this.obb[1]));this.radius=Math.sqrt(a)}};h.prototype.isVisible=function(a){if(!this.intersectsClippingArea)return!1;if(9<this.lij[0]){for(var b=this.obb,c=0;6>c;c++){for(var d=void 0,d=0;8>d&&!(0>a[c][0]*b[d][0]+a[c][1]*b[d][1]+a[c][2]*b[d][2]+a[c][3]);d++);if(8===d)return!1}return!0}b=
this.radius;c=this.center;return a[0][0]*c[0]+a[0][1]*c[1]+a[0][2]*c[2]+a[0][3]>b||a[1][0]*c[0]+a[1][1]*c[1]+a[1][2]*c[2]+a[1][3]>b||a[2][0]*c[0]+a[2][1]*c[1]+a[2][2]*c[2]+a[2][3]>b||a[3][0]*c[0]+a[3][1]*c[1]+a[3][2]*c[2]+a[3][3]>b||a[4][0]*c[0]+a[4][1]*c[1]+a[4][2]*c[2]+a[4][3]>b||a[5][0]*c[0]+a[5][1]*c[1]+a[5][2]*c[2]+a[5][3]>b?!1:!0};h.prototype.computeElevationBounds=function(){c.prototype.computeElevationBounds.call(this);this._updateOBB()};h.prototype.createGeometry=function(a,b,c){var d=this._isPole(this.lij[1],
this.lij[0]);a.needsUpdate=!1;f.createSphericalGlobeTile(a.numVertsPerRow,this.extent,this.extentWGS84Rad,this.isWebMercator,a.samplerData,b,d,c,this.renderData);this.updateMemoryUsed()};h.prototype._updateOBB=function(){for(var a=this.extentWGS84Rad,c=this.obb,e=0;2>e;e++){var f=this.elevationBounds[e],g=4*e;k(a[1],a[0],f,c[g++]);k(a[3],a[0],f,c[g++]);k(a[3],a[2],f,c[g++]);k(a[1],a[2],f,c[g++])}this.isWebMercator&&(a=this._isPole(this.lij[1],this.lij[0]),2===a?(d.vec3d.set3(0,0,b.earthRadius,c[1]),
d.vec3d.set3(0,0,b.earthRadius,c[2]),d.vec3d.set3(0,0,b.earthRadius,c[5]),d.vec3d.set3(0,0,b.earthRadius,c[6])):1===a&&(d.vec3d.set3(0,0,-b.earthRadius,c[0]),d.vec3d.set3(0,0,-b.earthRadius,c[3]),d.vec3d.set3(0,0,-b.earthRadius,c[4]),d.vec3d.set3(0,0,-b.earthRadius,c[7])))};h.prototype._isPole=function(a,b){var c=0;a===(1<<b)-1&&(c+=1);0===a&&(c+=2);return c};h.NumSubdivisionsAtLevel=[128,64,32,16,16,8,8,4];h.Pool=new a(h);return h}(c)})},"esri/views/3d/terrain/SurfaceExtentHelper":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ../../../geometry/support/aaBoundingRect ../../../geometry/support/webMercatorUtils ./TerrainConst ./terrainUtils".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n){function l(a,b){a&&!a.spatialReference.equals(b)&&(a=f.canProject(a.spatialReference,b)?f.project(a,b):null);return a}Object.defineProperty(h,"__esModule",{value:!0});q=function(d){function f(a){a=d.call(this,a)||this;a._changeListeners=new b;return a}e(f,d);f.prototype.initialize=function(){var a=this;this._changeListeners.add([this.layerViews.on("change",function(){return a.notifyChange("stencilEnabledExtents")})])};f.prototype.destroy=function(){this._changeListeners.destroy();
this._changeListeners=null};Object.defineProperty(f.prototype,"layerViewsExtent",{get:function(){return this._computeLayerViewsExtent()},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"tiledLayersExtent",{get:function(){return this._computeTiledLayersExtent()},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"stencilEnabledExtents",{get:function(){return this._computeStencilEnabledExtents(this.layerViews,this.spatialReference)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,
"spatialReference",{set:function(a){this.tilingScheme||this._set("spatialReference",a)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"tilingScheme",{set:function(a){this._set("tilingScheme",a);this._set("spatialReference",a.spatialReference)},enumerable:!0,configurable:!0});f.prototype._computeStencilEnabledExtents=function(a,b){var d=[],e=0;for(a=a.items;e<a.length;e++){var f=a[e].layer;"IntegratedMeshLayer"===f.operationalLayerType&&null!=b&&(f=l(f.fullExtent,b),null!=f&&d.push(c.fromExtent(f)))}return d};
a([g.property({readOnly:!0})],f.prototype,"layerViewsExtent",null);a([g.property({readOnly:!0,dependsOn:["spatialReference","tilingScheme"]})],f.prototype,"tiledLayersExtent",null);a([g.property({readOnly:!0,dependsOn:["spatialReference"]})],f.prototype,"stencilEnabledExtents",null);a([g.property()],f.prototype,"spatialReference",null);a([g.property()],f.prototype,"tilingScheme",null);a([g.property()],f.prototype,"defaultTiledLayersExtent",void 0);a([g.property({constructOnly:!0})],f.prototype,"layers",
void 0);a([g.property({constructOnly:!0})],f.prototype,"layerViews",void 0);return f=a([g.subclass()],f)}(g.declared(d));d=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}e(c,b);c.prototype._computeLayerViewsExtent=function(){return this._getGlobalExtent()};c.prototype._computeTiledLayersExtent=function(){return this._getGlobalExtent()};c.prototype._getGlobalExtent=function(){return this.spatialReference.isWebMercator?k.WEBMERCATOR_WORLD_EXTENT:k.GEOGRAPHIC_WORLD_EXTENT};a([g.property({dependsOn:["spatialReference"]})],
c.prototype,"layerViewsExtent",void 0);return c=a([g.subclass()],c)}(g.declared(q));h.SurfaceExtentHelperGlobal=d;q=function(b){function d(){return null!==b&&b.apply(this,arguments)||this}e(d,b);d.prototype.initialize=function(){var a=this;this._changeListeners.add([this.layers.on("change",function(){return a.notifyChange("tiledLayersExtent")}),this.layerViews.on("change",function(){return a.notifyChange("layerViewsExtent")})])};d.prototype._computeLayerViewsExtent=function(){var a=c.empty(),b=this.spatialReference;
this.layerViews.forEach(function(d){d.isResolved()&&(d=d.fullExtentInLocalViewSpatialReference||d.layer.fullExtent,(d=l(d,b))&&c.expand(a,d))});var d=c.allFinite(a)?a:null,e=this._get("layerViewsExtent");return c.equals(d,e)?e:d};d.prototype._computeTiledLayersExtent=function(){var a=this.tilingScheme;if(!a)return null;var b=this.spatialReference,d=c.empty();this.layers.forEach(function(e){if(e.loaded&&n.isTiledLayer(e)){var f=n.getTiledLayerInfo(e,b,"local");e=f.tileInfo;f=f.fullExtent;e&&a.compatibleWith(e)&&
f&&f.spatialReference.equals(b)&&c.expand(d,f)}});this.defaultTiledLayersExtent&&c.expand(d,this.defaultTiledLayersExtent);var e=c.allFinite(d)?d:null,f=this._get("tiledLayersExtent");return c.equals(e,f)?f:e};return d=a([g.subclass()],d)}(g.declared(q));h.SurfaceExtentHelperLocal=q})},"esri/views/3d/terrain/SurfaceTilingSchemeLogic":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ./terrainUtils ./TilingScheme".split(" "),
function(q,h,e,a,d,b,g,c,f){return function(d){function h(a){a=d.call(this,a)||this;a._changeHandles=new b;return a}e(h,d);h.prototype.initialize=function(){var a=this;this._changeHandles.add(this.layers.on("change",function(){return a._update()}));this._changeHandles.add(this.extentHelper.watch("layerViewsExtent",function(){return a._setAdHocTilingScheme()}));this._update();this.tilingSchemeLocked||this._setAdHocTilingScheme()};h.prototype.destroy=function(){this._changeHandles.destroy();this._changeHandles=
null};h.prototype._update=function(){var a=this;this._waitTask=null;if(!this.tilingSchemeLocked){this._set("tilingSchemeDone",!1);var b=this.layers.find(function(b){return c.isTiledLayer(b)?b.isFulfilled()?b.isRejected()?!1:!!c.getTiledLayerInfo(b,a.viewSpatialReference,a.manifold).tileInfo:!0:!1});if(b)if(b.isResolved()){var d=c.getTiledLayerInfo(b,this.viewSpatialReference,this.manifold).tileInfo,d=new f(d),b=c.getKnownTiledServiceLevelCap(b.url);Infinity>b&&d.capMaxLod(b);this._set("tilingSchemeDone",
!0);this._lockTilingScheme(d)}else this._updateWhen(b);else this._set("tilingSchemeDone",!0)}};h.prototype._updateWhen=function(a){var b=this,c=a.when().always(function(){c===b._waitTask&&b._update()});this._waitTask=c};h.prototype._lockTilingScheme=function(a){var b=this;if("spherical"===this.manifold){var c=a.levels.length-1;a=a.spatialReference.isWebMercator?f.makeWebMercatorAuxiliarySphere(c):f.makeWGS84WithTileSize(a.pixelSize[0],c)}this.tilingSchemeLocked=!0;this.tilingScheme=a;this.extentHelper.tilingScheme=
this.tilingScheme;this._updateTiledLayerExtent();this._changeHandles.removeAll();this._changeHandles.add(this.extentHelper.watch("tiledLayersExtent",function(){return b._updateTiledLayerExtent()}))};h.prototype._updateTiledLayerExtent=function(){this.extent=this.extentHelper.tiledLayersExtent};h.prototype._setAdHocTilingScheme=function(){if("spherical"===this.manifold)this.tilingScheme=this.extentHelper.spatialReference.isWebMercator?f.WebMercatorAuxiliarySphere:f.makeWGS84WithTileSize(256),this.extent=
this.extentHelper.layerViewsExtent;else{var a=this.extentHelper.layerViewsExtent;a&&(this.tilingScheme=f.fromExtent(a,this.extentHelper.spatialReference),this.extent=a)}};a([g.property()],h.prototype,"tilingScheme",void 0);a([g.property()],h.prototype,"extent",void 0);a([g.property({value:!1})],h.prototype,"tilingSchemeLocked",void 0);a([g.property({readOnly:!0,value:!1})],h.prototype,"tilingSchemeDone",void 0);a([g.property({constructOnly:!0})],h.prototype,"viewSpatialReference",void 0);a([g.property({constructOnly:!0})],
h.prototype,"layers",void 0);a([g.property({constructOnly:!0})],h.prototype,"extentHelper",void 0);a([g.property({constructOnly:!0})],h.prototype,"manifold",void 0);return h=a([g.subclass()],h)}(g.declared(d))})},"esri/views/3d/terrain/TerrainRenderer":function(){define("require exports ../../../core/tsSupport/extendsHelper dojo/text!./TerrainMaterial.xml ../../../Color ../../../core/ObjectPool ../../../core/PooledArray ../../../core/promiseUtils ../../../geometry/support/aaBoundingBox ../lib/glMatrix ../support/imageUtils ./ResourceCounter ./TerrainConst ./TileGeometryFactory ./TileRenderData ./TileRenderer ./tileUtils ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/screenSizePerspectiveUtils ../webgl-engine/lib/ShaderVariations ../webgl-engine/lib/tracer ../webgl-engine/lib/Util ../webgl-engine/materials/internal/MaterialUtil ../../webgl/BufferObject ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u,x,v,A,y,C,B,D,E,J,F,M,H,I){function K(a){return function(b,c){b=b.screenDepth;c=c.screenDepth;return b<c?-a:b>c?a:0}}function O(a){var b=K(a);return function(c,d){return 0===c.tiles.length?-a:0===d.tiles.length?a:b(c.tiles.data[0],d.tiles.data[0])}}var P=J.assert,L=k.mat4d.identity(),U=C.OPAQUE_TERRAIN,N=C.TRANSPARENT_TERRAIN,S=k.vec3d.create(),aa=k.vec2d.create(),V=f.create(),T=k.vec4d.create(),Q=k.vec4d.create(),G=k.vec4d.create(),X=function(){return function(){this.extent=
k.vec4d.create();this.maxLevel=this.minLevel=0;this.callback=null}}();q=function(){function e(a,c){this.initialized=!1;this.rctx=null;this.renderDataPool=new b(r.TileRenderData);this.perOriginTileData=new g({initialSize:10,allocator:function(){return{root:null,origin:null,tiles:new g({initialSize:300})}}});this.perOriginTileDataDirty=!0;this.tileIterator=new u.IteratorPreorder;this.highestVisibleLODTile=null;this.visible=!0;this.debugScreenSizePerspective=!1;this.wireframe=F.copyParameters(Z);this._opaque=
!0;this._skirtScale=1;this._cullBackFaces=this._disableRendering=this._drawBorders=!1;this._renderOrder=1;this._velvetOverground=!0;this._hasOverlays=!1;this.castShadows=!0;this.receiveShadows=!1;this.backgroundPromise=this.tileRenderer=this.emptyTex=null;this.tileBackgroundInitialized=!1;this.stencilEnabledLayerExtents=[];this.numOriginsRendered=this.numTilesCulled=this.numTilesRendered=this.numTrianglesRendered=0;this.resourceCounter=new l;this.loaded=this.clippingExtent=null;this._loaded=!1;this.needsRender=
!0;this.needsHighlight=this.didRender=!1;this.visibleScaleRangeQueries=new g({initialSize:10});this.visibleScaleRangeQueriesInvPtr=0;this.visibleScaleRangeQueryQueue=new g({initialSize:30});this.visibleScaleRangeQueryPool=new b(X,!1);this.manifold=a;this.tileSize=c||256}e.prototype.destroy=function(a){this.uninstall(a);this.backgroundPromise&&(this.backgroundPromise.cancel(),this.backgroundPromise=null)};e.prototype.install=function(a){a.addExternalRenderer([U,N],this);this.drapedRenderer=a.getDrapedTextureRenderer()};
e.prototype.uninstall=function(a){a.removeExternalRenderer(this)};Object.defineProperty(e.prototype,"disableRendering",{set:function(a){this._disableRendering=!!a;this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"opaque",{set:function(a){this._opaque=a;this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"skirtScale",{set:function(a){this._skirtScale=a;this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,
"drawBorders",{set:function(a){this._drawBorders!==a&&(this._drawBorders=a,this._updatePrograms())},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"cullBackFaces",{set:function(a){this._cullBackFaces=a;this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"renderOrder",{set:function(a){this._renderOrder=a;this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"velvetOverground",{set:function(a){this._velvetOverground!==
a&&(this._velvetOverground=a,this._updatePrograms())},enumerable:!0,configurable:!0});e.prototype.setRootTiles=function(a){this.rootTiles=a;this.setNeedsRender()};e.prototype.setNeedsHighlight=function(a){this.needsHighlight=a;this.setNeedsRender()};e.prototype.setStencilEnabledLayerExtents=function(a){this.stencilEnabledLayerExtents=a;this.setNeedsRender()};e.prototype.setTileSize=function(a){this.tileSize=a;this.tileRenderer&&(this.tileRenderer.tileSize=a);this.setNeedsRender()};e.prototype.loadTile=
function(a){P(null===a.renderData);a.renderData=this.renderDataPool.acquire();a.renderData.init();var b=this.getLocalOriginOfTile(a);a.createGeometry(a.renderData.updateGeometryState(a),b,"debug"===this.wireframe.mode);a.renderData.localOrigin=b;this._updateTileGeometryBuffers(a);this.tileBackgroundInitialized&&this.tileRenderer.updateTileTexture(a)};e.prototype.queryVisibleLevelRange=function(a,b,c,d){var e=this.visibleScaleRangeQueryPool.acquire();k.vec4d.set(a,e.extent);e.minLevel=b?b:-Number.MAX_VALUE;
e.maxLevel=null!=c?c:Number.MAX_VALUE;e.callback=d;this.visibleScaleRangeQueryQueue.push(e);this.setNeedsRender()};e.prototype.updateTileTexture=function(a){this.tileRenderer&&this.tileBackgroundInitialized&&this.tileRenderer.updateTileTexture(a)};e.prototype.updateTileGeometryNeedsUpdate=function(a){return a.renderData.updateGeometryState(a).needsUpdate};e.prototype._updateTileGeometry=function(a){for(var b=a.renderData.geometryState,c=a.layerInfo[p.LayerClass.ELEVATION],d=0;d<c.length;d++)c[d].pendingUpdates&=
~p.TileUpdateTypes.UPDATE_GEOMETRY;return b.needsUpdate?(a.renderData.vao&&this._releaseTileGeometry(a),a.createGeometry(b,a.renderData.localOrigin,"debug"===this.wireframe.mode),this._updateTileGeometryBuffers(a),!0):!1};e.prototype.updateTileGeometry=function(a){a.renderData.updateGeometryState(a);return this._updateTileGeometry(a)};e.prototype.unloadTile=function(a){this._releaseTileGeometry(a);a.renderData.texture&&a.renderData.texture.dispose();this.renderDataPool.release(a.renderData);a.renderData=
null;a.updateMemoryUsed()};e.prototype.getLocalOriginOfTile=function(a){if(10<=a.lij[0]){for(;7<a.lij[0];)a=a.parent;return a.centerAtSeaLevel}if("spherical"===this.manifold)return S;for(;a.parent;)a=a.parent;return a.centerAtSeaLevel};e.prototype.setVisibility=function(a){this.visible=a;this.setNeedsRender()};e.prototype.getStats=function(){return{numTilesRendered:this.numTilesRendered,numTilesCulled:this.numTilesCulled,numTrianglesRendered:this.numTrianglesRendered,numOriginsRendered:this.numOriginsRendered}};
e.prototype.getWireframeEnabled=function(){return"shader"===this.wireframe.mode};e.prototype.setDebugScreenSizePerspective=function(a){a!==this.debugScreenSizePerspective&&(this.debugScreenSizePerspective=a,this._updatePrograms())};e.prototype.setWireframe=function(a){var b=this;if(!1===a||!0===a)a={mode:a?"shader":"none"};var c=this.wireframe;if(void 0!==a.mode&&c.mode!==a.mode){var d="debug"===c.mode,e="debug"===a.mode;c.mode=a.mode;this._updatePrograms();d!==e&&this.rootTiles&&u.traverseTilesPreorder(this.rootTiles,
function(a){a.renderData&&(a.renderData.vao&&b._releaseTileGeometry(a),a.createGeometry(a.renderData.updateGeometryState(a),a.renderData.localOrigin,e),b._updateTileGeometryBuffers(a))})}for(var f in a)c.hasOwnProperty(f)&&(c[f]=a[f]),this.setNeedsRender();c.resolution&&(c.resolution=Math.min(c.resolution,this.tileSize),c.resolution=1<<Math.round(Math.log(c.resolution)/Math.LN2))};e.prototype.setNeedsRender=function(){this.needsRender=!0;this.didRender=!1;this.perOriginTileDataDirty=!0};e.prototype.resetNeedsRender=
function(){this.didRender&&(this.needsRender=0!==this.visibleScaleRangeQueryQueue.length,this.didRender=!1)};e.prototype.isOpaque=function(){var a=this.wireframe,a="shader"===a.mode&&(1>a.wireOpacity||1>a.surfaceOpacity);return this._opaque&&!a};e.prototype.updateTileBackground=function(a){this.backgroundPromise&&this.backgroundPromise.cancel();this.backgroundPromise="string"===typeof a?n.requestImage(a).catch(function(){return null}):null!=a?c.resolve(d.toUnitRGBA(a)):c.resolve(null);this._renderTileBackground()};
e.prototype.initializeRenderContext=function(b){var d=this,e=this.rctx=b.rctx,f=function(a){c.when(a).then(function(){d.initialized=!0;d.setNeedsRender()}).catch(f)};f(this._renderTileBackground());var g=b.shaderSnippets;b=b.programRep;g.vsTerrain||g._parse(a);var h=new D("terrain",["vsTerrain","fsTerrain"],null,b,g,e);h.addDefine("Spherical","SPHERICAL");h.addDefine("Overlay","OVERLAY");h.addDefine("Atmosphere","ATMOSPHERE");h.addDefine("Wireframe","WIREFRAME");h.addDefine("TileBorders","TILE_BORDERS");
h.addBinaryShaderSnippetSuffix("Wireframe","Wireframe",[!1,!0]);h.addDefine("ReceiveShadows","RECEIVE_SHADOWS");h.addDefine("ScreenSizePerspective","SCREEN_SIZE_PERSPECTIVE");var k=new D("terrainNormal",["vsTerrainNormal","fsNormal"],null,b,g,e);k.addDefine("Spherical","SPHERICAL");k.addDefine("AlphaZero","ALPHA_ZERO");var l=new D("terrainDepth",["vsTerrainDepth","fsDepth"],null,b,g,e);l.addDefine("Spherical","SPHERICAL");l.addDefine("ShadowMap","BIAS_SHADOWMAP");g=new D("terrainHighlight",["vsTerrainHighlight",
"fsTerrainHighlight"],null,b,g,e);g.addDefine("Spherical","SPHERICAL");this.programs={color:null,normal:null,depth:null,depthShadowMap:null,highlight:null};this.programVariations={color:h,normal:k,depth:l,highlight:g};this._updatePrograms();this.tileRenderer=new t(e,this.tileSize,b,this.resourceCounter,this.setNeedsRender.bind(this));this._renderTileBackground();this.emptyTex=A.createEmptyTexture(e)};e.prototype.uninitializeRenderContext=function(a){null!=this.emptyTex&&(this.emptyTex.dispose(),this.emptyTex=
null);this.tileRenderer&&(this.tileRenderer.dispose(),this.tileRenderer=null)};e.prototype.render=function(a){var b=a.rctx,c=b.gl;if(!this.initialized||this._disableRendering||!this.visible||!this.rootTiles||!this.tileBackgroundInitialized)return!1;var d=this.isOpaque()?U:N;if(a.slot!==d)return!1;E.trace("# BEGIN RENDER TERRAIN");d=a.pass;b.setFaceCullingEnabled(this._cullBackFaces);var e=1===a.lightingData.helper.globalFactor;d===y.MATERIAL?this._renderMaterialPass(a,this._updatePerOriginTileData()):
d===y.MATERIAL_DEPTH_SHADOWMAP&&this.castShadows&&e?this._renderDepthPass(a,this.programs.depthShadowMap,this._updatePerOriginTileData()):d===y.MATERIAL_DEPTH?this._renderDepthPass(a,this.programs.depth,this._updatePerOriginTileData()):d===y.MATERIAL_NORMAL?this._renderNormalPass(a,this._updatePerOriginTileData()):d===y.MATERIAL_HIGHLIGHT&&this.needsHighlight&&(this._renderHighlightPass(a,this._updatePerOriginTileData()),b.clear(c.DEPTH_BUFFER_BIT));this._cullBackFaces&&b.setFaceCullingEnabled(!1);
E.trace("# END RENDER TERRAIN");return!0};e.prototype.intersect=function(a,b,c,d){if(this.rootTiles){var e=this.clippingExtent;if((!a.isSelection||this.isOpaque())&&a.enableTerrain){var g=fa,h=R;k.vec3d.subtract(c,b,g);k.vec3d.set3(1/g[0],1/g[1],1/g[2],h);var l=a.getMinResult(),m=a.getMaxResult(),n=this.tileIterator;n.reset(this.rootTiles);d=function(){var d=n.next();if(null===d.renderData)return"continue";if(a.enableInvisibleTerrain){if(!d.visible&&e&&!d.intersectsExtent(e))return"continue"}else if(!d.visible)return"continue";
var r=d.renderData,t=r.geometryInfo,v=r.localOrigin,q=da,x=ba;k.vec3d.subtract(b,v,q);k.vec3d.subtract(c,v,x);var A=-p._skirtScale*r.geometryInfo.skirtLength;0!==A&&(r=d.tileUp,f.offset(t.boundingBox,A*r[0],A*r[1],A*r[2],V),f.expandWithBuffer(V,t.boundingBox,0,2));if(!F.intersectAabbInvDir(0!==A?V:t.boundingBox,q,h,a.tolerance))return"continue";var r=function(b,c,e){if(0<=b&&(a.enableBackfacesTerrain||0>k.vec3d.dot(c,g))){e=void 0;if(void 0===l.dist||b<l.dist)e=u.lij2str(d.lij[0],d.lij[1],d.lij[2]),
l.set(void 0,e,b,c,void 0),l.setIntersector("TerrainRenderer");if(void 0===m.dist||b>m.dist)e=u.lij2str(d.lij[0],d.lij[1],d.lij[2]),m.set(void 0,e,b,c,void 0),m.setIntersector("TerrainRenderer")}},v=t.indices,y={data:t.vertexAttributes,size:3,offsetIdx:0,strideIdx:5},t=t.numWithoutSkirtIndices/3;F.intersectTriangles(q,x,0,t,v,y,null,r);0!==A&&u.intersectSkirts(q,x,t,v.length/3,v,y,null,"spherical"===p.manifold?function(a){return k.vec3d.scale(a,A/k.vec3d.length(a))}:function(a){return k.vec3d.set3(0,
0,A,a)},r)};for(var p=this;!n.done;)d()}}};e.prototype._renderTileBackground=function(){var a=this;if(this.rctx&&this.backgroundPromise&&this.tileRenderer)return this.backgroundPromise.then(function(b){a.tileRenderer&&(a.tileBackgroundInitialized=!0,a.tileRenderer.setBackground(b),a.rootTiles&&u.traverseTilesPreorder(a.rootTiles,function(b){a.tileRenderer.updateTileTexture(b)}))})};e.prototype._updatePrograms=function(){var a="spherical"===this.manifold,b="shader"===this.wireframe.mode;this.programs.color=
this.programVariations.color.getProgram([a,this._hasOverlays,a&&this._velvetOverground,b,this._drawBorders,b||this._drawBorders,this.receiveShadows,this.debugScreenSizePerspective]);this.programs.normal=this.programVariations.normal.getProgram([a,!0]);this.programs.depth=this.programVariations.depth.getProgram([a,!1]);this.programs.depthShadowMap=this.programVariations.depth.getProgram([a,!0]);this.programs.highlight=this.programVariations.highlight.getProgram([a]);this.setNeedsRender()};e.prototype._renderMaterialPass=
function(a,b){var c=this,d=a.shadowMap&&a.shadowMap.enabled,e=a.rctx;this.receiveShadows!==d&&(this.receiveShadows=d,this._updatePrograms());d=!this.drapedRenderer.isEmpty();d!==this._hasOverlays&&(this._hasOverlays=d,this._updatePrograms());d=a.camera;e.setDepthTestEnabled(!0);var f=this.wireframe,g=this.programs.color;e.bindProgram(g);if("shader"===f.mode||this._drawBorders)g.setUniform1f("wireframe.width",this.wireframe.width),g.setUniform1f("wireframe.falloff",Math.min(f.width,f.falloff)),g.setUniform1f("wireframe.wireOpacity",
f.wireOpacity),g.setUniform1f("wireframe.surfaceOpacity",f.surfaceOpacity),g.setUniform4fv("wireframe.color",f.color);a.shadowMap&&a.shadowMap.bind(g);a.ssaoHelper&&a.ssaoHelper.setUniforms(g);g.setUniform1i("tex",0);g.setUniform1i("overlay0Tex",1);g.setUniform1i("overlay1Tex",2);g.setUniformMatrix4fv("viewNormal",d.viewInverseTransposeMatrix);g.setUniformMatrix4fv("proj",d.projectionMatrix);a.lightingData.helper.setUniforms(g,!0);e=d.viewMatrix;k.vec3d.set3(e[12],e[13],e[14],ea);k.vec3d.normalize(ea);
g.setUniform3fv("viewDirection",ea);this.numOriginsRendered=this.numTrianglesRendered=this.numTilesCulled=this.numTilesRendered=0;this._prepareScaleRangeQueries();this.isOpaque()?this._renderTiles(a,g,b):a.offscreenRenderingHelper.renderToTargets(function(){return c._renderTiles(a,g,b)},a.offscreenRenderingHelper.tmpColor,a.offscreenRenderingHelper.mainDepth,[0,0,0,0]);this._processScaleRangeQueries();0<this.numTilesRendered&&!this._loaded&&(this._loaded=!0,this.loaded&&this.loaded())};e.prototype._renderDepthPass=
function(a,b,c){var d=a.rctx,e=a.camera;d.bindProgram(b);d.setBlendingEnabled(!1);d.setDepthTestEnabled(!0);b.setUniformMatrix4fv("model",L);b.setUniformMatrix4fv("viewNormal",e.viewInverseTransposeMatrix);aa[0]=e.near;aa[1]=e.far;b.setUniform2fv("nearFar",aa);this._renderTilesAuxiliary(a,b,c,!1)};e.prototype._renderNormalPass=function(a,b){var c=a.rctx,d=a.camera,e=this.programs.normal;c.bindProgram(e);c.setBlendingEnabled(!1);c.setDepthTestEnabled(!0);e.setUniformMatrix4fv("viewNormal",d.viewInverseTransposeMatrix);
this._renderTilesAuxiliary(a,e,b,!1)};e.prototype._renderHighlightPass=function(a,b){var c=a.rctx,d=this.programs.highlight;c.bindProgram(d);c.setBlendingEnabled(!1);c.setDepthTestEnabled(!0);var e=a.offscreenRenderingHelper;c.bindTexture(e.depthTexture,3);d.setUniform1i("depthTex",3);d.setUniform4f("highlightViewportPixelSz",0,0,1/e.width,1/e.height);this._renderTilesAuxiliary(a,d,b,!0)};e.prototype._updatePerOriginTileData=function(){var a=this.perOriginTileData;if(!this.perOriginTileDataDirty)return a;
this.highestVisibleLODTile=null;this._renderCollectOrigins();if(0!==this._renderOrder){for(var b=K(this._renderOrder),c=0;c<a.length;c++)this._sortFrontToBack(a.data[c].tiles,b);b=O(this._renderOrder);this._sortFrontToBack(a,b)}this.perOriginTileDataDirty=!1;return a};e.prototype._renderCollectOrigins=function(){var a=this.perOriginTileData,b=this.rootTiles,c="spherical"===this.manifold;a.clear();for(var d=0;d<b.length;d++){var e=b[d],f=a.pushNew();f.root=e;f.origin=c?S:e.centerAtSeaLevel;f.tiles.clear();
this._renderCollectOriginsForRoot(f)}return!0};e.prototype._renderCollectOriginsForRoot=function(a){var b=this.tileIterator,c=this.perOriginTileData;for(b.reset(a.root);!b.done;){var d=b.next(),e=d.renderData;if(e&&!d.visible)this.numTilesCulled++,b.skip();else{var f=c.back();if(7===d.lij[0]){if(f===a||0!==f.tiles.length)f=c.pushNew(),f.tiles.clear();f.root=d;f.origin=d.centerAtSeaLevel}if(e){10<=d.lij[0]?c.back().tiles.push(d):a.tiles.push(d);if(!this.highestVisibleLODTile||d.vlevel>this.highestVisibleLODTile.vlevel)this.highestVisibleLODTile=
d;b.skip()}}}};e.prototype._sortFrontToBack=function(a,b){a.sort(b)};e.prototype._scaleQueriesForTile=function(a){var b=a.extent;a=a.lij[0];for(var c=0;c<this.visibleScaleRangeQueriesInvPtr;){var d=this.visibleScaleRangeQueries.data[c],e=d.extent;a>=d.minLevel&&a<=d.maxLevel&&e[0]<=b[2]&&e[2]>=b[0]&&e[1]<=b[3]&&e[3]>=b[1]?(this.visibleScaleRangeQueries.swapElements(c,this.visibleScaleRangeQueriesInvPtr-1),this.visibleScaleRangeQueriesInvPtr--):c++}};e.prototype._updateStencilReadStateForTile=function(a,
b){if(a.stencilRenderingHelper&&a.stencilRenderingHelper.enabled){for(var c=this.stencilEnabledLayerExtents,d=!1,e=0;e<c.length;e++)if(b.intersectsExtent(c[e])){d=!0;break}d?a.stencilRenderingHelper.enableStencilRead():a.stencilRenderingHelper.disableStencilRead()}};e.prototype._renderTilesAuxiliary=function(a,b,c,d){var e=a.rctx,f=e.gl,g=a.camera,h=g.viewMatrix;b.setUniformMatrix4fv("proj",g.projectionMatrix);b.setUniform1f("skirtScale",this._skirtScale);d&&(b.setUniform1i("overlay0Tex",1),b.setUniform1i("overlay1Tex",
2));for(g=0;g<c.length;g++){var k=c.data[g];b.setUniform3fv("origin",k.origin);F.bindView(k.origin,h,b);for(var l=0;l<k.tiles.length;l++){var m=k.tiles.data[l],n=m.renderData;d&&(this._bindOverlayTextures(b,n.overlays,!0),b.setUniform1f("overlayOpacity",n.overlayOpacity));this._updateStencilReadStateForTile(a,m);e.bindVAO(n.vao);H.assertCompatibleVertexAttributeLocations(n.vao,b);e.drawElements(f.TRIANGLES,0!==this._skirtScale?n.vao.indexBuffer.size:n.geometryInfo.numWithoutSkirtIndices,n.vao.indexBuffer.indexType,
0)}}e.bindVAO(null);a.stencilRenderingHelper&&a.stencilRenderingHelper.disableStencilRead()};e.prototype._renderTiles=function(a,b,c){var d=a.rctx,e=d.gl,f=a.camera,g=f.viewMatrix;if(this.debugScreenSizePerspective&&this.pointsOfInterest){var h=B.getSettings("spherical"===this.manifold?"global":"local");h.update({distance:this.pointsOfInterest.centerOnSurfaceFrequent.distance,fovY:f.fovY});F.bindScreenSizePerspective(h,b,"screenSizePerspective")}b.setUniform1f("skirtScale",this._skirtScale);for(f=
0;f<c.length;f++)if(h=c.data[f],b.setUniform3fv("origin",h.origin),F.bindView(h.origin,g,b),a.shadowMap&&a.shadowMap.bindView(b,h.origin),this.numOriginsRendered++,h=h.tiles,0!==h.length){var l="debug"===this.wireframe.mode?e.LINES:e.TRIANGLES,m=this.highestVisibleLODTile,n=void 0,p=void 0;m?(n=m.vlevel,p=this.tileSize/this.wireframe.resolution):(n=16,p=this.tileSize/64);for(m=0;m<h.length;m++){var r=h.data[m],u=r.renderData;this._updateStencilReadStateForTile(a,r);E.trace("# RENDER TILE "+r.lij[0]+
"/"+r.lij[1]+"/"+r.lij[2]+", screenDepth:"+r.screenDepth);var t=u.geometryInfo.uvOffsetAndScale,v=u.texOffsetAndScale;k.vec4d.set4(t[0]*v[2]+v[0],t[1]*v[3]+v[1],t[2]*v[2],t[3]*v[3],G);b.setUniform4fv("texOffsetAndScale",G);d.bindTexture(u.textureReference||u.texture,0);b.setUniform1f("opacity",u.opacity);this._bindOverlayTextures(b,u.overlays,!1);b.setUniform1f("overlayOpacity",u.overlayOpacity);("shader"===this.wireframe.mode||this._drawBorders)&&b.setUniform1f("wireframe.subdivision",p*(1<<n-r.vlevel));
t=0!==this._skirtScale?u.vao.indexBuffer.size:u.geometryInfo.numWithoutSkirtIndices;d.bindVAO(u.vao);H.assertCompatibleVertexAttributeLocations(u.vao,b);d.drawElements(l,t,u.vao.indexBuffer.indexType,0);r.renderOrder=this.numTilesRendered;this.numTilesRendered++;this.numTrianglesRendered+=t/3;this._scaleQueriesForTile(r)}}d.bindVAO(null);a.stencilRenderingHelper&&a.stencilRenderingHelper.disableStencilRead()};e.prototype._bindOverlayTextures=function(a,b,c){for(var d=0;2>d;d++){var e=2*d,f=b[d],g=
c?f.highlightRenderTargetId:f.renderTargetId;g?(g=this.drapedRenderer.getRenderTargetTexture(g),T[e]=f.texOffset[0],T[e+1]=f.texOffset[1],Q[e]=f.texScale[0],Q[e+1]=f.texScale[1],this.rctx.bindTexture(g,1+d)):(T[e]=0,T[e+1]=0,Q[e]=0,Q[e+1]=0,this.rctx.bindTexture(this.emptyTex,1+d))}a.setUniform4fv("overlayTexOffset",T);a.setUniform4fv("overlayTexScale",Q)};e.prototype._updateTileGeometryBuffers=function(a){var b=this.rctx,c=b.gl;a=a.renderData;var d=a.geometryInfo.indices;a.vao=new I(b,x.Default3D,
{geometry:v.Pos3Tex},{geometry:M.createVertex(b,c.STATIC_DRAW,a.geometryInfo.vertexAttributes)},M.createIndex(b,c.STATIC_DRAW,d));this.setNeedsRender()};e.prototype._releaseTileGeometry=function(a){a=a.renderData;a.vao.dispose(!0);a.vao=null;m.releaseGeometry(a.geometryInfo);this.setNeedsRender()};e.prototype._prepareScaleRangeQueries=function(){for(var a=this.visibleScaleRangeQueries,b=this.visibleScaleRangeQueryQueue;a.length<a.data.length&&0<b.length;){var c=b.pop();a.push(c)}this.visibleScaleRangeQueriesInvPtr=
a.length};e.prototype._processScaleRangeQueries=function(){for(var a=this.visibleScaleRangeQueries,b=this.visibleScaleRangeQueryPool,c=0;c<a.length;c++){var d=a.data[c];b.release(d);d.callback(c>=this.visibleScaleRangeQueriesInvPtr);d.callback=null}a.clear()};return e}();var Z={mode:"none",width:1.5,falloff:1.5,wireOpacity:1,surfaceOpacity:0,color:[1,1,1,0],resolution:64},ea=k.vec3d.create(),fa=k.vec3d.create(),R=k.vec3d.create(),da=k.vec3d.create(),ba=k.vec3d.create();return q})},"esri/views/3d/terrain/ResourceCounter":function(){define(["require",
"exports"],function(q,h){return function(){function e(){this._numTileTexturesComposited=0}Object.defineProperty(e.prototype,"numTileTexturesComposited",{get:function(){return this._numTileTexturesComposited},enumerable:!0,configurable:!0});e.prototype.incrementNumTileTexturesComposited=function(){this._numTileTexturesComposited++};e.prototype.resetNumTileTexturesComposited=function(){this._numTileTexturesComposited=0};return e}()})},"esri/views/3d/terrain/TileRenderData":function(){define(["require",
"exports","../../../geometry/support/aaBoundingBox","../lib/glMatrix"],function(q,h,e,a){Object.defineProperty(h,"__esModule",{value:!0});q=function(){function d(){this.overlayTexOffset=a.vec2d.create();this.texOffsetAndScale=a.vec4d.create();this.geometryInfo={indices:null,vertexAttributes:null,boundingBox:e.empty(),numSurfaceIndices:0,numSkirtIndices:0,numWithoutSkirtIndices:0,numVertsPerRow:0,skirtLength:0,uvOffsetAndScale:a.vec4d.create()};this.init()}d.prototype.init=function(){var b=this.geometryInfo;
b.indices=null;b.vertexAttributes=null;e.empty(b.boundingBox);b.numSurfaceIndices=0;b.numSkirtIndices=0;b.numWithoutSkirtIndices=0;b.numVertsPerRow=0;this.textureReference=this.texture=this.vao=this.geometryState=null;a.vec4d.set4(0,0,1,1,this.texOffsetAndScale);this.opacity=1;if(this.overlays)for(var b=0,d=this.overlays;b<d.length;b++){var c=d[b];c.renderTargetId=null;c.highlightRenderTargetId=null;a.vec2d.set2(1,1,c.texScale);a.vec2d.set2(0,0,c.texOffset)}else for(this.overlays=[null,null],b=0;2>
b;b++)this.overlays[b]={renderTargetId:null,highlightRenderTargetId:null,texScale:[1,1],texOffset:[0,0]};this.overlayOpacity=1;this.localOrigin=null};d.prototype.updateGeometryState=function(a){return this.geometryState=a.geometryState(this.geometryState)};d.prototype.estimateGeometryMemoryUsage=function(){var a=this.geometryInfo;return a.indices.byteLength+a.vertexAttributes.byteLength};return d}();h.TileRenderData=q})},"esri/views/3d/terrain/TileRenderer":function(){define("require exports ../lib/glMatrix ./TerrainConst ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../vectorTiles/tileRendererHelper3D ../../vectorTiles/VectorTileDisplayObject ../../webgl/BufferObject ../../webgl/FramebufferObject ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m){function r(a){return a instanceof HTMLImageElement||a instanceof HTMLCanvasElement}var t=Array(20),u=[0,0];return function(){function h(a,c,e,f,h){this._blackTex=this._backgroundTex=null;this.tileSize=256;this._context=a;this.tileSize=c;this._resourceCounter=f;this._setNeedsRender=h;a.capabilities.textureFilterAnisotropic&&(this._maxAnisotropy=Math.min(8,a.parameters.maxMaxAnisotropy));c=new Float32Array(20);c[0]=-1;c[1]=-1;c[2]=0;c[3]=0;c[4]=0;c[5]=1;c[6]=-1;
c[7]=0;c[8]=1;c[9]=0;c[10]=-1;c[11]=1;c[12]=0;c[13]=0;c[14]=1;c[15]=1;c[16]=1;c[17]=0;c[18]=1;c[19]=1;this._vaoQuad=new m(a,d.Default3D,{geometry:b.Pos3Tex},{geometry:k.createVertex(a,35044,c)});this._blendLayersProgram=e.get("blendLayers");this._blackTex=g.createColorTexture(this._context,[0,0,0,1])}h.prototype.dispose=function(){this._fbo&&(this._fbo.dispose(),this._fbo=null);this._vaoQuad&&(this._vaoQuad.dispose(),this._vaoQuad=null);this._backgroundTex&&(this._backgroundTex.dispose(),this._backgroundTex=
null);this._blackTex&&(this._blackTex.dispose(),this._blackTex=null);this._blendLayersProgram&&(this._blendLayersProgram.dispose(),this._blendLayersProgram=null);this._context&&(this._context=null)};h.prototype.updateTileTexture=function(b){for(var c=a.LayerClass.MAP,d=b.layerInfo[c],f=0;f<d.length;f++)d[f].pendingUpdates&=~a.TileUpdateTypes.UPDATE_TEXTURE;if(b.renderData){for(var f=b.renderData,g=b.parentSurface,h=g.baseOpacity,k=0,m=!1,n=d.length-1,p=d.length,u=0;u<d.length;u++){var v=d[u],q=g.layerViewByIndex(u,
c),x=q.fullOpacity;t[u]=x;this._isBaseLayer(q.layer)&&p>=d.length&&(p=u);if(v.data||v.upsampleFromTile)if(k++,q.isOpaque&&1===x){m=!0;n=u;break}}var P,g=h;0===k&&this._backgroundTex?(f.textureReference=this._backgroundTex,e.vec4d.set4(0,0,1,1,f.texOffsetAndScale)):1===k&&m?(v=d[n],v.data?(c=v,e.vec4d.set4(0,0,1,1,f.texOffsetAndScale)):(P=v.upsampleFromTile,c=P.tile.layerInfo[c][n],e.vec4d.set4(P.offset[0],P.offset[1],P.scale,P.scale,f.texOffsetAndScale)),c&&(r(c.data)&&(c.data=this._buildTexture(c.data),
P?P.tile.updateMemoryUsed():b.updateMemoryUsed()),c.data instanceof l&&(f.textureReference=c.data))):(g=this._composeMapLayers(b,d,n,p,m,t),f.textureReference=null,e.vec4d.set4(0,0,1,1,f.texOffsetAndScale));f.opacity=g;this._setNeedsRender()}};h.prototype.setBackground=function(a){r(a)?this._backgroundTex=this._buildTexture(a):this._backgroundTex=g.createColorTexture(this._context,a||[0,0,0,0])};h.prototype._buildTexture=function(a){var b={target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,
samplingMode:9729,maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0},c=this._context,d;if(a)try{d=new l(c,b,a)}catch(B){d=g.createEmptyTexture(c),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}else b.width=b.height=this.tileSize,d=new l(c,b);c.bindTexture(d);d.generateMipmap();return d};h.prototype._drawRasterData=function(a,b,c,d){void 0===d&&(d=1);var e=this._context,f=this._blendLayersProgram,g=this._vaoQuad;e.bindProgram(f);e.bindVAO(g);
p.assertCompatibleVertexAttributeLocations(g,f);e.bindTexture(a,0);f.setUniform1i("tex",0);f.setUniform1f("scale",b);f.setUniform2f("offset",c[0],c[1]);f.setUniform1f("opacity",d);e.drawArrays(5,0,p.vertexCount(g,"geometry"))};h.prototype._composeMapLayers=function(b,d,e,g,h,k){var m=a.LayerClass.MAP,p=this._context;b.renderData.texture||(b.renderData.texture=this._buildTexture(),b.updateMemoryUsed());var t=b.renderData.texture,v=this._fbo;v&&v.width===t.descriptor.width&&v.height===t.descriptor.height||
(this._fbo=v=n.create(p,{colorTarget:0,depthStencilTarget:1,width:t.descriptor.width,height:t.descriptor.height}));var q=p.gl;p.bindFramebuffer(v);p.setViewport(0,0,this.tileSize,this.tileSize);p.setClearColor(0,0,0,0);p.setClearDepth(1);p.clear(q.COLOR_BUFFER_BIT|q.DEPTH_BUFFER_BIT);p.setDepthTestEnabled(!1);p.setBlendFunction(1,771);p.setBlendEquation(32774);p.setBlendingEnabled(!0);var x,A,y,B;!h&&this._backgroundTex&&this._drawRasterData(this._backgroundTex,1,u);h=b.parentSurface.baseOpacity;
for(v=!1;0<=e;e--){var C=null;x=d[e];x.data?(C=x,A=u,y=1):x.upsampleFromTile&&(y=x.upsampleFromTile,C=y.tile.layerInfo[m][e],B=y.tile.lij[0],A=[y.offset[0],y.offset[1]],y=y.scale);C&&(e<g&&1>h&&!v&&(p.setBlendFunction(0,770),this._drawRasterData(this._blackTex,1,u,h),p.setBlendFunction(1,771),v=!0),C.data instanceof f?(x=b.parentSurface.layerViewByIndex(e,m),c(this._context,b.lij,C.data,x.renderer,x.schemeHelper,b.lij[0],t.descriptor.width,t.descriptor.height,0,y,A,B,k[e])):(r(C.data)&&(C.data=this._buildTexture(C.data),
C===x?b.updateMemoryUsed():x.upsampleFromTile.tile.updateMemoryUsed()),C.data instanceof l&&this._drawRasterData(C.data,y,A,k[e])))}p.bindTexture(t);q.copyTexImage2D(p.gl.TEXTURE_2D,0,t.descriptor.pixelFormat,0,0,t.descriptor.width,t.descriptor.height,0);t.generateMipmap();p.bindFramebuffer(null);p.setBlendFunctionSeparate(770,771,1,771);p.setBlendingEnabled(!1);this._resourceCounter.incrementNumTileTexturesComposited();return v?1:h};h.prototype._isBaseLayer=function(a){return a.parent&&"esri.Basemap"===
a.parent.declaredClass&&-1<a.parent.baseLayers.indexOf(a)};return h}()})},"esri/views/vectorTiles/tileRendererHelper3D":function(){define(["require","exports","dojo/has","../../core/libs/gl-matrix/mat4","../../core/libs/gl-matrix/vec3"],function(q,h,e,a,d){var b={extent:{xmin:0,ymin:0,xmax:0,ymax:0,spatialReference:{wkid:102100,isWrappable:!0},intersects:function(a){return!1}},center:[0,0],scale:1,resolution:1,rotation:0,width:1,height:1,pixelRatio:1,size:[256,256],spatialReference:{wkid:102100,isWrappable:!0},
worldScreenWidth:1,viewpoint:{},toMap:function(a,b,d){return null},toScreen:function(a,b,d){return null},clone:function(){return null},copy:function(a){return this},toJSON:function(){return null}},g=d.create();return function(c,d,h,n,l,p,m,r,t,u,q,v,A){t=[d[0],d[1],d[2]];for(var f=u;1>f;f*=2)t[0]--,t[1]>>=1,t[2]>>=1;d={context:c,drawPhase:0,state:b,stationary:!0,pixelRatio:1,displayLevel:l.adjustLevel(p),requiredLevel:l.adjustLevel(d[0]),drawphase:0,renderer:n,layerOpacity:A,painter:null};if(m!==
r)throw Error("It is expected that tiles are square!");p=1/u;A=l.getSchemaShift(t,p);f=A[1];h.tileTransform.displayCoord[0]=-1-2*p*q[0]-A[0];h.tileTransform.displayCoord[1]=1+2*p*(1-q[1]-u)+f;u=h.tileTransform.transform;a.identity(u);l.isWGS84&&512===l.lockedSchemaPixelSize&&(p*=2);0===v&&(p/=2);l=.25*p/m;g.set([l,-l,1]);a.scale(u,u,g);c.setBlendFunctionSeparate(1,771,1,771);c.setClearDepth(1);c.clear(c.gl.DEPTH_BUFFER_BIT);d.state.size=[m,r];d.state.width=m;d.state.height=r;n.setStateParams(d.state,
d.pixelRatio,t[0]);h.attach(d);c.setFaceCullingEnabled(!1);c.setDepthFunction(515);c.setBlendingEnabled(!1);c.setDepthTestEnabled(!0);c.setDepthWriteEnabled(!0);h.processRender(d);c.setDepthWriteEnabled(!1);c.setBlendingEnabled(!0);d.drawphase=1;h.processRender(d);d.drawphase=2;h.processRender(d);e("esri-vector-tiles-debug")&&n.renderTileInfo(c,h);c.setDepthWriteEnabled(!0);c.setDepthTestEnabled(!1);c.setFaceCullingEnabled(!0)}})},"esri/core/libs/gl-matrix/vec3":function(){define(["./common"],function(q){var h=
{create:function(){var e=new q.ARRAY_TYPE(3);e[0]=0;e[1]=0;e[2]=0;return e},clone:function(e){var a=new q.ARRAY_TYPE(3);a[0]=e[0];a[1]=e[1];a[2]=e[2];return a},fromValues:function(e,a,d){var b=new q.ARRAY_TYPE(3);b[0]=e;b[1]=a;b[2]=d;return b},copy:function(e,a){e[0]=a[0];e[1]=a[1];e[2]=a[2];return e},set:function(e,a,d,b){e[0]=a;e[1]=d;e[2]=b;return e},add:function(e,a,d){e[0]=a[0]+d[0];e[1]=a[1]+d[1];e[2]=a[2]+d[2];return e},subtract:function(e,a,d){e[0]=a[0]-d[0];e[1]=a[1]-d[1];e[2]=a[2]-d[2];
return e}};h.sub=h.subtract;h.multiply=function(e,a,d){e[0]=a[0]*d[0];e[1]=a[1]*d[1];e[2]=a[2]*d[2];return e};h.mul=h.multiply;h.divide=function(e,a,d){e[0]=a[0]/d[0];e[1]=a[1]/d[1];e[2]=a[2]/d[2];return e};h.div=h.divide;h.ceil=function(e,a){e[0]=Math.ceil(a[0]);e[1]=Math.ceil(a[1]);e[2]=Math.ceil(a[2]);return e};h.floor=function(e,a){e[0]=Math.floor(a[0]);e[1]=Math.floor(a[1]);e[2]=Math.floor(a[2]);return e};h.min=function(e,a,d){e[0]=Math.min(a[0],d[0]);e[1]=Math.min(a[1],d[1]);e[2]=Math.min(a[2],
d[2]);return e};h.max=function(e,a,d){e[0]=Math.max(a[0],d[0]);e[1]=Math.max(a[1],d[1]);e[2]=Math.max(a[2],d[2]);return e};h.round=function(e,a){e[0]=Math.round(a[0]);e[1]=Math.round(a[1]);e[2]=Math.round(a[2]);return e};h.scale=function(e,a,d){e[0]=a[0]*d;e[1]=a[1]*d;e[2]=a[2]*d;return e};h.scaleAndAdd=function(e,a,d,b){e[0]=a[0]+d[0]*b;e[1]=a[1]+d[1]*b;e[2]=a[2]+d[2]*b;return e};h.distance=function(e,a){var d=a[0]-e[0],b=a[1]-e[1];e=a[2]-e[2];return Math.sqrt(d*d+b*b+e*e)};h.dist=h.distance;h.squaredDistance=
function(e,a){var d=a[0]-e[0],b=a[1]-e[1];e=a[2]-e[2];return d*d+b*b+e*e};h.sqrDist=h.squaredDistance;h.length=function(e){var a=e[0],d=e[1];e=e[2];return Math.sqrt(a*a+d*d+e*e)};h.len=h.length;h.squaredLength=function(e){var a=e[0],d=e[1];e=e[2];return a*a+d*d+e*e};h.sqrLen=h.squaredLength;h.negate=function(e,a){e[0]=-a[0];e[1]=-a[1];e[2]=-a[2];return e};h.inverse=function(e,a){e[0]=1/a[0];e[1]=1/a[1];e[2]=1/a[2];return e};h.normalize=function(e,a){var d=a[0],b=a[1],g=a[2],d=d*d+b*b+g*g;0<d&&(d=
1/Math.sqrt(d),e[0]=a[0]*d,e[1]=a[1]*d,e[2]=a[2]*d);return e};h.dot=function(e,a){return e[0]*a[0]+e[1]*a[1]+e[2]*a[2]};h.cross=function(e,a,d){var b=a[0],g=a[1];a=a[2];var c=d[0],f=d[1];d=d[2];e[0]=g*d-a*f;e[1]=a*c-b*d;e[2]=b*f-g*c;return e};h.lerp=function(e,a,d,b){var g=a[0],c=a[1];a=a[2];e[0]=g+b*(d[0]-g);e[1]=c+b*(d[1]-c);e[2]=a+b*(d[2]-a);return e};h.hermite=function(e,a,d,b,g,c){var f=c*c,h=f*(2*c-3)+1,n=f*(c-2)+c,l=f*(c-1);c=f*(3-2*c);e[0]=a[0]*h+d[0]*n+b[0]*l+g[0]*c;e[1]=a[1]*h+d[1]*n+b[1]*
l+g[1]*c;e[2]=a[2]*h+d[2]*n+b[2]*l+g[2]*c;return e};h.bezier=function(e,a,d,b,g,c){var f=1-c,h=f*f,n=c*c,l=h*f,h=3*c*h,f=3*n*f;c*=n;e[0]=a[0]*l+d[0]*h+b[0]*f+g[0]*c;e[1]=a[1]*l+d[1]*h+b[1]*f+g[1]*c;e[2]=a[2]*l+d[2]*h+b[2]*f+g[2]*c;return e};h.random=function(e,a){a=a||1;var d=2*q.RANDOM()*Math.PI,b=2*q.RANDOM()-1,g=Math.sqrt(1-b*b)*a;e[0]=Math.cos(d)*g;e[1]=Math.sin(d)*g;e[2]=b*a;return e};h.transformMat4=function(e,a,d){var b=a[0],g=a[1];a=a[2];var c=d[3]*b+d[7]*g+d[11]*a+d[15],c=c||1;e[0]=(d[0]*
b+d[4]*g+d[8]*a+d[12])/c;e[1]=(d[1]*b+d[5]*g+d[9]*a+d[13])/c;e[2]=(d[2]*b+d[6]*g+d[10]*a+d[14])/c;return e};h.transformMat3=function(e,a,d){var b=a[0],g=a[1];a=a[2];e[0]=b*d[0]+g*d[3]+a*d[6];e[1]=b*d[1]+g*d[4]+a*d[7];e[2]=b*d[2]+g*d[5]+a*d[8];return e};h.transformQuat=function(e,a,d){var b=a[0],g=a[1],c=a[2];a=d[0];var f=d[1],h=d[2];d=d[3];var n=d*b+f*c-h*g,l=d*g+h*b-a*c,p=d*c+a*g-f*b,b=-a*b-f*g-h*c;e[0]=n*d+b*-a+l*-h-p*-f;e[1]=l*d+b*-f+p*-a-n*-h;e[2]=p*d+b*-h+n*-f-l*-a;return e};h.rotateX=function(e,
a,d,b){var g=[],c=[];g[0]=a[0]-d[0];g[1]=a[1]-d[1];g[2]=a[2]-d[2];c[0]=g[0];c[1]=g[1]*Math.cos(b)-g[2]*Math.sin(b);c[2]=g[1]*Math.sin(b)+g[2]*Math.cos(b);e[0]=c[0]+d[0];e[1]=c[1]+d[1];e[2]=c[2]+d[2];return e};h.rotateY=function(e,a,d,b){var g=[],c=[];g[0]=a[0]-d[0];g[1]=a[1]-d[1];g[2]=a[2]-d[2];c[0]=g[2]*Math.sin(b)+g[0]*Math.cos(b);c[1]=g[1];c[2]=g[2]*Math.cos(b)-g[0]*Math.sin(b);e[0]=c[0]+d[0];e[1]=c[1]+d[1];e[2]=c[2]+d[2];return e};h.rotateZ=function(e,a,d,b){var g=[],c=[];g[0]=a[0]-d[0];g[1]=
a[1]-d[1];g[2]=a[2]-d[2];c[0]=g[0]*Math.cos(b)-g[1]*Math.sin(b);c[1]=g[0]*Math.sin(b)+g[1]*Math.cos(b);c[2]=g[2];e[0]=c[0]+d[0];e[1]=c[1]+d[1];e[2]=c[2]+d[2];return e};h.forEach=function(){var e=h.create();return function(a,d,b,g,c,f){d||(d=3);b||(b=0);for(g=g?Math.min(g*d+b,a.length):a.length;b<g;b+=d)e[0]=a[b],e[1]=a[b+1],e[2]=a[b+2],c(e,e,f),a[b]=e[0],a[b+1]=e[1],a[b+2]=e[2];return a}}();h.angle=function(e,a){e=h.fromValues(e[0],e[1],e[2]);a=h.fromValues(a[0],a[1],a[2]);h.normalize(e,e);h.normalize(a,
a);a=h.dot(e,a);return 1<a?0:Math.acos(a)};h.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"};h.exactEquals=function(e,a){return e[0]===a[0]&&e[1]===a[1]&&e[2]===a[2]};h.equals=function(e,a){var d=e[0],b=e[1];e=e[2];var g=a[0],c=a[1];a=a[2];return Math.abs(d-g)<=q.EPSILON*Math.max(1,Math.abs(d),Math.abs(g))&&Math.abs(b-c)<=q.EPSILON*Math.max(1,Math.abs(b),Math.abs(c))&&Math.abs(e-a)<=q.EPSILON*Math.max(1,Math.abs(e),Math.abs(a))};return h})},"esri/views/3d/terrain/TilemapOnlyTile":function(){define(["require",
"exports","./TerrainConst","./TilePerLayerInfo"],function(q,h,e,a){return function(){function d(a){this.parent=null;this.lij=a;this.layerInfo=Array(e.LayerClass.LAYER_CLASS_COUNT)}d.prototype.tileDataAvailable=function(a,d,c){return(d=this.layerInfo[c][d].tilemap)?"unavailable"!==d.getAvailability(a.lij[1],a.lij[2]):!0};d.prototype.modifyLayers=function(b,d,c){b=d.length;for(var e=this.layerInfo[c],g=Array(b),h=0;h<b;h++){var l=d[h];g[h]=-1<l?e[l]:new a(c)}this.layerInfo[c]=g};return d}()})},"esri/views/support/WebGLRequirements":function(){define(["require",
"exports","../../core/Error","../../core/sniff"],function(q,h,e,a){Object.defineProperty(h,"__esModule",{value:!0});h.check=function(){var d=null;a("esri-webgl")?a("esri-webgl-major-performance-caveat")?d=new e("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is blacklisted."):a("esri-webgl-high-precision-fragment")?a("esri-webgl-vertex-shader-samplers")?a("esri-webgl-element-index-uint")?
a("esri-webgl-standard-derivatives")||(d=new e("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.")):d=new e("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported."):d=new e("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):d=new e("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):
d=new e("webgl:required","WebGL is required but not supported.");return d}})},"esri/views/ui/3d/DefaultUI3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../DefaultUI".split(" "),function(q,h,e,a,d,b){return function(b){function c(a){a=b.call(this)||this;a.components=["attribution","zoom","navigation-toggle","compass"];return a}e(c,b);a([d.property()],c.prototype,"components",void 0);
return c=a([d.subclass("esri.views.ui.3d.DefaultUI3D")],c)}(d.declared(b))})},"esri/views/ui/DefaultUI":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/dom-geometry ../../core/watchUtils ../../core/accessorSupport/decorators ./Component ./UI ../../widgets/Attribution ../../widgets/Compass ../../widgets/NavigationToggle ../../widgets/Zoom".split(" "),function(q,h,e,a,d,b,g,c,f,k,n,l,p){return function(f){function h(a){a=f.call(this)||
this;a._defaultPositionLookup=null;a.components=[];return a}e(h,f);h.prototype.initialize=function(){this._handles.add([b.init(this,"components",this._componentsWatcher.bind(this)),b.init(this,"view",this._updateViewAwareWidgets.bind(this))])};h.prototype._findComponentPosition=function(a){if(!this._defaultPositionLookup){var b=d.isBodyLtr();this._defaultPositionLookup={attribution:"manual",compass:b?"top-left":"top-right","navigation-toggle":b?"top-left":"top-right",zoom:b?"top-left":"top-right"}}return this._defaultPositionLookup[a]};
h.prototype._removeComponents=function(a){var b=this;a.forEach(function(a){if(a=b.find(a))b.remove(a),a.destroy()})};h.prototype._updateViewAwareWidgets=function(a){var b=this;this.components.forEach(function(c){(c=(c=b.find(c))&&c.widget)&&void 0!==c.view&&c.set("view",a)})};h.prototype._componentsWatcher=function(a,b){this._removeComponents(b);this._addComponents(a);this._adjustPadding(a)};h.prototype._adjustPadding=function(a){-1!==a.indexOf("attribution")||this._isOverridden("padding")||(this.padding=
this.padding.top)};h.prototype._addComponents=function(a){var b=this;this.initialized&&a.forEach(function(a){return b.add(b._createComponent(a),b._findComponentPosition(a))})};h.prototype._createComponent=function(a){var b=this._createWidget(a);if(b)return new c({id:a,node:b})};h.prototype._createWidget=function(a){if("attribution"===a)return this._createAttribution();if("compass"===a)return this._createCompass();if("navigation-toggle"===a)return this._createNavigationToggle();if("zoom"===a)return this._createZoom()};
h.prototype._createAttribution=function(){return new k({view:this.view})};h.prototype._createCompass=function(){return new n({view:this.view})};h.prototype._createNavigationToggle=function(){return new l({view:this.view})};h.prototype._createZoom=function(){return new p({view:this.view})};a([g.property()],h.prototype,"components",void 0);return h=a([g.subclass("esri.views.ui.DefaultUI")],h)}(g.declared(f))})},"esri/views/ui/Component":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/dom dojo/dom-class ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),
function(q,h,e,a,d,b,g,c){return function(f){function g(){var a=null!==f&&f.apply(this,arguments)||this;a.widget=null;return a}e(g,f);g.prototype.destroy=function(){this.widget&&this.widget.destroy();this.node=null};Object.defineProperty(g.prototype,"id",{get:function(){return this._get("id")||this.get("node.id")},set:function(a){this._set("id",a)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"node",{set:function(a){var c=this._get("node");a!==c&&(a&&b.add(a,"esri-component"),
c&&b.remove(c,"esri-component"),this._set("node",a))},enumerable:!0,configurable:!0});g.prototype.castNode=function(a){if(!a)return this._set("widget",null),null;if("string"===typeof a||a&&"nodeType"in a)return this._set("widget",null),d.byId(a);a&&"function"===typeof a.render&&!a.domNode&&(a.domNode=document.createElement("div"));this._set("widget",a);return a.domNode};a([c.property()],g.prototype,"id",null);a([c.property()],g.prototype,"node",null);a([c.cast("node")],g.prototype,"castNode",null);
a([c.property({readOnly:!0})],g.prototype,"widget",void 0);return g=a([c.subclass("esri.views.ui.Component")],g)}(c.declared(g))})},"esri/views/ui/UI":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/dom-class dojo/dom-construct dojo/dom-style ../../core/Accessor ../../core/Evented ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ./Component".split(" "),function(q,h,
e,a,d,b,g,c,f,k,n,l,p,m){function r(a){return"object"!==typeof a||a&&a.isInstanceOf&&a.isInstanceOf(m)||!("component"in a||"index"in a||"position"in a)?null:a}var t={left:0,top:0,bottom:0,right:0},u={bottom:30,top:15,right:15,left:15};return function(f){function h(){var a=f.call(this)||this;a._cornerNameToContainerLookup={};a._positionNameToContainerLookup={};a._components=[];a._handles=new n;a._componentToKey=new Map;a.view=null;a._initContainers();return a}a(h,f);h.prototype.initialize=function(){this._handles.add([l.init(this,
"view.padding, container",this._applyViewPadding.bind(this)),l.init(this,"padding",this._applyUIPadding.bind(this))])};h.prototype.destroy=function(){this.container=null;this._components.forEach(function(a){a.destroy()});this._components.length=0;this._handles.destroy();this._componentToKey.clear();this._componentToKey=null};Object.defineProperty(h.prototype,"container",{set:function(a){var d=this._get("container");a!==d&&(a&&(b.add(a,"esri-ui"),this._attachContainers(a)),d&&(b.remove(d,"esri-ui"),
c.set(d,{top:"",bottom:"",left:"",right:""}),g.empty(d)),this._set("container",a))},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"height",{get:function(){var a=this.get("view.height")||0;if(0===a)return a;var b=this._getViewPadding();return Math.max(a-(b.top+b.bottom),0)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"padding",{get:function(){return this._get("padding")},set:function(a){a?this._override("padding",a):this._clearOverride("padding")},enumerable:!0,
configurable:!0});h.prototype.castPadding=function(a){return"number"===typeof a?{bottom:a,top:a,right:a,left:a}:e({},u,a)};Object.defineProperty(h.prototype,"width",{get:function(){var a=this.get("view.width")||0;if(0===a)return a;var b=this._getViewPadding();return Math.max(a-(b.left+b.right),0)},enumerable:!0,configurable:!0});h.prototype.add=function(a,b){var c=this,d,e;if(Array.isArray(a))a.forEach(function(a){return c.add(a,b)});else{var f=r(a);f&&(d=f.index,b=f.position,a=f.component,e=f.key);
b&&"object"===typeof b&&(d=b.index,e=b.key,b=b.position);!a||b&&!this._isValidPosition(b)||(a&&a.isInstanceOf&&a.isInstanceOf(m)||(a=new m({node:a})),this._place({component:a,position:b,index:d}),this._components.push(a),e&&this._componentToKey.set(a,e))}};h.prototype.remove=function(a,b){var c=this;if(a){if(Array.isArray(a))return a.map(function(a){return c.remove(a,b)});var d=this.find(a);if(d){var e=this._componentToKey;if(!e.has(a)||e.get(a)===b)return e=this._components.indexOf(d),d.node.parentNode&&
d.node.parentNode.removeChild(d.node),this._componentToKey.delete(a),this._components.splice(e,1)[0]}}};h.prototype.empty=function(a){var c=this;if(Array.isArray(a))return a.map(function(a){return c.empty(a)}).reduce(function(a,b){return a.concat(b)});a=a||"manual";if("manual"===a)return Array.prototype.slice.call(this._manualContainer.children).filter(function(a){return!b.contains(a,"esri-ui-corner")}).map(function(a){return c.remove(a)});if(this._isValidPosition(a))return Array.prototype.slice.call(this._cornerNameToContainerLookup[a].children).map(this.remove,
this)};h.prototype.move=function(a,b){var c=this;Array.isArray(a)&&a.forEach(function(a){return c.move(a,b)});if(a){var d,e=r(a)||r(b);e&&(d=e.index,b=e.position,a=e.component||a);(!b||this._isValidPosition(b))&&(a=this.remove(a))&&this.add(a,{position:b,index:d})}};h.prototype.find=function(a){return a?a&&a.isInstanceOf&&a.isInstanceOf(m)?this._findByComponent(a):"string"===typeof a?this._findById(a):this._findByNode(a.domNode||a):null};h.prototype._getViewPadding=function(){return this.get("view.padding")||
t};h.prototype._attachContainers=function(a){g.place(this._manualContainer,a);g.place(this._innerContainer,a)};h.prototype._initContainers=function(){var a=g.create("div",{className:"esri-ui-inner-container esri-ui-corner-container"}),b=g.create("div",{className:"esri-ui-inner-container esri-ui-manual-container"}),c=g.create("div",{className:"esri-ui-top-left esri-ui-corner"},a),d=g.create("div",{className:"esri-ui-top-right esri-ui-corner"},a),f=g.create("div",{className:"esri-ui-bottom-left esri-ui-corner"},
a),h=g.create("div",{className:"esri-ui-bottom-right esri-ui-corner"},a);this._innerContainer=a;this._manualContainer=b;this._cornerNameToContainerLookup={"top-left":c,"top-right":d,"bottom-left":f,"bottom-right":h};this._positionNameToContainerLookup=e({manual:b},this._cornerNameToContainerLookup)};h.prototype._isValidPosition=function(a){return!!this._positionNameToContainerLookup[a]};h.prototype._place=function(a){var b=a.component,c=a.index;a=this._positionNameToContainerLookup[a.position||"manual"];
var d;-1<c?(d=Array.prototype.slice.call(a.children),0===c?this._placeComponent(b,a,"first"):c>=d.length?this._placeComponent(b,a,"last"):this._placeComponent(b,d[c],"before")):this._placeComponent(b,a,"last")};h.prototype._placeComponent=function(a,b,c){var d=a.widget;d&&!d._started&&"function"===typeof d.postMixInProperties&&"function"===typeof d.buildRendering&&"function"===typeof d.postCreate&&"function"===typeof d.startup&&a.widget.startup();g.place(a.node,b,c)};h.prototype._applyViewPadding=
function(){var a=this.container;a&&c.set(a,this._toPxPosition(this._getViewPadding()))};h.prototype._applyUIPadding=function(){this._innerContainer&&c.set(this._innerContainer,this._toPxPosition(this.padding))};h.prototype._toPxPosition=function(a){return{top:this._toPxUnit(a.top),left:this._toPxUnit(a.left),right:this._toPxUnit(a.right),bottom:this._toPxUnit(a.bottom)}};h.prototype._toPxUnit=function(a){return 0===a?0:a+"px"};h.prototype._findByComponent=function(a){var b=null,c;this._components.some(function(d){(c=
d===a)&&(b=d);return c});return b};h.prototype._findById=function(a){var b=null,c;this._components.some(function(d){(c=d.id===a)&&(b=d);return c});return b};h.prototype._findByNode=function(a){var b=null,c;this._components.some(function(d){(c=d.node===a)&&(b=d);return c});return b};d([p.property()],h.prototype,"container",null);d([p.property({dependsOn:["view.height"]})],h.prototype,"height",null);d([p.property({value:u})],h.prototype,"padding",null);d([p.cast("padding")],h.prototype,"castPadding",
null);d([p.property()],h.prototype,"view",void 0);d([p.property({dependsOn:["view.width"]})],h.prototype,"width",null);return h=d([p.subclass("esri.views.ui.UI")],h)}(p.declared(f,k))})},"esri/widgets/Attribution":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Attribution/nls/Attribution ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./Attribution/AttributionViewModel ./support/widget".split(" "),function(q,h,
e,a,d,b,g,c,f,k){return function(c){function h(a){a=c.call(this)||this;a._isOpen=!1;a._attributionTextOverflowed=!1;a._prevSourceNodeHeight=0;a.iconClass="esri-icon-description";a.itemDelimiter=" | ";a.label=d.widgetLabel;a.view=null;a.viewModel=new f;return a}e(h,c);h.prototype.postInitialize=function(){var a=this;this.own(b.on(this,"viewModel.items","change",function(){return a.scheduleRender()}))};Object.defineProperty(h.prototype,"attributionText",{get:function(){return this.viewModel.items.reduce(function(a,
b){-1===a.indexOf(b.text)&&a.push(b.text);return a},[]).join(this.itemDelimiter)},enumerable:!0,configurable:!0});h.prototype.render=function(){var a,b=(a={},a["esri-attribution--open"]=this._isOpen,a);return k.tsx("div",{bind:this,class:this.classes("esri-attribution esri-widget",b),onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),k.tsx("div",{class:"esri-attribution__powered-by"},"Powered by"," ",k.tsx("a",{target:"_blank",href:"https://iobio-zjut.github.io/",class:this.classes("esri-attribution__link",
"esri-widget__anchor")},"B202")))};h.prototype._renderSourcesNode=function(){var a,b=this._isOpen,c=this._isInteractive(),d=c?0:-1,e=this.attributionText,f=c?"button":void 0,b=(a={},a["esri-attribution__sources--open"]=b,a["esri-interactive"]=c,a);return k.tsx("div",{afterCreate:this._afterSourcesNodeCreate,afterUpdate:this._afterSourcesNodeUpdate,bind:this,class:this.classes("esri-attribution__sources",b),innerHTML:e,role:f,tabIndex:d})};h.prototype._afterSourcesNodeCreate=function(a){this._prevSourceNodeHeight=
a.clientWidth};h.prototype._afterSourcesNodeUpdate=function(a){var b=!1,c=a.clientHeight;a=a.scrollWidth>=a.clientWidth;var d=this._attributionTextOverflowed!==a;this._attributionTextOverflowed=a;d&&(b=!0);this._isOpen&&(a=c<this._prevSourceNodeHeight,this._prevSourceNodeHeight=c,a&&(this._isOpen=!1,b=!0));b&&this.scheduleRender()};h.prototype._toggleState=function(){this._isInteractive()&&(this._isOpen=!this._isOpen)};h.prototype._isInteractive=function(){return this._isOpen||this._attributionTextOverflowed};
a([g.property({dependsOn:["viewModel.items.length","itemDelimiter"],readOnly:!0}),k.renderable()],h.prototype,"attributionText",null);a([g.property()],h.prototype,"iconClass",void 0);a([g.property(),k.renderable()],h.prototype,"itemDelimiter",void 0);a([g.property()],h.prototype,"label",void 0);a([g.aliasOf("viewModel.view")],h.prototype,"view",void 0);a([g.property({type:f}),k.renderable(["state","view.size"])],h.prototype,"viewModel",void 0);a([k.accessibleHandler()],h.prototype,"_toggleState",
null);return h=a([g.subclass("esri.widgets.Attribution")],h)}(g.declared(c))})},"esri/widgets/Attribution/AttributionViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../geometry ../../core/Accessor ../../core/Collection ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ../../geometry/support/contains ../../geometry/support/webMercatorUtils".split(" "),function(q,h,e,a,d,b,g,c,f,k,n,l){return function(b){function h(a){a=
b.call(this,a)||this;a._handles=new c;a._pendingAttributionItemsByLayerId={};a._attributionDataByLayerId={};a.items=new g;a.view=null;a._updateAttributionItems=a._updateAttributionItems.bind(a);return a}e(h,b);h.prototype.initialize=function(){this._handles.add(f.init(this,"view",this._viewWatcher))};h.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null};Object.defineProperty(h.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,
configurable:!0});h.prototype._viewWatcher=function(a){var b=this,c=this._handles;c&&c.remove();a&&(c.add([a.allLayerViews.on("change",function(a){b._addLayerViews(a.added);0<a.removed.length&&(a.removed.forEach(function(a){c.remove(a.uid)}),b._updateAttributionItems())}),f.init(a,"stationary",this._updateAttributionItems)]),this._addLayerViews(a.allLayerViews))};h.prototype._addLayerViews=function(a){var b=this;a.forEach(function(a){b._handles.has(a.uid)||b._handles.add(f.init(a,"suspended",b._updateAttributionItems),
a.uid)})};h.prototype._updateAttributionItems=function(){var a=this,b=[];this._getActiveLayerViews().forEach(function(c){var d=c.layer;if(!d.hasAttributionData){if(c=d.get("copyright")){var e=a._findItem(b,{layer:d,text:c});e||b.push({text:c,layer:d})}}else if(d&&d.tileInfo){var f=a._attributionDataByLayerId;if(f[d.uid]){if(c=a._getDynamicAttribution(f[d.uid],a.view,d))(e=a._findItem(b,{layer:d,text:c}))||b.push({text:c,layer:d})}else{var g=a._pendingAttributionItemsByLayerId;a._inProgress(g[d.uid])||
(g[d.uid]=d.fetchAttributionData().then(function(b){b=a._createContributionIndex(b,a._isBingLayer(d));delete g[d.uid];f[d.uid]=b;a._updateAttributionItems()}))}}});this._itemsChanged(this.items,b)&&(this.items.removeAll(),this.items.addMany(b))};h.prototype._itemsChanged=function(a,b){return a.length!==b.length||a.some(function(a,c){return a.text!==b[c].text})};h.prototype._inProgress=function(a){return a&&!a.isFulfilled()};h.prototype._getActiveLayerViews=function(){return this.get("view.allLayerViews").filter(function(a){return!a.suspended&&
a.get("layer.attributionVisible")})};h.prototype._findItem=function(a,b){var c=b.layer,d=b.text,e;a.some(function(a){var b=a.layer===c&&a.text===d;b&&(e=a);return b});return e};h.prototype._isBingLayer=function(a){return"bing-maps"===a.type};h.prototype._createContributionIndex=function(a,b){a=a.contributors;var c={};if(!a)return c;for(var e=0;e<a.length;e++){var f=a[e],g=f.coverageAreas;if(!g)return;for(var h=0;h<g.length;h++)for(var k=g[h],m=k.bbox,n=k.zoomMin-(b&&k.zoomMin?1:0),p=k.zoomMax-(b&&
k.zoomMax?1:0),k={extent:l.geographicToWebMercator({xmin:m[1],ymin:m[0],xmax:m[3],ymax:m[2],spatialReference:d.SpatialReference.WGS84}),attribution:f.attribution||"",score:null!=k.score?k.score:100,id:e};n<=p;n++)c[n]=c[n]||[],c[n].push(k)}c.maxKey=Math.max.apply(null,Object.keys(c));return c};h.prototype._getDynamicAttribution=function(a,b,c){var d=b.extent;c=c.tileInfo.scaleToZoom(b.scale);c=Math.min(a.maxKey,Math.round(c));if(!d||null==c||-1>=c)return"";a=a[c];var e=l.project(d.center.clone().normalize(),
b.spatialReference),f={};return a.filter(function(a){var b=!f[a.id]&&e&&n.extentContainsPoint(a.extent,e);b&&(f[a.id]=!0);return b}).sort(function(a,b){return b.score-a.score||a.objectId-b.objectId}).map(function(a){return a.attribution}).join(", ")};a([k.property({readOnly:!0,type:g})],h.prototype,"items",void 0);a([k.property({dependsOn:["view.ready"],readOnly:!0})],h.prototype,"state",null);a([k.property()],h.prototype,"view",void 0);return h=a([k.subclass("esri.widgets.Attribution.AttributionViewModel")],
h)}(k.declared(b))})},"esri/widgets/Compass":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Compass/nls/Compass ../core/accessorSupport/decorators ./Widget ./Compass/CompassViewModel ./support/widget".split(" "),function(q,h,e,a,d,b,g,c,f){return function(g){function h(a){a=g.call(this)||this;a.activeMode=null;a.goToOverride=null;a.iconClass="esri-icon-locate-circled";a.label=d.widgetLabel;a.modes=null;a.view=null;a.viewModel=
new c;return a}e(h,g);h.prototype.reset=function(){};h.prototype.render=function(){var a,b,c=this.viewModel.orientation,e=this.viewModel.state,g="disabled"===e,h="compass"===("rotation"===e?"rotation":"compass"),e=g?-1:0,g=(a={},a["esri-disabled"]=g,a["esri-compass--active"]="device-orientation"===this.viewModel.activeMode,a["esri-interactive"]=!g,a);a=(b={},b["esri-icon-compass"]=h,b["esri-icon-dial"]=!h,b);return f.tsx("div",{bind:this,class:this.classes("esri-compass esri-widget--button esri-widget",
g),onclick:this._start,onkeydown:this._start,role:"button",tabIndex:e,"aria-label":d.reset,title:d.reset},f.tsx("span",{"aria-hidden":"true",class:this.classes("esri-compass__icon",a),styles:this._toRotationTransform(c)}),f.tsx("span",{class:"esri-icon-font-fallback-text"},d.reset))};h.prototype._start=function(){var a=this.viewModel;a.nextMode();a.startMode()};h.prototype._toRotationTransform=function(a){return{transform:"rotateZ("+a.z+"deg)"}};a([b.aliasOf("viewModel.activeMode")],h.prototype,"activeMode",
void 0);a([b.aliasOf("viewModel.goToOverride")],h.prototype,"goToOverride",void 0);a([b.property()],h.prototype,"iconClass",void 0);a([b.property()],h.prototype,"label",void 0);a([b.aliasOf("viewModel.modes")],h.prototype,"modes",void 0);a([b.aliasOf("viewModel.view")],h.prototype,"view",void 0);a([b.property({type:c}),f.renderable(["viewModel.orientation","viewModel.state"])],h.prototype,"viewModel",void 0);a([b.aliasOf("viewModel.reset")],h.prototype,"reset",null);a([f.accessibleHandler()],h.prototype,
"_start",null);return h=a([b.subclass("esri.widgets.Compass")],h)}(b.declared(g))})},"esri/widgets/Compass/CompassViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Handles ../../core/Logger ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../support/GoTo".split(" "),function(q,h,e,a,d,b,g,c,f,k,n){var l=g.getLogger("esri.widgets.CompassViewModel");return function(d){function g(a){a=
d.call(this,a)||this;a._handles=new b;a._eventType=a._getDeviceOrientationEventType();a.canUseHeading=!1;a.orientation={x:0,y:0,z:0};a.view=null;a._updateForCamera=a._updateForCamera.bind(a);a._updateForRotation=a._updateForRotation.bind(a);a._updateRotationWatcher=a._updateRotationWatcher.bind(a);a._updateViewHeading=a._updateViewHeading.bind(a);a._checkHeadingSupport=a._checkHeadingSupport.bind(a);a._canUseHeading();return a}e(g,d);g.prototype.initialize=function(){this._handles.add(f.init(this,
"view",this._updateRotationWatcher))};g.prototype.destroy=function(){this._removeCheckHeadingListener();this._removeOrientationListener();this._handles.destroy();this.view=this._handles=null};Object.defineProperty(g.prototype,"activeMode",{get:function(){var a=this._get("activeMode");return a?a:(a=this.modes)?a[0]:"none"},set:function(a){this.stopMode();this._override("activeMode",a);void 0===a&&this._clearOverride("activeMode")},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"canShowNorth",
{get:function(){var a=this.get("view.spatialReference");return a&&(a.isWebMercator||a.isWGS84)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"modes",{get:function(){return this._get("modes")||["reset"]},set:function(a){this._set("modes",a);void 0===a&&this._clearOverride("modes")},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"state",{get:function(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"},enumerable:!0,configurable:!0});
g.prototype.previousMode=function(){var a=this.modes;2>a.length||(a=a.indexOf(this.activeMode),this._paginateMode(a-1))};g.prototype.nextMode=function(){var a=this.modes;2>a.length||(a=a.indexOf(this.activeMode),this._paginateMode(a+1))};g.prototype.startMode=function(){var a=this.activeMode;"reset"===a&&this.reset();"device-orientation"===a&&(this._removeOrientationListener(),this._addOrientationListener())};g.prototype.stopMode=function(){"device-orientation"===this.activeMode&&this._removeOrientationListener()};
g.prototype.reset=function(){if(this.get("view.ready")){var a={};"2d"===this.view.type?a.rotation=0:a.heading=0;this.callGoTo({target:a})}};g.prototype._getDeviceOrientationEventType=function(){if("ondeviceorientationabsolute"in window)return"deviceorientationabsolute";if("ondeviceorientation"in window)return"deviceorientation"};g.prototype._paginateMode=function(a){var b=this.modes;this.activeMode=b[(a+b.length)%b.length]};g.prototype._supportsHeading=function(a){var b=a.absolute,c=a.alpha;return"number"===
typeof a.webkitCompassHeading||!!b&&"number"===typeof c};g.prototype._getHeading=function(a){var b=a.alpha,c=a.webkitCompassHeading;if(c)return c;if(a.absolute&&"number"===typeof b)return b};g.prototype._removeCheckHeadingListener=function(){var a=this._eventType;a&&window.removeEventListener(a,this._checkHeadingSupport)};g.prototype._checkHeadingSupport=function(a){this._supportsHeading(a)&&this._set("canUseHeading",!0);this._removeCheckHeadingListener()};g.prototype._canUseHeading=function(){var a=
this,b=this._eventType;b&&(window.addEventListener(b,this._checkHeadingSupport),c.after(500).then(function(){a._removeCheckHeadingListener()}))};g.prototype._getHeadingAdjustment=function(a,b){if("orientation"in window){b=window.orientation;if("number"!==typeof b)return a;a+=b;return 360<a?a-360:0>a?a+360:a}return a};g.prototype._updateViewHeading=function(a){var b=this.view,c=this._getHeading(a);!b||!b.stationary||"number"!==typeof c||0>c||360<c||(a=this._getHeadingAdjustment(c,a),"3d"===b.type&&
(c=b.camera.clone(),c.heading=a,b.camera=c),"2d"===b.type&&(b.rotation=a))};g.prototype._removeOrientationListener=function(){this.canUseHeading&&window.removeEventListener(this._eventType,this._updateViewHeading)};g.prototype._addOrientationListener=function(){var a=this._eventType,b=this.canShowNorth;this.canUseHeading?b?window.addEventListener(a,this._updateViewHeading):l.warn("device-orientation mode requires 'canShowNorth' to be true"):l.warn("The deviceorientation event is not supported in this browser")};
g.prototype._updateForRotation=function(a){void 0!==a&&null!==a&&(this.orientation={z:a})};g.prototype._updateForCamera=function(a){a&&(this.orientation={x:0,y:0,z:-a.heading})};g.prototype._updateRotationWatcher=function(a){this._handles.removeAll();a&&("2d"===a.type?this._handles.add(f.init(this,"view.rotation",this._updateForRotation)):this._handles.add(f.init(this,"view.camera",this._updateForCamera)))};a([k.property({dependsOn:["modes"]})],g.prototype,"activeMode",null);a([k.property({dependsOn:["view.spatialReference.isWebMercator",
"view.spatialReference.wkid"],readOnly:!0})],g.prototype,"canShowNorth",null);a([k.property({readOnly:!0})],g.prototype,"canUseHeading",void 0);a([k.property({dependsOn:["canUseHeading"]})],g.prototype,"modes",null);a([k.property()],g.prototype,"orientation",void 0);a([k.property({dependsOn:["view.ready","canShowNorth"],readOnly:!0})],g.prototype,"state",null);a([k.property()],g.prototype,"view",void 0);a([k.property()],g.prototype,"previousMode",null);a([k.property()],g.prototype,"nextMode",null);
a([k.property()],g.prototype,"startMode",null);a([k.property()],g.prototype,"stopMode",null);a([k.property()],g.prototype,"reset",null);return g=a([k.subclass("esri.widgets.CompassViewModel")],g)}(k.declared(d,n))})},"esri/widgets/NavigationToggle":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./NavigationToggle/nls/NavigationToggle ../core/accessorSupport/decorators ./Widget ./NavigationToggle/NavigationToggleViewModel ./support/widget".split(" "),
function(q,h,e,a,d,b,g,c,f){return function(g){function h(a){a=g.call(this)||this;a.iconClass="esri-icon-pan2";a.label=d.widgetLabel;a.view=null;a.viewModel=new c;return a}e(h,g);Object.defineProperty(h.prototype,"layout",{set:function(a){"horizontal"!==a&&(a="vertical");this._set("layout",a)},enumerable:!0,configurable:!0});h.prototype.toggle=function(){};h.prototype.render=function(){var a,b,c,e="disabled"===this.get("viewModel.state"),g="pan"===this.get("viewModel.navigationMode"),h=(a={},a["esri-disabled"]=
e,a["esri-navigation-toggle--horizontal"]="horizontal"===this.layout,a);a=(b={},b["esri-navigation-toggle__button--active"]=g,b);b=(c={},c["esri-navigation-toggle__button--active"]=!g,c);c=e?-1:0;return f.tsx("div",{bind:this,class:this.classes("esri-navigation-toggle esri-widget",h),onclick:this._toggle,onkeydown:this._toggle,tabIndex:c,"aria-label":d.toggle,title:d.toggle},f.tsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button","esri-navigation-toggle__button--pan",
a)},f.tsx("span",{class:"esri-icon-pan"})),f.tsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button","esri-navigation-toggle__button--rotate",b)},f.tsx("span",{class:"esri-icon-rotate"})))};h.prototype._toggle=function(){this.toggle()};a([b.property()],h.prototype,"iconClass",void 0);a([b.property()],h.prototype,"label",void 0);a([b.property({value:"vertical"}),f.renderable()],h.prototype,"layout",null);a([b.aliasOf("viewModel.view"),f.renderable()],h.prototype,"view",void 0);
a([b.property({type:c}),f.renderable(["viewModel.state","viewModel.navigationMode"])],h.prototype,"viewModel",void 0);a([b.aliasOf("viewModel.toggle")],h.prototype,"toggle",null);a([f.accessibleHandler()],h.prototype,"_toggle",null);return h=a([b.subclass("esri.widgets.NavigationToggle")],h)}(b.declared(g))})},"esri/widgets/NavigationToggle/NavigationToggleViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators".split(" "),
function(q,h,e,a,d,b,g,c){return function(d){function f(a){a=d.call(this,a)||this;a._handles=new b;a.navigationMode="pan";a.view=null;a.toggle=a.toggle.bind(a);return a}e(f,d);f.prototype.initialize=function(){this._handles.add(g.when(this,"view.inputManager",this._setNavigationMode.bind(this)))};f.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null};Object.defineProperty(f.prototype,"state",{get:function(){return this.get("view.ready")&&"3d"===this.view.type?"ready":
"disabled"},enumerable:!0,configurable:!0});f.prototype.toggle=function(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())};f.prototype._setNavigationMode=function(){this.get("view.inputManager").primaryDragAction="pan"===this.navigationMode?"pan":"rotate"};a([c.property({dependsOn:["view.ready"],readOnly:!0})],f.prototype,"state",null);a([c.property()],f.prototype,"navigationMode",void 0);a([c.property()],f.prototype,"view",void 0);
a([c.property()],f.prototype,"toggle",null);return f=a([c.subclass("esri.widgets.NavigationToggleViewModel")],f)}(c.declared(d))})},"esri/widgets/Zoom":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Zoom/nls/Zoom ../core/accessorSupport/decorators ./Widget ./Zoom/IconButton ./Zoom/ZoomViewModel ./support/widget".split(" "),function(q,h,e,a,d,b,g,c,f,k){return function(g){function h(a){a=g.call(this)||this;a.iconClass="esri-icon-zoom-in-magnifying-glass";
a.label=d.widgetLabel;a.view=null;a.viewModel=new f;return a}e(h,g);h.prototype.postInitialize=function(){this._zoomInButton=new c({action:this.zoomIn,iconClass:"esri-icon-plus",title:d.zoomIn});this._zoomOutButton=new c({action:this.zoomOut,iconClass:"esri-icon-minus",title:d.zoomOut})};Object.defineProperty(h.prototype,"layout",{set:function(a){"horizontal"!==a&&(a="vertical");this._set("layout",a)},enumerable:!0,configurable:!0});h.prototype.render=function(){var a,b=this.viewModel,c=(a={},a["esri-zoom--horizontal"]=
"horizontal"===this.layout,a);this._zoomInButton.enabled="ready"===b.state&&b.canZoomIn;this._zoomOutButton.enabled="ready"===b.state&&b.canZoomOut;return k.tsx("div",{class:this.classes("esri-zoom esri-widget",c)},this._zoomInButton.render(),this._zoomOutButton.render())};h.prototype.zoomIn=function(){};h.prototype.zoomOut=function(){};a([b.property()],h.prototype,"iconClass",void 0);a([b.property()],h.prototype,"label",void 0);a([b.property({value:"vertical"}),k.renderable()],h.prototype,"layout",
null);a([b.aliasOf("viewModel.view"),k.renderable()],h.prototype,"view",void 0);a([b.property({type:f}),k.renderable(["viewModel.canZoomIn","viewModel.canZoomOut","viewModel.state"])],h.prototype,"viewModel",void 0);a([b.aliasOf("viewModel.zoomIn")],h.prototype,"zoomIn",null);a([b.aliasOf("viewModel.zoomOut")],h.prototype,"zoomOut",null);return h=a([b.subclass("esri.widgets.Zoom")],h)}(b.declared(g))})},"esri/widgets/Zoom/IconButton":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../Widget ../support/widget".split(" "),
function(q,h,e,a,d,b,g){return function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.enabled=!0;a.iconClass="";a.title="";return a}e(c,b);c.prototype.render=function(){var a,b,c=this.enabled?0:-1,d=(a={},a["esri-disabled"]=!this.enabled,a["esri-interactive"]=this.enabled,a);a=(b={},b[this.iconClass]=!!this.iconClass,b);return g.tsx("div",{bind:this,class:this.classes("esri-widget--button esri-widget",d),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:c,
title:this.title},g.tsx("span",{"aria-hidden":"true",role:"presentation",class:this.classes("esri-icon",a)}),g.tsx("span",{class:"esri-icon-font-fallback-text"},this.title))};c.prototype._triggerAction=function(){this.action.call(this)};a([d.property()],c.prototype,"action",void 0);a([d.property(),g.renderable()],c.prototype,"enabled",void 0);a([d.property({readOnly:!1}),g.renderable()],c.prototype,"iconClass",void 0);a([d.property(),g.renderable()],c.prototype,"title",void 0);a([g.accessibleHandler()],
c.prototype,"_triggerAction",null);return c=a([d.subclass("esri.widgets.IconButton")],c)}(d.declared(b))})},"esri/widgets/Zoom/ZoomViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators ./ZoomConditions2D ./ZoomConditions3D".split(" "),function(q,h,e,a,d,b,g,c){return function(d){function f(a){a=d.call(this,a)||this;a.canZoomIn=null;a.canZoomOut=null;a.zoomIn=a.zoomIn.bind(a);
a.zoomOut=a.zoomOut.bind(a);return a}e(f,d);f.prototype.destroy=function(){this.view=null};Object.defineProperty(f.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"view",{set:function(a){a?"2d"===a.type?this._zoomConditions=new g({view:a}):"3d"===a.type&&(this._zoomConditions=new c):this._zoomConditions=null;this._set("view",a)},enumerable:!0,configurable:!0});f.prototype.zoomIn=function(){this.canZoomIn&&
this._zoomToFactor(.5)};f.prototype.zoomOut=function(){this.canZoomOut&&this._zoomToFactor(2)};f.prototype._zoomToFactor=function(a){if("ready"===this.state){var b=this.view;"3d"===this.view.type?b.goTo({zoomFactor:1/a}):b.goTo({scale:this.get("view.scale")*a})}};a([b.property()],f.prototype,"_zoomConditions",void 0);a([b.property({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],f.prototype,"canZoomIn",void 0);a([b.property({aliasOf:"_zoomConditions.canZoomOut",readOnly:!0})],f.prototype,"canZoomOut",
void 0);a([b.property({dependsOn:["view.ready"],readOnly:!0})],f.prototype,"state",null);a([b.property()],f.prototype,"view",null);a([b.property()],f.prototype,"zoomIn",null);a([b.property()],f.prototype,"zoomOut",null);return f=a([b.subclass("esri.widgets.Zoom.ZoomViewModel")],f)}(b.declared(d))})},"esri/widgets/Zoom/ZoomConditions2D":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),
function(q,h,e,a,d,b){return function(d){function c(){return null!==d&&d.apply(this,arguments)||this}e(c,d);Object.defineProperty(c.prototype,"canZoomIn",{get:function(){var a=this.get("view.scale"),b=this.get("view.constraints.effectiveMaxScale");return 0===b||a>b},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"canZoomOut",{get:function(){var a=this.get("view.scale"),b=this.get("view.constraints.effectiveMinScale");return 0===b||a<b},enumerable:!0,configurable:!0});a([b.property({dependsOn:["view.ready",
"view.scale"],readOnly:!0})],c.prototype,"canZoomIn",null);a([b.property({dependsOn:["view.ready","view.scale"],readOnly:!0})],c.prototype,"canZoomOut",null);a([b.property()],c.prototype,"view",void 0);return c=a([b.subclass("esri.widgets.Zoom.ZoomConditions2D")],c)}(b.declared(d))})},"esri/widgets/Zoom/ZoomConditions3D":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),
function(q,h,e,a,d,b){return function(d){function c(){var a=null!==d&&d.apply(this,arguments)||this;a.canZoomIn=!0;a.canZoomOut=!0;return a}e(c,d);a([b.property({readOnly:!0})],c.prototype,"canZoomIn",void 0);a([b.property({readOnly:!0})],c.prototype,"canZoomOut",void 0);return c=a([b.subclass("esri.widgets.Zoom.ZoomConditions3D")],c)}(b.declared(d))})},"esri/layers/graphics/controllers/I3SOnDemandController":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/has dojo/errors/CancelError dojo/promise/all ../../../core/Accessor ../../../core/arrayUtils ../../../core/Evented ../../../core/Handles ../../../core/Logger ../../../core/PooledArray ../../../core/Promise ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/sql/WhereClause ../../../geometry/support/aaBoundingBox ../../../layers/IntegratedMeshLayer ../../../layers/SceneLayer ../../../views/3d/layers/SceneLayerView3D ../../../views/3d/layers/i3s/I3SIndex ../../../views/3d/layers/i3s/I3SLodHandling ../../../views/3d/layers/i3s/I3SNodeLoader ../../../views/3d/layers/i3s/I3SUtil ../../../views/3d/layers/i3s/I3SViewportQueries ../../../views/3d/layers/i3s/IdleQueue ../../../views/3d/lib/glMatrix ../../../views/3d/support/projectionUtils ../../../views/3d/support/ResourceController".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u,x,v,A,y,C,B,D,E,J,F,M,H,I,K){function O(a,b){return a.length===b.length&&a.every(function(a){return 0<=P(b,a.name)})}function P(a,b){b=b.toLowerCase();for(var c=0;c<a.length;c++)if(a[c].name.toLowerCase()===b)return c;return-1}var L=l.getLogger("esri.layers.graphics.controllers.I3SOnDemandController");q=function(c){function h(a){a=c.call(this)||this;a.nodeIndex={};a.screenSizeFactor=0;a.featureTarget=5E4;a.updating=!0;a.updatingPercentage=0;a.leafsReached=
!1;a._lodFactorProperty=null;a._featureLOD=1;a._stableFeatureLOD=!1;a._isIdle=!1;a._cameraDirty=!0;a._hasFeatures=!1;a._alwaysLoadEverythingModeEnabled=!1;a._uncompressedTextureDownsamplingEnabled=!1;a._downloadingNodes=new Set;a._loadingNodes=new Set;a._updatingNodes=new Map;a._progressMaxNumNodes=1;a._poi=null;a._requiredAttributesDirty=!0;a._updatesDisabled=!1;a.disableCache=!1;a._restartNodeLoading=!1;a._fields=null;a._attributeStorageInfo=null;a._handles=new n;a._idleQueue=new M.IdleQueue;a._errorCount=
0;return a}e(h,c);Object.defineProperty(h.prototype,"isMeshPyramid",{get:function(){return"mesh-pyramids"===this.layer.profile||"MeshPyramid"===this.layer.store.lodType},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"streamDataSupplier",{get:function(){return this.layerView.view.resourceController.getStreamDataSupplier(K.ClientType.SCENE,{trackRequests:!0})},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"parsedDefinitionExpression",{get:function(){if(this.layer instanceof
y&&this.layer.definitionExpression)try{var a=x.create(this.layer.definitionExpression);if(!a.isStandardized())return L.error("definitionExpression is using non standard function"),null;var b=[],c=a.getFields();J.findFieldsCaseInsensitive(c,this.layer.fields,{missingFields:b});return 0<b.length?(L.error("definitionExpression references unknown fields: "+b.join(", ")),null):a}catch(G){return L.error("Failed to parse definitionExpression: "+G),null}else return null},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,
"definitionExpressionFields",{get:function(){if(this.parsedDefinitionExpression){var a=this.parsedDefinitionExpression.getFields();return J.findFieldsCaseInsensitive(a,this._fields)}return null},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"crsVertex",{get:function(){return J.getVertexCrs(this.layer)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"crsIndex",{get:function(){return J.getIndexCrs(this.layer)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,
"rootNodeVisible",{get:function(){var a=this._rootNodeId&&this.nodeIndex[this._rootNodeId];return a&&this._viewportQueries?this._viewportQueries.isNodeVisible(a):!0},enumerable:!0,configurable:!0});h.prototype.initialize=function(){var a=this;this.updateEventListener={needsUpdate:function(){return!1},idleBegin:function(){a._updateIdleState(!0)},idleEnd:function(){a._updateIdleState(!1)}};this.updateEventListenerWhileSuspended={idleBegin:function(){return a._startNodeLoadingWhileSuspended()}};this._lodHandling=
new D(this.layerViewRequiredFunctions,this.layerViewOptionalFunctions,function(){return a.updatingChanged()});this.layerView._controller=this;var b=this.layer;this._defaultGeometrySchema=b.store.defaultGeometrySchema;this._rootNodeUrl=b.store.rootNode;var c=this._rootNodeUrl.split("/");this._rootNodeId=c[c.length-1];this.disableCache=d("disable-feature:idb-cache");b instanceof y?("mesh"===b.geometryType?this._lodFactorProperty="qualitySettings.sceneService.3dObject.lodFactor":"point"===b.geometryType&&
(this._lodFactorProperty="qualitySettings.sceneService.point.lodFactor"),this._fields=b.fields,this._attributeStorageInfo=b.attributeStorageInfo):b instanceof A&&(this._lodFactorProperty="qualitySettings.sceneService.integratedMesh.lodFactor");b=g([this.layer.when(),this.layerView.when()]).then(function(){if(!a.destroyed&&a.layerView&&!a.layerView.destroyed){var b=a.layerView.view;a.setClippingArea(b.clippingArea);a._centerOnSurface=b.pointsOfInterest.centerOnSurfaceFrequent;a._handles.add(a._centerOnSurface.watch("renderLocation",
function(){return a._pointOfInterestChanged()}));var c=a.layerView.view.resourceController;c.memoryEvents.on("quality-changed",function(){return a._setCameraDirty()});a._handles.add(t.init(a.layerView,"suspended",function(b){a._idleFrameWorker&&(a._idleFrameWorker.remove(),a._idleFrameWorker=null,a.restartNodeLoading());a._frameWorker&&(a._frameWorker.remove(),a._frameWorker=null);b?a._idleFrameWorker=c.registerIdleFrameWorker(a.updateEventListenerWhileSuspended):(a._idleFrameWorker=c.registerIdleFrameWorker(a.updateEventListener),
a._frameWorker=c.registerFrameWorker(function(b){return a._frame(b)}))}),"layerview");a._handles.add(a.layer.watch("elevationInfo",function(b){return a._elevationInfoChanged(b)}),"layer");a.layerView instanceof C&&a._handles.add([t.init(a.layerView,"alwaysLoadEverythingModeEnabled",function(b){a._alwaysLoadEverythingModeEnabled=b;a.restartNodeLoading()}),t.init(a.layerView,"uncompressedTextureDownsamplingEnabled",function(b){a._uncompressedTextureDownsamplingEnabled=b;a.restartNodeLoading()})],"layer");
a._handles.add(b.state.watch("camera",function(){return a._setCameraDirty()}));a._handles.add(a.watch("featureTarget",function(){a._stableFeatureLOD=!1}));a._lodFactorProperty&&a._handles.add(a.layerView.view.watch(a._lodFactorProperty,function(){return a._setCameraDirty()}),"quality")}});this.addResolvingPromise(b);this.when(function(){return a._startNodeLoading()})};h.prototype.destroy=function(){this._idleFrameWorker&&(this._idleFrameWorker.remove(),this._idleFrameWorker=null);this._frameWorker&&
(this._frameWorker.remove(),this._frameWorker=null);this._handles.destroy();this._nodeLoader=null};h.prototype._getRequiredAttributes=function(){if(!(null!=this._attributeStorageInfo&&this.layer instanceof y&&this._fields))return[];var a=Object.create(null);this.layer.renderer&&this.layer.renderer.collectRequiredFields(a);this.layer.labelsVisible&&this.layer.labelingInfo&&this.layer.labelingInfo.forEach(function(b){b._collectRequiredFields(a)});if(null!=this.definitionExpressionFields)for(var b=0,
c=this.definitionExpressionFields;b<c.length;b++)a[c[b]]=!0;var d=this._attributeStorageInfo,e=this._fields,f=this.layer.objectIdField;return Object.keys(a).map(function(a){var b=P(d,a);a=P(e,a);return 0<=b&&0<=a?{index:b,name:e[a].name,field:e[a],attributeStorageInfo:d[b]}:null}).filter(function(a){return null!=a&&a.name!==f}).sort(function(a,b){return b.index-a.index}).filter(function(a,b,c){return 0===b||c[b-1].index!==a.index})};h.prototype._requiredFieldsChange=function(){this._requiredAttributesDirty=
!0;this.restartNodeLoading()};h.prototype._labelingChanged=function(){var a=this._requiredAttributes,b=this._getRequiredAttributes();O(a,b)||this._requiredFieldsChange()};h.prototype.setClippingArea=function(a){var b=v.create();I.extentToBoundingBox(a,b,this.layerView.view.renderSpatialReference)?this._clippingArea=b:this._clippingArea=null};h.prototype._pointOfInterestChanged=function(){this._poi&&(this._calculatePointOfInterest(this._poi),this._viewportQueries&&(this._viewportQueries.updatePointOfInterest(this._poi),
this._index&&(this._index.progressiveLoadPenalty=N.distancePenalty*this._viewportQueries.distCameraToPOI(),this._index.requestReload())))};h.prototype._calculatePointOfInterest=function(a){void 0===a&&(a=H.vec3d.create());var b=this._centerOnSurface.renderLocation,c=H.vec3d.create();H.vec3d.subtract(b,this.camPos,c);H.vec3d.normalize(c);var d=this.layerView.view.renderCoordsHelper,e=H.vec3d.create();d.worldUpAtPosition(b,e);c=Math.acos(H.vec3d.dot(e,c))-.5*Math.PI;H.vec3d.lerp(this.camPos,b,Math.max(0,
Math.min(1,c/(.5*Math.PI))),a);return a};h.prototype.updateClippingArea=function(a){this.setClippingArea(a);this._cameraDirty=!0;this._viewportQueries&&this._viewportQueries.updateExtent(this._clippingArea)};h.prototype._setCameraDirty=function(){this._cameraDirty=!0;this.updatingChanged()};h.prototype.getBaseUrl=function(){return this.layer.parsedUrl.path};h.prototype.updateElevationChanged=function(a,b,c){J.findIntersectingNodes(a,b,this.nodeIndex.root,this.crsIndex,this.nodeIndex,function(a){c.push(a)});
for(a=0;a<c.length;a++)b=c.data[a],this._viewportQueries.invalidateCache(b.id),b.id===this._rootNodeId&&this.notifyChange("rootNodeVisible");c.length&&this.restartNodeLoading()};h.prototype._elevationInfoChanged=function(a){this._viewportQueries.invalidateCache();this._initViewData()};h.prototype.restartNodeLoading=function(){this._restartNodeLoading=!0;this.updatingChanged()};h.prototype.schedule=function(a,c){var d=this;return this._idleQueue.push(c).then(function(c){if(!d._loadingNodes.has(a)&&
!d._updatingNodes.has(a))throw new b;return c})};h.prototype.getUnloadedMemoryEstimate=function(){return this._index?this._index.getUnloadedMemoryEstimate()*this._getLodDropFactor():0};h.prototype._frame=function(a){null!==this._viewportQueries&&this._viewportQueries.setCameraIdle(!this._cameraDirty);this.layerView.visible&&this._processLogError(a,!1)};h.prototype._processLogError=function(a,b){void 0===b&&(b=!0);try{this._process(a,b)}catch(Q){50>this._errorCount?L.error("Error during processing: "+
Q):50===this._errorCount&&L.error("Too many errors for this layer. Further errors will not be displayed."),this._errorCount++}};h.prototype._process=function(a,b){this._restartNodeLoading&&(this.cancelNodeLoading(),this._startNodeLoading());if(null!=this._nodeLoader&&null!=this._index){this._updateViewData()&&(b=!1);!this._processIndex()||!b&&a.done()||(b=!1);for(b=this._processNodes(a,b);0<this._idleQueue.length()&&(b||!a.done());)b=!1,this._idleQueue.process();this._updateFeatureLOD();a.done()||
this._prefetchIndex();this.updatingChanged();this._lodHandling.lodGlobalHandling()}};h.prototype._processIndex=function(){var a=Math.min(10-this._index.getIndexLoading(),this._getAvailableLoadTokens(1));this._index.update(f.keysOfSet(this._loadingNodes));var b=this._index.getFeatureEstimate().leafsReached;this._index.isLoading()||b===this._get("leafsReached")||this._set("leafsReached",b);return this._index.load(a)};h.prototype._prefetchIndex=function(){if(!(0<this._loadingNodes.size)){var a=Math.min(10-
this._index.getIndexLoading(),this._getAvailableLoadTokens(1));this._index.prefetch(a)}};h.prototype._updateFeatureLOD=function(){var a=this._index.getFeatureEstimate(),b=this.featureTarget*this._getLOD()/this._featureLOD;if(a.estimate){var c=!this._index.isLoading();if(!c&&!this._index.isPrefetching()&&500<this._index.getIndexMissing()){if(1E-4>=this._featureLOD)return;this._featureLOD/=1.5;this._stableFeatureLOD=!1}else if(c&&a.estimate<b){if(1E4<=this._featureLOD||a.leafsReached||this._stableFeatureLOD)return;
c=this._featureLOD;this._featureLOD*=1+Math.min(.1*(b/a.estimate-1),.1);if(!this._index.checkFeatureTarget(b,this._getLOD())){this._featureLOD=c;this._stableFeatureLOD=!0;return}}else if(a.estimate>1.2*b||c&&a.estimate>b){if(1E-4>=this._featureLOD)return;this._featureLOD/=1+.25*(a.estimate/b-1);this._stableFeatureLOD=!1}else return;this._featureLOD=Math.min(1E4,Math.max(1E-4,this._featureLOD));this._viewportQueries.updateScreenSpaceErrorBias(this._getLOD());this._index.requestReload()}};h.prototype._processNodes=
function(a,b){var c=this,d=this._index.getUpdates((this._isIdle?100:2)-this._loadingNodes.size);d.cancel.forEach(this._cancelNodeIdLoading,this);d.update.forEach(function(d){if(b||!a.done())b=!1,c._updateLoadedNode(d)});d.add.forEach(function(d){if(b||!a.done())b=!1,c._loadNode(d)});return b};h.prototype._cancelNodeLoading=function(){var a=this;this._loadingNodes.clear();this._downloadingNodes.clear();this._updatingNodes.forEach(function(b,c){return a._updatingNodes.get(c).cancel()});this._updatingNodes.clear()};
h.prototype._cancelNodeIdLoading=function(a){this._loadingNodes.delete(a);this._downloadingNodes.delete(a)};h.prototype._getAvailableLoadTokens=function(a){return Math.floor((12-1*this._index.getIndexLoading()-2*this._downloadingNodes.size)/a)};h.prototype._hasNodeLoadToken=function(){return this._downloadingNodes.size>=(this._isIdle?5:2)?!1:0<this._getAvailableLoadTokens(2)};h.prototype.updatingChanged=function(){var a=this._index?this._index.getIndexMissing():0,b=this._index?this._index.getNodesMissing():
0,a=a+3*b+2*this._loadingNodes.size,b=!(!(0<a||0<this._updatingNodes.size||this._index&&this._index.isPrefetching()||this._restartNodeLoading||this._cameraDirty||0<this._idleQueue.length()||this._lodHandling&&this._lodHandling.requiresLODGlobalHandling)&&this._isIdle);0===a&&(this._progressMaxNumNodes=1);this._progressMaxNumNodes=Math.max(a,this._progressMaxNumNodes);b!==this._get("updating")&&this._set("updating",b);a=100*a/this._progressMaxNumNodes;a!==this._get("updatingPercentage")&&this._set("updatingPercentage",
a)};h.prototype._initViewData=function(){var a=this.layerView.view,b=a.state.camera,c=a.renderCoordsHelper;this.camPos=H.vec3d.create(a.pointsOfInterest.renderPointOfView);this.screenSizeFactor=1/b.perPixelRatio;this._poi=this._calculatePointOfInterest();var d=this._getLOD();this._viewportQueries=new F(this.crsIndex,c,b,this._poi,this._clippingArea,a.elevationProvider,this.layer.elevationInfo,{progressiveLoadFactor:this._getProgressiveLoadFactor(this.layer,d),screenspaceErrorBias:d,angleDependentLoD:.5>
d,disableLod:this._alwaysLoadEverythingModeEnabled});this._cameraDirty=!1;this.notifyChange("rootNodeVisible")};h.prototype._updateViewData=function(){if(!this._cameraDirty||!this._index)return!1;var a=this.layerView.view,b=a.state.camera;this.camPos=H.vec3d.create(a.pointsOfInterest.renderPointOfView);this.screenSizeFactor=1/b.perPixelRatio;this._poi=this._calculatePointOfInterest(this._poi);this._viewportQueries.updateCamera(b);this._viewportQueries.updatePointOfInterest(this._poi);a=this._getLOD();
this._viewportQueries.updateScreenSpaceErrorBias(a);this._index.progressiveLoadPenalty=N.distancePenalty*this._viewportQueries.distCameraToPOI();this._index.requestReload();this._stableFeatureLOD=!1;a=!this._alwaysLoadEverythingModeEnabled&&this._removeInvisibleNodes();this._cameraDirty=!1;this.notifyChange("rootNodeVisible");return a};h.prototype._getProgressiveLoadFactor=function(a,b){return a instanceof y&&"mesh"===a.geometryType?(a=1<=b&&d("enable-feature:progressive-3dobject"))?N.factor3dObject:
1:a instanceof A?(a=1<=b&&!d("disable-feature:progressive-im"))?N.factorIM:1:1};h.prototype._getLOD=function(){return(this._lodFactorProperty&&this.layerView.view.get(this._lodFactorProperty)||1)*this.layerView.view.resourceController.memoryFactor*this._featureLOD};h.prototype._getLodDropFactor=function(){return Math.min(this.layerView.view.resourceController.memoryFactor,.5)/.5};h.prototype._startNodeLoadingWhileSuspended=function(){this._initViewData();this._alwaysLoadEverythingModeEnabled&&this.layerView.visible&&
!this.layerView.get("parent.suspended")||this._removeInvisibleNodes()};h.prototype.isGeometryVisible=function(a){return this._viewportQueries.isGeometryVisible(a)};h.prototype.updateVisibility=function(a){return this._viewportQueries.updateNode(a)};h.prototype._shouldLoadNode=function(a){if(!this._lodHandling.shouldLoadNode(a))return!1;var b=this._getLodDropFactor();return 0<b&&0<this._viewportQueries.maxDistance&&this._lodHandling.childrenEmpty(a)&&this._viewportQueries.distToPOI(a)>this._viewportQueries.maxDistance*
b?!1:a.obb?this._viewportQueries.isGeometryVisible(a):!0};h.prototype._startNodeLoading=function(){var a=this;this._restartNodeLoading=!1;if(!this._updatesDisabled&&null!=this.streamDataSupplier){this._initViewData();this._requiredAttributesDirty&&(this._requiredAttributes=this._getRequiredAttributes(),this._requiredAttributesDirty=!1,this._handles.add([this.layer.watch("renderer",function(){return a._requiredFieldsChange()}),this.layer.watch("definitionExpression",function(){return a._requiredFieldsChange()}),
this.layer.watch("labelsVisible",function(){return a._labelingChanged()}),this.layer.watch("labelingInfo",function(){return a._labelingChanged()})],"requiredAttributes"));var b=this.layerViewOptionalFunctions.textureOptions,c=E.TextureFormat.Normal;b&&b.useCompressedTextures?c=E.TextureFormat.Compressed:this._uncompressedTextureDownsamplingEnabled&&(c=E.TextureFormat.Downsampled);b=this._defaultGeometrySchema;this._nodeLoader=new E(this.streamDataSupplier,L,b,this._requiredAttributes,{textureFormat:c,
loadTextureData:this.layerView instanceof C&&this.layerView.rendererNeedsTextures,loadFeatureData:!this.isMeshPyramid||null==b||null==b.ordering});c=N.distancePenalty*this._viewportQueries.distCameraToPOI();this._index=new B(this.getBaseUrl(),this._rootNodeUrl,this._rootNodeId,c,this.nodeIndex,this.streamDataSupplier,this._viewportQueries,L,function(b){return a.layerViewRequiredFunctions.isNodeLoaded(b)},function(b){return a._shouldLoadNode(b)},function(b){return a._needsUpdate(b)});this._alwaysLoadEverythingModeEnabled||
this._removeInvisibleNodes();this._lodHandling.startNodeLoading(function(b){return a._viewportQueries.isNodeVisible(b)},function(b){return a._viewportQueries.isGeometryVisible(b)},function(b){return a._index.nodeTraversalState(b)},this.nodeIndex,this._rootNodeId,{maxLodLevel:this._viewportQueries.maxLodLevel});this.updatingChanged()}};h.prototype.isNodeLoading=function(){return null!=this._nodeLoader&&null!=this._index};h.prototype.cancelNodeLoading=function(){this.isNodeLoading()&&(this._nodeLoader.cancelAll(),
this.streamDataSupplier.cancelAll(),this._idleQueue.cancelAll(),this._cancelNodeLoading(),this._poi=this._index=this._nodeLoader=null,this.layerViewOptionalFunctions.additionalCancelNodeLoadingHandler&&this.layerViewOptionalFunctions.additionalCancelNodeLoadingHandler(),this.updatingChanged())};h.prototype._removeInvisibleNodes=function(){var a=this.layerViewRequiredFunctions.getLoadedNodeIDs(),b=this._getLodDropFactor(),c=this._viewportQueries.maxDistance*b,b=0<b&&0<c;U.clear();for(var d=0;d<a.length;d++){var e=
this.nodeIndex[a[d]];if(!this._viewportQueries.isGeometryVisible(e)||b&&this._lodHandling.childrenEmpty(e)&&this._viewportQueries.distToPOI(e)>c)this._lodHandling.setLodGlobalDirty(),U.push(e)}return 0<U.length?(this.layerViewRequiredFunctions.removeNodeData(U),U.clear(),!0):!1};h.prototype._needsUpdate=function(a){if(null==a.featureData||0===a.featureData.length||this._updatingNodes.has(a.id))return!1;a=this.layerViewRequiredFunctions.getLoadedAttributes(a);return null!=a&&a!==this._requiredAttributes};
h.prototype._updateLoadedNode=function(a){var c=this,d=a.baseUrl,e=this.layerViewRequiredFunctions.getLoadedAttributes(a),d=O(e,this._requiredAttributes)?r.resolve(this.layerViewRequiredFunctions.getAttributeData(a)):this._nodeLoader.loadAttributes(a,d,this._requiredAttributes);this._updatingNodes.set(a.id,d);d.then(function(b){return c.schedule(a.id).then(function(){return c.layerViewRequiredFunctions.setAttributeData(a,c._requiredAttributes,b)})}).catch(function(d){d instanceof b||c.layerViewRequiredFunctions.setAttributeData(a,
c._requiredAttributes,{})}).always(function(){c._updatingNodes.delete(a.id);c.updatingChanged()});this.updatingChanged()};h.prototype._loadNode=function(a){var b=this;if(!a.notInCache||this._hasNodeLoadToken())this._loadingNodes.add(a.id),this.updatingChanged(),this._loadAndAddBundle(a).always(function(){b._loadingNodes.delete(a.id);b._hasFeatures=b._hasFeatures||!!a.numFeatures;b.updatingChanged()})};h.prototype._loadAndAddBundle=function(a){1!==a.featureData.length&&L.warn("Node ${node.id} has ${node.featureData.length} bundles. Only the first bundle will be loaded.");
return a.notInCache?this._loadUncached(a):this._loadCached(a).then(function(b){b||(a.notInCache=!0)}).catch(function(c){c instanceof b||(a.notInCache=!0)})};h.prototype._loadCached=function(a){var b=this,c=this.disableCache?null:this.layerViewOptionalFunctions.loadCachedNodeData,d=this.disableCache?null:this.layerViewOptionalFunctions.addCachedNodeData;return c&&d?this.schedule(a.id).then(function(){return c(a,function(a,c){return b._nodeLoader.loadTextures(a,c)})}).then(function(c){if(null==c)return!1;
var e=b._requiredAttributes;return null!=c.loadedAttributes&&null!=c.attributeData&&O(c.loadedAttributes,e)?b.schedule(a.id).then(function(){return d(a,c,c)}).then(function(){b._lodHandling.lodSwapBundleLoaded(a);return!0}):b.schedule(a.id).then(function(){return b._nodeLoader.loadAttributes(a,a.baseUrl,e)}).then(function(c){return b.schedule(a.id,{loadedAttributes:e,attributeData:c})}).then(function(b){return d(a,c,b)}).then(function(){b._lodHandling.lodSwapBundleLoaded(a);return!0})}):r.resolve(!1)};
h.prototype._loadUncached=function(a){var c=this;this._downloadingNodes.add(a.id);return this._nodeLoader.loadBundleData(a,0).then(function(b){c._downloadingNodes.delete(a.id);return c.schedule(a.id,b)}).then(function(b){return c.layerViewRequiredFunctions.addNodeData(a,b)}).then(function(){c._lodHandling.lodSwapBundleLoaded(a);a.notInCache=!1}).catch(function(c){c instanceof b||(L.error("Failed to load node '"+a.id+"' bundle 0: "+c),a.failed=!0)})};h.prototype._updateIdleState=function(a){a!==this._isIdle&&
(this._isIdle=a,this._viewportQueries&&this._viewportQueries.setCameraIdle(!0),this.updatingChanged())};h.prototype.updateStats=function(a){a.index=Object.keys(this.nodeIndex).length;this._hasFeatures&&(a.detail=this._featureLOD,a.target=Math.round(this.featureTarget*this._getLOD()/this._featureLOD));this._index&&this._index.updateStats(a)};a([u.property({readOnly:!0})],h.prototype,"isMeshPyramid",null);a([u.property({readOnly:!0})],h.prototype,"streamDataSupplier",null);a([u.property({readOnly:!0,
dependsOn:["layer.definitionExpression"]})],h.prototype,"parsedDefinitionExpression",null);a([u.property({readOnly:!0,dependsOn:["parsedDefinitionExpression"]})],h.prototype,"definitionExpressionFields",null);a([u.property({readOnly:!0})],h.prototype,"crsVertex",null);a([u.property({readOnly:!0})],h.prototype,"crsIndex",null);a([u.property({readOnly:!0})],h.prototype,"nodeIndex",void 0);a([u.property()],h.prototype,"camPos",void 0);a([u.property()],h.prototype,"screenSizeFactor",void 0);a([u.property()],
h.prototype,"featureTarget",void 0);a([u.property()],h.prototype,"layerView",void 0);a([u.property()],h.prototype,"layerViewRequiredFunctions",void 0);a([u.property()],h.prototype,"layerViewOptionalFunctions",void 0);a([u.property()],h.prototype,"layer",void 0);a([u.property({readOnly:!0})],h.prototype,"updating",void 0);a([u.property({readOnly:!0})],h.prototype,"updatingPercentage",void 0);a([u.property({readOnly:!0})],h.prototype,"leafsReached",void 0);a([u.property({readOnly:!0})],h.prototype,
"rootNodeVisible",null);return h=a([u.subclass("esri.layers.graphics.controllers.I3SOnDemandController")],h)}(u.declared(c,m,k));var U=new p,N={factorIM:.2,factor3dObject:.05,distancePenalty:10};return q})},"esri/core/sql/WhereClause":function(){define(["require","exports","../../moment","./StandardizedFunctions","./WhereGrammar"],function(q,h,e,a,d){function b(a){return Array.isArray(a)?a:[a]}function g(a){return null!==a?!0!==a:null}function c(a,b){if(null==a)return null;for(var c=!1,d=0;d<b.length;d++){var e=
b[d];if(null==e)c=null;else if(a===e){c=!0;break}}return c}function f(a,b,c){if(null==a)return null;for(var d="",e=0,f=0;f<b.length;f++){var g=b.charAt(f);switch(e){case 0:g===c?e=1:d=0<="-[]/{}()*+?.\\^$|".indexOf(g)?d+("\\"+g):"%"===g?d+".*":"_"===g?d+".":d+g;break;case 1:d=0<="-[]/{}()*+?.\\^$|".indexOf(g)?d+("\\"+g):d+g,e=0}}return(new RegExp("^"+d+"$")).test(a)}function k(a){return a instanceof Date?a.valueOf():a}function n(a,b,c){if(null==b||null==c)return null;b=k(b);c=k(c);switch(a){case "\x3c\x3e":return b!==
c;case "\x3d":return b===c;case "\x3e":return b>c;case "\x3c":return b<c;case "\x3e\x3d":return b>=c;case "\x3c\x3d":return b<=c}}function l(a){for(var b=[],c={},d=0;d<a.length;d++){var e=a[d],f=e.toLowerCase();void 0===c[f]&&(b.push(e),c[f]=1)}return b}return function(){function h(){this.parameters=this.parseTree=null}h.create=function(a){var b=new h;b.parseTree=d.WhereGrammar.parse(a);return b};h.prototype.isStandardized=function(){var b=!0;this.visitAll(this.parseTree,function(c){b&&"function"===
c.type&&(b=a.isStandardized(c.name,c.args.value.length))});return b};h.prototype.setVariablesDictionary=function(a){this.parameters=a};h.prototype.testFeature=function(a){return!!this.evaluateNode(this.parseTree,a)};h.prototype.calculateValue=function(a){return this.evaluateNode(this.parseTree,a)};h.prototype.getFunctions=function(){var a=[];this.visitAll(this.parseTree,function(b){"function"===b.type&&a.push(b.name.toLowerCase())});return l(a)};h.prototype.getFields=function(){var a=[];this.visitAll(this.parseTree,
function(b){"column_ref"===b.type&&a.push(b.column)});return l(a)};h.prototype.getVariables=function(){var a=[];this.visitAll(this.parseTree,function(b){"param"===b.type&&a.push(b.value.toLowerCase())});return l(a)};h.prototype.featureValue=function(a,b,c){a=a&&"object"===typeof a.attributes?a.attributes:a;var d=a[b];if(void 0!==d)return d;for(var e in a)if(b.toLowerCase()===e.toLowerCase())return c.column=e,a[e];return null};h.prototype.visitAll=function(a,b){if(null!=a)switch(b(a),a.type){case "when_clause":this.visitAll(a.operand,
b);this.visitAll(a.value,b);break;case "case_expression":for(var c=0,d=a.clauses;c<d.length;c++){var e=d[c];this.visitAll(e,b)}"simple"===a.format&&this.visitAll(a.operand,b);null!==a.else&&this.visitAll(a.else,b);break;case "expr_list":c=0;for(a=a.value;c<a.length;c++)e=a[c],this.visitAll(e,b);break;case "unary_expr":this.visitAll(a.expr,b);break;case "binary_expr":this.visitAll(a.left,b);this.visitAll(a.right,b);break;case "function":this.visitAll(a.args,b)}};h.prototype.evaluateNode=function(d,
h){switch(d.type){case "case_expression":if("simple"===d.format)for(var l=k(this.evaluateNode(d.operand,h)),m=0;m<d.clauses.length;m++){if(l===k(this.evaluateNode(d.clauses[m].operand,h)))return this.evaluateNode(d.clauses[m].value,h)}else for(m=0;m<d.clauses.length;m++)if(!0===this.evaluateNode(d.clauses[m].operand,h))return this.evaluateNode(d.clauses[m].value,h);return null!==d.else?this.evaluateNode(d.else,h):null;case "param":return this.parameters[d.value.toLowerCase()];case "expr_list":l=[];
m=0;for(d=d.value;m<d.length;m++){var p=d[m];l.push(this.evaluateNode(p,h))}return l;case "unary_expr":return g(this.evaluateNode(d.expr,h));case "binary_expr":switch(d.operator){case "AND":return l=this.evaluateNode(d.left,h),h=this.evaluateNode(d.right,h),null!=l&&null!=h?!0===l&&!0===h:!1===l||!1===h?!1:null;case "OR":return l=this.evaluateNode(d.left,h),h=this.evaluateNode(d.right,h),null!=l&&null!=h?!0===l||!0===h:!0===l||!0===h?!0:null;case "IS":if("null"!==d.right.type)throw Error("Unsupported RHS for IS");
return null===this.evaluateNode(d.left,h);case "ISNOT":if("null"!==d.right.type)throw Error("Unsupported RHS for IS");return null!==this.evaluateNode(d.left,h);case "IN":return l=b(this.evaluateNode(d.right,h)),c(this.evaluateNode(d.left,h),l);case "NOT IN":return l=b(this.evaluateNode(d.right,h)),g(c(this.evaluateNode(d.left,h),l));case "BETWEEN":return l=this.evaluateNode(d.left,h),h=this.evaluateNode(d.right,h),null==l||null==h[0]||null==h[1]?null:l>=h[0]&&l<=h[1];case "NOTBETWEEN":return l=this.evaluateNode(d.left,
h),h=this.evaluateNode(d.right,h),null==l||null==h[0]||null==h[1]?null:l<h[0]||l>h[1];case "LIKE":return f(this.evaluateNode(d.left,h),this.evaluateNode(d.right,h),d.escape);case "NOT LIKE":return g(f(this.evaluateNode(d.left,h),this.evaluateNode(d.right,h),d.escape));case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return n(d.operator,this.evaluateNode(d.left,h),this.evaluateNode(d.right,h));case "*":return this.evaluateNode(d.left,h)*this.evaluateNode(d.right,
h);case "-":return this.evaluateNode(d.left,h)-this.evaluateNode(d.right,h);case "+":return this.evaluateNode(d.left,h)+this.evaluateNode(d.right,h);case "/":return this.evaluateNode(d.left,h)/this.evaluateNode(d.right,h)}throw Error("Not Supported Operator "+d.operator);case "null":case "bool":case "string":case "number":return d.value;case "date":return e(d.value,["YYYY-M-D"]).toDate();case "timestamp":return e(d.value,["YYYY-M-D H:m:s","YYYY-M-D H:mZ","YYYY-M-D H:m:sZ","YYYY-M-D H:m","YYYY-m-d"]).toDate();
case "column_ref":return"CURRENT_DATE"===d.column.toUpperCase()?(p=new Date,p.setHours(0,0,0,0),p):"CURRENT_TIMESTAMP"===d.column.toUpperCase()?new Date:this.featureValue(h,d.column,d);case "function":return h=this.evaluateNode(d.args,h),a.evaluateFunction(d.name,h)}throw Error("Unsupported sql syntax "+d.type);};return h}()})},"esri/core/sql/StandardizedFunctions":function(){define(["require","exports","dojo/regexp"],function(q,h,e){Object.defineProperty(h,"__esModule",{value:!0});h.evaluateFunction=
function(d,b){var e=a[d.toLowerCase()];if(null==e)throw Error("Function Not Recognised");if(b.length<e.minParams||b.length>e.maxParams)throw Error("Invalid Parameter count for call to "+d.toUpperCase());return e.evaluate(b)};h.isStandardized=function(d,b){d=a[d.toLowerCase()];return null!=d&&b>=d.minParams&&b<=d.maxParams};var a={extract:{minParams:2,maxParams:2,evaluate:function(a){var b=a[0];a=a[1];if(null==a)return null;if(a instanceof Date)switch(b.toUpperCase()){case "SECOND":return a.getSeconds();
case "MINUTE":return a.getMinutes();case "HOUR":return a.getHours();case "DAY":return a.getDate();case "MONTH":return a.getMonth()+1;case "YEAR":return a.getFullYear()}throw Error("Invalid Parameter for call to EXTRACT");}},substring:{minParams:2,maxParams:3,evaluate:function(a){if(2===a.length){var b=a[0],d=a[1];return null==b||null==d?null:b.toString().substring(d-1)}if(3===a.length)return b=a[0],d=a[1],a=a[2],null==b||null==d||null==a?null:0>=a?"":b.toString().substring(d-1,d+a-1)}},position:{minParams:2,
maxParams:2,evaluate:function(a){var b=a[0];a=a[1];return null==b||null==a?null:a.indexOf(b)+1}},trim:{minParams:2,maxParams:3,evaluate:function(a){var b=3===a.length,d=b?a[1]:" ",b=b?a[2]:a[1];if(null==d||null==b)return null;d="("+e.escapeString(d)+")";switch(a[0]){case "BOTH":return b.replace(new RegExp("^"+d+"*|"+d+"*$","g"),"");case "LEADING":return b.replace(new RegExp("^"+d+"*","g"),"");case "TRAILING":return b.replace(new RegExp(d+"*$","g"),"")}throw Error("Invalid Parameter for call to TRIM");
}},abs:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.abs(a[0])}},ceiling:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.ceil(a[0])}},floor:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.floor(a[0])}},log:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.log(a[0])}},log10:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.log(a[0])*Math.LOG10E}},sin:{minParams:1,maxParams:1,
evaluate:function(a){return null==a[0]?null:Math.sin(a[0])}},cos:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.cos(a[0])}},tan:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.tan(a[0])}},asin:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.asin(a[0])}},acos:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.acos(a[0])}},atan:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.atan(a[0])}},
sign:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:0<a[0]?1:0>a[1]?-1:0}},power:{minParams:2,maxParams:2,evaluate:function(a){return null==a[0]||null==a[1]?null:Math.pow(a[0],a[1])}},mod:{minParams:2,maxParams:2,evaluate:function(a){return null==a[0]||null==a[1]?null:a[0]%a[1]}},round:{minParams:1,maxParams:2,evaluate:function(a){var b=a[0];a=2===a.length?Math.pow(10,a[1]):1;return null==b?null:Math.round(b*a)/a}},truncate:{minParams:1,maxParams:2,evaluate:function(a){return null==
a[0]?null:1===a.length?parseInt(a[0].toFixed(0),10):parseFloat(a[0].toFixed(a[1]))}},char_length:{minParams:1,maxParams:1,evaluate:function(a){return"string"===typeof a[0]||a[0]instanceof String?a[0].length:0}},concat:{minParams:1,maxParams:Infinity,evaluate:function(a){for(var b="",d=0;d<a.length;d++){if(null==a[d])return null;b+=a[d].toString()}return b}},lower:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:a[0].toString().toLowerCase()}},upper:{minParams:1,maxParams:1,evaluate:function(a){return null==
a[0]?null:a[0].toString().toUpperCase()}}}})},"esri/core/sql/WhereGrammar":function(){define(["require","exports","./sql92grammar"],function(q,h,e){Object.defineProperty(h,"__esModule",{value:!0});q=function(){function a(){}a.parse=function(a){return e.parse(a)};return a}();h.WhereGrammar=q})},"esri/core/sql/sql92grammar":function(){define([],function(){function q(h,e,a,d){this.message=h;this.expected=e;this.found=a;this.location=d;this.name="SyntaxError";"function"===typeof Error.captureStackTrace&&
Error.captureStackTrace(this,q)}(function(h,e){function a(){this.constructor=h}a.prototype=e.prototype;h.prototype=new a})(q,Error);q.buildMessage=function(h,e){function a(a){return a.charCodeAt(0).toString(16).toUpperCase()}function d(b){return b.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(b){return"\\x0"+a(b)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(b){return"\\x"+a(b)})}function b(b){return b.replace(/\\/g,
"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(b){return"\\x0"+a(b)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(b){return"\\x"+a(b)})}var g={literal:function(a){return'"'+d(a.text)+'"'},"class":function(a){var c="",d;for(d=0;d<a.parts.length;d++)c+=a.parts[d]instanceof Array?b(a.parts[d][0])+"-"+b(a.parts[d][1]):b(a.parts[d]);return"["+(a.inverted?"^":"")+c+"]"},
any:function(a){return"any character"},end:function(a){return"end of input"},other:function(a){return a.description}};return"Expected "+function(a){var b=Array(a.length),c;for(c=0;c<a.length;c++){var d=c,e;e=a[c];e=g[e.type](e);b[d]=e}b.sort();if(0<b.length){for(a=c=1;c<b.length;c++)b[c-1]!==b[c]&&(b[a]=b[c],a++);b.length=a}switch(b.length){case 1:return b[0];case 2:return b[0]+" or "+b[1];default:return b.slice(0,-1).join(", ")+", or "+b[b.length-1]}}(h)+" but "+(e?'"'+d(e)+'"':"end of input")+" found."};
return{SyntaxError:q,parse:function(h,e){function a(a,b){return{type:"literal",text:a,ignoreCase:b}}function d(a,b,c){return{type:"class",parts:a,inverted:b,ignoreCase:c}}function b(a){var b=Ta[a],c;if(!b){for(c=a-1;!Ta[c];)c--;b=Ta[c];for(b={line:b.line,column:b.column};c<a;)10===h.charCodeAt(c)?(b.line++,b.column=1):b.column++,c++;Ta[a]=b}return b}function g(a,c){var d=b(a),e=b(c);return{start:{offset:a,line:d.line,column:d.column},end:{offset:c,line:e.line,column:e.column}}}function c(a){z<ya||
(z>ya&&(ya=z,mb=[]),mb.push(a))}function f(){var a,b,c;a=z;b=W();b!==w?(b=n(),b!==w?(c=W(),c!==w?a=b:(z=a,a=w)):(z=a,a=w)):(z=a,a=w);return a}function k(){var a,b,c,d,e,f,g,h;a=z;b=n();if(b!==w){c=[];d=z;e=W();e!==w?(f=ga(),f!==w?(g=W(),g!==w?(h=n(),h!==w?d=e=[e,f,g,h]:(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w);for(;d!==w;)c.push(d),d=z,e=W(),e!==w?(f=ga(),f!==w?(g=W(),g!==w?(h=n(),h!==w?d=e=[e,f,g,h]:(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w);if(c!==w){a={type:"expr_list"};b=[b];for(d=0;d<c.length;d++)b.push(c[d][3]);
a.value=b}else z=a,a=w}else z=a,a=w;return a}function n(){var a,b,c,d,e,f,g,h;a=z;b=l();if(b!==w){c=[];d=z;e=W();e!==w?(f=X(),f!==w?(g=W(),g!==w?(h=l(),h!==w?d=e=[e,f,g,h]:(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w);for(;d!==w;)c.push(d),d=z,e=W(),e!==w?(f=X(),f!==w?(g=W(),g!==w?(h=l(),h!==w?d=e=[e,f,g,h]:(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w);c!==w?a=b=la(b,c):(z=a,a=w)}else z=a,a=w;return a}function l(){var a,b,c,d,e,f,g,h;a=z;b=p();if(b!==w){c=[];d=z;e=W();e!==w?(f=G(),f!==w?(g=W(),g!==w?(h=
p(),h!==w?d=e=[e,f,g,h]:(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w);for(;d!==w;)c.push(d),d=z,e=W(),e!==w?(f=G(),f!==w?(g=W(),g!==w?(h=p(),h!==w?d=e=[e,f,g,h]:(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w);c!==w?a=b=la(b,c):(z=a,a=w)}else z=a,a=w;return a}function p(){var a,b,d,e,f;a=z;b=Q();b===w&&(b=z,33===h.charCodeAt(z)?(d=sa,z++):(d=w,0===Y&&c(Sa)),d!==w?(e=z,Y++,61===h.charCodeAt(z)?(f=Ga,z++):(f=w,0===Y&&c(va)),Y--,f===w?e=void 0:(z=e,e=w),e!==w?b=d=[d,e]:(z=b,b=w)):(z=b,b=w));b!==w?(d=W(),d!==
w?(e=p(),e!==w?a=b={type:"unary_expr",operator:"NOT",expr:e}:(z=a,a=w)):(z=a,a=w)):(z=a,a=w);if(a===w)if(a=z,b=u(),b!==w)if(d=W(),d!==w){var g,l,n;d=[];e=z;f=W();f!==w?(g=m(),g!==w?(l=W(),l!==w?(n=u(),n!==w?e=f=[f,g,l,n]:(z=e,e=w)):(z=e,e=w)):(z=e,e=w)):(z=e,e=w);if(e!==w)for(;e!==w;)d.push(e),e=z,f=W(),f!==w?(g=m(),g!==w?(l=W(),l!==w?(n=u(),n!==w?e=f=[f,g,l,n]:(z=e,e=w)):(z=e,e=w)):(z=e,e=w)):(z=e,e=w);else d=w;d!==w&&(d={type:"arithmetic",tail:d});d===w&&(d=z,e=t(),e!==w?(f=W(),f!==w?(f=ja(),f!==
w?(f=W(),f!==w?(f=k(),f!==w?(g=W(),g!==w?(g=ha(),g!==w?d=e={op:e,right:f}:(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w),d===w&&(d=z,e=t(),e!==w?(f=W(),f!==w?(f=ja(),f!==w?(f=W(),f!==w?(f=ha(),f!==w?d=e={op:e,right:{type:"expr_list",value:[]}}:(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w),d===w&&(d=z,e=t(),e!==w?(f=W(),f!==w?(f=J(),f!==w?d=e={op:e,right:f}:(z=d,d=w)):(z=d,d=w)):(z=d,d=w))),d===w&&(d=z,f=Q(),f!==w?(e=W(),e!==w?(e=Z(),e!==w?(g=W(),g!==w?(g=u(),g!==
w?(l=W(),l!==w?(l=G(),l!==w?(f=W(),f!==w?(f=u(),f!==w?d=f={op:"NOT"+e,right:{type:"expr_list",value:[g,f]}}:(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w),d===w&&(d=z,f=Z(),f!==w?(e=W(),e!==w?(e=u(),e!==w?(g=W(),g!==w?(g=G(),g!==w?(l=W(),l!==w?(l=u(),l!==w?d=f={op:f,right:{type:"expr_list",value:[e,l]}}:(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w)),d===w&&(d=z,e=V(),e!==w?(f=W(),f!==w?(f=Q(),f!==w?(f=W(),f!==w?(f=u(),
f!==w?d=e={op:e+"NOT",right:f}:(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w),d===w&&(d=z,e=V(),e!==w?(f=W(),f!==w?(f=u(),f!==w?d=e={op:e,right:f}:(z=d,d=w)):(z=d,d=w)):(z=d,d=w)),d===w&&(d=z,e=r(),e!==w?(f=W(),f!==w?(f=M(),f!==w?(g=W(),g!==w?(g=z,h.substr(z,6).toLowerCase()===dd?(l=h.substr(z,6),z+=6):(l=w,0===Y&&c(ed)),l!==w?(l=z,Y++,n=D(),Y--,n===w?l=void 0:(z=l,l=w),l!==w?g="ESCAPE":(z=g,g=w)):(z=g,g=w),g!==w?(g=W(),g!==w?(g=H(),g!==w?d=e={op:e,right:f,escape:g.value}:(z=d,d=w)):(z=d,d=
w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w),d===w&&(d=z,e=r(),e!==w?(f=W(),f!==w?(f=M(),f!==w?d=e={op:e,right:f,escape:""}:(z=d,d=w)):(z=d,d=w)):(z=d,d=w))))));d===w&&(d=null);d!==w?(a=b,b=d,""==b||void 0==b||null==b?b=a:(d=null,b=d="arithmetic"==b.type?la(a,b.tail):ka(b.op,a,b.right,b.escape)),a=b):(z=a,a=w)}else z=a,a=w;else z=a,a=w;return a}function m(){var a;h.substr(z,2)===wa?(a=wa,z+=2):(a=w,0===Y&&c(hb));a===w&&(62===h.charCodeAt(z)?(a=vb,z++):(a=w,0===Y&&c(Ha)),a===w&&(h.substr(z,
2)===wb?(a=wb,z+=2):(a=w,0===Y&&c(Ka)),a===w&&(h.substr(z,2)===La?(a=La,z+=2):(a=w,0===Y&&c(xb)),a===w&&(60===h.charCodeAt(z)?(a=Fa,z++):(a=w,0===Y&&c(Qb)),a===w&&(61===h.charCodeAt(z)?(a=Ga,z++):(a=w,0===Y&&c(va)),a===w&&(h.substr(z,2)===yb?(a=yb,z+=2):(a=w,0===Y&&c(Rb))))))));return a}function r(){var a,b,c,d;a=a=z;b=Q();b!==w?(c=W(),c!==w?(d=T(),d!==w?a=b=[b,c,d]:(z=a,a=w)):(z=a,a=w)):(z=a,a=w);a!==w&&(a=a[0]+" "+a[2]);a===w&&(a=T());return a}function t(){var a,b,c,d;a=a=z;b=Q();b!==w?(c=W(),c!==
w?(d=aa(),d!==w?a=b=[b,c,d]:(z=a,a=w)):(z=a,a=w)):(z=a,a=w);a!==w&&(a=a[0]+" "+a[2]);a===w&&(a=aa());return a}function u(){var a,b,c,d,e,f,g,h;a=z;b=v();if(b!==w){c=[];d=z;e=W();e!==w?(f=x(),f!==w?(g=W(),g!==w?(h=v(),h!==w?d=e=[e,f,g,h]:(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w);for(;d!==w;)c.push(d),d=z,e=W(),e!==w?(f=x(),f!==w?(g=W(),g!==w?(h=v(),h!==w?d=e=[e,f,g,h]:(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w);c!==w?a=b=la(b,c):(z=a,a=w)}else z=a,a=w;return a}function x(){var a;43===h.charCodeAt(z)?
(a=Ab,z++):(a=w,0===Y&&c(ib));a===w&&(45===h.charCodeAt(z)?(a=Bb,z++):(a=w,0===Y&&c(Na)));return a}function v(){var a,b,c,d,e,f,g,h;a=z;b=y();if(b!==w){c=[];d=z;e=W();e!==w?(f=A(),f!==w?(g=W(),g!==w?(h=y(),h!==w?d=e=[e,f,g,h]:(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w);for(;d!==w;)c.push(d),d=z,e=W(),e!==w?(f=A(),f!==w?(g=W(),g!==w?(h=y(),h!==w?d=e=[e,f,g,h]:(z=d,d=w)):(z=d,d=w)):(z=d,d=w)):(z=d,d=w);c!==w?a=b=la(b,c):(z=a,a=w)}else z=a,a=w;return a}function A(){var a;42===h.charCodeAt(z)?(a=pa,z++):
(a=w,0===Y&&c(zb));a===w&&(47===h.charCodeAt(z)?(a=Sb,z++):(a=w,0===Y&&c(Tb)));return a}function y(){var a,b,d,e,f,g,l;l=H();if(l===w){var m,p,u,r;m=z;var t,v,q,x;t=z;v=P();v!==w?(q=L(),q!==w?(x=U(),x!==w?t=v=parseFloat(v+q+x):(z=t,t=w)):(z=t,t=w)):(z=t,t=w);t===w&&(t=z,v=P(),v!==w?(q=L(),q!==w?t=v=parseFloat(v+q):(z=t,t=w)):(z=t,t=w),t===w&&(t=z,v=P(),v!==w?(q=U(),q!==w?t=v=parseFloat(v+q):(z=t,t=w)):(z=t,t=w),t===w&&(t=z,v=P(),v!==w&&(v=parseFloat(v)),t=v)));p=t;p!==w?(u=z,Y++,r=B(),Y--,r===w?u=
void 0:(z=u,u=w),u!==w?m=p={type:"number",value:p}:(z=m,m=w)):(z=m,m=w);l=m;if(l===w){var A,y;A=z;var Q,T,G,Ha;Q=z;h.substr(z,4).toLowerCase()===fd?(T=h.substr(z,4),z+=4):(T=w,0===Y&&c(gd));T!==w?(G=z,Y++,Ha=D(),Y--,Ha===w?G=void 0:(z=G,G=w),G!==w?Q=T=[T,G]:(z=Q,Q=w)):(z=Q,Q=w);y=Q;y!==w&&(y={type:"bool",value:!0});A=y;if(A===w){A=z;var X,Z,va,wb;X=z;h.substr(z,5).toLowerCase()===hd?(Z=h.substr(z,5),z+=5):(Z=w,0===Y&&c(id));Z!==w?(va=z,Y++,wb=D(),Y--,wb===w?va=void 0:(z=va,va=w),va!==w?X=Z=[Z,va]:
(z=X,X=w)):(z=X,X=w);y=X;y!==w&&(y={type:"bool",value:!1});A=y}l=A;if(l===w){var V,N,Ka,La,S;N=z;h.substr(z,4).toLowerCase()===jd?(Ka=h.substr(z,4),z+=4):(Ka=w,0===Y&&c(kd));Ka!==w?(La=z,Y++,S=D(),Y--,S===w?La=void 0:(z=La,La=w),La!==w?N=Ka=[Ka,La]:(z=N,N=w)):(z=N,N=w);V=N;V!==w&&(V={type:"null",value:null});l=V;if(l===w){var wa,vb,ba,xb;wa=z;var ca,hb,Ga,Qb;ca=z;h.substr(z,4).toLowerCase()===ld?(hb=h.substr(z,4),z+=4):(hb=w,0===Y&&c(md));hb!==w?(Ga=z,Y++,Qb=D(),Y--,Qb===w?Ga=void 0:(z=Ga,Ga=w),Ga!==
w?ca=hb="DATE":(z=ca,ca=w)):(z=ca,ca=w);vb=ca;vb!==w?(ba=W(),ba!==w?(xb=M(),xb!==w?wa=vb={type:"date",value:xb.value}:(z=wa,wa=w)):(z=wa,wa=w)):(z=wa,wa=w);l=wa;if(l===w){var Fa,ga,yb,la;Fa=z;var ka,na,Na,Rb;ka=z;h.substr(z,9).toLowerCase()===nd?(na=h.substr(z,9),z+=9):(na=w,0===Y&&c(od));na!==w?(Na=z,Y++,Rb=D(),Y--,Rb===w?Na=void 0:(z=Na,Na=w),Na!==w?ka=na="TIMESTAMP":(z=ka,ka=w)):(z=ka,ka=w);ga=ka;ga!==w?(yb=W(),yb!==w?(la=M(),la!==w?Fa=ga={type:"timestamp",value:la.value}:(z=Fa,Fa=w)):(z=Fa,Fa=
w)):(z=Fa,Fa=w);l=Fa}}}}}a=l;if(a===w){var pa,zb,ta,Bb,sa,ib,Sa,Ab,Sb,Cb,Ja,ya;pa=z;var Ma,kb,db,Ob;Ma=z;h.substr(z,7).toLowerCase()===pd?(kb=h.substr(z,7),z+=7):(kb=w,0===Y&&c(qd));kb!==w?(db=z,Y++,Ob=D(),Y--,Ob===w?db=void 0:(z=db,db=w),db!==w?Ma=kb="EXTRACT":(z=Ma,Ma=w)):(z=Ma,Ma=w);zb=Ma;if(zb!==w)if(ta=W(),ta!==w)if(Bb=ja(),Bb!==w)if(sa=W(),sa!==w){var za,Ea,eb,Ra,Pb;Ea=z;h.substr(z,4).toLowerCase()===rd?(eb=h.substr(z,4),z+=4):(eb=w,0===Y&&c(sd));eb!==w?(Ra=z,Y++,Pb=D(),Y--,Pb===w?Ra=void 0:
(z=Ra,Ra=w),Ra!==w?Ea=eb="YEAR":(z=Ea,Ea=w)):(z=Ea,Ea=w);za=Ea;if(za===w){var Ua,ub,Qa,Ub;Ua=z;h.substr(z,5).toLowerCase()===td?(ub=h.substr(z,5),z+=5):(ub=w,0===Y&&c(ud));ub!==w?(Qa=z,Y++,Ub=D(),Y--,Ub===w?Qa=void 0:(z=Qa,Qa=w),Qa!==w?Ua=ub="MONTH":(z=Ua,Ua=w)):(z=Ua,Ua=w);za=Ua;if(za===w){var Va,lb,cb,Tb;Va=z;h.substr(z,3).toLowerCase()===vd?(lb=h.substr(z,3),z+=3):(lb=w,0===Y&&c(wd));lb!==w?(cb=z,Y++,Tb=D(),Y--,Tb===w?cb=void 0:(z=cb,cb=w),cb!==w?Va=lb="DAY":(z=Va,Va=w)):(z=Va,Va=w);za=Va;if(za===
w){var Wa,jb,Db,Ta;Wa=z;h.substr(z,4).toLowerCase()===xd?(jb=h.substr(z,4),z+=4):(jb=w,0===Y&&c(yd));jb!==w?(Db=z,Y++,Ta=D(),Y--,Ta===w?Db=void 0:(z=Db,Db=w),Db!==w?Wa=jb="HOUR":(z=Wa,Wa=w)):(z=Wa,Wa=w);za=Wa;if(za===w){var Xa,fb,Eb,gb;Xa=z;h.substr(z,6).toLowerCase()===zd?(fb=h.substr(z,6),z+=6):(fb=w,0===Y&&c(Ad));fb!==w?(Eb=z,Y++,gb=D(),Y--,gb===w?Eb=void 0:(z=Eb,Eb=w),Eb!==w?Xa=fb="MINUTE":(z=Xa,Xa=w)):(z=Xa,Xa=w);za=Xa;if(za===w){var Ya,Vb,Fb,mb;Ya=z;h.substr(z,6).toLowerCase()===Bd?(Vb=h.substr(z,
6),z+=6):(Vb=w,0===Y&&c(Cd));Vb!==w?(Fb=z,Y++,mb=D(),Y--,mb===w?Fb=void 0:(z=Fb,Fb=w),Fb!==w?Ya=Vb="SECOND":(z=Ya,Ya=w)):(z=Ya,Ya=w);za=Ya}}}}}ib=za;ib!==w?(Sa=W(),Sa!==w?(Ab=ea(),Ab!==w?(Sb=W(),Sb!==w?(Cb=n(),Cb!==w?(Ja=W(),Ja!==w?(ya=ha(),ya!==w?pa=zb={type:"function",name:"extract",args:{type:"expr_list",value:[{type:"string",value:ib},Cb]}}:(z=pa,pa=w)):(z=pa,pa=w)):(z=pa,pa=w)):(z=pa,pa=w)):(z=pa,pa=w)):(z=pa,pa=w)):(z=pa,pa=w)}else z=pa,pa=w;else z=pa,pa=w;else z=pa,pa=w;else z=pa,pa=w;a=pa;
if(a===w){var qa,nc,wc,xc,yc,Wb,zc,Ac,Bc,Xb,Cc,xa,nb,oc,pc,qc;qa=z;var Za,Yb,Gb,Dc;Za=z;h.substr(z,9).toLowerCase()===Dd?(Yb=h.substr(z,9),z+=9):(Yb=w,0===Y&&c(Ed));Yb!==w?(Gb=z,Y++,Dc=D(),Y--,Dc===w?Gb=void 0:(z=Gb,Gb=w),Gb!==w?Za=Yb="SUBSTRING":(z=Za,Za=w)):(z=Za,Za=w);nc=Za;if(nc!==w)if(wc=W(),wc!==w)if(xc=ja(),xc!==w)if(yc=W(),yc!==w)if(Wb=n(),Wb!==w)if(zc=W(),zc!==w)if(Ac=ea(),Ac!==w)if(Bc=W(),Bc!==w)if(Xb=n(),Xb!==w)if(Cc=W(),Cc!==w){xa=z;var $a,Zb,Hb,Ec;$a=z;h.substr(z,3).toLowerCase()===Fd?
(Zb=h.substr(z,3),z+=3):(Zb=w,0===Y&&c(Gd));Zb!==w?(Hb=z,Y++,Ec=D(),Y--,Ec===w?Hb=void 0:(z=Hb,Hb=w),Hb!==w?$a=Zb="FOR":(z=$a,$a=w)):(z=$a,$a=w);nb=$a;nb!==w?(oc=W(),oc!==w?(pc=n(),pc!==w?(qc=W(),qc!==w?xa=nb=[nb,oc,pc,qc]:(z=xa,xa=w)):(z=xa,xa=w)):(z=xa,xa=w)):(z=xa,xa=w);xa===w&&(xa=null);xa!==w?(nb=ha(),nb!==w?qa=nc={type:"function",name:"substring",args:{type:"expr_list",value:xa?[Wb,Xb,xa[2]]:[Wb,Xb]}}:(z=qa,qa=w)):(z=qa,qa=w)}else z=qa,qa=w;else z=qa,qa=w;else z=qa,qa=w;else z=qa,qa=w;else z=
qa,qa=w;else z=qa,qa=w;else z=qa,qa=w;else z=qa,qa=w;else z=qa,qa=w;else z=qa,qa=w;a=qa;if(a===w){var ia,ob,$b,ac,bc,Aa,cc,pb,dc,ec,Fc,rc,Gc,Hc;ia=z;ob=fa();ob!==w?($b=W(),$b!==w?(ac=ja(),ac!==w?(bc=W(),bc!==w?(Aa=F(),Aa===w&&(Aa=null),Aa!==w?(cc=W(),cc!==w?(pb=n(),pb!==w?(dc=W(),dc!==w?(ec=ea(),ec!==w?(Fc=W(),Fc!==w?(rc=n(),rc!==w?(Gc=W(),Gc!==w?(Hc=ha(),Hc!==w?ia=ob={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==Aa?"BOTH":Aa},pb,rc]}}:(z=ia,ia=w)):(z=ia,ia=
w)):(z=ia,ia=w)):(z=ia,ia=w)):(z=ia,ia=w)):(z=ia,ia=w)):(z=ia,ia=w)):(z=ia,ia=w)):(z=ia,ia=w)):(z=ia,ia=w)):(z=ia,ia=w)):(z=ia,ia=w)):(z=ia,ia=w);ia===w&&(ia=z,ob=fa(),ob!==w?($b=W(),$b!==w?(ac=ja(),ac!==w?(bc=W(),bc!==w?(Aa=F(),Aa===w&&(Aa=null),Aa!==w?(cc=W(),cc!==w?(pb=n(),pb!==w?(dc=W(),dc!==w?(ec=ha(),ec!==w?ia=ob={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==Aa?"BOTH":Aa},pb]}}:(z=ia,ia=w)):(z=ia,ia=w)):(z=ia,ia=w)):(z=ia,ia=w)):(z=ia,ia=w)):(z=ia,ia=
w)):(z=ia,ia=w)):(z=ia,ia=w)):(z=ia,ia=w));a=ia;if(a===w){var ra,sc,Ic,Jc,Kc,tc,Lc,Mc,Nc,uc,Oc,Pc;ra=z;var ab,fc,Ib,Qc;ab=z;h.substr(z,8).toLowerCase()===Hd?(fc=h.substr(z,8),z+=8):(fc=w,0===Y&&c(Id));fc!==w?(Ib=z,Y++,Qc=D(),Y--,Qc===w?Ib=void 0:(z=Ib,Ib=w),Ib!==w?ab=fc="POSITION":(z=ab,ab=w)):(z=ab,ab=w);sc=ab;sc!==w?(Ic=W(),Ic!==w?(Jc=ja(),Jc!==w?(Kc=W(),Kc!==w?(tc=n(),tc!==w?(Lc=W(),Lc!==w?(Mc=aa(),Mc!==w?(Nc=W(),Nc!==w?(uc=n(),uc!==w?(Oc=W(),Oc!==w?(Pc=ha(),Pc!==w?ra=sc={type:"function",name:"position",
args:{type:"expr_list",value:[tc,uc]}}:(z=ra,ra=w)):(z=ra,ra=w)):(z=ra,ra=w)):(z=ra,ra=w)):(z=ra,ra=w)):(z=ra,ra=w)):(z=ra,ra=w)):(z=ra,ra=w)):(z=ra,ra=w)):(z=ra,ra=w)):(z=ra,ra=w);a=ra;if(a===w){var ua,gc,Rc,Sc,Tc,qb,Uc,Vc;ua=z;var Ba,Jb,Kb,Ia;Ba=z;Ba=Jb=C();if(Ba===w)if(Ba=z,96===h.charCodeAt(z)?(Jb=Wc,z++):(Jb=w,0===Y&&c(Xc)),Jb!==w){Kb=[];Yc.test(h.charAt(z))?(Ia=h.charAt(z),z++):(Ia=w,0===Y&&c(Zc));if(Ia!==w)for(;Ia!==w;)Kb.push(Ia),Yc.test(h.charAt(z))?(Ia=h.charAt(z),z++):(Ia=w,0===Y&&c(Zc));
else Kb=w;Kb!==w?(96===h.charCodeAt(z)?(Ia=Wc,z++):(Ia=w,0===Y&&c(Xc)),Ia!==w?Ba=Jb=Kb.join(""):(z=Ba,Ba=w)):(z=Ba,Ba=w)}else z=Ba,Ba=w;gc=Ba;gc!==w?(Rc=W(),Rc!==w?(Sc=ja(),Sc!==w?(Tc=W(),Tc!==w?(qb=k(),qb===w&&(qb=null),qb!==w?(Uc=W(),Uc!==w?(Vc=ha(),Vc!==w?ua=gc={type:"function",name:gc,args:qb?qb:{type:"expr_list",value:[]}}:(z=ua,ua=w)):(z=ua,ua=w)):(z=ua,ua=w)):(z=ua,ua=w)):(z=ua,ua=w)):(z=ua,ua=w)):(z=ua,ua=w);a=ua;if(a===w){var hc,ma,rb,ic,sb,jc,Oa,Ca,Lb,$c,ad;ma=z;rb=R();if(rb!==w)if(ic=W(),
ic!==w)if(sb=n(),sb!==w)if(jc=W(),jc!==w){Oa=[];for(Ca=K();Ca!==w;)Oa.push(Ca),Ca=K();Oa!==w?(Ca=W(),Ca!==w?(Lb=da(),Lb!==w?ma=rb={type:"case_expression",format:"simple",operand:sb,clauses:Oa,else:null}:(z=ma,ma=w)):(z=ma,ma=w)):(z=ma,ma=w)}else z=ma,ma=w;else z=ma,ma=w;else z=ma,ma=w;else z=ma,ma=w;if(ma===w)if(ma=z,rb=R(),rb!==w)if(ic=W(),ic!==w)if(sb=n(),sb!==w)if(jc=W(),jc!==w){Oa=[];for(Ca=K();Ca!==w;)Oa.push(Ca),Ca=K();Oa!==w?(Ca=W(),Ca!==w?(Lb=O(),Lb!==w?($c=W(),$c!==w?(ad=da(),ad!==w?ma=rb=
{type:"case_expression",format:"simple",operand:sb,clauses:Oa,else:Lb.value}:(z=ma,ma=w)):(z=ma,ma=w)):(z=ma,ma=w)):(z=ma,ma=w)):(z=ma,ma=w)}else z=ma,ma=w;else z=ma,ma=w;else z=ma,ma=w;else z=ma,ma=w;hc=ma;if(hc===w){var oa,tb,kc,Pa,Da,Mb,bd,cd;oa=z;tb=R();if(tb!==w)if(kc=W(),kc!==w){Pa=[];for(Da=I();Da!==w;)Pa.push(Da),Da=I();Pa!==w?(Da=W(),Da!==w?(Mb=da(),Mb!==w?oa=tb={type:"case_expression",format:"searched",clauses:Pa,else:null}:(z=oa,oa=w)):(z=oa,oa=w)):(z=oa,oa=w)}else z=oa,oa=w;else z=oa,
oa=w;if(oa===w)if(oa=z,tb=R(),tb!==w)if(kc=W(),kc!==w){Pa=[];for(Da=I();Da!==w;)Pa.push(Da),Da=I();Pa!==w?(Da=W(),Da!==w?(Mb=O(),Mb!==w?(bd=W(),bd!==w?(cd=da(),cd!==w?oa=tb={type:"case_expression",format:"searched",clauses:Pa,else:Mb.value}:(z=oa,oa=w)):(z=oa,oa=w)):(z=oa,oa=w)):(z=oa,oa=w)):(z=oa,oa=w)}else z=oa,oa=w;else z=oa,oa=w;hc=oa}a=hc;if(a===w){var Nb,bb,vc,lc,mc;bb=z;vc=B();if(vc!==w){lc=[];for(mc=E();mc!==w;)lc.push(mc),mc=E();lc!==w?bb=vc+=lc.join(""):(z=bb,bb=w)}else z=bb,bb=w;Nb=bb;
Nb!==w&&(Nb={type:"column_ref",table:"",column:Nb});a=Nb;a===w&&(a=J(),a===w&&(a=z,b=ja(),b!==w?(d=W(),d!==w?(e=n(),e!==w?(f=W(),f!==w?(g=ha(),g!==w?(e.paren=!0,a=b=e):(z=a,a=w)):(z=a,a=w)):(z=a,a=w)):(z=a,a=w)):(z=a,a=w)))}}}}}}}return a}function C(){var a,b,c,d;a=z;b=B();if(b!==w){c=[];for(d=D();d!==w;)c.push(d),d=D();c!==w?a=b+=c.join(""):(z=a,a=w)}else z=a,a=w;return a}function B(){var a;jb.test(h.charAt(z))?(a=h.charAt(z),z++):(a=w,0===Y&&c(Cb));return a}function D(){var a;Ub.test(h.charAt(z))?
(a=h.charAt(z),z++):(a=w,0===Y&&c(kb));return a}function E(){var a;lb.test(h.charAt(z))?(a=h.charAt(z),z++):(a=w,0===Y&&c(Ma));return a}function J(){var a,b,d;a=z;64===h.charCodeAt(z)?(b=cb,z++):(b=w,0===Y&&c(db));b!==w?(d=C(),d!==w?a=b=[b,d]:(z=a,a=w)):(z=a,a=w);a!==w&&(a={type:"param",value:a[1]});return a}function F(){var a,b,d;a=z;h.substr(z,7).toLowerCase()===Jd?(b=h.substr(z,7),z+=7):(b=w,0===Y&&c(Kd));b!==w?(b=z,Y++,d=D(),Y--,d===w?b=void 0:(z=b,b=w),b!==w?a="LEADING":(z=a,a=w)):(z=a,a=w);
a===w&&(a=z,h.substr(z,8).toLowerCase()===Ld?(b=h.substr(z,8),z+=8):(b=w,0===Y&&c(Md)),b!==w?(b=z,Y++,d=D(),Y--,d===w?b=void 0:(z=b,b=w),b!==w?a="TRAILING":(z=a,a=w)):(z=a,a=w),a===w&&(a=z,h.substr(z,4).toLowerCase()===Nd?(b=h.substr(z,4),z+=4):(b=w,0===Y&&c(Od)),b!==w?(b=z,Y++,d=D(),Y--,d===w?b=void 0:(z=b,b=w),b!==w?a="BOTH":(z=a,a=w)):(z=a,a=w)));return a}function M(){var a;a=H();a===w&&(a=J());return a}function H(){var a,b,d;a=z;39===h.charCodeAt(z)?(b=eb,z++):(b=w,0===Y&&c(fb));b===w&&(h.substr(z,
2)===Ob?(b=Ob,z+=2):(b=w,0===Y&&c(ub)));if(b!==w){b=[];d=z;h.substr(z,2)===Ea?(d=Ea,z+=2):(d=w,0===Y&&c(Qa));d!==w&&(d="'");d===w&&(Ra.test(h.charAt(z))?(d=h.charAt(z),z++):(d=w,0===Y&&c(Pb)));for(;d!==w;)b.push(d),d=z,h.substr(z,2)===Ea?(d=Ea,z+=2):(d=w,0===Y&&c(Qa)),d!==w&&(d="'"),d===w&&(Ra.test(h.charAt(z))?(d=h.charAt(z),z++):(d=w,0===Y&&c(Pb)));b!==w?(39===h.charCodeAt(z)?(d=eb,z++):(d=w,0===Y&&c(fb)),d!==w?a=b={type:"string",value:b.join("")}:(z=a,a=w)):(z=a,a=w)}else z=a,a=w;return a}function I(){var a,
b,c;a=z;b=ba();b!==w?(b=W(),b!==w?(b=n(),b!==w?(c=W(),c!==w?(c=ca(),c!==w?(c=W(),c!==w?(c=n(),c!==w?a=b={type:"when_clause",operand:b,value:c}:(z=a,a=w)):(z=a,a=w)):(z=a,a=w)):(z=a,a=w)):(z=a,a=w)):(z=a,a=w)):(z=a,a=w);return a}function K(){var a,b,c;a=z;b=ba();b!==w?(b=W(),b!==w?(b=n(),b!==w?(c=W(),c!==w?(c=ca(),c!==w?(c=W(),c!==w?(c=n(),c!==w?a=b={type:"when_clause",operand:b,value:c}:(z=a,a=w)):(z=a,a=w)):(z=a,a=w)):(z=a,a=w)):(z=a,a=w)):(z=a,a=w)):(z=a,a=w);return a}function O(){var a,b;a=z;var d,
e;b=z;h.substr(z,4).toLowerCase()===Pd?(d=h.substr(z,4),z+=4):(d=w,0===Y&&c(Qd));d!==w?(d=z,Y++,e=D(),Y--,e===w?d=void 0:(z=d,d=w),d!==w?b="ELSE":(z=b,b=w)):(z=b,b=w);b!==w?(b=W(),b!==w?(b=n(),b!==w?a={type:"else_clause",value:b}:(z=a,a=w)):(z=a,a=w)):(z=a,a=w);return a}function P(){var a,b,d;a=N();a===w&&(a=z,45===h.charCodeAt(z)?(b=Bb,z++):(b=w,0===Y&&c(Na)),b===w&&(43===h.charCodeAt(z)?(b=Ab,z++):(b=w,0===Y&&c(ib))),b!==w?(d=N(),d!==w?a=b=b[0]+d:(z=a,a=w)):(z=a,a=w));return a}function L(){var a,
b;a=z;46===h.charCodeAt(z)?(b=Rd,z++):(b=w,0===Y&&c(Sd));b!==w?(b=N(),b===w&&(b=null),b!==w?a="."+(null!=b?b:""):(z=a,a=w)):(z=a,a=w);return a}function U(){var a,b,d;b=a=z;Td.test(h.charAt(z))?(d=h.charAt(z),z++):(d=w,0===Y&&c(Ud));d!==w?(Vd.test(h.charAt(z))?(d=h.charAt(z),z++):(d=w,0===Y&&c(Wd)),d===w&&(d=null),d!==w?b="e"+(null===d?"":d):(z=b,b=w)):(z=b,b=w);b!==w?(d=N(),d!==w?a=b+d:(z=a,a=w)):(z=a,a=w);return a}function N(){var a,b;a=[];b=S();if(b!==w)for(;b!==w;)a.push(b),b=S();else a=w;a!==
w&&(a=a.join(""));return a}function S(){var a;Xd.test(h.charAt(z))?(a=h.charAt(z),z++):(a=w,0===Y&&c(Yd));return a}function aa(){var a,b,d;a=z;h.substr(z,2).toLowerCase()===Zd?(b=h.substr(z,2),z+=2):(b=w,0===Y&&c($d));b!==w?(b=z,Y++,d=D(),Y--,d===w?b=void 0:(z=b,b=w),b!==w?a="IN":(z=a,a=w)):(z=a,a=w);return a}function V(){var a,b,d;a=z;h.substr(z,2).toLowerCase()===ae?(b=h.substr(z,2),z+=2):(b=w,0===Y&&c(be));b!==w?(b=z,Y++,d=D(),Y--,d===w?b=void 0:(z=b,b=w),b!==w?a="IS":(z=a,a=w)):(z=a,a=w);return a}
function T(){var a,b,d;a=z;h.substr(z,4).toLowerCase()===ce?(b=h.substr(z,4),z+=4):(b=w,0===Y&&c(de));b!==w?(b=z,Y++,d=D(),Y--,d===w?b=void 0:(z=b,b=w),b!==w?a="LIKE":(z=a,a=w)):(z=a,a=w);return a}function Q(){var a,b,d;a=z;h.substr(z,3).toLowerCase()===ee?(b=h.substr(z,3),z+=3):(b=w,0===Y&&c(fe));b!==w?(b=z,Y++,d=D(),Y--,d===w?b=void 0:(z=b,b=w),b!==w?a="NOT":(z=a,a=w)):(z=a,a=w);return a}function G(){var a,b,d;a=z;h.substr(z,3).toLowerCase()===ge?(b=h.substr(z,3),z+=3):(b=w,0===Y&&c(he));b!==w?
(b=z,Y++,d=D(),Y--,d===w?b=void 0:(z=b,b=w),b!==w?a="AND":(z=a,a=w)):(z=a,a=w);return a}function X(){var a,b,d;a=z;h.substr(z,2).toLowerCase()===ie?(b=h.substr(z,2),z+=2):(b=w,0===Y&&c(je));b!==w?(b=z,Y++,d=D(),Y--,d===w?b=void 0:(z=b,b=w),b!==w?a="OR":(z=a,a=w)):(z=a,a=w);return a}function Z(){var a,b,d;a=z;h.substr(z,7).toLowerCase()===ke?(b=h.substr(z,7),z+=7):(b=w,0===Y&&c(le));b!==w?(b=z,Y++,d=D(),Y--,d===w?b=void 0:(z=b,b=w),b!==w?a="BETWEEN":(z=a,a=w)):(z=a,a=w);return a}function ea(){var a,
b,d;a=z;h.substr(z,4).toLowerCase()===me?(b=h.substr(z,4),z+=4):(b=w,0===Y&&c(ne));b!==w?(b=z,Y++,d=D(),Y--,d===w?b=void 0:(z=b,b=w),b!==w?a="FROM":(z=a,a=w)):(z=a,a=w);return a}function fa(){var a,b,d;a=z;h.substr(z,4).toLowerCase()===oe?(b=h.substr(z,4),z+=4):(b=w,0===Y&&c(pe));b!==w?(b=z,Y++,d=D(),Y--,d===w?b=void 0:(z=b,b=w),b!==w?a="TRIM":(z=a,a=w)):(z=a,a=w);return a}function R(){var a,b,d;a=z;h.substr(z,4).toLowerCase()===qe?(b=h.substr(z,4),z+=4):(b=w,0===Y&&c(re));b!==w?(b=z,Y++,d=D(),Y--,
d===w?b=void 0:(z=b,b=w),b!==w?a="CASE":(z=a,a=w)):(z=a,a=w);return a}function da(){var a,b,d;a=z;h.substr(z,3).toLowerCase()===se?(b=h.substr(z,3),z+=3):(b=w,0===Y&&c(te));b!==w?(b=z,Y++,d=D(),Y--,d===w?b=void 0:(z=b,b=w),b!==w?a="END":(z=a,a=w)):(z=a,a=w);return a}function ba(){var a,b,d;a=z;h.substr(z,4).toLowerCase()===ue?(b=h.substr(z,4),z+=4):(b=w,0===Y&&c(ve));b!==w?(b=z,Y++,d=D(),Y--,d===w?b=void 0:(z=b,b=w),b!==w?a="WHEN":(z=a,a=w)):(z=a,a=w);return a}function ca(){var a,b,d;a=z;h.substr(z,
4).toLowerCase()===we?(b=h.substr(z,4),z+=4):(b=w,0===Y&&c(xe));b!==w?(b=z,Y++,d=D(),Y--,d===w?b=void 0:(z=b,b=w),b!==w?a="THEN":(z=a,a=w)):(z=a,a=w);return a}function ga(){var a;44===h.charCodeAt(z)?(a=ye,z++):(a=w,0===Y&&c(ze));return a}function ja(){var a;40===h.charCodeAt(z)?(a=Ae,z++):(a=w,0===Y&&c(Be));return a}function ha(){var a;41===h.charCodeAt(z)?(a=Ce,z++):(a=w,0===Y&&c(De));return a}function W(){var a,b;a=[];for(b=na();b!==w;)a.push(b),b=na();return a}function na(){var a;Ee.test(h.charAt(z))?
(a=h.charAt(z),z++):(a=w,0===Y&&c(Fe));return a}function ka(a,b,c,d){a={type:"binary_expr",operator:a,left:b,right:c};void 0!==d&&(a.escape=d);return a}function la(a,b){for(var c=0;c<b.length;c++)a=ka(b[c][1],a,b[c][3]);return a}e=void 0!==e?e:{};var w={},Ja={start:f},ta=f,sa="!",Sa=a("!",!1),Ga="\x3d",va=a("\x3d",!1),wa="\x3e\x3d",hb=a("\x3e\x3d",!1),vb="\x3e",Ha=a("\x3e",!1),wb="\x3c\x3d",Ka=a("\x3c\x3d",!1),La="\x3c\x3e",xb=a("\x3c\x3e",!1),Fa="\x3c",Qb=a("\x3c",!1),yb="!\x3d",Rb=a("!\x3d",!1),
Ab="+",ib=a("+",!1),Bb="-",Na=a("-",!1),pa="*",zb=a("*",!1),Sb="/",Tb=a("/",!1),jb=/^[A-Za-z_\x80-\uFFFF]/,Cb=d([["A","Z"],["a","z"],"_",["\u0080","\uffff"]],!1,!1),Ub=/^[A-Za-z0-9_]/,kb=d([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),lb=/^[A-Za-z0-9_.\x80-\uFFFF]/,Ma=d([["A","Z"],["a","z"],["0","9"],"_",".",["\u0080","\uffff"]],!1,!1),cb="@",db=a("@",!1),eb="'",fb=a("'",!1),Ob="N'",ub=a("N'",!1),Ea="''",Qa=a("''",!1),Ra=/^[^']/,Pb=d(["'"],!0,!1),Rd=".",Sd=a(".",!1),Xd=/^[0-9]/,Yd=d([["0","9"]],!1,!1),
Td=/^[eE]/,Ud=d(["e","E"],!1,!1),Vd=/^[+\-]/,Wd=d(["+","-"],!1,!1),jd="null",kd=a("NULL",!0),fd="true",gd=a("TRUE",!0),hd="false",id=a("FALSE",!0),Zd="in",$d=a("IN",!0),ae="is",be=a("IS",!0),ce="like",de=a("LIKE",!0),dd="escape",ed=a("ESCAPE",!0),ee="not",fe=a("NOT",!0),ge="and",he=a("AND",!0),ie="or",je=a("OR",!0),ke="between",le=a("BETWEEN",!0),me="from",ne=a("FROM",!0),Fd="for",Gd=a("FOR",!0),Dd="substring",Ed=a("SUBSTRING",!0),pd="extract",qd=a("EXTRACT",!0),oe="trim",pe=a("TRIM",!0),Hd="position",
Id=a("POSITION",!0),nd="timestamp",od=a("TIMESTAMP",!0),ld="date",md=a("DATE",!0),Jd="leading",Kd=a("LEADING",!0),Ld="trailing",Md=a("TRAILING",!0),Nd="both",Od=a("BOTH",!0),rd="year",sd=a("YEAR",!0),td="month",ud=a("MONTH",!0),vd="day",wd=a("DAY",!0),xd="hour",yd=a("HOUR",!0),zd="minute",Ad=a("MINUTE",!0),Bd="second",Cd=a("SECOND",!0),qe="case",re=a("CASE",!0),se="end",te=a("END",!0),ue="when",ve=a("WHEN",!0),we="then",xe=a("THEN",!0),Pd="else",Qd=a("ELSE",!0),ye=",",ze=a(",",!1),Ae="(",Be=a("(",
!1),Ce=")",De=a(")",!1),Ee=/^[ \t\n\r]/,Fe=d([" ","\t","\n","\r"],!1,!1),Wc="`",Xc=a("`",!1),Yc=/^[^`]/,Zc=d(["`"],!0,!1),z=0,Ta=[{line:1,column:1}],ya=0,mb=[],Y=0,gb;if("startRule"in e){if(!(e.startRule in Ja))throw Error("Can't start parsing from rule \""+e.startRule+'".');ta=Ja[e.startRule]}gb=ta();if(gb!==w&&z===h.length)return gb;gb!==w&&z<h.length&&c({type:"end"});throw function(a,b,c){return new q(q.buildMessage(a,b),a,b,c)}(mb,ya<h.length?h.charAt(ya):null,ya<h.length?g(ya,ya+1):g(ya,ya));
}}})},"esri/layers/IntegratedMeshLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Error ../core/promiseUtils ../core/accessorSupport/decorators ./Layer ./mixins/SceneService ../symbols/support/ElevationInfo".split(" "),function(q,h,e,a,d,b,g,c,f,k,n){return function(f){function h(a,b){a=f.call(this)||this;a.geometryType="mesh";a.operationalLayerType="IntegratedMeshLayer";a.type="integrated-mesh";
a.profile="mesh-pyramids";a.elevationInfo=null;return a}a(h,f);h.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?e({url:a},b):a};h.prototype.load=function(){var a=this,b=this.loadFromPortal({supportedTypes:["Scene Service"]}).always(function(){return a._fetchService()}).then(function(){return a._verifyRootNodeAndUpdateExtent()});this.addResolvingPromise(b);return this.when()};h.prototype.importLayerViewModule=function(a){switch(a.type){case "2d":return g.reject(new b("integrated-mesh-layer:view-not-supported",
"IntegratedMeshLayer is only supported in 3D"));case "3d":return g.create(function(a){return q(["../views/3d/layers/SceneLayerView3D"],a)})}};h.prototype._validateLayer=function(a){if(a.layerType&&"IntegratedMesh"!==a.layerType)throw new b("integrated-mesh-layer:layer-type-not-supported","IntegratedMeshLayer does not support this layer type",{layerType:a.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new b("layer:service-version-not-supported","Service version is not supported.",
{serviceVersion:this.version.versionString,supportedVersions:"1.x"});if(1<this.version.major)throw new b("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});};d([c.shared("esri.layers.IntegratedMeshLayer")],h.prototype,"declaredClass",void 0);d([c.property({type:String,readOnly:!0})],h.prototype,"geometryType",void 0);d([c.property()],h.prototype,"operationalLayerType",void 0);d([c.property({json:{read:!1},readOnly:!0})],
h.prototype,"type",void 0);d([c.property({type:n,json:{origins:{service:{read:{source:"elevationInfo"}}},read:{source:"layerDefinition.elevationInfo"},write:{target:"layerDefinition.elevationInfo"}}})],h.prototype,"elevationInfo",void 0);return h=d([c.subclass()],h)}(c.declared(f,k))})},"esri/layers/mixins/SceneService":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../request ../../core/Error ../../core/Logger ../../core/MultiOriginJSONSupport ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators ../../geometry/Extent ../../geometry/HeightModelInfo ../../geometry/SpatialReference ../Layer ./ArcGISService ./OperationalLayer ./PortalLayer ../support/arcgisLayerUrl".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u,x,v){var A=g.getLogger("esri.layers.mixins.SceneService");return function(c){function g(){var a=null!==c&&c.apply(this,arguments)||this;a.blendMode=null;a.spatialReference=null;a.fullExtent=null;a.heightModelInfo=null;a.version={major:Number.NaN,minor:Number.NaN,versionString:""};a.copyright=null;a.sublayerTitleMode="item-title";a.title=null;a.layerId=null;return a}e(g,c);g.prototype.readSpatialReference=function(a,b){return this._readSpatialReference(b)};
g.prototype._readSpatialReference=function(a){if(null!=a.spatialReference)return m.fromJSON(a.spatialReference);a=a.store;a=(a=a.indexCRS||a.geographicCRS)&&parseInt(a.substring(a.lastIndexOf("/")+1,a.length),10);return null!=a?new m(a):null};g.prototype.readFullExtent=function(a,b){a=b.store;b=this._readSpatialReference(b);return null==b||null==a||null==a.extent?null:new l({xmin:a.extent[0],ymin:a.extent[1],xmax:a.extent[2],ymax:a.extent[3],spatialReference:b})};g.prototype.readVersion=function(a,
b){a=b.store;b=null!=a.version?a.version.toString():"";a={major:Number.NaN,minor:Number.NaN,versionString:b};b=b.split(".");2<=b.length&&(a.major=parseInt(b[0],10),a.minor=parseInt(b[1],10));return a};g.prototype.readTitlePortalItem=function(a,b){return"item-title"!==this.sublayerTitleMode?void 0:a};g.prototype.readTitleService=function(a,b){a=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return v.titleFromUrlAndName(this.url,b.name);b=b.name||v.parse(this.url).title;
"item-title-and-service-name"===this.sublayerTitleMode&&a&&(b=a+" - "+b);return v.cleanTitle(b)};g.prototype.readLayerId=function(a,b){return b.id};Object.defineProperty(g.prototype,"url",{set:function(a){a=v.sanitizeUrlWithLayerId(this,a,A);this._set("url",a.url);null!=a.layerId&&this._set("layerId",a.layerId)},enumerable:!0,configurable:!0});g.prototype.writeUrl=function(a,b){v.writeUrlWithLayerId(this,a,"layers",b)};Object.defineProperty(g.prototype,"parsedUrl",{get:function(){var a=this._get("url");
if(!a)return null;a=k.urlToObject(a);null!=this.layerId&&v.match.test(a.path)&&(a.path=a.path+"/layers/"+this.layerId);return a},enumerable:!0,configurable:!0});g.prototype.readRootNode=function(a,b){return b.store.rootNode};g.prototype._verifyRootNodeAndUpdateExtent=function(){var a=this;return this._fetchRootNode().then(function(b){return a._updateExtentFromRootNode(b)})};g.prototype._updateExtentFromRootNode=function(a){if(null!=this.fullExtent&&!this.fullExtent.hasZ&&null!=a&&Array.isArray(a.mbs)&&
4===a.mbs.length){var b=a.mbs[2];a=a.mbs[3];this.fullExtent.zmin=b-a;this.fullExtent.zmax=b+a}};g.prototype._fetchRootNode=function(){if(!this.rootNode)return f.resolve();var a=k.join(this.parsedUrl.path,this.rootNode);return d(a,{query:{f:"json"},responseType:"json"}).then(function(a){return a.data}).catch(function(c){throw new b("sceneservice:root-node-missing","Root node missing.",{error:c,url:a});})};g.prototype._fetchService=function(){var a=this;return(null==this.layerId&&/SceneServer\/*$/i.test(this.url)?
this._fetchFirstLayerId().then(function(b){null!=b&&(a.layerId=b)}):f.resolve()).then(function(){return a._fetchServiceLayer()})};g.prototype._fetchFirstLayerId=function(){return d(this.url,{query:{f:"json"},callbackParamName:"callback",responseType:"json"}).then(function(a){if(a.data&&Array.isArray(a.data.layers)&&0<a.data.layers.length)return a.data.layers[0].id})};g.prototype._fetchServiceLayer=function(){var a=this;return d(this.parsedUrl.path,{query:{f:"json"},responseType:"json"}).then(function(b){b.ssl&&
(a.url=a.url.replace(/^http:/i,"https:"));b=b.data;a.read(b,{origin:"service",url:a.parsedUrl});a._validateLayer(b)})};g.prototype._validateLayer=function(a){};g.prototype.createGraphicsController=function(a){var b=this;a.layer=this;var c=f.create(function(a){return q(["../graphics/controllers/I3SOnDemandController"],a)}).then(function(b){return new b(a)});c.then(function(a){b.emit("graphics-controller-create",{graphicsController:a})});return c};a([n.shared({id:{json:{origins:{service:{read:!1},"portal-item":{read:!1}}}}})],
g.prototype,"properties",void 0);a([n.property({type:m})],g.prototype,"spatialReference",void 0);a([n.reader("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],g.prototype,"readSpatialReference",null);a([n.property({type:l})],g.prototype,"fullExtent",void 0);a([n.reader("fullExtent",["store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],g.prototype,"readFullExtent",null);a([n.property({readOnly:!0,type:p})],g.prototype,"heightModelInfo",void 0);
a([n.property({readOnly:!0})],g.prototype,"version",void 0);a([n.reader("version",["store.version"])],g.prototype,"readVersion",null);a([n.property({type:String,json:{read:{source:"copyrightText"}}})],g.prototype,"copyright",void 0);a([n.property({type:String})],g.prototype,"sublayerTitleMode",void 0);a([n.property({type:String})],g.prototype,"title",void 0);a([n.reader("portal-item","title")],g.prototype,"readTitlePortalItem",null);a([n.reader("service","title",["name"])],g.prototype,"readTitleService",
null);a([n.property({type:Number})],g.prototype,"layerId",void 0);a([n.reader("service","layerId",["id"])],g.prototype,"readLayerId",null);a([n.property()],g.prototype,"url",null);a([n.writer("url")],g.prototype,"writeUrl",null);a([n.property({dependsOn:["layerId"]})],g.prototype,"parsedUrl",null);a([n.property()],g.prototype,"store",void 0);a([n.property({type:String})],g.prototype,"rootNode",void 0);a([n.reader("rootNode",["store.rootNode"])],g.prototype,"readRootNode",null);return g=a([n.subclass("esri.layers.mixins.SceneService")],
g)}(n.declared(r,t,c,u,x))})},"esri/layers/SceneLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/promise/all ../PopupTemplate ../request ../core/Error ../core/Logger ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators ../core/accessorSupport/PropertyOrigin ../core/accessorSupport/utils ./FeatureLayer ./Layer ./mixins/SceneService ./support/commonProperties ./support/commonProperties ./support/FeatureReduction ./support/FeatureReductionSelection ./support/Field ./support/fieldUtils ./support/LabelClass ./support/labelingInfo ./support/RangeInfo ../portal/PortalItem ../renderers/support/jsonUtils ../renderers/support/styleUtils ../renderers/support/typeUtils ../symbols/support/ElevationInfo ../tasks/support/Query".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u,x,v,A,y,C,B,D,E,J,F,M,H,I,K,O,P){function L(a,b,c){a&&((a=H.read(a,b,c)||void 0)||N.error("Failed to create renderer",{rendererDefinition:a,layer:this,context:c}));return a}var U=["3DObject","Point"],N=k.getLogger("esri.layers.SceneLayer"),S={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},
aa={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"};return function(h){function k(a,b){a=h.call(this)||this;a.featureReduction=null;a.rangeInfos=null;a.operationalLayerType="ArcGISSceneServiceLayer";a.type="scene";a.fields=[];a.definitionExpression=null;a.elevationInfo=null;a.labelsVisible=!0;a.labelingInfo=null;a.legendEnabled=!0;a.cachedDrawingInfo={color:!1};a.popupEnabled=!0;a.popupTemplate=null;a.objectIdField=null;a.objectIdFilter=null;a._fieldUsageInfo={};a.screenSizePerspectiveEnabled=
!0;return a}a(k,h);k.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?e({url:a},b):a};k.prototype.getField=function(a){return D.getField(a,this.fields)};Object.defineProperty(k.prototype,"geometryType",{get:function(){return aa[this.profile]||"mesh"},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"renderer",{set:function(a){D.fixRendererFields(a,this.fields);this._set("renderer",a)},enumerable:!0,configurable:!0});k.prototype.readCachedDrawingInfo=function(a,
b){if(null==a||"object"!==typeof a)a={};null==a.color&&(a.color=!1);return a};k.prototype.readObjectIdField=function(a,b){!a&&b.fields&&b.fields.some(function(b){"esriFieldTypeOID"===b.type&&(a=b.name);return!!a});return a||void 0};k.prototype.readProfile=function(a,b){a=b.store.profile;if(null!=a&&S[a])return S[a];N.error("Unknown or missing profile",{profile:a,layer:this});return"mesh-pyramids"};k.prototype.readNormalReferenceFrame=function(a,b){return b.store.normalReferenceFrame};k.prototype.load=
function(){var a=this,c=this.loadFromPortal({supportedTypes:["Scene Service"]}).always(function(){return a._fetchService()}).then(function(){return b([a._verifyRootNodeAndUpdateExtent(),a._setCompanionFeatureLayer()])}).then(function(){return a._applyCompanionOverrides()}).then(function(){return a._populateFieldUsageInfo()}).then(function(){return I.loadStyleRenderer(a,{origin:"service"})}).then(function(){return D.fixRendererFields(a.renderer,a.fields)});this.addResolvingPromise(c);return this.when()};
k.prototype.createLayerView=function(a){var b=this;return(null==this.profile||"mesh-pyramids"===this.profile?n.create(function(a){return q(["../views/3d/layers/SceneLayerView3D"],a)}):n.create(function(a){return q(["../views/3d/layers/SceneLayerGraphicsView3D"],a)})).then(function(c){return new c({view:a,layer:b})})};k.prototype.createQuery=function(){var a=new P;"mesh"!==this.geometryType&&(a.returnGeometry=!0,a.returnZ=!0);a.where=this.definitionExpression||"1\x3d1";a.sqlFormat="standard";return a};
k.prototype.queryExtent=function(a){var b=this;return this._getAssociatedLayerForQuery().then(function(c){return c.queryExtent(a||b.createQuery())})};k.prototype.queryFeatureCount=function(a){var b=this;return this._getAssociatedLayerForQuery().then(function(c){return c.queryFeatureCount(a||b.createQuery())})};k.prototype.queryFeatures=function(a){var b=this;return this._getAssociatedLayerForQuery().then(function(c){return c.queryFeatures(a||b.createQuery())}).then(function(a){if(a&&a.features)for(var c=
0,d=a.features;c<d.length;c++){var e=d[c];e.layer=b;e.sourceLayer=b}return a})};k.prototype.queryFeaturesJSON=function(a){var b=this;return this._getAssociatedLayerForQuery().then(function(c){return c.queryFeaturesJSON(a||b.createQuery())})};k.prototype.queryObjectIds=function(a){var b=this;return this._getAssociatedLayerForQuery().then(function(c){return c.queryObjectIds(a||b.createQuery())})};k.prototype.getFieldUsageInfo=function(a){return this._fieldUsageInfo[a]||{supportsLabelingInfo:!1,supportsRenderer:!1,
supportsPopupTemplate:!1,supportsLayerQuery:!1}};k.prototype._getAssociatedLayerForQuery=function(){var a=this;if(!this.loaded)return this.load().then(function(){return a._getAssociatedLayerForQuery()});var b=this.associatedLayer;return null!=b?n.resolve(b):n.reject(new f("scenelayer:query-not-available","SceneLayer queries are not available without associated feature layer"))};k.prototype.hasCachedStatistics=function(a){return null!=this.statisticsInfo&&this.statisticsInfo.some(function(b){return b.name===
a})};k.prototype.queryCachedStatistics=function(a){if(!this.hasCachedStatistics(a))return n.reject(new f("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available"));for(var b=0,d=this.statisticsInfo;b<d.length;b++){var e=d[b];if(e.name===a)return a=l.join(this.parsedUrl.path,e.href),c(a,{query:{f:"json"},responseType:"json"}).then(function(a){return a.data})}};k.prototype.graphicChanged=function(a){this.emit("graphic-update",a)};k.prototype._validateLayer=function(a){if(a.layerType&&
-1===U.indexOf(a.layerType))throw new f("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:a.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new f("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});if(1<this.version.major)throw new f("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,
supportedVersions:"1.x"});a=this.normalReferenceFrame;var b=this.spatialReference,c=!1,d=!1;if(null==a)d=c=!0;else switch(b=b&&b.isGeographic,a){case "east-north-up":case "earth-centered":c=!0;d=b;break;case "vertex-reference-frame":c=!0;d=!b;break;default:c=!1}if(!c)throw new f("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!d)throw new f("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.");
};k.prototype._populateFieldUsageInfo=function(){this._fieldUsageInfo={};if(this.fields)for(var a=function(a){var c=!(!b.attributeStorageInfo||!b.attributeStorageInfo.some(function(b){return b.name===a.name})),d=!!(b.associatedLayer&&b.associatedLayer.fields&&b.associatedLayer.fields.some(function(b){return b&&a.name===b.name}));b._fieldUsageInfo[a.name]={supportsLabelingInfo:c,supportsRenderer:c,supportsPopupTemplate:c||d,supportsLayerQuery:d}},b=this,c=0,d=this.fields;c<d.length;c++)a(d[c])};k.prototype._applyCompanionOverrides=
function(){if(this.associatedLayer){if(this.associatedLayer.fields)for(var a=0,b=this.associatedLayer.fields;a<b.length;a++){var c=b[a];this.getField(c.name)||this.fields.push(c.clone())}a=["popupTemplate","popupEnabled"];b=r.getProperties(this);for(c=0;c<a.length;c++){var d=a[c];this._buddyIsMoreImportant(d)&&(b.setDefaultOrigin(this.associatedLayer.originOf(d)),b.set(d,this.associatedLayer[d]),b.setDefaultOrigin("user"))}}};k.prototype._setCompanionFeatureLayer=function(){var a=this;return this._fetchCompanionFeatureLayer().then(function(b){a.associatedLayer=
b})};k.prototype._fetchCompanionFeatureLayer=function(){var a=this;return-1===["mesh-pyramids","points"].indexOf(this.profile)?n.resolve(null):(this.portalItem&&this.portalItem.isResolved()?this._fetchCompanionFeatureLayerFromRelatedItems(this.portalItem):this._fetchCompanionFeatureLayerFromUrl()).then(function(a){return a.load()}).catch(function(b){null==a.attributeStorageInfo?N.warn("Companion FeatureLayer could not be loaded and no binary attributes found. Popups will not work for this SceneLayer: "+
a.title):N.info("Companion FeatureLayer could not be loaded. Falling back to binary attributes for Popups on this SceneLayer: "+a.title);return null})};k.prototype._fetchCompanionFeatureLayerFromRelatedItems=function(a){var b=this;return a.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"}).then(function(a){return(a=a.filter(function(a){return"Feature Service"===a.type})[0])?b._fetchCompanionFeatureLayerFromPortalItem(new M({id:a.id,portal:a.portal})):n.reject()}).catch(function(){return b._fetchCompanionFeatureLayerFromUrl()})};
k.prototype._fetchCompanionFeatureLayerFromPortalItem=function(a){var b=this;return a.load().then(function(a){return b._findMatchingCompanionSublayerUrl(a.url)}).then(function(b){return n.resolve(new t({url:b,portalItem:a}))})};k.prototype._fetchCompanionFeatureLayerFromUrl=function(){return this._findMatchingCompanionSublayerUrl().then(function(a){return n.resolve(new t({url:a}))})};k.prototype._findMatchingCompanionSublayerUrl=function(a){var d=this.parsedUrl.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i);
if(!d)return n.reject();null==a&&(a=d[1]+"/FeatureServer");var e=a.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1");a={query:{f:"json"},responseType:"json"};var f=d[1]+"/SceneServer",g=parseInt(d[2],10),d=c(f,a).catch(function(a){return{layers:null}});a=c(e,a);return b([a,d]).then(function(a){var b=a[0];a=a[1];a=a.data&&a.data.layers;b=b.data&&b.data.layers;if(!Array.isArray(b))throw Error("expected layers array");if(Array.isArray(a))for(var c=0;c<Math.min(a.length,b.length);c++){if(a[c].id===g)return e+
"/"+b[c].id}else if(g<b.length)return e+"/"+b[g].id;throw Error("could not find matching associated sublayer");})};k.prototype._buddyIsMoreImportant=function(a){if(!this.associatedLayer)return!1;var b=m.nameToId(this.originOf(a));a=m.nameToId(this.associatedLayer.originOf(a));return null!=a&&a<=m.OriginId.SERVICE?null==b||b<m.OriginId.SERVICE:null!=a&&a<=m.OriginId.PORTAL_ITEM?null==b||b<m.OriginId.PORTAL_ITEM:!1};d([p.shared("esri.layers.SceneLayer")],k.prototype,"declaredClass",void 0);d([p.property({types:{key:"type",
base:y.default,typeMap:{selection:C.default}},json:{origins:{"web-scene":{read:{source:"layerDefinition.featureReduction"},write:{target:"layerDefinition.featureReduction"}}}}})],k.prototype,"featureReduction",void 0);d([p.property({type:[F.default],json:{read:!1,origins:{"web-scene":{read:{source:"layerDefinition.rangeInfos"},write:{target:"layerDefinition.rangeInfos"}}}}})],k.prototype,"rangeInfos",void 0);d([p.property()],k.prototype,"associatedLayer",void 0);d([p.property()],k.prototype,"operationalLayerType",
void 0);d([p.property({json:{read:!1},readOnly:!0})],k.prototype,"type",void 0);d([p.property({type:[B]})],k.prototype,"fields",void 0);d([p.property({readOnly:!0})],k.prototype,"attributeStorageInfo",void 0);d([p.property({readOnly:!0})],k.prototype,"statisticsInfo",void 0);d([p.property({type:String,json:{origins:{service:{read:!1,write:!1}},read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression"}}})],k.prototype,"definitionExpression",void 0);d([p.property({type:O,
json:{origins:{service:{read:{source:"elevationInfo"}}},read:{source:"layerDefinition.elevationInfo"},write:{target:"layerDefinition.elevationInfo"}}})],k.prototype,"elevationInfo",void 0);d([p.property({type:String,dependsOn:["profile"]})],k.prototype,"geometryType",null);d([p.property(v.labelsVisible)],k.prototype,"labelsVisible",void 0);d([p.property({type:[E],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:J.reader},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},
read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:J.reader},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],k.prototype,"labelingInfo",void 0);d([p.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],k.prototype,"legendEnabled",void 0);d([p.property({types:K.types,json:{origins:{service:{read:{source:"drawingInfo.renderer",reader:L}}},read:{source:"layerDefinition.drawingInfo.renderer",reader:L},write:{target:"layerDefinition.drawingInfo.renderer"}},
value:null})],k.prototype,"renderer",null);d([p.property({json:{read:!1}})],k.prototype,"cachedDrawingInfo",void 0);d([p.reader("service","cachedDrawingInfo")],k.prototype,"readCachedDrawingInfo",null);d([p.property(v.popupEnabled)],k.prototype,"popupEnabled",void 0);d([p.property({type:g,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],k.prototype,"popupTemplate",void 0);d([p.property({type:String,json:{read:!1}})],k.prototype,"objectIdField",void 0);d([p.reader("service","objectIdField",
["objectIdField","fields"])],k.prototype,"readObjectIdField",null);d([p.property()],k.prototype,"objectIdFilter",void 0);d([p.property({type:String,json:{read:!1}})],k.prototype,"profile",void 0);d([p.reader("service","profile",["store.profile"])],k.prototype,"readProfile",null);d([p.property({readOnly:!0,type:String,json:{read:!1}})],k.prototype,"normalReferenceFrame",void 0);d([p.reader("service","normalReferenceFrame",["store.normalReferenceFrame"])],k.prototype,"readNormalReferenceFrame",null);
d([p.property(A.screenSizePerspectiveEnabled)],k.prototype,"screenSizePerspectiveEnabled",void 0);return k=d([p.subclass()],k)}(p.declared(u,x))})},"esri/layers/support/RangeInfo":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(q,h,e,a,d,b){Object.defineProperty(h,"__esModule",{value:!0});q=function(d){function c(){var a=null!==d&&d.apply(this,arguments)||
this;a.name=null;a.field=null;a.currentRangeExtent=null;a.fullRangeExtent=null;a.type="rangeInfo";return a}e(c,d);a([b.property({type:String,json:{read:!0,write:!0}})],c.prototype,"name",void 0);a([b.property({type:String,json:{read:!0,write:!0}})],c.prototype,"field",void 0);a([b.property({type:[Number],json:{read:!0,write:!0}})],c.prototype,"currentRangeExtent",void 0);a([b.property({type:[Number],json:{read:!0,write:!0}})],c.prototype,"fullRangeExtent",void 0);a([b.property({type:String,readOnly:!0,
json:{read:!1,write:!0}})],c.prototype,"type",void 0);return c=a([b.subclass("esri.layers.support.RangeInfo")],c)}(b.declared(d));h.RangeInfo=q;h.default=q})},"esri/views/3d/layers/SceneLayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper dojo/has dojo/errors/CancelError ../../../Graphic ../../../core/arrayUtils ../../../core/arrayUtils ../../../core/Collection ../../../core/lang ../../../core/Logger ../../../core/promiseUtils ../../../core/requireUtils ../../../core/scheduling ../../../core/watchUtils ../../../core/workers ../../../core/accessorSupport/decorators ../../../geometry/support/aaBoundingBox ../../../geometry/support/scaleUtils ../../../layers/IntegratedMeshLayer ../../../symbols/FillSymbol3DLayer ../../../symbols/Symbol3D ../../../symbols/support/unitConversionUtils ../../../tasks/support/Query ./LayerView3D ./SceneLayerWorker ./graphics/graphicUtils ./i3s/Highlights ./i3s/I3SElevationProvider ./i3s/I3SQueryEngine ./i3s/I3SUtil ./i3s/IDBCache ./support/attributeUtils ./support/edgeUtils ./support/layerViewUpdatingProperties ../lib/glMatrix ../support/orientedBoundingBox ../support/projectionUtils ../support/buffer/typedArrayUtil ../webgl-engine/Stage ../webgl-engine/lib/Geometry ../webgl-engine/lib/Layer ../webgl-engine/lib/Object3D ../webgl-engine/lib/PreinterleavedGeometryData ../webgl-engine/lib/Texture ../webgl-engine/lib/Util ../webgl-engine/lib/TextureBackedBuffer/BufferManager ../webgl-engine/materials/DefaultMaterial module".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u,x,v,A,y,C,B,D,E,J,F,M,H,I,K,O,P,L,U,N,S,aa,V,T,Q,G,X,Z,ea,fa,R,da,ba,ca,ga,ja){function ha(a,b,c,d,e){var f=!1,g;b.encoding===L.DDS_ENCODING_STRING?g=da.DDS_ENCODING:f=!(ba.isPowerOfTwo(a.width)&&ba.isPowerOfTwo(a.height));c=((a=b.usedByEngineMats.some(function(a){return a.getParams().atlasRegions})||b.atlas)?d:c)&&!f;return{mipmap:c,wrapClamp:a||!b.wrap,disableAnisotropy:a&&c&&e,encoding:g,noUnpackFlip:!0}}function W(a){return G.isArrayBuffer(a.data)}function na(a,
b){for(var c=1024,d=0;d<a.length;d++)var e=a[d],c=c+(e.interleavedVertexData.byteLength+(e.indices?e.indices.byteLength:0)),c=c+(e.positionData.data.byteLength+e.positionData.indices.byteLength);for(a=0;a<b.length;a++)d=b[a],G.isArrayBuffer(d.data)&&(c+=d.data.byteLength);return c}var ka=X.ModelContentType,la=m.getLogger("esri.views.3d.layers.SceneLayerView3D"),w=[1,1,1,1],Ja=[.8,.8,.8],ta=[.5,.5,.5];h=function(h){function m(){var a=null!==h&&h.apply(this,arguments)||this;a._queryEngine=null;a._highlights=
new K(a);a._elevationProvider=null;a._worker=new H;a._workerThread=null;a._controllerCreated=!1;a._idbCache=new U.IDBCache("esri-scenelayer-cache","geometries",9);a._cancelCount=0;a._hasColors=!1;a._hasTextures=!1;a._hasData=!1;a.alwaysLoadEverythingModeEnabled=!1;a._cacheKeySuffix=null;a._definitionExpressionErrors=0;a._maxDefinitionExpressionErrors=20;return a}e(m,h);Object.defineProperty(m.prototype,"hasTexturesOrVertexColors",{get:function(){return this._hasData?this._hasTextures||this._hasColors?
"yes":"probably-not":"unknown"},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"rendererNeedsTextures",{get:function(){return L.rendererNeedsTextures(this.layer.renderer)},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"elevationOffset",{get:function(){var a=null!=this.layer?this.layer.elevationInfo:null;if(null!=a&&"absolute-height"===a.mode){var b=C.getMetersPerVerticalUnitForSR(this.layer.spatialReference),c=J.getMetersPerUnit(a.unit);return(a.offset||0)*c/
b}return 0},enumerable:!0,configurable:!0});m.prototype._enableSecretAlwayLoadMode=function(){this.layer.store.lodModel&&"always-load"===this.layer.store.lodModel&&(this.alwaysLoadEverythingModeEnabled=!0)};Object.defineProperty(m.prototype,"uncompressedTextureDownsamplingEnabled",{get:function(){return this.view.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled&&!this._useCompressedTextures},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"_useCompressedTextures",
{get:function(){var a=this.layer.version,a=!g("trident")||1<a.major||1===a.major&&3<a.minor;return this.view._stage.has("s3tc")&&a},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"_enableMipMaps",{get:function(){return!this.uncompressedTextureDownsamplingEnabled},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"_enableAtlasMipMaps",{get:function(){return this._enableMipMaps&&this.view._stage.has("standardDerivatives")},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,
"_atlasBiasCompensationEnabled",{get:function(){return!this.view._stage.has("shaderTextureLOD")&&this._enableAtlasMipMaps},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"_disableAtlasAnisotropy",{get:function(){return this._atlasBiasCompensationEnabled},enumerable:!0,configurable:!0});m.prototype.initialize=function(){var a=this;v.open(t.getAbsMid("./SceneLayerWorker",q,ja),{client:this}).then(function(b){a.destroyed?b.close():a._workerThread=b});L.checkSceneLayerValid(this.layer);
L.checkSceneLayerCompatibleWithView(this.layer,this.view);this._initGraphicsController();this.geoMemoryEstimate=this.texMemoryEstimate=this.gpuMemoryEstimate=0;this._stage=this.view._stage;this._isIntegratedMesh()||(this._edgeView=this._stage.view.getEdgeView());this._texId2Meta=new Map;this._nodeId2Meta=new Map;this._addThisLayerToStage();this._elevationProvider=new O({layerView:this,stageLayer:this._stageLayer});this.handles.add([x.init(this.view,"clippingArea",function(){return a._clippingAreaChanged()}),
x.init(this.layer,"renderer",function(b){return a._rendererChange(b)}),x.init(this.layer,"objectIdFilter",function(){return a._filterChange()}),x.init(this.layer,"elevationInfo",function(){return a._elevationInfoChanged()}),x.init(this.layer,"rangeInfos",function(b){return a._rangeInfosChanged(b)}),x.init(this,"_controller.parsedDefinitionExpression",function(){return a._filterChange()}),x.watch(this,"fullOpacity",function(b){return a._opacityChange(b)}),x.watch(this,["elevationOffset","rendererNeedsTextures"],
function(){return a._reloadAll()}),x.watch(this,"uncompressedTextureDownsamplingEnabled",function(){return a._reloadAll()}),x.init(this,"suspended",function(b){return a.setVisibility(!b)})],"sceneLayerHandles");this._idbCache.init();this._cacheKeySuffix=L.getCacheKeySuffix(this.layer.spatialReference,this.view.renderSpatialReference);this._componentColorManager=this._hasSymbolColors()?new ca.BufferManager(this._stage.view.renderingContext):null;this._enableSecretAlwayLoadMode()};m.prototype.destroy=
function(){this.handles.remove("sceneLayerHandles");this._workerThread&&(this._workerThread.close(),this._workerThread=null);this._removeThisLayerFromStage();this._stage=null;this._idbCache&&(this._idbCache.destroy(),this._idbCache=null);null!=this._controller&&(this._controller.destroy(),this._controller=null);this._highlights.destroy();this._nodeId2Meta=this._texId2Meta=null;this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle.remove(),
this._visibleGeometryChangedSchedulerHandle=null)};m.prototype.canResume=function(){return this.inherited(arguments)&&(!this._controller||this._controller.rootNodeVisible)};m.prototype.isUpdating=function(){return this._controllerCreated?!(!this._controller||!this._controller.updating):!0};m.prototype.memEstimateTextureAdded=function(a){a=a.getEstimatedTexMemRequiredMB();this.gpuMemoryEstimate+=a;this.texMemoryEstimate+=a;return a};m.prototype.memEstimateTextureRemoved=function(a){a=a.getEstimatedTexMemRequiredMB();
this.gpuMemoryEstimate-=a;this.texMemoryEstimate-=a;9.5367431640625E-7>this.gpuMemoryEstimate&&(this.texMemoryEstimate=this.gpuMemoryEstimate=0)};m.prototype.memEstimateGeometryAdded=function(a){a=a.estimateGpuMemoryUsage()/1048576;this.gpuMemoryEstimate+=a;this.geoMemoryEstimate+=a;return a};m.prototype.memEstimateGeometryRemoved=function(a){a=a.estimateGpuMemoryUsage()/1048576;this.gpuMemoryEstimate-=a;this.geoMemoryEstimate-=a;9.5367431640625E-7>this.gpuMemoryEstimate&&(this.texMemoryEstimate=
this.gpuMemoryEstimate=0)};m.prototype._isNodeLoaded=function(a){return this._nodeId2Meta.has(a.id)};m.prototype._initGraphicsController=function(){var a=this;this.layer.createGraphicsController({layerView:this,layerViewRequiredFunctions:{addNodeData:function(b,c){return a._addNodeData(b,c)},isNodeLoaded:function(b){return a._isNodeLoaded(b)},removeNodeData:function(b){return a._removeNodeData(b)},getLoadedNodeIDs:function(){return a._getLoadedNodeIDs()},getLoadedAttributes:function(b){return a._getLoadedAttributes(b)},
getAttributeData:function(b){return a._getAttributeData(b)},setAttributeData:function(b,c,d){return a._setAttributeData(b,c,d)},getMemoryUsage:function(){return a.view.resourceController.usedMemory}},layerViewOptionalFunctions:{setPolygonOffset:function(b,c){return a._setPolygonOffset(b,c?!0:!1)},textureOptions:{useCompressedTextures:this._useCompressedTextures},additionalCancelNodeLoadingHandler:function(){return a._cancel()},loadCachedNodeData:function(b,c){return a._loadCachedNodeData(b,c)},addCachedNodeData:function(b,
c,d){return a._addCachedNodeData(b,c,d)}}}).then(function(b){a._controller=b;b.watch("rootNodeVisible",function(){a.notifyChange("suspended")})}).always(function(){a._controllerCreated=!0;a.notifyChange("updating")})};m.prototype.getUsedMemory=function(){return this.gpuMemoryEstimate};m.prototype.getUnloadedMemory=function(){return this._controller?this._controller.getUnloadedMemoryEstimate():0};m.prototype.getCachedMemory=function(){return 0};m.prototype.removeCachedData=function(){this.suspended&&
this._removeAllNodeDataFromStage()};m.prototype.setVisibility=function(a){var b=this;this._nodeId2Meta.forEach(function(c){c=c.engineObject;c.setHidden(c.geometryRecords[0],!a);b._edgeView&&b._edgeView.updateObjectVisibility(c,a)});if(a){var c=this._isIntegratedMesh()?"im":"scene";this.view.elevationProvider.register(c,this._elevationProvider);this.visibleGeometryChanged()}else this.visibleGeometryChanged(),this.view.elevationProvider.unregister(this._elevationProvider)};m.prototype.getStats=function(){var a=
{index:0,nodes:this._nodeId2Meta.size.toString(),textures:this._texId2Meta.size,"Total GPU Memory Estimate":this.gpuMemoryEstimate+"MB","Geometry Memory Estimate":this.geoMemoryEstimate+"MB","Texture Memory Estimate":this.texMemoryEstimate+"MB"};this._controller&&(this._cachingEnabled()&&(a.cache=Math.round(100*this._idbCache.getHitRate())+"% hit"),this._controller.updateStats(a));return a};m.prototype._addThisLayerToStage=function(){for(var a=this._stage,b=new Uint8Array(256),c=0;c<b.length;c++)b[c]=
255;this._whiteTexture=new da(b,"white",{width:8,height:8});a.add(ka.TEXTURE,this._whiteTexture);b=this.layer.id;this._stageLayer=b=new ea(b,{},b);a.add(ka.LAYER,b);this._stage.addToViewContent([b.id])};m.prototype._removeThisLayerFromStage=function(){if(null!=this._stageLayer){var a=this._stage;a.remove(ka.TEXTURE,this._whiteTexture.id);this._removeAllNodeDataFromStage();ba.assert(0===this._nodeId2Meta.size);ba.assert(0===this._texId2Meta.size);a.remove(ka.LAYER,this._stageLayer.id);this._stageLayer=
void 0;this.gpuMemoryEstimate=0}};m.prototype._getLoadedAttributes=function(a){if(a=this._nodeId2Meta.get(a.id))return a.loadedAttributes};m.prototype._getAttributeData=function(a){if(a=this._nodeId2Meta.get(a.id))return a.attributeData};m.prototype._setAttributeData=function(a,b,c){var d=this._nodeId2Meta.get(a.id);d&&(d.loadedAttributes=b,d.attributeData=c,this._setObjectSymbology(d),this._addOrUpdateEdgeRendering(d),this._applyFilters(a),this.visibleGeometryChanged(d.engineObject))};m.prototype._getLoadedNodeIDs=
function(){return n.keysOfMap(this._nodeId2Meta)};m.prototype._calcEngineMaterialTransparencyParams=function(a,b,c){var d=this.fullOpacity,e=1-ba.clamp(ba.fallbackIfUndefined(b.transparency,0),0,1);a=1>e||1>d||a&&p.endsWith(a.channels,"a")||!0===b.useVertexColorAlpha||c;return{opacity:e,layerOpacity:d,transparent:a}};m.prototype._calcEngineMaterialDoubleSidedParams=function(a){return null!=a.doubleSided?a.doubleSided:!0};m.prototype._calcEngineMaterialCullFaceParams=function(a){return a.cullFace?
a.cullFace:null!=a.doubleSided?a.doubleSided?"none":"back":"none"};m.prototype._getMaterialParameters=function(a,b,c,d){var e;null!=a&&(e=(e=this._texId2Meta.get(b))&&e.engineTex?e.engineTex.id:this._whiteTexture.id);b=c.params;var f=ba.fallbackIfUndefined(b.diffuse,Ja);"standard"!==c.type&&la.warn("Unknown material type '"+c.type+"', must be 'standard'");c=this._isIntegratedMesh();d={ambient:f,diffuse:f,specular:ba.fallbackIfUndefined(b.specular,ta),atlasRegions:b.vertexRegions,textureId:e,vertexColors:this._hasVertexColors(),
componentIndices:this._hasSymbolColors(),componentColorBuffer:this._hasSymbolColors()&&d?d.textureBuffer:null,flipV:!1,doubleSided:this._calcEngineMaterialDoubleSidedParams(b),cullFace:this._calcEngineMaterialCullFaceParams(b),writeStencil:c,receiveSSAO:!c,groundNormalShading:c,compressedNormals:!c};c||(a=this._calcEngineMaterialTransparencyParams(a,b),p.mixin(d,a));return d};m.prototype._createEngineMaterial=function(a,b,c,d,e,f,g){var h=null!=b?this._getI3STexEncoding(b):null;g=this._getMaterialParameters(b,
c,d,g);g=new ga(g,e);g.metadata={i3sMatId:e,i3sTexId:c,i3sTex:b,i3sMatParams:d.params};if(null!=b){(d=this._texId2Meta.get(c))?d.usedByEngineMats.push(g):(d={id:c,usedByEngineMats:[g],images:b.images,encoding:h,atlas:!0===b.atlas,wrap:"none"!==b.wrap[0]||"none"!==b.wrap[1]},this._texId2Meta.set(c,d));a:{for(b=0;b<f.length;b++)if(h=f[b],h.i3sTexId===c){c=h.data;break a}c=null}null!=c&&null==d.engineTex&&(f=ha(c,d,this._enableMipMaps,this._enableAtlasMipMaps,this._disableAtlasAnisotropy),d.engineTex=
new da(c,d.id,f),this._stage.add(ka.TEXTURE,d.engineTex),a.memory+=this.memEstimateTextureAdded(d.engineTex));if(null!=d.engineTex)for(a=d.engineTex.id,c=0,f=d.usedByEngineMats;c<f.length;c++)f[c].setParameterValues({textureId:a})}return g};m.prototype._getI3STexEncoding=function(a){var b=L.getAppropriateTextureEncoding(a.encoding,this._useCompressedTextures);return-1<b?a.encoding[b]:a.encoding};m.prototype._getVertexBufferLayout=function(a,b){var c=a.params.materialID,d=b.materialDefinitions[c];
ba.assert(void 0!==d,"geometry wants unknown material "+c);a=a.params.textureID||"none";var e;"none"!==a&&(null!=b.textureDefinitions&&null!=b.textureDefinitions[a]||la.warn("textureDefinitions missing in shared resource"),e=b.textureDefinitions[a]);b=this._getMaterialParameters(e,a,d);return ga.getVertexBufferLayout(b)};m.prototype._createEngineMat=function(a,b,c,d,e){var f=b.params.materialID,g=c.materialDefinitions[f];ba.assert(void 0!==g,"geometry wants unknown material "+f);b=b.params.textureID||
"none";var h;"none"!==b&&(null!=c.textureDefinitions&&null!=c.textureDefinitions[b]||la.warn("textureDefinitions missing in shared resource"),h=c.textureDefinitions[b]);return this._createEngineMaterial(a,h,b,g,f,d,e)};m.prototype._getObjectIdField=function(){return this.layer.objectIdField||"OBJECTID"};m.prototype._findGraphicNodeAndIndex=function(a){var b=N.attributeLookup(a.attributes,this._getObjectIdField()),c=null;this._nodeId2Meta.forEach(function(a,d){c||(d=a.featureIds.indexOf(b),-1!==d&&
(c={node:a.node,index:d}))});return c};m.prototype._getGraphicIndices=function(a,b){a=this._nodeId2Meta.get(a.id);if(!a)return[];for(var c=[],d=this._getObjectIdField(),e=0;e<b.length;e++){var f=N.attributeLookup(b[e].attributes,d),f=a.featureIds.indexOf(f);-1!==f&&c.push(f)}return c};m.prototype.whenGraphicBounds=function(a){a=this._findGraphicNodeAndIndex(a);if(!a)return r.reject();var b=this._nodeId2Meta.get(a.node.id).engineObject;a=this._boundingBoxCornerPoints(a.index,b,new Float64Array(24));
if(Q.bufferToBuffer(a,this.view.renderSpatialReference,0,a,this.view.spatialReference,0,8))return b=y.empty(),y.expandWithBuffer(b,a,0,8),r.resolve({boundingBox:b,screenSpaceObjects:[]})};m.prototype.whenGraphicAttributes=function(a,b){var c=this;return L.whenGraphicAttributes(this.layer,[a],this._getObjectIdField(),b,function(){var b=c._findGraphicNodeAndIndex(a);return{node:b.node,indices:[b.index]}},{ignoreUnavailableFields:!0,populateObjectId:!0}).then(function(a){return a[0]})};m.prototype.getGraphicFromStageObject=
function(a,b){if(this.layer instanceof B)return r.reject();var c=this._getMetadata(a);a=a.getComponentFromTriangleNr(0,b);return null!=a&&null!=c.featureIds&&a<c.featureIds.length?(c=this._createGraphic(a,c),r.resolve(c)):r.reject()};m.prototype._getMetadata=function(a){a=a.getMetadata();return this._nodeId2Meta.get(a.i3sNode)};m.prototype._getCacheKey=function(a){return a.baseUrl+this._cacheKeySuffix};m.prototype._cachingEnabled=function(){return!this._controller.disableCache&&0===this.elevationOffset&&
null!=this._cacheKeySuffix};m.prototype._cancel=function(){this._cancelCount=this._cancelCount+1|0};m.prototype._handleCancelled=function(a){if(0<(this._cancelCount-a|0))throw new c;};m.prototype._loadCachedNodeData=function(a,b){var c=this,d=this._cancelCount;return this._cachingEnabled()?this._idbCache.get(this._getCacheKey(a)).then(function(e){if(null==e)return null;c._handleCancelled(d);if(e.nodeVersion!==a.version)return c._idbCache.remove(c._getCacheKey(a)),null;a.obb||(a.obb=T.clone(e.nodeObb),
c._controller.updateVisibility(a.id));var f=function(a){if(null==a.data)return!0;var b=c._getI3STexEncoding(e.sharedResource.textureDefinitions[a.i3sTexId]);return a.encoding!==b};return c.rendererNeedsTextures&&e.textureData.some(f)?b(e.allGeometryData,e.sharedResource).then(function(b){e.textureData=b;b.every(W)&&c._idbCache.put(c._getCacheKey(a),e).catch(function(b){return la.warn("Failed to update node with textures in IndexedDB cache: "+a.id+": "+b)});c._handleCancelled(d);return e}):e}):r.resolve(null)};
m.prototype._addNodeData=function(a,b){var c=this;return this._transformBundle(a,b).then(function(d){a.obb||(a.obb=d.obb,c._controller.updateVisibility(a.id));d={allGeometryData:b.allGeometryData,transformedGeometries:d.transformedGeometries,textureData:b.textureData,sharedResource:b.sharedResource,nodeVersion:a.version,nodeObb:a.obb,byteSize:na(d.transformedGeometries,b.textureData)};if(c._cachingEnabled()){var e=d.textureData.map(function(a){return W(a)?a:{i3sTexId:a.i3sTexId,encoding:a.encoding,
data:null}});c._idbCache.put(c._getCacheKey(a),{allGeometryData:d.allGeometryData,transformedGeometries:d.transformedGeometries,textureData:e,sharedResource:d.sharedResource,nodeVersion:d.nodeVersion,nodeObb:d.nodeObb,byteSize:d.byteSize}).catch(function(b){return la.warn("Failed to store node in IndexedDB cache: "+a.id+": "+b)})}return c._addCachedNodeData(a,d,b.attributeDataInfo)})};m.prototype._transformBundle=function(a,b){for(var c=[],d=[b.geometryBuffer],e=0,f=b.allGeometryData;e<f.length;e++)for(var g=
0,h=f[e].geometries;g<h.length;g++)c.push(this._getVertexBufferLayout(h[g],b.sharedResource));a={geometryBuffer:b.geometryBuffer,geometryData:b.allGeometryData,layouts:c,center:a.mbs,obb:a.obb,elevationOffset:this.elevationOffset,hasColors:this._hasColors,needNormals:!this._isIntegratedMesh()&&this._controller.isMeshPyramid,normalReferenceFrame:this.layer.normalReferenceFrame||"none",indexSR:this._controller.crsIndex.toJSON(),vertexSR:this._controller.crsVertex.toJSON(),renderSR:this.view.renderSpatialReference.toJSON()};
return this._workerThread?this._workerThread.invoke("process",a,d):r.resolve(this._worker.transform(a))};m.prototype._addCachedNodeData=function(a,b,c){var d=this;if(this._nodeId2Meta.has(a.id))return this._addOrUpdateEdgeRendering(this._nodeId2Meta.get(a.id)),this._applyFilters(a),r.resolve();if(!this.alwaysLoadEverythingModeEnabled&&!this._controller.isGeometryVisible(a))return r.resolve();var e=b.allGeometryData,f=b.transformedGeometries,g=b.textureData;b=b.sharedResource;if(0===e.length)return r.resolve();
1!==e.length&&console.warn("Node with",e.length,"geometries is unsupported");if(!this.rendererNeedsTextures)for(var h=0;h<g.length;h++)g[h].data=null;var k={};k[ka.OBJECT]={};k[ka.GEOMETRY]={};k[ka.MATERIAL]={};var h=0,l=!1;a.memory=0;var m=e[0],e=m.componentOffsets,n=m.geometries,m=m.featureIds,p=null,u=null;if(this._hasSymbolColors())for(var p=this._componentColorManager.getBuffer(m.length),u=new Uint16Array(m.length),t=0;t<m.length;t++)u[t]=p.aquireIndex();for(var t=a.id+"|"+m[0],v=[],q=[],x=[],
w,A=0;A<n.length;A++){var y=n[A],B=this._createEngineMat(a,y,b,g,p);w=f[h++];var l=l||w.hasColors,C=new R(new Float32Array(w.interleavedVertexData),w.layout,w.positionData,e||R.DefaultOffsets,w.indices||R.DefaultIndices);this._hasSymbolColors()&&this._setComponentIndices(C,u);w=w.corMatrices;var Q=V.mat4d.create(w.localTrafo);null!=y.transformation&&V.mat4d.multiply(Q,y.transformation,Q);y=v.length;C=new Z(C,t+(0<y?"_"+y:""));v.push(C);q.push(Q);x.push([B]);a.memory+=this.memEstimateGeometryAdded(C.getData());
k[ka.MATERIAL][B.id]=B;k[ka.GEOMETRY][C.id]=C}var T=new fa({idHint:a.id,name:t,geometries:v,materials:x,transformations:q,castShadow:!0,metadata:{i3sNode:a.id,layerUid:this.layer.uid}}),f=V.mat4d.create();V.mat4d.identity(f);V.mat4d.multiply(f,w.globalTrafo,f);T.setObjectTransformation(f);k[ka.OBJECT][T.id]=T;var G={node:a,engineObject:T,featureIds:m,attributeData:c?c.attributeData:null,loadedAttributes:c?c.loadedAttributes:null,componentColorBuffer:p,componentIndices:u};return r.create(function(b){d._addOrUpdateEdgeRendering(G).then(function(){if(d._nodeId2Meta.has(a.id))d._edgeView&&
d._edgeView.removeObject(G.engineObject);else{d._nodeId2Meta.set(a.id,G);d._setObjectSymbology(G);d._applyFilters(a);d._highlights.objectCreated(T);d.visibleGeometryChanged(T);var c=d._stageLayer,e=d._stage;e.beginMod();var f=k[ka.OBJECT],g;for(g in f)f.hasOwnProperty(g)&&c.addObject(f[g]);for(var h in k)if(k.hasOwnProperty(h)){var c=k[h],m;for(m in c)c.hasOwnProperty(m)&&null==e.get(h,m)&&e.add(h,c[m])}e.endMod();!d._hasTextures&&null!=a.textureData&&0<a.textureData.length&&(d._hasTextures=!0);d._hasColors||
(d._hasColors=l);d._hasData=!0;d.notifyChange("hasTexturesOrVertexColors")}b()})})};m.prototype._clippingAreaChanged=function(){var a=this,b=y.create();Q.extentToBoundingBox(this.view.clippingArea,b,this.view.renderSpatialReference)?this._clippingArea=b:this._clippingArea=null;this._updateFilters();this._nodeId2Meta.forEach(function(b){return a._applyFilters(b.node)});this._controller&&this._controller.updateClippingArea(this.view.clippingArea)};m.prototype._filterChange=function(){var a=this;this._updateFilters();
this._nodeId2Meta.forEach(function(b){return a._applyFilters(b.node)})};m.prototype._updateFilters=function(){var a=this,b=[];if(this.layer.objectIdFilter){var c=new Float64Array(this.layer.objectIdFilter.ids),d="include"===this.layer.objectIdFilter.method;c.sort();b.push(function(b,e){return a._objectIdFilter(c,d,e)})}if(this._controller&&this._controller.parsedDefinitionExpression&&this._controller.definitionExpressionFields){this._definitionExpressionErrors=0;var e=this._controller.parsedDefinitionExpression,
f=this._controller.definitionExpressionFields;b.push(function(b,c){return a._sqlFilter(b,e,f,c)})}this._clippingArea&&b.push(function(b,c){return a._boundingboxFilter(b,a._clippingArea,c)});this._filters=b};m.prototype._sqlFilter=function(a,b,c,d){var e={},g=new f(null,null,e);g.layer=this.layer;g.sourceLayer=this.layer;var h=this.layer.objectIdField,k=0,l=0,m=this._nodeId2Meta.get(a.id);a=m.featureIds;for(var n=m.attributeData,m=c.every(function(a){return null!=n[a]||a===h}),p=0;p<a.length&&k<d.length;p++)if(d[k]===
a[p]){var u=!0;if(m){e[h]=a[p];for(var u=0,t=c;u<t.length;u++){var r=t[u];r!==h&&(e[r]=L.getCachedAttributeValue(n[r],p))}u=this._evaluateClause(b,g)}u&&(d[l]=d[k],l++);k++}d.length=l};m.prototype._evaluateClause=function(a,b){try{return a.testFeature(b)}catch(Ka){return this._definitionExpressionErrors<this._maxDefinitionExpressionErrors&&la.error("Error while evaluating definitionExpression: "+Ka),this._definitionExpressionErrors++,this._definitionExpressionErrors===this._maxDefinitionExpressionErrors&&
la.error("Further errors are ignored"),!1}};m.prototype._objectIdFilter=function(a,b,c){for(var d=0,e=0;d<c.length;)0<=k.binaryIndexOf(a,c[d])===b&&(c[e]=c[d],e++),d++;c.length=e};m.prototype._boundingboxFilter=function(a,b,c){var d=[0,0,0,0];Q.mbsToMbs(a.mbs,this._controller.crsIndex,d,this.view.renderSpatialReference);d=null!=b?L.intersectBoundingBoxWithMbs(b,d):2;if(2!==d)if(0===d)c.length=0;else{var e=d=0,f=this._nodeId2Meta.get(a.id);a=f.featureIds;var g=f.engineObject.getObjectTransformation(),
h=f.engineObject.getGeometryRecords()[0].getShaderTransformation();V.mat4d.multiply(g,h);if(0===g[1]&&0===g[2]&&0===g[3]&&0===g[4]&&0===g[6]&&0===g[7]&&0===g[8]&&0===g[9]&&0===g[11]&&1===g[15]){h=Sa;h[0]=(b[0]-g[12])/g[0];h[1]=(b[1]-g[13])/g[5];h[2]=(b[2]-g[14])/g[10];h[3]=(b[3]-g[12])/g[0];h[4]=(b[4]-g[13])/g[5];h[5]=(b[5]-g[14])/g[10];b=f.engineObject.getGeometryRecords()[0].geometry;f=b.getComponentCount();for(g=0;g<f&&d<c.length;g++)if(c[d]===a[g]){var k=b.getComponentAABB(g,Ga);y.intersects(h,
k)&&(c[e]=c[d],e++);d++}c.length=e}}};m.prototype._addOrUpdateEdgeRendering=function(a){return d(this,void 0,void 0,function(){var c,d,e,f,g,h;return b(this,function(b){switch(b.label){case 0:if(!this._edgeView)return[2];c=a.engineObject;d=this._edgeView.hasObject(c);e=this._extractObjectEdgeMaterials(a);f=e.hasEdges;g=e.perFeatureEdgeMaterials;h=!c.isHidden(c.geometryRecords[0]);if(!d)return[3,1];this._edgeView.updateAllComponentMaterials(c,g);this._edgeView.updateObjectVisibility(c,h);return[3,
3];case 1:return h&&f?[4,this._edgeView.addObject(c,g)]:[3,3];case 2:b.sent(),b.label=3;case 3:return[2]}})})};m.prototype._applyFilters=function(a){var b=this._nodeId2Meta.get(a.id);b&&this._applyFiltersToObjects(a,b)};m.prototype.unhideEdgesForAllFeatures=function(a){a=a.engineObject;this._edgeView&&this._edgeView.hasObject(a)&&this._edgeView.updateAllComponentOpacities(a,this.fullOpacity)};m.prototype._applyFiltersToObjects=function(a,b){var c=b.engineObject;c.unhideAllComponents();if(0===this._filters.length)this.unhideEdgesForAllFeatures(b);
else{for(var d=b.featureIds,e=d.slice(),f=0,g=this._filters;f<g.length;f++)(0,g[f])(a,e);if(e.length===d.length)this.unhideEdgesForAllFeatures(b);else{a=0;f=c.getGeometryRecords()[0];b=Array(b.featureIds.length);for(var g=this.fullOpacity,h=0;h<d.length;h++){var k=d[h];a>=e.length||e[a]!==k?(c.setComponentVisibility(f,h,!1),b[h]=0):(a++,b[h]=g)}this._edgeView&&this._edgeView.hasObject(c)&&this._edgeView.updateAllComponentOpacities(c,b)}}};m.prototype._removeAllNodeDataFromStage=function(){var a=this;
this._nodeId2Meta.forEach(function(b,c){return a._removeNodeStageData(c)})};m.prototype._removeNodeData=function(a){var b=this;a.forEach(function(a){return b._removeNodeStageData(a.id)})};m.prototype._removeNodeStageData=function(a){var b=this._nodeId2Meta.get(a);if(b){var c=this._stage,d=this._stageLayer,e=b.engineObject;this._highlights.objectDeleted(e);this._edgeView&&this._edgeView.removeObject(e);this.visibleGeometryChanged(e);d.removeObject(e);for(var d=0,f=e.getGeometryRecords();d<f.length;d++){var g=
f[d];this.memEstimateGeometryRemoved(g.geometry.getData());c.remove(ka.GEOMETRY,g.geometry.id);for(var h=0,g=g.materials;h<g.length;h++)this._removeMaterial(g[h],c)}if(b.componentIndices){for(d=0;d<b.componentIndices.length;d++)b.componentColorBuffer.releaseIndex(b.componentIndices[d]);this._componentColorManager.garbageCollect()}c.remove(ka.OBJECT,e.id);this._nodeId2Meta.delete(a)}};m.prototype._removeMaterial=function(a,b){b.remove(ka.MATERIAL,a.id);var c=a.metadata.i3sTexId||"none";if("none"!==
c){var d=this._texId2Meta.get(c),e=d.usedByEngineMats;a=e.indexOf(a);-1<a?(e[a]=e[e.length-1],e.pop()):la.error("Missing reference from material to texture");0===e.length&&((e=d.engineTex)&&e!==this._whiteTexture&&(this.memEstimateTextureRemoved(e),b.remove(ka.TEXTURE,d.engineTex.id)),this._texId2Meta.delete(c))}};m.prototype._setPolygonOffset=function(a,b){var c=this._nodeId2Meta.get(a.id);if(c)for(a=0,c=c.engineObject.getGeometryRecords();a<c.length;a++)for(var d=0,e=c[a].materials;d<e.length;d++)e[d].setParameterValues({polygonOffset:b})};
m.prototype._rendererChange=function(a){(this._currentRenderer=a)&&(a.colorInfo||a.sizeInfo)&&la.warn("renderer.colorInfo and renderer.sizeInfo are not supported for Scene Services. Use visualVariables instead.");if(a){var b=0;for(a=a.getSymbols();b<a.length;b++){var c=a[b];"mesh-3d"!==c.type&&la.error("Symbols of type '"+c.type+"' are not supported for 3D Object Scene Services.")}}this.view.resourceController.setMemoryDirty()};m.prototype._getRenderingInfo=function(a,b){var c=this._currentRenderer,
d=c&&c.getSymbol(a);if(!(d instanceof E&&this._hasSymbolColors()))return null;var e,f;if(c&&c.visualVariables)for(a=c.getVisualVariableValues(a),c=0;c<a.length;c++){var g=a[c],h=g.variable.type;"color"===h?e=g.value:"opacity"===h&&(f=g.value)}b.symbol=d;b.color=e?[e.r/255,e.g/255,e.b/255]:null;b.opacity=null!=f?f:e&&null!=e.a?e.a:null;return b};m.prototype._getSymbolFillMaterial=function(a,b){var c=0;for(a=a.symbolLayers.items;c<a.length;c++){var d=a[c];if("fill"===d.type){c=d.material;a=null!=c?
c.color:null;null!=a?(va[0]=a.r/255,va[1]=a.g/255,va[2]=a.b/255,va[3]=a.a,b.color=va):b.color=null;b.colorMixMode=null!=c?c.colorMixMode:null;return}}b.color=null;b.colorMixMode=null};m.prototype._hasSymbolColors=function(){if(this._isIntegratedMesh()||!this.layer.store.defaultGeometrySchema)return!1;var a=this.layer.store.defaultGeometrySchema.featureAttributes;return!!(a&&a.faceRange&&a.id)};m.prototype._isIntegratedMesh=function(){return this.layer instanceof B};m.prototype._hasVertexColors=function(){return null!=
this.layer.store.defaultGeometrySchema.vertexAttributes.color&&(null==this.layer.cachedDrawingInfo||!this.layer.cachedDrawingInfo.color)};m.prototype._extractObjectEdgeMaterials=function(a){for(var b=[],c=a.featureIds?a.featureIds.length:1,d=this.layer.objectIdField,e=new f(null,null,{}),g=e.attributes,h=this._currentRenderer&&this._currentRenderer.requiredFields,k,l=this._edgeView.createSolidEdgeMaterial({color:[0,0,0,0],opacity:0}),m=this.fullOpacity,n=!1,p=0;p<c;p++){k=l;null!=d&&null!=a.featureIds&&
(g[d]=a.featureIds[p]);if(null!=h&&null!=a.attributeData)for(var u=0,t=Object.keys(a.attributeData);u<t.length;u++){var r=t[u];g[r]=L.getCachedAttributeValue(a.attributeData[r],p)}r=this._getRenderingInfo(e,wa);u=a.engineObject;u=u.getComponentVisibility(u.getGeometryRecords()[0],p)?m:0;if(r&&r.symbol instanceof E)for(t=0,r=r.symbol.symbolLayers.items;t<r.length;t++){var v=r[t];if(v instanceof D&&(v=S.createMaterial(this._edgeView,v,u))){n=!0;k=v;break}}b.push(k)}return{hasEdges:n,perFeatureEdgeMaterials:b}};
m.prototype._setObjectSymbology=function(a){if(this._hasSymbolColors()){for(var b=a.featureIds?a.featureIds.length:1,c=new f(null,null,{}),d=c.attributes,e=this.layer.objectIdField,g=this._currentRenderer&&this._currentRenderer.requiredFields,h=!1,k=new Uint8Array(4),l={color:null,colorMixMode:null},m=[0,0,0,0],n=null,p=0;p<b;p++){null!=e&&null!=a.featureIds&&(d[e]=a.featureIds[p]);if(null!=g&&null!=a.attributeData)for(var u=0,t=Object.keys(a.attributeData);u<t.length;u++){var r=t[u];d[r]=L.getCachedAttributeValue(a.attributeData[r],
p)}(t=this._getRenderingInfo(c,wa))?(t.symbol!==n&&(n=t.symbol,this._getSymbolFillMaterial(t.symbol,l)),u=t.color,t=t.opacity,u=null==u||null==t?I.overrideColor(u,t,l.color,l.color&&l.color[3],w,m):I.overrideColor(u,t,null,null,w,m),1>u[3]&&(h=!0),L.encodeSymbolColor(u,l.colorMixMode,k)):L.encodeSymbolColor(null,null,k);a.componentColorBuffer.textureBuffer.setData(a.componentIndices[p],0,k[0],k[1],k[2],k[3])}this._updateObjectOpacity(a.engineObject,h)}};m.prototype._setComponentIndices=function(a,
b){for(var c=a.getAttribute(ba.VertexAttrConstants.COMPONENTINDEX),d=c.data,e=c.offsetIdx,c=c.strideIdx,f=a.getIndices(ba.VertexAttrConstants.COMPONENTINDEX),g=0;g<b.length;g++)for(var h=a.componentOffsets[g+1],k=a.componentOffsets[g];k<h;k++)d[e+f[k]*c]=b[g]};m.prototype._elevationInfoChanged=function(){var a=this.layer.elevationInfo&&this.layer.elevationInfo.unit;a&&!J.supportsUnit(a)&&la.warn("elevationInfo.unit","'"+a+"' is not a valid unit")};m.prototype._rangeInfosChanged=function(a){null!=
a&&0<a.length&&la.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")};m.prototype._reloadAll=function(){this._removeAllNodeDataFromStage();null!=this._controller&&this._controller.restartNodeLoading()};m.prototype._opacityChange=function(a){var b=this;this._nodeId2Meta.forEach(function(a){b._updateObjectOpacity(a.engineObject);b._addOrUpdateEdgeRendering(a)})};m.prototype._updateObjectOpacity=function(a,b){var c=0;for(a=a.getGeometryRecords();c<
a.length;c++)for(var d=0,e=a[c].materials;d<e.length;d++){var f=e[d],g=f.metadata;void 0!==b&&(g.symbolIsTransparent=b);var h=f.getParams(),g=this._calcEngineMaterialTransparencyParams(g.i3sTex,g.i3sMatParams,g.symbolIsTransparent);h.transparent===g.transparent&&h.layerOpacity===g.layerOpacity||f.setParameterValues(g)}};m.prototype.queryExtent=function(a){return this._ensureQueryEngine().queryExtent(a)};m.prototype.queryFeatureCount=function(a){return this._ensureQueryEngine().queryFeatureCount(a)};
m.prototype.queryFeatures=function(a){return this._ensureQueryEngine().queryFeatures(a)};m.prototype.queryObjectIds=function(a){return this._ensureQueryEngine().queryObjectIds(a)};m.prototype._ensureQueryEngine=function(){this._queryEngine||(this._queryEngine=this._createQueryEngine());return this._queryEngine};m.prototype._createQueryEngine=function(){var a=this,b={id:0,index:0,meta:null,bbCorners:new Float64Array(24)};return new P(this.layer,{forAll:function(c,d){a._forAllFeatures(function(d,e,
f){b.id=d;b.index=e;b.meta=f;a._boundingBoxCornerPoints(e,f.engineObject,b.bbCorners);c(b)},d)},createGraphic:function(b){return a._createGraphic(b.index,b.meta)},requestFields:function(b,c,d){return L.whenGraphicAttributes(a.layer,c,a._getObjectIdField(),d,function(){var d=a._getGraphicIndices(b,c);return{node:b,indices:d}},{ignoreUnavailableFields:!1})},createExtentBuilder:function(){return a._createExtentBuilder()}},{enableObjectId:!0,enableOutFields:!!this.layer.objectIdField})};m.prototype._createExtentBuilder=
function(){var a=this.view.renderSpatialReference,b=this.view.spatialReference,c=y.empty(),d=new Float64Array(24);return{add:function(e){Q.bufferToBuffer(e.bbCorners,a,0,d,b,0,8)&&y.expandWithBuffer(c,d,0,8)},getExtent:function(){return y.toExtent(c,b)}}};m.prototype._forAllFeatures=function(a,b,c){var d=this;this._nodeId2Meta.forEach(function(e,f){d._forAllFeaturesOfNode(e,a,c);b&&b(e.node)})};m.prototype._forAllFeaturesOfNode=function(a,b,c){for(var d=a.featureIds,e=a.engineObject.getGeometryRecords()[0],
f=0;f<d.length;f++)(c||a.engineObject.getComponentVisibility(e,f))&&b(d[f],f,a,e)};m.prototype._createGraphic=function(a,b){var c={};null!=b.featureIds&&(c[this._getObjectIdField()]=b.featureIds[a]);if(null!=b.attributeData)for(var d=0,e=Object.keys(b.attributeData);d<e.length;d++){var g=e[d];c[g]=L.getCachedAttributeValue(b.attributeData[g],a)}a=new f(null,null,c);a.layer=this.layer;a.sourceLayer=this.layer;return a};m.prototype._boundingBoxCornerPoints=function(a,b,c){a=b.geometries[0].getComponentAABB(a,
Sa);for(var d=0;8>d;++d)sa[0]=d&1?a[0]:a[3],sa[1]=d&2?a[1]:a[4],sa[2]=d&4?a[2]:a[5],V.mat4d.multiplyVec3(b.objectTransformation,sa),c[3*d]=sa[0],c[3*d+1]=sa[1],c[3*d+2]=sa[2];return c};m.prototype.highlight=function(a,b){var c=this,d=this._highlights;if(a instanceof F){b=d.acquireSet(b);var e=b.set,g=b.handle;this.queryObjectIds(a).then(function(a){return d.setFeatureIds(e,a)});return g}if("number"===typeof a||a instanceof f)return this.highlight([a],b);a instanceof l&&(a=a.toArray());if(Array.isArray(a)&&
0<a.length){if(a[0]instanceof f)return a=a.map(function(a){return N.attributeLookup(a.attributes,c._getObjectIdField())}),g=d.acquireSet(b),b=g.set,g=g.handle,d.setFeatureIds(b,a),g;if("number"===typeof a[0])return g=d.acquireSet(b),b=g.set,g=g.handle,d.setFeatureIds(b,a),g}return{remove:function(){}}};m.prototype.visibleGeometryChanged=function(a){var b=this;a?this._elevationProvider.objectChanged(a):this._elevationProvider.layerChanged();null==this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle=
u.schedule(function(){b.emit("visible-geometry-changed");b._visibleGeometryChangedSchedulerHandle=null}))};a([A.property()],m.prototype,"layer",void 0);a([A.property()],m.prototype,"_controller",void 0);a([A.property({dependsOn:["_controller.updating"]})],m.prototype,"updating",void 0);a([A.property(aa.updatingPercentage)],m.prototype,"updatingPercentage",void 0);a([A.property({readOnly:!0,aliasOf:"_controller.updatingPercentage"})],m.prototype,"updatingPercentageValue",void 0);a([A.property({readOnly:!0})],
m.prototype,"hasTexturesOrVertexColors",null);a([A.property({readOnly:!0,dependsOn:["layer.renderer"]})],m.prototype,"rendererNeedsTextures",null);a([A.property({readOnly:!0,dependsOn:["layer.elevationInfo"]})],m.prototype,"elevationOffset",null);a([A.property()],m.prototype,"alwaysLoadEverythingModeEnabled",void 0);a([A.property({dependsOn:["view.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled","_useCompressedTextures"]})],m.prototype,"uncompressedTextureDownsamplingEnabled",
null);a([A.property({dependsOn:["layer.version"]})],m.prototype,"_useCompressedTextures",null);return m=a([A.subclass("esri.views.3d.layers.SceneLayerView3D")],m)}(A.declared(M));var sa=V.vec3d.create(),Sa=y.create(),Ga=y.create(),va=[0,0,0,0],wa={symbol:null};return h})},"esri/views/3d/layers/LayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../geometry/support/heightModelInfoUtils ../../layers/LayerView".split(" "),
function(q,h,e,a,d,b,g,c,f){return function(f){function h(){var a=null!==f&&f.apply(this,arguments)||this;a.supportsHeightUnitConversion=!1;return a}e(h,f);h.prototype.postscript=function(a){this.inherited(arguments);c.mayHaveHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())};h.prototype._validateHeightModelInfo=function(){var a=this;return d.create(function(d,e){b.whenFalseOnce(a.view.defaultsFromMap,"isHeightModelInfoSearching",function(){var b=c.rejectLayerError(a.layer,
a.view.heightModelInfo,a.supportsHeightUnitConversion);b?e(b):d()})})};a([g.property()],h.prototype,"view",void 0);return h=a([g.subclass("esri.views.3d.layers.LayerView3D")],h)}(g.declared(f))})},"esri/views/3d/layers/SceneLayerWorker":function(){define("require exports ../../../core/promiseUtils ../../../geometry/SpatialReference ./i3s/I3SGeometryUtil ./i3s/I3SProjectionUtil ../lib/glMatrix ../support/meshProcessing ../support/orientedBoundingBox ../support/projectionUtils ../webgl-engine/lib/PreinterleavedGeometryData ../webgl-engine/lib/Util".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l){q=function(){function h(){}h.prototype.process=function(a){var b=[a.geometryBuffer];return e.resolve({result:this.transform(a,b),transferList:b})};h.prototype.transform=function(e,h){var m=a.fromJSON(e.indexSR),u=a.fromJSON(e.vertexSR),t=a.fromJSON(e.renderSR),r=!1,q=0,x=[],E=e.obb?null:f.create([0,0,0],[-1,-1,-1],[0,0,0,1]);g.vec3d.set(e.center,p);p[2]+=e.elevationOffset;var J=g.mat4d.create();k.computeLinearTransformation(m,p,J,t);for(var F=0,M=e.geometryData;F<
M.length;F++)for(var H=M[F],I=H.componentOffsets,K=0,H=H.geometries;K<H.length;K++){var O=H[K],P=e.layouts[q];++q;var L=d.interleaveGeometryBuffer(O,e.geometryBuffer,P,[{name:l.VertexAttrConstants.COLOR,byteValue:255}],[l.VertexAttrConstants.NORMAL,l.VertexAttrConstants.NORMALCOMPRESSED,l.VertexAttrConstants.SYMBOLCOLOR,l.VertexAttrConstants.COMPONENTINDEX]),U=new n(new Float32Array(L),P),N=U.getAttribute(l.VertexAttrConstants.POSITION),S=b.reprojectPoints(N,e.center,e.elevationOffset,m,u,t);E&&this._updateObb(E,
N,J);e.needNormals&&(N={normals:U.getAttribute(l.VertexAttrConstants.NORMALCOMPRESSED),positions:N,normalInd:U.getIndices(l.VertexAttrConstants.NORMALCOMPRESSED),positionInd:U.getIndices(l.VertexAttrConstants.POSITION)},d.processAndInterleaveNormals(e.normalReferenceFrame,O,e.geometryBuffer,S.globalTrafo,N));(O=U.getAttribute(l.VertexAttrConstants.COMPONENTINDEX))&&this._createComponentNumbers(O,I);(U=U.getAttribute(l.VertexAttrConstants.COLOR))&&!r&&(r=this._hasColors(U));U=P[0].stride;U=c.deduplicate(L,
U/4,1-.8*U/(U+4));null!=U?(L=65536>U.uniqueCount?new Uint16Array(U.indices):U.indices,O=d.extractPositionData(U.buffer,P,L),x.push({layout:P,interleavedVertexData:U.buffer,indices:L,corMatrices:S,hasColors:r,positionData:O}),h&&(h.push(U.buffer),h.push(L.buffer),h.push(O.data.buffer),h.push(O.indices.buffer))):(O=d.extractPositionData(L,P),x.push({layout:P,interleavedVertexData:L,corMatrices:S,hasColors:r,positionData:O}),h&&(h.push(L),h.push(O.data.buffer),h.push(O.indices.buffer)))}E&&(g.mat4d.multiplyVec3(J,
E.center,E.center),k.vectorToVector(E.center,t,E.center,u),E.center[2]-=e.elevationOffset);return{geometryBuffer:e.geometryBuffer,transformedGeometries:x,obb:E}};h.prototype._hasColors=function(a){var b=a.data,c=a.size,d=a.strideIdx;for(a=a.offsetIdx;a<b.length;a+=d)for(var e=0;e<c;e++)if(255!==b[a+e])return!0;return!1};h.prototype._createComponentNumbers=function(a,b){var c=a.data,d=a.strideIdx,e=c.length/d,f=0;a=a.offsetIdx;for(var g=0;g<e;g++)g>=b[f+1]&&f++,c[a]=f,a+=d};h.prototype._updateObb=
function(a,b,c){if(0<a.halfSize[0]){g.vec3.subtract(a.center,a.halfSize,p);g.vec3.add(a.center,a.halfSize,m);for(c=b.offsetIdx;c<b.data.length;c+=b.strideIdx)p[0]=Math.min(p[0],b.data[c]),p[1]=Math.min(p[1],b.data[c+1]),p[2]=Math.min(p[2],b.data[c+2]),m[0]=Math.max(m[0],b.data[c]),m[1]=Math.max(m[1],b.data[c+1]),m[2]=Math.max(m[2],b.data[c+2]);g.vec3.subtract(m,p,a.halfSize);g.vec3d.scale(a.halfSize,.5);g.vec3d.add(p,m,a.center);g.vec3d.scale(a.center,.5)}else f.compute(b,a),b=2*Math.sqrt(1+c[0]+
c[5]+c[10]),r[0]=(c[9]-c[6])/b,r[1]=(c[2]-c[8])/b,r[2]=(c[4]-c[1])/b,r[3]=.25*b,g.quat4.conjugate(r),g.quat4.multiply(r,a.quaternion,a.quaternion)};return h}();var p=g.vec3d.create(),m=g.vec3d.create(),r=g.quat4.create();return q})},"esri/views/3d/layers/i3s/I3SGeometryUtil":function(){define("require exports ./I3SBinaryReader ../../support/meshProcessing ../../webgl-engine/lib/gl-matrix ../../webgl-engine/lib/Util".split(" "),function(q,h,e,a,d,b){function g(a,b,c,d,e,f,g){switch(c){case 1:for(c=
0;c<g;c++)d[e]=a[b],b+=1,e+=f;break;case 2:for(c=0;c<g;c++)d[e]=a[b],d[e+1]=a[b+1],b+=2,e+=f;break;case 3:for(c=0;c<g;c++)d[e]=a[b],d[e+1]=a[b+1],d[e+2]=a[b+2],b+=3,e+=f;break;case 4:for(c=0;c<g;c++)d[e]=a[b],d[e+1]=a[b+1],d[e+2]=a[b+2],d[e+3]=a[b+3],b+=4,e+=f;break;default:throw l("Unhandled stride size "+c);}}function c(a,b,c,d,e,f){switch(b){case 1:for(b=0;b<f;b++)c[d]=a,d+=e;break;case 2:for(b=0;b<f;b++)c[d]=a,c[d+1]=a,d+=e;break;case 3:for(b=0;b<f;b++)c[d]=a,c[d+1]=a,c[d+2]=a,d+=e;break;case 4:for(b=
0;b<f;b++)c[d]=a,c[d+1]=a,c[d+2]=a,c[d+3]=a,d+=e;break;default:throw l("Unhandled stride size "+b);}}function f(a){switch(a){case 5120:return Int8Array;case 5126:return Float32Array;case 5124:return Int32Array;case 5122:return Int16Array;case 5121:return Uint8Array;case 5125:return Uint32Array;case 5123:return Uint16Array}throw Error("Unhandled data type: "+a);}function k(a){switch(a){case 5120:return"Int8";case 5126:return"Float32";case 5124:return"Int32";case 5122:return"Int16";case 5121:return"UInt8";
case 5125:return"UInt32";case 5123:return"UInt16"}throw Error("Unhandled data type: "+a);}function n(a){return 0<a&&0===a%Uint32Array.BYTES_PER_ELEMENT}function l(a){return Error("I3SGeometryUtil processing failed: "+a)}Object.defineProperty(h,"__esModule",{value:!0});var p=new Uint8Array(64);h.interleaveGeometryBuffer=function(a,b,d,e,h){void 0===e&&(e=[]);void 0===h&&(h=[]);var m=a.params.vertexAttributes,u=m.position.count;if(!n(d[0].stride))throw l("Layout stride must use "+Uint32Array.BYTES_PER_ELEMENT+
"-byte words");var r=new Uint32Array(d[0].stride/Uint32Array.BYTES_PER_ELEMENT*u);d=d.slice(0).sort(function(a,b){return a.offset-b.offset});a=function(a){if(-1!==h.indexOf(a.name))return"continue";var d=m[a.name],t=f(a.type),q=void 0,v=!1;if(null==d)if(v=e.filter(function(b){return b.name===a.name})[0]){d={valueType:k(a.type),byteOffset:0,count:u,valuesPerElement:a.count};for(q=0;q<p.length;q++)p[q]=v.byteValue;q=p.buffer;v=!0}else throw l("Geometry definition is missing attribute");else q=b;if(k(a.type)!==
d.valueType)throw l("Geometry definition type must match attribute type");if(0!==d.byteOffset%Uint32Array.BYTES_PER_ELEMENT||0!==a.offset%Uint32Array.BYTES_PER_ELEMENT)throw l(a.name+" offset must use "+Uint32Array.BYTES_PER_ELEMENT+"-byte words");if(!n(d.valuesPerElement*t.BYTES_PER_ELEMENT)||!n(a.count*t.BYTES_PER_ELEMENT))throw l(a.name+" data must use "+Uint32Array.BYTES_PER_ELEMENT+"-byte words");var q=new Uint32Array(q),x=d.byteOffset/Uint32Array.BYTES_PER_ELEMENT,d=d.valuesPerElement*t.BYTES_PER_ELEMENT/
Uint32Array.BYTES_PER_ELEMENT,t=a.offset/Uint32Array.BYTES_PER_ELEMENT,A=a.stride/Uint32Array.BYTES_PER_ELEMENT;v?c(q[0],d,r,t,A,u):g(q,x,d,r,t,A,u)};for(var t=0;t<d.length;t++)a(d[t]);return r.buffer};h.processAndInterleaveNormals=function(a,c,f,g,h){if("none"===a){var k=h.normals,l=h.positions;c=h.normalInd;a=h.positionInd;b.assert(h.normalInd.length===h.positionInd.length);h=d.vec3.create();g=d.vec3.create();f=d.vec2.create();for(var n=l.data,p=l.offsetIdx,l=l.strideIdx,u=k.data,t=k.offsetIdx,
k=k.strideIdx,q=0;q<a.length;q+=3){var v=a[q],v=p+l*v,x=n[v],A=n[v+1],K=n[v+2],v=a[q+1],v=p+l*v;h[0]=n[v]-x;h[1]=n[v+1]-A;h[2]=n[v+2]-K;v=a[q+2];v=p+l*v;g[0]=n[v]-x;g[1]=n[v+1]-A;g[2]=n[v+2]-K;d.vec3.cross(h,g,h);b.encodeNormal(h,f);for(x=0;3>x;x++)A=t+k*c[q+x],u[A]=b.encodeInt16(f[0]),u[A+1]=b.encodeInt16(f[1])}}else if(c=e.createTypedView(f,c.params.vertexAttributes.normal),f=h.normals,A="earth-centered"===a?g:null,a=c.length/3,h=f.data,g=f.offsetIdx,f=f.strideIdx,null!=A)for(n=A[0],p=A[1],l=A[2],
u=A[4],t=A[5],k=A[6],q=A[8],x=A[9],A=A[10],K=0;K<a;K++){var v=c[3*K],O=c[3*K+1],P=c[3*K+2];m[0]=n*v+p*O+l*P;m[1]=u*v+t*O+k*P;m[2]=q*v+x*O+A*P;b.encodeNormal(m,r);h[g+K*f]=b.encodeInt16(r[0]);h[g+K*f+1]=b.encodeInt16(r[1])}else for(K=0;K<a;K++)m[0]=c[3*K],m[1]=c[3*K+1],m[2]=c[3*K+2],b.encodeNormal(m,r),h[g+K*f]=b.encodeInt16(r[0]),h[g+K*f+1]=b.encodeInt16(r[1])};h.extractPositionData=function(b,c,d){c=c[0];if(null==c||"position"!==c.name||5126!==c.type)return null;var e=new Float32Array(b),f=c.stride/
4,g=3*e.length/f,h=new Float32Array(g);for(b=0;b<g/3;b++)h[3*b]=e[b*f+c.offset],h[3*b+1]=e[b*f+c.offset+1],h[3*b+2]=e[b*f+c.offset+2];c=a.deduplicate(h.buffer,3);b=65536>c.uniqueCount;if(d)for(e=new (b?Uint16Array:Uint32Array)(d.length),b=0;b<d.length;b++)e[b]=c.indices[d[b]];else e=b?new Uint16Array(c.indices):c.indices;return{data:new Float32Array(c.buffer),indices:e}};var m=d.vec3.create(),r=d.vec2.create()})},"esri/views/3d/layers/i3s/I3SBinaryReader":function(){define("require exports ../../../../core/Error ../../../../core/lang ../../../../core/Logger ./LEPCC".split(" "),
function(q,h,e,a,d,b){function g(a,b,c){for(var d="",f=0;f<c;){var g=a[b+f];if(128>g)d+=String.fromCharCode(g),f++;else if(192<=g&&224>g){if(f+1>=c)throw new e("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");var h=a[b+f+1],g=(g&31)<<6|h&63,d=d+String.fromCharCode(g),f=f+2}else if(224<=g&&240>g){if(f+2>=c)throw new e("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");var h=a[b+f+1],k=a[b+f+2],g=(g&15)<<12|(h&63)<<6|k&63,d=d+String.fromCharCode(g),
f=f+3}else if(240<=g&&248>g){if(f+3>=c)throw new e("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");h=a[b+f+1];k=a[b+f+2];g=(g&7)<<18|(h&63)<<12|(k&63)<<6|a[b+f+3]&63;d=65536<=g?d+String.fromCharCode((g-65536>>10)+55296,(g&1023)+56320):d+String.fromCharCode(g);f+=4}else throw new e("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");}return d}function c(a,b){for(var c={byteOffset:0,byteCount:0,fields:Object.create(null)},d=0,e=0;e<b.length;e++){var f=
b[e],g=f.valueType||f.type;c.fields[f.property]=(0,h.valueType2ArrayBufferReader[g])(a,d);d+=h.valueType2TypedArrayClassMap[g].BYTES_PER_ELEMENT}c.byteCount=d;return c}function f(a,b,c){var d=[],f,h=0,k;for(k=0;k<a;k+=1){f=b[k];if(0<f){if(d.push(g(c,h,f-1)),0!==c[h+f-1])throw new e("string-array-error","Invalid string array: missing null termination.");}else d.push(null);h+=f}return d}function k(a,b){return new h.valueType2TypedArrayClassMap[b.valueType](a,b.byteOffset,b.count*b.valuesPerElement)}
function n(a,b){return new Uint8Array(a,b.byteOffset,b.byteCount)}function l(b,d,f){b=null!=d.header?c(b,d.header):{byteOffset:0,byteCount:0,fields:{count:f}};f={header:b,byteOffset:b.byteCount,byteCount:0,entries:Object.create(null)};for(var g=b.byteCount,h=0;h<d.ordering.length;h++){var k=d.ordering[h],l=a.clone(d[k]);l.count=b.fields.count;if("String"===l.valueType){if(l.byteOffset=g,l.byteCount=b.fields[k+"ByteCount"],"UTF-8"!==l.encoding)throw new e("unsupported-encoding","Unsupported String encoding.",
{encoding:l.encoding});}else if(m(l.valueType)){var n=r(l.valueType),g=g+(0!==g%n?n-g%n:0);l.byteOffset=g;l.byteCount=n*l.valuesPerElement*l.count}else throw new e("unsupported-value-type","Unsupported binary valueType",{valueType:l.valueType});g+=l.byteCount;f.entries[k]=l}f.byteCount=g-f.byteOffset;return f}function p(a,b,c){b!==a&&t.error("Invalid "+c+" buffer size\n expected: "+a+", actual: "+b+")");if(b<a)throw new e("buffer-too-small","Binary buffer is too small",{expectedSize:a,actualSize:b});
}function m(a){return h.valueType2TypedArrayClassMap.hasOwnProperty(a)}function r(a){return m(a)&&h.valueType2TypedArrayClassMap[a].BYTES_PER_ELEMENT}Object.defineProperty(h,"__esModule",{value:!0});var t=d.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");h.readHeader=c;h.readStringArray=f;h.createTypedView=k;h.createRawView=n;h.createAttributeDataIndex=l;h.createGeometryDataIndex=function(b,d,e){var f=c(b,d&&d.header),g=f.byteCount,h={header:f,byteOffset:f.byteCount,byteCount:0,vertexAttributes:a.clone(d.vertexAttributes)},
k=h.vertexAttributes;e||null==k.region||delete k.region;var f=f.fields,l=null!=f.vertexCount?f.vertexCount:f.count;for(e=0;e<d.ordering.length;e++){var m=d.ordering[e];null!=k[m]&&(k[m].byteOffset=g,k[m].count=l,g+=r(k[m].valueType)*k[m].valuesPerElement*l)}k=f.faceCount;if(d.faces&&k)for(h.faces=a.clone(d.faces),l=h.faces,e=0;e<d.ordering.length;e++)m=d.ordering[e],null!=l[m]&&(l[m].byteOffset=g,l[m].count=k,g+=r(l[m].valueType)*l[m].valuesPerElement*k);f=f.featureCount;if(d.featureAttributes&&d.featureAttributeOrder&&
f)for(h.featureAttributes=a.clone(d.featureAttributes),k=h.featureAttributes,e=0;e<d.featureAttributeOrder.length;e++)l=d.featureAttributeOrder[e],k[l].byteOffset=g,k[l].count=f,m=r(k[l].valueType),"UInt64"===k[l].valueType&&(m=8),g+=m*k[l].valuesPerElement*f;p(g,b.byteLength,"geometry");h.byteCount=g-h.byteOffset;return h};h.readBinaryAttribute=function(a,c,d){if("lepcc-rgb"===a.encoding)return b.decodeRGB(c);if("lepcc-intensity"===a.encoding)return b.decodeIntensity(c);if(null!=a.encoding&&""!==
a.encoding)throw new e("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");a["attributeByteCounts "]&&!a.attributeByteCounts&&(t.warn("Warning: Trailing space in 'attributeByteCounts '."),a.attributeByteCounts=a["attributeByteCounts "]);"ObjectIds"===a.ordering[0]&&a.hasOwnProperty("objectIds")&&(t.warn("Warning: Case error in objectIds"),a.ordering[0]="objectIds");d=l(c,a,d);p(d.byteOffset+d.byteCount,c.byteLength,"attribute");if(a=d.entries.attributeValues||d.entries.objectIds){if("String"===
a.valueType){d=d.entries.attributeByteCounts;var g=k(c,d);c=n(c,a);return f(d.count,g,c)}return k(c,a)}throw new e("bad-attribute-storage-info","Bad attributeStorageInfo specification.");};h.valueType2TypedArrayClassMap={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array};h.valueType2ArrayBufferReader={Float32:function(a,b){return(new DataView(a,0)).getFloat32(b,!0)},Float64:function(a,b){return(new DataView(a,
0)).getFloat64(b,!0)},UInt8:function(a,b){return(new DataView(a,0)).getUint8(b)},Int8:function(a,b){return(new DataView(a,0)).getInt8(b)},UInt16:function(a,b){return(new DataView(a,0)).getUint16(b,!0)},Int16:function(a,b){return(new DataView(a,0)).getInt16(b,!0)},UInt32:function(a,b){return(new DataView(a,0)).getUint32(b,!0)},Int32:function(a,b){return(new DataView(a,0)).getInt32(b,!0)}};h.isValueType=m;h.getBytesPerValue=r})},"esri/views/3d/layers/i3s/LEPCC":function(){define(["require","exports",
"../../../../core/Error"],function(q,h,e){function a(a,b,d){return{identifier:String.fromCharCode.apply(null,new Uint8Array(a,d+g.identifierOffset,g.identifierLength)),version:b.getUint16(d+g.versionOffset,!0),checksum:b.getUint32(d+g.checksumOffset,!0)}}function d(a,d,e){var c=[];d=b(a,d,c);for(var f=[],g=0;g<c.length;g++){f.length=0;d=b(a,d,f);for(var h=0;h<f.length;h++)e.push(f[h]+c[g])}return d}function b(a,b,d){var c=new DataView(a,b),f=c.getUint8(0),g=f&31,h=!!(f&32),k=(f&192)>>6,f=0;if(0===
k)f=c.getUint32(1,!0),b+=5;else if(1===k)f=c.getUint16(1,!0),b+=3;else if(2===k)f=c.getUint8(1),b+=2;else throw new e("lepcc-decode-error","Bad count type");if(h)throw new e("lepcc-decode-error","LUT not implemented");a=new Uint8Array(a,b,Math.ceil(f*g/8));for(var k=h=c=0,t=-1>>>32-g,u=0;u<f;u++){for(;h<g;)c|=a[k]<<h,h+=8,k+=1;d[u]=c&t;c>>>=g;h-=g;32<h+g&&(c|=a[k-1]>>8-h)}return b+k}Object.defineProperty(h,"__esModule",{value:!0});var g={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,
byteCount:16};h.decodeXYZ=function(b){var c,h,n,l,p,m,r,t,u,q,v,A,y=new DataView(b,0),C=0;l=a(b,y,C);n=l.identifier;l=l.version;C+=g.byteCount;if("LEPCC     "!==n)throw new e("lepcc-decode-error","Bad identifier");if(1<l)throw new e("lepcc-decode-error","Unknown version");var B=C;c=y.getUint32(B+0,!0);h=y.getUint32(B+4,!0);n=y.getFloat64(B+8,!0);l=y.getFloat64(B+16,!0);p=y.getFloat64(B+24,!0);m=y.getFloat64(B+32,!0);r=y.getFloat64(B+40,!0);t=y.getFloat64(B+48,!0);u=y.getFloat64(B+56,!0);q=y.getFloat64(B+
64,!0);v=y.getFloat64(B+72,!0);A=y.getUint32(B+80,!0);y.getUint32(B+84,!0);C+=88;if(h*Math.pow(2,32)+c!==b.byteLength)throw new e("lepcc-decode-error","Bad size");y=new Float64Array(3*A);c=[];h=[];A=[];B=[];C=d(b,C,c);C=d(b,C,h);C=d(b,C,A);C=d(b,C,B);if(C!==b.byteLength)throw new e("lepcc-decode-error","Bad length");for(var D=C=b=0;D<c.length;D++)for(var C=C+c[D],E=0,J=0;J<h[D];J++){var E=E+A[b],F=B[b];y[3*b]=Math.min(m,n+2*u*E);y[3*b+1]=Math.min(r,l+2*q*C);y[3*b+2]=Math.min(t,p+2*v*F);b++}return{errorX:u,
errorY:q,errorZ:v,result:y}};h.decodeRGB=function(b){var c,d,h,l,p,m,r=new DataView(b,0),t=0;l=a(b,r,t);h=l.identifier;l=l.version;t+=g.byteCount;if("ClusterRGB"!==h)throw new e("lepcc-decode-error","Bad identifier");if(1<l)throw new e("lepcc-decode-error","Unknown version");m=t;c=r.getUint32(m+0,!0);d=r.getUint32(m+4,!0);h=r.getUint32(m+8,!0);l=r.getUint16(m+12,!0);p=r.getUint8(m+14);m=r.getUint8(m+15);t+=16;if(d*Math.pow(2,32)+c!==b.byteLength)throw new e("lepcc-decode-error","Bad size");if(2!==
p&&1!==p||0!==m){if(0===p&&0===m){if(3*h+t!==b.byteLength||0!==l)throw new e("lepcc-decode-error","Bad count");return(new Uint8Array(b,t)).slice()}if(2>=p&&1===m){if(t+3!==b.byteLength||1!==l)throw new e("lepcc-decode-error","Bad count");l=r.getUint8(t);c=r.getUint8(t+1);r=r.getUint8(t+2);t=new Uint8Array(3*h);for(b=0;b<h;b++)t[3*b]=l,t[3*b+1]=c,t[3*b+2]=r;return t}throw new e("lepcc-decode-error","Bad method "+p+","+m);}if(3*l+h+t!==b.byteLength||256<l)throw new e("lepcc-decode-error","Bad count");
r=new Uint8Array(b,t,3*l);l=new Uint8Array(b,t+3*l,h);t=new Uint8Array(3*h);for(b=0;b<h;b++)c=l[b],t[3*b]=r[3*c],t[3*b+1]=r[3*c+1],t[3*b+2]=r[3*c+2];return t};h.decodeIntensity=function(c){var d,h,n,l,p,m=new DataView(c,0),r=0;l=a(c,m,r);n=l.identifier;l=l.version;r+=g.byteCount;if("Intensity "!==n)throw new e("lepcc-decode-error","Bad identifier");if(1<l)throw new e("lepcc-decode-error","Unknown version");var t=r;d=m.getUint32(t+0,!0);h=m.getUint32(t+4,!0);n=m.getUint32(t+8,!0);l=m.getUint16(t+12,
!0);p=m.getUint8(t+14);m.getUint8(t+15);r+=16;if(h*Math.pow(2,32)+d!==c.byteLength)throw new e("lepcc-decode-error","Bad size");m=new Uint16Array(n);if(8===p){if(n+r!==c.byteLength)throw new e("lepcc-decode-error","Bad size");p=new Uint8Array(c,r,n)}else if(16===p){if(2*n+r!==c.byteLength)throw new e("lepcc-decode-error","Bad size");p=new Uint16Array(c,r,n)}else if(p=[],b(c,r,p)!==c.byteLength)throw new e("lepcc-decode-error","Bad size");for(c=0;c<n;c++)m[c]=p[c]*l;return m}})},"esri/views/3d/layers/i3s/I3SProjectionUtil":function(){define(["require",
"exports","../../lib/glMatrix","../../support/projectionUtils"],function(q,h,e,a){Object.defineProperty(h,"__esModule",{value:!0});h.ReprojectionTypes={PER_VERTEX:"perVertex",NO_REPROJECTION:"noReprojection"};var d=new Float64Array(3E3),b=e.vec3d.create();h.reprojectPoints=function(g,c,f,h,n,l){var k=g.data,m=g.offsetIdx;g=g.strideIdx;e.vec3d.set(c,b);b[2]+=f;c=e.mat4d.create();a.computeLinearTransformation(h,b,c,l);f=e.mat4d.create();e.mat4d.inverse(c,f);var r=e.mat4d.create();e.mat4d.identity(r);
var t=[0,0,0],u=k.length/g;a.vectorToVector(b,h,t,n);for(h=0;h<u;h+=1E3){for(var q=Math.min(1E3,u-h),v=0;v<q;v++){var A=m+g*(h+v);d[3*v]=k[A]+t[0];d[3*v+1]=k[A+1]+t[1];d[3*v+2]=k[A+2]+t[2]}a.bufferToBuffer(d,n,0,d,l,0,q);for(v=0;v<q;v++){var A=d[3*v],y=d[3*v+1],C=d[3*v+2],B=m+g*(h+v);k[B]=f[0]*A+f[4]*y+f[8]*C+f[12];k[B+1]=f[1]*A+f[5]*y+f[9]*C+f[13];k[B+2]=f[2]*A+f[6]*y+f[10]*C+f[14]}}return{localTrafo:r,globalTrafo:c}}})},"esri/views/3d/support/orientedBoundingBox":function(){define("require exports ../../../geometry/support/aaBoundingBox ../lib/glMatrix ./dito ./geometryUtils".split(" "),
function(q,h,e,a,d,b){function g(b,c,d){return{center:a.vec3d.createFrom(b[0],b[1],b[2]),halfSize:n.createFrom(c[0],c[1],c[2]),quaternion:k.createFrom(d[0],d[1],d[2],d[3])}}function c(a,c){var d=b.plane.distance(c,a.center);a=f(a,c);return d>a?1:d<-a?-1:0}function f(a,b){k.conjugate(a.quaternion,l);k.multiplyVec3(l,b,p);a=a.halfSize;return Math.abs(p[0]*a[0])+Math.abs(p[1]*a[1])+Math.abs(p[2]*a[2])}Object.defineProperty(h,"__esModule",{value:!0});var k=a.quat4,n=a.vec3;q=a.mat3d;var l=k.create(),
p=n.create(),m=n.create(),r=q.create();q=function(){return function(a){this.buffer=new ArrayBuffer(56*a);this.obbs=Array(a);for(var b=0;b<a;b++)this.obbs[b]={center:new Float64Array(this.buffer,56*b+0,3),halfSize:new Float32Array(this.buffer,56*b+24,3),quaternion:new Float32Array(this.buffer,56*b+36,4)}}}();h.ObbArray=q;h.create=g;h.clone=function(a){return g(a.center,a.halfSize,a.quaternion)};h.set=function(b,c){a.vec3d.set(b.center,c.center);a.vec3.set(b.halfSize,c.halfSize);a.quat4.set(b.quaternion,
c.quaternion)};h.compute=function(a,b){b||(b=g([0,0,0],[-1,-1,-1],[0,0,0,1]));d.computeOBB(a,b);return b};h.intersectPlane=c;h.toAaBoundingBox=function(a,b){b||(b=e.create());var c=k.toMat3(a.quaternion,r),d=a.halfSize[0]*Math.abs(c[0])+a.halfSize[1]*Math.abs(c[3])+a.halfSize[2]*Math.abs(c[6]),f=a.halfSize[0]*Math.abs(c[1])+a.halfSize[1]*Math.abs(c[4])+a.halfSize[2]*Math.abs(c[7]),c=a.halfSize[0]*Math.abs(c[2])+a.halfSize[1]*Math.abs(c[5])+a.halfSize[2]*Math.abs(c[8]);b[0]=a.center[0]-d;b[1]=a.center[1]-
f;b[2]=a.center[2]-c;b[3]=a.center[0]+d;b[4]=a.center[1]+f;b[5]=a.center[2]+c;return b};h.minimumDistancePlane=function(a,c){var d=b.plane.distance(c,a.center);a=f(a,c);return d-a};h.maximumDistancePlane=function(a,c){var d=b.plane.distance(c,a.center);a=f(a,c);return d+a};h.isVisible=function(a,b){return 0>=c(a,b[0])&&0>=c(a,b[1])&&0>=c(a,b[2])&&0>=c(a,b[3])&&0>=c(a,b[4])&&0>=c(a,b[5])};h.intersectLine=function(b,c,d,e){void 0===e&&(e=0);k.conjugate(b.quaternion,l);a.vec3.subtract(c,b.center,p);
c=k.multiplyVec3(l,p,p);d=k.multiplyVec3(l,d,m);for(var f=-Infinity,g=Infinity,h=0;3>h;h++)if(1E-6<Math.abs(d[h]))var n=(e+b.halfSize[h]-c[h])/d[h],r=(-e-b.halfSize[h]-c[h])/d[h],f=Math.max(f,Math.min(n,r)),g=Math.min(g,Math.max(n,r));else if(c[h]>b.halfSize[h]+e||c[h]<-b.halfSize[h]-e)return!1;return f<=g}})},"esri/views/3d/support/dito":function(){define(["require","exports","../lib/glMatrix"],function(q,h,e){function a(a,b,c,g,h,k){if(!(1E-6>e.vec3d.length2(b)))for(e.vec3d.cross(c,b,C),e.vec3d.cross(g,
b,B),e.vec3d.cross(h,b,D),d(a,b,y),J[1]=y[0],E[1]=y[1],F[1]=E[1]-J[1],c=[c,g,h],g=[C,B,D],h=0;3>h;++h){d(a,c[h],y);J[0]=y[0];E[0]=y[1];d(a,g[h],y);J[2]=y[0];E[2]=y[1];F[0]=E[0]-J[0];F[2]=E[2]-J[2];var l=f(F);l<k.quality&&(e.vec3d.set(c[h],k.b0),e.vec3d.set(b,k.b1),e.vec3d.set(g[h],k.b2),k.quality=l)}}function d(a,b,c){var d=a.data,e=a.offsetIdx;a=a.strideIdx;c[0]=Number.POSITIVE_INFINITY;for(c[1]=Number.NEGATIVE_INFINITY;e<d.length;e+=a){var f=d[e]*b[0]+d[e+1]*b[1]+d[e+2]*b[2];c[0]=Math.min(c[0],
f);c[1]=Math.max(c[1],f)}}function b(a,b,c){e.vec3d.set(a,c.center);e.vec3d.scale(b,.5,c.halfSize);e.quat4.identity(c.quaternion)}function g(a,b,c,e,f,g){d(a,b,y);f[0]=y[0];g[0]=y[1];d(a,c,y);f[1]=y[0];g[1]=y[1];d(a,e,y);f[2]=y[0];g[2]=y[1]}function c(a,b,c,d,f,g,h){N[0]=a[0];N[3]=a[1];N[6]=a[2];N[1]=b[0];N[4]=b[1];N[7]=b[2];N[2]=c[0];N[5]=c[1];N[8]=c[2];e.quat4.fromRotationMatrix(N,h.quaternion);e.vec3d.add(d,f,S);e.vec3d.scale(S,.5);e.vec3d.scale(a,S[0],h.center);e.vec3d.scale(b,S[1],U);e.vec3d.add(h.center,
U);e.vec3d.scale(c,S[2],U);e.vec3d.add(h.center,U);e.vec3d.scale(g,.5,h.halfSize)}function f(a){return a[0]*a[1]+a[0]*a[2]+a[1]*a[2]}Object.defineProperty(h,"__esModule",{value:!0});var k=e.vec3d.create(),n=e.vec3d.create();h.computeOBB=function(d,h){var q=d.data.length/d.strideIdx;if(!(0>=q)){var B=new aa(d);e.vec3d.add(B.minProj,B.maxProj,k);e.vec3d.scale(k,.5);e.vec3d.subtract(B.maxProj,B.minProj,n);var C=f(n),Q=new V;Q.quality=C;14>q&&(d={data:new Float64Array(B.buffer,112,42),size:3,offsetIdx:0,
strideIdx:3});var T=e.vec3d.create(),E=e.vec3d.create(),D=e.vec3d.create(),q=e.vec3d.create(),F=e.vec3d.create(),J=e.vec3d.create(),U=e.vec3d.create(),N;N=d;for(var S=e.vec3d.dist2(B.maxVert[0],B.minVert[0]),W=0,na=1;7>na;++na){var ka=e.vec3d.dist2(B.maxVert[na],B.minVert[na]);ka>S&&(S=ka,W=na)}e.vec3d.set(B.minVert[W],T);e.vec3d.set(B.maxVert[W],E);if(1E-6>e.vec3d.dist2(T,E))N=1;else{e.vec3d.subtract(T,E,q);e.vec3d.normalize(q);B=N.data;S=N.strideIdx;W=Number.NEGATIVE_INFINITY;na=0;for(ka=N.offsetIdx;ka<
B.length;ka+=S){e.vec3d.set3(B[ka]-T[0],B[ka+1]-T[1],B[ka+2]-T[2],A);var la=q[0]*A[0]+q[1]*A[1]+q[2]*A[2],w=e.vec3d.length2(q),la=e.vec3d.length2(A)-la*la/w;la>W&&(W=la,na=ka)}e.vec3d.set3(B[na],B[na+1],B[na+2],D);1E-6>W?N=2:(e.vec3d.subtract(E,D,F),e.vec3d.normalize(F),e.vec3d.subtract(D,T,J),e.vec3d.normalize(J),e.vec3d.cross(F,q,U),e.vec3d.normalize(U),a(N,U,q,F,J,Q),N=0)}switch(N){case 1:b(k,n,h);return;case 2:C=d;e.vec3d.set(q,H);Math.abs(q[0])>Math.abs(q[1])&&Math.abs(q[0])>Math.abs(q[2])?H[0]=
0:Math.abs(q[1])>Math.abs(q[2])?H[1]=0:H[2]=0;1E-6>e.vec3d.length2(H)&&(H[0]=H[1]=H[2]=1);e.vec3d.cross(q,H,I);e.vec3d.normalize(I);e.vec3d.cross(q,I,K);e.vec3d.normalize(K);g(C,q,I,K,O,P);e.vec3d.subtract(P,O,L);c(q,I,K,O,P,L,h);return}N=d;B=l;S=p;W=y;na=N.data;la=N.offsetIdx;ka=N.strideIdx;e.vec3d.set3(na[la],na[la+1],na[la+2],S);e.vec3d.set(S,B);W[0]=e.vec3d.dot(M,U);W[1]=W[0];for(la+=ka;la<na.length;la+=ka)e.vec3d.set3(na[la],na[la+1],na[la+2],M),w=e.vec3d.dot(M,U),w<W[0]&&(W[0]=w,e.vec3d.set(M,
S)),w>W[1]&&(W[1]=w,e.vec3d.set(M,B));U=e.vec3.dot(T,U);y[1]-1E-6<=U&&(B[0]=void 0);y[0]+1E-6>=U&&(S[0]=void 0);void 0!==l[0]&&(e.vec3d.subtract(l,T,m),e.vec3d.normalize(m),e.vec3d.subtract(l,E,r),e.vec3d.normalize(r),e.vec3d.subtract(l,D,t),e.vec3d.normalize(t),e.vec3d.cross(r,q,u),e.vec3d.normalize(u),e.vec3d.cross(t,F,x),e.vec3d.normalize(x),e.vec3d.cross(m,J,v),e.vec3d.normalize(v),a(N,u,q,r,m,Q),a(N,x,F,t,r,Q),a(N,v,J,m,t,Q));void 0!==p[0]&&(e.vec3d.subtract(p,T,m),e.vec3d.normalize(m),e.vec3d.subtract(p,
E,r),e.vec3d.normalize(r),e.vec3d.subtract(p,D,t),e.vec3d.normalize(t),e.vec3d.cross(r,q,u),e.vec3d.normalize(u),e.vec3d.cross(t,F,x),e.vec3d.normalize(x),e.vec3d.cross(m,J,v),e.vec3d.normalize(v),a(N,u,q,r,m,Q),a(N,x,F,t,r,Q),a(N,v,J,m,t,Q));g(d,Q.b0,Q.b1,Q.b2,O,P);d=e.vec3d.create();e.vec3d.subtract(P,O,d);Q.quality=f(d);Q.quality<C?c(Q.b0,Q.b1,Q.b2,O,P,d,h):b(k,n,h)}};var l=e.vec3d.create(),p=e.vec3d.create(),m=e.vec3d.create(),r=e.vec3d.create(),t=e.vec3d.create(),u=e.vec3d.create(),x=e.vec3d.create(),
v=e.vec3d.create(),A=e.vec3d.create(),y=e.vec2d.create(),C=e.vec3d.create(),B=e.vec3d.create(),D=e.vec3d.create(),E=e.vec3d.create(),J=e.vec3d.create(),F=e.vec3d.create(),M=e.vec3d.create(),H=e.vec3d.create(),I=e.vec3d.create(),K=e.vec3d.create(),O=e.vec3d.create(),P=e.vec3d.create(),L=e.vec3d.create(),U=e.vec3d.create(),N=e.mat3d.create(),S=e.vec3d.create(),aa=function(){return function(a){this.minVert=[];this.maxVert=[];this.buffer=new ArrayBuffer(448);var b=0;this.minProj=new Float64Array(this.buffer,
b,7);b+=56;this.maxProj=new Float64Array(this.buffer,b,7);for(b+=56;7>this.minVert.length;)this.minVert.push(new Float64Array(this.buffer,b,3)),b+=24;for(;7>this.maxVert.length;)this.maxVert.push(new Float64Array(this.buffer,b,3)),b+=24;for(b=0;7>b;++b)this.minProj[b]=Number.POSITIVE_INFINITY,this.maxProj[b]=Number.NEGATIVE_INFINITY;for(var c=[],d=[],f=a.data,g=a.strideIdx,b=a.offsetIdx;b<f.length;b+=g)a=f[b],a<this.minProj[0]&&(this.minProj[0]=a,c[0]=b),a>this.maxProj[0]&&(this.maxProj[0]=a,d[0]=
b),a=f[b+1],a<this.minProj[1]&&(this.minProj[1]=a,c[1]=b),a>this.maxProj[1]&&(this.maxProj[1]=a,d[1]=b),a=f[b+2],a<this.minProj[2]&&(this.minProj[2]=a,c[2]=b),a>this.maxProj[2]&&(this.maxProj[2]=a,d[2]=b),a=f[b]+f[b+1]+f[b+2],a<this.minProj[3]&&(this.minProj[3]=a,c[3]=b),a>this.maxProj[3]&&(this.maxProj[3]=a,d[3]=b),a=f[b]+f[b+1]-f[b+2],a<this.minProj[4]&&(this.minProj[4]=a,c[4]=b),a>this.maxProj[4]&&(this.maxProj[4]=a,d[4]=b),a=f[b]-f[b+1]+f[b+2],a<this.minProj[5]&&(this.minProj[5]=a,c[5]=b),a>this.maxProj[5]&&
(this.maxProj[5]=a,d[5]=b),a=f[b]-f[b+1]-f[b+2],a<this.minProj[6]&&(this.minProj[6]=a,c[6]=b),a>this.maxProj[6]&&(this.maxProj[6]=a,d[6]=b);for(b=0;7>b;++b)a=c[b],e.vec3d.set3(f[a],f[a+1],f[a+2],this.minVert[b]),a=d[b],e.vec3d.set3(f[a],f[a+1],f[a+2],this.maxVert[b])}}(),V=function(){return function(){this.b0=e.vec3d.createFrom(1,0,0);this.b1=e.vec3d.createFrom(0,1,0);this.b2=e.vec3d.createFrom(0,0,1);this.quality=0}}()})},"esri/views/3d/layers/i3s/Highlights":function(){define(["require","exports",
"../../webgl-engine/lib/HighlightSet"],function(q,h,e){var a=function(){return function(a){this.highlightSet=new e;this.ids=new Set;this.options=a}}();return function(){function d(a){this.highlights=[];this.layerView=a}d.prototype.destroy=function(){this.highlights.forEach(function(a){return a.highlightSet.removeAll()});this.highlights=null};d.prototype.acquireSet=function(b){var d=this,c=new a(b);this.highlights.push(c);return{set:c,handle:{remove:function(){return d.releaseSet(c)}}}};d.prototype.releaseSet=
function(a){a.highlightSet.removeAll();a=this.highlights?this.highlights.indexOf(a):-1;-1!==a&&this.highlights.splice(a,1)};d.prototype.setFeatureIds=function(a,d){d.forEach(function(b){return a.ids.add(b)});this.layerView._forAllFeatures(function(b,d,e,g){a.ids.has(b)&&(b=e.engineObject.setComponentHighlight(g,d,a.options),a.highlightSet.addObject(e.engineObject,b))},null,!0)};d.prototype.objectCreated=function(a){var b=this;this.highlights.forEach(function(c){b.layerView._forAllFeaturesOfNode(b.layerView._getMetadata(a),
function(b,d,e,g){c.ids.has(b)&&(b=a.setComponentHighlight(g,d,c.options),c.highlightSet.addObject(a,b))},!0)})};d.prototype.objectDeleted=function(a){this.highlights.forEach(function(b){b.highlightSet.removeObject(a)})};d.prototype.allObjectsDeleted=function(){this.highlights.forEach(function(a){return a.highlightSet.removeAll()})};return d}()})},"esri/views/3d/webgl-engine/lib/HighlightSet":function(){define(["require","exports"],function(q,h){return function(){function e(){this.items=[]}e.prototype.addObject=
function(a,d){this.items.push({type:"object",highlightId:d,object:a})};e.prototype.addRenderGeometry=function(a,d,b){this.items.push({type:"renderGeometry",highlightId:b,renderGeometry:a,renderer:d})};e.prototype.addExternal=function(a,d){this.items.push({type:"external",highlightId:d,remove:a})};e.prototype.remove=function(a){for(var d=this.items.length-1;0<=d;--d){var b=this.items[d];b.highlightId===a&&(this.removeHighlight(b),this.items.splice(d,1))}};e.prototype.removeObject=function(a){for(var d=
this.items.length-1;0<=d;--d){var b=this.items[d];"object"===b.type&&b.object===a&&(this.removeHighlight(b),this.items.splice(d,1))}};e.prototype.removeRenderGeometry=function(a){for(var d=this.items.length-1;0<=d;--d){var b=this.items[d];"renderGeometry"===b.type&&b.renderGeometry===a&&(this.removeHighlight(b),this.items.splice(d,1))}};e.prototype.removeAll=function(){var a=this;this.items.forEach(function(d){a.removeHighlight(d)});this.items=[]};e.prototype.removeHighlight=function(a){switch(a.type){case "object":a.object.removeHighlights(a.highlightId);
break;case "renderGeometry":a.renderer.removeRenderGeometryHighlight(a.renderGeometry,a.highlightId);break;case "external":a.remove(a.highlightId)}};return e}()})},"esri/views/3d/layers/i3s/I3SElevationProvider":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Logger ../../../../core/accessorSupport/decorators ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ../../lib/glMatrix ../../support/Evented ../../webgl-engine/lib/Selector".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l){var p=c.empty(),m={spatialReference:null,extent:p},r=k.vec3d.create(),t=k.vec3d.create(),u=k.vec3d.create(),x=b.getLogger("esri.views.3d.layers.i3s.I3SElevationProvider");return function(b){function d(a){return b.call(this)||this}e(d,b);d.prototype.initialize=function(){this.renderCoordsHelper=this.layerView.view.renderCoordsHelper;this.intersectLayers=[this.stageLayer];this.selector=new l(this.layerView.view.viewingMode);var a=this.layerView.layer.fullExtent;this.zmin=
a.zmin;this.zmax=a.zmax};d.prototype.getElevation=function(a){if(f.isPoint(a)){if(!this.renderCoordsHelper.toRenderCoords(a,r))return x.error("could not project point for elevation alignment"),-Infinity}else if(!this.renderCoordsHelper.toRenderCoords(a,this.spatialReference,r))return x.error("could not project point for elevation alignment"),-Infinity;var b=this.layerView.elevationOffset;a=this.zmin+b;b=this.zmax+b;k.vec3d.set(r,t);k.vec3d.set(r,u);this.renderCoordsHelper.setAltitude(b,t);this.renderCoordsHelper.setAltitude(a,
u);this.selector.init(this.intersectLayers,t,u,null,null,1,!1);return this.selector.getMinResult().getIntersectionPoint(r)?this.renderCoordsHelper.getAltitude(r):-Infinity};d.prototype.layerChanged=function(){this.spatialReference&&(m.extent=this.computeLayerExtent(this.intersectLayers[0]),m.spatialReference=this.spatialReference,this.emit("elevation-change",m))};d.prototype.objectChanged=function(a){this.spatialReference&&(m.extent=this.computeObjectExtent(a),m.spatialReference=this.spatialReference,
this.emit("elevation-change",m))};d.prototype.computeObjectExtent=function(a){c.empty(p);this.expandExtent(a,p);return p};d.prototype.computeLayerExtent=function(a){c.empty(p);var b=0;for(a=a.getObjects();b<a.length;b++)this.expandExtent(a[b],p);return p};d.prototype.expandExtent=function(a,b){for(var d=a.getBBMin(!0),e=a.getBBMax(!0),f=0;8>f;++f)r[0]=f&1?d[0]:e[0],r[1]=f&2?d[1]:e[1],r[2]=f&4?d[2]:e[2],k.mat4d.multiplyVec3(a.objectTransformation,r),this.renderCoordsHelper.fromRenderCoords(r,r,this.spatialReference),
c.expand(b,r);return b};a([g.property({constructOnly:!0})],d.prototype,"layerView",void 0);a([g.property({constructOnly:!0})],d.prototype,"stageLayer",void 0);a([g.property({readOnly:!0,aliasOf:"layerView.view.elevationProvider.spatialReference"})],d.prototype,"spatialReference",void 0);return d=a([g.subclass("esri.views.3d.layers.i3s.I3SElevationProvider")],d)}(g.declared(d,n.Evented))})},"esri/views/3d/layers/i3s/I3SQueryEngine":function(){define("require exports dojo/promise/all ../../../../core/Error ../../../../core/promiseUtils ../../../../layers/graphics/dehydratedFeatures ../../../../tasks/support/FeatureSet".split(" "),
function(q,h,e,a,d,b,g){return function(){function c(a,b,c){this._layer=a;this._support=b;this._options=c}c.prototype.queryExtent=function(a){var b=this;return this._rejectUnsupported(a).then(function(){var c=0,d=b._support.createExtentBuilder();b._forAllQueried(a,function(a){c++;d.add(a)});return{count:c,extent:0===c?null:d.getExtent()}})};c.prototype.queryFeatureCount=function(a){var b=this;return this._rejectUnsupported(a).then(function(){var c=0;b._forAllQueried(a,function(){return c++});return c})};
c.prototype.queryFeatures=function(c){var f=this;return this._rejectUnsupported(c).then(function(){var b=[],g=c&&c.outFields,h=[];if(0<f._forAllQueried(c,function(a){return h.push(f._support.createGraphic(a))},function(a){g&&(b.push(f._support.requestFields(a,h,g)),h=[])})&&!c.num)return d.reject(new a("Unsupported Query","Large feature query, use Query.num and Query.start to batch"));g||b.push(d.resolve(h));return e(b)}).then(function(a){for(var c=[],d=0;d<a.length;++d)for(var e=a[d],h=0;h<e.length;++h)c.push(b.hydrateGraphic(e[h],
f._layer));a=new g;a.features=c;return a})};c.prototype.queryObjectIds=function(a){var b=this;return this._rejectUnsupported(a).then(function(){var c=[];b._forAllQueried(a,function(a){return c.push(a.id)});return c})};c.defaultExtentBuilder=function(a){var b=null;return{add:function(c){(c=a(c))&&(b=null!=b?b.union(c):c.clone())},getExtent:function(){return b}}};c.prototype._forAllQueried=function(a,b,c){var d=[];if(a&&a.objectIds){var e=a.objectIds;d.push(function(a){return 0<=e.indexOf(a.id)})}var f=
a&&a.start||0,g=a&&a.num||1E4;d.push(function(){if(0>=g)return--g,!1;if(0<f)return--f,!1;--g;return!0});this._support.forAll(function(a){for(var c=0;c<d.length;c++)if(!(0,d[c])(a))return;b(a)},c);return Math.max(0,-g)};c.prototype._rejectUnsupported=function(b){if(null==b)return d.resolve();var c=function(b){return d.reject(new a("Unsupported Query","Unsupported property '"+b+"'"))};return null!=b.distance?c("distance"):null!=b.geometryPrecision?c("geometryPrecision"):b.groupByFieldsForStatistics&&
b.groupByFieldsForStatistics.length?c("groupByFieldsForStatistics"):null!=b.maxAllowableOffset?c("maxAllowableOffset"):b.multipatchOption?c("multipatchOption"):b.orderByFields&&b.orderByFields.length?c("orderByFields"):b.outSpatialReference?c("outSpatialReference"):b.outStatistics&&b.outStatistics.length?c("outStatistics"):b.pixelSize?c("pixelSize"):b.quantizationParameters?c("quantizationParameters"):b.relationParameter?c("relationParameter"):b.returnDistinctValues?c("returnDistinctValues"):b.text?
c("text"):b.timeExtent?c("timeExtent"):b.where?c("where"):b.geometry?c("geometry"):!this._options.enableOutFields&&b.outFields&&b.outFields.length?c("outFields"):!this._options.enableObjectId&&b.objectIds&&b.objectIds.length?c("objectIds"):d.resolve()};return c}()})},"esri/views/3d/layers/i3s/I3SUtil":function(){define("require exports ../../../../request ../../../../core/Error ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../geometry/SpatialReference ../../../../geometry/support/webMercatorUtils ../../../../tasks/QueryTask ../../../../tasks/support/Query ./I3SBinaryReader ../../support/projectionUtils ../../support/buffer/typedArrayUtil ../support/symbolColorUtils".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m){function r(a){return a&&parseInt(a.substring(a.lastIndexOf("/")+1,a.length),10)}function t(a,b,c,d,e,f){if(null!=c){var g=c.mbs;b!==d&&(g=K,l.mbsToMbs(c.mbs,d,g,b));if(0!==u(a,g)&&(f(c),c.children))for(g=0;g<c.children.length;++g)t(a,b,e[c.children[g].id],d,e,f)}}function u(a,b){var c=b[0],d=b[1],e=b[2];b=b[3];var f=0;if(c<a[0])var g=a[0]-c,f=f+g*g;d<a[1]&&(g=a[1]-d,f+=g*g);e<a[2]&&(g=a[2]-e,f+=g*g);c>a[3]&&(g=c-a[3],f+=g*g);d>a[4]&&(g=d-a[4],f+=g*g);e>a[5]&&
(g=e-a[5],f+=g*g);if(f>b*b)return 0;if(0<f)return 1;f=Infinity;c-a[0]<f&&(f=c-a[0]);d-a[1]<f&&(f=d-a[1]);e-a[2]<f&&(f=e-a[2]);a[3]-c<f&&(f=a[3]-c);a[4]-d<f&&(f=a[4]-d);a[5]-e<f&&(f=a[5]-e);return f>b?2:1}function x(a,b,c){var d=[],e=c&&c.missingFields;c=c&&c.originalFields;for(var f=0;f<a.length;f++){for(var g=a[f],h=g.toLowerCase(),k=!1,l=0,m=b;l<m.length;l++){var n=m[l];if(h===n.name.toLowerCase()){d.push(n.name);k=!0;c&&c.push(g);break}}!k&&e&&e.push(g)}return d}function v(a,b){return a.filter(function(a){return a.toLowerCase()!==
b.toLowerCase()}).concat([b])}function A(a,b,c,d){b.sort(function(a,b){return a.attributes[c]-b.attributes[c]});var e=b.map(function(a){return a.attributes[c]}),f=[],g=x(d,a.fields,{originalFields:f});return C(a,e,g).then(function(a){for(var c=0;c<b.length;c++){var d=b[c],e=a[c];d.attributes={};for(var h=0;h<f.length;h++)d.attributes[f[h]]=e[g[h]]}return b})}function y(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];e in b.attributes||c.push(e)}return c}function C(b,c,e){if(null!=b.maxRecordCount&&
c.length>b.maxRecordCount){var g=E(c,b.maxRecordCount);return d.all(g.map(function(a){return C(b,a,e)})).then(J)}g=new k({objectIds:c,outFields:e,orderByFields:[b.objectIdField]});return(new f(b.parsedUrl.path)).execute(g).then(function(b){return b&&b.features&&b.features.length===c.length?b.features.map(function(a){return a.attributes}):d.reject(new a("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer"))})}function B(c,f,g,h,k){for(var l=[],m=0;m<f.attributeData.length;m++){var p=
f.attributeData[m],r=c[m];r&&-1!==h.indexOf(r.name)&&(p=b.makeAbsolute(p.href,f.baseUrl),l.push({url:p,storageInfo:r}))}return d.eachAlways(l.map(function(a){return e(a.url,{responseType:"array-buffer"}).then(function(b){return n.readBinaryAttribute(a.storageInfo,b.data)})})).then(function(b){var c=[];if(!k.ignoreUnavailableFields&&b.some(function(a){return null==a.value})){for(var c=[],e=0;e<b.length;e++)null==b[e].value&&c.push({name:l[e].storageInfo.name,error:b[e].error});return d.reject(new a("scenelayer:attribute-request-failed",
"Request for scene layer attributes failed",{failedAttributes:c}))}for(var f=0;f<g.length;f++){for(var h=g[f],m={},e=0;e<b.length;e++)null!=b[e].value&&(m[l[e].storageInfo.name]=D(b[e].value,h));c.push(m)}return c})}function D(a,b){b=a[b];return p.isInt16Array(a)?b===O?null:b:p.isInt32Array(a)?b===P?null:b:b!==b?null:b}function E(a,b){var c=a.length;b=Math.ceil(c/b);for(var d=[],e=0;e<b;e++)d.push(a.slice(Math.floor(c*e/b),Math.floor(c*(e+1)/b)));return d}function J(a){for(var b=[],c=0;c<a.length;c++)b=
b.concat(a[c]);return b}function F(a){var b=new g(r(a.store.indexCRS||a.store.geographicCRS));return b.equals(a.spatialReference)?a.spatialReference:b}function M(a){var b=new g(r(a.store.vertexCRS||a.store.projectedCRS));return b.equals(a.spatialReference)?a.spatialReference:b}function H(b,d,e){if(!c.canProject(b,d))throw new a("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if("local"===e&&b.isGeographic)throw new a("layerview:local-gcs-not-supported",
"Geographic coordinate systems are not supported in local scenes",{});}function I(a,b,c){var d=F(a);a=M(a);H(d,b,c);H(a,b,c)}Object.defineProperty(h,"__esModule",{value:!0});h.DDS_ENCODING_STRING="image/vnd-ms.dds";h.BROWSER_SUPPORTED_IMAGE_ENCODING_STRINGS=["image/jpeg","image/png"];h.extractWkid=r;h.getAppropriateTextureEncoding=function(a,b){if(Array.isArray(a)){if(b&&(b=a.indexOf(h.DDS_ENCODING_STRING),-1<b))return b;for(b=0;b<a.length;b++)if(-1<h.BROWSER_SUPPORTED_IMAGE_ENCODING_STRINGS.indexOf(a[b]))return b;
throw Error("Could not find appropriate texture encoding (among "+a.toString()+")");}return-1};h.findIntersectingNodes=t;h.buildTopNodeMap=function(a,b,c,d){void 0===d&&(d=Number.POSITIVE_INFINITY);if(0>=b)a.clear();else{var e=new Map,f=Number.POSITIVE_INFINITY;a.forEach(function(g,h){var k=c(g);if(h<b)f=Math.min(f,k),e.set(g.id,k);else if(!(k<=f||k>=d)){e.set(g.id,k);h=f=e.get(a.front().id);for(var k=0,l=1;l<b;++l){var m=e.get(a.data[l].id);m<f&&(k=l,h=f,f=m)}a.data[k]=g;f=h}});a.length=Math.min(a.length,
b);a.sort(function(a,b){return e.get(b.id)-e.get(a.id)})}};var K=[0,0,0,0];h.intersectBoundingBoxWithMbs=u;h.findFieldsCaseInsensitive=x;h.whenGraphicAttributes=function(b,c,e,f,g,h){var k=!0===(h&&h.populateObjectId),l=h.ignoreUnavailableFields?void 0:[],m=1===f.length&&"*"===f[0];!m&&k&&(f=v(f,e));f=m?f:x(f,b.fields,{missingFields:l});if(l&&0!==l.length)return d.reject(new a("scenelayer:unknown-fields","This scene layer does not have the requested fields",{unknownFields:l}));if(0===c.length)return d.resolve(c);
var k=b.associatedLayer,l=b.attributeStorageInfo,n=m?b.fields.map(function(a){return a.name}):f;if(k)return A(k,c,e,n);b=y(n,c[0]);return 0===b.length?d.resolve(c):l?(g=g(),null==g?d.reject(new a("scenelayer:feature-not-loaded","Tried to query attributes for unloaded features")):B(l,g.node,g.indices,b,h).then(function(a){for(var b=0;b<c.length;b++){for(var d=0,e=n;d<e.length;d++){var f=e[d];f in a[b]||(a[b][f]=c[b].attributes[f])}c[b].attributes=a[b]}return c})):d.reject(new a("scenelayer:no-attribute-source",
"This scene layer does not have a source for attributes available"))};var O=-Math.pow(2,15),P=-Math.pow(2,31);h.getCachedAttributeValue=D;h.convertFlatRangesToOffsets=function(b,c,d){void 0===d&&(d=2);c=null!=c?c:b.length/d;for(var e=new Uint32Array(c+1),f=0;f<c;f++){var g=b[f*d];e[f]=3*g;var h=(f-1)*d+1;if(0<=h&&g-1!==b[h])throw new a("Face ranges are not continuous");}e[e.length-1]=3*(b[(c-1)*d+1]+1);return e};h.getIndexCrs=F;h.getVertexCrs=M;h.getCacheKeySuffix=function(a,b){return b===l.SphericalECEFSpatialReference?
"@ECEF":a.equals(b)?"":null!=b.wkid?"@"+b.wkid:null};h.checkSpatialReference=H;h.checkSpatialReferences=I;h.checkSceneLayerValid=function(b){var c;(c=null==b.store||null==b.store.defaultGeometrySchema)||(b=b.store.defaultGeometrySchema,c=!!(null!=b.geometryType&&"triangles"!==b.geometryType||null!=b.topology&&"PerAttributeArray"!==b.topology||null==b.vertexAttributes||null==b.vertexAttributes.position));if(c)throw new a("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",
{});};h.checkSceneLayerCompatibleWithView=function(a,b){I(a,b.spatialReference,b.viewingMode)};h.checkPointCloudLayerValid=function(b){var c;(c=null==b.store||null==b.store.defaultGeometrySchema)||(b=b.store.defaultGeometrySchema,c=!!(null==b.geometryType||"points"!==b.geometryType||null!=b.topology&&"PerAttributeArray"!==b.topology||null!=b.encoding&&""!==b.encoding&&"lepcc-xyz"!==b.encoding||null==b.vertexAttributes||null==b.vertexAttributes.position));if(c)throw new a("pointcloud:unsupported-geometry-schema",
"The geometry schema of this point cloud scene layer is not supported.",{});};h.checkPointCloudLayerCompatibleWithView=function(a,b){H(a.spatialReference,b.spatialReference,b.viewingMode)};h.encodeSymbolColor=m.encodeSymbolColor;h.rendererNeedsTextures=function(a){if(null==a||"simple"!==a.type&&"class-breaks"!==a.type&&"unique-value"!==a.type||("unique-value"===a.type||"class-breaks"===a.type)&&null==a.defaultSymbol)return!0;a=a.getSymbols();if(0===a.length)return!0;for(var b=0;b<a.length;b++){var c=
a[b];if("mesh-3d"!==c.type||0===c.symbolLayers.length)return!0;for(var d=0,c=c.symbolLayers.items;d<c.length;d++){var e=c[d];if("fill"!==e.type||null==e.material||"replace"!==e.material.colorMixMode)return!0}}return!1}})},"esri/views/3d/layers/i3s/IDBCache":function(){define(["require","exports","../../../../core/Error","../../../../core/promiseUtils"],function(q,h,e,a){function d(b){return a.create(function(a,d){b.oncomplete=function(){return a()};b.onerror=function(){return d(b.error)};b.onabort=
function(){return d(b.error)}})}function b(b){return a.create(function(a,d){"done"===b.readyState?null!=b.error?d(b.error):a(b.result):(b.onsuccess=function(){return a(b.result)},b.onerror=function(){return d(b.error)})})}Object.defineProperty(h,"__esModule",{value:!0});q=function(){function g(a,b,d){this._quotaReductionPromise=this._db=null;this._miss=this._hit=this._gcCounter=0;this._destroyed=!1;this.gcFrequency=50;this.maxByteSize=1073741824;this.quotaReductionFactor=.2;this._dbName=a;this._storeName=
b;this._version=d}g.prototype.init=function(){var c=this;return a.resolve().then(function(){var a=indexedDB.open(c._dbName,c._version);a.onupgradeneeded=function(b){var d=a.result,e=a.transaction,f=d.objectStoreNames.contains(c._storeName)?e.objectStore(c._storeName):d.createObjectStore(c._storeName),d=d.objectStoreNames.contains("last_access")?e.objectStore("last_access"):d.createObjectStore("last_access");d.indexNames.contains("date")||d.createIndex("date","date",{unique:!1});d.indexNames.contains("byteSize")||
d.createIndex("byteSize","byteSize",{unique:!1});b.oldVersion<c._version&&(f.clear(),d.clear())};return b(a)}).then(function(a){c._destroyed?a.close():c._db=a})};g.prototype.destroy=function(){this._db&&(this._db.close(),this._db=null);this._destroyed=!0};g.prototype.getHitRate=function(){return this._hit/(this._hit+this._miss)};g.prototype.put=function(b,d){var c=this;return null==this._db?a.reject(new e("indexedb:not-initialized","IndexedDB Cache is not initialized")):(null!=this._quotaReductionPromise?
this._quotaReductionPromise:a.resolve()).then(function(){return c._put(b,d)}).catch(function(a){if("QuotaExceededError"===a.name)return null==c._quotaReductionPromise&&(c._quotaReductionPromise=c._getCacheSize().then(function(a){return c._removeLeastRecentlyAccessed(d.byteSize+Math.ceil(a*c.quotaReductionFactor))}),c._quotaReductionPromise.always(function(){c._quotaReductionPromise=null})),c._quotaReductionPromise.then(function(){return c._put(b,d)});throw a;}).then(function(){c._gcCounter--;0>c._gcCounter&&
(c._gcCounter=c.gcFrequency,c._getCacheSize().then(function(a){return c._removeLeastRecentlyAccessed(a-c.maxByteSize)}))})};g.prototype.get=function(c){var d=this;return null==this._db?a.resolve(null):a.resolve().then(function(){var a=d._db.transaction(d._storeName,"readonly").objectStore(d._storeName).get(c);return b(a)}).then(function(a){null==a?++d._miss:(++d._hit,d._db.transaction("last_access","readwrite").objectStore("last_access").put({date:(new Date).getTime(),byteSize:a.byteSize},c));return a}).catch(function(a){++d._miss;
return null})};g.prototype.remove=function(b){var c=this;return null==this._db?a.resolve():a.resolve().then(function(){var a=c._db.transaction([c._storeName,"last_access"],"readwrite"),e=a.objectStore(c._storeName),f=a.objectStore("last_access");e.delete(b);f.delete(b);return d(a)})};g.prototype._put=function(a,b){var c=this._db.transaction([this._storeName,"last_access"],"readwrite");c.objectStore(this._storeName).put(b,a);c.objectStore("last_access").put({date:(new Date).getTime(),byteSize:b.byteSize},
a);return d(c)};g.prototype._removeLeastRecentlyAccessed=function(a){if(!(0>=a)){var b=this._db.transaction([this._storeName,"last_access"],"readwrite"),c=b.objectStore(this._storeName),e=b.objectStore("last_access"),g=0,h=e.index("date").openCursor(null,"next");h.onsuccess=function(b){b=h.result;null!=b&&(null!=b.value.byteSize&&(g+=b.value.byteSize),c.delete(b.primaryKey),e.delete(b.primaryKey),g<a&&b.continue())};return d(b)}};g.prototype._getCacheSize=function(){var a=this._db.transaction("last_access"),
b=0,e=a.objectStore("last_access").index("byteSize").openKeyCursor();e.onsuccess=function(a){if(a=e.result){var c=a.key;null!=c&&(b+=c);a.continue()}};return d(a).then(function(){return b})};return g}();h.IDBCache=q;h.whenTransaction=d;h.whenRequest=b})},"esri/views/3d/layers/support/attributeUtils":function(){define(["require","exports"],function(q,h){Object.defineProperty(h,"__esModule",{value:!0});h.attributeLookup=function(e,a){a=a.toLowerCase();for(var d=0,b=Object.keys(e);d<b.length;d++){var g=
b[d];if(g.toLowerCase()===a)return e[g]}return null}})},"esri/views/3d/layers/support/layerViewUpdatingProperties":function(){define(["require","exports"],function(q,h){Object.defineProperty(h,"__esModule",{value:!0});h.updatingPercentageValue={value:100,readOnly:!0};h.updatingPercentage={dependsOn:["updating","updatingPercentageValue"],readOnly:!0,value:0,get:function(){return this.updating?this.updatingPercentageValue:0}}})},"esri/views/3d/layers/i3s/I3SIndex":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/PooledArray ../../../../core/urlUtils ./I3SUtil ../../support/orientedBoundingBox".split(" "),
function(q,h,e,a,d,b,g){var c="version level sharedResource attributeData geometryData textureData lodSelection".split(" ");q=function(){function h(b,c,e,g,h,k,n,q,A,y,C){var l=this;this.rootId=e;this.progressiveLoadPenalty=g;this.nodeIndex=h;this.streamDataSupplier=k;this.viewportQueries=n;this.logger=q;this._isLoaded=A;this._needsLoading=y;this._needsUpdate=C;this._prefetching=this._loading=this._dirty=!0;this._loadingNodes=new Set;this._indexMissing=1;this._nodesMissing=0;this._maxUnloadedPrio=
Number.NEGATIVE_INFINITY;this._nodeTraversalState={};this._version=0;this._featureEstimate={estimate:0,leafsReached:!1};this._unloadedMemoryEstimate=0;this._missing=new a;this._prefetch=new a;this._updates=new f;this.ignoreServiceOBB=!1;this._maxLodLevel=this.viewportQueries.maxLodLevel;this.rootUrl=d.makeAbsolute(c,b);this.traverseVisible(function(a,b){return l.nodeTraversalState(b)})}h.prototype.requestReload=function(){this._prefetching=this._loading=this._dirty=!0;++this._version};h.prototype.update=
function(a){var b=this;if(this._dirty){this._nodesMissing=this._indexMissing=0;this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;this._missing.clear();this._prefetch.clear();this._updates.reset(a);this._prefetching=this._loading=!1;var c=!0,d=new k,f=new k;this.traverseVisible(function(g,h,k){b._updateFeatureEstimate(h,f);if(h){if(0===b._missing.length&&h.children)for(g=0,k=h.children;g<k.length;g++){var l=k[g];b.nodeIndex[l.id]||(b._prefetching=!0,b._loadingNodes.has(l.id)||b._prefetch.push(e({},l,
{baseUrl:h.baseUrl})))}!h.failed&&h.featureData&&0!==h.featureData.length&&(b._isLoaded(h)?(d.known+=h.memory,++d.knownNodes,b._needsLoading(h)?h.children&&(c=!1):(d.unremoved+=h.memory,c=!1),b._needsUpdate(h)&&b._updates.update.push(h)):(h.memory&&(d.known+=h.memory,++d.knownNodes),b._needsLoading(h)&&(++b._nodesMissing,h.children&&(c=!1),h.memory?(d.missing+=h.memory,d.known+=h.memory,++d.knownNodes):++d.missingNodes,0<=a.indexOf(h.id)?b._updates.cancel=b._updates.cancel.filter(function(a){return a!==
h.id}):b._updates.add.push(h))))}else++b._indexMissing,b._loading=!0,b._prefetching=!1,b._loadingNodes.has(g.id)||b._missing.push(e({},g,{baseUrl:k}))});this._unloadedMemoryEstimate=d.missing-d.unremoved;3<d.knownNodes&&(this._unloadedMemoryEstimate+=d.missingNodes*d.known/d.knownNodes);this._unloadedMemoryEstimate=.8*Math.max(0,this._unloadedMemoryEstimate);this._featureEstimate.estimate=f.known-f.missing;this._featureEstimate.leafsReached=c;if(0<f.knownNodes){var g=f.missing-f.unremoved+f.known/
f.knownNodes*f.missingNodes;0<this._featureEstimate.estimate+g&&(this._featureEstimate.estimate+=g)}this._dirty=0<this._indexMissing||0<this._nodesMissing||0<this._updates.add.length||0<this._updates.update.length||0<this._updates.cancel.length}};h.prototype.checkFeatureTarget=function(a,b){var c=this;b=this.viewportQueries.updateScreenSpaceErrorBias(b);++this._version;var d=new k;this.traverseVisible(function(a,b){return c._updateFeatureEstimate(b,d)});var e=d.known-d.missing;if(0<d.knownNodes){var f=
d.missing-d.unremoved+d.known/d.knownNodes*d.missingNodes;0<e+f&&(e+=f)}this.viewportQueries.updateScreenSpaceErrorBias(b);++this._version;return e<=a};h.prototype._updateFeatureEstimate=function(a,b){a&&!a.failed&&a.featureData&&0!==a.featureData.length&&(this._isLoaded(a)?(b.known+=a.numFeatures,++b.knownNodes,this._needsLoading(a)||(b.unremoved+=a.numFeatures)):this._needsLoading(a)&&(a.numFeatures?(b.missing+=a.numFeatures,b.known+=a.numFeatures,++b.knownNodes):++b.missingNodes))};h.prototype.load=
function(a){var c=this;b.buildTopNodeMap(this._missing,a,function(a){return c.entryPriority(a)});if(0>=this._missing.length)return this._loading;this._maxUnloadedPrio=this.entryPriority(this._missing.front());this._missing.forEach(function(a){return c._loadNode(a)});this._missing.clear();return this._loading};h.prototype.prefetch=function(a){var c=this;b.buildTopNodeMap(this._prefetch,a,function(a){return c.entryPriority(a)});this._prefetch.forEach(function(a){return c._loadNode(a)});this._prefetch.clear()};
h.prototype.isLoading=function(){return this._loading};h.prototype.isPrefetching=function(){return this._prefetching};h.prototype.getIndexLoading=function(){return this._loadingNodes.size};h.prototype.getIndexMissing=function(){return this._indexMissing};h.prototype.getUnloadedMemoryEstimate=function(){return this._unloadedMemoryEstimate};h.prototype.getNodesMissing=function(){return this._nodesMissing};h.prototype.getUpdates=function(a){var c=this;b.buildTopNodeMap(this._updates.add,a,function(a){return c.entryPriority(a)},
this._maxUnloadedPrio);b.buildTopNodeMap(this._updates.update,Number.POSITIVE_INFINITY,function(a){return c.entryPriority(a)});return this._updates};h.prototype.getFeatureEstimate=function(){return this._featureEstimate};h.prototype.nodeTraversalState=function(a){if(!a)return null;var b=this._nodeTraversalState[a.id];if(b&&b.version===this._version)return b;var c=this.viewportQueries.getLodLevel(a),d=this.viewportQueries.hasLOD(a),e=!0;if(d)if(a.parentNode){e=this.nodeIndex[a.parentNode.id];if(null==
e)return null;e=(e=this._nodeTraversalState[e.id])&&c>e.lodLevel}else e=0<c;if(b)return b.lodLevel=c,b.isChosen=e,b.version=this._version,b;this._nodeTraversalState[a.id]={nodeHasLOD:d,lodLevel:c,isChosen:e,version:this._version};return this._nodeTraversalState[a.id]};h.prototype._loadNode=function(a){var b=this;this._loadingNodes.add(a.id);var e=d.makeAbsolute(a.href,a.baseUrl);this.streamDataSupplier.request(e,"json").then(function(a,d){var e={id:d.id,mbs:d.mbs,parentNode:d.parentNode,children:d.children,
featureData:d.featureData};c.forEach(function(a){e[a]=d.hasOwnProperty(a)?d[a]:null});d.hasOwnProperty("obb")&&!b.ignoreServiceOBB&&(e.obb=g.clone(d.obb),e.hasServiceOBB=!0,b.viewportQueries.updateNode(e.id));b.nodeIndex[e.id]=e;e.baseUrl=a;e.featureData&&1===e.featureData.length&&e.featureData[0].featureRange&&(e.numFeatures=e.featureData[0].featureRange[1]-e.featureData[0].featureRange[0]+1);b.nodeTraversalState(e);b._loadingNodes.delete(e.id);b._dirty=!0},function(c){b.loadErrorCallback(e);b._loadingNodes.delete(a.id);
b._dirty=!0})};h.prototype.entryPriority=function(a){if(a.id===this.rootId)return 0;var b=0,c=this.nodeIndex[a.id];if(null!=c&&null!=c.parentNode){var d=this._nodeTraversalState[c.parentNode.id];null!=d&&(b=d.lodLevel)}for(d=this.progressiveLoadPenalty;c;c=c.parentNode?this.nodeIndex[c.parentNode.id]:null)if(this._isLoaded(c)){d=0;break}a=this.viewportQueries.distToPOI(a);return-a-b*(a+this.progressiveLoadPenalty)+d};h.prototype.traverseVisible=function(a){var b=this.nodeIndex[this.rootId];b?this._traverse({id:this.rootId,
mbs:b.mbs,href:this.rootUrl},b,a,""):a({id:this.rootId,mbs:null,href:this.rootUrl},null,"")};h.prototype._traverse=function(a,b,c,d){if(!b.children||0===b.children.length)this.viewportQueries.isGeometryVisible(b)&&c(a,b,d);else if(this.viewportQueries.isNodeVisible(b)&&(c(a,b,d),a=this.nodeTraversalState(b),!a.nodeHasLOD||a.lodLevel!==this._maxLodLevel))for(a=0,d=b.children;a<d.length;a++){var e=d[a],f=this.nodeIndex[e.id];f?this._traverse(e,f,c,b.baseUrl):this.viewportQueries.isNodeVisible(e)&&c(e,
null,b.baseUrl)}};h.prototype.loadErrorCallback=function(a){this.logger.warn("Error loading node: "+a)};h.prototype.updateStats=function(a){this._nodesMissing&&(a.nodes+=" + "+Math.round(this._nodesMissing));this._indexMissing&&(a.index+=" + "+this._indexMissing);if(this._featureEstimate.estimate){var b=this._featureEstimate.estimate-a.features;0<b?a.features+=" + "+b:0>b&&(a.features+=" - "+-b)}};return h}();var f=function(){function b(){this.update=new a;this.add=new a}b.prototype.reset=function(a){this.add.clear();
this.update.clear();this.cancel=a};return b}(),k=function(){return function(){this.unremoved=this.missingNodes=this.missing=this.knownNodes=this.known=0}}();return q})},"esri/views/3d/layers/i3s/I3SLodHandling":function(){define(["require","exports","../../../../core/PooledArray"],function(q,h,e){q=function(){function d(a,d,c){this.layerViewRequiredFunctions=a;this.layerViewOptionalFunctions=d;this.lodGlobalDirtyChanged=c}d.prototype.startNodeLoading=function(a,d,c,e,h,n){this._lodGlobalDirty=!1;
this._maxLodLevel=n.maxLodLevel;this._nodeIndex=e;this._rootId=h;this._nodeTraversalState=c;this._isNodeVisible=a;this._isGeometryVisible=d;this.lodGlobalDirtyChanged(this._lodGlobalDirty)};d.prototype.shouldLoadNode=function(a){var b=this._nodeTraversalState(a);return b.isChosen?b.lodLevel===this._maxLodLevel?!0:this.childrenEmpty(a):!1};d.prototype.setLodGlobalDirty=function(){this._lodGlobalDirty=!0;this.lodGlobalDirtyChanged(this._lodGlobalDirty)};d.prototype.lodSwapBundleLoaded=function(a){this.setLodGlobalDirty()};
Object.defineProperty(d.prototype,"requiresLODGlobalHandling",{get:function(){return null!=this._rootId&&(!0===this._lodGlobalDirty||1.1<this.layerViewRequiredFunctions.getMemoryUsage())},enumerable:!0,configurable:!0});d.prototype.lodGlobalHandling=function(){if(this.requiresLODGlobalHandling){var b=this._rootId,d=this.layerViewRequiredFunctions.getMemoryUsage(),d=Math.max(0,Math.floor(10*(d-1)));a.clear();this._lodGlobalHandlingRecursion(b,d);this.layerViewRequiredFunctions.removeNodeData(a);a.clear();
this._lodGlobalDirty=!1;this.lodGlobalDirtyChanged(this._lodGlobalDirty)}};d.prototype._lodGlobalHandlingRecursion=function(b,d){b=this._nodeIndex[b];if(null==b)return!1;var c=this._nodeTraversalState(b),e=c.isChosen&&(!c.nodeHasLOD||c.lodLevel===this._maxLodLevel);(c=this.layerViewRequiredFunctions.isNodeLoaded(b))&&null!=this.layerViewOptionalFunctions.setPolygonOffset&&this.layerViewOptionalFunctions.setPolygonOffset(b,!e);if(e&&c)return this._removeChildrenRecursive(b),!0;var g=!1;if(null!=b.children&&
0!==b.children.length)for(var g=!0,h=0,l=b.children;h<l.length;h++){var p=l[h],m=this._nodeIndex[p.id];if(m?this._isGeometryVisible(m):this._isNodeVisible(p))p=this._lodGlobalHandlingRecursion(p.id,d),g=g&&p}c&&!e&&(g||a.length<d)&&(a.push(b),c=!1);d=!b.featureData||0===b.featureData.length;return g||c||d};d.prototype._removeChildrenRecursive=function(b){if(null!=b.children){var d=0;for(b=b.children;d<b.length;d++){var c=this._nodeIndex[b[d].id];null!=c&&(this._removeChildrenRecursive(c),a.push(c))}}};
d.prototype._subtreeEmpty=function(a){return this.layerViewRequiredFunctions.isNodeLoaded(a)?!1:this.childrenEmpty(a)};d.prototype.childrenEmpty=function(a){if(null==a.children)return!0;var b=0;for(a=a.children;b<a.length;b++){var c=a[b];if(this._isNodeVisible(c)&&(c=this._nodeIndex[c.id],null!=c&&!this._subtreeEmpty(c)))return!1}return!0};return d}();var a=new e;return q})},"esri/views/3d/layers/i3s/I3SNodeLoader":function(){define("require exports dojo/Deferred dojo/errors/CancelError ../../../../core/lang ../../../../core/promiseUtils ../../../../core/urlUtils ./I3SBinaryReader ./I3SUtil ../../webgl-engine/lib/Util".split(" "),
function(q,h,e,a,d,b,g,c,f,k){q=function(){function h(a,c,d,e,f){this.loader=a;this.logger=c;this.defaultGeometrySchema=d;this.requiredAttributes=e;this.options=f;this.cancelled=!1;this.loadShared=function(a){if(null==a.sharedResource)return b.resolve({});var c=g.makeAbsolute(a.sharedResource.href,a.baseUrl);return this.load(c,"json").then(function(a){h.fixTextureEncodings(a);h.addAbsoluteHrefTexture(a,c);return a})}}h.prototype.cancelAll=function(){this.cancelled=!0};h.prototype.load=function(a,
b){b=this.loader.request(a,b);var c=new e;b.then(function(a,b){c.resolve(b)},function(b){c.reject(Error("Failed to load: "+a))});return c.promise};h.prototype.loadAttribute=function(a,b,d){a=g.makeAbsolute(d,a);return this.load(a,"binary").then(function(a){return c.readBinaryAttribute(b,a)})};h.prototype.loadAttributes=function(a,c,d){var e=this,f=d.map(function(d){return null==a.attributeData||null==a.attributeData[d.index]?(e.logger.error("Missing attributeData for '"+d.name+"' on node '"+a.id+
"'"),b.resolve(null)):e.loadAttribute(c,d.attributeStorageInfo,a.attributeData[d.index].href).catch(function(b){e.logger.error("Failed to load attributeData for '"+d.name+"' on node '"+a.id+"'");return null})});return b.all(f).then(function(a){for(var b={},c=0;c<d.length;++c)a[c]&&(b[d[c].name]=a[c]);return b})};h.prototype.prepareBinaryGeometryData=function(a,b,e,g){d.mixin(a.geometries[0].params,e);g||null!=e.vertexAttributes.region||delete e.vertexAttributes.region;if(null!=e.featureAttributes){g=
e.featureAttributes;if(g.faceRange){var h=c.createTypedView(b,g.faceRange);a.componentOffsets=f.convertFlatRangesToOffsets(h,e.header.fields.featureCount,g.faceRange.valuesPerElement)}if(g.id){a.featureIds=[];var h=1,k=c.valueType2TypedArrayClassMap[g.id.valueType];"UInt64"===g.id.valueType&&(k=Uint32Array,h=2);b=new k(b,g.id.byteOffset,g.id.count*g.id.valuesPerElement*h);for(k=0;k<e.header.fields.featureCount;k++)if(a.featureIds[k]=b[k*g.id.valuesPerElement*h],2===h){var l=b[k*g.id.valuesPerElement*
h+1];if(2097150<=l)throw Error("ID exceeded maximum range supported by javascript (max \x3d 53bit-1 \x3d 9007199254740991)");a.featureIds[k]+=4294967296*l}}}};h.prototype.loadBundleData=function(a,d){var e=this,f=a.baseUrl,h=null,k=this.loadShared(a),l=null;null!=this.requiredAttributes&&(l=this.loadAttributes(a,f,this.requiredAttributes));var n=null;null!=a.geometryData&&(f=g.makeAbsolute(a.geometryData[d].href,f),n=this.load(f,"binary"));return k.then(function(f){e.handleCancelled();return(e.options.loadFeatureData?
e.loadFeatureData(a,d):b.resolve(null)).then(function(d){e.handleCancelled();var g=e.options.loadFeatureData?e.collectGeometries(a,d,f):e.meshPyramidGeometryData(a,f);d=null!=n?n.then(function(a){h=a;var b=Object.keys(f.materialDefinitions)[0],b=f.materialDefinitions[b].params.vertexRegions,d=c.createGeometryDataIndex(a,e.defaultGeometrySchema,b);e.prepareBinaryGeometryData(g[0],a,d,b);return g}):b.resolve(g);var k=e.loadTextures(g,f);return b.all([k,d,l])}).then(function(a){var b=a[0],c=a[1];a=a[2];
e.handleCancelled();var d=null;a&&(d={attributeData:a,loadedAttributes:e.requiredAttributes});return{allGeometryData:c,attributeDataInfo:d,geometryBuffer:h,sharedResource:f,textureData:b}})})};h.addAbsoluteHrefTexture=function(a,b){a=a.textureDefinitions;if(null!=a)for(var c=0,d=Object.keys(a);c<d.length;c++)for(var e=0,f=a[d[c]].images;e<f.length;e++){var h=f[e];Array.isArray(h.href)?h.hrefConcat=h.href.map(function(a){return g.makeAbsolute(a,b)}):h.hrefConcat=g.makeAbsolute(h.href,b)}};h.fixTextureEncodings=
function(a){a=a.textureDefinitions;if(null!=a)for(var b in a){var c=a[b];if(Array.isArray(c.encoding))for(var d=0;d<c.encoding.length;d++){var e=c.encoding[d];"data:"===e.substring(0,5)&&(c.encoding[d]=e.substring(5))}else e=c.encoding,"data:"===e.substring(0,5)&&(c.encoding=e.substring(5))}};h.prototype.loadTexture=function(a,b,c,d){var e=this;return d===f.DDS_ENCODING_STRING?this.load(a,"binary").then(function(a){e.handleCancelled();return{i3sTexId:b,data:a,encoding:d}}):this.load(a,"image").then(function(a){var f=
a;e.handleCancelled();if(c&&4096<=a.width*a.height){var f=Math.ceil(a.width/2),g=Math.ceil(a.height/2),h=document.createElement("canvas");h.width=f;h.height=g;h.getContext("2d").drawImage(a,0,0,f,g);f=h}return{i3sTexId:b,data:f,encoding:d}})};h.prototype.loadTextures=function(a,c){for(var d=[],e=0;e<a.length;e++){var g=a[e].geometries;if(null!=g)for(var l=0;l<g.length;l++){var n=g[l].params.textureID||"none";if("none"!==n){null!=c.textureDefinitions&&null!=c.textureDefinitions[n]||this.logger.warn("textureDefinitions missing in shared resource. i3sTexId: "+
n);var p=c.textureDefinitions[n];k.assert(void 0!==p,"geometry wants unknown texture "+n);if(0!==p.images.length){var q=p.images[p.images.length-1],y=this.options.textureFormat===h.TextureFormat.Downsampled,C=f.getAppropriateTextureEncoding(p.encoding,this.options.textureFormat===h.TextureFormat.Compressed),p=-1<C?p.encoding[C]:p.encoding,q=-1<C?q.hrefConcat[C]:q.hrefConcat;this.options.loadTextureData?d.push(this.loadTexture(q,n,y,p)):d.push({i3sTexId:n,encoding:p,data:null})}}}}return b.all(d)};
h.prototype.meshPyramidGeometryData=function(a,b){a=b.materialDefinitions?Object.keys(b.materialDefinitions)[0]:null;b=b.textureDefinitions?Object.keys(b.textureDefinitions)[0]:null;return[{featureIds:[],geometries:[{type:"ArrayBufferView",params:{materialID:a,textureID:b}}],featureDataPosition:[0,0,0]}]};h.prototype.collectGeometries=function(a,b,c){a=[];c=0;for(b=b.featureData;c<b.length;c++){var d=b[c],e=d.geometries;if(null!=e)for(var f=0;f<e.length;f++)a.push({featureIds:[d.id],featureDataPosition:d.position,
geometries:[d.geometries[f]]});else null!=d.position&&a.push({featureIds:[d.id],featureDataPosition:d.position,geometries:null})}return a};h.prototype.loadFeatureData=function(a,b){a=g.makeAbsolute(a.featureData[b].href,a.baseUrl);return this.load(a,"json")};h.prototype.handleCancelled=function(){if(this.cancelled)throw new a;};return h}();(function(a){a=a.TextureFormat||(a.TextureFormat={});a[a.Compressed=0]="Compressed";a[a.Normal=1]="Normal";a[a.Downsampled=2]="Downsampled"})(q||(q={}));return q})},
"esri/views/3d/layers/i3s/I3SViewportQueries":function(){define("require exports ../../../../geometry/Point ../graphics/ElevationContext ../graphics/featureExpressionInfoUtils ../graphics/Graphics3DSymbolCommonCode ./I3SUtil ../../lib/glMatrix ../../support/geometryUtils ../../support/orientedBoundingBox ../../support/projectionUtils ../../webgl-engine/lib/Util".split(" "),function(q,h,e,a,d,b,g,c,f,k,n,l){return function(){function h(b,g,h,k,l,n,p,q){void 0===q&&(q={});this.indexSR=b;this._renderCoordsHelper=
g;this.extent=l;this.elevationProvider=n;this.options=q;this._computedOBBs={};this._computedMBSs={};this._isNodeVisibleCached={};this.fp=[];this._idleCamera=!0;this.maxDistance=0;this.maxLodLevel=2;this._tmp1=[0,0,0];this._tmp2=[0,0,0];this._tmp3=[0,0,0];this._tmp0=[0,0,0];this.supportedMetrics=["maxScreenThreshold","screenSpaceRelative","removedFeatureDiameter","distanceRangeFromDefaultCamera"];this.screenspaceErrorBias=q.screenspaceErrorBias||1;this.progressiveLoadFactor=q.progressiveLoadFactor||
1;this.enableLoD=!q.disableLod;for(g=0;8>g;++g)this.fp[g]=f.plane.create();this.updateCamera(h);this._poi=c.vec3d.create(k);this.engineSR=this._renderCoordsHelper.spatialReference;p?(this._elevationContext=new a,this._elevationContext.featureExpressionInfoContext=d.createContext(d.extractExpressionInfo(p,!1)),this._elevationContext.mixinApi(p)):this._elevationContext=null;this.tmpPoint=new e({x:0,y:0,z:0,spatialReference:b})}h.prototype.updateCamera=function(a){l.matrixToFrustumPlanes(a.viewMatrix,
a.projectionMatrix,this.fp);this._screenSizeFactor=1/a.perPixelRatio;this._camPos=a.eye;this._isNodeVisibleCached={}};h.prototype.updateNode=function(a){delete this._isNodeVisibleCached[a]};h.prototype.updatePointOfInterest=function(a){c.vec3d.set(a,this._poi);this.maxDistance=0};h.prototype.updateScreenSpaceErrorBias=function(a){var b=this.screenspaceErrorBias;this.screenspaceErrorBias=a;return b};h.prototype.setCameraIdle=function(a){this._idleCamera!==a&&(this._idleCamera=a,this._isNodeVisibleCached=
{})};h.prototype.updateExtent=function(a){this.extent=a;this._isNodeVisibleCached={}};h.prototype.computeMbs=function(a){var d=this._computedMBSs[a.id];d||(d=c.vec4d.createFrom(a.mbs[0],a.mbs[1],a.mbs[2],-1),this._computedMBSs[a.id]=d);0>d[3]&&(c.vec4d.set(a.mbs,d),this._elevationContext&&1E5>d[3]&&(this.tmpPoint.x=d[0],this.tmpPoint.y=d[1],this.tmpPoint.z=d[2],d[2]=b.computeElevation(this.elevationProvider,this.tmpPoint,this._elevationContext,this._renderCoordsHelper,null)),n.mbsToMbs(d,this.indexSR,
d,this.engineSR));return d};h.prototype.computeObb=function(a){if(a.obb&&!(0>a.obb.halfSize[0])){var d=this._computedOBBs[a.id];d||(d=k.clone(a.obb),d.halfSize[0]=-1,this._computedOBBs[a.id]=d);0>d.halfSize[0]&&(d.halfSize[0]=a.obb.halfSize[0],c.vec3d.set(a.obb.center,d.center),this._elevationContext&&1E5>a.mbs[3]&&(this.tmpPoint.x=a.obb.center[0],this.tmpPoint.y=a.obb.center[1],this.tmpPoint.z=a.obb.center[2],d.center[2]=b.computeElevation(this.elevationProvider,this.tmpPoint,this._elevationContext,
this._renderCoordsHelper,null)),n.bufferToBuffer(d.center,this.indexSR,0,d.center,this.engineSR,0,1));return d}};h.prototype._isNodeVisible=function(a){var b=this.computeMbs(a);return this.isMBSinExtent(b)?a.hasServiceOBB&&a.obb?(a=this.computeObb(a),k.isVisible(a,this.fp)):this.isMBSVisible(b):!1};h.prototype.isNodeVisible=function(a){if(!this.enableLoD)return!0;if(!this._idleCamera)return this._isNodeVisible(a);if(null!=this._isNodeVisibleCached[a.id])return this._isNodeVisibleCached[a.id];this._isNodeVisibleCached[a.id]=
this._isNodeVisible(a);return this._isNodeVisibleCached[a.id]};h.prototype.isGeometryVisible=function(a){return this.isNodeVisible(a)?a.hasServiceOBB?!0:(a=this.computeObb(a))?k.isVisible(a,this.fp):!0:!1};h.prototype.invalidateCache=function(a){if(null==a){for(var b=0,c=Object.keys(this._computedMBSs);b<c.length;b++)a=c[b],this._computedMBSs[a][3]=-1;b=0;for(c=Object.keys(this._computedOBBs);b<c.length;b++)a=c[b],this._computedOBBs[a].halfSize[0]=-1}else this._computedMBSs[a]&&(this._computedMBSs[a][3]=
-1),this._computedOBBs[a]&&(this._computedOBBs[a].halfSize[0]=-1)};h.prototype.isMBSinExtent=function(a){return this.extent?0!==g.intersectBoundingBoxWithMbs(this.extent,a):!0};h.prototype.isMBSVisible=function(a){var b=a[0],c=a[1],d=a[2];a=a[3];var e=this.fp;return e[0][0]*b+e[0][1]*c+e[0][2]*d+e[0][3]<=a&&e[1][0]*b+e[1][1]*c+e[1][2]*d+e[1][3]<=a&&e[2][0]*b+e[2][1]*c+e[2][2]*d+e[2][3]<=a&&e[3][0]*b+e[3][1]*c+e[3][2]*d+e[3][3]<=a&&e[4][0]*b+e[4][1]*c+e[4][2]*d+e[4][3]<=a&&e[5][0]*b+e[5][1]*c+e[5][2]*
d+e[5][3]<=a};h.prototype.calcScreenSpaceSize=function(a,b){a=this.computeMbs(a);var d=a[3];a=c.vec3d.dist2(a,this._camPos)-d*d;return 0>a?.5*Number.MAX_VALUE:b/Math.sqrt(a)*this._screenSizeFactor};h.prototype.calcCameraDistance=function(a){a=this.computeMbs(a);return Math.max(0,c.vec3d.dist(a,this._camPos)-a[3])};h.prototype.calcAngleDependentLoD=function(a){a=this.computeMbs(a);var b=a[3];a=(Math.abs(a[0]*(a[0]-this._camPos[0])+a[1]*(a[1]-this._camPos[1])+a[2]*(a[2]-this._camPos[2]))/c.vec3d.length(a)+
b)/c.vec3d.dist(a,this._camPos);return Math.min(1,a)};h.prototype.hasLOD=function(a){return null!=a.lodSelection};h.prototype.hasFeatures=function(a){return null!=a.featureData};h.prototype.getDistancePlanarMode=function(a,b,c){var d=a[0]-b[0],e=a[1]-b[1];a=a[2]-b[2];d=d+d+e*e;if(d<=c*c)return Math.abs(a);c=Math.sqrt(d)-c;return Math.sqrt(a*a+c*c)};h.prototype.getDistanceGlobeMode=function(a,b,d){var e=c.vec3d.length(b),f=c.vec3d.length(a)-e;c.vec3d.scale(a,c.vec3d.dot(a,b)/c.vec3d.length2(a),this._tmp0);
if(c.vec3d.dist2(b,this._tmp0)<=d*d)return Math.abs(f);b=c.vec3d.scale(b,1/e,this._tmp0);var e=c.vec3d.scale(b,e-d*d/2/e,this._tmp1),g=c.vec3d.subtract(a,e,this._tmp2),g=c.vec3d.subtract(g,c.vec3d.scale(b,c.vec3d.dot(b,g),this._tmp3),this._tmp2),e=c.vec3d.add(e,c.vec3d.scale(g,d/c.vec3d.length(g),this._tmp2),this._tmp2);d=c.vec3d.dist(a,e);2E5<=f&&(a=c.vec3d.subtract(a,e,this._tmp1),a=c.vec3d.dot(a,b)/c.vec3d.length(a),.08>a&&(a=1E-4),d/=a);return d};h.prototype.getDistance=function(a,b,c){return this.engineSR===
n.SphericalECEFSpatialReference?this.getDistanceGlobeMode(a,b,c):this.getDistancePlanarMode(a,b,c)};h.prototype._selectErrorMetric=function(a){for(var b=0;b<a.length;b++)if(0<=this.supportedMetrics.indexOf(a[b].metricType))return a[b];return null};h.prototype.getLodLevel=function(a){if(!a.lodSelection||0>=a.lodSelection.length||!1===this.hasFeatures(a))return 0;if(null==a.children||0===a.children.length)return this.maxLodLevel;var b=this.enableLoD?this._selectErrorMetric(a.lodSelection):null;if(null==
b)return 0;if(1>this.progressiveLoadFactor){var c=this.screenspaceErrorBias;return this.evaluateLODmetric(a,this.progressiveLoadFactor*this.screenspaceErrorBias,b)?this.evaluateLODmetric(a,c,b)?2:1:0}return this.evaluateLODmetric(a,this.screenspaceErrorBias,b)?this.maxLodLevel:0};h.prototype.evaluateLODmetric=function(a,b,c){switch(c.metricType){case "screenSpaceRelative":return a=this.computeMbs(a),a=2*this.getDistance(this._camPos,a,a[3])/this._screenSizeFactor,c.maxError*b<=a;case "maxScreenThreshold":return b=
this.calcScreenSpaceSize(a,a.mbs[3]*b),this.options.angleDependentLoD&&(b*=this.calcAngleDependentLoD(a)),b<c.maxError;case "removedFeatureDiameter":return 10>this.calcScreenSpaceSize(a,c.maxError)*b;case "distanceRangeFromDefaultCamera":return this.calcCameraDistance(a)>c.maxError*b}return!1};h.prototype.distToPOI=function(a){a=this.computeMbs(a);a=c.vec3d.dist(a,this._poi)-a[3];this.maxDistance=Math.max(this.maxDistance,a);return a};h.prototype.distCameraToPOI=function(){return c.vec3d.dist(this._camPos,
this._poi)};return h}()})},"esri/views/3d/layers/i3s/IdleQueue":function(){define(["require","exports","dojo/Deferred"],function(q,h,e){Object.defineProperty(h,"__esModule",{value:!0});q=function(){function a(){this._deferreds=[];this._values=[]}a.prototype.push=function(a){var b=new e;this._deferreds.push(b);this._values.push(a);return b.promise};a.prototype.length=function(){return this._deferreds.length};a.prototype.process=function(){this._deferreds.shift().resolve(this._values.shift())};a.prototype.cancelAll=
function(){for(var a=0,b=this._deferreds;a<b.length;a++)b[a].cancel();this._deferreds.length=0;this._values.length=0};return a}();h.IdleQueue=q})},"esri/views/3d/layers/ElevationLayerView3D":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Error ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ./TiledLayerView3D ./support/tiledLayerUtils".split(" "),function(q,h,e,a,d,b,g,c,f,k){return function(f){function h(){return null!==
f&&f.apply(this,arguments)||this}e(h,f);h.prototype.initialize=function(){var a=this,c=this.get("view.map.ground.layers"),e=this.get("view.map.allLayers"),e=e&&e.includes(this.layer),c=c&&c.includes(this.layer);e&&!c&&(c=new d("layerview:elevation-layer-only","3D elevation layer '"+this.layer.id+"' can only be added in the map ground"),this.addResolvingPromise(b.reject(c)));(c=this._getTileInfoSupportError(this.tileInfo,this.layer.fullExtent))?this.addResolvingPromise(b.reject(c)):(c=g.whenTrueOnce(this.view,
"basemapTerrain.tilingSchemeLocked").then(function(){k.throwIfError(a._getTileInfoCompatibilityError(a.tileInfo,a.view.basemapTerrain.tilingScheme))}),this.addResolvingPromise(c));this.addResolvingPromise(k.checkArcGISServiceVersionCompatibility(this.layer));this._updateMinMaxDataLevel()};a([c.property({aliasOf:"layer.fullExtent"})],h.prototype,"fullExtent",void 0);a([c.property()],h.prototype,"layer",void 0);a([c.property({aliasOf:"layer.tileInfo"})],h.prototype,"tileInfo",void 0);return h=a([c.subclass("esri.views.3d.layers.ElevationLayerView3D")],
h)}(c.declared(f))})},"esri/views/3d/layers/TiledLayerView3D":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Error ../../../core/accessorSupport/decorators ./LayerView3D ./support/layerViewUpdatingProperties ../terrain/terrainUtils".split(" "),function(q,h,e,a,d,b,g,c,f){return function(g){function h(){var a=null!==g&&g.apply(this,arguments)||this;a.minDataLevel=0;a.maxDataLevel=Infinity;a._isUpdating=!1;return a}e(h,g);
Object.defineProperty(h.prototype,"imageFormatIsOpaque",{get:function(){return!1},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"isOpaque",{get:function(){return 1<=this.fullOpacity&&this.imageFormatIsOpaque},enumerable:!0,configurable:!0});h.prototype.getTileUrl=function(a,b,c){return this.layer.getTileUrl(a,b,c)};h.prototype.updatingChanged=function(a){this._isUpdating=a;this.notifyChange("updating")};h.prototype.isUpdating=function(){return this._isUpdating};h.prototype._getTileInfoSupportError=
function(a,b){if(a=f.checkIfTileInfoSupportedForView(a,b,this.view.spatialReference,this.view.basemapTerrain.manifold)){b={layer:this.layer,error:a};var c=void 0;switch(a.name){case "tilingscheme:local-gcs-not-supported":c=new d("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",b);break;case "tilingscheme:spatial-reference-mismatch":case "tilingscheme:global-unsupported-spatial-reference":c=new d("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",
b);break;default:c=new d("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",b)}return c}return null};h.prototype._getTileInfoCompatibilityError=function(a,b){return b.compatibleWith(a)?null:new d("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")};h.prototype._updateMinMaxDataLevel=function(){var a,b=Infinity,c=0;this.tileInfo.lods.forEach(function(a){b=Math.min(a.level,
b);c=Math.max(a.level,c)});a=[b,c];this.minDataLevel=a[0];this.maxDataLevel=a[1]};a([b.property({readOnly:!0})],h.prototype,"imageFormatIsOpaque",null);a([b.property(c.updatingPercentage)],h.prototype,"updatingPercentage",void 0);a([b.property(c.updatingPercentageValue)],h.prototype,"updatingPercentageValue",void 0);a([b.property()],h.prototype,"fullExtent",void 0);a([b.property({readOnly:!0,dependsOn:["fullOpacity","imageFormatIsOpaque"]})],h.prototype,"isOpaque",null);a([b.property()],h.prototype,
"layer",void 0);a([b.property()],h.prototype,"minDataLevel",void 0);a([b.property()],h.prototype,"maxDataLevel",void 0);a([b.property()],h.prototype,"tileInfo",void 0);return h=a([b.subclass("esri.views.3d.layers.TiledLayerView3D")],h)}(b.declared(g))})},"esri/views/3d/layers/support/tiledLayerUtils":function(){define("require exports dojo/request/xhr ../../../../core/Error ../../../../core/promiseUtils ../../../../layers/support/arcgisLayerUrl".split(" "),function(q,h,e,a,d,b){function g(a){var b=
null,c=a.search(/\/rest\/services\//i);0<c&&(b=a.substring(0,c+6));return b}Object.defineProperty(h,"__esModule",{value:!0});h.checkArcGISServiceVersionCompatibility=function(c){if(!b.isHostedAgolService(c.url)){if(10.22>c.version)return c=new a("layerview:service-version-too-old","Tiled Map Layers on servers prior to 10.2.2 are not supported. Detected version: "+c.version,{minVersion:10.22,detectedVersion:c.version}),d.reject(c);if(10.22!==c.version||b.isHostedSecuredProxyService(c.url,c.get("portalItem.id")))return d.resolve();
c=g(c.url);var f=new a("tiledlayerview3d:service-missing-cors-patch","Tiled Map Layers from 10.2.2 servers are only supported if all server updates have been applied.");return e(c+"self?f\x3djson",{headers:{"X-Requested-With":null},timeout:1E4,handleAs:"json"}).then(function(a){if(!a||a.error)throw f;}).catch(function(){throw f;})}};h.throwIfError=function(a){if(a)throw a;}})},"esri/views/3d/layers/FeatureLayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../Graphic ../../../core/Collection ../../../core/Error ../../../core/Evented ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/graphics/controllers/support/controllerUtils ../../../layers/graphics/sources/MemorySource ./FeatureLikeLayerView3D ../../layers/RefreshableLayerView".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u,x){h=function(d){function h(a){return d.call(this)||this}e(h,d);n=h;Object.defineProperty(h.prototype,"controllerTypeForSource",{get:function(){return this.layer.source&&this.layer.source.isInstanceOf&&this.layer.source.isInstanceOf(t)?"memory":"point"===this.layer.geometryType?"feature-tile-3d":"snapshot"},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"asyncGraphicsUpdates",{get:function(){if(this.controller&&"feature-tile-3d"===this.controller.type)switch(this.controller.mode){case "snapshot":return!1;
case "tiles":return!0}switch(this.controller?this.controller.type:this.controllerTypeForSource){case "feature-tile-3d":return!0;case "memory":case "snapshot":return!1}},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"suspendResumeExtentMode",{get:function(){if(this.controller&&"feature-tile-3d"===this.controller.type)return this.controller.suspendResumeExtentMode;switch(this.controller?this.controller.type:this.controllerTypeForSource){case "feature-tile-3d":return"data";case "memory":case "snapshot":return"computed"}},
enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"displayLimitExceeded",{get:function(){return this.controller&&"feature-tile-3d"===this.controller.type?!(this.suspended||!this.controller.displayLimitExceeded):!1},enumerable:!0,configurable:!0});h.prototype.createController=function(){return g(this,void 0,void 0,function(){var a;return b(this,function(b){switch(b.label){case 0:a=this.controllerTypeForSource;switch(a){case "memory":return[3,1];case "snapshot":return[3,3];case "feature-tile-3d":return[3,
5]}return[3,7];case 1:return[4,this.createMemoryController()];case 2:return[2,b.sent()];case 3:return[4,this.createSnapshotController()];case 4:return[2,b.sent()];case 5:return[4,this.createFeatureTileController()];case 6:return[2,b.sent()];case 7:return[3,8];case 8:return[2]}})})};h.prototype.createMemoryController=function(){return g(this,void 0,void 0,function(){var a;return b(this,function(b){switch(b.label){case 0:return[4,l.create(function(a){q(["../../../layers/graphics/controllers/MemoryController"],
a)})];case 1:return a=b.sent(),[2,new a({layerView:this,layer:this.layer,graphics:this.layer.source})]}})})};h.prototype.createFeatureTileController=function(){return g(this,void 0,void 0,function(){var a,c,d=this;return b(this,function(b){switch(b.label){case 0:return[4,l.create(function(a){q(["../../../layers/graphics/controllers/FeatureTileController3D"],a)})];case 1:return a=b.sent(),c=new a({layerView:this,graphics:new v,extent:this.clippingExtent}),this.handles.add([c.watch("suspendResumeExtentMode",
function(){return d.notifyChange("suspendResumeExtentMode")},!0),c.watch("displayLimitExceeded",function(){return d.notifyChange("displayLimitExceeded")},!0),c.watch("mode",function(){return d.notifyChange("asyncGraphicsUpdates")},!0)]),this.handles.add(p.init(c,"serviceDataExtent",function(a){return d.graphics3d.dataExtent=a})),this.handles.add(p.init(this,"suspended",function(a){a?c.suspend():c.resume()},!0)),this.handles.add(p.init(this.graphics3d.graphicsCore,"maxNumberOfFeatures",function(a){c.displayFeatureLimit=
{min:Math.ceil(A*a),max:a,perTile:Math.ceil(y*a)}})),[2,c]}})})};h.prototype.createSnapshotController=function(){return g(this,void 0,void 0,function(){var a,d,e;return b(this,function(b){switch(b.label){case 0:return this.addResolvingPromise(this.validateMaximumFeatureCount()),[4,l.create(function(a){q(["../../../layers/graphics/controllers/SnapshotController"],a)})];case 1:return a=b.sent(),d=f.ofType(c),e=new a({layerView:this,layer:this.layer,graphics:new d,maxPageSize:300,defaultReturnZ:!0,extent:this.clippingExtent}),
[4,e.when()];case 2:return b.sent(),this.handles.add(p.whenFalseOnce(this,"suspended",function(){e.startup()})),[2,e]}})})};h.prototype.validateMaximumFeatureCount=function(){return 0>n.maximumFeatureCount||!this.layer.url?l.resolve():this.layer.queryFeatureCount().then(function(a){if(a>n.maximumFeatureCount)throw new k("featurelayerview3d:maximum-feature-count-exceeded","The maximum number of allowed features (${maximumFeatureCount}) has been exceeded (layer has ${numberOfFeatures} features)",{maximumFeatureCount:n.maximumFeatureCount,
numberOfFeatures:a});})};h.prototype.doRefresh=function(){!this.suspended&&r.isRefreshable(this.controller)&&this.controller.refresh()};var n;h.maximumFeatureCount=-1;a([m.property()],h.prototype,"layer",void 0);a([m.property()],h.prototype,"controller",void 0);a([m.property({readOnly:!0,dependsOn:["layer"]})],h.prototype,"controllerTypeForSource",null);a([m.property({readOnly:!0,dependsOn:["controllerTypeForSource","controller"]})],h.prototype,"asyncGraphicsUpdates",null);a([m.property({readOnly:!0,
dependsOn:["controllerTypeForSource","controller"]})],h.prototype,"suspendResumeExtentMode",null);a([m.property({dependsOn:["suspended","controller"]})],h.prototype,"displayLimitExceeded",null);return h=n=a([m.subclass("esri.views.3d.layers.FeatureLayerView3D")],h)}(m.declared(u,x));var v=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.items=new Set;return a}e(c,b);d=c;Object.defineProperty(c.prototype,"length",{get:function(){return this.items.size},enumerable:!0,configurable:!0});
c.prototype.addMany=function(a){for(var b=0;b<a.length;b++)this.items.add(a[b]);this.emit("change",{added:a,removed:[],moved:[]})};c.prototype.removeMany=function(a){for(var b=0;b<a.length;b++)this.items.delete(a[b]);this.emit("change",{added:[],removed:a,moved:[]});return a};c.prototype.removeAll=function(){var a=this.toArray();this.emit("change",{added:[],removed:a,moved:[]})};c.prototype.toArray=function(){var a=[];this.items.forEach(function(b){return a.push(b)});return a};c.prototype.forEach=
function(a){this.items.forEach(a)};c.prototype.some=function(a){return this.toArray().some(a)};c.prototype.find=function(a){var b=null;this.forEach(function(c){!b&&a(c)&&(b=c)});return b};c.prototype.filter=function(a){var b=new d;this.forEach(function(c){a(c)&&b.items.add(c)});return b};var d;return c=d=a([m.subclass("esri.views.3d.layers.FeatureLayerView3D.SetCollection")],c)}(m.declared(n)),A=.1,y=.25;return h})},"esri/layers/graphics/controllers/support/controllerUtils":function(){define(["require",
"exports"],function(q,h){Object.defineProperty(h,"__esModule",{value:!0});h.isRefreshable=function(e){return e&&e.refresh}})},"esri/views/3d/layers/FeatureLikeLayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/Error ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/graphics/dehydratedFeatures ../../../layers/graphics/QueryEngine ../../../renderers/support/renderingInfoUtils ./LayerView3D ./graphics/Graphics3DFeatureLikeLayerView ./graphics/stats ./support/projectExtentUtils".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u){return function(h){function m(a){a=h.call(this)||this;a.controller=null;a.asyncGraphicsUpdates=!1;a.suspendResumeExtentMode="computed";a.supportsDraping=!0;a.overlayUpdating=!1;a.fullExtentInLocalViewSpatialReference=null;a.suspendResumeExtent=null;a._queryEngine=null;a._controllerCreated=!1;a._controllerClientSideFiltering=!1;a.clippingExtent=null;a.supportsHeightUnitConversion=!0;return a}e(m,h);m.prototype.initialize=function(){var a=this;this._set("graphics3d",
new r({owner:this,layer:this.layer,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,asyncGraphicsUpdates:this.asyncGraphicsUpdates,suspendResumeExtentMode:this.suspendResumeExtentMode,updateClippingExtent:function(b){return a.updateClippingExtent(b)}}));this.handles.add([this.watch("asyncGraphicsUpdates",function(b){a.graphics3d.graphicsCore.asyncUpdates=b}),this.watch("suspendResumeExtentMode",function(b){a.graphics3d.suspendResumeExtentMode=
b})]);this.drawingOrder=this.view.getDrawingOrder(this.layer.uid);this.addResolvingPromise(this.graphics3d.setup().then(function(){return a.validateGeometryType()}).then(function(){return u.toViewIfLocal(a)}).then(function(b){a.fullExtentInLocalViewSpatialReference=b}).then(function(){return a.initializeController()}));this.notifyChange("updating")};m.prototype.destroy=function(){this.controller&&(this.controller.destroy(),this.controller=null);this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",
null));this.loadedGraphics=null};Object.defineProperty(m.prototype,"drawingOrder",{set:function(a){this.graphics3d.graphicsCore.setDrawingOrder(a);this._set("drawingOrder",a)},enumerable:!0,configurable:!0});m.prototype.getRenderingInfo=function(a){if((a=p.getRenderingInfo(a,{renderer:this.layer.renderer}))&&a.color){var b=a.color;b[0]/=255;b[1]/=255;b[2]/=255}return a};m.prototype.getGraphicFromGraphicUid=function(a){var b=this,d=null;this.loadedGraphics&&this.loadedGraphics.some(function(c){return c.uid===
a?(d=n.hydrateGraphic(c,b.layer),!0):!1});return c.create(function(a,b){null!==d?a(d):b()})};Object.defineProperty(m.prototype,"graphics3DGraphics",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphics:null},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"graphics3DGraphicsKeys",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphicsKeys:null},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"symbolUpdateType",
{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.symbolUpdateType:null},enumerable:!0,configurable:!0});m.prototype.whenGraphicBounds=function(a,b){return this.graphics3d?this.graphics3d.graphicsCore.whenGraphicBounds(a,b):null};m.prototype.queryFeatures=function(a){return this._queryEngine?this._queryEngine.queryFeatures(a):this._rejectQuery()};m.prototype.queryObjectIds=function(a){return this._queryEngine?this._queryEngine.queryObjectIds(a):this._rejectQuery()};m.prototype.queryFeatureCount=
function(a){return this._queryEngine?this._queryEngine.queryFeatureCount(a):this._rejectQuery()};m.prototype.queryExtent=function(a){return this._queryEngine?this._queryEngine.queryExtent(a):this._rejectQuery()};m.prototype.highlight=function(a,b){return this.graphics3d.highlight(a,b,this.layer.objectIdField)};m.prototype.getStats=function(){var a=t.stats(this,this.graphics3d.graphicsCore);a.elevationUpdating=this.graphics3d.elevationAlignment.updating;a.visibilityFrustum=!this.graphics3d.frustumVisibility.suspended;
a.visibilityScale=!this.graphics3d.scaleVisibility.suspended;return a};m.prototype.canResume=function(){return!this.inherited(arguments)||this.graphics3d&&this.graphics3d.suspended?!1:!0};m.prototype.isUpdating=function(){return!this.graphics3d||this.graphics3d.destroyed?!1:!this._controllerCreated||this.controller&&this.controller.updating||this.overlayUpdating||!(this.view.basemapTerrain&&this.view.basemapTerrain.ready)||this.graphics3d.updating};m.prototype.initializeController=function(){return b(this,
void 0,void 0,function(){var a;return d(this,function(b){switch(b.label){case 0:return[4,this.createController()];case 1:return a=b.sent(),[4,a.when()];case 2:return b.sent(),this.setControllerWhenInitialized(a),[2]}})})};m.prototype.setControllerWhenInitialized=function(a){return b(this,void 0,void 0,function(){return d(this,function(b){switch(b.label){case 0:return b.trys.push([0,2,,3]),[4,this.when()];case 1:return b.sent(),[3,3];case 2:return b.sent(),[3,3];case 3:return this._controllerCreated=
!0,this.notifyChange("updating"),this.isResolved()?[4,f.whenTrueOnce(this.view,"basemapTerrain.ready")]:[2];case 4:return b.sent(),this.controller=a,this.loadedGraphics=a.graphics,this._queryEngine=new l({layer:this.layer,features:this.loadedGraphics,objectIdField:this.layer.objectIdField,dataSpatialReference:this.view.spatialReference}),this.notifyChange("updating"),[2]}})})};m.prototype.updateClippingExtent=function(a){this.clippingExtent=a;if(!this.controller)return!1;switch(this.controller.type){case "memory":case "stream":return!1;
case "snapshot":if(this._controllerClientSideFiltering)return!1;this.controller.extent?(this.controller.extent=null,this._controllerClientSideFiltering=!0):this.controller.extent=a;return!0;case "feature-tile-3d":return this.controller.extent=a,!0}};m.prototype.validateGeometryType=function(){var a=this.layer;switch(a.geometryType){case "multipatch":case "multipoint":return c.reject(new g("featurelayerview3d:unsupported-geometry-type","Unsupported geometry type ${geometryType}",{geometryType:a.geometryType}))}};
m.prototype._rejectQuery=function(){return c.reject(new g("featurelayerview3d:query","Not ready to execute query"))};a([k.property()],m.prototype,"loadedGraphics",void 0);a([k.property({dependsOn:["graphics3d.suspended"]})],m.prototype,"suspended",void 0);a([k.property({dependsOn:["graphics3d.updating","controller.updating","overlayUpdating"]})],m.prototype,"updating",void 0);a([k.property()],m.prototype,"controller",void 0);a([k.property()],m.prototype,"graphics3d",void 0);a([k.property({readOnly:!0})],
m.prototype,"asyncGraphicsUpdates",void 0);a([k.property({readOnly:!0})],m.prototype,"suspendResumeExtentMode",void 0);a([k.property({aliasOf:"graphics3d.graphicsCore.hasDraped"})],m.prototype,"hasDraped",void 0);a([k.property({readOnly:!0,type:Boolean})],m.prototype,"supportsDraping",void 0);a([k.property({type:Boolean})],m.prototype,"overlayUpdating",void 0);a([k.property()],m.prototype,"drawingOrder",null);return m=a([k.subclass("esri.views.3d.layers.FeatureLikeLayerView3D")],m)}(k.declared(m))})},
"esri/renderers/support/renderingInfoUtils":function(){define(["require","exports"],function(q,h){function e(a,b){if(!a||a.symbol)return null;b=b.renderer;return a&&b&&b.getObservationRenderer?b.getObservationRenderer(a):b}function a(a,b){if(a.symbol)return a.symbol;var d=e(a,b);return d&&d.getSymbol(a,b)}Object.defineProperty(h,"__esModule",{value:!0});h.getRenderer=e;h.getSymbol=a;h.getRenderingInfo=function(d,b){var g=e(d,b),c=a(d,b);if(!c)return null;c={renderer:g,symbol:c};if(g){g.colorInfo&&
(c.color=g.getColor(d).toRgba());if(g.sizeInfo){var f=g.getSize(d);c.size=[f,f,f]}if(g.visualVariables){d=g.getVisualVariableValues(d,b);f=["proportional","proportional","proportional"];for(b=0;b<d.length;b++){var h=d[b],g=h.variable,n=h.value;"color"===g.type?c.color=n.toRgba():"size"===g.type?"outline"===g.target?c.outlineSize=n:(h=g.axis,g=g.useSymbolValue?"symbolValue":n,"width"===h?f[0]=g:"depth"===h?f[1]=g:"height"===h?f[2]=g:f[0]="width-and-depth"===h?f[1]=g:f[1]=f[2]=g):"opacity"===g.type?
c.opacity=n:"rotation"===g.type&&"tilt"===g.axis?c.tilt=n:"rotation"===g.type&&"roll"===g.axis?c.roll=n:"rotation"===g.type&&(c.heading=n)}if(isFinite(f[0])||isFinite(f[1])||isFinite(f[2]))c.size=f}}return c}})},"esri/views/3d/layers/graphics/Graphics3DFeatureLikeLayerView":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../Graphic ../../../../core/Accessor ../../../../core/Collection ../../../../core/Handles ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/support/webMercatorUtils ../../../../tasks/support/Query ./constants ./Graphics3DCore ./Graphics3DElevationAlignment ./Graphics3DFrustumVisibility ./Graphics3DHighlights ./Graphics3DScaleVisibility ./Graphics3DSpatialIndex ./graphicUtils ../support/attributeUtils".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u,x,v,A,y,C){return function(b){function h(a){a=b.call(this)||this;a._handles=new c;a.highlights=new x;a.suspendResumeExtentMode="computed";a.dataExtent=null;a.suspendResumeExtent=null;return a}e(h,b);Object.defineProperty(h.prototype,"suspended",{get:function(){return this.scaleVisibility&&this.scaleVisibility.suspended||this.frustumVisibility&&this.frustumVisibility.suspended},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"updating",{get:function(){return!!(this.graphicsCore&&
this.graphicsCore.updating||this.frustumVisibility&&this.frustumVisibility.updating||this.scaleVisibility&&this.scaleVisibility.updating)},enumerable:!0,configurable:!0});h.prototype.normalizeCtorArgs=function(a){var b=a.queryGraphicUIDsInExtent||!a.scaleVisibilityEnabled&&!a.elevationAlignmentEnabled?null:new A({spatialReference:a.owner.view.spatialReference}),c=a.frustumVisibilityEnabled?new u:null,d=a.scaleVisibilityEnabled?new v:null,e=a.elevationAlignmentEnabled?new t:null,f=function(a,c,d){return b.queryGraphicUIDsInExtent(a,
c,d)};return{graphicsCore:new r({owner:a.owner,layer:a.layer,asyncUpdates:a.asyncGraphicsUpdates,basemapTerrain:a.owner.view.basemapTerrain,elevationFeatureExpressionEnabled:a.elevationFeatureExpressionEnabled}),frustumVisibility:c,scaleVisibility:d,elevationAlignment:e,spatialIndex:b,updateClippingExtent:a.updateClippingExtent,suspendResumeExtentMode:a.suspendResumeExtentMode,dataExtent:a.dataExtent,queryGraphicUIDsInExtent:a.queryGraphicUIDsInExtent||f}};h.prototype.initialize=function(){var a=
this;this.scaleVisibility&&this._handles.add(this.layer.watch(["minScale","maxScale"],function(){return a.scaleVisibility.layerMinMaxScaleChangeHandler()}));this.elevationAlignment&&this._handles.add(this.layer.watch("elevationInfo",function(){return a.graphicsCore.elevationInfoChange()}));this.graphicsCore&&(this._handles.add(this.layer.watch("labelsVisible",function(){return a.graphicsCore.updateVisibilityInfo()})),this._handles.add(this.layer.watch("labelingInfo",function(){return a.graphicsCore.updateLabelingInfo()})));
this.idleClients=[this.frustumVisibility,this.scaleVisibility,this.elevationAlignment,this.graphicsCore]};h.prototype.setup=function(){var a=this;this.frustumVisibility&&this.frustumVisibility.setup(this.owner);var b=this.owner.view.basemapTerrain,c=this.owner.view.elevationProvider;this.scaleVisibility&&this.scaleVisibility.setup(this.owner,this.layer,this.queryGraphicUIDsInExtent,this.graphicsCore,b);this.elevationAlignment&&this.elevationAlignment.setup(this.owner,this.queryGraphicUIDsInExtent,
this.graphicsCore,c);this.highlights&&this.highlights.setup(this.graphicsCore);this._set("labeling",this.owner.view.labeler.addGraphicsOwner(this.graphicsCore,this.scaleVisibility,this.spatialIndex));this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,spatialIndex:this.spatialIndex,labeling:this.labeling,highlights:this.highlights});this._handles.add([this.layer.watch("renderer",function(b){return a.graphicsCore.rendererChange(b)}),this.owner.watch("fullOpacity",
function(){return a.graphicsCore.opacityChange()})]);this._handles.add(this.layer.on("graphic-update",function(b){return a.graphicsCore.graphicUpdateHandler(b)}));this.setupSuspendResumeExtent();this._handles.add(this.owner.view.resourceController.registerIdleFrameWorker({needsUpdate:function(){return a.needsIdleUpdate()},idleFrame:function(b){return a.idleUpdate(b)}}));this.updateClippingExtent&&(this._handles.add(this.owner.view.watch("clippingArea",function(){return a._updateClippingExtent()})),
this._updateClippingExtent());return this.graphicsCore.labelsEnabled?this.graphicsCore.updateLabelingInfo():f.resolve()};h.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);this.frustumVisibility&&(this.frustumVisibility.destroy(),this._set("frustumVisibility",null));this.scaleVisibility&&(this.scaleVisibility.destroy(),this._set("scaleVisibility",null));this.elevationAlignment&&(this.elevationAlignment.destroy(),this._set("elevationAlignment",null));this.graphicsCore&&
(this.graphicsCore.destroy(),this._set("graphicsCore",null));this.spatialIndex&&(this.spatialIndex.destroy(),this._set("spatialIndex",null));this.highlights&&(this.highlights.destroy(),this._set("highlights",null));this._set("layer",null);this._set("owner",null)};h.prototype.highlight=function(a,b,c){var e=this;if(a instanceof p){b=this.highlights.acquireSet(b,c);var f=b.set,h=b.handle;this.owner.queryObjectIds(a).then(function(a){return e.highlights.setObjectIds(f,a)});return h}if("number"===typeof a||
a instanceof d)return this.highlight([a],b,c);a instanceof g&&(a=a.toArray());if(Array.isArray(a)&&0<a.length){if(a[0]instanceof d)if(h=a,c&&h[0].attributes&&null!==C.attributeLookup(h[0].attributes,c))a=h.map(function(a){return C.attributeLookup(a.attributes,c)});else return a=h.map(function(a){return a.uid}),h=this.highlights.acquireSet(b,null),b=h.set,h=h.handle,this.highlights.setUids(b,a),h;if("number"===typeof a[0])return h=this.highlights.acquireSet(b,c),b=h.set,h=h.handle,this.highlights.setObjectIds(b,
a),h}return{remove:function(){}}};h.prototype.needsIdleUpdate=function(){for(var a=0,b=this.idleClients;a<b.length;a++){var c=b[a];if(c&&c.needsIdleUpdate())return!0}return!1};h.prototype.idleUpdate=function(a){for(var b=0,c=this.idleClients;b<c.length;b++){var d=c[b];d&&d.idleUpdate(a)}};h.prototype._updateClippingExtent=function(){var a=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(a,this.owner.view.spatialReference)&&(this.updateClippingExtent(a)||this.graphicsCore.recreateAllGraphics())};
h.prototype.setupSuspendResumeExtent=function(){var a=this;(this.frustumVisibility||this.scaleVisibility)&&this._handles.add(k.init(this,"suspendResumeExtentMode",function(b){a._handles.remove("suspendResumeExtentMode");switch(a.suspendResumeExtentMode){case "computed":a._handles.add(k.init(a.graphicsCore,"computedExtent",function(b){return a.updateSuspendResumeExtent(b)}),"suspendResumeExtentMode");break;case "data":a._handles.add(k.init(a,"dataExtent",function(b){return a.updateSuspendResumeExtent(b)}),
"suspendResumeExtentMode")}}))};h.prototype.updateSuspendResumeExtent=function(a){a?this.suspendResumeExtentChanged(this.extentToSuspendResumeRect(a,this.suspendResumeExtent)):this.suspendResumeExtentChanged(null)};h.prototype.extentToSuspendResumeRect=function(a,b){var c=this.owner.view.spatialReference;if(!a.spatialReference.equals(c)){if(!l.canProject(a,c))return;a=l.project(a,c)}return y.enlargeExtent(a,b,m.SUSPEND_RESUME_EXTENT_OPTIMISM)};h.prototype.suspendResumeExtentChanged=function(a){this.frustumVisibility&&
this.frustumVisibility.setExtent(a);this.scaleVisibility&&this.scaleVisibility.setExtent(a)};a([n.property({aliasOf:"graphicsCore.layer"})],h.prototype,"layer",void 0);a([n.property({aliasOf:"graphicsCore.owner"})],h.prototype,"owner",void 0);a([n.property({constructOnly:!0})],h.prototype,"updateClippingExtent",void 0);a([n.property({constructOnly:!0})],h.prototype,"queryGraphicUIDsInExtent",void 0);a([n.property({constructOnly:!0})],h.prototype,"graphicsCore",void 0);a([n.property({constructOnly:!0})],
h.prototype,"spatialIndex",void 0);a([n.property({constructOnly:!0})],h.prototype,"scaleVisibility",void 0);a([n.property({constructOnly:!0})],h.prototype,"elevationAlignment",void 0);a([n.property({constructOnly:!0})],h.prototype,"frustumVisibility",void 0);a([n.property({readOnly:!0})],h.prototype,"labeling",void 0);a([n.property({readOnly:!0})],h.prototype,"highlights",void 0);a([n.property()],h.prototype,"suspendResumeExtentMode",void 0);a([n.property()],h.prototype,"dataExtent",void 0);a([n.property({readOnly:!0,
dependsOn:["scaleVisibility.suspended","frustumVisibility.suspended"]})],h.prototype,"suspended",null);a([n.property({readOnly:!0,dependsOn:["graphicsCore.updating","frustumVisibility.updating","scaleVisibility.updating"]})],h.prototype,"updating",null);return h=a([n.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureLikeLayerView")],h)}(n.declared(b))})},"esri/views/3d/layers/graphics/Graphics3DFrustumVisibility":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../support/earthUtils ../../support/FrustumExtentIntersection".split(" "),
function(q,h,e,a,d,b,g,c,f,k){var n=-.3*f.earthRadius;return function(d){function f(){var a=d.call(this)||this;a.suspended=!0;a._frustumVisibilityDirty=!0;a.extent=null;a.extentIntersectionDirty=!0;a._isVisibleBelowSurface=!1;a.handles=new b;a.layerView=null;return a}e(f,d);Object.defineProperty(f.prototype,"frustumVisibilityDirty",{get:function(){return this._frustumVisibilityDirty},set:function(a){a!==this._frustumVisibilityDirty&&(this._frustumVisibilityDirty=a,this.notifyChange("updating"))},
enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"updating",{get:function(){return this.frustumVisibilityDirty},enumerable:!0,configurable:!0});f.prototype.setup=function(a){var b=this;this.layerView=a;this.extentIntersection=new k.FrustumExtentIntersection({renderCoordsHelper:a.view.renderCoordsHelper});a=a.view;var c=a.basemapTerrain;this.handles.add([a.on("resize",function(){return b.viewChange()}),a.state.watch("camera",function(){return b.viewChange()},!0),c.on("elevation-bounds-change",
function(){return b.elevationBoundsChange()})]);"local"===a.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add(g.init(c,["opacity","wireframe"],function(){return b.isVisibleBelowSurface=c.isSeeThrough()}))};f.prototype.destroy=function(){this.extentIntersection=this.extent=this.layerView=null;this.handles&&(this.handles.destroy(),this.handles=null)};f.prototype.needsIdleUpdate=function(){return this.frustumVisibilityDirty};f.prototype.setExtent=function(a){this.extent=a;this.frustumVisibilityDirty=
this.extentIntersectionDirty=!0};f.prototype.viewChange=function(){this.frustumVisibilityDirty=!0};f.prototype.elevationBoundsChange=function(){this.extentIntersectionDirty=this.frustumVisibilityDirty=!0};Object.defineProperty(f.prototype,"isVisibleBelowSurface",{set:function(a){this._isVisibleBelowSurface=a;this.extentIntersectionDirty=this.frustumVisibilityDirty=!0},enumerable:!0,configurable:!0});f.prototype.idleUpdate=function(a){!a.done()&&this.frustumVisibilityDirty&&(this.updateSuspendFrustumVisible(),
this.frustumVisibilityDirty=!1)};f.prototype.updateExtentIntersection=function(){if(this.extentIntersectionDirty){this.extentIntersectionDirty=!1;var a=this.layerView.view,b;if(this._isVisibleBelowSurface)b=n;else{b=a.basemapTerrain.getElevationBounds();var c=b[0];b=c-Math.max(1,(b[1]-c)*(1.2-1))}this.extentIntersection.update(this.extent,a.spatialReference,b)}};f.prototype.updateSuspendFrustumVisible=function(){this.extent?(this.updateExtentIntersection(),this._set("suspended",!this.extentIntersection.isVisibleInFrustum(this.layerView.view.frustum))):
this._set("suspended",!1)};a([c.property({readOnly:!0})],f.prototype,"suspended",void 0);a([c.property({readOnly:!0})],f.prototype,"updating",null);return f=a([c.subclass("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],f)}(c.declared(d))})},"esri/views/3d/layers/graphics/Graphics3DHighlights":function(){define(["require","exports","./Graphics3DHighlightSet"],function(q,h,e){return function(){function a(){this.graphicsCore=null;this.highlights=[]}a.prototype.destroy=function(){this.highlights.forEach(function(a){return a.highlightSet.removeAll()});
this.highlights=null};a.prototype.setup=function(a){this.graphicsCore=a};a.prototype.acquireSet=function(a,b){var d=this,c=new e(a,b);this.highlights.push(c);return{set:c,handle:{remove:function(){return d.releaseSet(c)}}}};a.prototype.releaseSet=function(a){a.highlightSet.removeAll();a=this.highlights?this.highlights.indexOf(a):-1;-1!==a&&this.highlights.splice(a,1)};a.prototype.setUids=function(a,b){var d=this.graphicsCore.graphics;b.forEach(function(b){a.ids.add(b);(b=d[b])&&b.addHighlight(a.highlightSet,
a.options)})};a.prototype.setObjectIds=function(a,b){var d=this.graphicsCore.graphics;b.forEach(function(b){return a.ids.add(b)});for(var c in d)(b=d[c])&&a.hasGraphic(b)&&b.addHighlight(a.highlightSet,a.options)};a.prototype.graphicCreated=function(a){this.highlights.forEach(function(b){b.hasGraphic(a)&&a.addHighlight(b.highlightSet,b.options)})};a.prototype.graphicDeleted=function(a){this.highlights.forEach(function(b){b.hasGraphic(a)&&a.removeHighlight(b.highlightSet)})};a.prototype.allGraphicsDeleted=
function(){this.highlights.forEach(function(a){return a.highlightSet.removeAll()})};return a}()})},"esri/views/3d/layers/graphics/Graphics3DHighlightSet":function(){define(["require","exports","../../webgl-engine/lib/HighlightSet"],function(q,h,e){return function(){function a(a,b){this.highlightSet=new e;this.ids=new Set;this.options=a;this.objectIdField=b}a.prototype.hasGraphic=function(a){return this.objectIdField?this.ids.has(a.graphic.attributes[this.objectIdField]):this.ids.has(a.graphic.uid)};
return a}()})},"esri/views/3d/layers/graphics/stats":function(){define(["require","exports"],function(q,h){Object.defineProperty(h,"__esModule",{value:!0});h.stats=function(e,a){var d=a.graphics3DGraphics,b="null",g=e.suspendResumeExtent;g&&(b=[g[0],g[1],g[2],g[3]].map(function(a){return a.toPrecision(4)}).join(", "));var g="null",c=a.computedExtent;c&&(g=[c.xmin,c.ymin,c.xmax,c.ymax].map(function(a){return a.toPrecision(4)}).join(", "));return{numCollection:e.loadedGraphics.length,numGraphics:Object.keys(d).length,
graphicsUpdating:a.updating,resumeExtent:b,computedExtent:g,updating:e.updating,suspended:e.suspended}}})},"esri/views/3d/layers/support/projectExtentUtils":function(){define(["require","exports","../../../../core/promiseUtils","../../../../geometry/support/webMercatorUtils","../../../../portal/support/geometryServiceUtils"],function(q,h,e,a,d){Object.defineProperty(h,"__esModule",{value:!0});h.toViewIfLocal=function(b){var g=b.view.spatialReference,c=b.layer.fullExtent,f=c&&c.spatialReference;return f?
f.equals(g)?e.resolve(c.clone()):a.canProject(f,g)?e.resolve(a.project(c,g)):b.view.state.isLocal?d.projectGeometry(c,g,b.layer.portalItem).then(function(a){if(!b.destroyed&&a)return a}).catch(function(){return null}):e.resolve(null):e.resolve(null)}})},"esri/views/layers/RefreshableLayerView":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),function(q,h,e,a,d,b){return function(d){function c(){var a=
null!==d&&d.apply(this,arguments)||this;a.refreshTimestamp=null;return a}e(c,d);c.prototype.refresh=function(a){void 0===a&&(a=Date.now());this._set("refreshTimestamp",a);this.doRefresh&&this.doRefresh()};a([b.property()],c.prototype,"layer",void 0);a([b.aliasOf("layer.refreshInterval")],c.prototype,"refreshInterval",void 0);a([b.property({readOnly:!0})],c.prototype,"refreshTimestamp",void 0);return c=a([b.subclass("esri.layers.mixins.RefreshableLayerView")],c)}(b.declared(d))})},"esri/views/3d/layers/PointCloudLayerView3D":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper dojo/errors/CancelError dojo/promise/all ../../../request ../../../core/arrayUtils ../../../core/arrayUtils ../../../core/Handles ../../../core/Logger ../../../core/promiseUtils ../../../core/requireUtils ../../../core/screenUtils ../../../core/watchUtils ../../../core/workers ../../../core/accessorSupport/decorators ../../../geometry/support/aaBoundingBox ../../../geometry/support/scaleUtils ../../../symbols/support/unitConversionUtils ./LayerView3D ./PointCloudWorker ./i3s/I3SUtil ./i3s/IdleQueue ./i3s/LoDUtil ./i3s/PagedNodeIndex ./i3s/PointCloudRendererUtil ./i3s/PointRenderer ./support/layerViewUpdatingProperties ../lib/glMatrix ../support/geometryUtils ../support/orientedBoundingBox ../support/projectionUtils ../webgl-engine/lib/RenderSlot module".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u,x,v,A,y,C,B,D,E,J,F,M,H,I,K,O,P,L,U){var N=n.getLogger("esri.views.3d.layers.PointCloudLayerView3D"),S=K.plane.create();return function(h){function n(){var a=null!==h&&h.apply(this,arguments)||this;a.maximumPointCount=4E6;a._renderer=null;a._rendererAdded=!1;a._renderedNodes=new Set;a._updateViewNeeded=!0;a._idleUpdatesEnabled=!0;a._lodFactor=1;a._worker=new C;a._workerThread=null;a._maxLoggedBoxWarnings=5;a._pageMultiplier=1;a._handles=new k;a._indexQueue=
[];a._workQueue=[];a._idleQueue=new D.IdleQueue;a._indexPagesLoading=new Map;a._loadingNodes=new Map;a._layerIsVisible=!1;a._totalWork=0;a._index=null;a._loadingInitNodePage=!1;a._nodeIdArray=[];return a}e(n,h);Object.defineProperty(n.prototype,"pointScale",{get:function(){var a=F.getSplatSizeAlgorithm(this.layer.renderer);return a&&null!=a.scaleFactor?a.scaleFactor:1},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"useRealWorldSymbolSizes",{get:function(){var a=F.getFixedSizeAlgorithm(this.layer.renderer);
return a&&null!=a.useRealWorldSymbolSizes?a.useRealWorldSymbolSizes:!1},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"pointSize",{get:function(){var a=F.getFixedSizeAlgorithm(this.layer.renderer);return a&&null!=a.size?a.size:0},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"inverseDensity",{get:function(){return this.layer.renderer?96/this.layer.renderer.pointsPerInch:5},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"_clippingBox",{get:function(){var a=
x.create();return P.extentToBoundingBox(this.view.clippingArea,a,this.view.renderSpatialReference)?a:null},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"_elevationOffset",{get:function(){var a=this.layer.elevationInfo;if(a&&"absolute-height"===a.mode){var b=v.getMetersPerVerticalUnitForSR(this.layer.spatialReference),c=A.getMetersPerUnit(a.unit);return(a.offset||0)*c/b}return 0},enumerable:!0,configurable:!0});n.prototype.initialize=function(){var a=this;B.checkPointCloudLayerValid(this.layer);
B.checkPointCloudLayerCompatibleWithView(this.layer,this.view);this._initRenderer();var b=this._initNodePages(),c={idleBegin:function(){return a._idleBegin()},idleEnd:function(){return a._idleEnd()},needsUpdate:function(){return!0},idleFrame:function(b){return a._process(b)}},d={idleBegin:function(){return a._idleBegin()},idleEnd:function(){return a._idleEnd()},needsUpdate:function(){return a._updateViewNeeded||0<a._workQueue.length},idleFrame:function(b){return a._processWhileSuspended(b)}};t.open(p.getAbsMid("./PointCloudWorker",
q,U),{client:this}).then(function(b){a.destroyed?b.close():a._workerThread=b});this._handles.add(r.init(this,"_clippingBox",function(){return a._setUpdateViewNeeded()}));this._handles.add(r.init(this.layer,"elevationInfo",function(){return a._elevationInfoChanged()}));this._handles.add(r.init(this,"_elevationOffset",function(){return a._elevationOffsetChanged()}));this._handles.add(r.init(this.layer,"renderer",function(){return a._rendererChanged()}));this._handles.add(r.init(this,"clippingArea",
function(){a._setUpdateViewNeeded()}));this._handles.add(this.view.state.watch("camera",function(){a._setUpdateViewNeeded()}));this.view.resourceController.memoryEvents.on("quality-changed",function(){return a._setUpdateViewNeeded()});this.addResolvingPromise(b);this.when(function(){a._handles.add(a.view.resourceController.registerFrameWorker(function(b){return a._frame(b)}));a._handles.add(r.init(a,"suspended",function(b){a._idleFrameWorker&&(a._idleFrameWorker.remove(),a._idleFrameWorker=null);
a._idleFrameWorker=b?a.view.resourceController.registerIdleFrameWorker(d):a.view.resourceController.registerIdleFrameWorker(c)}))})};n.prototype._setUpdateViewNeeded=function(){this._updateViewNeeded=!0;this._updateLoading()};n.prototype.destroy=function(){this._cancelNodeLoading();this._workerThread&&(this._workerThread.close(),this._workerThread=null);this._idleFrameWorker&&(this._idleFrameWorker.remove(),this._idleFrameWorker=null);this._handles.destroy();this._destroyRenderer()};n.prototype._initRenderer=
function(){var a=this;this._renderer=new M;this._renderer.layerUid=this.layer.uid;this._handles.add(r.init(this,"_clippingBox",function(b){a._renderer.clippingBox=b}));this._handles.add(r.init(this,"_clippingBox",function(b){a._renderer.clippingBox=b}));this._handles.add(r.init(this,"suspended",function(b){a._setPointsVisible(!b)}));this._handles.add(r.init(this,"pointScale",function(b){a._renderer.scaleFactor=b}));this._renderer.minSizePx=Math.sqrt(2);this._handles.add(r.init(this,"useRealWorldSymbolSizes",
function(b){a._renderer.useRealWorldSymbolSizes=b}));this._handles.add(r.init(this,"pointSize",function(b){var c=m.pt2px(b);a._renderer.size=b;a._renderer.sizePx=c}));this._handles.add(r.init(this,["inverseDensity","maximumPointCount"],function(){a._setUpdateViewNeeded()}));this._handles.add(r.init(this.view,"qualitySettings.sceneService.pointCloud.lodFactor",function(b){a._lodFactor=b;a._setUpdateViewNeeded()}))};n.prototype._destroyRenderer=function(){this._setPointsVisible(!1)};n.prototype._setPointsVisible=
function(a){a&&!this._rendererAdded?(this.view._stage.addExternalRenderer([L.OPAQUE_EXTERNAL],this._renderer),this._rendererAdded=!0):!a&&this._rendererAdded&&(this.view._stage.removeExternalRenderer(this._renderer),this._rendererAdded=!1)};n.prototype._rendererChanged=function(){this._clearNodeState();this._renderer.useFixedSizes=F.rendererUsesFixedSizes(this.layer.renderer);this._setUpdateViewNeeded()};n.prototype._elevationInfoChanged=function(){var a=this.layer.elevationInfo&&this.layer.elevationInfo.unit;
a&&!A.supportsUnit(a)&&N.warn("elevationInfo.unit","'"+a+"' is not a valid unit")};n.prototype._elevationOffsetChanged=function(){this._clearNodeState();this._initNodePages()};n.prototype.displayNodes=function(a){this._workQueue=E.nodeDiff(f.keysOfSet(this._renderedNodes),a,this._index);E.sortFrontToBack(this._workQueue,this.view.state.camera.viewForward,this._index);E.splitWorkEntries(this._workQueue,8,this._index);this._updateQueues();this._totalWork=this._computeWork();this._updateLoading();this._layerIsVisible=
0<a.length||this._loadingInitNodePage;this.notifyChange("suspended")};n.prototype.cancelLoading=function(){this._cancelNodeLoading();this._cancelIndexLoading()};n.prototype._cancelNodeLoading=function(){var a=[];this._loadingNodes.forEach(function(b){return a.push(b)});this._loadingNodes.clear();for(var b=0;b<a.length;b++)a[b].cancel();this._workQueue=[];this._idleQueue.cancelAll();this._totalWork=this._computeWork();this._updateLoading()};n.prototype._updateQueues=function(){var a=this,b=new Set;
this._workQueue.forEach(function(a){a.load.forEach(function(a){b.add(a)})});var c=[],d=new Map;this._loadingNodes.forEach(function(a,e){b.has(e)?d.set(e,a):c.push(a)});this._loadingNodes=d;for(var e=0;e<c.length;e++)c[e].cancel();this._workQueue=this._workQueue.filter(function(b){var c=0;for(b=b.load;c<b.length;c++)if(a._loadingNodes.has(b[c]))return!1;return!0});this._totalWork=this._computeWork();this._updateLoading()};n.prototype._cancelIndexLoading=function(){this._indexQueue=[];this._indexPagesLoading.forEach(function(a){return a.cancel()});
this._indexPagesLoading.clear();this._totalWork=this._computeWork();this._updateLoading()};n.prototype._clearNodeState=function(){var a=this;this._renderedNodes.forEach(function(b){return a._removeFromRenderer(b)});this._cancelNodeLoading()};n.prototype._idleBegin=function(){this._setUpdateViewNeeded()};n.prototype._idleEnd=function(){this._setUpdateViewNeeded()};n.prototype._frame=function(a){this.suspended?this._processWhileSuspended(a):this._process(a)};n.prototype._process=function(a){if(this._idleUpdatesEnabled){for(this._updateViewNeeded&&
!a.done()&&this._updateWorkQueues();0<this._indexQueue.length&&!a.done();)this._processIndexQueue();for(this._processWorkQueue(a);0<this._idleQueue.length()&&!a.done();)this._idleQueue.process()}};n.prototype._processWhileSuspended=function(a){if(this._idleUpdatesEnabled)for(this._cancelNodeLoading(),this._updateViewNeeded&&!a.done()&&this._updateWorkQueues();0<this._workQueue.length&&!a.done();)this._processWorkQueueRemoveOnly()};n.prototype._processIndexQueue=function(){var a=this,b=this._indexQueue.shift();
this._indexPagesLoading.set(b,this._loadNodePage(b));this._indexPagesLoading.get(b).then(function(c){a._index.addPage(b,c,a._elevationOffset);a._setUpdateViewNeeded()}).always(function(){a._indexPagesLoading.delete(b)})};n.prototype._processWorkQueue=function(a){for(;!a.done();){var b=this._scheduleWorkEntry();if(!b)break;this._processWorkEntry(b)}};n.prototype._scheduleWorkEntry=function(){var a=this;if(8<=this._loadingNodes.size)return null;for(var b=0;b<this._workQueue.length;++b){var d=this._workQueue[b];
if(!c.find(d.remove,function(b){return!a._renderedNodes.has(b)})){for(;0<b;--b)this._workQueue[b]=this._workQueue[b-1];this._workQueue.shift();return d}}return null};n.prototype._processWorkEntry=function(a){var c=this;if(0===a.load.length)for(var d=0;d<a.remove.length;d++)this._removeFromRenderer(a.remove[d]);else b(a.load.map(function(a){c._loadingNodes.has(a)||c._loadingNodes.set(a,c.loadNode(a));return c._loadingNodes.get(a)})).then(function(b){for(var d=0;d<a.load.length;d++)c._addToRenderer(a.load[d],
b[d]);for(d=0;d<a.remove.length;d++)c._removeFromRenderer(a.remove[d])}).always(function(){for(var b=0;b<a.load.length;b++)c._loadingNodes.delete(a.load[b]);c._updateLoading()}),this._updateLoading()};n.prototype._processWorkQueueRemoveOnly=function(){for(var a=this._workQueue.shift(),b=0;b<a.remove.length;b++)this._removeFromRenderer(a.remove[b]);this._updateLoading()};n.prototype._computeWork=function(){for(var a=0,b=0;b<this._workQueue.length;b++)a+=this._workQueue[b].load.length;a+=this._loadingNodes.size;
a+=(this._indexQueue.length+this._indexPagesLoading.size)*this._index.pageSize;a+=this._loadingInitNodePage?100:0;return a+=this._updateViewNeeded?100:0};Object.defineProperty(n.prototype,"updatingPercentageValue",{get:function(){var a=this._computeWork();return 100*Math.min(this._totalWork,a)/this._totalWork},enumerable:!0,configurable:!0});n.prototype._updateLoading=function(){this.notifyChange("updating");this.notifyChange("updatingPercentageValue")};n.prototype.canResume=function(){return this.inherited(arguments)&&
this._layerIsVisible};n.prototype.isUpdating=function(){return 0<this._computeWork()};n.prototype._initNodePages=function(){var a=this,b=this.layer.store.index;this._index=new J(this.layer.spatialReference,this.view.renderCoordsHelper.spatialReference,b.nodesPerPage||b.nodePerIndexBlock);this._cancelIndexLoading();this._traverseVisible=this._index.createVisibilityTraverse();this._layerIsVisible=this._loadingInitNodePage=!0;this.notifyChange("suspended");this._updateLoading();this._pageMultiplier=
null!=b.nodesPerPage?1:b.nodePerIndexBlock;return this._loadNodePage(0).then(function(b){a._index.addPage(0,b,a._elevationOffset);a._loadingInitNodePage=!1;a._setUpdateViewNeeded()})};n.prototype._loadNodePage=function(a){var b=this;return this._requestJSON(this.baseUrl+"/nodepages/"+a*this._pageMultiplier).then(function(c){return c.data.nodes.map(function(c,d){return{resourceId:null!=c.resourceId?c.resourceId:a*b._index.pageSize+d,obb:c.obb,firstChild:c.firstChild,childCount:c.childCount,vertexCount:null!=
c.vertexCount?c.vertexCount:c.pointCount,lodThreshold:null!=c.lodThreshold?c.lodThreshold:c.effectiveArea}})})};n.prototype._updateWorkQueues=function(){for(var a=this.inverseDensity/this._lodFactor*this._getLodMemoryFactor(),b=this.maximumPointCount*this._lodFactor*this._getLodMemoryFactor(),c=this._computeNodesForMinimumDensity(a),d=this._computePointCount(c),e=Math.sqrt(d/(.75*b));d>b;)a*=e,c=this._computeNodesForMinimumDensity(a),d=this._computePointCount(c),e=Math.sqrt(2);this.displayNodes(c);
this._updateViewNeeded=!1;this._updateLoading()};n.prototype._computePointCount=function(a){for(var b=0,c=0;c<a.length;c++){var d=this._index.getNode(a[c]);d&&(b+=d.vertexCount)}return b};n.prototype._getLodMemoryFactor=function(){return this.view.resourceController.memoryFactor};n.prototype._computeNodesForMinimumDensity=function(a){var b=this,c=this.view.state.camera,d=c.frustumPlanes,e=this._clippingBox,f=c.viewForward,g=I.vec3d.dot(f,c.eye),h=K.plane.fromNormalAndOffset(f,-g,S),k=c.perPixelRatio,
l=a*a,m=this._nodeIdArray;m.length=0;this._traverseVisible({frustumPlanes:d,clippingBox:e},{predicate:function(a,c,d){if(!d)return!1;if(0===c.childCount)return m.push(a),!1;d=b._index.getRenderObb(a);return b._computeAveragePixelArea(d,c.lodThreshold,c.vertexCount,h,k)<=l?(m.push(a),!1):!0},pageMiss:function(a,c){m.push(a);0>b._indexQueue.indexOf(c)&&b._indexQueue.push(c)}});return m};n.prototype._computeAveragePixelArea=function(a,b,c,d,e){a=Math.max(1E-7,O.minimumDistancePlane(a,d));return b/(a*
a)/(4*e*e)/c};n.prototype.loadNode=function(a){var c=this,e=this._index.getNode(a),f=F.getRendererInfo(this.layer),g=[];return this._idleQueue.push().then(function(){var a=e.resourceId,d=c.loadGeometry(a),h=c.loadAttribute(a,f.primaryAttribute),a=c.loadAttribute(a,f.modulationAttribute);g=[d,h,a];return b(g)}).then(function(b){var d=b[0],e=b[1],g=b[2];b=[d];e&&b.push(e);g&&b.push(g);d={geometryBuffer:d,primaryAttribute:e,modulationAttribute:g,schema:c.layer.store.defaultGeometrySchema,rendererInfo:f,
obb:c._index.getRenderObb(a),elevationOffset:c._elevationOffset,inSR:c.layer.spatialReference.toJSON(),outSR:c.view.renderCoordsHelper.spatialReference.toJSON()};return c._workerThread?c._workerThread.invoke("process",d,b):l.resolve(c._worker.transform(d))}).catch(function(a){if(a instanceof d)for(var b=0,c=g;b<c.length;b++)c[b].cancel();else console.error(a);return l.reject(a)})};n.prototype.loadGeometry=function(a){return this._requestBinary(this.baseUrl+"/nodes/"+a+"/geometries/0").then(function(a){return a.data})};
n.prototype.loadAttribute=function(a,b){return b&&b.storageInfo?this._requestBinary(this.baseUrl+"/nodes/"+a+"/attributes/"+b.storageInfo.key).then(function(a){return a.data}):l.resolve(null)};n.prototype._requestJSON=function(a){return g(a,{query:{f:"json"},responseType:"json"})};n.prototype._requestBinary=function(a){return g(a,{responseType:"array-buffer"})};n.prototype._removeFromRenderer=function(a){this._renderedNodes.has(a)&&(this._renderer.removeNode(""+a),this._renderedNodes.delete(a))};
n.prototype._addToRenderer=function(a,b){if(!this._renderedNodes.has(a)){this._renderedNodes.add(a);var c=this._index.getNode(a),d=this._index.getRenderObb(a);if(b.obb.halfSize[0]>d.halfSize[0]||b.obb.halfSize[1]>d.halfSize[1]||b.obb.halfSize[2]>d.halfSize[2])0<this._maxLoggedBoxWarnings&&(N.warn("Node",a,"reported bounding box too small, got",d,"but points cover",b.obb),0===--this._maxLoggedBoxWarnings&&N.warn("  Too many bounding box errors, stopping reporting for this layer.")),this._index.setRenderObb(a,
b.obb);this._renderer.addNode({id:""+a,coordinates:b.points,origin:d.center,rgb:b.rgb,splatSize:Math.sqrt(c.lodThreshold/c.vertexCount),obb:d,isLeaf:0===c.childCount})}};n.prototype.removeCachedData=function(){var a=this;this.suspended&&this._renderedNodes.forEach(function(b){return a._removeFromRenderer(b)})};n.prototype.getCachedMemory=function(){return 0};n.prototype.getUsedMemory=function(){var a=this;return f.keysOfSet(this._renderedNodes).reduce(function(b,c){return b+15*a._index.getNode(c).vertexCount+
128},0)/1024/1024};n.prototype.getUnloadedMemory=function(){var a=this,b=this._renderedNodes.size;if(4>b)return 0;for(var c=f.keysOfSet(this._renderedNodes).reduce(function(b,c){return b+a._index.getNode(c).vertexCount}),d=this._loadingNodes.size,e=0;e<this._workQueue.length;e++)d+=this._workQueue[e].load.length,d-=this._workQueue[e].remove.length;return 0>d?0:(d*c/b*15+128*d)/1024/1024};n.prototype.getStats=function(){var a=this;return{"Rendered Nodes":this._renderedNodes.size,"Rendered Points":f.keysOfSet(this._renderedNodes).reduce(function(b,
c){return b+a._index.getNode(c).vertexCount},0),"Loading Nodes":this._loadingNodes.size,"Index Queue":this._indexQueue.length,"Work Queue":this._workQueue.length,"Idle Queue":this._idleQueue.length()}};a([u.property()],n.prototype,"layer",void 0);a([u.property({readOnly:!0,aliasOf:"layer.parsedUrl.path"})],n.prototype,"baseUrl",void 0);a([u.property({readOnly:!0,dependsOn:["layer.renderer"]})],n.prototype,"pointScale",null);a([u.property({readOnly:!0,dependsOn:["layer.renderer"]})],n.prototype,"useRealWorldSymbolSizes",
null);a([u.property({readOnly:!0,dependsOn:["layer.renderer"]})],n.prototype,"pointSize",null);a([u.property({readOnly:!0,dependsOn:["layer.renderer"]})],n.prototype,"inverseDensity",null);a([u.property()],n.prototype,"maximumPointCount",void 0);a([u.property({readOnly:!0,dependsOn:["view.clippingArea"]})],n.prototype,"_clippingBox",null);a([u.property({readOnly:!0,dependsOn:["layer.elevationInfo"]})],n.prototype,"_elevationOffset",null);a([u.property(H.updatingPercentage)],n.prototype,"updatingPercentage",
void 0);a([u.property({readOnly:!0})],n.prototype,"updatingPercentageValue",null);return n=a([u.subclass("esri.views.3d.layers.PointCloudLayerView3D")],n)}(u.declared(y))})},"esri/views/3d/layers/PointCloudWorker":function(){define("require exports ../../../core/promiseUtils ../../../geometry/SpatialReference ./i3s/I3SBinaryReader ./i3s/LEPCC ./i3s/PointCloudRendererUtil ../lib/glMatrix ../support/projectionUtils".split(" "),function(q,h,e,a,d,b,g,c,f){q=function(){function h(){}h.prototype.process=
function(a){a=this.transform(a);return e.resolve({result:a,transferList:[a.rgb]})};h.prototype.transform=function(b){var c=this.readGeometry(b.schema,b.geometryBuffer),d=g.evaluateRenderer(b.rendererInfo,b.primaryAttribute,b.modulationAttribute,c,c.length/3);this._applyElevationOffsetInPlace(c,b.elevationOffset);c=this._transformCoordinates(c,b.obb,a.fromJSON(b.inSR),a.fromJSON(b.outSR));return{obb:b.obb,points:c,rgb:d.buffer}};h.prototype.readGeometry=function(a,c){if(null==a.encoding||""===a.encoding){a=
d.createGeometryDataIndex(c,a,!1);c=d.createTypedView(c,a.vertexAttributes.position);var e=a.header.fields;a=[e.offsetX,e.offsetY,e.offsetZ];for(var e=[e.scaleX,e.scaleY,e.scaleZ],f=c.length/3,g=new Float64Array(3*f),h=0;h<f;h++)g[3*h]=c[3*h]*e[0]+a[0],g[3*h+1]=c[3*h+1]*e[1]+a[1],g[3*h+2]=c[3*h+2]*e[2]+a[2];return g}if("lepcc-xyz"===a.encoding)return b.decodeXYZ(c).result};h.prototype._transformCoordinates=function(a,b,d,e){var g=a.length/3;if(!f.bufferToBuffer(a,d,0,a,e,0,g))throw Error("Can't reproject");
d=c.vec3.createFrom(b.center[0],b.center[1],b.center[2]);e=c.vec3.create();var h=c.vec3.create();c.quat4.conjugate(b.quaternion,k);for(var l=new Float32Array(3*g),m=0;m<g;m++)e[0]=a[3*m]-d[0],e[1]=a[3*m+1]-d[1],e[2]=a[3*m+2]-d[2],c.quat4.multiplyVec3(k,e,h),b.halfSize[0]=Math.max(b.halfSize[0],Math.abs(h[0])),b.halfSize[1]=Math.max(b.halfSize[1],Math.abs(h[1])),b.halfSize[2]=Math.max(b.halfSize[2],Math.abs(h[2])),l[3*m]=e[0],l[3*m+1]=e[1],l[3*m+2]=e[2];return l};h.prototype._applyElevationOffsetInPlace=
function(a,b){var c=a.length/3;if(0!==b)for(var d=0;d<c;d++)a[3*d+2]+=b};return h}();var k=c.quat4.create();return q})},"esri/views/3d/layers/i3s/PointCloudRendererUtil":function(){define("require exports ../../../../renderers/PointCloudClassBreaksRenderer ../../../../renderers/PointCloudStretchRenderer ../../../../renderers/PointCloudUniqueValueRenderer ./I3SBinaryReader".split(" "),function(q,h,e,a,d,b){function g(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(d.name===b&&null!=d.attributeValues&&
"UInt8"===d.attributeValues.valueType&&3===d.attributeValues.valuesPerElement)return{storageInfo:d,useElevation:!1}}return null}function c(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(d.name===b)return a="embedded-elevation"===d.encoding,{storageInfo:a?null:d,useElevation:a}}return"elevation"===b.toLowerCase()?{storageInfo:null,useElevation:!0}:null}function f(a,c,d,e){if(a&&a.useElevation){a=new Float64Array(e);for(c=0;c<e;c++)a[c]=d[3*c+2];return a}return a&&c?b.readBinaryAttribute(a.storageInfo,
c,e):null}function k(a){return null==a||"none"===a?null:"low-four-bit"===a?function(a){return a&15}:"high-four-bit"===a?function(a){return(a&240)>>4}:"absolute-value"===a?function(a){return Math.abs(a)}:"modulo-ten"===a?function(a){return a%10}:null}Object.defineProperty(h,"__esModule",{value:!0});h.getRendererInfo=function(a){var b=a.renderer,d=b&&b.type,e=b&&a.renderer.toJSON()||null,f=null,h=!1;"point-cloud-unique-value"===d?f=c(a.attributeStorageInfo,b.field):"point-cloud-stretch"===d?f=c(a.attributeStorageInfo,
b.field):"point-cloud-class-breaks"===d?f=c(a.attributeStorageInfo,b.field):(f="point-cloud-rgb"===d?g(a.attributeStorageInfo,b.field):g(a.attributeStorageInfo,"RGB"),h=null!=f);d=null;b&&b.colorModulation&&(d=c(a.attributeStorageInfo,b.colorModulation.field));return{rendererJSON:e,isRGBRenderer:h,primaryAttribute:f,modulationAttribute:d}};h.evaluateRenderer=function(b,c,g,h,q){var l=b.rendererJSON,m=b.isRGBRenderer,n=b.modulationAttribute;b=f(b.primaryAttribute,c,h,q);g=f(n,g,h,q);n=h=null;if(b&&
m)h=b;else if(b&&"pointCloudUniqueValueRenderer"===l.type){var n=d.fromJSON(l),p=n.colorUniqueValueInfos;h=new Uint8Array(3*q);m=k(n.fieldTransformType);for(l=0;l<q;l++){c=m?m(b[l]):b[l];c+="";for(var r=0;r<p.length;r++)if(0<=p[r].values.indexOf(c)){h[3*l]=p[r].color.r;h[3*l+1]=p[r].color.g;h[3*l+2]=p[r].color.b;break}}}else if(b&&"pointCloudStretchRenderer"===l.type)for(n=a.fromJSON(l),p=n.stops,h=new Uint8Array(3*q),m=k(n.fieldTransformType),l=0;l<q;l++)if(c=m?m(b[l]):b[l],r=p.length-1,c<p[0].value)h[3*
l]=p[0].color.r,h[3*l+1]=p[0].color.g,h[3*l+2]=p[0].color.b;else if(c>=p[r].value)h[3*l]=p[r].color.r,h[3*l+1]=p[r].color.g,h[3*l+2]=p[r].color.b;else for(r=1;r<p.length;r++){if(c<p[r].value){c=(c-p[r-1].value)/(p[r].value-p[r-1].value);h[3*l]=p[r].color.r*c+p[r-1].color.r*(1-c);h[3*l+1]=p[r].color.g*c+p[r-1].color.g*(1-c);h[3*l+2]=p[r].color.b*c+p[r-1].color.b*(1-c);break}}else if(b&&"pointCloudClassBreaksRenderer"===l.type)for(n=e.fromJSON(l),p=n.colorClassBreakInfos,h=new Uint8Array(3*q),m=k(n.fieldTransformType),
l=0;l<q;l++)for(c=m?m(b[l]):b[l],r=0;r<p.length;r++){if(c>=p[r].minValue&&c<=p[r].maxValue){h[3*l]=p[r].color.r;h[3*l+1]=p[r].color.g;h[3*l+2]=p[r].color.b;break}}else for(h=new Uint8Array(3*q),l=0;l<h.length;l++)h[l]=255;if(g&&n&&n.colorModulation)for(b=n.colorModulation.minValue,n=n.colorModulation.maxValue,l=0;l<q;l++)c=g[l],m=c>=n?1:c<=b?.3:.3+.7*(c-b)/(n-b),h[3*l]*=m,h[3*l+1]*=m,h[3*l+2]*=m;return h};h.getSplatSizeAlgorithm=function(a){return(a=a&&a.pointSizeAlgorithm)&&"splat"===a.type?a:null};
h.getFixedSizeAlgorithm=function(a){return(a=a&&a.pointSizeAlgorithm)&&"fixed-size"===a.type?a:null};h.rendererUsesFixedSizes=function(a){return(a=a&&a.pointSizeAlgorithm)&&a.type?"fixed-size"===a.type:!1}})},"esri/renderers/PointCloudClassBreaksRenderer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/lang ../core/accessorSupport/decorators ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorClassBreakInfo".split(" "),
function(q,h,e,a,d,b,g,c,f,k){return function(h){function l(a){a=h.call(this)||this;a.type="point-cloud-class-breaks";a.field=null;a.legendOptions=null;a.fieldTransformType=null;a.colorClassBreakInfos=null;return a}a(l,h);n=l;l.prototype.clone=function(){return new n(e({},this.cloneProperties(),{field:this.field,fieldTransformType:this.fieldTransformType,colorClassBreakInfos:b.clone(this.colorClassBreakInfos),legendOptions:b.clone(this.legendOptions)}))};var n;d([g.property()],l.prototype,"type",
void 0);d([g.property({json:{write:!0},type:String})],l.prototype,"field",void 0);d([g.property({type:f.default,json:{write:!0}})],l.prototype,"legendOptions",void 0);d([g.property({json:{read:c.fieldTransformTypeKebabDict.read,write:c.fieldTransformTypeKebabDict.write},type:String})],l.prototype,"fieldTransformType",void 0);d([g.property({type:[k.default],json:{write:!0}})],l.prototype,"colorClassBreakInfos",void 0);return l=n=d([g.subclass("esri.renderers.PointCloudClassBreaksRenderer")],l)}(g.declared(c))})},
"esri/renderers/PointCloudRenderer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/kebabDictionary ../core/lang ../core/accessorSupport/decorators ./support/pointCloud/ColorModulation ./support/pointCloud/pointSizeAlgorithmJSONUtils ./support/pointCloud/pointSizeAlgorithmTypeUtils".split(" "),function(q,h,e,a,d,b,g,c,f,k,n){var l=b({pointCloudClassBreaksRenderer:"point-cloud-class-breaks",pointCloudRGBRenderer:"point-cloud-rgb",
pointCloudStretchRenderer:"point-cloud-stretch",pointCloudUniqueValueRenderer:"point-cloud-unique-value"});q=function(b){function d(a){a=b.call(this)||this;a.type=void 0;a.pointSizeAlgorithm=null;a.colorModulation=null;a.pointsPerInch=10;return a}e(d,b);d.prototype.clone=function(){console.warn(".clone() is not implemented for "+this.declaredClass);return null};d.prototype.cloneProperties=function(){return{pointSizeAlgorithm:g.clone(this.pointSizeAlgorithm),colorModulation:g.clone(this.colorModulation),
pointsPerInch:g.clone(this.pointsPerInch)}};a([c.property({type:String,readOnly:!0,nonNullable:!0,json:{read:!1,write:l.write}})],d.prototype,"type",void 0);a([c.property({types:n.pointSizeAlgorithmTypes,json:{read:k.read,write:!0}})],d.prototype,"pointSizeAlgorithm",void 0);a([c.property({type:f.default,json:{write:!0}})],d.prototype,"colorModulation",void 0);a([c.property({json:{write:!0},nonNullable:!0,type:Number})],d.prototype,"pointsPerInch",void 0);return d=a([c.subclass("esri.renderers.PointCloudRenderer")],
d)}(c.declared(d));(q||(q={})).fieldTransformTypeKebabDict=b({none:"none",lowFourBit:"low-four-bit",highFourBit:"high-four-bit",absoluteValue:"absolute-value",moduloTen:"modulo-ten"});return q})},"esri/renderers/support/pointCloud/ColorModulation":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/JSONSupport ../../../core/accessorSupport/decorators".split(" "),function(q,h,e,a,d,b){Object.defineProperty(h,"__esModule",
{value:!0});q=function(d){function c(){var a=null!==d&&d.apply(this,arguments)||this;a.field=null;a.minValue=0;a.maxValue=255;return a}e(c,d);f=c;c.prototype.clone=function(){return new f({field:this.field,minValue:this.minValue,maxValue:this.maxValue})};var f;a([b.property({type:String,json:{write:!0}})],c.prototype,"field",void 0);a([b.property({type:Number,nonNullable:!0,json:{write:!0}})],c.prototype,"minValue",void 0);a([b.property({type:Number,nonNullable:!0,json:{write:!0}})],c.prototype,"maxValue",
void 0);return c=f=a([b.subclass("esri.renderers.support.pointCloud.ColorModulation")],c)}(b.declared(d));h.ColorModulation=q;h.default=q})},"esri/renderers/support/pointCloud/pointSizeAlgorithmJSONUtils":function(){define(["require","exports","../../../core/Warning","../../support/pointCloud/PointSizeFixedSizeAlgorithm","../../support/pointCloud/PointSizeSplatAlgorithm"],function(q,h,e,a,d){Object.defineProperty(h,"__esModule",{value:!0});var b={pointCloudFixedSizeAlgorithm:a.default,pointCloudSplatAlgorithm:d.default};
h.read=function(a,c,d){if(c=a?b[a.type]||null:null)return c=new c,c.read(a,d),c;d&&d.messages&&a&&d.messages.push(new e("pointsizealgorithm:unsupported","Point size algorithms of type '"+(a.type||"unknown")+"' are not supported",{definition:a,context:d}));return null};h.fromJSON=function(a){var c=a?b[a.type]||null:null;return c?c.fromJSON(a):null}})},"esri/renderers/support/pointCloud/PointSizeFixedSizeAlgorithm":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ./PointSizeAlgorithm".split(" "),
function(q,h,e,a,d,b){Object.defineProperty(h,"__esModule",{value:!0});q=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.type="fixed-size";a.size=0;a.useRealWorldSymbolSizes=null;return a}e(c,b);f=c;c.prototype.clone=function(){return new f({size:this.size,useRealWorldSymbolSizes:this.useRealWorldSymbolSizes})};var f;a([d.property()],c.prototype,"type",void 0);a([d.property({type:Number,nonNullable:!0,json:{write:!0}})],c.prototype,"size",void 0);a([d.property({type:Boolean,
json:{write:!0}})],c.prototype,"useRealWorldSymbolSizes",void 0);return c=f=a([d.subclass("esri.renderers.support.pointCloud.PointSizeFixedSizeAlgorithm")],c)}(d.declared(b.default));h.PointSizeFixedSizeAlgorithm=q;h.default=q})},"esri/renderers/support/pointCloud/PointSizeAlgorithm":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/JSONSupport ../../../core/kebabDictionary ../../../core/accessorSupport/decorators".split(" "),
function(q,h,e,a,d,b,g){Object.defineProperty(h,"__esModule",{value:!0});h.typeKebabDictionary=b({pointCloudFixedSizeAlgorithm:"fixed-size",pointCloudSplatAlgorithm:"splat"});q=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}e(c,b);a([g.property({type:String,readOnly:!0,nonNullable:!0,json:{read:!1,write:h.typeKebabDictionary.write}})],c.prototype,"type",void 0);return c=a([g.subclass("esri.renderers.support.pointCloud.PointSizeAlgorithm")],c)}(g.declared(d));h.PointSizeAlgorithm=
q;h.default=q})},"esri/renderers/support/pointCloud/PointSizeSplatAlgorithm":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ./PointSizeAlgorithm".split(" "),function(q,h,e,a,d,b){Object.defineProperty(h,"__esModule",{value:!0});q=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.type="splat";a.scaleFactor=1;return a}e(c,b);f=c;c.prototype.clone=function(){return new f({scaleFactor:this.scaleFactor})};
var f;a([d.property()],c.prototype,"type",void 0);a([d.property({type:Number,value:1,nonNullable:!0,json:{write:!0}})],c.prototype,"scaleFactor",void 0);return c=f=a([d.subclass("esri.renderers.support.pointCloud.PointSizeSplatAlgorithm")],c)}(d.declared(b.default));h.PointSizeSplatAlgorithm=q;h.default=q})},"esri/renderers/support/pointCloud/pointSizeAlgorithmTypeUtils":function(){define(["require","exports","./PointSizeAlgorithm","./PointSizeFixedSizeAlgorithm","./PointSizeSplatAlgorithm"],function(q,
h,e,a,d){Object.defineProperty(h,"__esModule",{value:!0});h.pointSizeAlgorithmTypes={key:"type",base:e.default,typeMap:{"fixed-size":a.default,splat:d.default}}})},"esri/renderers/support/pointCloud/ColorClassBreakInfo":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators ../../../core/accessorSupport/ensureType".split(" "),function(q,
h,e,a,d,b,g,c,f){Object.defineProperty(h,"__esModule",{value:!0});q=function(b){function h(){var a=null!==b&&b.apply(this,arguments)||this;a.description=null;a.label=null;a.minValue=0;a.maxValue=0;a.color=null;return a}e(h,b);k=h;h.prototype.clone=function(){return new k({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,color:g.clone(this.color)})};var k;a([c.property({type:String,json:{write:!0}})],h.prototype,"description",void 0);a([c.property({type:String,
json:{write:!0}})],h.prototype,"label",void 0);a([c.property({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],h.prototype,"minValue",void 0);a([c.property({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],h.prototype,"maxValue",void 0);a([c.property({type:d,json:{type:[f.Integer],write:!0}})],h.prototype,"color",void 0);return h=k=a([c.subclass("esri.renderers.support.pointCloud.ColorClassBreakInfo")],h)}(c.declared(b));h.ColorClassBreakInfo=
q;h.default=q})},"esri/renderers/PointCloudStretchRenderer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/lang ../core/accessorSupport/decorators ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/StopInfo".split(" "),function(q,h,e,a,d,b,g,c,f,k){return function(h){function l(a){a=h.call(this)||this;a.type="point-cloud-stretch";a.field=null;a.legendOptions=null;a.fieldTransformType=
null;a.stops=null;return a}a(l,h);n=l;l.prototype.clone=function(){return new n(e({},this.cloneProperties(),{field:b.clone(this.field),fieldTransformType:b.clone(this.fieldTransformType),stops:b.clone(this.stops),legendOptions:b.clone(this.legendOptions)}))};var n;d([g.property()],l.prototype,"type",void 0);d([g.property({json:{write:!0},type:String})],l.prototype,"field",void 0);d([g.property({type:f.default,json:{write:!0}})],l.prototype,"legendOptions",void 0);d([g.property({json:{read:c.fieldTransformTypeKebabDict.read,
write:c.fieldTransformTypeKebabDict.write},type:String})],l.prototype,"fieldTransformType",void 0);d([g.property({type:[k.default],json:{write:!0}})],l.prototype,"stops",void 0);return l=n=d([g.subclass("esri.renderers.PointCloudStretchRenderer")],l)}(g.declared(c))})},"esri/renderers/support/pointCloud/StopInfo":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators ../../../core/accessorSupport/ensureType".split(" "),
function(q,h,e,a,d,b,g,c,f){Object.defineProperty(h,"__esModule",{value:!0});q=function(b){function h(){var a=null!==b&&b.apply(this,arguments)||this;a.label=null;a.value=0;a.color=null;return a}e(h,b);k=h;h.prototype.clone=function(){return new k({label:this.label,value:this.value,color:g.clone(this.color)})};var k;a([c.property({type:String,json:{write:!0}})],h.prototype,"label",void 0);a([c.property({type:Number,nonNullable:!0,json:{write:!0}})],h.prototype,"value",void 0);a([c.property({type:d,
json:{type:[f.Integer],write:!0}})],h.prototype,"color",void 0);return h=k=a([c.subclass("esri.renderers.support.pointCloud.StopInfo")],h)}(c.declared(b));h.StopInfo=q;h.default=q})},"esri/renderers/PointCloudUniqueValueRenderer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/lang ../core/accessorSupport/decorators ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorUniqueValueInfo".split(" "),
function(q,h,e,a,d,b,g,c,f,k){return function(h){function l(a){a=h.call(this)||this;a.type="point-cloud-unique-value";a.field=null;a.fieldTransformType=null;a.colorUniqueValueInfos=null;a.legendOptions=null;return a}a(l,h);n=l;l.prototype.clone=function(){return new n(e({},this.cloneProperties(),{field:b.clone(this.field),fieldTransformType:b.clone(this.fieldTransformType),colorUniqueValueInfos:b.clone(this.colorUniqueValueInfos),legendOptions:b.clone(this.legendOptions)}))};var n;d([g.property()],
l.prototype,"type",void 0);d([g.property({json:{write:!0},type:String})],l.prototype,"field",void 0);d([g.property({json:{read:c.fieldTransformTypeKebabDict.read,write:c.fieldTransformTypeKebabDict.write},type:String})],l.prototype,"fieldTransformType",void 0);d([g.property({type:[k.default],json:{write:!0}})],l.prototype,"colorUniqueValueInfos",void 0);d([g.property({type:f.default,json:{write:!0}})],l.prototype,"legendOptions",void 0);return l=n=d([g.subclass("esri.renderers.PointCloudUniqueValueRenderer")],
l)}(g.declared(c))})},"esri/renderers/support/pointCloud/ColorUniqueValueInfo":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators ../../../core/accessorSupport/ensureType".split(" "),function(q,h,e,a,d,b,g,c,f){Object.defineProperty(h,"__esModule",{value:!0});q=function(b){function h(){var a=null!==b&&b.apply(this,arguments)||this;
a.description=null;a.label=null;a.values=null;a.color=null;return a}e(h,b);k=h;h.prototype.clone=function(){return new k({description:this.description,label:this.label,values:g.clone(this.values),color:g.clone(this.color)})};var k;a([c.property({type:String,json:{write:!0}})],h.prototype,"description",void 0);a([c.property({type:String,json:{write:!0}})],h.prototype,"label",void 0);a([c.property({type:[String],json:{write:!0}})],h.prototype,"values",void 0);a([c.property({type:d,json:{type:[f.Integer],
write:!0}})],h.prototype,"color",void 0);return h=k=a([c.subclass("esri.renderers.support.pointCloud.ColorUniqueValueInfo")],h)}(c.declared(b));h.ColorUniqueValueInfo=q;h.default=q})},"esri/views/3d/layers/i3s/LoDUtil":function(){define(["require","exports","../../lib/glMatrix"],function(q,h,e){function a(a,b,c){for(;0<a;){var d=b.indexOf(a);if(0<=d)return d;a=c.getParentId(a)}return b.indexOf(a)}function d(a,b){for(var c=[a.remove[0]],d=[];1===c.length;)for(var e=c.pop(),f=d.length=0;f<a.load.length;f++){for(var g=
a.load[f],h=b.getParentId(g);h!==e;)g=h,h=b.getParentId(g);h=c.indexOf(g);0>h&&(h=c.length,c.push(g),d.push([]));d[h].push(a.load[f])}b=[];b.push({remove:a.remove,load:c});for(f=0;f<c.length;f++)1<d[f].length?b.push({remove:[c[f]],load:d[f]}):c[f]=d[f][0];return b}Object.defineProperty(h,"__esModule",{value:!0});h.nodeDiff=function(d,e,h){for(var k=0;k<e.length;k++)c[k]=!1,f[k]=null;for(k=0;k<d.length;k++)b[k]=!1,g[k]=null;for(k=0;k<e.length;k++){var l=a(e[k],d,h);0<=l&&(c[k]=!0,null!=g[l]?g[l].push(e[k]):
g[l]=[e[k]])}for(k=0;k<d.length;k++)l=a(d[k],e,h),0<=l&&(b[k]=!0,null!=f[l]?f[l].push(d[k]):f[l]=[d[k]]);h=[];for(k=0;k<d.length;k++)null!=g[k]||b[k]||h.push({load:[],remove:[d[k]]});for(k=0;k<e.length;k++)null!=f[k]||c[k]||h.push({load:[e[k]],remove:[]});for(k=0;k<e.length;k++)null!=f[k]&&(1<f[k].length||f[k][0]!==e[k])&&h.push({load:[e[k]],remove:f[k]});for(k=0;k<d.length;k++)null!=g[k]&&(1<g[k].length||g[k][0]!==d[k])&&h.push({load:g[k],remove:[d[k]]});return h};var b=[!1],g=[null],c=[!1],f=[null];
h.sortFrontToBack=function(a,b,c){return a.sort(function(a,d){if(0===a.load.length&&0===d.load.length)return 0;if(0===a.load.length)return-1;if(0===d.load.length)return 1;if(0===a.remove.length&&0===d.remove.length)return a=c.getRenderCenter(a.load[0]),d=c.getRenderCenter(d.load[0]),e.vec3d.dot(a,b)-e.vec3d.dot(d,b);if(0===a.remove.length)return-1;if(0===d.remove.length)return 1;if(1===a.load.length&&1===d.load.length)return a=c.getRenderCenter(a.load[0]),d=c.getRenderCenter(d.load[0]),e.vec3d.dot(a,
b)-e.vec3d.dot(d,b);if(1===a.load.length)return-1;if(1===d.load.length)return 1;a=c.getRenderCenter(a.remove[0]);d=c.getRenderCenter(d.remove[0]);return e.vec3d.dot(a,b)-e.vec3d.dot(d,b)})};h.splitWorkEntries=function(a,b,c){for(var e=0;e<a.length;++e){var f=a[e];if(f.load.length>b&&1===f.remove.length){f=d(f,c);a[e]=f[0];for(var g=1;g<f.length;g++)a.push(f[g])}}};h.splitWorkEntry=d})},"esri/views/3d/layers/i3s/PagedNodeIndex":function(){define("require exports ../../../../geometry/support/aaBoundingBox ../../lib/glMatrix ../../support/orientedBoundingBox ../../support/projectionUtils".split(" "),
function(q,h,e,a,d,b){var g=a.vec3d.create();q=function(){function h(a,b,c){this._pages=[];this.pageSize=0;this._renderSR=this._nodeSR=null;this._nodeSR=a;this._renderSR=b;this.pageSize=c}h.prototype.addPage=function(e,h,k){for(void 0===k&&(k=0);this._pages.length<e;)this._pages.push(null);for(var l=this._nodeSR,n=this._renderSR,p=new d.ObbArray(h.length),q=0;q<h.length;q++){var x=h[q].obb,v=p.obbs[q];d.set(x,v);a.vec3.set3(x.center[0],x.center[1],x.center[2]+k,g);l.isGeographic||n!==b.SphericalECEFSpatialReference||
(b.computeLinearTransformation(l,g,c,n),x=2*Math.sqrt(1+c[0]+c[5]+c[10]),f[0]=(c[9]-c[6])/x,f[1]=(c[2]-c[8])/x,f[2]=(c[4]-c[1])/x,f[3]=.25*x,a.quat4.conjugate(f),a.quat4.multiply(f,v.quaternion,v.quaternion));b.bufferToBuffer(g,l,0,v.center,n,0,1)}this._pages[e]={nodes:h,renderObbs:p.obbs,parents:new Uint32Array(this.pageSize)};e=this._pages;h=this.pageSize;for(l=[0];l.length;)for(n=l.pop(),k=e[n/h|0].nodes[n%h],p=0;p<k.childCount;p++)q=k.firstChild+p,null!=e[q/h|0]&&(e[q/h|0].parents[q%h]=n,l.push(q))};
h.prototype.hasPage=function(a){return!!this._pages[a]};h.prototype.getNode=function(a){var b=this.pageSize;return this._pages[a/b|0].nodes[a%b]};h.prototype.getRenderObb=function(a){var b=this.pageSize;return this._pages[a/b|0].renderObbs[a%b]};h.prototype.getRenderCenter=function(a){return this.getRenderObb(a).center};h.prototype.setRenderObb=function(a,b){var c=this.pageSize;d.set(b,this._pages[a/c|0].renderObbs[a%c])};h.prototype.getParentId=function(a){var b=this.pageSize;return this._pages[a/
b|0].parents[a%b]};h.prototype.hasNodes=function(a,b){b=(a+b-1)/this.pageSize|0;for(a=a/this.pageSize|0;a<=b;a++)if(null==this._pages[a])return!1;return!0};h.prototype.createVisibilityTraverse=function(){var a=this,b=[],c=[],f=e.create();return function(g,h){if(a.hasNodes(0,1))for(b.length=0,b.push(0),c.length=0,c.push(0);0<b.length;){var k=b.pop(),l=c.pop(),m=a.getNode(k),n=a.getRenderObb(k),p=!0;if(null!=g.clippingBox){var q=1<<g.frustumPlanes.length;if(0===(l&q)){var r=d.toAaBoundingBox(n,f);e.contains(g.clippingBox,
r)?l|=q:e.intersects(g.clippingBox,r)||(p=!1)}}for(r=0;r<g.frustumPlanes.length&&p;r++)if(q=1<<r,0===(l&q)){var t=d.intersectPlane(n,g.frustumPlanes[r]);0<t?p=!1:0>t&&(l|=q)}if(h.predicate(k,m,p)){n=m.firstChild;m=m.childCount;r=!1;p=(n+m-1)/a.pageSize|0;for(q=n/a.pageSize|0;q<=p;q++)if(!a.hasPage(q)){h.pageMiss(k,q);r=!0;break}if(!r)for(r=0;r<m;r++)b.push(n+r),c.push(l)}}}};return h}();var c=a.mat4d.create(),f=a.quat4.create();return q})},"esri/views/3d/layers/i3s/PointRenderer":function(){define("require exports dojo/text!./PointCloudPointRenderer.xml ../../../../geometry/support/aaBoundingBox ../../support/geometryUtils ../../support/orientedBoundingBox ../../webgl-engine/lib/gl-matrix ../../webgl-engine/lib/RenderPass ../../../webgl/BufferObject ../../../webgl/Program ../../../webgl/VertexArrayObject".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n){function l(a,b,c,d,e){if(c.drawScreenSpace)return c.fixedSize*b*d;e=(e?256:64)*b*d;return c.drawFixedSize?Math.min(c.fixedSize/2,e):0<c.screenMinSize?Math.min(Math.max(c.screenMinSize*b*d,a/2),e):Math.min(a/2,e)}function p(a,b,c){null==c&&(c=g.vec3d.create());c[0]=a.origin[0]+a.coordinates[3*b];c[1]=a.origin[1]+a.coordinates[3*b+1];c[2]=a.origin[2]+a.coordinates[3*b+2];return c}var m={aPosition:0,aColor:1},r={positions:[{name:"aPosition",count:3,type:5126,offset:0,
stride:12,normalized:!1}],colors:[{name:"aColor",count:3,type:5121,offset:0,stride:3,normalized:!0}]};return function(){function h(){this.didRender=!1;this.needsRender=!0;this.layerUid="";this._useFixedSizes=!1;this._scaleFactor=1;this._minSizePx=0;this._useRealWorldSymbolSizes=!1;this._sizePx=this._size=0;this._clipBox=a.create(a.POSITIVE_INFINITY);this._programScreenDepth=this._programWorldDepth=this._programScreen=this._programWorld=null;this.tempMatrix4=g.mat4.create();this.tempVec3=g.vec3.create();
this.nodes=[]}h.prototype.initializeRenderContext=function(a){a.shaderSnippets.fsPointCloudPointRenderer||a.shaderSnippets._parse(e);var b=a.shaderSnippets.vsPointCloudPointRenderer,c=a.shaderSnippets.fsPointCloudPointRenderer;this._programWorld=new k(a.rctx,b,c,m,[]);this._programScreen=new k(a.rctx,b,c,m,["DRAW_SCREEN_SIZE"]);this._programWorldDepth=new k(a.rctx,b,c,m,["DEPTH_PASS"]);this._programScreenDepth=new k(a.rctx,b,c,m,["DRAW_SCREEN_SIZE","DEPTH_PASS"]);this.needsRender=!0};h.prototype.uninitializeRenderContext=
function(a){this._programWorld&&this._programWorld.dispose();this._programScreen&&this._programScreen.dispose();this._programWorldDepth&&this._programWorldDepth.dispose();this._programScreenDepth&&this._programScreenDepth.dispose();this._programScreenDepth=this._programWorldDepth=this._programScreen=this._programWorld=null};h.prototype.intersect=function(c,e,f,h){var k=g.vec3d.create(),m=g.vec3d.create(),n=g.vec3d.create(),q=g.vec3d.create(),r=d.plane.create(),u=c.camera.perPixelRatio,t=c.camera.near,
v=this._getSizeParams();g.vec3d.subtract(f,e,m);var x=1/g.vec3d.length(m);g.vec3d.scale(m,x,m);g.vec3d.negate(m,n);g.vec4d.set4(m[0],m[1],m[2],-g.vec3d.dot(m,e),r);h={};f={};var A=a.create(),K=a.create(this._clipBox);a.offset(K,-e[0],-e[1],-e[2],K);for(var O=0,P=this.nodes;O<P.length;O++){var L=P[O],U=L.splatSize*this._scaleFactor,N=b.minimumDistancePlane(L.obb,r),S=b.maximumDistancePlane(L.obb,r),N=N-(v.drawScreenSpace?0:l(U,N+t,v,u,L.isLeaf)),S=S-(v.drawScreenSpace?0:l(U,S+t,v,u,L.isLeaf)),N=null!=
h.dist&&null!=f.dist&&h.dist<N*x&&f.dist>S*x;if(!(0>S||N)&&(S=l(U,S+t,v,u,L.isLeaf),b.intersectLine(L.obb,e,m,S))){S*=S;b.toAaBoundingBox(L.obb,A);a.offset(A,-e[0],-e[1],-e[2],A);N=!a.contains(K,A);g.vec3d.subtract(L.origin,e,q);for(var aa=0;aa<L.pointCount;aa++)if(k[0]=q[0]+L.coordinates[3*aa],k[1]=q[1]+L.coordinates[3*aa+1],k[2]=q[2]+L.coordinates[3*aa+2],!N||a.containsPoint(K,k)){var V=g.vec3d.dot(k,m),T=V+t,Q=v.drawScreenSpace?0:l(U,T,v,u,L.isLeaf);if(!(0>V-Q)){var G=g.vec3d.length2(k)-V*V;if(!(G>
S||(T-=Q,T=l(U,T,v,u,L.isLeaf),G>T*T))){G=this.layerUid+"/"+L.id+"/"+aa;V=(V-Q)*x;if(null==h.dist||V<h.dist)h.point=p(L,aa,h.point),h.dist=V,h.normal=n,h.pointId=G,h.layerUid=this.layerUid;if(null==f.dist||V>f.dist)f.point=p(L,aa,f.point),f.dist=V,f.normal=n,f.pointId=G,f.layerUid=this.layerUid}}}}}null!=h.dist&&(k=c.getMinResult(),null==k.dist||h.dist<k.dist)&&(e={type:"external",point:h.point,metadata:{pointId:h.pointId,layerUid:h.layerUid}},k.set(e,h.pointId,h.dist,h.normal,void 0),k.setIntersector("PointRenderer"));
null!=f.dist&&(c=c.getMaxResult(),null==c.dist||f.dist>c.dist)&&(e={type:"external",point:f.point,metadata:{pointId:f.pointId,layerUid:f.layerUid}},c.set(e,f.pointId,f.dist,f.normal,void 0),c.setIntersector("PointRenderer"))};h.prototype.render=function(b){if(b.pass!==c.MATERIAL&&b.pass!==c.MATERIAL_DEPTH)return!1;for(var d=b.pass===c.MATERIAL_DEPTH,e=b.rctx,f=0,h=this.nodes;f<h.length;f++){var k=h[f];null==k.vao&&this._initNode(b,k)}f=this._getSizeParams();h=d?f.drawScreenSpace?this._programScreenDepth:
this._programWorldDepth:f.drawScreenSpace?this._programScreen:this._programWorld;if(null==h||0===this.nodes.length)return!0;var l=this._clipBox,m=!a.equals(l,a.POSITIVE_INFINITY,function(a,b){return a===b});m||(g.vec3.set3(-Infinity,-Infinity,-Infinity,this.tempVec3),h.setUniform3fv("uClipMin",this.tempVec3),g.vec3.set3(Infinity,Infinity,Infinity,this.tempVec3),h.setUniform3fv("uClipMax",this.tempVec3));e.setDepthTestEnabled(!0);e.bindProgram(h);h.setUniformMatrix4fv("uProjectionMatrix",b.camera.projectionMatrix);
d&&h.setUniform2f("nearFar",b.camera.near,b.camera.far);f.drawFixedSize&&h.setUniform2f("uPointScale",f.fixedSize,b.camera.fullHeight);for(var d=0,n=this.nodes;d<n.length;d++){k=n[d];h.setUniform2f("uScreenMinMaxSize",f.screenMinSize,k.isLeaf?256:64);f.drawFixedSize||h.setUniform2f("uPointScale",k.splatSize*this._scaleFactor,b.camera.fullHeight);var p=k.origin;m&&(g.vec3.set3(l[0]-p[0],l[1]-p[1],l[2]-p[2],this.tempVec3),h.setUniform3fv("uClipMin",this.tempVec3),g.vec3.set3(l[3]-p[0],l[4]-p[1],l[5]-
p[2],this.tempVec3),h.setUniform3fv("uClipMax",this.tempVec3));g.mat4.identity(this.tempMatrix4);g.mat4.translate(this.tempMatrix4,p,this.tempMatrix4);g.mat4.multiply(b.camera.viewMatrix,this.tempMatrix4,this.tempMatrix4);h.setUniformMatrix4fv("uModelViewMatrix",this.tempMatrix4);e.bindVAO(k.vao);e.drawArrays(0,0,k.pointCount)}return!0};Object.defineProperty(h.prototype,"useFixedSizes",{get:function(){return this._useFixedSizes},set:function(a){this._useFixedSizes!==a&&(this._useFixedSizes=a,this._requestRender())},
enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"scaleFactor",{get:function(){return this._scaleFactor},set:function(a){this._scaleFactor!==a&&(this._scaleFactor=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"minSizePx",{get:function(){return this._minSizePx},set:function(a){this._minSizePx!==a&&(this._minSizePx=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"useRealWorldSymbolSizes",{get:function(){return this._useRealWorldSymbolSizes},
set:function(a){this._useRealWorldSymbolSizes!==a&&(this._useRealWorldSymbolSizes=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"size",{get:function(){return this._size},set:function(a){this._size!==a&&(this._size=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"sizePx",{get:function(){return this._sizePx},set:function(a){this._sizePx!==a&&(this._sizePx=a,this._requestRender())},enumerable:!0,configurable:!0});
Object.defineProperty(h.prototype,"clippingBox",{set:function(b){a.set(this._clipBox,b||a.POSITIVE_INFINITY)},enumerable:!0,configurable:!0});h.prototype.addNode=function(a){this.nodes.push({id:a.id,splatSize:a.splatSize,obb:a.obb,origin:g.vec3.create(a.origin),coordinates:a.coordinates,pointCount:a.coordinates.length/3,rgb:a.rgb,vao:null,isLeaf:a.isLeaf});this._requestRender()};h.prototype.removeNode=function(a){this.nodes=this.nodes.filter(function(b){b.id===a&&b.vao&&(b.vao.dispose(!0),b.vao=null);
return b.id!==a});this._requestRender()};h.prototype.removeAll=function(){this.nodes.forEach(function(a){a.vao&&(a.vao.dispose(!0),a.vao=null)});this.nodes=[];this._requestRender()};h.prototype._initNode=function(a,b){a=a.rctx;b.vao=new n(a,m,r,{positions:f.createVertex(a,35044,b.coordinates),colors:f.createVertex(a,35044,b.rgb)})};h.prototype._requestRender=function(){this.didRender=!1;this.needsRender=!0};h.prototype._getSizeParams=function(){var a=this._useFixedSizes,b=a&&!this._useRealWorldSymbolSizes,
c=b?this._sizePx:this._size,d=this._minSizePx;a&&(d=0);return{drawScreenSpace:b,drawFixedSize:a,fixedSize:c,screenMinSize:d}};return h}()})},"esri/views/3d/layers/SceneLayerGraphicsView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Graphic ../../../core/Handles ../../../core/Logger ../../../core/PooledArray ../../../core/promiseUtils ../../../core/sniff ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/rbush/PooledRBush ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/contains ../../../layers/graphics/dehydratedFeatures ../../../renderers/support/renderingInfoUtils ./LayerView3D ./graphics/Graphics3DFeatureLikeLayerView ./graphics/Graphics3DVerticalScale ./i3s/I3SQueryEngine ./i3s/I3SUtil ./i3s/MemCache ./support/layerViewUpdatingProperties ../lib/glMatrix ../support/EventedArray ../support/orientedBoundingBox ../support/projectionUtils".split(" "),
function(q,h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u,x,v,A,y,C,B,D,E,J,F,M,H){var I=g.getLogger("esri.views.3d.layers.SceneLayerGraphicsView3D");q=function(h){function g(a){a=h.call(this)||this;a._nodesAddedToStage={};a._handles=new b;a._controllerCreated=!1;a.overlayUpdating=!1;a.supportsDraping=!0;a._queryEngine=null;a._memCache=new D(50);a._usedMemory=0;a.loadedGraphics=new F;a.supportsHeightUnitConversion=!0;a._coordinatesOutsideExtentErrors=0;a._maxCoordinatesOutsideExtentErrors=20;a._definitionExpressionErrors=
0;a._maxDefinitionExpressionErrors=20;return a}e(g,h);g.prototype.initialize=function(){var a=this;B.checkSpatialReferences(this.layer,this.view.spatialReference,this.view.viewingMode);this._handles.add([n.init(this.layer,"rangeInfos",function(b){return a._rangeInfosChanged(b)}),this.layer.watch("renderer",function(b,c){return a._rendererChange(b,c)}),this.layer.watch("objectIdFilter",function(){return a._objectIdFilterChange()}),this.watch("_controller.parsedDefinitionExpression",function(){return a._definitionExpressionChange()})]);
this.graphics3d=new A({owner:this,layer:this.layer,asyncGraphicsUpdates:!0,frustumVisibilityEnabled:!1,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!1,suspendResumeExtentMode:"data",dataExtent:this.layer.fullExtent,updateClippingExtent:function(b){return a._updateClippingExtent(b)},queryGraphicUIDsInExtent:function(b,c,d){return a._queryGraphicUIDsInExtent(b,c,d)}});this.supportsHeightUnitConversion&&(this._verticalScale=new y({sourceSpatialReference:this.layer.spatialReference,
destSpatialReference:this.view.spatialReference}));this.addResolvingPromise(this.graphics3d.setup());this.drawingOrder=this.view.getDrawingOrder(this.layer.uid);this._createController();this.when(function(){a._handles.add(a.graphics3d.graphicsCore.watch("maxNumberOfFeatures",function(b){a._controller.featureTarget=b}))})};g.prototype.destroy=function(){this.graphics3d&&(this.graphics3d.destroy(),this.graphics3d=null);this._controller&&(this._controller.destroy(),this._controller=null);this._nodesAddedToStage=
this._elevationUpdateNodes=null;this._usedMemory=0;this._handles&&(this._handles.destroy(),this._handles=null)};Object.defineProperty(g.prototype,"displayLimitExceeded",{get:function(){return this.suspended?!1:!!this._controller&&!this._controller.leafsReached},enumerable:!0,configurable:!0});g.prototype.whenGraphicAttributes=function(a,b){var c=this;return B.whenGraphicAttributes(this.layer,[a],this._getObjectIdField(),b,function(){var b=c._findGraphicNodeAndIndex(a);return{node:b.node,indices:[b.index]}},
{ignoreUnavailableFields:!0,populateObjectId:!0}).then(function(a){return a[0]})};g.prototype.getGraphicFromGraphicUid=function(a){if(!this.loadedGraphics)return f.reject();var b=u.hydrateGraphic(this.loadedGraphics.find(function(b){return b.uid===a}),this.layer),c=this._getObjectIdField();if(!b||!b.attributes||!b.attributes[c])return f.reject();b.layer=this.layer;b.sourceLayer=this.layer;return f.resolve(b)};g.prototype.whenGraphicBounds=function(a,b){return this.graphics3d.graphicsCore.whenGraphicBounds(a,
b)};g.prototype.canResume=function(){return this.inherited(arguments)&&(!this._controller||this._controller.rootNodeVisible)};g.prototype.isUpdating=function(){return this.overlayUpdating||!this._controllerCreated||this._controller&&this._controller.updating||!this.graphics3d.destroyed&&this.graphics3d.updating};g.prototype.getRenderingInfo=function(a){if((a=x.getRenderingInfo(a,{renderer:this.layer.renderer}))&&a.color){var b=a.color;b[0]/=255;b[1]/=255;b[2]/=255}return a};Object.defineProperty(g.prototype,
"symbolUpdateType",{get:function(){return this.graphics3d.graphicsCore.symbolUpdateType},enumerable:!0,configurable:!0});g.prototype._findGraphicNodeAndIndex=function(a){a=a.attributes[this.layer.objectIdField];for(var b=0,c=Object.keys(this._nodesAddedToStage);b<c.length;b++){var d=c[b],e=this._findGraphicIndex(this._nodesAddedToStage[d].bundle,a);if(0<=e)return{node:this._controller.nodeIndex[d],index:e}}return null};g.prototype._forAllFeatures=function(a,b){for(var c=0,d=Object.keys(this._nodesAddedToStage);c<
d.length;c++){for(var e=d[c],f=this._nodesAddedToStage[e].bundle,g=0;g<f.length;g++)for(var h=f[g].graphics,k=0;k<h.length;k++){var l=h[k],m=f[g].featureIds[k];l.visible&&a(m,g,l)}null!=b&&b({nodeId:e})}};g.prototype._getGraphicIndices=function(a,b){a=this._nodesAddedToStage[a];for(var c=this._getObjectIdField(),d=[],e=0;e<b.length;e++){var f=this._findGraphicIndex(a.bundle,b[e].attributes[c]);0<=f&&d.push(f)}return d};g.prototype._findGraphicIndex=function(a,b){for(var c=0;c<a.length;c++)for(var d=
0,e=a[c].featureIds;d<e.length;d++)if(e[d]===b)return c;return-1};g.prototype._queryGraphicUIDsInExtent=function(a,b,d){if(this._controller){var e=this._controller.crsIndex;H.boundingRectToBoundingRect(a,b,P,e);var f=L;m.fromRect(f,P);f[2]=-Infinity;f[5]=Infinity;null==this._elevationUpdateNodes&&(this._elevationUpdateNodes=new c({initialSize:10}));var g=this._elevationUpdateNodes;g.clear();this._controller.updateElevationChanged(f,e,g);for(e=0;e<g.length;e++){var h=this._nodesAddedToStage[g.data[e].id];
if(null!=h){if(!h.spatialIndex&&h.bundle.length>=O){for(var l=new p.PooledRBush(9,k("csp-restrictions")?function(a){return{minX:a.extent[0],minY:a.extent[1],maxX:a.extent[2],maxY:a.extent[3]}}:[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]),n=S.length=0,q=h.bundle;n<q.length;n++){for(var t=q[n],v=r.empty(),x=0,y=t.graphics;x<y.length;x++)f=y[x],u.expandAABR(f.geometry,v);t.extent=v;S.push(t)}l.load(S);h.spatialIndex=l}if(h.spatialIndex)f=P,H.boundingRectToBoundingRect(a,b,P,this.view.spatialReference),
U.minX=f[0],U.minY=f[1],U.maxX=f[2],U.maxY=f[3],h.spatialIndex.search(U,function(a){var b=0;for(a=a.graphics;b<a.length;b++)d(a[b].uid)});else for(l=0,h=h.bundle;l<h.length;l++)for(t=h[l],n=0,t=t.graphics;n<t.length;n++)f=t[n],d(f.uid)}}}};g.prototype.highlight=function(a,b){return this.graphics3d.highlight(a,b,this.layer.objectIdField)};g.prototype._createController=function(){var a=this;this.layer.createGraphicsController({layerView:this,layerViewRequiredFunctions:{addNodeData:function(b,c){return a._addNodeData(b,
c)},isNodeLoaded:function(b){return a._isNodeLoaded(b)},removeNodeData:function(b){return a._removeNodeData(b)},getLoadedNodeIDs:function(){return a._getLoadedNodeIDs()},getLoadedAttributes:function(b){return a._getLoadedAttributes(b)},getAttributeData:function(b){return a._getAttributeData(b)},setAttributeData:function(b,c,d){return a._setAttributeData(b.id,c,d)},getMemoryUsage:function(){return a.view.resourceController.usedMemory}},layerViewOptionalFunctions:{loadCachedNodeData:function(b,c){return a._loadCachedNodeData(b,
c)},addCachedNodeData:function(b,c,d){return a._addCachedNodeData(b,c,d)}}}).then(function(b){a._controller=b;b.watch("rootNodeVisible",function(){a.notifyChange("suspended")})}).always(function(){a._controllerCreated=!0;a.notifyChange("updating")})};g.prototype._addNodeData=function(a,b){var c=b.allGeometryData,e=b.attributeDataInfo,g=this._controller.crsIndex;b=this.view.spatialReference;var h=[0,0,0],k=this._getObjectIdField();a.memory=4096;null==this._nodesAddedToStage[a.id]&&(this._nodesAddedToStage[a.id]=
{bundle:[],attributeData:e?e.attributeData:null,loadedAttributes:e?e.loadedAttributes:null});var l=[];this._nodesAddedToStage[a.id].bundle=l;if(e=this.layer.fullExtent)e=this.layer.fullExtent.clone(),e.xmin-=.5,e.ymin-=.5,e.xmax+=.5,e.ymax+=.5,e.hasZ&&(e.zmin-=.5,e.zmax+=.5),e.hasM&&(e.mmin-=.5,e.mmax+=.5);for(var m=e,e=[],n=[],p=0;p<c.length;p++){var q=c[p],r=q.featureDataPosition,v=r.length,x=q.geometries||[K[v]],y=q.featureIds;m&&!t.extentContainsCoords3D(m,r)&&(this._coordinatesOutsideExtentErrors<
this._maxCoordinatesOutsideExtentErrors&&I.error("Service Error: Coordinates outside of layer extent"),this._coordinatesOutsideExtentErrors+1===this._maxCoordinatesOutsideExtentErrors&&I.error("Maximum number of errors reached. Further errors are ignored."),this._coordinatesOutsideExtentErrors++);for(var A=0;A<x.length;A++){var w=x[A];if("points"===w.params.type){var B=[],C=y[A<y.length?A:0],D={};null!=C&&(D[k]=C);C=void 0;"Embedded"===w.type&&(C=w.params.vertexAttributes.position);for(w=0;w<C.length;w+=
v){for(var E=0;E<v;E++)h[E]=r[E]+C[w+E];H.bufferToBuffer(h,g,0,N,b,0,1);E=u.makeDehydratedPoint(N[0],N[1],N[2],b);3>v&&(E.z=void 0);B.push({uid:d.generateUID(),geometry:E,attributes:D,visible:!0});a.obb||n.push(E.x,E.y,E.z?E.z:0)}a.memory+=16*C.length;e.push.apply(e,B);l.push({featureIds:q.featureIds,graphics:B})}}}a.numFeatures=e.length;a.memory/=1048576;c=this._nodesAddedToStage[a.id];this._setBundleAttributes(c.bundle,c.loadedAttributes,c.attributeData);0<n.length&&(g=this.view.renderSpatialReference,
h=this._controller.crsVertex,H.bufferToBuffer(n,b,0,n,g,0,n.length/3),a.obb=M.compute({data:n,size:3,offsetIdx:0,strideIdx:3}),H.vectorToVector(a.obb.center,g,a.obb.center,h),this._controller.updateVisibility(a.id));if(!this._controller.isGeometryVisible(a))return this._memCache.put(a.id,this._nodesAddedToStage[a.id],a.memory),delete this._nodesAddedToStage[a.id],f.resolve();this._verticalScale&&this._verticalScale.adjust(e);this._usedMemory+=a.memory;this.loadedGraphics.addMany(e);this._filterNode(c);
return f.resolve()};g.prototype._isNodeLoaded=function(a){return null!=this._nodesAddedToStage[a.id]};g.prototype._removeAllNodeData=function(){var a=this;Object.keys(this._nodesAddedToStage).forEach(function(b){var c=a._nodesAddedToStage[b];c&&a._memCache.put(b,c,a._controller.nodeIndex[b].memory)});this._nodesAddedToStage={};this._usedMemory=0;this.loadedGraphics.clear()};g.prototype._removeNodeData=function(a){var b=this,c=[];a.forEach(function(a){var d=b._removeNodeStageData(a,c);d&&b._memCache.put(a.id,
d,a.memory)});this.loadedGraphics.removeUnorderedMany(c)};g.prototype._removeNodeStageData=function(a,b){var c=this._nodesAddedToStage[a.id];if(!c)return null;for(var d=0,e=c.bundle;d<e.length;d++)b.push.apply(b,e[d].graphics);delete this._nodesAddedToStage[a.id];this._usedMemory-=a.memory;9.5367431640625E-7>this._usedMemory&&(this._usedMemory=0);return c};g.prototype._loadCachedNodeData=function(a,b){return f.resolve(this._memCache.get(a.id))};g.prototype._addCachedNodeData=function(a,b,c){for(var d=
[],e=0,g=b.bundle;e<g.length;e++)d.push.apply(d,g[e].graphics);this._nodesAddedToStage[a.id]=b;this._setAttributeData(a.id,c.loadedAttributes,c.attributeData);this._usedMemory+=a.memory;this.loadedGraphics.addMany(d);this._filterNode(b);return f.resolve()};g.prototype._getLoadedNodeIDs=function(){return Object.keys(this._nodesAddedToStage)};g.prototype._getLoadedAttributes=function(a){if(a=this._nodesAddedToStage[a.id])return a.loadedAttributes};g.prototype._getAttributeData=function(a){if(a=this._nodesAddedToStage[a.id])return a.attributeData};
g.prototype._setAttributeData=function(a,b,c){if(a=this._nodesAddedToStage[a])a.loadedAttributes=b,a.attributeData=c,this._setBundleAttributes(a.bundle,b,c),this._filterNode(a),this.graphics3d.graphicsCore.labelsEnabled&&(b=a.bundle.map(function(a){return a.graphics.length&&a.graphics[0].uid}),this.graphics3d.graphicsCore.updateLabelingInfo(b))};g.prototype._setBundleAttributes=function(a,b,c){for(var d=0;d<a.length;d++)for(var e=0,f=a[d].graphics;e<f.length;e++){var g=f[e];g.attributes||(g.attributes=
{});if(b)for(var h=0,k=b;h<k.length;h++){var l=k[h].name;c[l]&&(g.attributes[l]=B.getCachedAttributeValue(c[l],d))}}};g.prototype._updateClippingExtent=function(a){this._controller&&this._controller.updateClippingArea(a);return!1};g.prototype._getObjectIdField=function(){return this.layer.objectIdField||"OBJECTID"};g.prototype._rendererChange=function(a,b){var c=a?a.requiredFields:[],d=b?b.requiredFields:[];c.length===d.length&&c.every(function(a,b){return c[b]===d[b]})||this._reloadAllNodes()};g.prototype._rangeInfosChanged=
function(a){null!=a&&0<a.length&&I.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")};g.prototype._objectIdFilterChange=function(){var a=this;Object.keys(this._nodesAddedToStage).forEach(function(b){return a._filterNode(a._nodesAddedToStage[b])})};g.prototype._reloadAllNodes=function(){this._removeAllNodeData();this._controller&&this._controller.restartNodeLoading()};g.prototype._definitionExpressionChange=function(){this._definitionExpressionErrors=
0};g.prototype._evaluateClause=function(a,b){try{return!!a.calculateValue(b)}catch(X){return this._definitionExpressionErrors<this._maxDefinitionExpressionErrors&&I.error("Error while evaluating definitionExpression: "+X),this._definitionExpressionErrors++,this._definitionExpressionErrors===this._maxDefinitionExpressionErrors&&I.error("Further errors are ignored"),!1}};g.prototype._filterNode=function(a){var b=this._getObjectIdField(),c=null;if(this.layer.objectIdFilter)var d=this.layer.objectIdFilter.ids,
e="include"===this.layer.objectIdFilter.method,c=function(a){return 0<=d.indexOf(a)===e};var f=this._controller.parsedDefinitionExpression,g=0;for(a=a.bundle;g<a.length;g++)for(var h=0,k=a[g].graphics;h<k.length;h++){var l=k[h],m=l.visible;c&&!c(l.attributes[b])?l.visible=!1:l.visible=f?this._evaluateClause(f,l):!0;m!==l.visible&&(aa.graphic=l,aa.property="visible",aa.oldValue=m,aa.newValue=l.visible,this.layer.graphicChanged(aa))}};g.prototype.queryExtent=function(a){return this._ensureQueryEngine().queryExtent(a)};
g.prototype.queryFeatureCount=function(a){return this._ensureQueryEngine().queryFeatureCount(a)};g.prototype.queryFeatures=function(a){return this._ensureQueryEngine().queryFeatures(a)};g.prototype.queryObjectIds=function(a){return this._ensureQueryEngine().queryObjectIds(a)};g.prototype._ensureQueryEngine=function(){this._queryEngine||(this._queryEngine=this._createQueryEngine());return this._queryEngine};g.prototype._createQueryEngine=function(){var a=this,b={id:0,index:0,graphic:null},c=this;return new C(this.layer,
{forAll:function(c,d){a._forAllFeatures(function(a,d,e){b.id=a;b.index=d;b.graphic=e;c(b)},d)},createGraphic:function(a){return u.hydrateGraphic(a.graphic,c.layer)},requestFields:function(b,c,d){return B.whenGraphicAttributes(a.layer,c,a._getObjectIdField(),d,function(){var d=a._getGraphicIndices(b.nodeId,c);return{node:a._controller.nodeIndex[b.nodeId],indices:d}},{ignoreUnavailableFields:!1})},createExtentBuilder:function(){var b=m.empty(),c=a.layer.spatialReference;return{add:function(a){return u.expandAABB(a.graphic.geometry,
b)},getExtent:function(){return m.toExtent(b,c)}}}},{enableObjectId:!0,enableOutFields:!!this.layer.objectIdField})};g.prototype.getUsedMemory=function(){var a=this._usedMemory;this._controller&&(a+=512*Object.keys(this._controller.nodeIndex).length/1048576);return a};g.prototype.getUnloadedMemory=function(){return this._controller?this._controller.getUnloadedMemoryEstimate():0};g.prototype.getCachedMemory=function(){return this._memCache.getSize()};g.prototype.removeCachedData=function(){0<this._memCache.getSize()||
this.suspended&&this._removeAllNodeData();this._memCache.clear()};g.prototype.getStats=function(){var a=this.inherited(arguments)||{};a.index=this._controller?Object.keys(this._controller.nodeIndex).length:0;a.nodes=Object.keys(this._nodesAddedToStage).length;a.features=this.loadedGraphics.length;a.cache=this._memCache.getSize().toFixed(2)+"MB, "+Math.round(100*this._memCache.getHitRate())+"% hit";this._controller&&this._controller.updateStats(a);return a};a([l.property()],g.prototype,"graphics3d",
void 0);a([l.property()],g.prototype,"drawingOrder",void 0);a([l.property({aliasOf:"graphics3d.graphicsCore.hasDraped"})],g.prototype,"hasDraped",void 0);a([l.property({type:Boolean})],g.prototype,"overlayUpdating",void 0);a([l.property({type:Boolean})],g.prototype,"supportsDraping",void 0);a([l.property()],g.prototype,"loadedGraphics",void 0);a([l.property()],g.prototype,"layer",void 0);a([l.property()],g.prototype,"_controller",void 0);a([l.property({dependsOn:["_controller.updating","graphics3d.updating",
"overlayUpdating"]})],g.prototype,"updating",void 0);a([l.property(E.updatingPercentage)],g.prototype,"updatingPercentage",void 0);a([l.property({aliasOf:"_controller.updatingPercentage"})],g.prototype,"updatingPercentageValue",void 0);a([l.property({dependsOn:["suspended","_controller.leafsReached"]})],g.prototype,"displayLimitExceeded",null);return g=a([l.subclass("esri.views.3d.layers.SceneLayerGraphicsView3D")],g)}(l.declared(v));var K={2:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,
0]}}},3:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0,0]}}}},O=100,P=r.create(),L=m.create(m.POSITIVE_INFINITY),U={minX:0,minY:0,maxX:0,maxY:0},N=J.vec3d.create(),S=[],aa={graphic:null,property:null,oldValue:null,newValue:null};return q})},"esri/views/3d/layers/i3s/MemCache":function(){define(["require","exports"],function(q,h){return function(){function e(a){void 0===a&&(a=10);this.maxSize=a;this._db=new Map;this._miss=this._hit=this._age=this._size=0}e.prototype.put=function(a,
d,b){!b||0>b?console.warn("Refusing to cache entry with invalid size "+b):(this._db.has(a)?(a=this._db.get(a),this._size+=b-a.sizeMB,a.entry=d,a.lastUsed=this._age,a.sizeMB=b):(this._db.set(a,{entry:d,sizeMB:b,lastUsed:this._age}),this._size+=b),++this._age,this._size>this.maxSize&&this._removeEntries())};e.prototype.get=function(a){if(this._db.has(a))return a=this._db.get(a),a.lastUsed=this._age,++this._age,++this._hit,a.entry;++this._miss;return null};e.prototype.clear=function(){this._db.clear();
this._miss=this._hit=this._age=this._size=0};e.prototype.getSize=function(){return this._size};e.prototype.getHitRate=function(){return this._hit/(this._hit+this._miss)};e.prototype._removeEntries=function(){var a=[];this._db.forEach(function(b,c){a.push([b.lastUsed,c])});a.sort(function(a,b){return a[0]-b[0]});for(var d=0;d<a.length;d++){var b=a[d];this._size-=this._db.get(b[1]).sizeMB;this._db.delete(b[1]);if(this._size<.9*this.maxSize)break}};return e}()})},"esri/views/3d/support/EventedArray":function(){define(["require",
"exports","../../../core/tsSupport/extendsHelper","../../../core/PooledArray","./Evented"],function(q,h,e,a,d){return function(b){function d(){var c=null!==b&&b.apply(this,arguments)||this;c.array=new a;return c}e(d,b);d.prototype.clear=function(){0<this.array.length&&this.emit("change",{added:[],removed:this.toArray()});this.array.clear()};Object.defineProperty(d.prototype,"length",{get:function(){return this.array.length},enumerable:!0,configurable:!0});d.prototype.getItemAt=function(a){return this.array.data[a]};
d.prototype.push=function(a){var b=this.array.push(a);this.emit("change",{added:[a],removed:[]});return b};d.prototype.addMany=function(a){var b=this.array.pushArray(a);this.emit("change",{added:a,removed:[]});return b};d.prototype.pushNew=function(){var a=this.array.pushNew();this.emit("change",{added:[a],removed:[]});return a};d.prototype.pop=function(){var a=this.array.pop();void 0!==a&&this.emit("change",{added:[],removed:[a]});return a};d.prototype.removeMany=function(a){a=this.array.removeMany(a);
0<a.length&&this.emit("change",{added:[],removed:a});return a};d.prototype.removeUnordered=function(a){a=this.array.removeUnordered(a);void 0!==a&&this.emit("change",{added:[],removed:[a]});return a};d.prototype.removeUnorderedMany=function(a){a=this.array.removeUnorderedMany(a);0<a.length&&this.emit("change",{added:[],removed:a});return a};d.prototype.toArray=function(){return this.array.toArray()};d.prototype.some=function(a,b){return this.array.some(a,b)};d.prototype.find=function(a,b){return this.array.find(a,
b)};d.prototype.filter=function(a,b,e){e=e||new d;this.array.filter(a,b,e.array);return e};d.prototype.forEach=function(a,b){this.array.forEach(a,b)};return d}(d.Evented)})},"url:esri/views/3d/environment/materials/SimpleAtmosphereMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vsSimpleAtmosphere"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  uniform mat4 proj;\r\n  uniform mat4 view;\r\n\r\n#ifndef PANORAMIC\r\n  const float TWICEPI \x3d 2.0*3.14159265;\r\n  const float ATMOSPHERE_RIM_SEGMENTS \x3d 128.0;\r\n\r\n  uniform vec3 silCircleCenter;\r\n  uniform vec3 silCircleV1;\r\n  uniform vec3 silCircleV2;\r\n  uniform vec2 texV;\r\n\r\n  uniform float innerScale;  // scale for inner rim\r\n  varying float innerFactor; // 0: outer atmosphere, 1: inner atmosphere\r\n#endif\r\n\r\n  uniform vec3 lightDirection;\r\n\r\n  attribute vec3 $position;\r\n  varying vec2 vtc;\r\n  varying float falloff;\r\n\r\n  void main(void) {\r\n\r\n#ifdef PANORAMIC\r\n\r\n    vec3 pos \x3d $position;\r\n    float ndotl \x3d lightDirection.z;\r\n    vtc \x3d vec2(0, $position.z+0.05);\r\n\r\n#else\r\n\r\n    innerFactor \x3d clamp(-$position.z, 0.0, 1.0);\r\n    float scale \x3d $position.y * (1.0 + innerFactor * innerScale);\r\n    float phi \x3d $position.x * (TWICEPI / ATMOSPHERE_RIM_SEGMENTS) + 1.0;\r\n    vec3 pos \x3d  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;\r\n    float ndotl \x3d dot(normalize($position.y \x3e 0.0 ? pos: silCircleCenter), lightDirection);\r\n\r\n    vtc.x \x3d $position.x / ATMOSPHERE_RIM_SEGMENTS;\r\n    vtc.y \x3d texV.x * (1.0 - $position.z) + texV.y * $position.z;\r\n\r\n#endif\r\n\r\n    falloff \x3d max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\r\n\r\n    gl_Position \x3d proj * view * vec4(pos, 1.0);\r\n    gl_Position.z \x3d gl_Position.w; // project atmosphere onto the far plane\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsSimpleAtmosphere"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  uniform sampler2D tex;\r\n\r\n  varying vec2 vtc;\r\n  varying float falloff;\r\n\r\n#ifndef PANORAMIC\r\n  uniform float altitudeFade;\r\n  varying float innerFactor;\r\n#endif\r\n\r\n  void main() {\r\n    vec4 texColor \x3d texture2D(tex, vtc);\r\n\r\n#ifdef PANORAMIC\r\n    gl_FragColor \x3d texColor * falloff;\r\n#else\r\n    vec4 atmosphereColor \x3d texColor * falloff;\r\n    vec4 innerColor \x3d vec4(texColor.rgb * falloff, 1.0 - altitudeFade);\r\n    gl_FragColor \x3d mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));\r\n#endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsSimpleAtmosphereFade"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  attribute vec2 $position;\r\n\r\n  uniform vec3 lightDirection;\r\n  uniform vec3 cameraPosition;\r\n\r\n  uniform float undergroundFadeAlpha;\r\n\r\n  varying vec4 color;\r\n\r\n  void main(void) {\r\n    float ndotl \x3d dot(normalize(cameraPosition), lightDirection);\r\n    float lighting \x3d max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\r\n\r\n    color \x3d vec4(vec3(lighting), undergroundFadeAlpha);\r\n\r\n    gl_Position \x3d vec4($position.xy, 1.0, 1.0); // on the far plane\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsSimpleAtmosphereFade"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  varying vec4 color;\r\n\r\n  void main() {\r\n    gl_FragColor \x3d color;\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/environment/materials/RealisticAtmosphereMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3c!--Vertex Shader for Atmosphere--\x3e\r\n\x3csnippet name\x3d"vsRealisticAtmosphere"\x3e\x3c![CDATA[\r\n//\r\n// Based on Atmospheric scattering vertex shader by Sean O\'Neil from GPU Gems 2 Chapter 16.\r\n//\r\n// Link:                   http://http.developer.nvidia.com/GPUGems2/gpugems2_chapter16.html\r\n// Download Portal:        http://http.download.nvidia.com/developer/GPU_Gems_2/CD/Index.html\r\n// Unmodified Source Code: http://http.download.nvidia.com/developer/GPU_Gems_2/CD/Content/16.zip\r\n//\r\n// Adapted for WebGIS by Jascha Gr\u00fcbel (jgruebel@esri.com), Z\u00fcrich 2015\r\n//\r\n\r\n  $vsprecisionf\r\n\r\n  //Camera\r\n  uniform vec2 halfSizeNearPlane;\r\n  uniform vec3 v3CameraUp;\r\n  uniform vec3 v3CameraRight;\r\n  uniform vec3 v3CameraDir;\r\n  uniform vec2 v2CameraCenterOffset;\r\n\r\n  //Attributes\r\n  attribute vec3 $position;\r\n  attribute vec2 $uv0;\r\n\r\n  //Varyings\r\n  varying vec3 v3WorldRay;\r\n  varying vec2 vtc;\r\n\r\n#ifdef HAZE\r\n  varying vec3 v3EyeDir;\r\n#endif\r\n\r\n  void main(void) {\r\n    vec3 v3Pos \x3d $position;\r\n    vtc \x3d $uv0;\r\n    vec2 rayvtc \x3d $uv0 - v2CameraCenterOffset;\r\n\r\n#ifdef HAZE\r\n    v3EyeDir \x3d vec3((2.0*halfSizeNearPlane *rayvtc)-halfSizeNearPlane,-1.0);\r\n#else\r\n    vec3 v3EyeDir \x3d vec3((2.0*halfSizeNearPlane *rayvtc)-halfSizeNearPlane,-1.0);\r\n#endif\r\n    v3WorldRay \x3d v3EyeDir.z*v3CameraDir + v3EyeDir.y*v3CameraUp + v3EyeDir.x*v3CameraRight;\r\n    gl_Position \x3d vec4(v3Pos, 1.0);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"atmosphereScaleFunction"\x3e\x3c![CDATA[\r\n  //Approximation for inner integral based on a radii ratio of 10.25:10\r\n  float scale(float fCos){\r\n    float x \x3d 1.0 - fCos;\r\n    return exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"toneMapperConstants"\x3e\x3c![CDATA[\r\n#ifdef HAZE\r\n  const float fOneOverGamma \x3d 1.0;//Gamma \x3d 1.0\r\n#else\r\n  const float fOneOverGamma \x3d 0.454545; // Gamma \x3d 2.2\r\n#endif\r\n  const vec3 v3OneOverGamma \x3d vec3(fOneOverGamma);\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"exponentialToneMapper"\x3e\x3c![CDATA[\r\n  //ToneMapping operators\r\n  vec3 expTM(vec3 inputColor,float exposure){\r\n      return pow(1.0 - exp(inputColor * -exposure), v3OneOverGamma);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"reinhardToneMapper"\x3e\x3c![CDATA[\r\n  vec3 reinhardTM(vec3 inputColor, float exposure){\r\n      vec3 intermediate \x3d inputColor *exposure;\r\n      intermediate /\x3d (1.0+intermediate);\r\n      return pow(intermediate, v3OneOverGamma);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3csnippet name\x3d"HSVColorSpace"\x3e\x3c![CDATA[\r\n//based on http://gamedev.stackexchange.com/a/59808\r\n// Hue in range [0,1] instead of 360\u00b0\r\nvec3 rgb2hsv(vec3 c)\r\n{\r\n    vec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\r\n    vec4 p \x3d mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\r\n    vec4 q \x3d mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\r\n\r\n    float d \x3d q.x - min(q.w, q.y);\r\n    float e \x3d 1.0e-10;\r\n    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\r\n}\r\n\r\nvec3 hsv2rgb(vec3 c)\r\n{\r\n    vec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\r\n    vec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\r\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\r\n}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"atmosphereUniformsConstantsVaryings"\x3e\x3c![CDATA[\r\n\r\n  //Light\r\n  uniform vec3 v3LightDir;      // The direction vector to the light source\r\n  uniform vec3 v3InvWavelength; // 1 / pow(wavelength, 4) for the red, green, and blue channels\r\n  uniform vec3 v3InvWavelengthScaled; //v3InvWavelength * fKr4PI + fKm4PI\r\n\r\n  //Radii\r\n  uniform vec4 v4Radii; // inner, inner^2, outer, outer^2,\r\n\r\n  //Atmosphere\r\n  const float fKrESun \x3d 0.075;        // Kr * ESun \x3d 0.005 * 15.0\r\n  const float fKmESun \x3d 0.015;        // Km * ESun \x3d 0.005 * 15\r\n  //uniform float fScale;         // 1 / (fOuterRadius - fInnerRadius)\r\n  //uniform float fScaleDepth;    // The scale depth (i.e. the altitude at which the atmosphere\'s average density is found)\r\n  //uniform float fScaleOverScaleDepth; // fScale / fScaleDepth\r\n  //uniform float fOneOverScaleDepth; // 1.0 / fScaleDepth\r\n\r\n  //uniform float fScaleDepthBlue;    // The scale depth (i.e. the altitude at which the atmosphere\'s average density is found)\r\n  //uniform float fScaleOverScaleDepthBlue; // fScale / fScaleDepth\r\n  //uniform float fOneOverScaleDepthBlue; // 1.0 / fScaleDepth\r\n\r\n  uniform vec4 v4AtmosParams1; //(fScale,fScaleDepth,fScaleOverScaleDepth,fOneOverScaleDepth)\r\n  uniform vec4 v4AtmosParams2; //(g,fScaleDepthBlue,fScaleOverScaleDepthBlue,fOneOverScaleDepthBlue)\r\n#ifndef HAZE\r\n  uniform vec4 v4AtmosParams3; //(g2,fMiePhaseCoefficients,fLowerAlphaBlendBound,fOneOverOuterRadiusMinusAlphaBlendBound)\r\n  uniform float fInnerFadeDistance;\r\n  uniform float fAltitudeFade;\r\n#endif\r\n\r\n  //Camera\r\n  uniform vec3 v3CameraPos;     // The camera\'s current position\r\n  //uniform float fCameraHeight;  // The camera\'s current height\r\n  //uniform float fCameraHeight2; // fCameraHeight^2\r\n  //uniform float fC; //fCameraHeight2 - fOuterRadius2; // C \x3d ||o-c||^2 - r^2\r\n  //uniform float fCSur; //fCameraHeight2 - (fInnerRadius2 - 63756370000.0); // C \x3d ||o-c||^2 - r^2\r\n  uniform vec4 v4SphereComp; //The camera\'s current height, CameraHeight^2,fC,fCSur\r\n  uniform vec2 nearFar;\r\n\r\n  //Camera HDR\r\n#ifdef HAZE\r\n  const float fExposure \x3d 1.5;\r\n#else\r\n  const float fExposure \x3d 2.0;\r\n#endif\r\n\r\n#ifdef HAZE\r\n  //Depth texture\r\n  uniform sampler2D tDepth;\r\n#endif\r\n\r\n  //Testing variables\r\n  uniform float showTest;\r\n\r\n  //Varyings\r\n  varying vec3 v3EyeDir;\r\n  varying vec3 v3WorldRay;\r\n  varying vec2 vtc;\r\n\r\n  //Loop constants for integral approximation\r\n  const float fSamples \x3d 5.0;\r\n  const int maxSamples \x3d 5;\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3csnippet name\x3d"atmospherePrecomputation"\x3e\x3c![CDATA[\r\n    float fInnerRadius \x3d v4Radii[0];   // The inner (planetary) radius\r\n    float fInnerRadius2 \x3d v4Radii[1];  // fInnerRadius^2\r\n    float fOuterRadius \x3d v4Radii[2];   // The outer (atmosphere) radius\r\n    float fOuterRadius2 \x3d v4Radii[3];  // fOuterRadius^2\r\n\r\n    float fCameraHeight \x3d v4SphereComp[0];\r\n    float fCameraHeight2 \x3d v4SphereComp[1];\r\n    float fC \x3d v4SphereComp[2];\r\n    float fCSur \x3d v4SphereComp[3];\r\n\r\n    vec3 cameraPosition \x3d v3CameraPos;\r\n\r\n    //Debug variables\r\n    vec3 test \x3d vec3(0.0,0.0,0.0);\r\n\r\n    //Obtain ray from Camera\r\n    vec3 worldSpaceRay \x3d normalize(v3WorldRay);\r\n\r\n    //Compute Atmosphere intersection; i.e. ray/sphere intersection\r\n    float B \x3d 2.0 * dot(cameraPosition, worldSpaceRay); // B \x3d 2(l * (o-c))\r\n    float det \x3d B*B - 4.0 * fC; // det \x3d B^2 - 4.0* C\r\n\r\n    //idealized sphere intersection to discard early some pixels\r\n    float detSur \x3d B*B - 4.0 * fCSur; // det \x3d B^2 - 4.0* C\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3csnippet name\x3d"atmosphereDiscardPixels"\x3e\x3c![CDATA[\r\n#ifdef HAZE\r\n      // only use red channel from depth texture.\r\n      // see \'Issues\' at https://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture\r\n      float depthSample \x3d texture2D(tDepth, vtc).r;\r\n\r\n      float zNear \x3d nearFar[0];\r\n      float zFar \x3d nearFar[1];\r\n\r\n      // http://web.archive.org/web/20130416194336/http://olivers.posterous.com/linear-depth-in-glsl-for-real\r\n      float zNorm \x3d 2.0 * depthSample - 1.0;\r\n      float linDepth \x3d 2.0 * zNear * zFar /\r\n        (zFar + zNear - zNorm * (zFar - zNear));\r\n\r\n      float rayEndT;\r\n      float altitudeAlpha \x3d 1.0;\r\n\r\n      // find intersections with ground, but only between the near and far\r\n      // clipping planes.\r\n      if (depthSample \x3c 1.0 \x26\x26 depthSample \x3e 0.0) {\r\n        vec3 cameraSpaceRay \x3d normalize(v3EyeDir);\r\n        cameraSpaceRay /\x3d cameraSpaceRay.z;\r\n        cameraSpaceRay *\x3d linDepth;\r\n\r\n        float cameraSpaceRayLength \x3d length(cameraSpaceRay);\r\n\r\n        vec3 v3World \x3d cameraPosition + worldSpaceRay * cameraSpaceRayLength;\r\n        float v3WorldRadius2 \x3d dot(v3World, v3World);\r\n\r\n        // Handle tall structures:\r\n        // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/5450\r\n        float transitionStart \x3d fInnerRadius + 20000.0;\r\n        float transitionHeight \x3d 25000.0;\r\n        float transitionEnd \x3d transitionStart + transitionHeight;\r\n\r\n        float edge0 \x3d transitionStart * transitionStart;\r\n        float edge1 \x3d transitionEnd * transitionEnd;\r\n\r\n        altitudeAlpha \x3d 1.0 - clamp((v3WorldRadius2 - edge0) / (edge1 - edge0), 0.0, 1.0);\r\n        rayEndT \x3d cameraSpaceRayLength;\r\n\r\n        if (altitudeAlpha \x3e 0.0 \x26\x26 detSur \x3e 0.0) {\r\n          float nearSurfaceT \x3d 0.5 *(-B - sqrt(detSur));\r\n          float interp \x3d clamp(((fCameraHeight - fInnerRadius) - 2000000.0) / 6000000.0, 0.0, 1.0);\r\n          rayEndT \x3d mix(cameraSpaceRayLength, nearSurfaceT, interp);\r\n        }\r\n      }\r\n#endif\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"atmosphereUnpackAddUniforms"\x3e\x3c![CDATA[\r\n        float fScale \x3d v4AtmosParams1.x;\r\n        vec2 v2ScaleDepth \x3d vec2(v4AtmosParams1.y,v4AtmosParams2.y);//fScaleDepth, fScaleDepthBlue\r\n        vec2 v2ScaleOverScaleDepth \x3d vec2(v4AtmosParams1.z,v4AtmosParams2.z);//fScaleOverScaleDepth, fScaleOverScaleDepthBlue\r\n        vec2 v2OneOverScaleDepth \x3d vec2(v4AtmosParams1.w,v4AtmosParams2.w);//fOneOverScaleDepth, fOneOverScaleDepthBlue\r\n\r\n#ifndef HAZE\r\n        float g \x3d v4AtmosParams2.x;\r\n        float g2 \x3d v4AtmosParams3.x;\r\n        float fMiePhaseCoefficients \x3d v4AtmosParams3.y;\r\n        float fLowerAlphaBlendBound \x3d v4AtmosParams3.z;\r\n        float fOneOverOuterRadiusMinusAlphaBlendBound \x3d v4AtmosParams3.w;\r\n#endif\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3csnippet name\x3d"atmosphereComputeRayAndLoopSetup"\x3e\x3c![CDATA[\r\n        float rayStartT \x3d 0.5 *(-B - sqrt(det)); //near intersection with atmosphere\r\n#ifdef HAZE\r\n        float nearT \x3d abs(rayStartT);\r\n        float farT \x3d abs(rayEndT);\r\n#else\r\n        float rayEndT \x3d 0.5 *(-B + sqrt(det)); //far intersection with atmosphere\r\n\r\n#endif\r\n\r\n        float fDistance;//calculate its scattering offset\r\n        // Calculate the ray\'s starting position\r\n        if (rayStartT \x3c fMinRayStart)\r\n        { //ray starts from camera or inner radius sphere to far\r\n          rayStartT \x3d fMinRayStart;\r\n#ifndef HAZE\r\n          // clamp to value at inner radius altitude\r\n          fDistance \x3d fScale * min(0.0, fInnerRadius - fCameraHeight);\r\n#endif\r\n        }\r\n#ifndef HAZE\r\n        else\r\n        {//outside atmosphere\r\n          fDistance \x3d -1.0;\r\n        }\r\n#endif\r\n\r\n        // Initialize the scattering loop variables\r\n        vec3 v3Start \x3d cameraPosition + worldSpaceRay * rayStartT;\r\n\r\n#ifdef HAZE\r\n        vec3 v3End \x3d cameraPosition + worldSpaceRay * rayEndT;\r\n\r\n        float fEndLength \x3d length(v3End);\r\n        float fLocalCameraHeight \x3d length(v3Start);\r\n\r\n        //computed for the original end point to get consistent light angles after possible inversions\r\n        float fLightAngle \x3d dot(v3LightDir, v3End) / fEndLength;\r\n\r\n        if (nearT \x3e farT)\r\n        {\r\n          if (fLocalCameraHeight \x3c fEndLength)\r\n          {\r\n            //Switch positive slopes for flipped rays\r\n            v3End \x3d cameraPosition + worldSpaceRay * rayStartT;\r\n            v3Start \x3d cameraPosition + worldSpaceRay * rayEndT;\r\n            worldSpaceRay *\x3d -1.0;\r\n            fEndLength \x3d length(v3End);\r\n            fLocalCameraHeight \x3d length(v3Start);\r\n          }\r\n          else if (fLocalCameraHeight \x3d\x3d fEndLength)\r\n          {// create minuscule fake slope for integration if the slope is zero\r\n            fLocalCameraHeight +\x3d 1.0; //BUGFIX, if the height of camera and ground is equal the equation breaks, add fake meter to camera height to get\r\n            //slope for the camera function\r\n          }\r\n        }\r\n\r\n        //Calculate its scattering offset\r\n        // Assumes camera constrains of WSV 3.8\r\n        float fCameraDepth;\r\n        float fCameraDepthBlue;\r\n        if (fLocalCameraHeight \x3e fOuterRadius)\r\n        {\r\n          fDistance \x3d fInnerRadius - fOuterRadius;\r\n        } else\r\n        {//outside atmosphere\r\n          fDistance \x3d fEndLength - fLocalCameraHeight;\r\n        }\r\n\r\n#endif\r\n        vec2 v2OpticalStartDepth \x3d exp(fDistance * v2OneOverScaleDepth);\r\n\r\n        float fRayLength \x3d rayEndT - rayStartT;\r\n        float fSampleLength \x3d fRayLength / fSamples;\r\n        float fScaledLength \x3d fSampleLength * fScale;\r\n        vec3 v3SampleRay \x3d worldSpaceRay * fSampleLength;\r\n        vec3 v3SamplePoint \x3d v3Start + v3SampleRay * 0.5;\r\n\r\n#ifdef HAZE\r\n        float fCameraAngle \x3d dot(-worldSpaceRay, v3End) / fEndLength;\r\n        float fScaleCameraAngle \x3d scale(fCameraAngle);\r\n        vec2 v2CameraOffset \x3d fScaleCameraAngle*v2OpticalStartDepth;\r\n\r\n        float scaledValues \x3d scale(fLightAngle) + fScaleCameraAngle;\r\n        vec2 v2ScaledValuesDepth \x3d scaledValues * v2ScaleDepth;\r\n#else\r\n        float fCameraAngle \x3d dot(worldSpaceRay, v3Start / length(v3Start));\r\n        float angleMultiplier \x3d fCameraAngle\x3e0.0?fCameraAngle:0.0;\r\n\r\n        float fScaleCameraAngle \x3d scale(fCameraAngle);\r\n        vec2 v2CameraOffset \x3d fScaleCameraAngle*v2OpticalStartDepth * v2ScaleDepth;\r\n#endif\r\n\r\n        //Loop variables\r\n        vec3 v3FrontColor \x3d vec3(0.0, 0.0, 0.0);\r\n        vec3 v3FrontColorBlue \x3d vec3(0.0, 0.0, 0.0);\r\n        vec3 v3Attenuate\x3d vec3(0.0, 0.0, 0.0);\r\n        vec3 v3AttenuateBlue \x3d vec3(0.0, 0.0, 0.0);\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3csnippet name\x3d"atmosphereComputeSampleContribution"\x3e\x3c![CDATA[\r\n          float fHeight \x3d length(v3SamplePoint);\r\n          vec2 v2Depth \x3d exp(v2ScaleOverScaleDepth * (fInnerRadius - fHeight));\r\n#ifdef HAZE\r\n          vec2 v2Scatter \x3d v2Depth*v2ScaledValuesDepth-v2CameraOffset;\r\n#else\r\n          float fLightAngle \x3d dot(v3LightDir, v3SamplePoint) / fHeight;\r\n          float fCameraAngle \x3d dot(worldSpaceRay, v3SamplePoint) / fHeight;\r\n          float fTempScaledValues \x3d scale(fLightAngle) - scale(fCameraAngle);\r\n          vec2 v2Scatter \x3d v2CameraOffset + fTempScaledValues*v2Depth* v2ScaleDepth;\r\n#endif\r\n          v3Attenuate \x3d exp(-v2Scatter.x * v3InvWavelengthScaled);\r\n          v3AttenuateBlue \x3d exp(-v2Scatter.y * v3InvWavelengthScaled);\r\n\r\n          v3FrontColor +\x3d v3Attenuate * v2Depth.x;\r\n          v3FrontColorBlue +\x3d v3AttenuateBlue * v2Depth.y;\r\n\r\n          v3SamplePoint +\x3d v3SampleRay;\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3csnippet name\x3d"atmosphereComputeHDRColors"\x3e\x3c![CDATA[\r\n        //Phase computation\r\n        //clamp to avoid numerical instability at fCos \x3d\x3d -1.0 (and close values) to display fake sun\r\n        float fCos \x3d clamp(dot(v3LightDir, -worldSpaceRay ),-0.9999999,1.0);\r\n        float fOnePlusCos2 \x3d fCos*fCos + 1.0;\r\n#ifdef HAZE\r\n        // Finally, scale the Rayleigh colors and set up the varying variables for the pixel shader\r\n        vec3 colorCoefficients \x3d (fScaledLength* 0.75 * fOnePlusCos2)*(fKrESun*v3InvWavelength+fKmESun);\r\n\r\n        //Scaled Length is only applied afterwards to save multiplications\r\n        vec3 v3Color \x3d colorCoefficients *v3FrontColor;\r\n        vec3 v3ColorBlue \x3d colorCoefficients *v3FrontColorBlue;\r\n#else\r\n        vec3 v3RayleighCoefficients \x3d (fScaledLength*0.75 * fOnePlusCos2*fKrESun)*v3InvWavelength;\r\n        float fMieCoefficients \x3d fScaledLength*fKmESun * fMiePhaseCoefficients * fOnePlusCos2 / pow(1.0 + g2 - 2.0*g*fCos, 1.5);\r\n\r\n        // Calculate the attenuation factor for the ground\r\n        vec3 v3Color \x3d v3RayleighCoefficients * v3FrontColor + fMieCoefficients * v3FrontColor;\r\n        vec3 v3ColorBlue \x3d v3RayleighCoefficients * v3FrontColorBlue + fMieCoefficients * v3FrontColorBlue;\r\n#endif\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3csnippet name\x3d"atmosphereComputePixelColor"\x3e\x3c![CDATA[\r\n\r\n\r\n        //HDR to LDR conversion\r\n        vec3 ldrBlue \x3d expTM(v3ColorBlue,2.0*fExposure);\r\n        vec3 ldrRed \x3d expTM(v3Color,fExposure);\r\n\r\n        //mix reddish and blueish atmosphere\r\n        vec3 LDR \x3d mix(ldrBlue,ldrRed,0.2);\r\n#ifdef HAZE\r\n        LDR *\x3d (1.0-fCameraAngle);\r\n        vec3 hsv \x3d rgb2hsv(LDR);\r\n        hsv.y \x3d clamp(hsv.y*1.5,0.0,1.0);//boost haze saturation by 50%\r\n        LDR \x3d hsv2rgb(hsv);\r\n        vec3 finalColor \x3d LDR;\r\n        // when rendering we specify the blend functions such that\r\n        // newDestColor \x3d oldDestColor*(1.0-finalColor) + finalColor\r\n#else\r\n        //reinhard tonemapper for looking upwards\r\n        vec3 ldrReinhard \x3d reinhardTM(v3Color,fExposure);\r\n        LDR +\x3d angleMultiplier*ldrReinhard;\r\n\r\n        //height dependent parameter to smooth out reddish atmosphere\r\n        float side \x3d (rayEndT+rayStartT)*0.5;\r\n        float atmoHeight \x3d sqrt(fCameraHeight2 - side*side);\r\n        float h2 \x3d clamp(1.0-(atmoHeight-fLowerAlphaBlendBound)/(fOuterRadius-fLowerAlphaBlendBound),0.0,1.0);\r\n\r\n        vec3 finalColor \x3d LDR*h2;\r\n        vec3 hsv \x3d rgb2hsv(finalColor);\r\n        hsv.y \x3d clamp(hsv.y*1.5,0.0,1.0);//boost sky saturation by 50%\r\n        finalColor \x3d hsv2rgb(hsv);\r\n#endif\r\n#ifndef HAZE\r\n        float atmosStrength \x3d clamp((length(ldrRed)-0.05)*1.05,0.0,1.0);\r\n        gl_FragColor \x3d vec4(finalColor, atmosStrength*clamp(1.0-(atmoHeight-fInnerRadius)/(fOuterRadius-fInnerRadius),0.0,1.0));\r\n#else\r\n        gl_FragColor \x3d vec4(finalColor, 1.0) * altitudeAlpha;\r\n#endif\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c!--Fragment Shader for Atmosphere--\x3e\r\n\x3csnippet name\x3d"fsRealisticAtmosphere"\x3e\x3c![CDATA[\r\n\r\n  $fsprecisionf\r\n\r\n$atmosphereUniformsConstantsVaryings\r\n\r\n$atmosphereScaleFunction\r\n\r\n  //Conversion implementation found in util.xml\r\n$rgba2float\r\n\r\n\r\n$toneMapperConstants\r\n$exponentialToneMapper\r\n#ifndef HAZE\r\n$reinhardToneMapper\r\n#endif\r\n\r\n$HSVColorSpace\r\n\r\n  void main()\r\n  {\r\n\r\n    $atmospherePrecomputation\r\n\r\n    // the minimal sample start position:\r\n    // at the camera by default, on the earth radius surface if the camera is underground.\r\n    float fMinRayStart \x3d 0.0;\r\n#ifndef HAZE\r\n    // When the ray intersects the earth surface, fade the sky to a simple light direction\r\n    // based color. This is used to make sure we have a white background in underground\r\n    // mode (at noon).\r\n    float fSurfaceBlend \x3d 0.0;\r\n    vec4 surfaceColor \x3d vec4(0.0);\r\n    if (detSur \x3e\x3d 0.0) {\r\n      float nearSurfaceT \x3d max(0.0, 0.5 *(-B - sqrt(detSur)));\r\n      float farSurfaceT \x3d max(0.0, 0.5 *(-B + sqrt(detSur)));\r\n\r\n      if (nearSurfaceT \x3d\x3d 0.0) {\r\n        fMinRayStart \x3d farSurfaceT;\r\n      }\r\n\r\n      // Compute lighting at the point where the ray enters the earth surface\r\n      // Lighting computation is copied from the terrain shader.\r\n      vec3 vPos \x3d cameraPosition + worldSpaceRay * nearSurfaceT;\r\n      float fLightAngle \x3d dot(v3LightDir, normalize(vPos));\r\n      float fBrightness \x3d max(0.0, (smoothstep(-1.0, 0.8, 2.0 * fLightAngle)));\r\n\r\n      // Make the surface transparent based on altitude\r\n      surfaceColor \x3d vec4(fBrightness, fBrightness, fBrightness, 1.0 - fAltitudeFade);\r\n\r\n      // Fade based on the distance the ray travels below the earth surface\r\n      float fRelDist \x3d (farSurfaceT - nearSurfaceT) / fInnerFadeDistance;\r\n\r\n      // early exit\r\n      if (fRelDist \x3e 1.0) {\r\n        gl_FragColor \x3d surfaceColor;\r\n        return;\r\n      }\r\n\r\n      fSurfaceBlend \x3d smoothstep(0.0, 1.0, fRelDist * fRelDist);\r\n    }\r\n#endif\r\n\r\n    //Inside Atmosphere\r\n    if (det \x3e\x3d 0.0) {\r\n#ifdef HAZE\r\n      $atmosphereDiscardPixels\r\n#endif\r\n      $atmosphereUnpackAddUniforms\r\n\r\n      $atmosphereComputeRayAndLoopSetup\r\n\r\n      // Now loop through the sample rays\r\n      for(int i\x3d0; i\x3cmaxSamples; i++)\r\n      {\r\n        $atmosphereComputeSampleContribution\r\n      }\r\n\r\n      $atmosphereComputeHDRColors\r\n\r\n      $atmosphereComputePixelColor\r\n\r\n#ifndef HAZE\r\n      if (fSurfaceBlend \x3e 0.0) {\r\n        gl_FragColor \x3d mix(gl_FragColor, surfaceColor, fSurfaceBlend);\r\n      }\r\n#endif\r\n\r\n      //Debug variable overlay\r\n      if(showTest\x3e0.0){\r\n        gl_FragColor \x3d vec4(test,1.0);\r\n      }\r\n    } else {//Outside Atmosphere\r\n      gl_FragColor \x3d vec4(0.0);\r\n    }\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/environment/materials/StarMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderStar"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n\tuniform mat4 model;\r\n\tuniform vec4 viewport;\r\n\r\n\tattribute vec3 $position;\r\n\tattribute vec4 $color;\r\n  attribute float $size;\r\n\r\n\tvarying vec4 vcolor;\r\n\tvarying float vsize;\r\n\r\n\t$alignToPixelCenter\r\n\r\n\tvoid main(void) {\r\n\t\tvec4 posProj \x3d proj * view * model*vec4($position*1.0e25,1.0);//move infinitely far away\r\n\t\tgl_Position \x3d alignToPixelCenter(posProj, viewport.zw); //pixel align position\r\n    gl_Position.z \x3d gl_Position.w; // project atmosphere onto the far plane\r\n\t\tvcolor \x3d $color/1.2;\r\n\t\tvsize \x3d size*5.0;\r\n\t\tgl_PointSize \x3d vsize;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderStar"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tvarying vec4 vcolor;\r\n\tvarying float vsize;\r\n\r\n\tvoid main() {\r\n\t\tfloat cap \x3d 0.7;\r\n\t\tfloat scale \x3d 1.0/cap;\r\n\t\tfloat helper \x3d clamp(length(abs(gl_PointCoord-vec2(0.5))),0.0,cap);\r\n\t\tfloat alpha \x3d clamp((cap-helper)*scale,0.0,1.0);\r\n\t\tfloat intensity \x3d alpha*alpha*alpha;\r\n\t\tif (vsize \x3c 3.0)\r\n\t\t\tintensity *\x3d 0.5;\r\n\t\tgl_FragColor \x3d vec4(1.0,1.0,1.0,intensity);\r\n\t\tgl_FragColor.xyz *\x3d vcolor.xyz;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vsRibbonEdgeStyleOutputs"\x3e\x3c![CDATA[\r\n#if defined(SKETCH) || defined(UBER)\r\n\r\n  uniform vec2 uStrokesTextureScale;\r\n  uniform float uStrokesLog2Resolution;\r\n  uniform float uStrokeVariants;\r\n\r\n  varying vec2 vStrokeUV;\r\n  varying float vLineIndex;\r\n\r\n  void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {\r\n    vec2 sidenessNorm \x3d unpackedAttributes.sidenessNorm;\r\n\r\n    float lineIndex \x3d clamp(ceil(log2(lineLength)), 0.0, uStrokesLog2Resolution);\r\n\r\n    vStrokeUV \x3d vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * uStrokeVariants + aVariantStroke + 0.5) * uStrokesTextureScale;\r\n    vStrokeUV.x +\x3d aVariantOffset;\r\n\r\n    vLineIndex \x3d lineIndex;\r\n  }\r\n#endif /* SKETCH || UBER */\r\n\r\n#if defined(SKETCH)\r\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\r\n    calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\r\n  }\r\n#elif defined(SOLID)\r\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\r\n  }\r\n#elif defined(UBER)\r\n  varying float vType;\r\n\r\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\r\n    vType \x3d unpackedAttributes.type;\r\n\r\n    if (unpackedAttributes.type \x3c\x3d 0.0) {\r\n      calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\r\n    }\r\n  }\r\n#endif /* UBER */\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsRibbonEdgeLineAmplitudeRegular"\x3e\x3c![CDATA[\r\n\r\n#if defined(UBER) || !defined(SKETCH)\r\n\r\n  float calculateLineAmplitudeRegular() {\r\n    return 0.0;\r\n  }\r\n\r\n#endif /* UBER || !SKETCH */\r\n\r\n#if !defined(UBER) \x26\x26 !defined(SKETCH)\r\n\r\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\r\n    return calculateLineAmplitudeRegular();\r\n  }\r\n\r\n#endif /* !UBER \x26\x26 !SKETCH */\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsRibbonEdgeLineAmplitudeSketch"\x3e\x3c![CDATA[\r\n\r\n#if defined(UBER) || defined(SKETCH)\r\n\r\n  uniform float uStrokesAmplitude;\r\n\r\n  float calculateLineAmplitudeSketch() {\r\n    return uStrokesAmplitude;\r\n  }\r\n\r\n#endif /* UBER || SKETCH */\r\n\r\n#ifdef SKETCH\r\n\r\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\r\n    return calculateLineAmplitudeSketch();\r\n  }\r\n\r\n#endif /* SKETCH */\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsRibbonEdgeLineAmplitudeUber"\x3e\x3c![CDATA[\r\n\r\n#ifdef UBER\r\n\r\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\r\n    float type \x3d unpackedAttributes.type;\r\n\r\n    if (type \x3c\x3d 0.0) {\r\n      return calculateLineAmplitudeSketch();\r\n    }\r\n    else {\r\n      return calculateLineAmplitudeRegular();\r\n    }\r\n  }\r\n\r\n#endif /* UBER */\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsRibbonEdge"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  // Transformations\r\n  uniform mat4 uProj;\r\n  uniform mat4 uView;\r\n  uniform mat4 uModel;\r\n  uniform vec3 uCameraPosition;\r\n\r\n  // Line configuration\r\n\r\n  // Conversion constants\r\n  uniform vec2 uPixelToNDC;\r\n  uniform vec2 uNDCToPixel;\r\n\r\n  // Inputs\r\n  attribute vec3 aPosition0;\r\n  attribute vec3 aPosition1;\r\n  attribute float aVariantOffset;\r\n  attribute float aVariantStroke;\r\n  attribute float aVariantExtension;\r\n\r\n#ifdef SILHOUETTE\r\n\r\n  attribute vec3 aNormalA;\r\n  attribute vec3 aNormalB;\r\n\r\n#else /* SILHOUETTE */\r\n\r\n  attribute vec3 aNormal;\r\n\r\n#endif /* SILHOUETTE */\r\n\r\nattribute vec2 aSideness;\r\nattribute vec2 aPackedAttributes;\r\n\r\nstruct UnpackedAttributes {\r\n  vec2 sideness;\r\n  vec2 sidenessNorm;\r\n  float lineWidthPixels;\r\n  float extensionLengthPixels;\r\n\r\n#ifdef UBER\r\n\r\n  float type;\r\n\r\n#endif\r\n};\r\n\r\n  // Output required to compute color\r\n  varying vec4 vColor;\r\n\r\n  // Output required to compute distance to line/caps\r\n  varying vec3 vPosition;\r\n  varying float vRadius;\r\n  varying float vLineLengthPixels;\r\n  varying float vSizeFalloffFactor;\r\n\r\n  $EdgeRendererUtils_adjustProjectedPosition\r\n\r\n  $vsRibbonEdgeStyleOutputs\r\n\r\n  $vsRibbonEdgeLineAmplitudeRegular\r\n  $vsRibbonEdgeLineAmplitudeSketch\r\n  $vsRibbonEdgeLineAmplitudeUber\r\n\r\n  $EdgeRendererUtils_readComponentData\r\n  $EdgeRendererUtils_distanceBasedPerspectiveFactor\r\n  $EdgeRendererUtils_worldNormal\r\n  $EdgeRendererUtils_extensionFalloff\r\n\r\n#ifdef SILHOUETTE\r\n\r\n  $EdgeRendererUtils_isSilhouetteEdge\r\n\r\n#endif /* SILHOUETTE */\r\n\r\n  vec4 calculateGeometricOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\r\n    vec2 sideness \x3d unpackedAttributes.sideness;\r\n    vec2 sidenessNorm \x3d unpackedAttributes.sidenessNorm;\r\n\r\n    vec4 viewPos \x3d mix(viewPosV0, viewPosV1, sidenessNorm.y);\r\n    vec4 projPosV0 \x3d uProj * viewPosV0;\r\n    vec4 projPosV1 \x3d uProj * viewPosV1;\r\n    vec4 projPos \x3d uProj * viewPos;\r\n\r\n    vec3 screenSpaceLineNDC \x3d (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);\r\n    vec2 screenSpaceLinePixels \x3d screenSpaceLineNDC.xy * uNDCToPixel;\r\n    float lineLengthPixels \x3d length(screenSpaceLinePixels);\r\n\r\n    float dzPerPixel \x3d screenSpaceLineNDC.z / lineLengthPixels;\r\n    vec2 screenSpaceDirection \x3d screenSpaceLinePixels / lineLengthPixels;\r\n    vec2 perpendicularScreenSpaceDirection \x3d vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;\r\n\r\n    float falloffFactor \x3d distanceBasedPerspectiveFactor(-viewPos.z);\r\n    float lineWidthPixels \x3d unpackedAttributes.lineWidthPixels * falloffFactor;\r\n\r\n    float extensionLengthPixels \x3d calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;\r\n    float lineAmplitudePixels \x3d calculateLineAmplitude(unpackedAttributes);\r\n\r\n    vSizeFalloffFactor \x3d falloffFactor;\r\n\r\n    float lineWidthAndAmplitudePixels \x3d lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;\r\n    float extendedLineLengthPixels \x3d lineLengthPixels + extensionLengthPixels + extensionLengthPixels;\r\n\r\n#ifdef ANTIALIASING\r\n\r\n    const float aaPaddingPixels \x3d 1.0;\r\n\r\n    // Line size with padding\r\n    float halfAAPaddedLineWidthAndAmplitudePixels \x3d lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;\r\n    float aaPaddedRoundedCapSizePixels \x3d lineWidthPixels * 0.5 + aaPaddingPixels;\r\n\r\n    // Line length with padding\r\n    float aaPaddedLineLengthPixels \x3d extendedLineLengthPixels + aaPaddingPixels + aaPaddingPixels;\r\n    float halfAAPaddedLineLengthPixels \x3d aaPaddedLineLengthPixels * 0.5;\r\n\r\n#else /* ANTIALIASING */\r\n\r\n    // Even if there is no AA, we still want to do proper \x3c1px rendering,\r\n    // so we effectively clamp the pixel sizes to minimum of 1px and compute\r\n    // coverage in the fragment shader\r\n    float halfAAPaddedLineWidthAndAmplitudePixels \x3d max(lineWidthAndAmplitudePixels, 1.0) * 0.5;\r\n    float aaPaddedRoundedCapSizePixels \x3d max(lineWidthPixels, 1.0) * 0.5;\r\n\r\n    float halfAAPaddedLineLengthPixels \x3d max(extendedLineLengthPixels, 1.0) * 0.5;\r\n\r\n#endif /* ANTIALIASING */\r\n\r\n    // Half line width in NDC including padding for anti aliasing\r\n    vec2 halfAAPaddedLineWidthAndAmplitudeNDC \x3d halfAAPaddedLineWidthAndAmplitudePixels * uPixelToNDC;\r\n    vec2 aaPaddedRoundedCapSizeNDC \x3d aaPaddedRoundedCapSizePixels * uPixelToNDC;\r\n    vec2 extensionLengthNDC \x3d extensionLengthPixels * uPixelToNDC;\r\n\r\n    // Compute screen space position of vertex, offsetting for line size and end caps\r\n    vec2 ndcOffset \x3d (\r\n        screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)\r\n      + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC\r\n    );\r\n\r\n    projPos.xy +\x3d ndcOffset * projPos.w;\r\n    projPos.z +\x3d (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;\r\n\r\n    projPos \x3d adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));\r\n\r\n    // Line length with end caps\r\n    float aaPaddedLineWithCapsLengthPixels \x3d extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;\r\n\r\n    float pixelPositionAlongLine \x3d aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;\r\n\r\n    // Position in pixels with origin at first vertex of line segment\r\n    vPosition \x3d vec3(\r\n      halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,\r\n      pixelPositionAlongLine,\r\n      pixelPositionAlongLine / extendedLineLengthPixels\r\n    );\r\n\r\n    // The line width radius in pixels\r\n    vRadius \x3d lineWidthPixels * 0.5;\r\n    vLineLengthPixels \x3d extendedLineLengthPixels;\r\n\r\n#ifdef SILHOUETTE\r\n\r\n    gl_Position \x3d isSilhouetteEdge(viewPosV0, aNormalA, aNormalB) ? projPos : vec4(10, 10, 10, 1);\r\n\r\n#else /* SILHOUETTE */\r\n\r\n    gl_Position \x3d projPos;\r\n\r\n#endif /* SILHOUETTE */\r\n\r\n#ifdef UBER\r\n\r\n    if (unpackedAttributes.type \x3c\x3d 0.0 \x26\x26 lineLengthPixels \x3c\x3d 3.0) {\r\n      gl_Position \x3d vec4(10, 10, 10, 1);\r\n    }\r\n\r\n#elif defined(SKETCH)\r\n\r\n    if (lineLengthPixels \x3c\x3d 3.0) {\r\n      gl_Position \x3d vec4(10, 10, 10, 1);\r\n    }\r\n\r\n#endif\r\n\r\n    return projPos;\r\n  }\r\n\r\n#ifdef UBER\r\n\r\n  UnpackedAttributes unpackAttributes(ComponentData component) {\r\n\r\n    vec2 sidenessNorm \x3d aSideness;\r\n    vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\r\n\r\n    float fType \x3d component.type;\r\n    float extensionLengthPixels \x3d component.extensionLength;\r\n    float lineWidth \x3d component.lineWidth;\r\n\r\n    if (fType \x3c\x3d 0.0) {\r\n      extensionLengthPixels *\x3d aVariantExtension * 2.0 - 1.0;\r\n    }\r\n\r\n    return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);\r\n  }\r\n\r\n#else /* UBER */\r\n\r\n  UnpackedAttributes unpackAttributes(ComponentData component) {\r\n    vec2 sidenessNorm \x3d aSideness;\r\n    vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\r\n    float extensionLengthPixels \x3d component.extensionLength;\r\n\r\n#ifdef SKETCH\r\n\r\n    extensionLengthPixels *\x3d aVariantExtension * 2.0 - 1.0;\r\n\r\n#endif /* SKETCH */\r\n\r\n    float lineWidth \x3d component.lineWidth;\r\n\r\n    return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);\r\n  }\r\n\r\n#endif /* UBER */\r\n\r\n  void main() {\r\n    ComponentData component \x3d readComponentData();\r\n    UnpackedAttributes unpackedAttributes \x3d unpackAttributes(component);\r\n\r\n    vec4 worldPosV0 \x3d uModel * vec4(aPosition0, 1.0);\r\n    vec4 worldPosV1 \x3d uModel * vec4(aPosition1, 1.0);\r\n\r\n    vec4 viewPosV0 \x3d uView * worldPosV0;\r\n    vec4 viewPosV1 \x3d uView * worldPosV1;\r\n\r\n#ifdef SILHOUETTE\r\n\r\n    vec3 worldNormal \x3d silhouetteWorldNormal(aNormalA, aNormalB);\r\n\r\n#else /* SILHOUETTE */\r\n\r\n    vec3 worldNormal \x3d modelToWorldNormal(aNormal);\r\n\r\n#endif /* SILHOUETTE */\r\n\r\n    // General geometric computation for all types of edges\r\n    vec4 projPos \x3d calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal, unpackedAttributes);\r\n\r\n    // Component color\r\n    vColor \x3d component.color;\r\n\r\n    // Specific computation for different edge styles\r\n    calculateStyleOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, projPos, worldNormal, unpackedAttributes);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsRibbonEdgeLineOffsetSketch"\x3e\x3c![CDATA[\r\n\r\n$rgba2float\r\n\r\n#if defined(UBER) || defined(SKETCH)\r\n\r\n  uniform sampler2D uStrokesTexture;\r\n  uniform float uStrokesNormalizationScale;\r\n\r\n  varying vec2 vStrokeUV;\r\n\r\n  float calculateLineOffsetSketch() {\r\n    float offsetNorm \x3d rgba2float(texture2D(uStrokesTexture, vStrokeUV));\r\n    return (offsetNorm - 0.5) * uStrokesNormalizationScale;\r\n  }\r\n\r\n  float calculateLinePressureSketch() {\r\n    return rgba2float(texture2D(uStrokesTexture, vStrokeUV + vec2(0, 0.5)));\r\n  }\r\n\r\n#endif /* UBER || SKETCH */\r\n\r\n#ifdef SKETCH\r\n\r\n  float calculateLineOffset() {\r\n    return calculateLineOffsetSketch();\r\n  }\r\n\r\n  float calculateLinePressure() {\r\n    return calculateLinePressureSketch();\r\n  }\r\n\r\n#endif /* SKETCH */\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsRibbonEdgeLineOffsetRegular"\x3e\x3c![CDATA[\r\n\r\n#if defined(UBER) || !defined(SKETCH)\r\n\r\n  float calculateLineOffsetRegular() {\r\n    return 0.0;\r\n  }\r\n\r\n  float calculateLinePressureRegular() {\r\n    return 1.0;\r\n  }\r\n\r\n#endif /* UBER || !SKETCH */\r\n\r\n#if !defined(UBER) \x26\x26 !defined(SKETCH)\r\n\r\n  float calculateLineOffset() {\r\n    return calculateLineOffsetRegular();\r\n  }\r\n\r\n  float calculateLinePressure() {\r\n    return calculateLinePressureRegular();\r\n  }\r\n\r\n#endif /* !UBER || !SKETCH */\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsRibbonEdgeLineOffsetUber"\x3e\x3c![CDATA[\r\n\r\n#ifdef UBER\r\n  varying float vType;\r\n\r\n  float calculateLineOffset() {\r\n    if (vType \x3c\x3d 0.0) {\r\n      return calculateLineOffsetSketch();\r\n    }\r\n    else {\r\n      return calculateLineOffsetRegular();\r\n    }\r\n  }\r\n\r\n  float calculateLinePressure() {\r\n    if (vType \x3c\x3d 0.0) {\r\n      return calculateLinePressureSketch();\r\n    }\r\n    else {\r\n      return calculateLinePressureRegular();\r\n    }\r\n  }\r\n#endif /* UBER */\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsRibbonEdge"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  varying vec4 vColor;\r\n  varying float vRadius;\r\n  varying vec3 vPosition;\r\n  varying float vLineLengthPixels;\r\n  varying float vSizeFalloffFactor;\r\n  varying float vLineIndex;\r\n\r\n  // At which coverage threshold we discard a fragment completely\r\n  #define COVERAGE_TEST_THRESHOLD 0.01\r\n\r\n  $fsRibbonEdgeLineOffsetRegular\r\n  $fsRibbonEdgeLineOffsetSketch\r\n  $fsRibbonEdgeLineOffsetUber\r\n\r\n  vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {\r\n    float lineOffset \x3d calculateLineOffset();\r\n    float positionX \x3d position.x - lineOffset;\r\n\r\n    if (radius \x3c 1.0) {\r\n      // Handle this specifically for subpixel sizes:\r\n      // 1. Compute correct coverage (note coverage is computed by\r\n      //    0.5 - dist, so we make sure that that will lead to correct\r\n      //    subpixel coverage\r\n      // 2. Ignore rounded caps\r\n      float coverageX \x3d clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);\r\n      float coverageY \x3d clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);\r\n\r\n      float coverage \x3d min(coverageX, coverageY);\r\n\r\n      return vec2(0.5 - coverage, 0.0);\r\n    }\r\n    else {\r\n      // Between -radius -\x3e 0 for start cap, 0 for line, 0 -\x3e radius\r\n      float positionOnCap \x3d position.y - clamp(position.y, 0.0, lineLength);\r\n\r\n      vec2 lineToPosition \x3d vec2(positionX, positionOnCap);\r\n      return vec2(length(lineToPosition) - radius, positionOnCap / radius);\r\n    }\r\n  }\r\n\r\n  void main() {\r\n\r\n    float radius \x3d vRadius * calculateLinePressure();\r\n\r\n    vec2 distance \x3d lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);\r\n    float coverage \x3d clamp(0.5 - distance.x, 0.0, 1.0);\r\n\r\n#ifdef ANTIALIASING\r\n\r\n    const float coverageLimit \x3d COVERAGE_TEST_THRESHOLD;\r\n\r\n#else /* ANTIALIASING */\r\n\r\n    // Use subpixel coverage computation when lines get subpixel widths\r\n    // so we still render them appropriately. Otherwise discard anything\r\n    // that is not fully within the line\r\n    float coverageLimit \x3d radius \x3c\x3d 0.5 ? COVERAGE_TEST_THRESHOLD : 0.75;\r\n\r\n#endif /* ANTIALIASING */\r\n\r\n    if (coverage \x3c coverageLimit) {\r\n      discard;\r\n    }\r\n\r\n    float alpha \x3d vColor.a * coverage;\r\n\r\n    gl_FragColor \x3d vec4(vColor.rgb, alpha);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRendererUtils.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"EdgeRendererUtils_distanceBasedPerspectiveFactor"\x3e\x3c![CDATA[\r\n  uniform float uDistanceFalloffFactor;\r\n\r\n  float distanceBasedPerspectiveFactor(float distance) {\r\n    return clamp(sqrt(uDistanceFalloffFactor / distance), 0.0, 1.0);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"EdgeRendererUtils_readComponentData"\x3e\x3c![CDATA[\r\n  uniform sampler2D uComponentDataTex;\r\n  uniform vec2 uComponentDataTexInvDim;\r\n\r\n  attribute float aComponentIndex;\r\n\r\n  #define COMPONENT_COLOR_FIELD_OFFSET 0.0\r\n  #define COMPONENT_OTHER_FIELDS_OFFSET 1.0\r\n  #define COMPONENT_FIELD_COUNT 2.0\r\n\r\n  #define LINE_WIDTH_FRACTION_FACTOR 8.0\r\n  #define EXTENSION_LENGTH_OFFSET 128.0\r\n\r\n  #define COMPONENT_TEX_WIDTH 4096.0\r\n\r\n  vec2 componentTextureCoords(float componentIndex, float fieldOffset) {\r\n    float fieldIndex \x3d COMPONENT_FIELD_COUNT * componentIndex + fieldOffset;\r\n\r\n    float rowIndex \x3d floor(fieldIndex / COMPONENT_TEX_WIDTH);\r\n    float colIndex \x3d mod(fieldIndex, COMPONENT_TEX_WIDTH);\r\n\r\n    vec2 linearIndex \x3d vec2(\r\n      (colIndex + 0.5) / COMPONENT_TEX_WIDTH,\r\n      (rowIndex + 0.5) * uComponentDataTexInvDim.y\r\n    );\r\n\r\n    return linearIndex;\r\n  }\r\n\r\n  struct ComponentData {\r\n    vec4 color;\r\n    float lineWidth;\r\n    float extensionLength;\r\n    float type;\r\n  };\r\n\r\n  ComponentData readComponentData() {\r\n    vec2 colorIndex \x3d componentTextureCoords(aComponentIndex, COMPONENT_COLOR_FIELD_OFFSET);\r\n    vec2 otherIndex \x3d componentTextureCoords(aComponentIndex, COMPONENT_OTHER_FIELDS_OFFSET);\r\n\r\n    vec4 colorValue \x3d texture2D(uComponentDataTex, colorIndex);\r\n    vec4 otherValue \x3d texture2D(uComponentDataTex, otherIndex);\r\n\r\n    return ComponentData(\r\n      vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity\r\n      otherValue.x * (255.0 / LINE_WIDTH_FRACTION_FACTOR),\r\n      otherValue.y * 255.0 - EXTENSION_LENGTH_OFFSET,\r\n      -(otherValue.z * 255.0) + 0.5 // SOLID (\x3d0/255) needs to be \x3e 0.0, SKETCHY (\x3d1/255) needs to be \x3c\x3d 0;\r\n    );\r\n  }\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"EdgeRendererUtils_isSilhouetteEdge"\x3e\x3c![CDATA[\r\n  // #uniforms: uView, uModel\r\n  bool isSilhouetteEdge(vec4 viewPos, vec3 normalA, vec3 normalB) {\r\n    // transform the two face normals\r\n    vec3 viewNormalA \x3d (uView * uModel * vec4(normalA, 0.0)).xyz;\r\n    vec3 viewNormalB \x3d (uView * uModel * vec4(normalB, 0.0)).xyz;\r\n\r\n    // compute the direction from the edge to the camera\r\n    vec3 viewDir \x3d -viewPos.xyz;\r\n\r\n    // check which of the two faces are visible\r\n    // display the edge if exactly one of the two is visible\r\n    float faceAVisible \x3d dot(viewDir, viewNormalA); // positive if visible\r\n    float faceBVisible \x3d dot(viewDir, viewNormalB); // positive if visible\r\n\r\n    // 1 if exactly one face visible, 0 otherwise\r\n    return faceAVisible * faceBVisible \x3c 0.0;\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"EdgeRendererUtils_adjustProjectedPosition"\x3e\x3c![CDATA[\r\n  uniform vec2 uDepthBias;\r\n  uniform vec2 uViewportDimInv;\r\n\r\n  // Utility function to check for NaN values\r\n  bool isNaN(float val) {\r\n    return ( val \x3c 0.0 || 0.0 \x3c val || val \x3d\x3d 0.0 ) ? false : true;\r\n    // important: some nVidias failed to cope with version below.\r\n    // Probably wrong optimization.\r\n    /*return ( val \x3c\x3d 0.0 || 0.0 \x3c\x3d val ) ? false : true;*/\r\n  }\r\n\r\n  // An offset in xy screen space, along the projected normal of the edge\r\n  // This reduces depth fighting when looking at a face from a flat angle\r\n  vec2 calculateProjectedBiasXY(vec4 projPos, vec3 worldNormal) {\r\n    float offsetXY \x3d uDepthBias.x;\r\n    float offsetZ  \x3d uDepthBias.y;\r\n\r\n    // screen space pixel offset\r\n    // we multiply by two to account for the fact that NDC go from -1 to 1\r\n    // we multiply by projPos.w to compensate for the perspective divison that happens later\r\n    // normalizing over xyz means that the xy influence is reduced the more the normal is pointing\r\n    // towards the camera\r\n    vec4 projNormal \x3d uProj * uView * vec4(worldNormal, 0.0);\r\n\r\n    return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;\r\n  }\r\n\r\n  // A z-offset, using a depth based heuristic.\r\n  float calculateProjectedBiasZ(vec4 projPos) {\r\n    float offsetZ \x3d uDepthBias.y;\r\n    return sqrt(projPos.z) * offsetZ;\r\n  }\r\n\r\n  vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {\r\n    vec2 offsetXY \x3d calculateProjectedBiasXY(projPos, worldNormal);\r\n\r\n    // we currently have to do this check because some geometries come with 0 length edge normals.\r\n    // see https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12890\r\n    if (!isNaN(offsetXY.x) \x26\x26 !isNaN(offsetXY.y)) {\r\n      projPos.xy +\x3d offsetXY;\r\n    }\r\n\r\n    projPos.z +\x3d calculateProjectedBiasZ(projPos);\r\n\r\n    return projPos;\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"EdgeRendererUtils_worldNormal"\x3e\x3c![CDATA[\r\n  vec3 modelToWorldNormal(vec3 normal) {\r\n    return (uModel * vec4(normal, 0)).xyz;\r\n  }\r\n\r\n  vec3 silhouetteWorldNormal(vec3 normalA, vec3 normalB) {\r\n    return modelToWorldNormal(normalize(normalA + normalB));\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"EdgeRendererUtils_extensionFalloff"\x3e\x3c![CDATA[\r\n  // Fall-off extension length for shorter strokes, starting from strokes that are 256 size,\r\n  // fall-off exponentially\r\n  float calculateExtensionLength(float extensionLength, float lineLength) {\r\n    return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/HUDMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderHUD"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  $commonAttributesAndUniformsHUD\r\n\r\n  uniform float pixelRatio;\r\n  uniform vec2 screenOffset;\r\n  uniform vec2 anchorPos;\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n  uniform vec4 screenSizePerspective;\r\n\r\n#endif\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\n  varying vec3 debugBorderCoords;\r\n#endif\r\n\r\n  attribute vec2 $uv0;\r\n  attribute vec4 $color;\r\n  attribute vec2 $size;\r\n  attribute vec4 $auxpos2;\r\n\r\n  varying vec4 vcolor;\r\n\r\n  varying vec2 vtc;\r\n  varying vec2 vsize;\r\n\r\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\r\n  varying float voccluded;\r\n#endif\r\n\r\n  $vvUniforms\r\n\r\n  $alignToPixelCenter\r\n  $alignToPixelOrigin\r\n  $projectPositionHUD\r\n  $vvFunctions\r\n\r\n  void main(void) {\r\n    ProjectHUDAux projectAux;\r\n    vec4 posProj \x3d projectPositionHUD(projectAux);\r\n\r\n    vec2 inputSize;\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n    inputSize \x3d screenSizePerspectiveScaleVec2($size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\r\n\r\n    vec2 screenOffsetScaled \x3d screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\r\n\r\n#else\r\n\r\n    inputSize \x3d $size;\r\n\r\n    vec2 screenOffsetScaled \x3d screenOffset;\r\n#endif\r\n\r\n#ifdef VV_SIZE\r\n    // only use width (.xx) for proportional scaling\r\n    // (if no width was defined in vv, width\r\n    //  will be a copy of height vv)\r\n    inputSize *\x3d vvGetScale($auxpos2).xx;\r\n#endif\r\n\r\n    vec2 combinedSize \x3d inputSize * pixelRatio;\r\n    vec4 quadOffset \x3d vec4(0);\r\n\r\n#if defined(OCCL_TEST) || defined(BINARY_HIGHLIGHT_OCCLUSION)\r\n    bool visible \x3d testVisibilityHUD(posProj);\r\n#endif\r\n\r\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\r\n  voccluded \x3d visible ? 0.0 : 1.0;\r\n#endif\r\n\r\n#ifdef OCCL_TEST\r\n    if (visible) {\r\n#endif\r\n      // UV goes from 0 to 1.99999, where the integer part is used\r\n      // for the normalized vertex coordinates, and the fractional\r\n      // part is used for texture sampling\r\n      vec2 uv01 \x3d floor($uv0);\r\n      vec2 uv \x3d $uv0 - uv01;\r\n\r\n      // Displace icon based on anchor position (normalized for size) and\r\n      // absolute screen offset. anchorPos is [-0.5, 0.5]\r\n      quadOffset.xy \x3d ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;\r\n\r\n#ifdef SIGNED_DISTANCE_FIELD\r\n\r\n      // SDF primitives might be scaled so that the SDF texture resolution does\r\n      // not match the resolution of the canvas, but we still want to render\r\n      // outline-only (\'cross\' and \'x\') primitives cleanly. Aligning to a screen\r\n      // pixel border at the geometry center achieves this, since SDF textures\r\n      // always have power of 2 dimensions.\r\n      posProj \x3d alignToPixelOrigin(posProj, viewport.zw) + quadOffset;\r\n#else\r\n      posProj +\x3d quadOffset;\r\n\r\n      // Aligning vertex positions to the nearest (using \'floor\') screen pixel\r\n      // border renders textures with pixel-perfect results. If the texture\r\n      // resolution does not match the canvas resolution then aligning is\r\n      // redundant.\r\n      if (inputSize.x \x3d\x3d $size.x) {\r\n        posProj \x3d alignToPixelOrigin(posProj, viewport.zw);\r\n      }\r\n#endif\r\n\r\n      gl_Position \x3d posProj;\r\n\r\n      vtc \x3d uv;\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\n      debugBorderCoords \x3d vec3(uv01, 1.0 / combinedSize);\r\n#endif\r\n\r\n      vsize \x3d inputSize;\r\n#ifdef OCCL_TEST\r\n    } else {\r\n      vtc \x3d vec2(.0);\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\n      debugBorderCoords \x3d vec3(0);\r\n#endif\r\n\r\n    }\r\n#endif\r\n\r\n    gl_Position \x3d posProj;\r\n\r\n#ifdef VV_COLOR\r\n    vcolor \x3d vvGetColor($auxpos2, vvColorValues, vvColorColors);\r\n#else\r\n    vcolor \x3d $color / 255.0;\r\n#endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderHUDBaseVariables"\x3e\x3c![CDATA[\r\n  $enableRequiredExtensions\r\n  $fsprecisionf\r\n\r\n  uniform sampler2D tex;\r\n  uniform vec4 overrideColor;\r\n  uniform vec4 outlineColor;\r\n  uniform float outlineSize;\r\n\r\n  varying vec4 vcolor;\r\n\r\n  varying vec2 vtc;\r\n  varying vec2 vsize;\r\n\r\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\r\n  varying float voccluded;\r\n#endif\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\n  varying vec3 debugBorderCoords;\r\n#endif\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderHUDBaseMain"\x3e\x3c![CDATA[\r\n  vec4 premultiply(vec4 v) {\r\n    return vec4(v.rgb * v.a, v.a);\r\n  }\r\n\r\n  $rgba2float\r\n\r\n  void main() {\r\n\r\n#ifdef SIGNED_DISTANCE_FIELD\r\n    vec4 color \x3d vec4(0.0, 0.0, 0.0, 0.0);\r\n    vec4 fillPixelColor \x3d overrideColor * vcolor;\r\n\r\n    // Attempt to sample texel centers to avoid that thin cross outlines\r\n    // disappear with large symbol sizes.\r\n    // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\r\n    const float txSize \x3d 128.0;\r\n    const float texelSize \x3d 1.0 / txSize;\r\n    // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\r\n    vec2 scaleFactor \x3d (vsize - txSize) * texelSize;\r\n    vec2 samplePos \x3d vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\r\n\r\n    // Get distance and map it into [-0.5, 0.5]\r\n    float d \x3d rgba2float(texture2D(tex, samplePos)) - 0.5;\r\n\r\n    // Distance in output units (i.e. pixels)\r\n    float dist \x3d d * vsize.x;\r\n\r\n    // Create smooth transition from the icon into its outline\r\n    fillPixelColor.a *\x3d clamp(0.5 - dist, 0.0, 1.0);\r\n\r\n    if (outlineSize \x3e 0.25) {\r\n      vec4 outlinePixelColor \x3d outlineColor;\r\n      float clampedOutlineSize \x3d min(outlineSize, 0.5*vsize.x);\r\n\r\n      // Create smooth transition around outline\r\n      outlinePixelColor.a *\x3d clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\r\n\r\n      // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\r\n      float compositeAlpha \x3d outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\r\n      vec3 compositeColor \x3d vec3(outlinePixelColor) * outlinePixelColor.a +\r\n        vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\r\n\r\n      gl_FragColor \x3d vec4(compositeColor, compositeAlpha);\r\n    }\r\n    else {\r\n      gl_FragColor \x3d premultiply(fillPixelColor);\r\n    }\r\n\r\n    // visualize SDF:\r\n    // gl_FragColor \x3d vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\r\n#else\r\n\r\n    // HUDMaterial is rendered with a blending mode that assumes a pre-multiplied\r\n    // fragment color. Input textures should already be pre-multiplied and so\r\n    // don\'t require adjustment, but the override and vertex colors must be\r\n    // modulated by their alpha values.\r\n\r\n    gl_FragColor \x3d texture2D(tex, vtc, -0.5) * premultiply(overrideColor * vcolor);\r\n\r\n#endif\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\n     float isBorder \x3d float(any(lessThan(debugBorderCoords.xy, vec2(debugBorderCoords.z))) || any(greaterThan(debugBorderCoords.xy, vec2(1.0 - debugBorderCoords.z))));\r\n     gl_FragColor \x3d mix(gl_FragColor, vec4(1, 0, 1, 1), isBorder);\r\n#endif\r\n\r\n    if (gl_FragColor.a \x3c 0.1) {\r\n      discard;\r\n    }\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderHUD"\x3e\x3c![CDATA[\r\n$fragmentShaderHUDBaseVariables\r\n$fragmentShaderHUDBaseMain\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderHUDHighlight"\x3e\x3c![CDATA[\r\n$fragmentShaderHUDBaseVariables\r\n\r\n  uniform sampler2D depthTex;\r\n  uniform vec4 highlightViewportPixelSz;\r\n\r\n$fragmentShaderHUDBaseMain\r\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\r\n    // Instead of deciding on a per-pixel basis if the highlight is occluded,\r\n    // do it for all highlight pixel based on the centroid occlusion. This\r\n    // is a temporary solution for:\r\n    // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/9645\r\n    if (voccluded \x3d\x3d 1.0) {\r\n      gl_FragColor \x3d vec4(1.0, 1.0, 0.0, 1.0);\r\n    } else {\r\n      gl_FragColor \x3d vec4(1.0, 0.0, 1.0, 1.0);\r\n    }\r\n#else\r\n    $highlightWrite\r\n#endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3csnippet name\x3d"vertexShaderOcclusionTestPixel"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  $commonAttributesAndUniformsHUD\r\n\r\n  $alignToPixelCenter\r\n  $projectPositionHUD\r\n\r\n  void main(void) {\r\n    vec4 posProjCenter;\r\n\r\n    // Check for special value of position (0, 0, 0) which is used by the Renderer when graphics\r\n    // are removed before the VBO is recompacted. If this is the case, then we just project outside\r\n    // of clip space.\r\n    if (dot($position, $position) \x3e 0.0) {\r\n      // Render single point to center of the pixel to avoid subpixel filtering to affect\r\n      // the marker color\r\n      ProjectHUDAux projectAux;\r\n      vec4 posProj \x3d projectPositionHUD(projectAux);\r\n\r\n      posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\r\n    }\r\n    else {\r\n      // Project out of clip space\r\n      posProjCenter \x3d vec4(1e038, 1e038, 1e038, 1.0);\r\n    }\r\n\r\n    gl_Position \x3d posProjCenter;\r\n    gl_PointSize \x3d 1.0;\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/internal/TexOnlyGLMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderTexOnly"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  uniform mat4 proj;\r\n  uniform mat4 view;\r\n  uniform mat4 model;\r\n  attribute vec3 $position;\r\n  attribute vec2 $uv0;\r\n  varying vec2 vtc;\r\n\r\n  void main(void) {\r\n    gl_Position \x3d proj * view * vec4((model * vec4(position, 1.0)).xyz, 1.0);\r\n    vtc \x3d $uv0;\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderTexOnly"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  uniform sampler2D tex;\r\n  uniform vec4 color;\r\n  varying vec2 vtc;\r\n\r\n  void main() {\r\n    vec4 texColor \x3d texture2D(tex, vtc);\r\n    gl_FragColor \x3d texColor * color;\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/internal/highlight.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3c!--\r\n\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\nSmartly downsamples a texture, halfing its resolution. This allows for a square\r\nscreen region to check if none, any or all pixels were set.\r\n\r\nThe red channel is always ceiled after interpolating the 4 merged pixels.\r\nThis allows to evaluate:\r\nany(pixels.red !\x3d 0.0) as red \x3d\x3d 1.0\r\nnone(pixels.red !\x3d 0.0) as red \x3d\x3d 0.0\r\n\r\nThe green and blue channels are set to floor(max(green, blue)).\r\nThis allows to evaluate:\r\nall(pixels.green || pixels.blue) as green \x3d\x3d 1.0\r\n\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n--\x3e\r\n\r\n\x3csnippet name\x3d"vsConservativeDownsample"\x3e\x3c![CDATA[\r\n\r\n  $vsprecisionf\r\n\r\n  attribute vec2 $position;\r\n\r\n  void main()\r\n  {\r\n    gl_Position \x3d vec4(vec2(1.0) - $position * 2.0, .0, 1.0);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsConservativeDownsample"\x3e\x3c![CDATA[\r\n\r\n  $fsprecisionf\r\n\r\n  uniform sampler2D tex;\r\n  uniform vec2 invFramebufferDim;\r\n\r\n  void main()\r\n  {\r\n    vec2 coord \x3d gl_FragCoord.xy * invFramebufferDim;\r\n    vec4 value \x3d texture2D(tex, coord);\r\n    float mx \x3d floor(max(value.g, value.b));\r\n    gl_FragColor \x3d vec4(ceil(value.r), mx, mx, 1.0);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c!--\r\n\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\nGaussian blur with linear sampling. Supports different number of samples, but\r\nonly 5 samples have proper weights. Uses linear texture interpolation to reduce\r\nthe number of samples taken.\r\n\r\nDefines:\r\nGRID_OPTIMIZATION (set or !set)\r\nGAUSSIAN_SAMPLES (3,5,7)\r\n\r\nThis technique requires linear filtering on source texture\r\nhttp://rastergrid.com/blog/2010/09/efficient-gaussian-blur-with-linear-sampling/\r\n\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n--\x3e\r\n\x3csnippet name\x3d"vsHighlightBlurFastGaussian"\x3e\x3c![CDATA[\r\n\r\n  $vsprecisionf\r\n\r\n  attribute vec2 $position;\r\n  attribute vec2 $uv0;\r\n\r\n  #ifdef GRID_OPTIMIZATION\r\n    uniform sampler2D coverageTex;\r\n    varying vec3 blurCoordinate;\r\n  #else\r\n    uniform vec2 blurSize;\r\n    varying vec2 blurCoordinates[GAUSSIAN_SAMPLES];\r\n  #endif\r\n\r\n  void main()\r\n  {\r\n    gl_Position \x3d vec4($position, 0.0, 1.0);\r\n\r\n    #ifdef GRID_OPTIMIZATION\r\n      // sample the coverage texture at the block center\r\n      // and if no coverage detected, create degenerate triangle\r\n      vec4 cov \x3d texture2D(coverageTex, $uv0);\r\n      if (cov.r \x3d\x3d 0.0) {\r\n        gl_Position \x3d vec4(0,0,0,0);\r\n      }\r\n\r\n      // create texture coordinate for blur center\r\n      // encode information about fully inside block in z coordinate\r\n      blurCoordinate \x3d vec3(gl_Position.xy * .5 + vec2(.5), max(cov.g, cov.b));\r\n    #else\r\n      vec2 uv \x3d $position.xy * .5 + vec2(.5);\r\n\r\n      #if GAUSSIAN_SAMPLES \x3d\x3d 3\r\n        // not proper gaussian weights\r\n        blurCoordinates[0] \x3d uv;\r\n        blurCoordinates[1] \x3d uv + blurSize * 1.407333;\r\n        blurCoordinates[2] \x3d uv - blurSize * 1.407333;\r\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 5\r\n        blurCoordinates[0] \x3d uv;\r\n        blurCoordinates[1] \x3d uv + blurSize * 1.407333;\r\n        blurCoordinates[2] \x3d uv - blurSize * 1.407333;\r\n        blurCoordinates[3] \x3d uv + blurSize * 3.294215;\r\n        blurCoordinates[4] \x3d uv - blurSize * 3.294215;\r\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 7\r\n        // not proper gaussian weights\r\n        blurCoordinates[0] \x3d uv;\r\n        blurCoordinates[1] \x3d uv + blurSize * 1.407333;\r\n        blurCoordinates[2] \x3d uv - blurSize * 1.407333;\r\n        blurCoordinates[3] \x3d uv + blurSize * 3.294215;\r\n        blurCoordinates[4] \x3d uv - blurSize * 3.294215;\r\n        blurCoordinates[5] \x3d uv + blurSize * 5.1;\r\n        blurCoordinates[6] \x3d uv - blurSize * 5.1;\r\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 9\r\n        // not proper gaussian weights\r\n        blurCoordinates[0] \x3d uv;\r\n        blurCoordinates[1] \x3d uv + blurSize * 1.407333;\r\n        blurCoordinates[2] \x3d uv - blurSize * 1.407333;\r\n        blurCoordinates[3] \x3d uv + blurSize * 3.294215;\r\n        blurCoordinates[4] \x3d uv - blurSize * 3.294215;\r\n        blurCoordinates[5] \x3d uv + blurSize * 5.1;\r\n        blurCoordinates[6] \x3d uv - blurSize * 5.1;\r\n        blurCoordinates[7] \x3d uv + blurSize * 7.1;\r\n        blurCoordinates[8] \x3d uv - blurSize * 7.1;\r\n      #endif\r\n    #endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsHighlightBlurFastGaussian"\x3e\x3c![CDATA[\r\n\r\n  $fsprecisionf\r\n\r\n  uniform sampler2D tex;\r\n\r\n  #ifdef GRID_OPTIMIZATION\r\n    uniform vec2 blurSize;\r\n    varying vec3 blurCoordinate;\r\n  #else\r\n    varying vec2 blurCoordinates[GAUSSIAN_SAMPLES];\r\n  #endif\r\n\r\n  void main()\r\n  {\r\n    #ifdef GRID_OPTIMIZATION\r\n      vec2 uv \x3d blurCoordinate.xy;\r\n      vec4 center \x3d texture2D(tex, uv);\r\n\r\n      // do not blur if no pixel or all pixels in neighborhood are set\r\n      if (blurCoordinate.z \x3d\x3d 1.0) {\r\n        gl_FragColor \x3d center;\r\n      }\r\n      else {\r\n        vec4 sum \x3d vec4(0.0);\r\n\r\n        #if GAUSSIAN_SAMPLES \x3d\x3d 3\r\n          // not proper gaussian weights\r\n          sum +\x3d center * 0.204164;\r\n          sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\r\n          sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\r\n        #elif GAUSSIAN_SAMPLES \x3d\x3d 5\r\n          sum +\x3d center * 0.204164;\r\n          sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\r\n          sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\r\n          sum +\x3d texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\r\n          sum +\x3d texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\r\n        #elif GAUSSIAN_SAMPLES \x3d\x3d 7\r\n          // not proper gaussian weights\r\n          sum +\x3d center * 0.204164;\r\n          sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\r\n          sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\r\n          sum +\x3d texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\r\n          sum +\x3d texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\r\n          sum +\x3d texture2D(tex, uv + blurSize * 5.1) * 0.03;\r\n          sum +\x3d texture2D(tex, uv - blurSize * 5.1) * 0.03;\r\n        #elif GAUSSIAN_SAMPLES \x3d\x3d 9\r\n          // not proper gaussian weights\r\n          sum +\x3d center * 0.154164;\r\n          sum +\x3d texture2D(tex, uv + blurSize * 1.5) * 0.204005;\r\n          sum +\x3d texture2D(tex, uv - blurSize * 1.5) * 0.204005;\r\n          sum +\x3d texture2D(tex, uv + blurSize * 3.5) * 0.123913;\r\n          sum +\x3d texture2D(tex, uv - blurSize * 3.5) * 0.123913;\r\n          sum +\x3d texture2D(tex, uv + blurSize * 5.5) * 0.123913;\r\n          sum +\x3d texture2D(tex, uv - blurSize * 5.5) * 0.123913;\r\n          sum +\x3d texture2D(tex, uv + blurSize * 7.5) * 0.05;\r\n          sum +\x3d texture2D(tex, uv - blurSize * 7.5) * 0.05;\r\n        #endif\r\n\r\n        gl_FragColor \x3d sum;\r\n      }\r\n    #else\r\n      vec4 sum \x3d vec4(0.0);\r\n\r\n      #if GAUSSIAN_SAMPLES \x3d\x3d 3\r\n        // not proper gaussian weights\r\n        sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\r\n        sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\r\n        sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\r\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 5\r\n        sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\r\n        sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\r\n        sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\r\n        sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.093913;\r\n        sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.093913;\r\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 7\r\n        // not proper gaussian weights\r\n        sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\r\n        sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\r\n        sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\r\n        sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.093913;\r\n        sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.093913;\r\n        sum +\x3d texture2D(tex, blurCoordinates[5]) * 0.03;\r\n        sum +\x3d texture2D(tex, blurCoordinates[6]) * 0.03;\r\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 9\r\n        // not proper gaussian weights\r\n        sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.154164;\r\n        sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.204005;\r\n        sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.204005;\r\n        sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.123913;\r\n        sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.123913;\r\n        sum +\x3d texture2D(tex, blurCoordinates[5]) * 0.09;\r\n        sum +\x3d texture2D(tex, blurCoordinates[6]) * 0.09;\r\n        sum +\x3d texture2D(tex, blurCoordinates[7]) * 0.05;\r\n        sum +\x3d texture2D(tex, blurCoordinates[8]) * 0.05;\r\n      #endif\r\n\r\n      gl_FragColor \x3d sum;\r\n    #endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c!--\r\n\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\nMerging blurred outlines with source image, advanced version\r\n\r\nDefines:\r\nGRID_OPTIMIZATION (set or !set)\r\nGRID_DEBUG (set or !set)\r\n\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n--\x3e\r\n\x3csnippet name\x3d"vsHighlightApply"\x3e\x3c![CDATA[\r\n\r\n  $vsprecisionf\r\n\r\n  attribute vec2 $position;\r\n  varying vec2 uv;\r\n\r\n  #ifdef GRID_OPTIMIZATION\r\n    attribute vec2 $uv0;\r\n    uniform sampler2D coverageTex;\r\n  #endif\r\n\r\n  void main()\r\n  {\r\n    #ifdef GRID_OPTIMIZATION\r\n      #ifdef GRID_DEBUG\r\n        vec4 cov \x3d texture2D(coverageTex, $uv0);\r\n        // if no highlight pixel set in this block,\r\n        // or all pixels set, hide block\r\n        if (cov.r \x3d\x3d 0.0 || cov.g \x3d\x3d 1.0 || cov.b \x3d\x3d 1.0) {\r\n          gl_Position \x3d vec4(0,0,0,0);\r\n          return;\r\n        }\r\n        gl_Position \x3d vec4($position, .0, 1.0);\r\n        uv \x3d $uv0;\r\n        return;\r\n      #else\r\n        vec4 cov \x3d texture2D(coverageTex, $uv0);\r\n        // if no highlight pixel set in this block, hide block\r\n        if (cov.r \x3d\x3d 0.0) {\r\n          gl_Position \x3d vec4(0,0,0,0);\r\n          return;\r\n        }\r\n      #endif\r\n    #endif\r\n\r\n    gl_Position \x3d vec4($position, .0, 1.0);\r\n    uv \x3d $position.xy * .5 + vec2(.5);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsHighlightApply"\x3e\x3c![CDATA[\r\n\r\n  $fsprecisionf\r\n\r\n  uniform sampler2D tex;\r\n  uniform sampler2D origin;\r\n\r\n  uniform vec4 color;\r\n  uniform float outlineSize;\r\n  uniform float blurSize;\r\n  uniform vec4 opacities; // [outline, outlineOccluded, fill, fillOccluded]\r\n\r\n  varying vec2 uv;\r\n\r\n  void main()\r\n  {\r\n    #if defined(GRID_OPTIMIZATION) \x26\x26 defined(GRID_DEBUG)\r\n      gl_FragColor \x3d vec4(uv, 0, 1.0);\r\n    #else\r\n      // Read the highlight intensity from the blurred highlight image\r\n      vec4 blurredHighlightValue \x3d texture2D(tex, uv);\r\n      float highlightIntensity \x3d blurredHighlightValue.a;\r\n\r\n      // Discard all pixels which are not affected by highlight\r\n      if (highlightIntensity \x3d\x3d 0.0) {\r\n        discard;\r\n      }\r\n\r\n      vec4 origin_color \x3d texture2D(origin, uv);\r\n\r\n      float outlineIntensity;\r\n      float fillIntensity;\r\n\r\n      // if occluded\r\n      if (blurredHighlightValue.g \x3e blurredHighlightValue.b) {\r\n        outlineIntensity \x3d color.w * opacities[1];\r\n        fillIntensity \x3d color.w * opacities[3];\r\n      }\r\n      // if unoccluded\r\n      else {\r\n        outlineIntensity \x3d color.w * opacities[0];\r\n        fillIntensity \x3d color.w * opacities[2];\r\n      }\r\n\r\n      float inner \x3d 1.0 - outlineSize / 9.0;\r\n      float outer \x3d 1.0 - (outlineSize + blurSize) / 9.0;\r\n\r\n      float outlineFactor \x3d smoothstep(outer, inner, highlightIntensity);\r\n      //float fillFactor \x3d smoothstep(0.6, 0.72, highlightIntensity);\r\n      float fillFactor \x3d any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;\r\n      float intensity \x3d outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;\r\n\r\n      // Blending equation: gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\r\n      // I.e., color should not be premultiplied with alpha\r\n      gl_FragColor \x3d vec4(color.xyz, intensity);\r\n    #endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/internal/offscreen.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vsOffscreenRenderer"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  attribute vec2 $position;\r\n  varying vec2 vtc;\r\n\r\n  void main(void) {\r\n    gl_Position \x3d vec4($position.xy, 0.0, 1.0);\r\n    vtc \x3d $position.xy * 0.5 + 0.5;\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsOffscreenRenderer"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  uniform sampler2D tex;\r\n\r\n  varying vec2 vtc;\r\n\r\n  void main() {\r\n    gl_FragColor \x3d texture2D(tex, vtc);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsOffscreenRendererTransparentToHUDVisibility"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  uniform sampler2D tex;\r\n\r\n  varying vec2 vtc;\r\n\r\n  void main() {\r\n    gl_FragColor \x3d vec4(1.0 - texture2D(tex, vtc).a);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/internal/occluded.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vsRenderOccludedApply"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  attribute vec2 $position;\r\n  varying vec2 uv;\r\n\r\n  void main(void) {\r\n    gl_Position \x3d vec4($position, 0.0, 1.0);\r\n    uv \x3d $position.xy * 0.5 + vec2(0.5);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsRenderOccludedApply"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  uniform sampler2D occludedColorMap;\r\n\r\n  varying vec2 uv;\r\n\r\n  void main() {\r\n    vec4 occludedColor \x3d texture2D(occludedColorMap, uv);\r\n    gl_FragColor \x3d occludedColor * vec4(1.0, 1.0, 1.0, 0.4);\r\n  }\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/internal/ssao.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n  \x3csnippet name\x3d"createFsSSAOSrc"\x3e\x3c![CDATA[\r\n\r\n  $fsprecisionf\r\n\r\n  uniform sampler2D rnm;\r\n  uniform sampler2D normalMap;\r\n  uniform sampler2D depthMap;\r\n  uniform float   ssaoAtt;\r\n  uniform vec2    rnmScale;\r\n  uniform float   radius;\r\n  uniform vec2    nearFar;\r\n  uniform vec3    pSphere[64];\r\n\r\n  varying vec2    uv;\r\n\r\n  const float   strength \x3d .07;\r\n  const float   falloff \x3d .000002;\r\n\r\n  $rgba2float\r\n  void main(void) {\r\n    vec3 fres \x3d normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));\r\n    float currentPixelDepth \x3d rgba2float(texture2D(depthMap, uv));\r\n    vec3 ep \x3d vec3(uv.xy, currentPixelDepth);\r\n    vec3 norm \x3d vec3(-1.0) + 2.0 * texture2D(normalMap, uv).xyz;\r\n    float bl \x3d .0;\r\n    float f \x3d mix(nearFar.x, nearFar.y, currentPixelDepth) / nearFar.x;\r\n    float radD \x3d radius / f;\r\n    radD \x3d min(radD, .5);\r\n    float depthDifference;\r\n    vec3 ray;\r\n\r\n    for(int i \x3d 0; i \x3c NUM_TAP_SAMPLES; ++i) {\r\n      ray \x3d radD*reflect(pSphere[i], fres);\r\n      vec2 tc \x3d ep.xy + sign(dot(ray, norm) ) * ray.xy;\r\n      if (tc.x \x3e\x3d .0 \x26\x26 tc.y \x3e\x3d .0 \x26\x26 tc.x \x3c\x3d 1.0 \x26\x26 tc.y \x3c\x3d 1.0) {\r\n        float occluderDepth \x3d rgba2float(texture2D(depthMap, tc));\r\n        vec3 occluderNormal \x3d vec3(-1.0) + 2.0 * texture2D(normalMap, tc).xyz;\r\n        depthDifference \x3d currentPixelDepth - occluderDepth;\r\n        bl +\x3d step(falloff, depthDifference) * (1.0 - dot(occluderNormal, norm)) * (1.0 - smoothstep(falloff, strength, depthDifference));\r\n      }\r\n    }\r\n\r\n    float ao \x3d 1.0 + bl * (-1.38 / float(NUM_TAP_SAMPLES)) * ssaoAtt;\r\n    gl_FragColor.a \x3d ao;\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n  \x3csnippet name\x3d"getDepthLinear"\x3e\x3c![CDATA[\r\n  float getDepthLinear(vec2 ssC) {\r\n    return -(rgba2float(texture2D(depthMap, ssC))*(nearFar[1] - nearFar[0])+nearFar[0]);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"createFsSSAOSrcObscurance"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  uniform mat4 projMatrixInv;\r\n\r\n  uniform sampler2D normalMap;\r\n  uniform sampler2D depthMap;\r\n\r\n  uniform float     intensity;\r\n\r\n  uniform float projScale;\r\n  uniform float     radius;\r\n  uniform vec2      nearFar;\r\n\r\n  uniform vec4      projInfo;\r\n\r\n  uniform vec2    screenDimensions;\r\n\r\n  //noise texture lookup could be replaced with hash function if WebGL gets XOR functionality\r\n  uniform vec3    pSphere[NUM_TAP_SAMPLES]; //tap position\r\n  uniform vec2    rnmScale;\r\n  uniform sampler2D rnm; //noise texture\r\n\r\n  //set z scaling, used to prevent division in ortho mode\r\n  uniform vec2 zScale;\r\n\r\n  varying vec2  uv;\r\n  varying vec4  camPos;\r\n\r\n  $rgba2float\r\n  $getDepthLinear\r\n\r\n  /** Returns a unit vector and a screen-space radius for the tap on a unit disk (the caller should scale by the actual disk radius) */\r\n  /*uniform float numSpiralTurns;\r\n  vec2 tapLocation(int sampleNumber, float spinAngle, out float ssR){\r\n    // Radius relative to ssR\r\n    float alpha \x3d (float(sampleNumber) + 0.5) * (1.0 / float(NUM_TAP_SAMPLES));\r\n    float angle \x3d alpha * (numSpiralTurns * 6.28) + spinAngle;\r\n\r\n    ssR \x3d alpha;\r\n    return vec2(cos(angle), sin(angle));\r\n  }*/\r\n\r\n\r\n  float fallOffFunction(float vv, float vn, float bias) {\r\n    float radius2 \x3d radius * radius;\r\n\r\n    // A: From the HPG12 paper\r\n    // Note large epsilon to avoid overdarkening within cracks\r\n    // return float(vv \x3c radius2) * max((vn - bias) / (epsilon + vv), 0.0) * radius2 * 0.6;\r\n\r\n    // B: Smoother transition to zero (lowers contrast, smoothing out corners). [Recommended]\r\n    float f \x3d max(radius2 - vv, 0.0); return f * f * f * max(vn-bias, 0.0);\r\n\r\n    // C: Medium contrast (which looks better at high radii), no division.  Note that the\r\n    // contribution still falls off with radius^2, but we\'ve adjusted the rate in a way that is\r\n    // more computationally efficient and happens to be aesthetically pleasing.\r\n    // return 4.0 * max(1.0 - vv * invRadius2, 0.0) * max(vn - bias, 0.0);\r\n\r\n    // D: Low contrast, no division operation\r\n    // return 2.0 * float(vv \x3c radius * radius) * max(vn - bias, 0.0);\r\n  }\r\n\r\n\r\n  /** Compute the occlusion due to sample point \\a Q about camera-space point \\a C with unit normal \\a n_C */\r\n  float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {\r\n    vec3 v \x3d Q - C;\r\n    float vv \x3d dot(v, v);\r\n    float vn \x3d dot(normalize(v), n_C);\r\n    return fallOffFunction(vv, vn, 0.1);\r\n  }\r\n\r\n\r\n  /**\r\n   * Reconstruct camera-space P.xyz from screen-space S \x3d (x, y) in\r\n   * pixels and camera-space z \x3c 0.  Assumes that the upper-left pixel center\r\n   * is at (0.5, 0.5) [but that need not be the location at which the sample tap\r\n   * was placed!]\r\n   *\r\n   * Costs 3 MADD.  Error is on the order of 10^3 at the far plane, partly due to z precision.\r\n   */\r\n  vec3 reconstructCSPosition(vec2 S, float z) {\r\n    return vec3(( (S.xy) * projInfo.xy + projInfo.zw)*(z*zScale.x+zScale.y), z);\r\n  }\r\n\r\n  void main(void) {\r\n    //Hash function used in the HPG12 AlchemyAO paper\r\n    //Not supported in WebGL -\x3e using texture lookup as in old SSAO shader instead\r\n    //ivec2 ssC \x3d ivec2(gl_FragCoord.xy);\r\n    //float randomPatternRotationAngle \x3d float((3 * ssC.x ^ ssC.y + ssC.x * ssC.y) * 10);\r\n    vec3 fres \x3d normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));\r\n\r\n    float currentPixelDepth \x3d getDepthLinear(uv);\r\n\r\n    if (-currentPixelDepth\x3enearFar.y || -currentPixelDepth\x3cnearFar.x) {\r\n      gl_FragColor \x3d vec4(0);\r\n      return;\r\n    }\r\n\r\n    vec3 currentPixelPos \x3d reconstructCSPosition(gl_FragCoord.xy,currentPixelDepth);\r\n\r\n    // get the normal of current fragment\r\n    vec4 norm4 \x3d texture2D(normalMap, uv);\r\n    vec3 norm \x3d vec3(-1.0) + 2.0 * norm4.xyz;\r\n    bool isTerrain \x3d norm4.w\x3c0.5;\r\n\r\n    float sum \x3d .0;\r\n\r\n    vec4 occluderFragment;\r\n    vec3 ray;\r\n\r\n    vec3 tapPixelPos;\r\n\r\n    // note: the factor 2.0 should not be necessary, but makes ssao much nicer.\r\n    // bug or deviation from CE somewhere else?\r\n    float ps \x3d projScale/(2.0*currentPixelPos.z*zScale.x+zScale.y);\r\n\r\n    for(int i \x3d 0; i \x3c NUM_TAP_SAMPLES; ++i)\r\n    {\r\n      // get a vector (randomized inside of a sphere with radius 1.0) from a texture and reflect it\r\n      //float ssR;\r\n      //vec2 unitOffset \x3d tapLocation(i, randomPatternRotationAngle, ssR);\r\n      // get the depth of the occluder fragment\r\n      //vec2 offset \x3d vec2(-unitOffset*radius*ssR*ps);\r\n\r\n      vec2 unitOffset \x3d reflect(pSphere[i], fres).xy;\r\n      vec2 offset \x3d vec2(-unitOffset*radius*ps);\r\n\r\n\r\n      //don\'t use current or very nearby samples\r\n      if ( abs(offset.x)\x3c2.0 || abs(offset.y)\x3c2.0) continue;\r\n\r\n\r\n      vec2 tc \x3d vec2(gl_FragCoord.xy + offset);\r\n      if (tc.x \x3c 0.0 || tc.y \x3c 0.0 || tc.x \x3e screenDimensions.x || tc.y \x3e screenDimensions.y) continue;\r\n      vec2 tcTap \x3d tc/screenDimensions;\r\n      float occluderFragmentDepth \x3d getDepthLinear(tcTap);\r\n\r\n      if (isTerrain) {\r\n        bool isTerrainTap \x3d texture2D(normalMap, tcTap).w\x3c0.5;\r\n        if (isTerrainTap) {\r\n          continue;\r\n        }\r\n      }\r\n\r\n      tapPixelPos \x3d reconstructCSPosition(tc, occluderFragmentDepth);\r\n\r\n      sum+\x3d aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);\r\n    }\r\n\r\n    // output the result\r\n\r\n    float A \x3d max(1.0-sum*intensity/float(NUM_TAP_SAMPLES),0.0);\r\n\r\n    // Anti-tone map to reduce contrast and drag dark region farther\r\n    // (x^0.2 + 1.2 * x^4)/2.2\r\n    A \x3d (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;\r\n\r\n\r\n    //gl_FragColor \x3d vec4(norm/2.0+0.5, 1.0);\r\n    //gl_FragColor \x3d vec4(-currentPixelDepth/1000.0);\r\n    //gl_FragColor \x3d vec4(tapPixelPos.x/100.0);\r\n    gl_FragColor \x3d vec4(A);\r\n\r\n\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsBlurEdgeAware"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  uniform sampler2D normalMap;\r\n  uniform sampler2D depthMap;\r\n  uniform sampler2D tex;\r\n\r\n\r\n  uniform vec2 blurSize;\r\n\r\n\r\n  uniform float g_BlurFalloff;\r\n  uniform float projScale;\r\n\r\n\r\n  varying vec2 uv;\r\n\r\n  uniform vec2    nearFar;\r\n\r\n  //set z scaling, used to prevent division in ortho mode\r\n  uniform vec2 zScale;\r\n\r\n  $rgba2float\r\n  $getDepthLinear\r\n\r\n  float BlurFunction(vec2 uv, float r, float center_d, inout float w_total, float sharpness)\r\n  {\r\n    float c \x3d texture2D(tex, uv).r;\r\n    float d \x3d getDepthLinear(uv);\r\n\r\n    float ddiff \x3d d - center_d;\r\n\r\n    float w \x3d exp(-r*r*g_BlurFalloff - ddiff*ddiff*sharpness);\r\n\r\n    w_total +\x3d w;\r\n\r\n    return w*c;\r\n  }\r\n\r\n  void main(void)\r\n  {\r\n\r\n    float b \x3d 0.0;\r\n    float w_total \x3d 0.0;\r\n\r\n    float center_d \x3d  getDepthLinear(uv);\r\n\r\n    float sharpness \x3d -0.05*projScale/(center_d*zScale.x+zScale.y);\r\n    for (int r \x3d -RADIUS; r \x3c\x3d RADIUS; ++r)\r\n    {\r\n      float rf \x3d float(r);\r\n      vec2 uvOffset \x3d uv + rf*blurSize;\r\n      b +\x3d BlurFunction(uvOffset, rf, center_d, w_total, sharpness);\r\n    }\r\n\r\n    gl_FragColor \x3d vec4(b/w_total);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n  \x3csnippet name\x3d"fsBlurSrc0"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  uniform sampler2D tex;\r\n  uniform float blurSize;\r\n  varying vec2 uv;\r\n\r\n  void main() {\r\n    int rad \x3d RADIUS - 1;\r\n\r\n    vec4 sum \x3d vec4(0.0);\r\n    for (int k \x3d -RADIUS; k \x3c\x3d RADIUS; ++k) {     // NOTE for-variable-init must be a const expression\r\n      float fi \x3d float(k);\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n  \x3csnippet name\x3d"fsBlurSrc1"\x3e\x3c![CDATA[\r\n    }\r\n\r\n    gl_FragColor \x3d sum / float(RADIUS * RADIUS);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n  \x3csnippet name\x3d"fsBlurH"\x3e\x3c![CDATA[\r\n  $fsBlurSrc0\r\n      sum +\x3d texture2D(tex, vec2(uv.x + fi * blurSize, uv.y)) * (float(rad) - abs(fi) + 1.0);\r\n  $fsBlurSrc1\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n  \x3csnippet name\x3d"fsBlurV"\x3e\x3c![CDATA[\r\n  $fsBlurSrc0\r\n      sum +\x3d texture2D(tex, vec2(uv.x, uv.y + fi * blurSize)) * (float(rad) - abs(fi) + 1.0);\r\n  $fsBlurSrc1\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/internal/hud.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"commonAttributesAndUniformsHUD"\x3e\x3c![CDATA[\r\n  attribute vec3 $position;\r\n  attribute vec3 $normal;\r\n  attribute vec4 $auxpos1;\r\n\r\n  uniform mat4 proj;\r\n\r\n  uniform mat4 view;\r\n  uniform mat4 viewNormal;\r\n\r\n  uniform mat4 model;\r\n  uniform mat4 modelNormal;\r\n\r\n  uniform vec4 viewport;\r\n\r\n  uniform vec3 camPos;\r\n\r\n  uniform float polygonOffset;\r\n  uniform float cameraGroundRelative;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n\r\n  // [ screenLength, distanceFactor, minWorldLength, maxWorldLength ]\r\n  uniform vec4 verticalOffset;\r\n\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n  // [ divisor, offset, minPixelSize, paddingPixels ]\r\n  uniform vec4 screenSizePerspectiveAlignment;\r\n\r\n#endif\r\n\r\n  uniform sampler2D hudVisibilityTexture;\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"projectPositionHUD"\x3e\x3c![CDATA[\r\n  $screenSizePerspective\r\n\r\n  // Corresponds to cos(10 deg), used to compare against dot product of two vectors\r\n  const float SMALL_OFFSET_ANGLE \x3d 0.984807753012208;\r\n\r\n  struct ProjectHUDAux {\r\n    vec3 posModel;\r\n    vec3 posView;\r\n    vec3 vnormal;\r\n\r\n    float distanceToCamera;\r\n    float absCosAngle;\r\n  };\r\n\r\n\r\n  /**\r\n   * Apply the simulated polygon offset for HUD objects that improves\r\n   * issues with Z-fighting.\r\n   *\r\n   * @param posView {vec3} (inout) the position in view space. Will be modified in place.\r\n   * @param pointGroundDistance {float} the distance from the point geometry to the ground surface.\r\n   * @param absCosAngle {float} the absolute cosine of the angle between the world-up at the point geometry\r\n   *   and the view direction.\r\n   *\r\n   * Dependencies:\r\n   *\r\n   *   Attributes:\r\n   *     - auxpos1: contains centerOffset and pointGroundDistance\r\n   *\r\n   *   Uniforms:\r\n   *     - cameraGroundRelative: indicates whether camera is above (1) or below (-1) ground.\r\n   *         This is used for emulated polygon offset for improved visibility of points sitting on the surface.\r\n   *     - polygonOffset: a constant polygon offset to bring the point closer to the viewer for\r\n   *         reduced flickering.\r\n   *     - viewport: the viewport [x, y, width, height]\r\n   */\r\n  float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\r\n    float pointGroundSign \x3d sign(pointGroundDistance);\r\n\r\n    if (pointGroundSign \x3d\x3d 0.0) {\r\n      pointGroundSign \x3d 1.0;\r\n    }\r\n\r\n    // cameraGroundRelative is -1 if camera is below ground, 1 if above ground\r\n    // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise\r\n    float groundRelative \x3d cameraGroundRelative * pointGroundSign;\r\n\r\n    // view angle dependent part of polygon offset emulation\r\n    // we take the absolute value because the sign that is dropped is\r\n    // instead introduced using the ground-relative position of the symbol and the camera\r\n    if (polygonOffset \x3e .0) {\r\n      float cosAlpha \x3d clamp(absCosAngle, 0.01, 1.0);\r\n\r\n      float tanAlpha \x3d sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\r\n      float factor \x3d (1.0 - tanAlpha / viewport[2]);\r\n\r\n      // same side of the terrain\r\n      if (groundRelative \x3e 0.0) {\r\n        posView *\x3d factor;\r\n      }\r\n      // opposite sides of the terrain\r\n      else {\r\n        posView /\x3d factor;\r\n      }\r\n    }\r\n\r\n    return groundRelative;\r\n  }\r\n\r\n  /**\r\n   * Project the 3d position of a HUD object from world space to clip space. In addition\r\n   * to standard model view projection, it also emulates a polygon offset to\r\n   * help with points above/below ground and icon flickering. The resulting location\r\n   * is the anchor of the HUD object, i.e. the position that is used also for testing\r\n   * visibility of the HUD object. Note that the returned projected position is not\r\n   * aligned to a pixel center or border, it is up to the caller to align if necessary.\r\n   *\r\n   * Dependencies:\r\n   *\r\n   *   Attributes:\r\n   *     - position: contains the point world position\r\n   *     - normal: contains the world normal pointing up at the point\r\n   *     - auxpos1: contains centerOffset and pointGroundDistance\r\n   *\r\n   *   Uniforms:\r\n   *     - model: the object -\x3e world transformation matrix\r\n   *     - modelNormal: the object -\x3e world normal transformation matrix (inv transp of model)\r\n   *     - view: the world -\x3e view transformation matrix\r\n   *     - viewNormal: the world -\x3e view normal transformation matrix (inv transp of view)\r\n   *     - proj: the view -\x3e clip projection matrix\r\n   *     - verticalOffset: a vec4 containing:\r\n   *         - the screen height of the vertical offset\r\n   *         - the screen height of the vertical offset as a fraction of camera distance.\r\n   *         - the minimum world size vertical offset.\r\n   *         - the maximum world size vertical offset.\r\n   *       This will do a screen sized offset of the point along its normal (used for line callouts)\r\n   *     - screenSizePerspectiveAlignment: a vec3 containing\r\n   *         - the view distance dependent divisor\r\n   *         - the view distance dependent offset\r\n   *         - the minimum pixel size\r\n   *         - the amount of padding in pixels around the region to be scaled (not used for alignment)\r\n   *     - cameraGroundRelative: indicates whether camera is above (1) or below (-1) ground.\r\n   *         This is used for emulated polygon offset for improved visibility of points sitting on the surface.\r\n   *     - polygonOffset: a constant polygon offset to bring the point closer to the viewer for\r\n   *         reduced flickering.\r\n   *     - camPos: the position of the camera in world space\r\n   *     - viewport: the viewport [x, y, width, height]\r\n   */\r\n  vec4 projectPositionHUD(out ProjectHUDAux aux) {\r\n    // centerOffset is in view space and is used to implement world size offsetting\r\n    // of labels with respect to objects. It also pulls the label towards the viewer\r\n    // so that the label is visible in front of the object.\r\n    vec3 centerOffset \x3d $auxpos1.xyz;\r\n\r\n    // The pointGroundDistance is the distance of the geometry to the ground and is\r\n    // negative if the point is below the ground, or positive if the point is above\r\n    // ground.\r\n    float pointGroundDistance \x3d $auxpos1.w;\r\n\r\n    aux.posModel \x3d (model * vec4($position, 1.0)).xyz;\r\n    aux.posView \x3d (view * vec4(aux.posModel, 1.0)).xyz;\r\n    aux.vnormal \x3d (modelNormal * vec4($normal, 1.0)).xyz;\r\n\r\n    // Screen sized offset in world space, used for example for line callouts\r\n    // Note: keep this implementation in sync with the CPU implementation, see\r\n    //   - MaterialUtil.verticalOffsetAtDistance\r\n    //   - HUDMaterial.applyVerticalOffsetTransformation\r\n\r\n    aux.distanceToCamera \x3d length(aux.posView);\r\n\r\n    vec3 viewDirObjSpace \x3d normalize(camPos - aux.posModel);\r\n    float cosAngle \x3d dot(aux.vnormal, viewDirObjSpace);\r\n\r\n    aux.absCosAngle \x3d abs(cosAngle);\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n#if defined(VERTICAL_OFFSET) || defined(CENTER_OFFSET_UNITS_SCREEN)\r\n    vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);\r\n#endif\r\n\r\n#endif\r\n\r\n#ifdef VERTICAL_OFFSET\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n    float verticalOffsetScreenHeight \x3d applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);\r\n#else\r\n    float verticalOffsetScreenHeight \x3d verticalOffset.x;\r\n#endif\r\n\r\n    float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\r\n    vec3 modelOffset \x3d aux.vnormal * worldOffset;\r\n\r\n    aux.posModel +\x3d modelOffset;\r\n\r\n    vec3 viewOffset \x3d (viewNormal * vec4(modelOffset, 1.0)).xyz;\r\n    aux.posView +\x3d viewOffset;\r\n\r\n    // Since we elevate the object, we need to take that into account\r\n    // in the distance to ground\r\n    pointGroundDistance +\x3d worldOffset;\r\n\r\n#endif\r\n\r\n    float groundRelative \x3d applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\r\n\r\n#ifndef CENTER_OFFSET_UNITS_SCREEN\r\n    // Apply x/y in view space, but z in screen space (i.e. along posView direction)\r\n    aux.posView +\x3d vec3(centerOffset.x, centerOffset.y, 0);\r\n\r\n    // Same material all have same z !\x3d 0.0 condition so should not lead to\r\n    // branch fragmentation and will save a normalization if it\'s not needed\r\n    if (centerOffset.z !\x3d 0.0) {\r\n      aux.posView -\x3d normalize(aux.posView) * centerOffset.z;\r\n    }\r\n#endif\r\n\r\n    vec4 posProj \x3d proj * vec4(aux.posView, 1.0);\r\n\r\n#ifdef CENTER_OFFSET_UNITS_SCREEN\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n    float centerOffsetY \x3d applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);\r\n#else\r\n    float centerOffsetY \x3d centerOffset.y;\r\n#endif\r\n\r\n    posProj.xy +\x3d vec2(centerOffset.x, centerOffsetY) * 2.0 / viewport.zw * posProj.w;\r\n\r\n#endif\r\n\r\n    // constant part of polygon offset emulation\r\n    posProj.z -\x3d groundRelative * polygonOffset * posProj.w;\r\n\r\n    return posProj;\r\n  }\r\n\r\n  uniform float uRenderTransparentlyOccludedHUD;\r\n\r\n  /**\r\n   * Test for visibility of a HUD object.\r\n   *\r\n   * Dependencies:\r\n   *\r\n   *   Uniforms:\r\n   *     - hudVisibilityTexture: the texture that contains the visibility information\r\n   *     - markerColor: the special marker color that is used to write visibility information\r\n   *     - viewport: the viewport\r\n   */\r\n  bool testVisibilityHUD(vec4 posProj) {\r\n    // For occlusion testing, use the nearest pixel center to avoid\r\n    // subpixel filtering messing up the color we use to test for\r\n    vec4 posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\r\n\r\n    vec4 occlusionPixel \x3d texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\r\n\r\n    // the red pixel here indicates that the occlusion pixel passed the depth test against solid geometry and was written\r\n    // the green pixel stores transparency of transparent geometry (1.0 -\x3e fully transparent)\r\n    // note that we also check against green \x3d\x3d 0.0, i.e. transparent geometry that has opaque parts\r\n\r\n    // thus we render visible pixels that are occluded by semi-transparent (but not fully transparent!) geometry here\r\n    if (uRenderTransparentlyOccludedHUD \x3e 0.5) {\r\n      // multiplying by uRenderTransparentlyOccludedHUD allows us to ignore the second condition if\r\n      // uRenderTransparentlyOccludedHUD \x3d 0.75\r\n      return occlusionPixel.r * occlusionPixel.g \x3e 0.0 \x26\x26 occlusionPixel.g * uRenderTransparentlyOccludedHUD \x3c 1.0;\r\n    }\r\n    // and visible pixels that are not occluded by semi-transparent geometry here\r\n    else {\r\n      return occlusionPixel.r * occlusionPixel.g \x3e 0.0 \x26\x26 occlusionPixel.g \x3d\x3d 1.0;\r\n    }\r\n\r\n    // return texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w).r \x3e 0.0;\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/internal/util.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"alignToPixelCenter"\x3e\x3c![CDATA[\r\n  vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\r\n    // From clip space to (0 : 1), bias towards right pixel edge\r\n    vec2 xy \x3d vec2(.500123) + .5 * clipCoord.xy / clipCoord.w;\r\n\r\n    // Size of a pixel in range (0 : 1)\r\n    vec2 pixelSz \x3d vec2(1.0) / widthHeight;\r\n\r\n    // Round to nearest pixel center\r\n    vec2 ij \x3d (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\r\n\r\n    // Convert back to clip space\r\n    vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\r\n\r\n    return vec4(result, clipCoord.zw);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"alignToPixelOrigin"\x3e\x3c![CDATA[\r\n  vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\r\n    // From clip space to (0 : 1),\r\n    vec2 xy \x3d vec2(.5) + .5 * clipCoord.xy / clipCoord.w;\r\n\r\n    // Size of a pixel in range (0 : 1)\r\n    vec2 pixelSz \x3d vec2(1.0) / widthHeight;\r\n\r\n    // Round to nearest pixel border, (0 : 1)\r\n    vec2 ij \x3d floor((xy + .5 * pixelSz) * widthHeight) * pixelSz;\r\n\r\n    // Convert back to clip space\r\n    vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\r\n\r\n    return vec4(result, clipCoord.zw);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"float2rgba"\x3e\x3c![CDATA[\r\n  // This is the maximum float value representable as 32bit fixed point,\r\n  // it is rgba2float(vec4(1)) inlined.\r\n  const float MAX_RGBA_FLOAT \x3d\r\n    255.0 / 256.0 +\r\n    255.0 / 256.0 / 256.0 +\r\n    255.0 / 256.0 / 256.0 / 256.0 +\r\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\r\n\r\n  // Factors to convert to fixed point, i.e. factors (256^0, 256^1, 256^2, 256^3)\r\n  const vec4 fixedPointFactors \x3d vec4(1, 256, 256 * 256, 256 * 256 * 256);\r\n\r\n  vec4 float2rgba(const float value) {\r\n    // Make sure value is in the domain we can represent\r\n    float valueInValidDomain \x3d clamp(value, 0.0, MAX_RGBA_FLOAT);\r\n\r\n    // Decompose value in 32bit fixed point parts represented as\r\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\r\n    // by a power of 256 (this removes the bits that are represented in the previous\r\n    // component) and then converts the fractional part to 8bits.\r\n    vec4 fixedPointU8 \x3d floor(fract(valueInValidDomain * fixedPointFactors) * 256.0);\r\n\r\n    // Convert uint8 values (from 0 to 255) to floating point representation for\r\n    // the shader\r\n    const float toU8AsFloat \x3d 1.0 / 255.0;\r\n\r\n    return fixedPointU8 * toU8AsFloat;\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"rgba2float"\x3e\x3c![CDATA[\r\n  // Factors to convert rgba back to float\r\n  const vec4 rgba2float_factors \x3d vec4(\r\n    255.0 / (256.0),\r\n    255.0 / (256.0 * 256.0),\r\n    255.0 / (256.0 * 256.0 * 256.0),\r\n    255.0 / (256.0 * 256.0 * 256.0 * 256.0)\r\n  );\r\n\r\n  float rgba2float(vec4 rgba) {\r\n    // Convert components from 0-\x3e1 back to 0-\x3e255 and then\r\n    // add the components together with their corresponding\r\n    // fixed point factors, i.e. (256^1, 256^2, 256^3, 256^4)\r\n    return dot(rgba, rgba2float_factors);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"calcFragDepth"\x3e\x3c![CDATA[\r\n  float calcFragDepth(const in float depth) {\r\n    //calc polygon offset\r\n    const float SLOPE_SCALE \x3d 2.0;\r\n    const float BIAS \x3d 2.0 * .000015259;    // 1 / (2^16 - 1)\r\n    float m \x3d max(abs(dFdx(depth)), abs(dFdy(depth)));\r\n    float result \x3d depth + SLOPE_SCALE * m + BIAS;\r\n    return clamp(result, .0, .999999);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"evalShadow"\x3e\x3c![CDATA[\r\n  $rgba2float\r\n\r\n  // "matrix" parameter used to have const qualifier as well, but IE11 couldn\'t deal with it at time of writing.\r\n  // once IE11 is fine with it, const should probably be re-introduced\r\n  float evalShadow(const in vec3 vpos, const in float depth, const in sampler2D depthTex, const int num, const in vec4 distance, in mat4 matrix[4], const in float halfPxSz) {\r\n    //choose correct cascade\r\n    int i \x3d depth \x3c distance[1] ? 0 : depth \x3c distance[2] ? 1 : depth \x3c distance[3] ? 2 : 3;\r\n\r\n    if (i \x3e\x3d num) return .0;\r\n\r\n    mat4 mat \x3d i \x3d\x3d 0 ? matrix[0] : i \x3d\x3d 1 ? matrix[1] : i \x3d\x3d 2 ? matrix[2] : matrix[3];\r\n\r\n    vec4 lv \x3d mat * vec4(vpos, 1.0);\r\n    lv.xy /\x3d lv.w;\r\n\r\n    //vertex completely outside? -\x3e no shadow\r\n    vec3 lvpos \x3d .5 * lv.xyz + vec3(.5);\r\n    if (lvpos.z \x3e\x3d 1.0) return .0;\r\n    if (lvpos.x \x3c .0 || lvpos.x \x3e 1.0 || lvpos.y \x3c .0 || lvpos.y \x3e 1.0) return .0;\r\n\r\n    //calc coord in cascade texture\r\n    vec2 uv \x3d vec2(float(i - 2 * (i / 2)) *.5, float(i / 2) * .5) + .5 * lvpos.xy;\r\n\r\n    float texSize \x3d .5 / halfPxSz;\r\n\r\n    //filter, offset by half pixels\r\n    vec2 st \x3d fract((vec2(halfPxSz) + uv) * texSize);\r\n\r\n    float s00 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPxSz, -halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\r\n    float s10 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPxSz, -halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\r\n    float s11 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPxSz, halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\r\n    float s01 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPxSz, halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\r\n\r\n    return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3c!--\r\n  Scene Lighting Definitions:\r\n  \x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n\r\n  defines:\r\n    - SH_ORDER: 1|2|3\r\n  input:\r\n    - normal: vec3\r\n    - albedo: vec3\r\n    - shadow: float\r\n    - ssao: float\r\n  return:\r\n    - color: vec3\r\n--\x3e\r\n\x3csnippet name\x3d"sceneLightingDefinitions"\x3e\x3c![CDATA[\r\n  $viewingMode\r\n\r\n  // main light\r\n  /////////////////////////////////////////\r\n  uniform vec3 lightingMainDirection;\r\n  uniform vec3 lightingMainIntensity;\r\n\r\n  // ambient lighting\r\n  /////////////////////////////////////////\r\n  #ifndef SH_ORDER\r\n    #define SH_ORDER 2\r\n  #endif\r\n\r\n  #if SH_ORDER \x3d\x3d 0\r\n    uniform vec3 lightingAmbientSH0;\r\n  #elif SH_ORDER \x3d\x3d 1\r\n    uniform vec4 lightingAmbientSH_R;\r\n    uniform vec4 lightingAmbientSH_G;\r\n    uniform vec4 lightingAmbientSH_B;\r\n  #elif SH_ORDER \x3d\x3d 2\r\n    uniform vec3 lightingAmbientSH0;\r\n    uniform vec4 lightingAmbientSH_R1;\r\n    uniform vec4 lightingAmbientSH_G1;\r\n    uniform vec4 lightingAmbientSH_B1;\r\n    uniform vec4 lightingAmbientSH_R2;\r\n    uniform vec4 lightingAmbientSH_G2;\r\n    uniform vec4 lightingAmbientSH_B2;\r\n  #endif\r\n\r\n  // special tweaking\r\n  //////////////////////////////////////////\r\n  uniform float lightingFixedFactor;\r\n  uniform float lightingGlobalFactor;\r\n\r\n  uniform float ambientBoostFactor;\r\n\r\n  // evaluation\r\n  //////////////////////////////////////////\r\n\r\n  vec3 evaluateSceneLighting(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {\r\n    // evaluate the main light\r\n    float dotVal \x3d mix(clamp(-dot(normal, lightingMainDirection), 0.0, 1.0), 1.0, lightingFixedFactor);\r\n    vec3 mainLight \x3d (1.0 - shadow) * lightingMainIntensity * dotVal;\r\n\r\n    // evaluate the sh ambient light\r\n    #if SH_ORDER \x3d\x3d 0\r\n      vec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\r\n    #elif SH_ORDER \x3d\x3d 1\r\n      vec4 sh0 \x3d vec4(\r\n        0.282095,\r\n        0.488603 * normal.x,\r\n        0.488603 * normal.z,\r\n        0.488603 * normal.y\r\n      );\r\n      vec3 ambientLight \x3d vec3(\r\n        dot(lightingAmbientSH_R, sh0),\r\n        dot(lightingAmbientSH_G, sh0),\r\n        dot(lightingAmbientSH_B, sh0)\r\n      );\r\n    #elif SH_ORDER \x3d\x3d 2\r\n      vec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\r\n\r\n      vec4 sh1 \x3d vec4(\r\n        0.488603 * normal.x,\r\n        0.488603 * normal.z,\r\n        0.488603 * normal.y,\r\n        1.092548 * normal.x * normal.y\r\n      );\r\n      vec4 sh2 \x3d vec4(\r\n        1.092548 * normal.y * normal.z,\r\n        0.315392 * (3.0 * normal.z * normal.z - 1.0),\r\n        1.092548 * normal.x * normal.z,\r\n        0.546274 * (normal.x * normal.x - normal.y * normal.y)\r\n      );\r\n      ambientLight +\x3d vec3(\r\n        dot(lightingAmbientSH_R1, sh1),\r\n        dot(lightingAmbientSH_G1, sh1),\r\n        dot(lightingAmbientSH_B1, sh1)\r\n      );\r\n      ambientLight +\x3d vec3(\r\n        dot(lightingAmbientSH_R2, sh2),\r\n        dot(lightingAmbientSH_G2, sh2),\r\n        dot(lightingAmbientSH_B2, sh2)\r\n      );\r\n    #endif\r\n    ambientLight *\x3d (1.0 - ssao);\r\n\r\n    // inverse gamma correction on the albedo color\r\n    float gamma \x3d 2.1;\r\n    vec3 albedoGammaC \x3d pow(albedo, vec3(gamma));\r\n\r\n    // physically correct BRDF normalizes by PI\r\n    const float PI \x3d 3.14159;\r\n    vec3 totalLight \x3d mainLight + ambientLight + additionalLight;\r\n    totalLight \x3d min(totalLight, vec3(PI, PI, PI));\r\n    vec3 outColor \x3d vec3((albedoGammaC / PI) * (totalLight));\r\n\r\n    // apply gamma correction to the computed color\r\n    outColor \x3d pow(outColor, vec3(1.0/gamma));\r\n\r\n    return outColor;\r\n  }\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"sceneLightingAdditionalLightGlobal"\x3e\x3c![CDATA[\r\n  vec3 sceneLightingAdditionalLightGlobal(vec3 worldPos, float ssao, out float additionalAmbientScale) {\r\n    // heuristic lighting model originally used in the terrain shading\r\n    // now used to generated additional ambient light\r\n\r\n#ifdef VIEWING_MODE_GLOBAL\r\n\r\n      float vndl \x3d -dot(normalize(worldPos), lightingMainDirection);\r\n\r\n#else\r\n\r\n      float vndl \x3d -dot(vec3(0,0,1), lightingMainDirection);\r\n\r\n#endif\r\n\r\n    additionalAmbientScale \x3d smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\r\n    return ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"normal2envTC"\x3e\x3c![CDATA[\r\n  vec2 normal2envTC(vec3 normal) {\r\n    float v \x3d .5 + .5 * asin(normal.y) * 0.63661977;\r\n    float u \x3d .5 - .5 * atan(normal.z, normal.x) * 0.31830988;\r\n    return vec2(u, v);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderShowDepth"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  uniform mat4 proj;\r\n  attribute vec2 $position;\r\n  attribute vec2 $uv0;\r\n  varying vec2 vtc;\r\n\r\n  void main(void) {\r\n    gl_Position \x3d proj * vec4($position.x, $position.y, .0, 1.0);\r\n    vtc \x3d $uv0;\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n  \x3csnippet name\x3d"fragmentShaderShowDepth"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  uniform sampler2D depthTex;\r\n  varying vec2 vtc;\r\n  $rgba2float\r\n  void main() {\r\n  // gl_FragColor \x3d vec4(vec3(texture2D(depthTex, vtc).a), 1.0);\r\n     gl_FragColor \x3d vec4(rgba2float(texture2D(depthTex, vtc)));\r\n  // gl_FragColor \x3d texture2D(depthTex, vtc);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsUVQuad"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  attribute vec2 $position;\r\n  varying vec2 uv;\r\n\r\n  void main(void) {\r\n    gl_Position \x3d vec4($position.x, $position.y, .0, 1.0);\r\n    uv \x3d $position * .5 + vec2(.5);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"toScreenCoords"\x3e\x3c![CDATA[\r\n  vec4 toScreenCoords(vec3 vertex) {\r\n    vec4 vClipSpace \x3d proj * view * vec4((model * vec4(vertex, 1.0)).xyz, 1.0);\r\n    vClipSpace.xy *\x3d screenSize;\r\n    return vClipSpace/abs(vClipSpace.w);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vvUniforms"\x3e\x3c![CDATA[\r\n#if defined(VV_SIZE)\r\n  #define VV_CUSTOM_MODEL_MATRIX\r\n#endif\r\n\r\n#if defined(VV_SIZE)\r\n  uniform vec3 vvSizeMinSize;\r\n  uniform vec3 vvSizeMaxSize;\r\n  uniform vec3 vvSizeOffset;\r\n  uniform vec3 vvSizeFactor;\r\n#elif defined(VV_CUSTOM_MODEL_MATRIX)\r\n  uniform vec3 vvSizeValue;\r\n#endif\r\n\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n  uniform mat3 vvSymbolRotation;\r\n#endif\r\n\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n  uniform vec3 vvSymbolAnchor;\r\n#endif\r\n\r\n#ifdef VV_COLOR\r\n  #define VV_COLOR_N 8\r\n  uniform float vvColorValues[VV_COLOR_N];\r\n  uniform vec4 vvColorColors[VV_COLOR_N];\r\n#endif\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vvFunctions"\x3e\x3c![CDATA[\r\n// Evaluation of size\r\n#if defined(VV_SIZE)\r\n  vec3 vvGetScale(vec4 featureAttribute) {\r\n    return clamp(vvSizeOffset + featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\r\n  }\r\n#elif defined(VV_CUSTOM_MODEL_MATRIX)\r\n  vec3 vvGetScale(vec4 featureAttribute) {\r\n    return vvSizeValue;\r\n  }\r\n#endif\r\n\r\n// Applying the model matrix\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n  vec4 vvTransformPosition(vec3 position, vec4 featureAttribute) {\r\n    return vec4(vvSymbolRotation * (vvGetScale(featureAttribute) * (position + vvSymbolAnchor)), 1.0);\r\n  }\r\n\r\n  vec4 vvTransformNormal(vec3 normal, vec4 featureAttribute) {\r\n    // Normal transform is the inverse transpose of model transform\r\n    return vec4(vvSymbolRotation * normal / vvGetScale(featureAttribute), 1.0);\r\n  }\r\n#endif\r\n\r\n#ifdef VV_COLOR\r\n  vec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\r\n    float value \x3d featureAttribute.y;\r\n    if (value \x3c\x3d values[0]) {\r\n      return colors[0];\r\n    }\r\n\r\n    for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\r\n      if (values[i] \x3e\x3d value) {\r\n        float f \x3d (value - values[i-1]) / (values[i] - values[i-1]);\r\n        return mix(colors[i-1], colors[i], f);\r\n      }\r\n    }\r\n\r\n    return colors[VV_COLOR_N - 1];\r\n  }\r\n#endif\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"rgb2hsv"\x3e\x3c![CDATA[\r\nvec3 rgb2hsv(vec3 c)\r\n{\r\n  vec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\r\n  vec4 p \x3d mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\r\n  vec4 q \x3d mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\r\n\r\n  float d \x3d q.x - min(q.w, q.y);\r\n  float e \x3d 1.0e-10;\r\n  return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\r\n}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"hsv2rgb"\x3e\x3c![CDATA[\r\nvec3 hsv2rgb(vec3 c)\r\n{\r\n  vec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\r\n  vec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\r\n  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\r\n}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"colorMixMode"\x3e\x3c![CDATA[\r\n$rgb2hsv\r\n$hsv2rgb\r\n\r\n\r\n/*\r\n * The color mix modes are encoded in the symbol color as follows:\r\n *  - Fully transparent symbols are represented with alpha 0 for\r\n *    all color mix modes (except ignore).\r\n *  - color mix mode ignore is encoded as multiply with white\r\n *  - the other 3 color mix modes (tint, replace, multiply) are\r\n *    equally distributed on the remaining 255 alpha values, which\r\n *    gives us 85 possible alpha values\r\n *\r\n * alpha             0 : fully transparent\r\n * alpha in [  1 -  85]: tint\r\n * alpha in [ 86 - 170]: replace\r\n * alpha in [171 - 255]: multiply\r\n */\r\nvec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\r\n  float symbolAlpha \x3d 0.0;\r\n\r\n  const float maxTint \x3d 85.0;\r\n  const float maxReplace \x3d 170.0;\r\n  const float scaleAlpha \x3d 3.0;\r\n\r\n  if (symbolColor.a \x3d\x3d 0.0) {\r\n    colorMixMode \x3d 1; // fully transparent -\x3e multiply\r\n    symbolAlpha \x3d 0.0;\r\n  }\r\n  else if (symbolColor.a \x3c\x3d maxTint) {\r\n    colorMixMode \x3d 0; // tint\r\n    symbolAlpha \x3d scaleAlpha * symbolColor.a;\r\n  }\r\n  else if (symbolColor.a \x3c\x3d maxReplace) {\r\n    colorMixMode \x3d 3; // replace\r\n    symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxTint);\r\n  }\r\n  else {\r\n    colorMixMode \x3d 1;  // multiply\r\n    symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxReplace);\r\n  }\r\n\r\n  return vec4(symbolColor.rgb, symbolAlpha);\r\n}\r\n\r\nvec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\r\n\r\n  // workaround for artifacts in OSX using Intel Iris Pro\r\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\r\n  vec3 internalMixed \x3d internalColor * textureColor;\r\n  vec3 allMixed \x3d internalMixed * externalColor;\r\n\r\n  if (mode \x3d\x3d 1 /* multiply */) {\r\n    return allMixed;\r\n  }\r\n  else if (mode \x3d\x3d 2 /* ignore */ ) {\r\n    return internalMixed;\r\n  }\r\n  else if (mode \x3d\x3d 3 /* replace */ ) {\r\n    return externalColor;\r\n  }\r\n  else {\r\n    // tint (or something invalid)\r\n    vec3 hsvIn \x3d rgb2hsv(internalMixed);\r\n    vec3 hsvTint \x3d rgb2hsv(externalColor);\r\n    vec3 hsvOut \x3d vec3(hsvTint.x, hsvTint.y, hsvIn.z * hsvTint.z);\r\n    return hsv2rgb(hsvOut);\r\n  }\r\n}\r\n\r\nfloat mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\r\n\r\n  // workaround for artifacts in OSX using Intel Iris Pro\r\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\r\n  float internalMixed \x3d internalOpacity * textureOpacity;\r\n  float allMixed \x3d internalMixed * externalOpacity;\r\n\r\n  if (mode \x3d\x3d 2 /* ignore */ ) {\r\n    return internalMixed;\r\n  }\r\n  else if (mode \x3d\x3d 3 /* replace */ ) {\r\n    return externalOpacity;\r\n  }\r\n  else {\r\n    // multiply or tint (or something invalid)\r\n    return allMixed;\r\n  }\r\n}\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"highlightWrite"\x3e\x3c![CDATA[\r\n  // the following uniforms are common to all highlight shaders:\r\n  // uniform sampler2D depthTex\r\n  // uniform vec4 highlightViewportPixelSz\r\n  float sceneDepth \x3d texture2D(depthTex, (gl_FragCoord.xy - highlightViewportPixelSz.xy) * highlightViewportPixelSz.zw).r;\r\n  if (gl_FragCoord.z \x3e sceneDepth + 5e-6) {\r\n    gl_FragColor \x3d vec4(1.0, 1.0, 0.0, 1.0);\r\n  }\r\n  else {\r\n    gl_FragColor \x3d vec4(1.0, 0.0, 1.0, 1.0);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"screenSizePerspective"\x3e\x3c![CDATA[\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n// Note that the implementation here should be kept in sync with the corresponding\r\n// CPU implementation (used for hitTest etc) in screenSizePerspectiveUtils.ts\r\n\r\n/**\r\n * Compute the screen size perspective lower bound from pre-computed screen\r\n * size perspective factors (or parameters, since both store the pixel lower\r\n * bound information in the same place). When computing the minimum size,\r\n * the padding (e.g. text halo) is scaled with the same factor as the\r\n * original size scales to reach the minimum size.\r\n *\r\n * {\r\n *    x: N/A\r\n *    y: N/A\r\n *    z: minPixelSize (abs),\r\n *    w: sizePaddingInPixels (abs)\r\n * }\r\n */\r\nfloat screenSizePerspectiveMinSize(float size, vec4 factor) {\r\n\r\n  // Original calculation:\r\n  //   padding \x3d 2 * factor.w\r\n  //   minSize \x3d factor.z\r\n  //\r\n  //   minSize + minSize / size * padding\r\n  //\r\n  // Incorporates padding (factor.w, e.g. text halo size) into the\r\n  // minimum bounds calculation, taking into account that padding\r\n  // would scale down proportionally to the size.\r\n  //\r\n  // Calculation below is the same, but avoids division by zero when\r\n  // size would be zero, without branching using step.\r\n  // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10683\r\n\r\n  // nonZeroSize is 1 if size \x3e 0, and 0 otherwise\r\n  float nonZeroSize \x3d 1.0 - step(size, 0.0);\r\n\r\n  return (\r\n    factor.z * (\r\n      1.0 +\r\n      nonZeroSize *                // Multiply by nzs ensures if size is 0, then we ignore\r\n                                   // proportionally scaled padding\r\n      2.0 * factor.w / (\r\n        size + (1.0 - nonZeroSize) // Adding 1 - nzs ensures we divide either by size, or by 1\r\n      )\r\n    )\r\n  );\r\n}\r\n\r\n/**\r\n * Computes the view angle dependent screen size perspective factor. The goal\r\n * of this factor is that:\r\n *\r\n *   1. There is no perspective when looking top-down\r\n *   2. There is a smooth and quick transition to full perspective when\r\n *      tilting.\r\n */\r\nfloat screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {\r\n  return absCosAngle * absCosAngle * absCosAngle;\r\n}\r\n\r\n/**\r\n * Precomputes a set of factors that can be used to apply screen size perspective\r\n * The factors are based on the viewing angle, distance to camera and the screen size\r\n * perspective parameters:\r\n * {\r\n *    x: distanceDivisor,\r\n *    y: distanceOffset,\r\n *    z: minPixelSize (abs),\r\n *    w: sizePaddingInPixels (abs)\r\n * }\r\n *\r\n * The result is a set of factors that can be used to apply the perspective:\r\n *\r\n * {\r\n *    x: distance based relative scale factor (0 -\x3e 1)\r\n *    y: view dependent scale factor\r\n *    z: minPixelSize (abs)\r\n *    w: sizePaddingInPixels (abs)\r\n * }\r\n */\r\nvec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {\r\n  return vec4(min(params.x / (distanceToCamera - params.y), 1.0), screenSizePerspectiveViewAngleDependentFactor(absCosAngle), params.z, params.w);\r\n}\r\n\r\n/**\r\n * Applies screen size perspective factors to a single dimension size, given the viewing angle,\r\n * distance to camera and perspective parameters. The factors can be calculated from the screen size\r\n * perspective parameters using screenSizePerspectiveScaleFactorFloat.\r\n *\r\n * Note that for single scale application, the screenSizePerspectiveScaleFloat can be used, which\r\n * will call this method, providing it the factors calculated from screenSizePerspectiveScaleFactorFloat.\r\n */\r\n\r\nfloat applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {\r\n  return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));\r\n}\r\n\r\n/**\r\n * Applies screen size perspective parameters to a single dimension size, given the viewing angle,\r\n * distance to camera and perspective parameters\r\n * {\r\n *    x: distanceDivisor,\r\n *    y: distanceOffset,\r\n *    z: minPixelSize (abs),\r\n *    w: sizePaddingInPixels (abs)\r\n * }\r\n */\r\nfloat screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {\r\n  return applyScreenSizePerspectiveScaleFactorFloat(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\r\n}\r\n\r\n/**\r\n * Applies screen size perspective factors to a vec2 size (width/height), given the viewing angle,\r\n * distance to camera and perspective parameters. The factors can be calculated from the screen size\r\n * perspective parameters using screenSizePerspectiveScaleFactorVec2.\r\n *\r\n * Note that for single scale application, the screenSizePerspectiveScaleVec2 can be used, which\r\n * will call this method, providing it the factors calculated from screenSizePerspectiveScaleFactorVec2.\r\n */\r\nvec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {\r\n  return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);\r\n}\r\n\r\n/**\r\n * Applies screen size perspective parameters to a vec2 size (width/height), given the viewing angle,\r\n * distance to camera and perspective parameters\r\n * {\r\n *    x: distanceDivisor,\r\n *    y: distanceOffset,\r\n *    z: minPixelSize (abs),\r\n *    w: sizePaddingInPixels (abs)\r\n * }\r\n */\r\nvec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {\r\n  return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\r\n}\r\n\r\n#endif\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"computeNormal"\x3e\x3c![CDATA[\r\n  #ifdef GROUND_NORMAL_SHADING\r\n    #ifdef VIEWING_MODE_GLOBAL\r\n      vec3 normal \x3d normalize(vpos + localOrigin);\r\n    #else\r\n      vec3 normal \x3d vec3(0,0,1);\r\n    #endif\r\n  #else\r\n    // compute normal\r\n    #ifdef DOUBLESIDED\r\n      vec3 normal \x3d dot(vnormal, viewDir)\x3e0.0 ? -vnormal : vnormal;\r\n    #elif defined(WINDINGORDERDOUBLESIDED)\r\n      vec3 normal \x3d gl_FrontFacing ? vnormal : -vnormal;\r\n    #else\r\n      vec3 normal \x3d vnormal;\r\n    #endif\r\n    normal \x3d normalize(normal);\r\n  #endif\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"decodeNormal"\x3e\x3c![CDATA[\r\nvec3 decodeNormal(vec2 f)\r\n{\r\n    float z \x3d 1.0 - abs(f.x) - abs(f.y);\r\n    return vec3(f + sign(f) * min(z, 0.0), z);\r\n}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/CheckerBoardMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vsCheckerBoard"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  uniform mat4 proj;\r\n  uniform mat4 view;\r\n  uniform mat4 model;\r\n\r\n  attribute vec3 $position;\r\n  attribute vec2 $uv0;\r\n\r\n  varying vec2 vUV;\r\n\r\n  void main(void) {\r\n    vUV \x3d $uv0;\r\n    gl_Position \x3d proj * view * vec4((model * vec4($position, 1.0)).xyz, 1.0);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsCheckerBoard"\x3e\x3c![CDATA[\r\n  $enableRequiredExtensions\r\n  $fsprecisionf\r\n\r\n  uniform vec2 size;\r\n  uniform vec4 color1;\r\n  uniform vec4 color2;\r\n\r\n  varying vec2 vUV;\r\n\r\n  void main() {\r\n    vec2 uvScaled \x3d vUV / (2.0 * size);\r\n\r\n    vec2 uv \x3d fract(uvScaled - 0.25);\r\n    vec2 ab \x3d clamp((abs(uv - 0.5) - 0.25) / fwidth(uvScaled), -0.5, 0.5);\r\n    float fade \x3d smoothstep(0.25, 0.5, max(fwidth(uvScaled.x), fwidth(uvScaled.y)));\r\n    float t \x3d mix(abs(ab.x + ab.y), 0.5, fade);\r\n\r\n    gl_FragColor \x3d mix(color2, color1, t);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/ColorMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderColorMaterial"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  uniform mat4 proj;\r\n  uniform mat4 view;\r\n  uniform mat4 model;\r\n\r\n  attribute vec3 $position;\r\n#ifdef VERTEXCOLORS\r\n  attribute vec4 $color;\r\n\r\n  varying vec4 vColor;\r\n#endif\r\n\r\n  void main(void) {\r\n#ifdef VERTEXCOLORS\r\n    vColor \x3d $color * 0.003921568627451; // \x3d 1/255;\r\n#endif\r\n    gl_Position \x3d proj * view * vec4((model * vec4($position, 1.0)).xyz, 1.0);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderColorMaterial"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  uniform vec4 eColor;\r\n#ifdef VERTEXCOLORS\r\n  varying vec4 vColor;\r\n#endif\r\n\r\n  void main() {\r\n#ifdef VERTEXCOLORS\r\n    gl_FragColor \x3d vColor * eColor;\r\n#else\r\n    gl_FragColor \x3d eColor;\r\n#endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/DefaultMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"calculateVerticalOffset"\x3e\x3c![CDATA[\r\n  $viewingMode\r\n\r\n#ifdef VERTICAL_OFFSET\r\n  // [ verticalOffsetPerDistance, minWorldLength, maxWorldLength ]\r\n  uniform vec4 verticalOffset;\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n  uniform vec4 screenSizePerspectiveAlignment;\r\n\r\n  $screenSizePerspective\r\n\r\n#endif\r\n\r\n  vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\r\n    float viewDistance \x3d length((view * vec4(worldPos, 1)).xyz);\r\n    float verticalOffsetOffsetDistance \x3d verticalOffset.x * viewDistance;\r\n\r\n#ifdef VIEWING_MODE_GLOBAL\r\n    vec3 worldNormal \x3d normalize(worldPos + localOrigin);\r\n#else\r\n    vec3 worldNormal \x3d vec3(0, 0, 1);\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n    float cosAngle \x3d dot(worldNormal, normalize(worldPos - camPos));\r\n\r\n    float verticalOffsetScreenHeight \x3d screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);\r\n#else\r\n    float verticalOffsetScreenHeight \x3d verticalOffset.x;\r\n#endif\r\n\r\n    // Screen sized offset in world space, used for example for line callouts\r\n    float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\r\n\r\n    return worldNormal * worldOffset;\r\n  }\r\n#endif\r\n]]\x3e\r\n\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsViewInputs"\x3e\x3c![CDATA[\r\n  uniform mat4 proj;\r\n  uniform mat4 view;\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\n  uniform vec3 viewOriginHi;\r\n  uniform vec3 viewOriginLo;\r\n#endif\r\n  uniform vec3 camPos;\r\n  uniform vec3 localOrigin;\r\n]]\x3e\r\n\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsTransformInputs"\x3e\x3c![CDATA[\r\n#ifdef INSTANCED\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\n  attribute vec3 modelOriginHi;\r\n  attribute vec3 modelOriginLo;\r\n  attribute mat3 model;\r\n  attribute mat3 modelNormal;\r\n#else\r\n  attribute mat4 model;\r\n  attribute mat4 modelNormal;\r\n#endif\r\n#else /* INSTANCED */\r\n  uniform mat4 model;\r\n  uniform mat4 modelNormal;\r\n#endif /* INSTANCED */\r\n]]\x3e\r\n\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsLocalPosition"\x3e\x3c![CDATA[\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\nvec4 localPosition() { return vvTransformPosition($position, instanceFeatureAttribute); }\r\n#else\r\nvec4 localPosition() { return vec4($position, 1.0); }\r\n#endif\r\n]]\x3e\r\n\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsLocalNormal"\x3e\x3c![CDATA[\r\n  $decodeNormal\r\n\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n# ifdef COMPRESSED_NORMALS\r\nvec4 localNormal() { return vvTransformNormal(decodeNormal($normalCompressed), instanceFeatureAttribute); }\r\n# else\r\nvec4 localNormal() { return vvTransformNormal($normal, instanceFeatureAttribute); }\r\n# endif\r\n#else\r\n# ifdef COMPRESSED_NORMALS\r\nvec4 localNormal() { return vec4(decodeNormal($normalCompressed), 1.0); }\r\n# else\r\nvec4 localNormal() { return vec4($normal, 1.0); }\r\n# endif\r\n#endif\r\n]]\x3e\r\n\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsLocalCenter"\x3e\x3c![CDATA[\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n# ifdef VERTICAL_OFFSET\r\nvec4 localCenter() { return vvTransformPosition(vec3(0, 0, 0), instanceFeatureAttribute); }\r\n# endif\r\n#else\r\n# ifdef VERTICAL_OFFSET\r\nvec4 localCenter() { return vec4(vec3(0, 0, 0), 1.0); }\r\n# endif\r\n#endif\r\n]]\x3e\r\n\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"doublePrecisionArithmethic"\x3e\x3c![CDATA[\r\n// based on https://www.thasler.com/blog/blog/glsl-part2-emu\r\nvec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\r\n  vec3 t1 \x3d hiA + hiB;\r\n  vec3 e \x3d t1 - hiA;\r\n  vec3 t2 \x3d ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\r\n  return t1 + t2;\r\n}\r\n]]\x3e\r\n\x3c/snippet\x3e\r\n\r\n\x3c!-- Keep is synchronized with the logic in Material.js:isVisible --\x3e\r\n\x3csnippet name\x3d"externalColorMix"\x3e\x3c![CDATA[\r\n  vec3 matColor \x3d max(ambient, diffuse); // combine the old material parameters into a single one\r\n  #if defined(VERTEXCOLORS)\r\n      // Internal colors: varying vcolor + uniform ambient/diffuse, external colors: varying vcolorExt\r\n      vec3 albedo_ \x3d mixExternalColor(vcolor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\r\n      float opacity_ \x3d layerOpacity * mixExternalOpacity(vcolor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));\r\n  #else\r\n      // Internal colors: uniform ambient/diffuse, external colors: varying vcolorExt\r\n      vec3 albedo_ \x3d mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\r\n      float opacity_ \x3d layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\r\n  #endif\r\n  albedo_+\x3d 0.25 * specular; // don\'t completely ignore specular for now\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"calcMipMapLevel"\x3e\x3c![CDATA[\r\n  float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\r\n    // from:\r\n    //   - OpenGLES Common Profile Specification Version 2.0.25, Section 3.7.7 - Texture Minification\r\n    //   - https://www.opengl.org/discussion_boards/showthread.php/171485-Texture-LOD-calculation-(useful-for-atlasing)\r\n    //   - http://www.linedef.com/virtual-texture-demo.html\r\n    float deltaMaxSqr \x3d max(dot(ddx, ddx), dot(ddy, ddy));\r\n    return max(0.0, 0.5 * log2(deltaMaxSqr));\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"coverageCorrectionFactor"\x3e\x3c![CDATA[\r\n  // base on https://medium.com/@bgolus/anti-aliased-alpha-test-the-esoteric-alpha-to-coverage-8b177335ae4f\r\n  float coverageCorrectionFactor(vec2 uv) {\r\n#ifdef ALPHA_COVERAGE_CORRECTION\r\n    const float MipScale \x3d 0.25;\r\n    uv *\x3d texSize;\r\n    return 1.0 + max(0.0, calcMipMapLevel(dFdx(uv), dFdy(uv))) * MipScale;\r\n#else\r\n    return 1.0;\r\n#endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"alphaThreshold"\x3e\x3c![CDATA[\r\n#ifdef ALPHA_COVERAGE_CORRECTION\r\n  #define ALPHA_THRESHOLD 0.5\r\n#else\r\n  #define ALPHA_THRESHOLD 0.33\r\n#endif\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsPhongSrc"\x3e\x3c![CDATA[\r\n  $vsViewInputs\r\n  $vsTransformInputs\r\n\r\n#ifdef INSTANCEDCOLOR\r\n  attribute vec4 instanceColor;\r\n#endif\r\n  attribute vec3 $position;\r\n#ifdef COMPRESSED_NORMALS\r\n  attribute vec2 $normalCompressed;\r\n#else\r\n  attribute vec3 $normal;\r\n#endif\r\n  varying vec3 vpos;\r\n  varying vec3 vnormal;\r\n\r\n#ifdef COMPONENTCOLORS\r\n  uniform sampler2D uComponentColorTex;\r\n  uniform vec2 uComponentColorTexInvDim;\r\n\r\n  attribute float $componentIndex;\r\n\r\n  vec4 readComponentColor() {\r\n    float normalizedIndex \x3d ($componentIndex + 0.5) * uComponentColorTexInvDim.x;\r\n    vec2 indexCoord \x3d vec2(\r\n      mod(normalizedIndex, 1.0),\r\n      (floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y\r\n    );\r\n    return texture2D(uComponentColorTex, indexCoord);\r\n  }\r\n#endif\r\n\r\n#ifdef RECEIVE_SHADOWS\r\n  varying float linearDepth;\r\n#endif\r\n\r\n#ifdef VERTEXCOLORS\r\n  attribute vec4 $color;\r\n#endif\r\n\r\n#ifdef SYMBOLVERTEXCOLORS\r\n  attribute vec4 $symbolColor;\r\n#endif\r\n\r\n#if defined(VV_SIZE) || defined(VV_COLOR)\r\n  attribute vec4 instanceFeatureAttribute;\r\n#endif\r\n\r\n$vvUniforms\r\n\r\n#if defined(VERTEXCOLORS)\r\n  varying vec4 vcolor;\r\n#endif\r\n\r\n  // Workaround for https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/13452\r\n  // We pass the externalColor uniform from VS to FS through the vcolorExt varying because\r\n  // there is a driver bug for Intel Integrated Graphics which led to rendering artifacts\r\n  // since the introduction of https://devtopia.esri.com/WebGIS/arcgis-js-api/pull/12673\r\n  // This should be further cleaned up later with through the following issue:\r\n  // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12763\r\n  uniform vec4 externalColor;\r\n  varying vec4 vcolorExt;\r\n\r\n#if defined(SYMBOLVERTEXCOLORS) || defined(COMPONENTCOLORS)\r\n  varying mediump float colorMixMode; // varying int is not supported in WebGL\r\n#endif\r\n\r\n  $vvFunctions\r\n\r\n  $colorMixMode\r\n\r\n  $calculateVerticalOffset\r\n\r\n  $vsLocalPosition\r\n  $vsLocalNormal\r\n  $vsLocalCenter\r\n  $doublePrecisionArithmethic\r\n\r\n  void main(void) {\r\n\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\n    vpos \x3d model * localPosition().xyz ;\r\n    vnormal \x3d normalize(modelNormal * localNormal().xyz);\r\n\r\n    vec3 originDelta \x3d dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\r\n    vpos -\x3d originDelta;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n    vec3 centerPos \x3d model * localCenter().xyz;\r\n    vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n#else /* INSTANCED_DOUBLE_PRECISION */\r\n    vpos \x3d (model * localPosition()).xyz;\r\n    vnormal \x3d normalize((modelNormal * localNormal()).xyz);\r\n\r\n#ifdef VERTICAL_OFFSET\r\n    vec3 centerPos \x3d (model * localCenter()).xyz;\r\n    vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n#endif /* INSTANCED_DOUBLE_PRECISION */\r\n\r\n    gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n\r\n#ifdef RECEIVE_SHADOWS\r\n    // Shadowmap\'s cascading index used to be based on \'1.0 / gl_FragCoord.w\'\r\n    // (i.e. the perspective interpolation of \'gl_Position.w\'). Precision\r\n    // issues on iPad/iPhone with the \'w\' component require the depth to be\r\n    // passed as varying to properly drive the cascading shadow map index.\r\n    linearDepth \x3d gl_Position.w;\r\n#endif\r\n\r\n#ifdef VERTEXCOLORS\r\n    vcolor \x3d $color * 0.003921568627451; // \x3d 1/255\r\n#endif\r\n\r\n    vcolorExt \x3d externalColor;\r\n\r\n#ifdef INSTANCEDCOLOR\r\n    vcolorExt *\x3d instanceColor;\r\n#endif\r\n#ifdef VV_COLOR\r\n    vcolorExt *\x3d vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);\r\n#endif\r\n#ifdef SYMBOLVERTEXCOLORS\r\n    int symbolColorMixMode;\r\n    vcolorExt *\x3d decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451; // \x3d 1/255;\r\n    colorMixMode \x3d float(symbolColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\r\n#endif\r\n#ifdef COMPONENTCOLORS\r\n    int symbolColorMixMode;\r\n    vcolorExt *\x3d decodeSymbolColor(readComponentColor() * 255.0, symbolColorMixMode) * 0.003921568627451; // \x3d 1/255;\r\n    colorMixMode \x3d float(symbolColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\r\n#endif\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsPhongSrc"\x3e\x3c![CDATA[\r\n  uniform vec3 camPos;\r\n  uniform vec3 localOrigin;\r\n\r\n  $sceneLightingDefinitions\r\n  $sceneLightingAdditionalLightGlobal\r\n\r\n  // material parameters\r\n  //////////////////////////////////////////\r\n  uniform vec3 ambient;\r\n  uniform vec3 diffuse;\r\n  uniform vec3 specular;\r\n  uniform float opacity;\r\n  uniform float layerOpacity;\r\n\r\n#if defined(SYMBOLVERTEXCOLORS) || defined(COMPONENTCOLORS)\r\n  varying mediump float colorMixMode; // varying int is not supported in WebGL\r\n#else\r\n  uniform int colorMixMode;\r\n#endif\r\n\r\n#ifdef RECEIVE_SHADOWS\r\n  uniform sampler2D depthTex;\r\n  uniform int shadowMapNum;\r\n  uniform vec4 shadowMapDistance;\r\n  uniform mat4 shadowMapMatrix[4];\r\n  uniform float depthHalfPixelSz;\r\n#endif\r\n\r\n#ifdef RECEIVE_SSAO\r\n  uniform sampler2D ssaoTex;\r\n  uniform vec4 viewportPixelSz;\r\n#endif\r\n\r\n\r\n  varying vec3 vpos;\r\n  varying vec3 vnormal;\r\n#if defined(VERTEXCOLORS)\r\n  varying vec4 vcolor;\r\n#endif\r\n  varying vec4 vcolorExt;\r\n\r\n#ifdef RECEIVE_SHADOWS\r\n  varying float linearDepth;\r\n  $evalShadow\r\n#endif\r\n\r\n  $colorMixMode\r\n\r\n  void main() {\r\n    vec3 viewDir \x3d normalize(vpos - camPos);\r\n\r\n    $computeNormal\r\n\r\n    vec3 reflDir \x3d normalize(reflect(viewDir, normal));\r\n\r\n    // compute ssao\r\n    #ifdef RECEIVE_SSAO\r\n        float ssao \x3d texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\r\n        ssao \x3d viewportPixelSz.z \x3c 0.0 ? 1.0 : ssao;\r\n    #else\r\n        float ssao \x3d 1.0;\r\n    #endif\r\n\r\n    // At global scale we create some additional ambient light based on the main light to simulate global illumination\r\n    float additionalAmbientScale;\r\n    vec3 additionalLight \x3d sceneLightingAdditionalLightGlobal(vpos + localOrigin, ssao, additionalAmbientScale);\r\n\r\n    // compute shadowing\r\n    float shadow \x3d 0.0;\r\n    #ifdef RECEIVE_SHADOWS\r\n      shadow \x3d evalShadow(vpos, linearDepth, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\r\n    #elif defined(VIEWING_MODE_GLOBAL)\r\n      // at global scale (and in global scenes) we fall back to this approximation\r\n      // to shadow objects on the dark side of the earth\r\n      shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);\r\n    #endif\r\n\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsPhong"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  $vsPhongSrc\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsPhong"\x3e\x3c![CDATA[\r\n    $fsprecisionf\r\n\r\n    $fsPhongSrc\r\n\r\n    vec4 texColor \x3d vec4(1,1,1,1);\r\n    $externalColorMix\r\n\r\n#ifdef TRANSPARENCY_DISCARD\r\n    if (opacity_ \x3c 0.001) {\r\n      discard;\r\n    }\r\n#endif\r\n\r\n    vec3 shadedColor \x3d evaluateSceneLighting(normal, albedo_, shadow, 1.0 - ssao, additionalLight);\r\n\r\n    gl_FragColor \x3d vec4(shadedColor, opacity_);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsPhongTextured"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  attribute vec2 $uv0;\r\n  varying vec2 vtc;\r\n  $vsPhongSrc\r\n#ifndef FLIPV\r\n    vtc \x3d $uv0;\r\n#else\r\n    vtc \x3d vec2($uv0.x, 1.0-$uv0.y);\r\n#endif\r\n\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsPhongTextured"\x3e\x3c![CDATA[\r\n  $enableRequiredExtensions\r\n  $fsprecisionf\r\n  $alphaThreshold\r\n\r\n  uniform sampler2D tex;\r\n  uniform vec2 texSize;\r\n  varying vec2 vtc;\r\n\r\n  $calcMipMapLevel\r\n  $coverageCorrectionFactor\r\n\r\n  $fsPhongSrc\r\n\r\n    // read texture color\r\n    vec4 texColor \x3d texture2D(tex, vtc);\r\n    if (texColor.a * coverageCorrectionFactor(vtc) \x3c ALPHA_THRESHOLD) {\r\n      discard;\r\n    }\r\n\r\n    $externalColorMix\r\n\r\n#ifdef TRANSPARENCY_DISCARD\r\n    if (opacity_ \x3c 0.001) {\r\n      discard;\r\n    }\r\n#endif\r\n\r\n    vec3 shadedColor \x3d evaluateSceneLighting(normal, albedo_, shadow, 1.0 - ssao, additionalLight);\r\n\r\n    gl_FragColor \x3d vec4(shadedColor, opacity_);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsPhongAtlasTextured"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  attribute vec4 $uv0;\r\n  attribute vec4 $region;\r\n  varying vec2 vtc;\r\n  varying vec4 regionV;\r\n  $vsPhongSrc\r\n#ifndef FLIPV\r\n    vtc \x3d $uv0.xy;\r\n#else\r\n    vtc \x3d vec2($uv0.x, 1.0-$uv0.y);\r\n#endif\r\n    regionV \x3d $region/65535.0;\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsPhongAtlasTextured"\x3e\x3c![CDATA[\r\n  $enableRequiredExtensions\r\n  $fsprecisionf\r\n  $alphaThreshold\r\n\r\n  uniform sampler2D tex;\r\n  uniform vec2 texSize;\r\n  varying vec2 vtc;\r\n  varying vec4 regionV;\r\n\r\n  $calcMipMapLevel\r\n  $coverageCorrectionFactor\r\n\r\n  $fsPhongSrc\r\n\r\n    vec2 uv \x3d vtc;\r\n    uv \x3d fract(uv);\r\n    //[umin, vmin, umax, vmax]\r\n\r\n    vec2 atlasScale \x3d regionV.zw - regionV.xy;\r\n    uv \x3d uv.xy * atlasScale + regionV.xy;\r\n\r\n    vec4 texColor;\r\n\r\n    // calculate derivative of continuous texture coordinate\r\n    // to avoid mipmapping artifacts caused by manual wrapping in shader\r\n    vec2 dUVdx \x3d dFdx(vtc) * atlasScale;\r\n    vec2 dUVdy \x3d dFdy(vtc) * atlasScale;\r\n\r\n    #ifdef GL_EXT_shader_texture_lod\r\n      #extension GL_EXT_shader_texture_lod : enable\r\n\r\n      // workaround for artifacts in Windows 10 using Intel HD Graphics 4000 series\r\n      // see: https://devtopia.esri.com/Zurich-R-D-Center/arcgis-js-api-canvas3d-issues/issues/768\r\n      const float epsilon \x3d 1.0E-32;\r\n      float zeroUVShift \x3d uv.x \x3d\x3d 0.0 \x26\x26 uv.y \x3d\x3d 0.0 ? epsilon : 0.0;\r\n\r\n      texColor \x3d texture2DGradEXT(tex, uv + zeroUVShift, dUVdx, dUVdy);\r\n    #else\r\n      // use bias to compensate for difference in automatic vs desired mipmap level\r\n      vec2 dUVdxAuto \x3d dFdx(uv);\r\n      vec2 dUVdyAuto \x3d dFdy(uv);\r\n      float mipMapLevel \x3d calcMipMapLevel(dUVdx * texSize, dUVdy * texSize);\r\n      float autoMipMapLevel \x3d calcMipMapLevel(dUVdxAuto * texSize, dUVdyAuto * texSize);\r\n      texColor \x3d texture2D(tex, uv, mipMapLevel - autoMipMapLevel);\r\n    #endif\r\n\r\n    if (texColor.a * coverageCorrectionFactor(uv) \x3c ALPHA_THRESHOLD) {\r\n      discard;\r\n    }\r\n\r\n    $externalColorMix\r\n\r\n#ifdef TRANSPARENCY_DISCARD\r\n    if (opacity_ \x3c 0.001) {\r\n      discard;\r\n    }\r\n#endif\r\n\r\n    vec3 shadedColor \x3d evaluateSceneLighting(normal, albedo_, shadow, 1.0 - ssao, additionalLight);\r\n    gl_FragColor \x3d vec4(shadedColor, opacity_);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsDepthSrc"\x3e\x3c![CDATA[\r\n  $vsViewInputs\r\n  $vsTransformInputs\r\n\r\n  uniform vec2 nearFar;\r\n  attribute vec3 $position;\r\n  varying float depth;\r\n\r\n  $vvUniforms\r\n#if defined(VV_CUSTOM_MODEL_MATRIX)\r\n  attribute vec4 instanceFeatureAttribute;\r\n#endif\r\n  $vvFunctions\r\n\r\n  $calculateVerticalOffset\r\n\r\n  $vsLocalPosition\r\n  $vsLocalCenter\r\n  $doublePrecisionArithmethic\r\n\r\n  void main(void) {\r\n\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\n    vec3 vpos \x3d model * localPosition().xyz;\r\n\r\n    vec3 originDelta \x3d dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\r\n    vpos -\x3d originDelta;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n    vec3 centerPos \x3d model * localCenter().xyz;\r\n    vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n#else /* INSTANCED_DOUBLE_PRECISION */\r\n    vec3 vpos \x3d (model * localPosition()).xyz;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n    vec3 centerPos \x3d (model * localCenter()).xyz;\r\n    vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n#endif /* INSTANCED_DOUBLE_PRECISION */\r\n\r\n    vec4 eye \x3d view * vec4(vpos, 1);\r\n\r\n    gl_Position \x3d proj * eye;\r\n    depth \x3d (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsDepth"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  $vsDepthSrc\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsDepthTextured"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  attribute vec2 $uv0;\r\n  varying vec2 vtc;\r\n  $vsDepthSrc\r\n#ifndef FLIPV\r\n        vtc \x3d $uv0;\r\n#else\r\n        vtc \x3d vec2($uv0.x, 1.0-$uv0.y);\r\n#endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsNormalSrc"\x3e\x3c![CDATA[\r\n  $vsViewInputs\r\n  $vsTransformInputs\r\n\r\n  uniform mat4 viewNormal;\r\n  attribute vec3 $position;\r\n#ifdef COMPRESSED_NORMALS\r\n  attribute vec2 $normalCompressed;\r\n#else\r\n  attribute vec3 $normal;\r\n#endif\r\n  varying vec3 vnormal;\r\n\r\n  $vvUniforms\r\n#if defined(VV_CUSTOM_MODEL_MATRIX)\r\n  attribute vec4 instanceFeatureAttribute;\r\n#endif\r\n  $vvFunctions\r\n\r\n  $calculateVerticalOffset\r\n\r\n  $vsLocalPosition\r\n  $vsLocalNormal\r\n  $vsLocalCenter\r\n  $doublePrecisionArithmethic\r\n\r\n  void main(void) {\r\n\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\n    vec3 vpos \x3d model * localPosition().xyz + modelOriginHi;\r\n    vnormal \x3d normalize((viewNormal * vec4(modelNormal * localNormal().xyz, 1.0)).xyz);\r\n\r\n    vec3 originDelta \x3d dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\r\n    vpos -\x3d originDelta;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n    vec3 centerPos \x3d model * localCenter().xyz;\r\n    vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n#else /* INSTANCED_DOUBLE_PRECISION */\r\n    vec3 vpos \x3d (model * localPosition()).xyz;\r\n    vnormal \x3d normalize((viewNormal * modelNormal * localNormal()).xyz);\r\n\r\n#ifdef VERTICAL_OFFSET\r\n    vec3 centerPos \x3d (model * localCenter()).xyz;\r\n    vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n#endif /* INSTANCED_DOUBLE_PRECISION */\r\n\r\n    gl_Position \x3d proj * view * vec4(vpos, 1);\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsNormal"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  $vsNormalSrc\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsNormalTextured"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  attribute vec2 $uv0;\r\n  varying vec2 vtc;\r\n  $vsNormalSrc\r\n#ifndef FLIPV\r\n    vtc \x3d $uv0;\r\n#else\r\n    vtc \x3d vec2($uv0.x, 1.0-$uv0.y);\r\n#endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsHighlightSrc"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  $vsViewInputs\r\n  $vsTransformInputs\r\n\r\n  attribute vec3 $position;\r\n\r\n  $vvUniforms\r\n#if defined(VV_CUSTOM_MODEL_MATRIX)\r\n  attribute vec4 instanceFeatureAttribute;\r\n#endif\r\n  $vvFunctions\r\n\r\n  $calculateVerticalOffset\r\n\r\n  $vsLocalPosition\r\n  $vsLocalCenter\r\n  $doublePrecisionArithmethic\r\n\r\n  void main(void) {\r\n\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\n    vec3 vpos \x3d model * localPosition().xyz;\r\n\r\n    vec3 originDelta \x3d dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\r\n    vpos -\x3d originDelta;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n    vec3 centerPos \x3d model * localCenter().xyz;\r\n    vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n#else /* INSTANCED_DOUBLE_PRECISION */\r\n    vec3 vpos \x3d (model * localPosition()).xyz;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n    vec3 centerPos \x3d (model * localCenter()).xyz;\r\n    vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n#endif /* INSTANCED_DOUBLE_PRECISION */\r\n\r\n    gl_Position \x3d proj * view * vec4(vpos, 1);\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsHighlight"\x3e\x3c![CDATA[\r\n  $vsHighlightSrc\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsHighlightTextured"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  attribute vec2 $uv0;\r\n  varying vec2 vtc;\r\n  $vsHighlightSrc\r\n#ifndef FLIPV\r\n    vtc \x3d $uv0;\r\n#else\r\n    vtc \x3d vec2($uv0.x, 1.0-$uv0.y);\r\n#endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsDepthSrc"\x3e\x3c![CDATA[\r\n  varying float depth;\r\n\r\n  void main() {\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsDepth"\x3e\x3c![CDATA[\r\n  $enableRequiredExtensions\r\n  $fsprecisionf\r\n\r\n  $calcFragDepth\r\n  $float2rgba\r\n  $fsDepthSrc\r\n#ifndef BIAS_SHADOWMAP\r\n    gl_FragColor \x3d float2rgba(depth);\r\n#else\r\n    gl_FragColor \x3d float2rgba(calcFragDepth(depth));\r\n#endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsDepthTextured"\x3e\x3c![CDATA[\r\n  $enableRequiredExtensions\r\n  $fsprecisionf\r\n  $alphaThreshold\r\n\r\n  uniform sampler2D tex;\r\n  uniform vec2 texSize;\r\n  varying vec2 vtc;\r\n\r\n  $calcFragDepth\r\n  $float2rgba\r\n  $calcMipMapLevel\r\n  $coverageCorrectionFactor\r\n\r\n  $fsDepthSrc\r\n    if (texture2D(tex, vtc).a * coverageCorrectionFactor(vtc) \x3c ALPHA_THRESHOLD) {\r\n      discard;\r\n    }\r\n#ifndef BIAS_SHADOWMAP\r\n    gl_FragColor \x3d float2rgba(depth);\r\n#else\r\n    gl_FragColor \x3d float2rgba(calcFragDepth(depth));\r\n#endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsNormal"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  varying vec3 vnormal;\r\n  void main() {\r\n    vec3 normal \x3d normalize(vnormal);\r\n    if (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;\r\n\r\n#ifndef ALPHA_ZERO\r\n    gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 1.0);\r\n#else\r\n    gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 0.0);\r\n#endif\r\n\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsNormalTextured"\x3e\x3c![CDATA[\r\n  $enableRequiredExtensions\r\n  $fsprecisionf\r\n  $alphaThreshold\r\n\r\n  varying vec3 vnormal;\r\n  varying vec2 vtc;\r\n  uniform sampler2D tex;\r\n  uniform vec2 texSize;\r\n\r\n  $calcMipMapLevel\r\n  $coverageCorrectionFactor\r\n\r\n  void main() {\r\n    if (texture2D(tex, vtc).a * coverageCorrectionFactor(vtc) \x3c ALPHA_THRESHOLD) {\r\n      discard;\r\n    }\r\n    vec3 normal \x3d normalize(vnormal);\r\n    if (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;\r\n#ifndef ALPHA_ZERO\r\n    gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 1.0);\r\n#else\r\n    gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 0.0);\r\n#endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsHighlight"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n  uniform sampler2D depthTex;\r\n  uniform vec4 highlightViewportPixelSz;\r\n\r\n  void main() {\r\n    $highlightWrite\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsHighlightTextured"\x3e\x3c![CDATA[\r\n  $enableRequiredExtensions\r\n  $fsprecisionf\r\n  $alphaThreshold\r\n\r\n  varying vec2 vtc;\r\n  uniform sampler2D tex;\r\n  uniform vec2 texSize;\r\n\r\n  uniform sampler2D depthTex;\r\n  uniform vec4 highlightViewportPixelSz;\r\n\r\n  $calcMipMapLevel\r\n  $coverageCorrectionFactor\r\n\r\n  void main() {\r\n    if (texture2D(tex, vtc).a * coverageCorrectionFactor(vtc) \x3c ALPHA_THRESHOLD) {\r\n      discard;\r\n    }\r\n\r\n    $highlightWrite\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/LineCalloutMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderLineCallout"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  $commonAttributesAndUniformsHUD\r\n\r\n  attribute vec2 $uv0;\r\n\r\n  uniform float lineSize;\r\n  uniform vec2 pixelToNDC;\r\n  uniform float borderSize;\r\n  uniform vec2 screenOffset;\r\n\r\n  varying vec4 coverageSampling;\r\n  varying vec2 lineSizes;\r\n\r\n  $alignToPixelOrigin\r\n  $alignToPixelCenter\r\n\r\n  $projectPositionHUD\r\n\r\n  void main(void) {\r\n    ProjectHUDAux projectAux;\r\n    vec4 endPoint \x3d projectPositionHUD(projectAux);\r\n\r\n#ifdef OCCL_TEST\r\n    if (!testVisibilityHUD(endPoint)) {\r\n      gl_Position \x3d vec4(1e38, 1e38, 1e38, 1);\r\n    }\r\n    else {\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n      vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\r\n      vec2 screenOffsetScaled \x3d applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);\r\n#else\r\n      vec2 screenOffsetScaled \x3d screenOffset;\r\n#endif\r\n\r\n      // Add view dependent polygon offset to get exact same original starting point. This is mostly\r\n      // used to get the correct depth value\r\n      vec3 posView \x3d (view * model * vec4($position, 1.0)).xyz;\r\n      applyHUDViewDependentPolygonOffset($auxpos1.w, projectAux.absCosAngle, posView);\r\n\r\n      vec4 startPoint \x3d proj * vec4(posView, 1);\r\n\r\n      // Apply screen offset to both start and end point\r\n      vec2 screenOffsetNorm \x3d screenOffsetScaled * 2.0 / viewport.zw;\r\n\r\n      startPoint.xy +\x3d screenOffsetNorm * startPoint.w;\r\n      endPoint.xy +\x3d screenOffsetNorm * endPoint.w;\r\n\r\n      // Align start and end to pixel origin\r\n      vec4 startAligned \x3d alignToPixelOrigin(startPoint, viewport.zw);\r\n      vec4 endAligned \x3d alignToPixelOrigin(endPoint, viewport.zw);\r\n\r\n#ifdef DEPTH_HUD\r\n\r\n#ifdef DEPTH_HUD_ALIGN_START\r\n      endAligned \x3d vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);\r\n#else\r\n      startAligned \x3d vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);\r\n#endif\r\n\r\n#endif\r\n\r\n      vec4 projectedPosition \x3d mix(startAligned, endAligned, $uv0.y);\r\n\r\n      // The direction of the line in screen space\r\n      vec2 screenSpaceDirection \x3d normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);\r\n      vec2 perpendicularScreenSpaceDirection \x3d vec2(screenSpaceDirection.y, -screenSpaceDirection.x);\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n      float lineSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);\r\n      float borderSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);\r\n\r\n#else\r\n\r\n      float lineSizeScaled \x3d lineSize;\r\n      float borderSizeScaled \x3d borderSize;\r\n\r\n#endif\r\n\r\n      float halfPixelSize \x3d lineSizeScaled * 0.5;\r\n\r\n      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned\r\n      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,\r\n      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel\r\n      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).\r\n      float halfWholePixelSize \x3d floor(lineSizeScaled) * 0.5;\r\n      float halfPixelSizeInt \x3d floor(halfWholePixelSize);\r\n\r\n      // Sub-pixel offset if we need to grow sub-pixels to the left\r\n      float subpixelOffset \x3d -fract(lineSizeScaled) * float(halfWholePixelSize \x3e 0.0);\r\n\r\n      // Pixel offset aligning to whole pixels and adding subpixel offset if needed\r\n      float pixelOffset \x3d -halfPixelSizeInt + subpixelOffset;\r\n\r\n      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size\r\n      float padding \x3d 1.0 + borderSizeScaled;\r\n      vec2 ndcOffset \x3d (pixelOffset - padding + $uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;\r\n\r\n      // Offset x/y from the center of the line in screen space\r\n      projectedPosition.xy +\x3d perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;\r\n\r\n      // Compute a coverage varying which we can use in the fragment shader to determine\r\n      // how much a pixel is actually covered by the line (i.e. to anti alias the line).\r\n      // This works by computing two coordinates that can be linearly interpolated and then\r\n      // subtracted to find out how far away from the line edge we are.\r\n      float edgeDirection \x3d ($uv0.x * 2.0 - 1.0);\r\n\r\n      float halfBorderSize \x3d 0.5 * borderSizeScaled;\r\n      float halfPixelSizeAndBorder \x3d halfPixelSize + halfBorderSize;\r\n      float outerEdgeCoverageSampler \x3d edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);\r\n\r\n      float isOneSided \x3d float(lineSizeScaled \x3c 2.0 \x26\x26 borderSize \x3c 2.0);\r\n\r\n      coverageSampling \x3d vec4(\r\n        // Edge coordinate\r\n        outerEdgeCoverageSampler,\r\n\r\n        // Border edge coordinate\r\n        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,\r\n\r\n        // Line offset\r\n        halfPixelSize - 0.5,\r\n\r\n        // Border offset\r\n        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)\r\n      );\r\n\r\n      lineSizes \x3d vec2(lineSizeScaled, borderSizeScaled);\r\n\r\n      gl_Position \x3d projectedPosition;\r\n\r\n#ifdef OCCL_TEST\r\n    }\r\n#endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet\x3e\x3c![CDATA[\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderLineCallout"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  uniform vec4 color;\r\n  uniform vec4 borderColor;\r\n\r\n  varying vec4 coverageSampling;\r\n  varying vec2 lineSizes;\r\n\r\n  void main() {\r\n    // Mix between line and border coverage offsets depending on whether we need\r\n    // a border (based on the sidedness).\r\n    vec2 coverage \x3d min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);\r\n\r\n    // Mix between border and line color based on the line coverage (conceptually the line\r\n    // blends on top of the border background).\r\n    //\r\n    // Anti-alias by blending final result using the full (including optional border) coverage\r\n    // and the color alpha\r\n    float borderAlpha \x3d color.a * borderColor.a * coverage.y;\r\n    float colorAlpha \x3d color.a * coverage.x;\r\n\r\n    float finalAlpha \x3d mix(borderAlpha, 1.0, colorAlpha);\r\n\r\n#ifdef DEPTH_HUD\r\n\r\n    if (finalAlpha \x3c 0.01) {\r\n      discard;\r\n    }\r\n\r\n#else\r\n\r\n    // Compute the finalRgb, but keep it pre-multiplied (for unpre-multiplied you\r\n    // need to divide by finalAlpha). We avoid the division here by setting the\r\n    // appropriate blending function in the material.\r\n    vec3 finalRgb \x3d mix(borderColor.rgb * borderAlpha, color.rgb, colorAlpha);\r\n\r\n    gl_FragColor \x3d vec4(finalRgb, finalAlpha);\r\n\r\n#endif\r\n\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/MeasurementArrowMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vsMeasurementArrow"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  uniform mat4 proj;\r\n  uniform mat4 view;\r\n  uniform mat4 model;\r\n\r\n  uniform float width;\r\n\r\n  attribute vec3 $position;\r\n  attribute vec3 $normal;\r\n  attribute vec2 $uv0;\r\n  attribute float $auxpos1;\r\n\r\n  varying vec2 vtc;\r\n  varying float vlength;\r\n  varying float vradius;\r\n\r\n  void main(void) {\r\n    vec3 bitangent \x3d $normal;\r\n\r\n    vtc \x3d $uv0;\r\n    vlength \x3d $auxpos1;\r\n    vradius \x3d 0.5 * width;\r\n\r\n    vec4 pos \x3d view * vec4((model * vec4($position + vradius * bitangent * $uv0.y, 1.0)).xyz, 1.0);\r\n    gl_Position \x3d proj * pos;\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsMeasurementArrow"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  uniform float outlineSize;\r\n  uniform vec4 outlineColor;\r\n  uniform float stripeLength;\r\n  uniform vec4 stripeEvenColor;\r\n  uniform vec4 stripeOddColor;\r\n\r\n  varying vec2 vtc;\r\n  varying float vlength;\r\n  varying float vradius;\r\n\r\n  #define INV_SQRT2 (1.0 / sqrt(2.0))\r\n\r\n  vec4 arrowColor(vec2 tc, float len) {\r\n    float d \x3d INV_SQRT2 * (tc.x - abs(tc.y));\r\n    d \x3d min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));\r\n    d \x3d min(d, 1.0 - abs(tc.y));\r\n\r\n    if (d \x3c 0.0) {\r\n      return vec4(0.0);\r\n    } else if (d \x3c outlineSize) {\r\n      return outlineColor;\r\n    } else {\r\n      return fract(0.5 / stripeLength * tc.x * vradius) \x3e\x3d 0.5 ? stripeOddColor : stripeEvenColor;\r\n    }\r\n  }\r\n\r\n  void main(void) {\r\n    vec2 ntc \x3d vec2(vtc.x / vradius, vtc.y);\r\n    vec4 color \x3d arrowColor(ntc, vlength / vradius);\r\n    if (color.a \x3d\x3d 0.0) {\r\n      discard;\r\n    }\r\n    gl_FragColor \x3d color;\r\n  }\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/RibbonLineMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vsRibbonLine"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  uniform mat4 proj;\r\n  uniform mat4 view;\r\n  uniform mat4 model;\r\n\r\n  uniform float extLineWidth;\r\n  uniform float nearPlane;\r\n\r\n  attribute vec3 $position;\r\n  attribute vec2 $uv0;\r\n  varying vec2 vtc;\r\n\r\n  attribute vec4 $color;\r\n  varying vec4 vColor;\r\n\r\n  attribute float $size;\r\n\r\n#ifndef WALL\r\n  uniform float miterLimit;\r\n  attribute vec3 $auxpos1;\r\n  attribute vec3 $auxpos2;\r\n#endif\r\n\r\n#ifdef SCREENSCALE\r\n  uniform vec2 screenSize;\r\n  $toScreenCoords\r\n#define VECTYPE vec2\r\n#define ZEROVEC vec2(0.0, 0.0)\r\n#define PERPENDICULAR(v) vec2(v.y, -v.x);\r\n#define ISOUTSIDE (left.x * right.y - left.y * right.x)*$uv0.y \x3e 0.0\r\n\r\n#else //ifdef SCREENSCALE\r\n\r\n#define VECTYPE vec3\r\n#define ZEROVEC vec3(0.0, 0.0, 0.0)\r\n// these macros are only valid for "strip" type lines:\r\n#define PERPENDICULAR(v) cross(up/*vec3(0.0, 1.0, 0.0)*/, v)\r\n#define ISOUTSIDE dot(cross(left, right), up/*vec3(0.0, 1.0, 0.0)*/)*$uv0.y \x3c 0.0\r\n\r\n#endif //ifdef SCREENSCALE\r\n\r\n  float interp(float ncp, vec4 a, vec4 b) {\r\n    return (-ncp - a.z) / (b.z - a.z);\r\n  }\r\n\r\n#ifdef SCREENSCALE\r\n\r\n  void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next) {\r\n    float vnp \x3d nearPlane*0.99;\r\n\r\n    //We have four vertices per point on the line. Start and end vertices\r\n    //are treated differently --\x3e d \x3e 0, d \x3c 0\r\n    float d \x3d abs($uv0.y) - 1.1;\r\n\r\n    //current pos behind ncp --\x3e we need to clip\r\n    if(pos.z \x3e -nearPlane) {\r\n      if (d \x3c 0.0) {\r\n        //previous in front of ncp\r\n        if(prev.z \x3c -nearPlane) {\r\n          pos \x3d mix(prev, pos, interp(vnp, prev, pos));\r\n          next \x3d pos;\r\n        } else {\r\n          pos \x3d vec4(0, 0, 0, 1);\r\n        }\r\n      }\r\n      //next in front of ncp\r\n      if(d \x3e 0.0) {\r\n        if(next.z \x3c -nearPlane) {\r\n          pos \x3d mix(pos, next, interp(vnp, pos, next));\r\n          prev \x3d pos;\r\n        } else {\r\n          pos \x3d vec4(0, 0, 0, 1);\r\n        }\r\n      }\r\n    } else {\r\n      //current position visible\r\n      //previous behind ncp\r\n      if (prev.z \x3e -nearPlane) {\r\n        prev \x3d mix(pos, prev, interp(vnp, pos, prev));\r\n      }\r\n      //next behind ncp\r\n      if (next.z \x3e -nearPlane) {\r\n        next \x3d mix(next, pos, interp(vnp, next, pos));\r\n      }\r\n    }\r\n\r\n    pos\x3d proj * pos;\r\n    pos.xy *\x3d screenSize;\r\n    pos /\x3d pos.w;\r\n\r\n    next \x3d proj * next;\r\n    next.xy *\x3d screenSize;\r\n    next /\x3d next.w;\r\n\r\n    prev \x3d proj * prev;\r\n    prev.xy *\x3d screenSize;\r\n    prev /\x3d prev.w;\r\n  }\r\n\r\n#endif // SCREENSCALE\r\n\r\n  void main(void) {\r\n\r\n#ifdef SCREENSCALE\r\n  // Check for special value of uv0.y which is used by the Renderer when graphics\r\n  // are removed before the VBO is recompacted. If this is the case, then we just\r\n  // project outside of clip space.\r\n  if ($uv0.y \x3d\x3d 0.0) {\r\n    // Project out of clip space\r\n    gl_Position \x3d vec4(1e038, 1e038, 1e038, 1.0);\r\n  }\r\n  else {\r\n#endif\r\n\r\n  float lineWidth \x3d extLineWidth + $size;\r\n\r\n#ifdef SCREENSCALE\r\n\r\n#if 0\r\n    vec4 pos \x3d toScreenCoords($position.xyz);\r\n    vec2 left \x3d (pos - toScreenCoords($auxpos1)).xy;\r\n    vec2 right \x3d (toScreenCoords($auxpos2) - pos).xy;\r\n#else\r\n    vec4 pos  \x3d view * vec4((model * vec4($position.xyz, 1.0)).xyz, 1.0);\r\n    vec4 prev \x3d view * vec4((model * vec4($auxpos1.xyz, 1.0)).xyz, 1.0);\r\n    vec4 next \x3d view * vec4((model * vec4($auxpos2.xyz, 1.0)).xyz, 1.0);\r\n\r\n    clipAndTransform(pos, prev, next);\r\n\r\n    vec2 left \x3d (pos - prev).xy;\r\n    vec2 right \x3d (next - pos).xy;\r\n#endif\r\n\r\n#else // ifdef SCREENSCALE\r\n    vec4 pos \x3d vec4($position, 1.0);\r\n#ifndef WALL\r\n    vec3 left \x3d $position.xyz - $auxpos1;\r\n    vec3 right \x3d $auxpos2 - $position.xyz;\r\n    vec3 up \x3d normalize($position.xyz);\r\n#endif // ifndef WALL\r\n#endif // ifdef SCREENSCALE\r\n\r\n#ifdef WALL\r\n    float displacementLen \x3d lineWidth;\r\n    vec3 displacementDir \x3d normalize($position.xyz);//vec3(0.0, 1.0, 0.0);\r\n#else // ifdef WALL\r\n\r\n    float leftLen \x3d length(left);\r\n    left \x3d (leftLen \x3e 0.001) ? left/leftLen : ZEROVEC;\r\n\r\n    float rightLen \x3d length(right);\r\n    right \x3d (rightLen \x3e 0.001) ? right/rightLen : ZEROVEC;\r\n\r\n    // determine if vertex is on the "outside or "inside" of the join\r\n    bool isOutside \x3d ISOUTSIDE;\r\n\r\n    // compute miter join position first\r\n    float displacementLen \x3d lineWidth;\r\n    VECTYPE displacementDir \x3d normalize(left + right);\r\n    displacementDir \x3d PERPENDICULAR(displacementDir);\r\n    if (leftLen \x3e 0.001 \x26\x26 rightLen \x3e 0.001) {\r\n      float nDotSeg \x3d dot(displacementDir, left);\r\n      displacementLen /\x3d length(nDotSeg*left - displacementDir);\r\n\r\n      // limit displacement of inner vertices\r\n      if (!isOutside) {\r\n        displacementLen \x3d min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\r\n      }\r\n    }\r\n\r\n    if (isOutside \x26\x26 (displacementLen \x3e miterLimit*lineWidth)) {\r\n      // convert to bevel join if miterLimit is exceeded\r\n      if (leftLen \x3c 0.001) {\r\n        displacementDir \x3d right;\r\n      }\r\n      else if (rightLen \x3c 0.001) {\r\n        displacementDir \x3d left;\r\n      }\r\n      else {\r\n        displacementDir \x3d (abs($uv0.y) - 1.1 \x3c 0.0) ? left : right;\r\n      }\r\n      displacementDir \x3d normalize(displacementDir);\r\n      displacementDir \x3d PERPENDICULAR(displacementDir);\r\n      displacementLen \x3d lineWidth;\r\n    }\r\n\r\n#endif // ifdef WALL\r\n\r\n#ifdef SCREENSCALE\r\n    pos.xy +\x3d displacementDir * floor($uv0.y + 0.5) * displacementLen;\r\n    pos.xy /\x3d screenSize;\r\n#else\r\n    pos.xyz +\x3d displacementDir * floor($uv0.y + 0.5) * displacementLen;\r\n    pos \x3d proj * view * model * pos;\r\n#endif\r\n\r\n    vtc \x3d $uv0;\r\n    vColor \x3d $color * 0.003921568627451; // \x3d 1/255\r\n    gl_Position \x3d pos;\r\n\r\n#ifdef SCREENSCALE\r\n    }\r\n#endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3csnippet name\x3d"fsRibbonLine"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  uniform vec4 eColor;\r\n  varying vec4 vColor;\r\n  varying vec2 vtc;\r\n\r\n#ifdef STIPPLE\r\n  uniform float stippleLengthDoubleInv;\r\n#endif\r\n\r\n  void main() {\r\n\r\n#ifdef STIPPLE\r\n    if (fract(vtc.x * stippleLengthDoubleInv) \x3e 0.5) {\r\n      discard;\r\n    }\r\n#endif\r\n\r\n    gl_FragColor \x3d eColor * vColor;\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsRibbonLineHighlight"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n#ifdef STIPPLE\r\n  uniform float stippleLengthDoubleInv;\r\n#endif\r\n\r\n  void main() {\r\n#ifdef STIPPLE\r\n    if (fract(vtc.x * stippleLengthDoubleInv) \x3e 0.5) {\r\n      discard;\r\n    }\r\n#endif\r\n\r\n    gl_FragColor \x3d vec4(1.0, 1.0, 1.0, 1.0);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/internal/BlendLayers.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderBlendLayers"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  attribute vec3 $position;\r\n  attribute vec2 $uv0;\r\n\r\n  uniform float scale;\r\n  uniform vec2 offset;\r\n\r\n  varying vec2 uv;\r\n\r\n  void main(void) {\r\n    gl_Position \x3d vec4($position, 1.0);\r\n    uv \x3d $uv0 * scale + offset;;\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderBlendLayers"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  varying vec2 uv;\r\n\r\n  uniform sampler2D tex;\r\n  uniform float opacity;\r\n\r\n  void main() {\r\n    vec4 color \x3d texture2D(tex, uv);\r\n\r\n    // Note: output in pre-multiplied alpha for correct alpha compositing\r\n    gl_FragColor \x3d vec4(color.xyz, 1.0) * color.a * opacity;\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/internal/SimpleGLMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderSimple"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  uniform mat4 proj;\r\n  uniform mat4 view;\r\n  uniform mat4 model;\r\n  attribute vec3 $position;\r\n\r\n  void main(void) {\r\n    gl_Position \x3d proj * view * vec4((model * vec4($position, 1.0)).xyz, 1.0);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderSimple"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  uniform vec4 color;\r\n\r\n  void main() {\r\n    gl_FragColor \x3d color;\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/terrain/TerrainMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"getOverlayColor"\x3e\x3c![CDATA[\r\n  vec4 getOverlayColor(vec4 texCoords, float opacity) {\r\n    vec4 color \x3d vec4(0, 0, 0, 0);\r\n\r\n    if ((texCoords.x \x3e 0.0) \x26\x26 (texCoords.x \x3c 1.0) \x26\x26 (texCoords.y \x3e 0.0) \x26\x26 (texCoords.y \x3c 1.0)) {\r\n      // inner overlay texture coordinates are within bounds -\x3e sample from inner overlay\r\n      color \x3d texture2D(overlay0Tex, texCoords.xy);\r\n    } else if ((texCoords.z \x3e 0.0) \x26\x26 (texCoords.z \x3c 1.0) \x26\x26 (texCoords.w \x3e 0.0) \x26\x26 (texCoords.w \x3c 1.0)) {\r\n      // sample from outer overlay\r\n      color \x3d texture2D(overlay1Tex, texCoords.zw);\r\n    }\r\n\r\n    return color * opacity;\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"applySkirts"\x3e\x3c![CDATA[\r\n  uniform float skirtScale;\r\n\r\n  vec3 applySkirts(inout vec2 uv, vec3 vpos, vec3 vnormal) {\r\n    float skirtLength \x3d 0.0;\r\n\r\n    if (uv.x \x3e\x3d 2.0) {\r\n      skirtLength \x3d uv.y * skirtScale;\r\n      // decode original uv-coordinates (see `encodeSkirtPos`)\r\n      vec2 x \x3d vec2(uv.x) - vec2(3.5, 4.5);\r\n      uv \x3d clamp(vec2(1.5) - abs(x), vec2(0.0), vec2(1.0));\r\n    }\r\n\r\n    return vpos - vnormal * skirtLength;\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsTerrain"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  uniform mat4 proj;\r\n  uniform mat4 view;\r\n  uniform vec3 origin;\r\n  uniform vec4 texOffsetAndScale;\r\n  uniform mat4 viewNormal;\r\n\r\n  attribute vec3 $position;\r\n  attribute vec2 $uv0;\r\n  varying vec2 vtc;\r\n  varying vec3 vpos;\r\n  varying vec3 vnormal;\r\n\r\n#ifdef RECEIVE_SHADOWS\r\n  varying float linearDepth;\r\n#endif\r\n\r\n#if defined(WIREFRAME) || defined(TILE_BORDERS)\r\n  varying vec2 vuv;\r\n#endif\r\n\r\n#ifdef ATMOSPHERE\r\n  uniform vec3 lightDirection;\r\n  varying vec3 wpos;\r\n  varying vec3 wview;\r\n  varying vec3 wnormal;\r\n  varying vec3 wlight;\r\n#endif\r\n\r\n#ifdef OVERLAY\r\n  // these variables combine two possible overlays into one by using a vec4:\r\n  // components x/y are x/y of overlay 0, and components z/w are x/y of overlay 1\r\n  uniform vec4 overlayTexOffset;\r\n  uniform vec4 overlayTexScale;\r\n  varying vec4 vtcOverlay;\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\r\n\r\n  uniform vec4 screenSizePerspective;\r\n\r\n  varying float screenSizeDistanceToCamera;\r\n  varying float screenSizeCosAngle;\r\n\r\n#endif\r\n\r\n$applySkirts\r\n\r\n  void main(void) {\r\n    vpos \x3d $position;\r\n\r\n#ifdef SPHERICAL\r\n    vnormal \x3d normalize(vpos + origin);\r\n#else\r\n    vnormal \x3d vec3(0, 0, 1); // WARNING: up-axis dependent code\r\n#endif\r\n\r\n  vec2 uv \x3d $uv0;\r\n  vpos \x3d applySkirts(uv, vpos, vnormal);\r\n\r\n#ifdef ATMOSPHERE\r\n    wpos \x3d (view * vec4(vpos, 1.0)).xyz;\r\n    wnormal \x3d (viewNormal * vec4(normalize(vpos+origin), 1.0)).xyz;\r\n    wlight \x3d (view  * vec4(lightDirection, 1.0)).xyz;\r\n#endif\r\n\r\n#if defined(WIREFRAME) || defined(TILE_BORDERS)\r\n    vuv \x3d uv;\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\r\n\r\n    vec3 viewPos \x3d (view * vec4(vpos, 1.0)).xyz;\r\n\r\n    screenSizeDistanceToCamera \x3d length(viewPos);\r\n\r\n    vec3 viewSpaceNormal \x3d (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;\r\n    screenSizeCosAngle \x3d abs(viewSpaceNormal.z);\r\n\r\n#endif\r\n\r\n    gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n\r\n#ifdef RECEIVE_SHADOWS\r\n    // Shadowmap\'s cascading index used to be based on \'1.0 / gl_FragCoord.w\'\r\n    // (i.e. the perspective interpolation of \'gl_Position.w\'). Precision\r\n    // issues on iPad/iPhone with the \'w\' component require the depth to be\r\n    // passed as varying to properly drive the cascading shadow map index.\r\n    linearDepth \x3d gl_Position.w;\r\n#endif\r\n\r\n    vtc \x3d uv * texOffsetAndScale.zw + texOffsetAndScale.xy;\r\n\r\n#ifdef OVERLAY\r\n    vtcOverlay \x3d vec4(uv, uv) * overlayTexScale + overlayTexOffset;\r\n#endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsTerrainCommon"\x3e\x3c![CDATA[\r\n  uniform vec3 lightDirection;\r\n  uniform vec3 viewDirection;\r\n  uniform sampler2D depthTex;\r\n  uniform int shadowMapNum;\r\n  uniform vec4 shadowMapDistance;\r\n  uniform mat4 shadowMapMatrix[4];\r\n  uniform float depthHalfPixelSz;\r\n  uniform sampler2D ssaoTex;\r\n  uniform vec4 viewportPixelSz;\r\n  uniform sampler2D tex;\r\n  uniform float opacity;\r\n\r\n  varying vec3 vpos;\r\n  varying vec3 vnormal;\r\n  varying vec2 vtc;\r\n\r\n#if defined(WIREFRAME) || defined(TILE_BORDERS)\r\n  varying vec2 vuv;\r\n#endif\r\n\r\n#ifdef ATMOSPHERE\r\n  varying vec3 wpos;\r\n  varying vec3 wview;\r\n  varying vec3 wnormal;\r\n  varying vec3 wlight;\r\n#endif\r\n\r\n  $sceneLightingDefinitions\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\r\n  $screenSizePerspective\r\n\r\n  uniform vec4 screenSizePerspective;\r\n\r\n  varying float screenSizeDistanceToCamera;\r\n  varying float screenSizeCosAngle;\r\n#endif\r\n\r\n  const vec3 ambient \x3d vec3(0.2,0.2,0.2);\r\n  const vec3 diffuse \x3d vec3(0.8,0.8,0.8);\r\n  const float diffuseHardness \x3d 2.5;\r\n\r\n#ifdef OVERLAY\r\n  uniform sampler2D overlay0Tex;\r\n  uniform sampler2D overlay1Tex;\r\n  uniform float overlayOpacity;\r\n  varying vec4 vtcOverlay;\r\n\r\n  $getOverlayColor\r\n#endif\r\n\r\n#ifdef RECEIVE_SHADOWS\r\n\tvarying float linearDepth;\r\n\t$evalShadow\r\n#endif\r\n\r\n  float lum(vec3 c) {\r\n    float max \x3d max(max(c.r, c.g), c.b);\r\n    float min \x3d min(min(c.r, c.g), c.b);\r\n    return (min + max) * 0.5;\r\n  }\r\n\r\n#ifdef ATMOSPHERE\r\n  vec3 atmosphere(vec3 lightPos, vec3 normal, vec3 view) {\r\n    vec3 surfaceColor   \x3d vec3(0.0);\r\n    vec3 fuzzySpecColor \x3d vec3(1.0);\r\n    vec3 subColor       \x3d vec3(0.0);\r\n    float rollOff       \x3d 1.0;\r\n\r\n    vec3 Ln \x3d normalize(lightPos);\r\n    vec3 Nn \x3d normalize(normal);\r\n    vec3 Hn \x3d normalize(view + Ln);\r\n\r\n    float ldn \x3d dot(Ln, Nn);\r\n    float diffComp \x3d max(0.0, ldn);\r\n    float vdn \x3d 1.0 - dot(view, Nn);\r\n    float ndv \x3d dot(view, Ln);\r\n\r\n    vec3 diffContrib \x3d surfaceColor * diffComp;\r\n    float subLamb \x3d max(0.0, smoothstep(-rollOff, 1.0, ldn) - smoothstep(0.0, 1.0, ldn));\r\n\r\n    vec3 subContrib \x3d subLamb * subColor;\r\n    vec3 vecColor \x3d vec3(vdn);\r\n\r\n    vec3 diffuseContrib \x3d (subContrib + diffContrib);\r\n    vec3 specularContrib \x3d (vecColor * fuzzySpecColor);\r\n\r\n    return (diffContrib + specularContrib) * rollOff;\r\n  }\r\n#endif\r\n\r\n  void main() {\r\n    vec3 a \x3d ambient;\r\n\r\n    float shadow \x3d 0.0;\r\n#ifdef RECEIVE_SHADOWS\r\n    shadow \x3d evalShadow(vpos, linearDepth, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\r\n#endif\r\n    float vndl \x3d dot(normalize(vnormal), lightDirection);\r\n    float k \x3d smoothstep(0.0, 1.0, clamp(vndl*diffuseHardness, 0.0, 1.0));\r\n    vec3 d \x3d (1.0 - shadow/1.8) * diffuse * k;\r\n\r\n    float ssao \x3d viewportPixelSz.w \x3c .0 ? 1.0 : texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\r\n    vec4 tileColor \x3d texture2D(tex, vtc) * opacity;\r\n\r\n#ifdef OVERLAY\r\n    vec4 overlayColor \x3d getOverlayColor(vtcOverlay, overlayOpacity);\r\n\r\n    // tileColor and overlayTexCols have pre-multiplied alpha\r\n    tileColor \x3d tileColor * (1.0 - overlayColor.a) + overlayColor;\r\n#endif\r\n\r\n    vec3 atm \x3d vec3(0.0);\r\n#ifdef ATMOSPHERE\r\n    float ndotl \x3d max(0.0, min(1.0, vndl));\r\n    atm \x3d atmosphere(wlight, wnormal, -viewDirection);\r\n    atm *\x3d max(0.0, min(1.0, (1.0-lum(tileColor.rgb)*1.5))); //avoid atmosphere on bright base maps\r\n    atm *\x3d max(0.0, min(1.0, ndotl*2.0)); // avoid atmosphere on dark side of the globe\r\n    atm *\x3d tileColor.a; // premultiply with tile alpha\r\n#endif\r\n\r\n    vec3 albedo \x3d atm + tileColor.rgb;\r\n    vec3 normal \x3d normalize(vnormal);\r\n\r\n    // heuristic shading function used in the old terrain, now used to add ambient lighting\r\n    float additionalAmbientScale \x3d smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));\r\n\t\tvec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\r\n\r\n    gl_FragColor \x3d vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\r\n    // This is only used for debug rendering the screenSize perspective\r\n\r\n    float perspectiveScale \x3d screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, screenSizePerspective);\r\n\r\n    if (perspectiveScale \x3c\x3d 0.25) {\r\n      gl_FragColor \x3d mix(gl_FragColor, vec4(1, 0, 0, 1), perspectiveScale * 4.0);\r\n    }\r\n    else if (perspectiveScale \x3c\x3d 0.5) {\r\n      gl_FragColor \x3d mix(gl_FragColor, vec4(0, 0, 1, 1), (perspectiveScale - 0.25) * 4.0);\r\n    }\r\n    else if (perspectiveScale \x3e\x3d 0.99) {\r\n      gl_FragColor \x3d mix(gl_FragColor, vec4(0, 1, 0, 1), 0.2);\r\n    }\r\n    else {\r\n      gl_FragColor \x3d mix(gl_FragColor, vec4(1, 0, 1, 1), (perspectiveScale - 0.5) * 2.0);\r\n    }\r\n\r\n#endif\r\n\r\n  // closing } is missing here, it\'s in the shaders using this snippet below\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsTerrainWireframe"\x3e\x3c![CDATA[\r\n  $enableRequiredExtensions\r\n  $fsprecisionf\r\n\r\n  struct WireframeSettings {\r\n    float width;\r\n    float falloff;\r\n    float subdivision;\r\n    vec4 color;\r\n    float wireOpacity;\r\n    float surfaceOpacity;\r\n  };\r\n\r\n  uniform WireframeSettings wireframe;\r\n\r\n    $fsTerrainCommon\r\n\r\n    vec2 vuvScaled \x3d vuv * wireframe.subdivision;\r\n    vec2 vuvMod \x3d fract(vuvScaled);\r\n\r\n    vec2 dVuv \x3d fwidth(vuvScaled);\r\n    dVuv \x3d max(vec2(0.00001), dVuv); // workaround against flickering skirts, see #10245\r\n\r\n    vec2 edgeFactors \x3d smoothstep((wireframe.width - wireframe.falloff) * dVuv,\r\n                                  wireframe.width * dVuv, min(vuvMod, 1.0 - vuvMod));\r\n\r\n    float edgeFactor \x3d 1.0 - min(edgeFactors.x, edgeFactors.y);\r\n\r\n#ifdef WIREFRAME\r\n    vec3 wireframeColor \x3d mix(gl_FragColor.rgb, wireframe.color.rgb, edgeFactor * wireframe.color.a);\r\n    float wireframeAlpha \x3d mix(wireframe.surfaceOpacity, wireframe.wireOpacity, edgeFactor);\r\n    gl_FragColor \x3d vec4(wireframeColor * wireframeAlpha, wireframeAlpha * gl_FragColor.a);\r\n#endif\r\n\r\n\r\n#ifdef TILE_BORDERS\r\n    dVuv \x3d fwidth(vuv);\r\n    edgeFactors \x3d smoothstep((wireframe.width - wireframe.falloff) * dVuv,\r\n                              wireframe.width * dVuv, min(vuv, 1.0 - vuv));\r\n    edgeFactor \x3d 1.0 - min(edgeFactors.x, edgeFactors.y);\r\n\r\n    gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);\r\n#endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsTerrain"\x3e\x3c![CDATA[\r\n    $fsprecisionf\r\n    $fsTerrainCommon\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsTerrainNormal"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  uniform vec3 origin;\r\n  uniform mat4 proj;\r\n  uniform mat4 view;\r\n  uniform mat4 viewNormal;\r\n  attribute vec3 $position;\r\n  attribute vec2 $uv0;\r\n  varying vec3 vnormal;\r\n\r\n$applySkirts\r\n\r\n  void main(void) {\r\n#ifdef SPHERICAL\r\n    vec4 normal \x3d vec4(normalize($position + origin), 1.0);\r\n#else\r\n    vec4 normal \x3d vec4(0.0, 0.0, 1.0, 1.0);\r\n#endif\r\n\r\n    vec2 uv \x3d $uv0;\r\n    vec3 vpos \x3d applySkirts(uv, $position, normal.xyz);\r\n\r\n    gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n    vnormal \x3d normalize((viewNormal * normal).xyz);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsTerrainDepth"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  uniform vec3 origin;\r\n  uniform mat4 proj;\r\n  uniform mat4 view;\r\n  uniform vec2 nearFar;\r\n  attribute vec3 $position;\r\n  attribute vec2 $uv0;\r\n  varying float depth;\r\n\r\n$applySkirts\r\n\r\n  void main(void) {\r\n#ifdef SPHERICAL\r\n    vec3 normal \x3d normalize($position + origin);\r\n#else\r\n    vec3 normal \x3d vec3(0.0, 0.0, 1.0);\r\n#endif\r\n\r\n    vec2 uv \x3d $uv0;\r\n    vec3 vpos \x3d applySkirts(uv, $position, normal.xyz);\r\n\r\n    vec4 eye \x3d view * vec4(vpos, 1.0);\r\n    gl_Position \x3d proj * eye;\r\n    depth \x3d (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsTerrainHighlight"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  uniform vec3 origin;\r\n  uniform mat4 proj;\r\n  uniform mat4 view;\r\n  uniform vec4 overlayTexScale;\r\n  uniform vec4 overlayTexOffset;\r\n\r\n  attribute vec3 $position;\r\n  attribute vec2 $uv0;\r\n\r\n  varying vec4 vtcOverlay;\r\n\r\n$applySkirts\r\n\r\n  void main() {\r\n    #ifdef SPHERICAL\r\n      vec3 vnormal \x3d normalize($position + origin);\r\n    #else\r\n      vec3 vnormal \x3d vec3(0, 0, 1); // WARNING: up-axis dependent code\r\n    #endif\r\n\r\n    vec2 uv \x3d $uv0;\r\n    vec3 vpos \x3d applySkirts(uv, $position, vnormal);\r\n\r\n    vtcOverlay \x3d vec4(uv, uv) * overlayTexScale + overlayTexOffset;\r\n\r\n    gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsTerrainHighlight"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  uniform sampler2D overlay0Tex;\r\n  uniform sampler2D overlay1Tex;\r\n  uniform float overlayOpacity;\r\n\r\n  uniform sampler2D depthTex;\r\n  uniform vec4 highlightViewportPixelSz;\r\n\r\n  varying vec4 vtcOverlay;\r\n\r\n  $getOverlayColor\r\n\r\n  void main() {\r\n    vec4 overlayColor \x3d getOverlayColor(vtcOverlay, overlayOpacity);\r\n\r\n    if (overlayColor.a \x3d\x3d 0.0) {\r\n      // Here we have to write black, instead of discarding the fragment in order to overwrite\r\n      // the highlights which might have been written by skirts of other tiles.\r\n      // As a consequence skirts are not visible, but terrain overwrites draped highlights.\r\n      gl_FragColor \x3d vec4(0,0,0,0);\r\n      return;\r\n    }\r\n\r\n    $highlightWrite\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/layers/i3s/PointCloudPointRenderer.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vsPointCloudPointRenderer"\x3e\x3c![CDATA[\r\n$vsprecisionf\r\n\r\nattribute vec3 aPosition;\r\nattribute vec3 aColor;\r\n\r\nuniform mat4 uModelViewMatrix;\r\nuniform mat4 uProjectionMatrix;\r\nuniform vec2 uScreenMinMaxSize;\r\nuniform vec2 uPointScale;\r\nuniform vec3 uClipMin;\r\nuniform vec3 uClipMax;\r\n\r\n#ifdef DEPTH_PASS\r\nuniform vec2 nearFar;\r\n\r\nvarying float depth;\r\n#else\r\nvarying vec3 vColor;\r\n#endif\r\n\r\nvoid main(void) {\r\n\r\n  // Move clipped points outside of clipspace\r\n  if (aPosition.x \x3c uClipMin.x || aPosition.y \x3c uClipMin.y || aPosition.z \x3c uClipMin.z ||\r\n      aPosition.x \x3e uClipMax.x || aPosition.y \x3e uClipMax.y || aPosition.z \x3e uClipMax.z) {\r\n    gl_Position \x3d vec4(0.0,0.0,0.0,2.0);\r\n    gl_PointSize \x3d 0.0;\r\n    return;\r\n  }\r\n\r\n  // Position in camera space\r\n  vec4 camera \x3d uModelViewMatrix * vec4(aPosition, 1.0);\r\n\r\n  float pointSize \x3d uPointScale.x;\r\n  vec4 position \x3d uProjectionMatrix * camera;\r\n\r\n  // Calculate Size\r\n  #ifdef DRAW_SCREEN_SIZE\r\n    float clampedScreenSize \x3d pointSize;\r\n  #else\r\n    float pointRadius \x3d 0.5 * pointSize;\r\n    vec4 cameraOffset \x3d camera + vec4(0.0, pointRadius, 0.0, 0.0);\r\n    vec4 positionOffset \x3d uProjectionMatrix * cameraOffset;\r\n    float radius \x3d abs(positionOffset.y - position.y);\r\n\r\n    float viewHeight \x3d uPointScale.y;\r\n\r\n    // screen diameter \x3d (2 * r / w) * (h / 2)\r\n    float screenPointSize \x3d (radius / position.w) * viewHeight;\r\n    float clampedScreenSize \x3d clamp(screenPointSize, uScreenMinMaxSize.x, uScreenMinMaxSize.y);\r\n\r\n    // Shift towards camera, to move rendered point out of terrain i.e. to\r\n    // the camera-facing end of the virtual point when considering it as a\r\n    // 3D sphere.\r\n    camera.xyz -\x3d normalize(camera.xyz) * pointRadius * clampedScreenSize / screenPointSize;\r\n    position \x3d uProjectionMatrix * camera;\r\n  #endif\r\n\r\n  gl_PointSize \x3d clampedScreenSize;\r\n  gl_Position \x3d position;\r\n\r\n  #ifdef DEPTH_PASS\r\n  depth \x3d (-camera.z - nearFar[0]) / (nearFar[1] - nearFar[0]);\r\n  #else\r\n  vColor \x3d aColor;\r\n  #endif\r\n}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsPointCloudPointRenderer"\x3e\x3c![CDATA[\r\n$fsprecisionf\r\n\r\n#ifdef DEPTH_PASS\r\n$float2rgba\r\n\r\nvarying float depth;\r\n#else\r\nvarying vec3 vColor;\r\n#endif\r\n\r\nvoid main(void) {\r\n  vec2 vOffset \x3d gl_PointCoord - vec2(0.5, 0.5);\r\n  float r2 \x3d dot(vOffset, vOffset);\r\n\r\n  if (r2 \x3e 0.25) {\r\n    discard;\r\n  }\r\n\r\n  #ifdef DEPTH_PASS\r\n  gl_FragColor \x3d float2rgba(depth);\r\n  #else\r\n  gl_FragColor \x3d vec4(vColor, 1.0);\r\n  #endif\r\n}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"*now":function(q){q(['dojo/i18n!*preload*esri/views/nls/SceneView*["ar","ca","cs","da","de","el","en-gb","en-us","es-es","fi-fi","fr-fr","he-il","hu","it-it","ja-jp","ko-kr","nl-nl","nb","pl","pt-br","pt-pt","ru","sk","sl","sv","th","tr","zh-tw","zh-cn","ROOT"]'])},"*noref":1}});
define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/dom dojo/when ../Camera ../geometry ../Graphic ../Viewpoint ../core/Error ../core/Handles ../core/lang ../core/Logger ../core/promiseUtils ../core/scheduling ../core/sniff ../core/watchUtils ../core/accessorSupport/decorators ../core/accessorSupport/watch ../geometry/HeightModelInfo ../geometry/support/aaBoundingRect ../geometry/support/scaleUtils ../geometry/support/webMercatorUtils ./BreakpointsOwner ./DOMContainer ./View ./ViewAnimation ./3d/constraints/Constraints ./3d/environment/SceneViewEnvironment ./3d/environment/SceneViewEnvironmentManager ./3d/input/SceneInputManager ./3d/layers/GraphicsView3D ./3d/layers/graphics/Deconflictor ./3d/layers/graphics/Labeler ./3d/layers/support/FeatureTileTree3D ./3d/layers/support/FeatureTileTree3DDebugger ./3d/lib/glMatrix ./3d/state/ViewState ./3d/state/ViewStateManager ./3d/support/CombinedElevationProvider ./3d/support/debugFlags ./3d/support/DisplayQualityProfile ./3d/support/HighlightOptions ./3d/support/MapCoordsHelper ./3d/support/projectionUtils ./3d/support/QualitySettings ./3d/support/RenderCoordsHelper ./3d/support/ResourceController ./3d/support/SharedSymbolResources ./3d/support/pointsOfInterest/PointsOfInterest ./3d/terrain/TerrainSurface ./3d/terrain/terrainUtils ./3d/webgl-engine/Stage ./3d/webgl-engine/lib/Selector ./support/screenshotUtils ./support/WebGLRequirements ./ui/3d/DefaultUI3D ../webscene/Environment".split(" "),function(q,
h,e,a,d,b,g,c,f,k,n,l,p,m,r,t,u,x,v,A,y,C,B,D,E,J,F,M,H,I,K,O,P,L,U,N,S,aa,V,T,Q,G,X,Z,ea,fa,R,da,ba,ca,ga,ja,ha,W,na,ka,la,w,Ja){var ta=m.getLogger("esri.views.SceneView");q=function(h){function m(a){a=h.call(this)||this;a._layerViewsUpdatingHandles={};a._clippingArea=null;a._internallyReady=!1;a._userClippingArea=null;a._initialDefaultSpatialReference=null;a._defaults={};a._externallySet={environment:!1};a._handles=new l;a._surfaceReadyWatchHandle=null;a._updateUpdatingMonitorsHandle=null;a._mapLayersChangeHandle=
null;a._updateDrawingOrderHandle=null;a._stageFrameTask=null;a.onViewExtentUpdateHandle=null;a.graphicsView=null;a.resourceController=new ba(a);a.deconflictor=new L(a);a.labeler=new U.Labeler({view:a});a.renderSpatialReference=null;a.sharedSymbolResources=null;a.basemapTerrain=null;a.elevationProvider=null;a.camera=null;a.canvas=null;a.center=null;a.constraints=new H.default;a.extent=null;a.fullOpacity=1;a.map=null;a.screenSizePerspectiveEnabled=!0;a.state=null;a.scale=null;a.isHeightModelInfoRequired=
!0;a.alphaCompositingEnabled=!1;a.type="3d";a.ui=new w;a.updating=!1;a.updatingPercentage=0;a.viewpoint=null;a.zoom=null;a.highlightOptions=new Z;x.when(a,"ready",a._viewReadyHandler.bind(a));a._evaluateUpdating=a._evaluateUpdating.bind(a);a.watch("map",function(a){a&&a.load&&a.load()});a.inputManager=new O({view:a});a.stateManager=new T.ViewStateManager({view:a});return a}e(m,h);m.prototype.getDefaults=function(a){var b=this.inherited(arguments);b.environment||a.environment||(this._defaults.environment=
new I,b.environment=this._defaults.environment);return b};m.prototype.initialize=function(){var a=this;this.environmentManager=new K.default({view:this});this._updateUpdatingMonitorsHandle=this.allLayerViews.on("change",this._updateUpdatingMonitors.bind(this));this._updateUpdatingMonitors({added:this.allLayerViews.toArray(),removed:[]});x.whenNot(this,"ready",this._viewUnreadyHandler.bind(this));this.resourceController.memoryEvents.on("updating-changed",function(){return a._evaluateUpdating()});x.init(this.qualitySettings,
"gpuMemoryLimit",function(b){a.resourceController&&(a.resourceController.maxGpuMemory=b)});x.init(this.qualitySettings,"frameRate",function(a){t.setFrameRate(a)});x.init(G,"SCENEVIEW_LOCKING_LOG",function(b){a.defaultsFromMap.logDebugInformation=b})};m.prototype.destroy=function(){this.activeTool=null;A.dispatchTarget(this);this.environmentManager.destroy();this._disposeGraphicsView();this._updateUpdatingMonitorsHandle.remove();this._updateUpdatingMonitorsHandle=null;this._handles.removeAll();this.inputManager&&
(this.inputManager.destroy(),this._set("inputManager",null))};Object.defineProperty(m.prototype,"activeTool",{set:function(a){if(a&&!this.ready)ta.error("#activeTool\x3d","cannot set active tool while view is not ready");else{var b=this._get("activeTool");a!==b&&(b&&b.deactivate(),this._set("activeTool",a),a&&a.activate())}},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"clippingArea",{get:function(){if("global"===this.viewingMode)return null;if(this._userClippingArea)return this._userClippingArea;
var a=this.get("map.clippingEnabled"),b=this.get("map.clippingArea");if(!a||!b)return this._clippingArea=null;if(!(b instanceof c.Extent))return ta.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea;if(D.canProject(b.spatialReference,this.spatialReference))b=D.project(b,this.spatialReference);else return ta.error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea;return this._clippingArea&&b&&this._clippingArea.equals(b)?
this._clippingArea:this._clippingArea=b},set:function(a){this.ready&&"global"===this.viewingMode&&a?ta.error("#clippingArea\x3d","Clipping area is only supported in local viewingMode"):(this._userClippingArea=a,this.notifyChange("clippingArea"))},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"dataExtent",{get:function(){var a=[],b=this.spatialReference||c.SpatialReference.WGS84,d=this.clippingArea;d&&(d=D.project(d,b));var e=function(c){c&&(c=D.project(c,b))&&(d&&(c=c.intersection(d)),
c&&a.push(c))},f=this._get("basemapTerrain");f&&f.spatialReference&&e(new c.Extent({xmin:f.extent[0],ymin:f.extent[1],zmin:0,xmax:f.extent[2],ymax:f.extent[3],zmax:0,spatialReference:f.spatialReference}));this.map&&this.map.allLayers.forEach(function(a){e(a.fullExtent)});return 0<a.length?(f=a.reduce(function(a,b){return a.union(b)}),f.hasZ?(f.zmin=Math.min(0,f.zmin),f.zmax=Math.max(0,f.zmax)):(f.zmin=0,f.zmax=0),f):new c.Extent({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:b})},enumerable:!0,
configurable:!0});Object.defineProperty(m.prototype,"environment",{set:function(a){a!==this._defaults.environment&&(this._externallySet.environment=!0);a?a instanceof I?this._set("environment",a):a instanceof Ja?(this.environment.lighting=a.lighting,this.environment.background=p.clone(a.background),this.environment.atmosphereEnabled=a.atmosphereEnabled,this.environment.starsEnabled=a.starsEnabled):a.declaredClass?this._set("environment",a):this._set("environment",new I(a)):this._set("environment",
new I)},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"groundExtent",{get:function(){var a=this._get("basemapTerrain");if(a&&a.spatialReference){var b=a.extent;return new c.Extent({xmin:b[0],ymin:b[1],xmax:b[2],ymax:b[3],spatialReference:a.spatialReference})}return new c.Extent({spatialReference:this.spatialReference||c.SpatialReference.WGS84})},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"initialExtentRequired",{get:function(){return!this.stateManager.hasInitialView},
enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"interacting",{get:function(){return!!this.state&&this.state.interacting},enumerable:!0,configurable:!0});m.prototype._mapSetter=function(a){a!==this._get("map")&&(this._mapLayersChangeHandle&&(this._mapLayersChangeHandle.remove(),this._mapLayersChangeHandle=null),a&&(this._mapLayersChangeHandle=a.allLayers.on("change",this.notifyChange.bind(this,"dataExtent"))),this.inherited(arguments))};Object.defineProperty(m.prototype,"qualityProfile",
{get:function(){return this._get("qualityProfile")||X.getDefaultProfile()},set:function(a){X.isValidProfile(a)&&(X.apply(a,this.qualitySettings),this._set("qualityProfile",a))},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"resolution",{get:function(){return null!=this.spatialReference?B.getResolutionForScale(this.scale,this.spatialReference):0},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"heightModelInfo",{get:function(){var a=this.getDefaultHeightModelInfo();
return null!=a?y.deriveUnitFromSR(a,this.spatialReference):null},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"viewingMode",{get:function(){var a=this.get("map.initialViewProperties.viewingMode"),b=this.spatialReference;a||(a=!b||b.isWebMercator||b.isWGS84?"global":"local");return a},set:function(a){this._internallyReady?ta.error("#viewingMode","viewingMode cannot be set once view is ready"):0<=["local","global"].indexOf(a)?this._override("viewingMode",a):void 0===a&&this._clearOverride("viewingMode")},
enumerable:!0,configurable:!0});m.prototype.on=function(a,b,c){var d=this.inputManager.viewEvents.register(a,b,c);return d?d:this.inherited(arguments)};m.prototype.hasEventListener=function(a){return this.inherited(arguments)||this.inputManager&&this.inputManager.viewEvents.hasHandler(a)};m.prototype.toMap=function(a,b,c){if(!this.ready)return ta.error("#toMap()","Scene view cannot be used before it is ready"),null;var d;"number"===typeof a?(d=a,a=b):(d=a.x,a=a.y,c=b);b=this._stage.pick([d,this.height-
a]).getMinResult();return this._computeMapPointFromIntersectionResult(b,c)};m.prototype.toScreen=function(a,b,c,d){if(!this.ready)return ta.error("#toScreen()","Scene view cannot be used before it is ready"),null;"number"===typeof a?("object"===typeof c&&(d=c),fa.vectorToVector([a,b,"number"===typeof c?c:0],this.spatialReference,sa,this.renderSpatialReference)):(fa.pointToVector(a,sa,this.renderSpatialReference),d=b);return this.engineToScreen(sa,d)};m.prototype.pixelSizeAt=function(a,b){if(!this.ready)return ta.error("#pixelSizeAt()",
"Scene view cannot be used before it is ready"),null;if("number"===typeof a){if(a=this._stage.pick([a,this.height-b]).getMinResult(),!a.getIntersectionPoint(sa))return 0}else if(a instanceof c.Point)fa.pointToVector(a,sa,this.renderSpatialReference);else if(a=this._stage.pick([a.x,this.height-a.y]).getMinResult(),!a.getIntersectionPoint(sa))return 0;return this.state.camera.computePixelSizeAt(sa)};m.prototype.hitTest=function(a,d){if(!this.ready)return ta.error("#hitTest()","Scene view cannot be used before it is ready"),
null;var e,f;"number"===typeof a?(e=a,f=d):(e=a.x,f=a.y);var g=this._stage.pick([e,this.height-f],null,!0);a=g.getMinResult();var h=this._computeMapPointFromIntersectionResult(a);d=null;if(a.target)switch(a.target.type){case "stage":d=this._getGraphicFromStageObject(a.target.obj,a.triangleNr);break;case "external":switch(a.intersector){case "PointRenderer":d=b(this._getGraphicFromPointRenderer(a.target));break;case "LodRenderer":d=this._getGraphicFromLodRenderer(a.target)}}return b(d).catch(function(){return null}).then(function(a){var b=
[];(a||h)&&b.push({mapPoint:h,graphic:a});a={screenPoint:new c.ScreenPoint({x:e,y:f}),results:b};G.SCENEVIEW_HITTEST_RETURN_SELECTOR&&(a.selector=g);return a})};m.prototype.goTo=function(a,b){return this.stateManager.goTo(a,b)};m.prototype.takeScreenshot=function(a){var b=this;if(this.ready)return a=ka.adjustScreenshotSettings(a,this),r.create(function(c){b._stage.requestScreenCapture(a,function(a){t.schedule(function(){c(a)})})});ta.error("#takeScreenshot()","Scene view cannot be used before it is ready")};
m.prototype.destroyLayerViews=function(){for(var a in this._layerViewsUpdatingHandles)this._layerViewsUpdatingHandles[a].remove();this._layerViewsUpdatingHandles={};this.stateManager.deinit();this._disposeSurface();this.inherited(arguments);this._stage&&(this._stage.dispose(),this._stage=null,this._handles.remove("stage"));this._set("canvas",null);this.labeler=null;this.deconflictor.destroy();this.deconflictor=null;this.resourceController.destroy();this.resourceController=null};m.prototype.getDefaultSpatialReference=
function(){return this.get("map.initialViewProperties.spatialReference")||this.get("defaultsFromMap.spatialReference")||this.get("defaultsFromMap.isSpatialReferenceDone")&&this._initialDefaultSpatialReference||null};m.prototype.validate=function(){var a=la.check();u("safari")&&9>u("safari")&&(a=new n("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari \x3c 9)",{type:"safari",requiredVersion:9,detectedVersion:u("safari")}));return a?(ta.warn("#validate()",a.message),
r.reject(a)):r.resolve()};m.prototype.isSpatialReferenceSupported=function(a,b,c){var d=a.isGeographic,e=a.isWebMercator,f=a.isWGS84,g="local"===this.viewingMode,h=!(!this._isOverridden("viewingMode")&&!this.get("map.initialViewProperties.viewingMode"));if(h){if(g&&d)return c&&c("Layer "+b.id+" is ignored because it is GCS and viewing mode is local"),!1;if(!g&&!e&&!f)return c&&c("Layer "+b.id+" is ignored because its spatial reference is not supported in global viewing mode"),!1}else if(d&&!f)return c&&
c("Layer "+b.id+" is ignored because its spatial reference is geographic but not WGS84"),!1;if(b)if(ha.isTiledLayer(b)){if(d=void 0,h?h=ha.getTiledLayerInfo(b,a,this.viewingMode):(h=ha.getTiledLayerInfo(b,a,"global"),null==h.tileInfo&&(h=ha.getTiledLayerInfo(b,a,"local"))),d=null!=h.tileInfo,!d)return c&&c("Layer "+b.id+" is ignored because it is tiled but\n            its tiling scheme is not supported or compatible with the viewing mode"),!1}else if((f||e)&&!g)return null==this._initialDefaultSpatialReference&&
(this._initialDefaultSpatialReference=a),h||this._internallyReady||(this.viewingMode="global",c&&c("Viewing mode locked to global due to reprojectable layer "+b.id)),c&&c("Layer "+b.id+" is ignored because it supports server-side reprojection"),!1;return!0};m.prototype.engineToScreen=function(a,b){var d=aa.vec3d.create();this.state.camera.projectPoint(a,d);a=d[0];var e=this.height-d[1],d=d[2];return b?(b.x=a,b.y=e,b.z=d,b):new c.ScreenPoint({x:a,y:e,z:d})};m.prototype.flushDisplayModifications=function(){this._stage.processDirty()};
m.prototype.getDrawingOrder=function(a){return this.allLayerViews.findIndex(function(b){return b.layer&&b.layer.uid===a})};m.prototype.getViewForGraphic=function(a){return a.layer?this.allLayerViews.find(function(b){return b.layer===a.layer}):this.graphicsView};m.prototype.whenViewForGraphic=function(a){return a.layer?this.whenLayerView(a.layer):r.resolve(this.graphicsView)};m.prototype._computeMapPointFromIntersectionResult=function(a,b){if(a.getIntersectionPoint(sa)){b=this._computeMapPointFromVec3d(sa,
b);var c=this._get("basemapTerrain");"TerrainRenderer"===a.intersector&&c&&(a=c.getElevation(b),null!==a&&(b.z=a));return b}return null};m.prototype._computeMapPointFromVec3d=function(a,b){var d=this.spatialReference||c.SpatialReference.WGS84;fa.vectorToVector(a,this.renderSpatialReference,a,d)||(d=c.SpatialReference.WGS84,fa.vectorToVector(a,this.renderSpatialReference,a,d));b?(b.x=a[0],b.y=a[1],b.z=a[2],b.spatialReference=d):b=new c.Point(a,d);return b};m.prototype._getGraphicFromStageObject=function(a,
b){var c=a.getMetadata();if(null!=c&&null!=c.layerUid){if(c.layerUid===this.graphicsView.mockLayerId)return this.graphicsView.getGraphicFromGraphicUid(a.metadata.graphicUid);if(c=this.map.findLayerByUid(c.layerUid))return this.whenLayerView(c).then(function(c){if(c&&!c.suspended){if(c.getGraphicFromStageObject)return c.getGraphicFromStageObject(a,b);if(c.getGraphicFromGraphicUid&&null!=a.metadata.graphicUid)return c.getGraphicFromGraphicUid(a.metadata.graphicUid)}})}return null};m.prototype._getGraphicFromPointRenderer=
function(a){var b=this._computeMapPointFromVec3d(a.point),b=new f(b);a=a.metadata.layerUid;null!=a&&b.set("layer",this.map.findLayerByUid(a));return b};m.prototype._getGraphicFromLodRenderer=function(a){var b=a.metadata;if(null!=b&&null!=b.layerUid){if(b.layerUid===this.graphicsView.mockLayerId)return this.graphicsView.getGraphicFromGraphicUid(b.graphicUid);if(a=this.map.findLayerByUid(b.layerUid))return this.whenLayerView(a).then(function(a){if(a&&!a.suspended)return a.getGraphicFromGraphicUid(b.graphicUid)})}return null};
m.prototype._viewingModeToManifold=function(a){switch(a){case "global":return"spherical";case "local":return"planar"}};m.prototype._initBasemapTerrain=function(a){var b=this;this._disposeBasemapTerrain();this._set("basemapTerrain",new ja(this,this._viewingModeToManifold(a)));this._set("elevationProvider",new Q({view:this}));this.elevationProvider.register("ground",this.basemapTerrain);this._handles.add([x.init(this,"map.ground.opacity",function(a){b.basemapTerrain.baseOpacity=null!=a?a:1}),x.init(this,
"map.ground.surfaceColor",function(a){b.basemapTerrain.backgroundColor=a})],"basemapTerrain")};m.prototype._initGlobe=function(a){var b=this;this._initCoordinateSystem();this._initState();this._stage.setViewParams({backgroundColor:[0,0,0,0],maxFarNearRatio:0,frustumCullingEnabled:!1});this._initBasemapTerrain(a);this._set("pointsOfInterest",new ga.default({view:this}));this._set("featureTiles",new N.default({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,
focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,filterExtent:null}));this._handles.add(this.featureTiles.watch("updating",function(){return b._evaluateUpdating()}));this._handles.add(x.init(G,"FEATURE_TILE_TREE_SHOW_TILES",function(a){a&&b.featureTiles&&!b.featureTilesDebugger?b.featureTilesDebugger=new S.FeatureTileTree3DDebugger(b):!a&&b.featureTilesDebugger&&(b.featureTilesDebugger.destroy(),b.featureTilesDebugger=null)}),"feature-tiles");this._handles.add(x.init(this,
["clippingArea","basemapTerrain.extent"],function(){if(b.clippingArea||b.basemapTerrain.extent)if(b.basemapTerrain.extent&&b.basemapTerrain.spatialReference){var a=C.toExtent(b.basemapTerrain.extent,b.basemapTerrain.spatialReference);b.featureTiles.filterExtent=b.clippingArea?a.intersection(b.clippingArea):a}else b.featureTiles.filterExtent=b.clippingArea;else b.featureTiles.filterExtent=null},!0),"feature-tiles");this._initStateManager()};m.prototype._initCoordinateSystem=function(){if(this.spatialReference){var a=
this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(a)||this._set("mapCoordsHelper",new ea.default(this.map,a));var b="global"===this.viewingMode,a=b?fa.SphericalECEFSpatialReference:a;a!==this.renderSpatialReference&&(this.renderSpatialReference=a,this._set("renderCoordsHelper",da.createRenderCoordsHelper(b?"global":"local",a)),this._stage&&this._stage.setIntersectTolerance(na.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",
null),this._set("renderCoordsHelper",null),this.renderSpatialReference=null};m.prototype._evaluateUpdating=function(){var a=0,b=0,c=!1;this.allLayerViews.forEach(function(d){d.updating&&(c=!0,d=d.updatingPercentage,null!=d&&(++b,a+=d))});if(this.graphicsView&&this.graphicsView.updating||this.resourceController&&this.resourceController.updating||this.featureTiles&&this.featureTiles.updating||this.labeler&&this.labeler.updating)c=!0;c!==this.updating&&this._set("updating",c);a=0!==b?a/b:c?100:0;this.updatingPercentage!==
a&&this._set("updatingPercentage",a)};m.prototype._updateUpdatingMonitors=function(a){for(var b=0;b<a.removed.length;b++){var c=a.removed[b],d=this._layerViewsUpdatingHandles[c.uid];d&&(delete this._layerViewsUpdatingHandles[c.uid],c.destroyed||d.remove())}for(b=0;b<a.added.length;b++)c=a.added[b],c.destroyed||(d=c.watch(["updating","updatingPercentage"],this._evaluateUpdating),this._layerViewsUpdatingHandles[c.uid]=d);this._evaluateUpdating()};m.prototype._pickRay=function(a,b,c,d,e,f,g){return this._stage?
this._stage.pickRay(a,b,c,d,e,f,g):null};m.prototype._pickRayWithBeginPoint=function(a,b,c,d,e){this._stage&&this._stage.pickRayWithBeginPoint(a,b,c,d,e)};m.prototype._disposeSurface=function(){var a=function(a){a&&a.remove();return null};this._stageFrameTask=a(this._stageFrameTask);this._updateDrawingOrderHandle=a(this._updateDrawingOrderHandle);this.onViewExtentUpdateHandle=a(this.onViewExtentUpdateHandle);this._mapLayersChangeHandle=a(this._mapLayersChangeHandle);this.pointsOfInterest&&(this.pointsOfInterest.destroy(),
this._set("pointsOfInterest",null));this.featureTiles&&(this.featureTiles.destroy(),this._set("featureTiles",null));this._handles.remove("feature-tiles");this._disposeBasemapTerrain();this.environmentManager&&this.environmentManager.disposeRendering()};m.prototype._disposeBasemapTerrain=function(){var a=this._get("basemapTerrain");a&&(this._handles.remove("basemapTerrain"),a.destroy(),this._set("basemapTerrain",null))};m.prototype._initStage=function(){var a=this,b={};b.renderContext=this.renderContext;
b.deactivatedWebGLExtensions=this.deactivatedWebGLExtensions;b.viewingMode=this.viewingMode;b.alpha=this.alphaCompositingEnabled;this.renderCanvas&&(b.canvas=this.renderCanvas);this._stage=new W(this.viewingMode,d.byId(this.surface),b);this._handles.add(x.init(this.qualitySettings,"antialiasingEnabled",function(){a._stage.setRenderParams({antialiasingEnabled:a.qualitySettings.antialiasingEnabled})}),"stage");b=function(){a._stage.setRenderParams({defaultHighlightOptions:Z.toEngineOptions(a.highlightOptions)})};
this._handles.add(this.watch(["highlightOptions","highlightOptions.color","highlightOptions.haloOpacity","highlightOptions.fillOpacity"],b),"stage");b();this.renderCoordsHelper&&this._stage.setIntersectTolerance(na.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters);this._set("canvas",this._stage.getCanvas());this._stageFrameTask=t.addFrameTask(this._stage.getFrameTask())};m.prototype._initSurface=function(){this._initStage();this._initGlobe(this.viewingMode);this.sharedSymbolResources=new ca.default({stage:this._stage,
viewingMode:this.viewingMode,resourceController:this.resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})};m.prototype._initGraphicsView=function(){var a=this;this._surfaceReadyWatchHandle=x.whenTrueOnce(this,"basemapTerrain.ready",function(){a.graphicsView=new P({view:a});a._surfaceReadyWatchHandle=null;a._layerViewsUpdatingHandles[a.graphicsView.mockLayerId]=x.init(a.graphicsView,"updating",a._evaluateUpdating)})};m.prototype._disposeGraphicsView=function(){this._surfaceReadyWatchHandle&&
(this._surfaceReadyWatchHandle.remove(),this._surfaceReadyWatchHandle=null);if(this.graphicsView){var a=this.graphicsView.mockLayerId;this._layerViewsUpdatingHandles[a].remove();delete this._layerViewsUpdatingHandles[a];this.graphicsView.destroy();this.graphicsView=null}};m.prototype._initState=function(){this._set("state",new V.default({viewingMode:this.viewingMode,spatialReference:this.spatialReference}))};m.prototype._initStateManager=function(){this.stateManager.init()};m.prototype._viewReadyHandler=
function(a,b){b||("global"===this.viewingMode&&(this._clippingArea=null),this._internallyReady=!0,this._initSurface(),this._initGraphicsView(),!this._externallySet.environment&&(a=this.get("map.initialViewProperties.environment"))&&(this.environment=a),this._updateDrawingOrderHandle=this.allLayerViews.on("change",this._updateDrawingOrder.bind(this)),this._updateDrawingOrder(),this.labeler.setup(),this.environmentManager.updateReadyChange(!0))};m.prototype._viewUnreadyHandler=function(a,b){b&&(this.activeTool&&
(this.activeTool.deactivate(),this._set("activeTool",null)),this._initialDefaultSpatialReference=null,this.environmentManager.updateReadyChange(!1),this._disposeGraphicsView(),this._internallyReady=!1,this.stateManager.deinit(),this._disposeSurface(),this.state.destroy(),this._set("state",null),this.sharedSymbolResources&&(this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null),this.labeler&&this.labeler.dispose(),this._stage&&(this._stage.dispose(),this._stage=null),this._handles.remove("stage"),
this._set("canvas",null))};m.prototype._updateDrawingOrder=function(){var a=this.allLayerViews.length-1;this.allLayerViews.forEach(function(b,c){"drawingOrder"in b&&(b.drawingOrder=a-c)})};a([v.property({value:null})],m.prototype,"activeTool",null);a([v.property({type:M,readOnly:!0,aliasOf:"state.animation"})],m.prototype,"animation",void 0);a([v.property({readOnly:!0})],m.prototype,"basemapTerrain",void 0);a([v.property({readOnly:!0})],m.prototype,"elevationProvider",void 0);a([v.property({type:g,
aliasOf:"stateManager.camera"})],m.prototype,"camera",void 0);a([v.property({readOnly:!0})],m.prototype,"canvas",void 0);a([v.property({type:c.Point,aliasOf:"stateManager.center"})],m.prototype,"center",void 0);a([v.property({type:c.Extent,dependsOn:["map.clippingArea","map.clippingEnabled","viewingMode"]})],m.prototype,"clippingArea",null);a([v.property({type:H.default})],m.prototype,"constraints",void 0);a([v.property({type:c.Extent,dependsOn:["basemapTerrain.extent","clippingArea","map"],readOnly:!0})],
m.prototype,"dataExtent",null);a([v.property({value:null})],m.prototype,"environment",null);a([v.property()],m.prototype,"environmentManager",void 0);a([v.property({type:c.Extent,aliasOf:"stateManager.extent"})],m.prototype,"extent",void 0);a([v.property({type:c.ScreenPoint,readOnly:!0,aliasOf:"stateManager.screenCenter"})],m.prototype,"screenCenter",void 0);a([v.property({aliasOf:"stateManager.frustum"})],m.prototype,"frustum",void 0);a([v.property({type:Number,readOnly:!0})],m.prototype,"fullOpacity",
void 0);a([v.property({type:c.Extent,dependsOn:["basemapTerrain.extent"],readOnly:!0})],m.prototype,"groundExtent",null);a([v.property({type:Boolean,dependsOn:["stateManager.hasInitialView"]})],m.prototype,"initialExtentRequired",null);a([v.property({type:Boolean,dependsOn:["state.interacting"],readOnly:!0})],m.prototype,"interacting",null);a([v.property()],m.prototype,"map",void 0);a([v.property({readOnly:!0})],m.prototype,"mapCoordsHelper",void 0);a([v.property({aliasOf:"stateManager.padding"})],
m.prototype,"padding",void 0);a([v.property({type:ga.default,readOnly:!0})],m.prototype,"pointsOfInterest",void 0);a([v.property({type:N.default,readOnly:!0})],m.prototype,"featureTiles",void 0);a([v.property({type:S.FeatureTileTree3DDebugger})],m.prototype,"featureTilesDebugger",void 0);a([v.property({type:Boolean})],m.prototype,"screenSizePerspectiveEnabled",void 0);a([v.property({constructOnly:!0})],m.prototype,"deactivatedWebGLExtensions",void 0);a([v.property({constructOnly:!0})],m.prototype,
"renderCanvas",void 0);a([v.property({readOnly:!0})],m.prototype,"state",void 0);a([v.property({readOnly:!0})],m.prototype,"inputManager",void 0);a([v.property({readOnly:!0})],m.prototype,"stateManager",void 0);a([v.property()],m.prototype,"qualityProfile",null);a([v.property({type:R,get:function(){var a=this._get("qualitySettings");a||(a=new R,X.apply(this.qualityProfile,a));return a}})],m.prototype,"qualitySettings",void 0);a([v.property({dependsOn:["viewingMode"]})],m.prototype,"ready",void 0);
a([v.property({readOnly:!0})],m.prototype,"renderCoordsHelper",void 0);a([v.property({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],m.prototype,"resolution",null);a([v.property({type:Number,aliasOf:"stateManager.scale"})],m.prototype,"scale",void 0);a([v.property()],m.prototype,"heightModelInfo",null);a([v.property({dependsOn:["map.initialViewProperties.spatialReference","defaultsFromMap.isSpatialReferenceDone"]})],m.prototype,"spatialReference",void 0);a([v.property({type:Boolean})],
m.prototype,"isHeightModelInfoRequired",void 0);a([v.property({type:Boolean,constructOnly:!0})],m.prototype,"alphaCompositingEnabled",void 0);a([v.property()],m.prototype,"type",void 0);a([v.property({type:w})],m.prototype,"ui",void 0);a([v.property({type:Boolean,readOnly:!0})],m.prototype,"updating",void 0);a([v.property({type:Number,readOnly:!0})],m.prototype,"updatingPercentage",void 0);a([v.property({type:String,dependsOn:["map.initialViewProperties.viewingMode","spatialReference"]})],m.prototype,
"viewingMode",null);a([v.property({type:k,aliasOf:"stateManager.viewpoint"})],m.prototype,"viewpoint",void 0);a([v.property({type:Number,aliasOf:"stateManager.zoom"})],m.prototype,"zoom",void 0);a([v.property({type:Z})],m.prototype,"highlightOptions",void 0);return m=a([v.subclass("esri.views.SceneView")],m)}(v.declared(J,F,E));var sa=aa.vec3d.create();return q});