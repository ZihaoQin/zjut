// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/libs/gl-matrix/mat3 ../../../core/libs/gl-matrix/vec4 ../MemoryBuffer ./rendererUtils ./vtShaderSnippets ../../webgl/BufferObject ../../webgl/ShaderVariations ../../webgl/VertexArrayObject".split(" "),function(x,y,r,v,g,w,m,h,t,u){return function(){function e(){this._solidAttributeLocations={a_pos:0};this._attributeLocations={a_pos:0,a_id:1};this._patternMatrix=r.create();this._color=v.create();this._rendererInitialized=this._solidrendererInitialized=!1;this._color.set([1,
0,0,1])}e.prototype.dispose=function(){this._solidVertexArrayObject&&(this._solidVertexArrayObject.dispose(),this._solidVertexArrayObject=null);this._vertexArrayObject&&(this._vertexArrayObject.dispose(),this._vertexArrayObject=null)};e.prototype.renderSolidColor=function(b,a){this._solidrendererInitialized||this._initializeSolidRenderer(b);b.bindVAO(this._solidVertexArrayObject);var d=this._shaderVariations.getProgram([!1,!1],void 0,void 0,this._solidAttributeLocations);b.bindProgram(d);d.setUniformMatrix4fv("u_transformMatrix",
a.u_matrix);d.setUniform2fv("u_normalized_origin",a.u_normalized_origin);d.setUniform1f("u_coord_range",a.u_coord_range||4096);d.setUniform1f("u_depth",a.u_depth||0);d.setUniform4fv("u_color",a.u_color||this._color);b.drawArrays(5,0,4);b.bindVAO()};e.prototype.render=function(b,a,d,c,e,f,g,m,p){this._rendererInitialized||this._initialize(b);var n=f.getPaintValue("background-color",d);p*=f.getPaintValue("background-opacity",d);var h=f.getPaintValue("background-pattern",d),q=void 0!==h,k=n[3]*p,l=q||
1>k;if(!l||0!==c)if(l||1!==c){l=3===c;c=this._shaderVariations.getProgram([q,l],void 0,void 0,this._attributeLocations);b.bindVAO(this._vertexArrayObject);b.bindProgram(c);c.setUniform1f("u_coord_range",e.coordRange);c.setUniform1f("u_depth",f.z||0);c.setUniformMatrix4fv("u_transformMatrix",e.tileTransform.transform);c.setUniform2fv("u_normalized_origin",e.tileTransform.displayCoord);if(q){f=g.getMosaicItemPosition(h,!0);if(!f)return;d=512*Math.pow(2,Math.floor(d)-e.key.level)*m;r.identity(this._patternMatrix);
e=d/f.size[1];this._patternMatrix[0]=d/f.size[0];this._patternMatrix[4]=e;g.bind(b,9729,0);c.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix);c.setUniform1f("u_opacity",p);c.setUniform2f("u_pattern_tl",f.tl[0],f.tl[1]);c.setUniform2f("u_pattern_br",f.br[0],f.br[1]);c.setUniform1i("u_texture",0)}else this._color[0]=k*n[0],this._color[1]=k*n[1],this._color[2]=k*n[2],this._color[3]=k,c.setUniform4fv("u_color",this._color);l&&(a=w.int32To4Bytes(a.layerID),c.setUniform4f("u_id",a[0],a[1],a[2],
a[3]));b.drawArrays(5,0,4);b.bindVAO()}};e.prototype._initializeSolidRenderer=function(b){if(this._solidrendererInitialized)return!0;if(!this._shaderVariations){var a=new t("background",["backgroundVS","backgroundFS"],[],m,b);a.addDefine("PATTERN","PATTERN",[!0,!0],"PATTERN");a.addDefine("ID","ID",[!0,!0],"ID");this._shaderVariations=a}a=new Int8Array([0,0,1,0,0,1,1,1]);a=h.createVertex(b,35044,a);this._solidVertexArrayObject=new u(b,{a_pos:0},{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,
normalized:!1,divisor:0}]},{geometry:a});return this._solidrendererInitialized=!0};e.prototype._initialize=function(b){if(this._rendererInitialized)return!0;if(!this._shaderVariations){var a=new t("background",["backgroundVS","backgroundFS"],[],m,b);a.addDefine("PATTERN","PATTERN",[!0,!0],"PATTERN");a.addDefine("ID","ID",[!0,!0],"ID");this._shaderVariations=a}a=[];a.push(g.i1616to32(0,0));a.push(g.i1616to32(1,0));a.push(g.i1616to32(0,1));a.push(g.i1616to32(1,1));a=new Uint32Array(a);a=h.createVertex(b,
35044,a);this._vertexArrayObject=new u(b,{a_pos:0},{geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}]},{geometry:a});return this._rendererInitialized=!0};return e}()});