// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../lib/glMatrix ../InteractiveController ../../utils/navigationUtils".split(" "),function(d,l,m,k,b,n,f){Object.defineProperty(l,"__esModule",{value:!0});d=function(d){function h(c,e){var a=d.call(this)||this;a.view=c;a.pickingHelper=e;a.pickPoint=b.vec3d.create();a.tmpP0=b.vec3d.create();a.panAxis=b.vec3d.create();a.tmpRayDir=b.vec3d.create();a.targetOnSphere=b.vec3d.create();a.dragBeginPoint=
b.vec2d.create();a.normalizedAnchorPoint=b.vec2d.create();a.constraintOptions={selection:7,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:null};a.sphere={center:b.vec3d.create(),radius:0};a.hasPickPoint=!1;return a}m(h,d);h.prototype.begin=function(c){this.active&&(b.vec2d.set(c,this.dragBeginPoint),f.normalizeCoordinate(this.beginCamera,c,this.normalizedAnchorPoint),c=f.pickPointAndInitSphere(this.pickingHelper,this.beginCamera,c,!1),this.hasPickPoint=!!c.scenePickPoint,
this.pickPoint=c.scenePickPoint,this.sphere=c.sphere,this.constraintOptions.interactionStartCamera=this.beginCamera)};h.prototype.update=function(c){if(this.active){this.currentCamera.eye=this.beginCamera.eye;this.currentCamera.center=this.beginCamera.center;this.currentCamera.up=this.beginCamera.up;b.vec3d.subtract(this.currentCamera.center,this.currentCamera.eye,this.tmpRayDir);var e=b.vec3d.length(this.tmpRayDir);f.normalizeCoordinate(this.currentCamera,c,this.tmpP0);var a=12*(this.tmpP0[1]-this.normalizedAnchorPoint[1]),
g=e*Math.pow(2,a),d=this.view.state.constraints.minimumPoiDistance;0>a&&g<d&&(g=d);1E-6>Math.abs(e-g)||(this.hasPickPoint&&g<e&&(a=1-(1-g/e)*(1-this.sphere.radius/b.vec3d.length(this.currentCamera.center)),b.vec3d.scale(this.currentCamera.center,a)),b.vec3d.scale(this.tmpRayDir,-g/e),b.vec3d.add(this.currentCamera.center,this.tmpRayDir,this.currentCamera.eye),this.constraintOptions.interactionFactor=k.pixelDistanceToInteractionFactor(this.dragBeginPoint,c),k.applyAll(this.view,this.currentCamera,
this.constraintOptions),this.hasPickPoint&&(f.sphereOrSilhouettePointFromScreenPoint(this.sphere,this.currentCamera,this.dragBeginPoint,this.targetOnSphere,!0),c=f.rotationAndAxisFromPoints(this.pickPoint,this.targetOnSphere,this.panAxis),f.applyRotation(this.currentCamera,this.sphere.center,this.panAxis,c)),k.applySurfaceCollision(this.view,this.currentCamera))}};h.prototype.end=function(){this.active&&this.finishController()};return h}(n.InteractiveController);l.ZoomController=d});