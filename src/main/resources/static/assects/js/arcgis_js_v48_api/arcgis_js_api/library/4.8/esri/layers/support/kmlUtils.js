// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports ../../config ../../PopupTemplate ../../request ../../core/lang ../../renderers/support/jsonUtils ../../tasks/support/FeatureSet".split(" "),function(x,f,n,p,q,h,r,t){function k(b,e,d){d.forEach(function(d){b.set(d.attributes[e],d)})}function u(b,e){var d;e.some(function(e){return e.id===b?(d=e,!0):!1});return d}Object.defineProperty(f,"__esModule",{value:!0});var v={esriGeometryPoint:"points",esriGeometryPolyline:"polylines",esriGeometryPolygon:"polygons"};f.parseKML=function(b){var e=
b.folders.slice(),d=new Map,g=new Map,l=new Map,m=new Map,f=new Map,w={esriGeometryPoint:g,esriGeometryPolyline:l,esriGeometryPolygon:m};b.featureCollection.layers.forEach(function(a){var c=h.clone(a);c.featureSet.features=[];var b=a.featureSet.geometryType;d.set(b,c);c=a.layerDefinition.objectIdField;"esriGeometryPoint"===b?k(g,c,a.featureSet.features):"esriGeometryPolyline"===b?k(l,c,a.featureSet.features):"esriGeometryPolygon"===b&&k(m,c,a.featureSet.features)});b.groundOverlays&&b.groundOverlays.forEach(function(a){f.set(a.id,
a)});b.folders.forEach(function(a){a.networkLinkIds.forEach(function(c){var d=a.id;if(c=u(c,b.networkLinks))c.parentFolderId=d,c.networkLink=c;c&&e.push(c)})});e.forEach(function(a){a.featureInfos&&(a.points=h.clone(d.get("esriGeometryPoint")),a.polylines=h.clone(d.get("esriGeometryPolyline")),a.polygons=h.clone(d.get("esriGeometryPolygon")),a.mapImages=[],a.featureInfos.map(function(c){switch(c.type){case "esriGeometryPoint":case "esriGeometryPolyline":case "esriGeometryPolygon":var b=w[c.type].get(c.id);
b&&a[v[c.type]].featureSet.features.push(b);break;case "GroundOverlay":(c=f.get(c.id))&&a.mapImages.push(c)}}))});return{folders:b.folders,sublayers:e}};f.fetchService=function(b,e,d){return q(n.kmlServiceUrl,{callbackParamName:"callback",query:{url:b,model:"simple",folders:"",refresh:0!==d?!0:void 0,outSR:JSON.stringify(e)},responseType:"json"})};f.sublayersFromJSON=function(b,e,d,g){void 0===d&&(d=null);void 0===g&&(g=[]);var l=[],f={},h=e.sublayers,k=e.folders.map(function(a){return a.id});h.forEach(function(a){var c=
new b;d?c.read(a,d):c.read(a);g.length&&-1<k.indexOf(c.id)&&(c.visible=-1!==g.indexOf(c.id));f[a.id]=c;null!=a.parentFolderId&&-1!==a.parentFolderId?(a=f[a.parentFolderId],a.sublayers||(a.sublayers=[]),a.sublayers.unshift(c)):l.unshift(c)});return l};f.getGraphics=function(b){var e=t.fromJSON(b.featureSet).features,d=r.fromJSON(b.layerDefinition.drawingInfo.renderer),f=p.fromJSON(b.popupInfo);return e.map(function(b){var e=d.getSymbol(b);b.symbol=e;b.popupTemplate=f;return b})}});