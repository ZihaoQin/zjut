// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/extendsHelper ../../../core/Error ../../../core/promiseUtils ../../../core/scheduling ./DOMContainer".split(" "),function(m,n,g,h,e,k,l){function f(d,b){for(var c=0;c<b.length;c++){var a=b[c];"takeScreenshot"in a?d.push(a):"children"in a&&f(d,a.children)}return d}return function(d){function b(c){var a=d.call(this)||this;a.element=c;a._renderParameters={state:a.state,pixelRatio:window.devicePixelRatio,stationary:!1};a._renderRequested=!1;a._taskHandle=
k.addFrameTask({render:function(){return a.renderFrame()}});a._stationary=!0;a.attached=!0;a._taskHandle.pause();return a}g(b,d);b.prototype.destroy=function(){this.removeAllChildren();this.renderFrame();this._taskHandle.remove();this._taskHandle=null};Object.defineProperty(b.prototype,"state",{get:function(){return this._state},set:function(c){this._state=c;this.requestRender()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"stationary",{get:function(){return this._stationary},
set:function(c){this._stationary!==c&&(this._stationary=c,this.requestRender())},enumerable:!0,configurable:!0});b.prototype.start=function(){this._taskHandle.resume()};b.prototype.stop=function(){this._taskHandle.pause()};b.prototype.requestRender=function(){this._renderRequested=!0;this._taskHandle&&this._taskHandle.resume()};b.prototype.takeScreenshot=function(c){var a=f([],this.children);return a?e.eachAlways(a.map(function(a){return a.takeScreenshot(c).then(function(a){return e.create(function(c){var b=
document.createElement("img");b.addEventListener("load",function(){c(b)});b.src=a.dataURL})})})).then(function(a){var b=document.createElement("canvas"),d=b.getContext("2d");b.width=c.area.width;b.height=c.area.height;a.forEach(function(a){(a=a.value)&&d.drawImage(a,0,0)});return{dataURL:b.toDataURL()}}):e.reject(new h("mapview:take-screenshot-unavailable"))};b.prototype.renderFrame=function(){this._renderRequested&&(this._renderRequested=!1,this._renderParameters.state=this._state,this._renderParameters.stationary=
this.stationary,this._renderParameters.pixelRatio=window.devicePixelRatio,this.processRender(this._renderParameters));this._renderRequested||this._taskHandle.pause()};return b}(l)});