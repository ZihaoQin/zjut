// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/extendsHelper ../../camera/constraintUtils ../../lib/glMatrix ../../state/Constraints ./InteractiveController ../../state/utils/navigationUtils ../../support/mathUtils".split(" "),function(e,g,p,q,a,k,r,l,m){Object.defineProperty(g,"__esModule",{value:!0});e=function(e){function c(f,d,c){var b=e.call(this)||this;b.view=f;b.pickingHelper=d;b.pivot=c;b.lastPoint=a.vec2d.create();b.tmpWorldUp=a.vec3d.create();b.tmpViewDir=a.vec3d.create();b.tmpRotCurPoint=
a.vec2d.create();b.tmpTransf=a.mat4d.create();b.tmpAxis=a.vec3d.create();b.pivotPos=a.vec3d.create();b.constraintOptions={selection:15,interactionType:2,interactionFactor:0,interactionStartCamera:null,interactionDirection:null};b.rotScale="center"===c?3:1.5;return b}p(c,e);c.prototype.begin=function(f){if(this.active){switch(this.pivot){case "eye":a.vec3d.set(this.beginCamera.eye,this.pivotPos);this.constraintOptions.interactionType=3;this.constraintOptions.selection=0;break;case "center":this.pickingHelper.pickRaySegment(this.beginCamera.eye,
this.beginCamera.center,this.pivotPos)||(this.view.state.isLocal?this.pickingHelper.pickFreePointFromSegment(this.beginCamera.eye,this.beginCamera.center,this.pivotPos):a.vec3d.set(this.beginCamera.center,this.pivotPos)),this.beginCamera.center=this.pivotPos,this.constraintOptions.interactionType=2,this.constraintOptions.selection=11}this.constraintOptions.interactionStartCamera=this.beginCamera;l.normalizeCoordinate(this.beginCamera,f,this.lastPoint)}};c.prototype.update=function(a){if(this.active){var d;
switch(this.pivot){case "eye":d=this.currentCamera.center;break;case "center":this.currentCamera.center=this.pivotPos,d=this.currentCamera.eye}this.applyRotation(this.currentCamera,a,d,this.pivotPos);q.applyAll(this.view,this.currentCamera,this.constraintOptions)}};c.prototype.end=function(){this.active&&this.finishController()};c.prototype.applyRotation=function(c,d,e,b){this.view.renderCoordsHelper.worldUpAtPosition(b,this.tmpWorldUp);l.normalizeCoordinate(c,d,this.tmpRotCurPoint);d=(this.tmpRotCurPoint[1]-
this.lastPoint[1])*this.rotScale;var f=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;a.vec3d.subtract(e,b,this.tmpViewDir);var h=a.vec3d.length(this.tmpViewDir),h=m.acos(a.vec3d.dot(this.tmpViewDir,this.tmpWorldUp)/h);if("eye"===this.pivot){var g=.5*Math.PI-h,n=.495*Math.PI;d=g-Math.max(-n,Math.min(n,g+-.5*d))}d=m.clamp(d+h,k.TiltDefault.min,k.TiltDefault.max)-h;a.mat4d.identity(this.tmpTransf);a.vec3d.cross(c.up,this.tmpViewDir,this.tmpAxis);"center"===this.pivot&&(f=-f);a.mat4d.rotate(this.tmpTransf,
f,this.tmpWorldUp);a.mat4d.rotate(this.tmpTransf,d,this.tmpAxis);a.mat4d.multiplyVec3(this.tmpTransf,this.tmpViewDir);a.vec3d.add(b,this.tmpViewDir,e);a.mat4d.multiplyVec3(this.tmpTransf,c.up);a.vec2d.set(this.tmpRotCurPoint,this.lastPoint);c.markViewDirty()};return c}(r.InteractiveController);g.RotateController=e});