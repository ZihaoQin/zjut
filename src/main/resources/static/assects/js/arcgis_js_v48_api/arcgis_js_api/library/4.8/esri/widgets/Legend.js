// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
require({cache:{"esri/widgets/Legend/LegendViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Collection ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ./support/ActiveLayerInfo".split(" "),function(B,e,b,g,d,k,l,q,u,x){var r=k.ofType(x),y="esri.layers.CSVLayer esri.layers.FeatureLayer esri.layers.HeatmapLayer esri.layers.MapImageLayer esri.layers.MapNotesLayer esri.layers.PointCloudLayer esri.layers.TileLayer esri.layers.StreamLayer esri.layers.SceneLayer esri.layers.GeoRSSLayer esri.layers.GroupLayer esri.layers.ImageryLayer esri.layers.WMSLayer esri.layers.WMTSLayer".split(" "),
v=["view.basemapView.baseLayerViews","view.groundView.layerViews","view.layerViews","view.basemapView.referenceLayerViews"];return function(f){function h(c){c=f.call(this,c)||this;c._handles=new l;c._layerViewByLayerId={};c._layerInfosByLayerViewId={};c._activeLayerInfosByLayerViewId={};c.activeLayerInfos=new r;c.basemapLegendVisible=!1;c.groundLegendVisible=!1;c.layerInfos=[];c.view=null;return c}b(h,f);h.prototype.initialize=function(){this._handles.add(q.init(this,"view",this._viewHandles),"view")};
h.prototype.destroy=function(){this._destroyViewActiveLayerInfos();this._handles.destroy();this.view=this._handles=null};Object.defineProperty(h.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0});h.prototype._viewHandles=function(){this._handles.remove("state");this.view&&this._handles.add(q.init(this,"state",this._stateHandles),"state")};h.prototype._stateHandles=function(){this._resetAll();"ready"===this.state&&this._watchPropertiesAndAllLayerViews()};
h.prototype._resetAll=function(){this._handles.remove(["all-layer-views","legend-properties"]);this._destroyViewActiveLayerInfos();this.activeLayerInfos.removeAll()};h.prototype._destroyViewActiveLayerInfos=function(){Object.keys(this._activeLayerInfosByLayerViewId).forEach(this._destroyViewActiveLayerInfo,this)};h.prototype._destroyViewActiveLayerInfo=function(c){this._handles.remove(c);delete this._activeLayerInfosByLayerViewId[c]};h.prototype._watchPropertiesAndAllLayerViews=function(){var c=this.view.allLayerViews;
c.length&&this._refresh();this._handles.add(c.on("change",this._allLayerViewsChangeHandle.bind(this)),"all-layer-views");this._handles.add(q.watch(this,"layerInfos, basemapLegendVisible, groundLegendVisible",this._propertiesChangeHandle.bind(this)),"legend-properties")};h.prototype._allLayerViewsChangeHandle=function(c){var a=this;c.removed.forEach(function(c){return a._destroyViewActiveLayerInfo(c.uid)});this._refresh()};h.prototype._propertiesChangeHandle=function(){this._destroyViewActiveLayerInfos();
this._refresh()};h.prototype._refresh=function(){this._layerInfosByLayerViewId={};this.activeLayerInfos.removeAll();this._generateLayerViews().filter(this._filterLayerViewsByLayerInfos,this).filter(this._isLayerViewSupported,this).forEach(this._generateActiveLayerInfo,this);this._sortActiveLayerInfos(this.activeLayerInfos)};h.prototype._sortActiveLayerInfos=function(c){var a={};this.view.allLayerViews.forEach(function(c,b){return a[c.layer.uid]=b});c.sort(function(c,b){return(a[b.layer.uid]||0)-(a[c.layer.uid]||
0)})};h.prototype._generateLayerViews=function(){var c=[];v.filter(this._filterLayerViews,this).map(this.get,this).filter(function(a){return null!=a}).forEach(this._collectLayerViews("layerViews",c));return c};h.prototype._filterLayerViews=function(c){var a=!this.groundLegendVisible&&"view.groundView.layerViews"===c;return!(!this.basemapLegendVisible&&("view.basemapView.baseLayerViews"===c||"view.basemapView.referenceLayerViews"===c))&&!a};h.prototype._collectLayerViews=function(c,a){var b=function(n){n&&
n.forEach(function(n){a.push(n);b(n[c])});return a};return b};h.prototype._filterLayerViewsByLayerInfos=function(c){var a=this,b=this.layerInfos;return b&&b.length?b.some(function(b){return a._hasLayerInfo(b,c)}):!0};h.prototype._hasLayerInfo=function(c,a){var b=this._isLayerUIDMatching(c.layer,a.layer.uid);b&&(this._layerInfosByLayerViewId[a.uid]=c);return b};h.prototype._isLayerUIDMatching=function(c,a){return c&&(c.uid===a||this._hasLayerUID(c.layers,a))};h.prototype._hasLayerUID=function(c,a){var b=
this;return c&&c.some(function(c){return b._isLayerUIDMatching(c,a)})};h.prototype._isLayerViewSupported=function(c){return-1<y.indexOf(c.layer.declaredClass)?(this._layerViewByLayerId[c.layer.uid]=c,!0):!1};h.prototype._generateActiveLayerInfo=function(c){var a=this;this._isLayerActive(c)?this._buildActiveLayerInfo(c):(this._handles.remove(c.uid),this._handles.add(q.watch(c,"suspended, layer.legendEnabled",function(){return a._layerActiveHandle(c)}),c.uid))};h.prototype._layerActiveHandle=function(c){this._isLayerActive(c)&&
(this._handles.remove(c.uid),this._buildActiveLayerInfo(c))};h.prototype._isLayerActive=function(c){return!c.suspended&&c.get("layer.legendEnabled")};h.prototype._buildActiveLayerInfo=function(c){var a=this,b=c.layer,h=c.uid,f=this._layerInfosByLayerViewId[h],d=this._activeLayerInfosByLayerViewId[h];d||(d=new x({layer:b,title:f&&void 0!==f.title?f.title:b.title}),this._activeLayerInfosByLayerViewId[h]=d);d.parent||(f=(f=b.parent)&&this._layerViewByLayerId[f.uid],d.parent=f&&this._activeLayerInfosByLayerViewId[f.uid]);
if(!this._handles.has(h)){var f=q.watch(b,"title",function(b){return a._titleHandle(b,d,c)}),g=q.watch(b,"legendEnabled",function(b){return a._legendEnabledHandle(b,d,c)}),b=q.watch(b,"renderer, opacity",function(){return a._constructLegendElements(d,c)}),v=q.watch(c,"suspended",function(b){return a._suspendedHandle(b,d,c)}),m=q.whenTrue(this.view,"stationary",function(){return a._scaleHandle(d,c)});this._handles.add([f,g,b,v,m],h);this._constructLegendElements(d,c)}this._addActiveLayerInfo(d,c)};
h.prototype._titleHandle=function(c,a,b){a.title=c;this._constructLegendElements(a,b)};h.prototype._legendEnabledHandle=function(c,a,b){c?this._addActiveLayerInfo(a,b):this._removeActiveLayerInfo(a)};h.prototype._suspendedHandle=function(c,a,b){c?this._removeActiveLayerInfo(a):this._addActiveLayerInfo(a,b)};h.prototype._scaleHandle=function(c,a){c.scale!==this.view.scale&&c.isScaleDriven&&this._constructLegendElements(c,a)};h.prototype._addActiveLayerInfo=function(c,a){this._isLayerActive(a)&&-1===
this.activeLayerInfos.indexOf(c)&&((a=c.parent,a)?-1===a.children.indexOf(c)&&(a.children.push(c),this._sortActiveLayerInfos(a.children)):(this.activeLayerInfos.add(c),this._sortActiveLayerInfos(this.activeLayerInfos)))};h.prototype._removeActiveLayerInfo=function(c){var a=c.parent;a?(c=a.children.indexOf(c),-1!==c&&a.children.splice(c,1)):this.activeLayerInfos.remove(c)};h.prototype._constructLegendElements=function(c,a){a=a.layer;c.scale=this.view.scale;a.featureCollections?c.buildLegendElementsForFeatureCollections(a.featureCollections):
a.renderer?c.buildLegendElementsForRenderer():a.url&&c.buildLegendElementsForTools()};g([u.property({type:r})],h.prototype,"activeLayerInfos",void 0);g([u.property()],h.prototype,"basemapLegendVisible",void 0);g([u.property()],h.prototype,"groundLegendVisible",void 0);g([u.property()],h.prototype,"layerInfos",void 0);g([u.property({dependsOn:["view.ready"],readOnly:!0})],h.prototype,"state",null);g([u.property()],h.prototype,"view",void 0);return h=g([u.subclass("esri.widgets.Legend.LegendViewModel")],
h)}(u.declared(d))})},"esri/widgets/Legend/support/ActiveLayerInfo":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/io-query ../../../Color ../../../request ../../../symbols ../../../core/Accessor ../../../core/arrayUtils ../../../core/Collection ../../../core/Handles ../../../core/Logger ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/support/ExportImageParameters ../../../renderers/support/jsonUtils ../../../symbols/support/gfxUtils ../../../symbols/support/symbolPreview ../../../symbols/support/symbolUtils ./colorRampUtils ./heatmapRampUtils ./relationshipRampUtils ./sizeRampUtils".split(" "),
function(B,e,b,g,d,k,l,q,u,x,r,y,v,f,h,c,a,n,p,t,z,w,C,m,E,I){function J(a){return"esri.renderers.SimpleRenderer"===a.declaredClass}function O(a){return"esri.renderers.ClassBreaksRenderer"===a.declaredClass}function P(a){return"esri.renderers.UniqueValueRenderer"===a.declaredClass}function Q(a){return"esri.renderers.HeatmapRenderer"===a.declaredClass}function G(a){return"esri.renderers.PointCloudClassBreaksRenderer"===a.declaredClass}function L(a){return"esri.renderers.PointCloudStretchRenderer"===
a.declaredClass}function M(a){return"esri.renderers.PointCloudUniqueValueRenderer"===a.declaredClass}var F=f.getLogger("esri.widgets.Legend.support.ActiveLayerInfo"),N=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,K=new u.SimpleMarkerSymbol({size:6,outline:{color:[128,128,128,.5],width:.5}}),D=new u.SimpleMarkerSymbol({style:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15",outline:{width:1,color:[85,85,85,1]}});return function(f){function e(a){a=f.call(this,a)||this;a._handles=new v;a._hasColorRamp=!1;a._hasOpacityRamp=
!1;a._hasSizeRamp=!1;a._legendResponse={};a._webStyleSymbolCache=new Map;a.children=new y;a.layer=null;a.legendElements=[];a.parent=null;a.scale=null;a.title=null;return a}g(e,f);e.prototype.initialize=function(){var a=this,b=function(){return a.notifyChange("ready")};this._handles.add([c.on(this,"children","change",function(H){var f=H.removed,h=a._handles;H.added.map(function(a){var H="activeLayerInfo-ready-watcher-"+a.layer.uid;h.add(c.init(a,"ready",b),H)});f.forEach(function(a){return h.remove(a.layer.uid)});
b()})])};e.prototype.destroy=function(){this._handles.destroy();this._webStyleSymbolCache=this._legendResponse=this._handles=null};Object.defineProperty(e.prototype,"ready",{get:function(){return null===this.layer?!0:0<this.children.length?this._isGroupActive():0<this.legendElements.length},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"isScaleDriven",{get:function(){var a=this,c=this.layer;if(null===c)return!1;if(c.renderer){var b=c.get("renderer.valueExpression");return N.test(b)?
!0:(c=c.get("renderer.visualVariables"))&&c.some(function(c){return a._isScaleDrivenSizeVariable(c)})}return!0},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"version",{get:function(){return this._get("version")+1},enumerable:!0,configurable:!0});e.prototype.buildLegendElementsForFeatureCollections=function(a){var c=this;this.legendElements=[];a.forEach(function(a){if("esri.layers.FeatureLayer"===a.declaredClass)c._buildRendererLegendElements(a.renderer,a.title,"append");else if(a.featureSet&&
a.featureSet.features.length){var b=a.layerDefinition;(b=(b=b&&b.drawingInfo)&&p.fromJSON(b.renderer))?c._buildRendererLegendElements(b,a.name,"append"):F.warn("drawingInfo not available!")}})};e.prototype.buildLegendElementsForRenderer=function(){this._buildRendererLegendElements(this.layer.renderer,null,"replace")};e.prototype.buildLegendElementsForTools=function(){var a=this,c=this.layer;"esri.layers.WMTSLayer"===c.declaredClass?this._constructLegendElementsForWMTSlayer():"esri.layers.WMSLayer"===
c.declaredClass?this._constructLegendElementsForWMSSublayers():"esri.layers.MapImageLayer"===c.declaredClass?this._constructLegendElementsForSublayers():(this._handles.remove("imageryLayers-watcher"),this._getLegendLayers().then(function(b){a.legendElements=[];b.forEach(function(b){if("esri.layers.ImageryLayer"===a.layer.declaredClass){var H=c.watch("renderingRule, bandIds",function(){a._legendResponse["default"]=null;a.buildLegendElementsForTools()});a._handles.add(H,"imageryLayers-watcher")}(b=
a._generateSymbolTableElementForLegendLayer(b))&&b.infos.length&&a.legendElements.push(b);a.notifyChange("ready")});a.notifyChange("ready")}).catch(function(a){F.warn("Request to server for legend has failed!",a)}))};e.prototype._isGroupActive=function(){var a=this.children;return a.length?a.some(function(a){return a.ready}):!1};e.prototype._isScaleDrivenSizeVariable=function(a){if(a&&"size"!==a.type)return!1;var c=a.minSize,b=a.maxSize;return"object"===typeof c&&c?this._isScaleDrivenSizeVariable(c):
"object"===typeof b&&b?this._isScaleDrivenSizeVariable(b):!!a.expression||N.test(a.valueExpression)};e.prototype._buildRendererLegendElements=function(a,c,b){var H=this;this._getRendererLegendElements(a,c).then(function(a){"append"===b?Array.prototype.push.apply(H.legendElements,a):H.legendElements=a;H.notifyChange("ready")}).catch(function(a){F.warn("error while building legend for layer!",a)})};e.prototype._constructLegendElementsForWMTSlayer=function(){this.legendElements=[];this._handles.remove("wmts-activeLayer-watcher");
var a=this.layer,b=a.activeLayer;this._handles.add(c.watch(this.layer,"activeLayer",this._constructLegendElementsForWMTSlayer.bind(this)),"wmts-activeLayer-watcher");if(b.styleId&&b.styles){var f=null;b.styles.some(function(a){if(b.styleId===a.id)return f=a.legendUrl,!0});f&&(this.legendElements=[{type:"symbol-table",title:b.title,infos:[{src:f,opacity:a.opacity}]}])}this.notifyChange("ready")};e.prototype._constructLegendElementsForWMSSublayers=function(){this.legendElements=[];this._handles.remove("wms-sublayers-watcher");
var a=this.layer,f=null;if(a.customParameters||a.customLayerParameters)f=b({},a.customParameters,a.customLayerParameters);this._handles.add(c.watch(this.layer,"sublayers",this._constructLegendElementsForWMSSublayers.bind(this)),"wms-sublayers-watcher");this.legendElements=this._generateLegendElementsForWMSSublayers(a.sublayers,f);this.notifyChange("ready")};e.prototype._generateLegendElementsForWMSSublayers=function(a,c){var b=this,f=[];this._handles.add(a.on("change",this._constructLegendElementsForWMSSublayers.bind(this)),
"wms-sublayers-watcher");a.forEach(function(a){var H=a.watch("title, visible, legendEnabled",function(){return b._constructLegendElementsForWMSSublayers()});b._handles.add(H,"wms-sublayers-watcher");a.visible&&a.legendEnabled&&(a=b._generateSymbolTableElementForWMSSublayer(a,c))&&a.infos.length&&f.unshift(a)});return f};e.prototype._generateSymbolTableElementForWMSSublayer=function(a,c){return!a.legendUrl&&a.sublayers?(c=this._generateLegendElementsForWMSSublayers(a.sublayers,c).filter(function(a){return a}),
{type:"symbol-table",title:a.title,infos:c}):this._generateSymbolTableElementForLegendUrl(a,c)};e.prototype._generateSymbolTableElementForLegendUrl=function(a,c){var b=a.legendUrl;if(b){var f={type:"symbol-table",title:a.title||a.name||a.id&&a.id+"",infos:[]};c&&(b+="?"+k.objectToQuery(c));f.infos.push({src:b,opacity:a.layer&&a.layer.opacity});return f}};e.prototype._getLegendLayers=function(a){var c=this,b=(a=a&&a.hasDynamicLayers?a.dynamicLayers:null)||"default",f=this._legendResponse&&this._legendResponse[b];
return f?h.resolve(f):this._legendRequest(a).then(function(a){a=a.layers;return c._legendResponse[b]=a})};e.prototype._legendRequest=function(a){var c=this.layer;a={f:"json",dynamicLayers:a};"esri.layers.ImageryLayer"===c.declaredClass&&(c.renderingRule&&(a.renderingRule=JSON.stringify(c.renderingRule.toJSON())),c.bandIds&&(a.bandIds=c.bandIds.join()));var b=c.url.replace(/(\/)+$/,"");if(10.01<=c.version){var f=b.indexOf("?"),b=-1<f?b.substring(0,f)+"/legend"+b.substring(f):b+"/legend";c.token&&(b+=
"?token\x3d"+c.token)}else c=b.toLowerCase().indexOf("/rest/"),c=b.substring(0,c)+b.substring(c+5,b.length),b="https://utility.arcgis.com/sharing/tools/legend?soapUrl\x3d"+encodeURI(c)+"\x26returnbytes\x3dtrue";return q(b,{query:a,callbackParamName:"callback"}).then(function(a){return a.data})};e.prototype._constructLegendElementsForSublayers=function(){var a=this;this.legendElements=[];this._handles.remove("sublayers-watcher");var b=this.layer,f=new n({layer:b});this._getLegendLayers(f).then(function(f){var h=
{};f.forEach(function(a){h[a.layerId]=a});a._handles.add(c.watch(b,"sublayers",a._constructLegendElementsForSublayers.bind(a)),"sublayers-watcher");a.legendElements=a._generateLegendElementsForSublayers(b.sublayers,h,b.opacity);a.notifyChange("ready")}).catch(function(a){F.warn("Request to server for legend has failed!",a)}).then(function(){return f.destroy()});this.notifyChange("ready")};e.prototype._generateLegendElementsForSublayers=function(a,c,b){var f=this,h=[];this._handles.add(a.on("change",
this._constructLegendElementsForSublayers.bind(this)),"sublayers-watcher");a.forEach(function(a){var m=a.watch("renderer, opacity, title, visible",function(){return f._constructLegendElementsForSublayers()});f._handles.add(m,"sublayers-watcher");a.visible&&a.legendEnabled&&(m=a&&null!=a.opacity?a.opacity:null,(a=f._generateSymbolTableElementForSublayer(a,c,null!=m?m*b:b))&&a.infos.length&&h.unshift(a))});return h};e.prototype._generateSymbolTableElementForSublayer=function(a,c,b){var f=c[a.id];return!f&&
a.sublayers?(c=this._generateLegendElementsForSublayers(a.sublayers,c,b).filter(function(a){return a}),{type:"symbol-table",title:a.title,infos:c}):this._generateSymbolTableElementForLegendLayer(f,a,b)};e.prototype._generateSymbolTableElementForLegendLayer=function(a,c,b){var f=this;if(a){var h=c&&c.renderer,m=c&&c.title||a.layerName;h&&(h=c&&c.title||this._getRendererTitle(h,c))&&(m&&(h.title=m),m=h);m={type:"symbol-table",title:m,infos:[]};a.legendType&&(m.legendType=a.legendType);a.legend&&this._isLegendLayerInScale(a,
c)&&(c=c?this._sanitizeLegendForSublayer(a.legend.slice(),c):a.legend,m.infos=c.map(function(c){var h=c.url;if(c.imageData&&0<c.imageData.length)h="data:image/png;base64,"+c.imageData;else if(0!==h.indexOf("http")){var h=f.layer.url+"/"+a.layerId+"/images/"+h,m=f.layer.token;m&&(h+="?token\x3d"+m)}else return null;return{label:c.label,src:h,opacity:b,width:c.width,height:c.height}}).filter(function(a){return!!a}));return m.infos.length?m:null}};e.prototype._isLegendLayerInScale=function(a,c){c=c||
this.layer;var b=null,f=null,h=!0;!c.minScale&&0!==c.minScale||!c.maxScale&&0!==c.maxScale?(0===a.minScale&&c.tileInfo&&(b=c.tileInfo.lods[0].scale),0===a.maxScale&&c.tileInfo&&(f=c.tileInfo.lods[c.tileInfo.lods.length-1].scale)):(b=Math.min(c.minScale,a.minScale)||c.minScale||a.minScale,f=Math.max(c.maxScale,a.maxScale));if(0<b&&b<this.scale||f>this.scale)h=!1;return h};e.prototype._sanitizeLegendForSublayer=function(a,c){if(10.1>this.layer.version||0===a.length)return a;c=c.renderer;var b=null,
f=null;a.some(function(a){return a.values})&&a.some(function(a,c){a.values||(b=c,f=a,f.label||(f.label="others"));return null!=f});c?"unique-value"===c.type?f&&(a.splice(b,1),a.push(f)):"class-breaks"===c.type&&(f&&a.splice(b,1),a.reverse(),f&&a.push(f)):f&&(a.splice(b,1),a.push(f));return a};e.prototype._getRendererLegendElements=function(a,c){return J(a)||O(a)||P(a)||Q(a)||G(a)||L(a)||M(a)?G(a)||L(a)||M(a)||"esri.renderers.PointCloudRGBRenderer"===a.declaredClass?this._constructPointCloudRendererLegendElements(a,
c):this._constructRendererLegendElements(a,c):(F.warn("Renderer not supported!"),h.resolve([]))};e.prototype._getPointCloudRendererTitle=function(a){return a.legendOptions&&a.legendOptions.title||a.field};e.prototype._constructPointCloudRendererLegendElements=function(a,c){var b=this,f=this.layer.opacity,m=[],d=null,n=null;if(G(a))d={type:"symbol-table",title:c||this._getPointCloudRendererTitle(a),infos:[]},a.colorClassBreakInfos.forEach(function(a){d.infos.unshift({label:a.label||a.minValue+" - "+
a.maxValue,value:[a.minValue,a.maxValue],symbol:b._getAppliedCloneSymbol(K,a.color,f)})});else if(L(a)){var n=a.stops,p=null;if(n.length&&(1===n.length&&(p=n[0].color),!p)){var g=n[0].value,I=n[n.length-1].value;null!=g&&null!=I&&(p=C.getColorFromPointCloudStops(g+(I-g)/2,n))}d={type:"symbol-table",title:null,infos:[{label:null,value:null,symbol:this._getAppliedCloneSymbol(K,p||K.color,f)}]};n={type:"color-ramp",title:c||this._getPointCloudRendererTitle(a),borderColor:t.getStroke(K).color,overlayColor:C.getRampOverlayColor(f),
infos:C.getRampStopsForPointCloud(a.stops)}}else M(a)&&(d={type:"symbol-table",title:c||this._getPointCloudRendererTitle(a),infos:[]},a.colorUniqueValueInfos.forEach(function(a){d.infos.push({label:a.label||a.values.join(", "),value:a.values.join(", "),symbol:b._getAppliedCloneSymbol(K,a.color,f)})}));d&&d.infos.length&&m.push(d);n&&n.infos.length&&m.push(n);a=m.reduce(function(a,c){return a.concat(c.infos)},[]).filter(function(a){return!!a.symbol}).map(function(a){return b._getSymbolPreview(a)});
return h.eachAlways(a).then(function(){return m})};e.prototype._constructRendererLegendElements=function(a,c){var b=this;return this._loadRenderer(a).then(function(a){b._hasColorRamp=!1;b._hasOpacityRamp=!1;b._hasSizeRamp=!1;var f=b._getVisualVariableLegendElements(a)||[],d={type:"symbol-table",title:c||b._getRendererTitle(a),infos:[]},n=null,p=!1;if(Q(a))f.push({type:"heatmap-ramp",title:c,infos:m.getHeatmapRampStops(a)});else if(P(a)){var g=a&&a.authoringInfo;if(g&&"relationship"===g.type){var t=
g.focus,I=g.numClasses,e=g.field1,v=g.field2;if(I&&e&&v){for(var g=b.layer,e=[e,v],v=E.getRotationAngleForFocus(t)||0,k=0;k<e.length;k++){var H=e[k],w=H.normalizationField,H={field:b._getFieldAlias(H.field,g),normField:w&&b._getFieldAlias(w,g)},w=D.clone();w.angle=v;d.infos.push({label:H,symbol:w});v+=90}t=E.getRelationshipRampElement({focus:t,numClasses:I,infos:a.uniqueValueInfos});f.unshift(t)}}else{var z=a.field;a.uniqueValueInfos.forEach(function(a){a.symbol&&d.infos.push({label:a.label||b._getDomainName(z,
a.value)||a.value,value:a.value,symbol:a.symbol})})}a.defaultSymbol&&(d.infos.push({label:a.defaultLabel||"others",symbol:a.defaultSymbol}),p=!0)}else O(a)?(n=b._isUnclassedRenderer(a),n&&b._hasSizeRamp||(a.classBreakInfos.forEach(function(a){a.symbol&&d.infos.unshift({label:a.label||(n?null:a.minValue+" - "+a.maxValue),value:[a.minValue,a.maxValue],symbol:a.symbol})}),n&&(d.title=null),b._updateInfosforClassedSizeRenderer(a,d.infos)),a.defaultSymbol&&!n&&(d.infos.push({label:a.defaultLabel||"others",
symbol:a.defaultSymbol}),p=!0)):J(a)&&a.symbol&&!b._hasSizeRamp&&d.infos.push({label:a.label,symbol:a.symbol});t=a.defaultSymbol;!t||p||J(a)||n&&!b._hasColorRamp&&!b._hasSizeRamp&&!b._hasOpacityRamp||f.push({type:"symbol-table",infos:[{label:a.defaultLabel||"others",symbol:t}]});d.infos.length&&f.unshift(d);var l=b._getSymbolConfig(a.visualVariables),p=f.reduce(function(a,c){return a.concat(c.infos)},[]).filter(function(a){return!(!a||!a.symbol)}).map(function(a){return b._getSymbolPreview(a,l)});
a=null;return h.eachAlways(p).then(function(){return f})})};e.prototype._updateInfosforClassedSizeRenderer=function(a,c){var b=a.authoringInfo&&"class-breaks-size"===a.authoringInfo.type,f=a.classBreakInfos.some(function(a){return w.isVolumetricSymbol(a.symbol)});if(b&&f){var h=I.REAL_WORLD_MAX_SIZE;a=a.classBreakInfos.length;var m=(h-I.REAL_WORLD_MIN_SIZE)/(1<a?a-1:a);c.forEach(function(a,c){a.size=h-m*c})}};e.prototype._getSymbolConfig=function(a){var c=!1,b=!1;if(a)for(var f=0;f<a.length&&(!c||
!b);f++){var h=a[f];"size"===h.type&&("height"===h.axis&&(c=!0),"width-and-depth"===h.axis&&(b=!0))}return c&&b?"tall":null};e.prototype._getSymbolPreview=function(a,c){return z.renderPreviewHTML(a.symbol,{size:a.size,opacity:this.layer.opacity,symbolConfig:c,rotation:a.symbol.angle}).then(function(c){a.preview=c;return a}).catch(function(){a.preview=null;return a})};e.prototype._loadRenderer=function(a){var c=this,b=[];a=a.clone();var f=this._getMedianColor(a),m=this.layer.opacity;if(O(a)||P(a)){var d=
(a.classBreakInfos||a.uniqueValueInfos).map(function(a){return c._fetchSymbol(a.symbol,f,m).then(function(c){a.symbol=c}).catch(function(){a.symbol=null})});Array.prototype.push.apply(b,d)}b.push(this._fetchSymbol(a.symbol||a.defaultSymbol,a.defaultSymbol?null:f,m).then(function(b){c._applySymbolToRenderer(a,b,J(a))}).catch(function(){c._applySymbolToRenderer(a,null,J(a))}));return h.eachAlways(b).then(function(){return a})};e.prototype._applySymbolToRenderer=function(a,c,b){b?a.symbol=c:a.defaultSymbol=
c};e.prototype._getMedianColor=function(a){if(!a.visualVariables)return null;var c=r.find(a.visualVariables,function(a){return"color"===a.type});if(!c)return null;var b=null,f=null;if(c.colors)b=c.minDataValue,f=c.maxDataValue;else if(c.stops){if(1===c.stops.length)return c.stops[0].color;b=c.stops[0].value;f=c.stops[c.stops.length-1].value}if(null!=b&&null!=f)return a.getColor(b+(f-b)/2,{colorInfo:c})};e.prototype._fetchSymbol=function(a,c,b){var f=this;if(!a)return h.reject();if("web-style"===a.type){var m=
a.portal,m=a.name+"-"+a.styleName+"-"+a.styleUrl+"-"+(m&&m.url)+"-"+(m&&m.user&&m.user.username),d=this._webStyleSymbolCache;d.has(m)||d.set(m,a.fetchSymbol());return d.get(m).then(function(a){return f._getAppliedCloneSymbol(a,c,b)}).catch(function(){F.warn("Fetching web-style failed!");return h.reject()})}return h.resolve(this._getAppliedCloneSymbol(a,c,b))};e.prototype._getAppliedCloneSymbol=function(a,c,b){if(!a)return a;a=a.clone();var f=-1<a.type.indexOf("3d");c=c&&c.toRgba();f?this._applyColorTo3dSymbol(a,
c,b):(a.color&&(a.color=this._getOpacityAppliedColor(c||a.color.toRgba(),b)),(c=a.outline)&&c.color&&(c.color=this._getOpacityAppliedColor(c.color.toRgba(),b)));return a};e.prototype._applyColorTo3dSymbol=function(a,c,b){var f=this;a.symbolLayers.forEach(function(a){a&&(c&&(a.material||(a.material={}),a.material.color=new l(c)),null!=b&&(a.material&&a.material.color&&(a.material.color=f._getOpacityAppliedColor(a.material.color.toRgba(),b)),a.outline&&a.outline.color&&(a.outline.color=f._getOpacityAppliedColor(a.outline.color.toRgba(),
b))))})};e.prototype._getOpacityAppliedColor=function(a,c){a[3]*=c;return a};e.prototype._getVisualVariableLegendElements=function(a){var c=this,b=a.visualVariables,f=[],h=[],m=[],d=this.layer.opacity;if(!b)return null;b.forEach(function(a){"color"===a.type?f.push(a):"size"===a.type?h.push(a):"opacity"===a.type&&m.push(a)});var b=f.concat(h,m),n,g;0===f.length&&O(a)&&a.classBreakInfos&&1===a.classBreakInfos.length&&(n=(n=a.classBreakInfos[0])&&n.symbol);0===f.length&&J(a)&&(n=a.symbol);n&&(-1<n.type.indexOf("3d")?
(n=n.symbolLayers.getItemAt(0),n.get("material.color")&&(g=n.material.color)):n.url||(g=n.color),g&&(g=g.toRgba()));return b.map(function(b){if(!b.legendOptions||!1!==b.legendOptions.showLegend){var f=c._getRampTitle(b,c.layer),h=C.getRampBorderColor(a),m=C.getRampOverlayColor(d),n=null;"color"===b.type?(n={type:"color-ramp",title:f,borderColor:h,overlayColor:m,infos:C.getRampStops(a,b)},c._hasColorRamp||(c._hasColorRamp=!(null==n.infos||!n.infos.length))):"size"===b.type?(n={type:"size-ramp",title:f,
infos:I.getRampStops(a,b,c._getMedianColor(a),c.scale)},c._hasSizeRamp||(c._hasSizeRamp=!(null==n.infos||!n.infos.length))):"opacity"===b.type&&(n={type:"opacity-ramp",title:f,borderColor:h,overlayColor:m,infos:C.getRampStops(a,b,g)},c._hasOpacityRamp||(c._hasOpacityRamp=!(null==n.infos||!n.infos.length)));return n.infos&&n}}).filter(function(a){return!!a})};e.prototype._getDomainName=function(a,c){if(a&&"function"!==typeof a){var b=this.layer;return(b=(a=b.getField&&b.getField(a))&&b.getFieldDomain?
b.getFieldDomain(a.name):null)&&b.codedValues?b.getName(c):null}return null};e.prototype._getRampTitle=function(a,c){var b=a.field,f=a.normalizationField,h=!1,m=!1,n=!1,d=null,b="function"===typeof b?null:b,f="function"===typeof f?null:f;if(void 0!==(a.legendOptions&&a.legendOptions.title))d=a.legendOptions.title;else if(a.valueExpressionTitle)d=a.valueExpressionTitle;else{if(c.renderer.authoringInfo&&c.renderer.authoringInfo.visualVariables)for(a=c.renderer.authoringInfo.visualVariables,d=0;d<a.length;d++){var g=
a[d];if("color"===g.type)if("ratio"===g.style){h=!0;break}else if("percent"===g.style){m=!0;break}else if("percentTotal"===g.style){n=!0;break}}d={field:b&&this._getFieldAlias(b,c),normField:f&&this._getFieldAlias(f,c),ratio:h,ratioPercent:m,ratioPercentTotal:n}}return d};e.prototype._getRendererTitle=function(a,c){if(a.legendOptions&&a.legendOptions.title)return a.legendOptions.title;if(a.valueExpressionTitle)return a.valueExpressionTitle;var b=this.layer,f=a.field,h=null,m=null;O(a)&&(h=a.normalizationField,
m="percent-of-total"===a.normalizationType);f="function"===typeof f?null:f;h="function"===typeof h?null:h;a=null;if(f||h)a={field:c?f:f&&this._getFieldAlias(f,b),normField:c?h:h&&this._getFieldAlias(h,b),normByPct:m};return a};e.prototype._getFieldAlias=function(a,c){var b=c.popupTemplate,b=b&&b.fieldInfos;c="function"===typeof a?null:c.getField&&c.getField(a);var f=null;b&&b.some(function(c){if(a===c.fieldName)return f=c,!0});var b=f||c,h=null;b&&(h=f&&f.label||c&&c.alias||b.name||b.fieldName);return h};
e.prototype._isUnclassedRenderer=function(a){var c=a.visualVariables,b=!1;O(a)&&a.classBreakInfos&&1===a.classBreakInfos.length&&c&&(b=a.field?c.some(function(c){return!(!c||a.field!==c.field||(a.normalizationField||c.normalizationField)&&a.normalizationField!==c.normalizationField)}):!!c.length);return b};d([a.property()],e.prototype,"children",void 0);d([a.property()],e.prototype,"layer",void 0);d([a.property()],e.prototype,"legendElements",void 0);d([a.property()],e.prototype,"parent",void 0);
d([a.property({readOnly:!0})],e.prototype,"ready",null);d([a.property()],e.prototype,"scale",void 0);d([a.property({dependsOn:["layer.renderer.valueExpression","layer.renderer.visualVariables"],readOnly:!0})],e.prototype,"isScaleDriven",null);d([a.property()],e.prototype,"title",void 0);d([a.property({dependsOn:["ready"],readOnly:!0,value:0})],e.prototype,"version",null);return e=d([a.subclass("esri.widgets.Legend.support.ActiveLayerInfo")],e)}(a.declared(x))})},"esri/layers/support/ExportImageParameters":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators ./sublayerUtils".split(" "),
function(B,e,b,g,d,k,l,q){var u={visible:"visibleSublayers",definitionExpression:"layerDefs",labelsVisible:"hasDynamicLayers",labelingInfo:"hasDynamicLayers",opacity:"hasDynamicLayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};return function(e){function k(){var b=null!==e&&e.apply(this,arguments)||this;b.scale=0;return b}g(k,e);Object.defineProperty(k.prototype,"dynamicLayers",{get:function(){if(!this.hasDynamicLayers)return null;var b=this.visibleSublayers.map(function(b){return b.toExportImageJSON()});
return b.length?JSON.stringify(b):null},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"hasDynamicLayers",{get:function(){return q.isExportDynamic(this.visibleSublayers,this.layer.serviceSublayers,this.layer)},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"layer",{set:function(b){var d=this;this._get("layer")!==b&&(this._set("layer",b),this._layerHandles&&(this._layerHandles.forEach(function(b){return b.remove()}),this._layerHandles.length=0),b&&(this._layerHandles=
[b.allSublayers.on("change",function(){return d.notifyChange("visibleSublayers")}),b.on("sublayer-update",function(b){return d.notifyChange(u[b.propertyName])})]))},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"layers",{get:function(){var b=this.visibleSublayers;return b?b.length?"show:"+b.map(function(b){return b.id}).join(","):"show:-1":null},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"layerDefs",{get:function(){var b=this.visibleSublayers.filter(function(b){return null!=
b.definitionExpression});return b.length?JSON.stringify(b.reduce(function(b,f){b[f.id]=f.definitionExpression;return b},{})):null},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"version",{get:function(){return(this._get("version")||0)+1},set:function(b){this._set("version",b)},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"visibleSublayers",{get:function(){var b=this,d=this.layer.sublayers,f=[],h=function(c){var a=b.scale,d=0===c.minScale||a<=c.minScale,g=0===
c.maxScale||a>=c.maxScale;c.visible&&(0===a||d&&g)&&(c.sublayers?c.sublayers.forEach(h):f.unshift(c))};d&&d.forEach(h);return f},enumerable:!0,configurable:!0});k.prototype.toJSON=function(){var d=this.layer,d={dpi:d.dpi,format:d.imageFormat,transparent:d.imageTransparency,gdbVersion:d.gdbVersion||null};this.hasDynamicLayers&&this.dynamicLayers?d.dynamicLayers=this.dynamicLayers:d=b({},d,{layers:this.layers,layerDefs:this.layerDefs});return d};d([l.property({readOnly:!0,dependsOn:["hasDynamicLayers",
"visibleSublayers"]})],k.prototype,"dynamicLayers",null);d([l.property({readOnly:!0,dependsOn:["visibleSublayers","layer.serviceSublayers","layer.capabilities"]})],k.prototype,"hasDynamicLayers",null);d([l.property()],k.prototype,"layer",null);d([l.property({readOnly:!0,dependsOn:["visibleSublayers"]})],k.prototype,"layers",null);d([l.property({readOnly:!0,dependsOn:["visibleSublayers"]})],k.prototype,"layerDefs",null);d([l.property({type:Number})],k.prototype,"scale",void 0);d([l.property({dependsOn:"layers layerDefs dynamicLayers layer.dpi layer.imageFormat layer.imageTransparency layer.gdbVersion".split(" ")})],
k.prototype,"version",null);d([l.property({readOnly:!0,dependsOn:["layer.sublayers","scale"]})],k.prototype,"visibleSublayers",null);return k=d([l.subclass("esri.layers.mixins.ExportImageParameters")],k)}(l.declared(k))})},"esri/layers/support/sublayerUtils":function(){define(["require","exports","./layerSourceUtils"],function(B,e,b){function g(b,g){function d(b){var g=b.sublayers;k.unshift(b.id);g&&g.forEach(d)}if(!b||!b.length)return!0;var k=[];g.forEach(d);if(b.length>k.length)return!1;g=0;for(var e=
k.length,x=0;x<b.length;x++){for(var r=b[x].id;g<e&&k[g]!==r;)g++;if(g>=e)return!1}return!0}Object.defineProperty(e,"__esModule",{value:!0});e.isExportDynamic=function(d,k,e){return d.some(function(d){var g=d.source;return!(!g||g.type===b.MAPLAYER&&g.mapLayerId===d.id&&(!g.gdbVersion||g.gdbVersion===e.gdbVersion))||null!=d.renderer||null!=d.labelingInfo||d.hasOwnProperty("opacity")&&null!=d.opacity||d.hasOwnProperty("labelsVisible")&&null!=d.labelsVisible})?!0:!g(d,k)};e.sameStructureAsService=function(b,
g){return g.flatten(function(b){return(b=b.sublayers)&&b.toArray().reverse()}).toArray().reverse().every(function(d,g){return(g=b[g])&&d.id===g.id&&(null==d.sublayers&&null==g.sublayers||null!=d.sublayers&&null!=g.sublayers&&d.sublayers.map(function(b){return b.id}).join(",")===g.sublayers.map(function(b){return b.id}).join(","))})}})},"esri/symbols/support/symbolPreview":function(){define(["require","exports","./previewSymbol2D","./previewSymbol3D","./previewWebStyleSymbol"],function(B,e,b,g,d){function k(e,
q){switch(e.type){case "web-style":return d.previewWebStyleSymbol(e,k,q);case "label-3d":case "line-3d":case "mesh-3d":case "point-3d":case "polygon-3d":return g.previewSymbol3D(e,q);default:return b.previewSymbol2D(e,q)}}Object.defineProperty(e,"__esModule",{value:!0});e.renderPreviewHTML=k})},"esri/symbols/support/previewSymbol2D":function(){define("require exports dojox/gfx/_base ../../core/Error ../../core/promiseUtils ../../core/screenUtils ../SimpleMarkerSymbol ./gfxUtils ./previewUtils ./renderUtils".split(" "),
function(B,e,b,g,d,k,l,q,u,x){function r(b,f){var d=y.getContext("2d"),c=[];f&&(f.weight&&c.push(f.weight),f.size&&c.push(f.size+"px"),f.family&&c.push(f.family));d.font=c.join(" ");return d.measureText(b).width}Object.defineProperty(e,"__esModule",{value:!0});var y=document.createElement("canvas");e.previewSymbol2D=function(e,f){var h=f&&f.size?k.pt2px(f.size):null,c=f&&f.maxSize?k.pt2px(f.maxSize):null,a=q.getStroke(e),n={shape:null,fill:null,stroke:a};a&&a.width&&(a.width=Math.min(a.width,80));
var p=0,t=0,z=a&&a.width||0,w=!1,C=null;switch(e.type){case "simple-marker":var m=l.defaultProps,a=e.style,t=p=h=Math.min(h||k.pt2px(e.size||m.size),c||120);switch(a){case l.STYLE_CIRCLE:n.shape={type:"circle",cx:0,cy:0,r:.5*h};break;case l.STYLE_CROSS:n.shape={type:"path",path:[{command:"M",values:[0,.5*t]},{command:"L",values:[p,.5*t]},{command:"M",values:[.5*p,0]},{command:"L",values:[.5*p,t]},{command:"E",values:[]}]};break;case l.STYLE_DIAMOND:n.shape={type:"path",path:[{command:"M",values:[0,
.5*t]},{command:"L",values:[.5*p,0]},{command:"L",values:[p,.5*t]},{command:"L",values:[.5*p,t]},{command:"Z",values:[]}]};break;case l.STYLE_SQUARE:n.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[p,0]},{command:"L",values:[p,t]},{command:"L",values:[0,t]},{command:"Z",values:[]}]};break;case l.STYLE_X:n.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[p,t]},{command:"M",values:[p,0]},{command:"L",values:[0,t]},{command:"E",values:[]}]};break;case l.STYLE_PATH:w=
!0,n.shape={type:"path",path:e.path||""}}break;case "simple-line":z=Math.min(h||z,c||80);p=22<z?2*z:40;t=z;a.width=z;z=0;n.shape={type:"path",path:[{command:"M",values:[0,.5*t]},{command:"L",values:[p,.5*t]},{command:"E",values:[]}]};break;case "picture-fill":case "simple-fill":n.shape=u.shapes.fill[0];break;case "picture-marker":c=c||120;a=k.pt2px(e.width);m=k.pt2px(e.height);h=Math.min(h||Math.max(a,m),c);m=a/m;a=1>=m?Math.ceil(h*m):h;m=1>=m?h:Math.ceil(h/m);p=a;t=m;C=f.opacity;n.shape={type:"image",
x:-Math.round(a/2),y:-Math.round(m/2),width:a,height:m,src:e.url||""};break;case "text":var a=e.text||"Aa",m=e.font,h=Math.min(h||k.pt2px(m.size),c||120),E=r(a,{weight:m.weight,size:h,family:m.family}),p=(c=/[\uE600-\uE6FF]/.test(a))?h:E,t=h,E=.25*b.normalizedLength((m?h:0).toString());c&&(E+=5);n.shape={type:"text",text:a,x:0,y:E,align:"middle",decoration:e.decoration||m&&m.decoration,rotated:e.rotated,kerning:e.kerning};n.font=m&&{size:h,style:m.style,decoration:m.decoration,weight:m.weight,family:m.family}}if(!n.shape)return d.reject(new g("symbolPreview: renderPreviewHTML2D",
"symbol not supported."));var p=(p||22)+2*z,t=(t||22)+2*z,I=q.getFill(e),z=e.color,h=null;I&&"pattern"===I.type&&z&&"picture-fill"!==e.type?h=q.getPatternUrlWithColor(I.src,z.toCss(!0)).then(function(a){I.src=a;n.fill=I;return n}):(n.fill=I,h=d.resolve(n));return h.then(function(a){return x.renderSymbol([[a]],[p,t],{node:f&&f.node,scale:w,opacity:C,rotation:f.rotation})})}})},"esri/symbols/support/previewUtils":function(){define(["require","exports"],function(B,e){Object.defineProperty(e,"__esModule",
{value:!0});e.shapes={fill:[{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"}],pathSymbol3DLayer:[{type:"path",path:"M 3,12 L 12,0 L 11,-2 L -4,5 L -1,5 L 1,7 L 3,10 L 3,12 Z"},{type:"circle",cx:-2,cy:10,r:5}],extrudeSymbol3DLayer:[{type:"path",path:"M -7,-5 L -2,0 L -2,7 L -7,3 L -7,-5 Z"},{type:"path",path:"M -2,0 L -2,7 L 10,-3 L 10,-10 L -2,0 Z"},{type:"path",path:"M -7,-5 L -2,0 L 10,-10 L -2,-10 L -7,-5 Z"}],cone:[{type:"path",path:"M 0,-10 L -8,5 L -4,6.5 L 0,7 L 4,6.5 L 8,5 Z"}],
tallCone:[{type:"path",path:"M 0,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 0,-9 Z"}],invertedCone:[{type:"path",path:"M 0,7 L -8,-8 L 8,-8 Z"},{type:"path",path:"M -8,-8 L -4,-9.5 L 0,-10 L 4,-9.5 L 8,-8 L 4,-6.5 L 0,-6 L -4,-6.5 Z"}],cube:[{type:"path",path:"M -10,-7 L 0,-12 L 10,-7 L 0,-2 L -10,-7 Z"},{type:"path",path:"M -10,-7 L 0,-2 L 0,12 L -10,7 L -10,-7 Z"},{type:"path",path:"M 0,-2 L 10,-7 L 10,7 L 0,12 L 0,-2 Z"}],tallCube:[{type:"path",path:"M -3.5,-8.5 L 0,-9.5 L 3.5,-8.5 L 0,-7.5 L -3.5,-8.5 Z"},
{type:"path",path:"M -3.5,-8.5 L 0,-7.5 L 0,9 L -3.5,8 L -3.5,-8.5 Z"},{type:"path",path:"M 0,-7.5 L 3.5,-8.5 L 3.5,8 L 0,9 L 0,-7.5 Z"}],cylinder:[{type:"path",path:"M -8,-9 L -8,7 L -4,8.5 L 0,9 L 4,8.5 L 8,7 L 8,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:8,ry:2}],tallCylinder:[{type:"path",path:"M -3.5,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 3.5,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:3.5,ry:1}],diamond:[{type:"path",path:"M 0,-10 L 10,-1 L -1,1 L 0,-10 Z"},{type:"path",path:"M 0,-10 L -1,1 L -8,-1 L 0,-10 Z"},
{type:"path",path:"M -1,1 L 0,10 L -8,-1 L -1,1 Z"},{type:"path",path:"M -1,0 L 0,10 L 10,-1 L -1,1 Z"}],tetrahedron:[{type:"path",path:"M 0,-10 L 10,7 L 0,0 L 0,-10 Z"},{type:"path",path:"M 0,-10 L 0,0 L -8,7 L 0,-10 Z"},{type:"path",path:"M 10,7 L 0,0 L -8,7 L 10,7 Z"}]};e.getExtrudeSymbolShapes=function(b){b*=.5;return[{type:"path",path:[{command:"M",values:[0,.7*11]},{command:"L",values:[6.6,22*.7]},{command:"L",values:[6.6,22*.7+b]},{command:"L",values:[0,22*.7+b-.7*11]},{command:"Z",values:[]}]},
{type:"path",path:[{command:"M",values:[6.6,22*.7]},{command:"L",values:[6.6,22*.7+b]},{command:"L",values:[22,b]},{command:"L",values:[22,0]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[6.6,0]},{command:"L",values:[22,0]},{command:"L",values:[6.6,22*.7]},{command:"L",values:[0,.7*11]},{command:"Z",values:[]}]}]};e.getCubeShapes=function(b,g){var d=g?20:b,e=g?4:6,e=d=22>=d?d-.5*e:d-e;g=g?.35*d:.5*d;return[{type:"path",path:[{command:"M",values:[.5*e,0]},{command:"L",values:[e,
.5*g]},{command:"L",values:[.5*e,g]},{command:"L",values:[0,.5*g]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*g]},{command:"L",values:[.5*e,g]},{command:"L",values:[.5*e,b]},{command:"L",values:[0,b-.5*g]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.5*e,g]},{command:"L",values:[.5*e,b]},{command:"L",values:[e,b-.5*g]},{command:"L",values:[e,.5*g]},{command:"Z",values:[]}]}]};e.getCylinderShapes=function(b,g){var d=g?20:b;g=g?4:6;d=22>=d?d-.5*g:d-
g;g=.5*d;var e=.15*d;b-=e;return[{type:"ellipse",cx:.5*d,cy:b,rx:g,ry:e},{type:"path",path:[{command:"M",values:[0,e]},{command:"L",values:[0,b]},{command:"L",values:[d,b]},{command:"L",values:[d,e]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*d,cy:e,rx:g,ry:e}]};e.getConeShapes=function(b,g){var d=g?20:b;g=g?4:6;d=22>=d?d-.5*g:d-g;g=.15*d;var e=d;b-=g;return[{type:"ellipse",cx:.5*d,cy:b,rx:.5*d,ry:g},{type:"path",path:[{command:"M",values:[.5*e,0]},{command:"L",values:[e,b]},{command:"L",values:[0,
b]},{command:"Z",values:[]}]}]};e.getInvertedConeShapes=function(b){var g=b,g=22>g?g-3:g-6,d=.15*g,e=g;return[{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[e,0]},{command:"L",values:[.5*e,b-d]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*g,cy:0,rx:.5*g,ry:d}]};e.getDiamondShapes=function(b){var g=b,g=22>g?g-2:g-4,d=Math.floor(b/10)-1||1;return[{type:"path",path:[{command:"M",values:[.45*g,0]},{command:"L",values:[g,.5*b-d]},{command:"L",values:[.45*g-d,.5*b+d]},{command:"Z",
values:[]}]},{type:"path",path:[{command:"M",values:[.45*g,0]},{command:"L",values:[.45*g-d,.5*b+d]},{command:"L",values:[0,.5*b-d]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*b-d]},{command:"L",values:[.45*g-d,.5*b+d]},{command:"L",values:[.45*g,b]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*g,b]},{command:"L",values:[g,.5*b-d]},{command:"L",values:[.45*g-d,.5*b+d]},{command:"Z",values:[]}]}]};e.getTetrahedronShapes=function(b){var g=b,g=22>
g?g-1:g-2;return[{type:"path",path:[{command:"M",values:[.45*b,0]},{command:"L",values:[b,g]},{command:"L",values:[.45*b,.6*g]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*b,0]},{command:"L",values:[.45*b,.6*g]},{command:"L",values:[0,g]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,g]},{command:"L",values:[.45*b,.6*g]},{command:"L",values:[b,g]},{command:"Z",values:[]}]}]}})},"esri/symbols/support/renderUtils":function(){define("require exports dojox/gfx dojox/gfx/matrix ../../kernel ../../request ../../core/colorUtils ../../core/Error ../../core/lang ../../core/promiseUtils ../../core/sniff".split(" "),
function(B,e,b,g,d,k,l,q,u,x,r){function y(b){return b.map(function(c){return c.command+" "+c.values.join(",")}).join(" ").trim()}function v(f,c,a,d){var h=d&&d.node||document.createElement("div"),n=b.createSurface(h,c,a);null!=d.opacity&&(h.style.opacity=d.opacity.toString());try{f.forEach(function(b){var f=n.createGroup(),h=0;b.forEach(function(a){var b=a.shape,c=a.fill,d=a.stroke;h+=d&&d.width||0;var m=null;b&&("path"===b.type&&"string"!==typeof b.path&&(b.path=y(b.path)),m=f.createShape(b).setFill(c).setStroke(d?
d:{width:0}),"text"===b.type&&m.setFont(a.font))});var m=f.getBoundingBox();b=m.width;var e=m.height,p=-(m.x+b/2),t=-(m.y+e/2),k=n.getDimensions(),p={dx:p+k.width/2,dy:t+k.height/2},t=!1;if(d.scale&&0!==m.width&&0!==m.height){var t=m.width/m.height,z=(c>a?c:a)-2*h,v=1,l=1;isNaN(z)||(1<t?(v=z/m.width,l=z/t/m.height):(l=z/m.height,v=z*t/m.width));f.applyTransform(g.scaleAt(v,l,k.width/2,k.height/2));t=!0}!t&&(b>c||e>a)&&(m=b/c>e/a,m=((m?c:a)-5)/(m?b:e),u.mixin(p,{xx:m,yy:m}));f.applyTransform(p);d.rotation&&
f.applyTransform(g.rotategAt(d.rotation,b/2,e/2))})}catch(z){return n.clear(),n.destroy(),null}return h}function f(b,c,a,d){return b?k(b,{responseType:"image",allowImageDataAccess:a}).then(function(b){b=b.data;var f=b.width,h=b.height,n=f/h,g=c;d&&(g=Math.min(g,Math.max(f,h)));return{image:a?b:null,width:1>=n?Math.ceil(g*n):g,height:1>=n?g:Math.ceil(g/n)}}).catch(function(h){if(a)return f(b,c,!1,d);throw h;}):x.reject(new q("renderUtils: imageDataSize","href not provided."))}Object.defineProperty(e,
"__esModule",{value:!0});e.renderSymbol=function(b,c,a){var f=Math.ceil(c[0]);c=Math.ceil(c[1]);return b.some(function(a){return!!a.length})?v(b,f,c,a):null};e.tintImageWithColor=function(b,c,a,g,e){return f(b,c,!!a,e).then(function(f){var h=f.width?f.width:c,n=f.height?f.height:c,e;if(e=f.image)e=a&&"ignore"!==g?"multiply"===g&&255===a.r&&255===a.g&&255===a.b&&1===a.a?!1:!0:!1;if(e){var m=f.image.width,p=f.image.height;(r("edge")||r("ie"))&&/\.svg$/i.test(b)&&(--m,--p);var t,k;t=Math.ceil(h);k=Math.ceil(n);
e=document.createElement("canvas");e.width=t;e.height=k;e.style.width=t+"px";e.style.height=k+"px";e=e.getContext("2d");e.clearRect(0,0,t,k);e.drawImage(f.image,0,0,m,p,0,0,h,n);f=e.getImageData(0,0,h,n);m=[a.r/255,a.g/255,a.b/255,a.a];p=l.toHSV(a);for(t=0;t<f.data.length;t+=4){k=f.data;var v=t,q=m,y=p;switch(g){case "multiply":k[v+0]*=q[0];k[v+1]*=q[1];k[v+2]*=q[2];k[v+3]*=q[3];break;default:var u=l.toHSV({r:k[v+0],g:k[v+1],b:k[v+2]});u.h=y.h;u.s=y.s;u.v=u.v/100*y.v;y=l.toRGB(u);k[v+0]=y.r;k[v+1]=
y.g;k[v+2]=y.b;k[v+3]*=q[3]}}e.putImageData(f,0,0);b=e.canvas.toDataURL("image/png")}else(e=d.id&&d.id.findCredential(b))&&e.token&&(f=-1===b.indexOf("?")?"?":"\x26",b=""+b+f+"token\x3d"+e.token);return{url:b,width:h,height:n}}).catch(function(){return{url:b,width:c,height:c}})}})},"dojox/gfx":function(){define(["dojo/_base/lang","./gfx/_base","./gfx/renderer!"],function(B,e,b){e.switchTo(b);return e})},"dojox/gfx/renderer":function(){define(["./_base","dojo/_base/lang","dojo/_base/sniff","dojo/_base/window",
"dojo/_base/config"],function(B,e,b,g,d){var k=null;b.add("vml",function(b,d,g){g.innerHTML='\x3cv:shape adj\x3d"1"/\x3e';b="adj"in g.firstChild;g.innerHTML="";return b});return{load:function(l,q,u){function x(){q(["dojox/gfx/"+r],function(b){B.renderer=r;k=b;u(b)})}if(k&&"force"!=l)u(k);else{var r=d.forceGfxRenderer;l=!r&&(e.isString(d.gfxRenderer)?d.gfxRenderer:"svg,vml,canvas,silverlight").split(",");for(var y,v;!r&&l.length;)switch(l.shift()){case "svg":"SVGAngle"in g.global&&(r="svg");break;
case "vml":b("vml")&&(r="vml");break;case "silverlight":try{b("ie")?(y=new ActiveXObject("AgControl.AgControl"),y.IsVersionSupported("1.0"))&&(v=!0):navigator.plugins["Silverlight Plug-In"]&&(v=!0)}catch(f){v=!1}finally{y=null}v&&(r="silverlight");break;case "canvas":g.global.CanvasRenderingContext2D&&(r="canvas")}"canvas"===r&&!1!==d.canvasEvents&&(r="canvasWithEvents");d.isDebug&&console.log("gfx renderer \x3d "+r);"svg"==r&&"undefined"!=typeof window.svgweb?window.svgweb.addOnLoad(x):x()}}}})},
"esri/core/colorUtils":function(){define([],function(){var B={COEF_RGB2XYZ:[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],COEF_XYZ2RGB:[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]],matrixProduct:function(b,g){var d=[],e,l;if(b[0].length!==g.length)throw"dimensions do not match";var q=b.length,u=b[0].length,x=0;for(e=0;e<q;e++){for(l=x=0;l<u;l++)x+=b[e][l]*g[l];d.push(x)}return d},rgb2xyz:function(b){b=[b.r/255,b.g/255,b.b/255].map(function(b){return.04045>=b?b/
12.92:Math.pow((b+.055)/1.055,2.4)});b=this.matrixProduct(this.COEF_RGB2XYZ,b);return{x:100*b[0],y:100*b[1],z:100*b[2]}},xyz2rgb:function(b){b=this.matrixProduct(this.COEF_XYZ2RGB,[b.x/100,b.y/100,b.z/100]).map(function(b){return Math.min(1,Math.max(.0031308>=b?12.92*b:1.055*Math.pow(b,1/2.4)-.055,0))});return{r:Math.round(255*b[0]),g:Math.round(255*b[1]),b:Math.round(255*b[2])}},xyz2lab:function(b){b=[b.x/95.047,b.y/100,b.z/108.883].map(function(b){return b>Math.pow(6/29,3)?Math.pow(b,1/3):1/3*Math.pow(29/
6,2)*b+4/29});return{l:116*b[1]-16,a:500*(b[0]-b[1]),b:200*(b[1]-b[2])}},lab2xyz:function(b){var g=b.l;b=[(g+16)/116+b.a/500,(g+16)/116,(g+16)/116-b.b/200].map(function(b){return b>6/29?Math.pow(b,3):3*Math.pow(6/29,2)*(b-4/29)});return{x:95.047*b[0],y:100*b[1],z:108.883*b[2]}},lab2lch:function(b){var g=b.l,d=b.a,e=b.b;b=Math.sqrt(d*d+e*e);d=Math.atan2(e,d);d=0<d?d:d+2*Math.PI;return{l:g,c:b,h:d}},lch2lab:function(b){var g=b.c,d=b.h;return{l:b.l,a:g*Math.cos(d),b:g*Math.sin(d)}},rgb2lab:function(b){return this.xyz2lab(this.rgb2xyz(b))},
lab2rgb:function(b){return this.xyz2rgb(this.lab2xyz(b))},rgb2lch:function(b){return this.lab2lch(this.xyz2lab(this.rgb2xyz(b)))},lch2rgb:function(b){return this.xyz2rgb(this.lab2xyz(this.lch2lab(b)))}},e={rgb2hsv:function(b){var g=b.r,d=b.g;b=b.b;var e=Math.max(g,d,b),l=e-Math.min(g,d,b),q;0===l?q=0:e===g?q=(d-b)/l%6:e===d?q=(b-g)/l+2:e===b&&(q=(g-d)/l+4);0>q&&(q+=6);return{h:60*q,s:100*(0===l?0:l/e),v:100/255*e}},hsv2rgb:function(b){var e=b.h/60,d=b.v/100*255;b=b.s/100*d;var k=b*(1-Math.abs(e%2-
1)),l;switch(Math.floor(e)){case 0:l={r:b,g:k,b:0};break;case 1:l={r:k,g:b,b:0};break;case 2:l={r:0,g:b,b:k};break;case 3:l={r:0,g:k,b:b};break;case 4:l={r:k,g:0,b:b};break;case 5:case 6:l={r:b,g:0,b:k}}l.r=Math.round(l.r+d-b);l.g=Math.round(l.g+d-b);l.b=Math.round(l.b+d-b);return l}};return{toRGB:function(b){var g;void 0!==b.r&&void 0!==b.g&&void 0!==b.b?g=b:void 0!==b.l&&void 0!==b.c&&void 0!==b.h?g=B.lch2rgb(b):void 0!==b.l&&void 0!==b.a&&void 0!==b.b?g=B.lab2rgb(b):void 0!==b.x&&void 0!==b.y&&
void 0!==b.z?g=B.xyz2rgb(b):void 0!==b.h&&void 0!==b.s&&void 0!==b.v&&(g=e.hsv2rgb(b));return g},toHSV:function(b){if(void 0!==b.h&&void 0!==b.s&&void 0!==b.v)return b;b=this.toRGB(b);return e.rgb2hsv(b)},toLAB:function(b){return void 0!==b.l&&void 0!==b.a&&void 0!==b.b?b:B.rgb2lab(this.toRGB(b))},toLCH:function(b){return void 0!==b.l&&void 0!==b.c&&void 0!==b.h?b:B.rgb2lch(this.toRGB(b))},toXYZ:function(b){return void 0!==b.x&&void 0!==b.y&&void 0!==b.z?b:B.rgb2xyz(this.toRGB(b))}}})},"esri/symbols/support/previewSymbol3D":function(){define("require exports ../../core/Error ../../core/Logger ../../core/promiseUtils ../../core/screenUtils ./gfxUtils ./previewUtils ./renderUtils ./styleUtils ./symbolUtils".split(" "),
function(B,e,b,g,d,k,l,q,u,x,r){function y(a){var b=a.outline,c=a.get("material.color"),c=c&&c.toRgba().toString();if(!b)return"fill"===a.type&&"255,255,255,1"===c?{color:"#bdc3c7",width:.75}:null;a=k.pt2px(b.size)||0;return{color:"rgba("+(null!=b.color?b.color.toRgba():"255,255,255,1")+")",width:Math.min(a,80)}}function v(a,b){var c=b&&b.resource,c=c&&c.href;return a.thumbnail&&a.thumbnail.url?d.resolve(a.thumbnail.url):c&&"object"!==b.type?d.resolve(r.getIconHref(a,b)):a.styleOrigin&&(a.styleOrigin.styleName||
a.styleOrigin.styleUrl)?x.resolveWebStyleSymbol(a.styleOrigin,{portal:a.styleOrigin.portal}).always(function(a){return a&&a.thumbnail&&a.thumbnail.url||w}):d.resolve(w)}function f(a,b){void 0===b&&(b=0);if(!a.material||!a.material.color)return a=Math.min(Math.max(l.defaultThematicColor.r+191.25*b,0),255),[a,a,a,100];for(var c=a.material.color.toRgb(),f=0;3>f;f++)c[f]=Math.min(Math.max(c[f]+191.25*b,0),255);c.push(a.material.color.a);return c}function h(a){return a.outline?y(a):{color:"rgba(0, 0, 0, 1)",
width:1.5}}function c(a,b){if(!a.material)return{};for(var c=a.material.color.toRgb(),f="rgba(",d=0;3>d;d++)f+=Math.min(Math.max(c[d]+191.25*b,0),255)+",";f+=a.material.color.a+");";a=a.size?k.pt2px(a.size):.75;return{color:f,width:Math.min(a,80)}}function a(a,b,c){c*=.75;return{type:"linear",x1:c?.25*c:0,y1:c?.5*c:0,x2:c||4,y2:c?.5*c:4,colors:[{color:a,offset:0},{color:b,offset:1}]}}function n(a){var b=a.depth,c=a.height;return(a=a.width)&&b&&c&&a===b&&a<c}function p(b,c,d,e){var n=b&&b.type,g="object"===
n,p=[];if("icon"===n)switch(c){case "circle":p.push({shape:{type:"circle",cx:0,cy:0,r:.5*d},fill:f(b,0),stroke:y(b)});break;case "square":p.push({shape:{type:"path",path:[{command:"M",values:[0,d]},{command:"L",values:[0,0]},{command:"L",values:[d,0]},{command:"L",values:[d,d]},{command:"Z",values:[]}]},fill:f(b,0),stroke:y(b)});break;case "cross":p.push({shape:{type:"path",path:[{command:"M",values:[.5*d,0]},{command:"L",values:[.5*d,d]},{command:"M",values:[0,.5*d]},{command:"L",values:[d,.5*d]},
{command:"E",values:[]}]},stroke:h(b)});break;case "x":p.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[d,d]},{command:"M",values:[d,0]},{command:"L",values:[0,d]},{command:"E",values:[]}]},stroke:h(b)});break;case "kite":p.push({shape:{type:"path",path:[{command:"M",values:[0,.5*d]},{command:"L",values:[.5*d,0]},{command:"L",values:[d,.5*d]},{command:"L",values:[.5*d,d]},{command:"Z",values:[]}]},fill:f(b,0),stroke:y(b)})}else if(g)switch(c){case "cone":c=f(b,0);b=
f(b,-.6);b=a(c,b,e?20:d);d=q.getConeShapes(d,e);p.push({shape:d[0],fill:b});p.push({shape:d[1],fill:b});break;case "inverted-cone":e=f(b,0);b=f(b,-.6);b=a(e,b,d);d=q.getInvertedConeShapes(d);p.push({shape:d[0],fill:b});p.push({shape:d[1],fill:e});break;case "cube":d=q.getCubeShapes(d,e);p.push({shape:d[0],fill:f(b,0)});p.push({shape:d[1],fill:f(b,-.3)});p.push({shape:d[2],fill:f(b,-.5)});break;case "cylinder":c=f(b,0);n=f(b,-.6);c=a(c,n,e?20:d);d=q.getCylinderShapes(d,e);p.push({shape:d[0],fill:c});
p.push({shape:d[1],fill:c});p.push({shape:d[2],fill:f(b,0)});break;case "diamond":d=q.getDiamondShapes(d);p.push({shape:d[0],fill:f(b,-.3)});p.push({shape:d[1],fill:f(b,0)});p.push({shape:d[2],fill:f(b,-.3)});p.push({shape:d[3],fill:f(b,-.7)});break;case "sphere":e=f(b,0);b=f(b,-.6);b=a(e,b);b.x1=0;b.y1=0;b.x2=.25*d;b.y2=.25*d;p.push({shape:{type:"circle",cx:0,cy:0,r:.5*d},fill:b});break;case "tetrahedron":d=q.getTetrahedronShapes(d),p.push({shape:d[0],fill:f(b,-.3)}),p.push({shape:d[1],fill:f(b,
0)}),p.push({shape:d[2],fill:f(b,-.6)})}return p}function t(a,b){var c=b&&b.size?k.pt2px(b.size):null,f=b&&b.maxSize?k.pt2px(b.maxSize):null,h=b&&b.disableUpsampling,e=a.symbolLayers,g=[],t=0,m=0,w=e.getItemAt(e.length-1),z;w&&"icon"===w.type&&(z=w.size&&k.pt2px(w.size));e.forEach(function(e,w){if("icon"===e.type||"object"===e.type){w="icon"===e.type?e.size&&k.pt2px(e.size):0;var l=c||w?Math.ceil(Math.min(c||w,f||120)):22,q=y(e),C=q?q.width:0;if(e&&e.resource&&e.resource.href)w=v(a,e).then(function(a){var b=
e.get("material.color"),c;c="icon"===e.type?"multiply":"tint";return u.tintImageWithColor(a,l,b,c,h)}).then(function(a){var b=a.width,c=a.height;t=Math.max(t,b+2*C);m=Math.max(m,c+2*C);return[{shape:{type:"image",width:b,height:c,src:a.url},fill:null,stroke:null}]}),g.unshift(w);else{(q=e.get("resource.primitive"))||(q="icon"===e.type?"circle":"sphere");var E=l;"icon"===e.type&&z&&c&&(E=w/z*l);w=b&&"tall"===b.symbolConfig||("object"===e.type?n(e):!1);t=Math.max(t,w?20:E+2*C);m=Math.max(m,E+2*C);g.unshift(d.resolve(p(e,
q,E,w)))}}});return d.eachAlways(g).then(function(a){var c=[];a.forEach(function(a){a.value?c.push(a.value):a.error&&C.warn("error while building swatchInfo!",a.error)});return u.renderSymbol(c,[t,m],{node:b&&b.node,scale:!1})})}function z(a,b){var e=a.symbolLayers,h=[];a=r.isVolumetricSymbol(a);var n=b&&b.size?k.pt2px(b.size):null,g=(b&&b.maxSize?k.pt2px(b.maxSize):null)||80,p=0,t=0,m;e.forEach(function(a,b){var d=a&&a.type,e="line"===d;if(e||"path"===d){var k=c(a,0),w=k&&k.width||0,d=[];e?(0===
b&&(m=w),a=Math.min(n||w,g),a=0===b?a:n?w/m*a:a,t=Math.max(t,a),p=Math.max(p,22<a?2*a:40),k.width=a,d.push({shape:{type:"path",path:[{command:"M",values:[0,.5*t]},{command:"L",values:[p,.5*t]},{command:"E",values:[]}]},stroke:k})):(b=Math.min(n||22,g),k=f(a,0),e=f(a,-.2),a=c(a,-.4),a.width=1,d.push({shape:q.shapes.pathSymbol3DLayer[0],fill:e,stroke:a}),d.push({shape:q.shapes.pathSymbol3DLayer[1],fill:k,stroke:a}),p=t=Math.max(t,b+2));h.push(d)}});return d.resolve(u.renderSymbol(h,[p,t],{node:b&&b.node,
scale:a}))}Object.defineProperty(e,"__esModule",{value:!0});var w=B.toUrl("../../images/Legend/legend3dsymboldefault.png"),C=g.getLogger("esri.symbols.support.previewSymbol3D");e.getSymbolLayerFill=f;e.previewSymbol3D=function(a,e){if(0===a.symbolLayers.length)return d.reject(new b("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));var h=null;switch(a.type){case "point-3d":h=t(a,e);break;case "line-3d":h=z(a,e);break;case "polygon-3d":case "mesh-3d":a:{h="mesh-3d"===a.type;a=
a.symbolLayers;for(var n=e&&e.size?k.pt2px(e.size):null,g=e&&e.maxSize?k.pt2px(e.maxSize):null,n=n||22,p=[],m=0,w=0,v=0;v<a.length;v++){var l=a.getItemAt(v),C=l.type,r="fill"===C,E="line"===C,x="extrude"===l.type,C=[];if(h&&!r){h=void 0;break a}var A=q.shapes.fill[0];r?(E=(r=y(l))&&r.width||0,m=Math.max(m,22+E),w=Math.max(w,22+E),C.push({shape:A,fill:f(l,0),stroke:r})):E?(l=(r=c(l,0))&&r.width||0,A={stroke:r,shape:A},m=Math.max(m,22+l),w=Math.max(w,22+l),C.push(A)):x&&(A=c(l,-.4),r=f(l,0),l=f(l,-.2),
E=Math.min(n,g||120),x=q.getExtrudeSymbolShapes(E),A.width=1,C.push({shape:x[0],fill:l,stroke:A}),C.push({shape:x[1],fill:l,stroke:A}),C.push({shape:x[2],fill:r,stroke:A}),l=22*.7+.5*E,m=Math.max(m,22+2*A.width),w=Math.max(w,l+2*A.width));p.push(C)}h=d.resolve(u.renderSymbol(p,[m,w],{node:e&&e.node,scale:!1}))}}return h?h:d.reject(new b("symbolPreview: swatchInfo3D","symbol not supported."))}})},"esri/symbols/support/symbolUtils":function(){define(["require","exports","../../core/sniff"],function(B,
e,b){Object.defineProperty(e,"__esModule",{value:!0});e.isVolumetricSymbol=function(b){return(b=b&&b.symbolLayers)?b.some(function(b){b=b.type;return"object"===b||"path"===b||"extrude"===b}):!1};e.getIconHref=function(d,e){e=e.resource.href;return!b("esri-canvas-svg-support")&&d.styleOrigin&&g.test(e)?e.replace(g,"/resource/png/$1.png"):e};var g=/\/resource\/(.*?)\.svg$/})},"esri/symbols/support/previewWebStyleSymbol":function(){define(["require","exports","../../request","../../core/screenUtils"],
function(B,e,b,g){Object.defineProperty(e,"__esModule",{value:!0});e.previewWebStyleSymbol=function(d,e,l){var k=d.thumbnail&&d.thumbnail.url;return k?b(k,{responseType:"image"}).then(function(b){b=b.data;var d=!/\\.svg$/i.test(b.src)&&l&&l.disableUpsampling,e=Math.max(b.width,b.height),k=l&&null!=l.maxSize?g.pt2px(l.maxSize):120;d&&(k=Math.min(e,k));d=Math.min(k,l&&null!=l.size?g.pt2px(l.size):e);d!==e&&(e=0!==b.width&&0!==b.height?b.width/b.height:1,1<=e?(b.width=d,b.height=d/e):(b.width=d*e,b.height=
d));return l&&l.node?(l.node.appendChild(b),l.node):b}):d.fetchSymbol().then(function(b){return e(b,l)})}})},"esri/widgets/Legend/support/colorRampUtils":function(){define("require exports ../../../Color ../../../core/numberUtils ../../../symbols/support/gfxUtils ./utils".split(" "),function(B,e,b,g,d,k){function l(b,f){var d=f-b;f=[0,.25,.5,.75,1].map(function(c){return Number((b+c*d).toFixed(6))});q(0,4,f);return f}function q(b,f,d){var c=b+(f-b)/2,a=d[0],e=d[1],h=d[2],g=Math.floor(a),k=Math.floor(e),
w=Math.floor(h);g===a&&w===h&&k!==e&&g!==k&&w!==k&&(d[c]=k);b+1!==c&&q(b,c,d);c+1!==f&&q(c,f,d)}function u(d,f){d=x(d,f);var e=d.startIndex,c=d.endIndex;if(e===c)return f[e].color;f=b.blendColors(f[e].color,f[c].color,d.weight);return new b(f)}function x(b,d){var f=0,c=d.length-1;d.some(function(a,d){if(b<a.value)return c=d,!0;f=d;return!1});return{startIndex:f,endIndex:c,weight:(b-d[f].value)/(d[c].value-d[f].value)}}Object.defineProperty(e,"__esModule",{value:!0});var r=[64,64,64],y=[255,255,255];
e.getRampBorderColor=function(b){var f=null;if("simple"===b.type)f=b.symbol;else if("unique-value"===b.type||"class-breaks"===b.type)f=(b=(b=b.classBreakInfos||b.uniqueValueInfos)&&b[0])&&b.symbol;return(b=(b=f&&-1===f.type.indexOf("line-symbol")?d.getStroke(f):null)&&b.color)&&0<b.a&&!(240<=b.r&&240<=b.g&&240<=b.b)?b:null};e.getRampOverlayColor=function(d){var f=new b(y);f.a=1-d;return f};e.getRampStops=function(d,f,e){var c=!1,a=[],h=[];if(f.colors||f.opacityValues)a=l(f.minDataValue,f.maxDataValue);
else if(f.stops){var p=f.stops,a=p.map(function(a){return a.value});(c=p.some(function(a){return!!a.label}))&&(h=p.map(function(a){return a.label}))}var t=a[0],p=a[a.length-1];if(null==t&&null==p)return null;var z=p-t;return a.map(function(n,p){var m;if("opacity"===f.type){m=e;void 0===m&&(m=r);m=new b(m);var w=d.getOpacity(n,{opacityInfo:f});null!=w&&(m.a=w)}else m=d.getColor(n,{colorInfo:f});p=c?h[p]:k.getLabelPrefix(p,a.length-1)+g.format(n);return{value:n,color:m,label:p,offset:z?1-(n-t)/z:1}}).reverse()};
e.getRampStopsForPointCloud=function(b){var d=!1,e=[],c=[],e=b.map(function(a){return a.value});(d=b.some(function(a){return!!a.label}))&&(c=b.map(function(a){return a.label}));var a=e[0],n=e[e.length-1];if(null==a&&null==n)return null;var p=n-a;return e.map(function(f,h){var n=u(f,b);h=d?c[h]:k.getLabelPrefix(h,e.length-1)+g.format(f);return{value:f,color:n,label:h,offset:p?1-(f-a)/p:1}}).reverse()};e.getColorFromPointCloudStops=u})},"esri/widgets/Legend/support/utils":function(){define(["require",
"exports"],function(B,e){Object.defineProperty(e,"__esModule",{value:!0});e.getLabelPrefix=function(b,e){return 0===b?"\x3c ":b===e?"\x3e ":""}})},"esri/widgets/Legend/support/heatmapRampUtils":function(){define(["require","exports","../../../renderers/support/HeatmapColorStop"],function(B,e,b){Object.defineProperty(e,"__esModule",{value:!0});e.getHeatmapRampStops=function(e){e=e.colorStops;var d=e.length-1;if(e&&e[0]){var g=e[d];g&&1!==g.ratio&&(e=e.slice(0),e.push(new b.HeatmapColorStop({ratio:1,
color:g.color})),d++)}return e.map(function(b,e){var g="";0===e?g="low":e===d&&(g="high");return{color:b.color,label:g,ratio:b.ratio,offset:1-b.ratio}}).reverse()}})},"esri/widgets/Legend/support/relationshipRampUtils":function(){define("require exports dojox/gfx dojox/gfx/matrix ../../../symbols ../../../symbols/support/gfxUtils ../../../symbols/support/previewSymbol3D".split(" "),function(B,e,b,g,d,k,l){function q(b){if(b){var c=b.type;return-1<c.indexOf("3d")?l.getSymbolLayerFill(b.symbolLayers.getItemAt(0)):
"simple-line"===c||"simple-marker"===b.type&&(b.style===d.SimpleMarkerSymbol.STYLE_X||b.style===d.SimpleMarkerSymbol.STYLE_CROSS)?(b=k.getStroke(b))&&b.color:k.getFill(b)}}function u(b,c){var a=c.HH.label,d=c.LL.label,f=c.HL.label;c=c.LH.label;switch(b){case "HH":return{top:a,bottom:d,left:f,right:c};case "HL":return{top:f,bottom:c,left:d,right:a};case "LL":return{top:d,bottom:a,left:c,right:f};case "LH":return{top:c,bottom:f,left:a,right:d};default:return{top:a,bottom:d,left:f,right:c}}}function x(b){var c=
v[b];b&&null==c&&(c=v.HH);return c||0}function r(b,c,a,d){var f=d+"_arrowStart";d+="_arrowEnd";c="left"===c;switch(a){case "HL":b.setAttribute(c?"marker-start":"marker-end","url(#"+(c?d:f)+")");break;case "LL":b.setAttribute("marker-start","url(#"+d+")");break;case "LH":b.setAttribute(c?"marker-end":"marker-start","url(#"+(c?f:d)+")");break;default:b.setAttribute("marker-end","url(#"+f+")")}}function y(b,c,a){var d="start"===c;c=d?a+"_arrowStart":a+"_arrowEnd";a=d?"0,0 5,5 0,10":"5,0 0,5 5,10";var f=
d?"5":"0",d=document.createElementNS("http://www.w3.org/2000/svg","marker");d.setAttribute("id",c);d.setAttribute("markerWidth","10");d.setAttribute("markerHeight","10");d.setAttribute("refX",f);d.setAttribute("refY","5");d.setAttribute("markerUnits","strokeWidth");d.setAttribute("orient","auto");c=document.createElementNS("http://www.w3.org/2000/svg","polyline");c.setAttribute("points",a);c.setAttribute("fill","none");c.setAttribute("stroke","#555555");c.setAttribute("stroke-width","1");d.appendChild(c);
b.appendChild(d)}Object.defineProperty(e,"__esModule",{value:!0});var v={HH:315,HL:45,LL:135,LH:225},f={2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]};e.getRelationshipRampElement=function(b){var c=b.focus,a=b.numClasses,d=f[a],e={};b.infos.forEach(function(a){e[a.value]={label:a.label,fill:q(a.symbol)}});b=[];for(var g=0;g<a;g++){for(var h=[],k=0;k<a;k++)h.push(e[d[g][k]].fill);
b.push(h)}d=u(c,e);return{type:"relationship-ramp",numClasses:a,focus:c,colors:b,labels:d,rotation:x(c)}};e.getRotationAngleForFocus=x;e.renderRamp=function(d,c,a){void 0===a&&(a=60);var f=d.focus,e=d.numClasses,h=d.colors,l=d.rotation;d=!!f;var w=Math.sqrt(Math.pow(a,2)+Math.pow(a,2))+(d?0:5),C=document.createElement("div"),m=b.createSurface(C,w,w),v=k.create2DColorRamp({surface:m,colors:h,numClasses:e,size:a}),e=(w-a)/2,w=(w-a)/2;v.applyTransform(g.translate(e,w));var h=a/2,q=a/2;v.applyTransform(g.rotategAt(l,
h,q));var l=m.createGroup(),v={width:1},J=m.defNode;y(J,"start",c);y(J,"end",c);J=l.createLine({x1:-10,y1:a-15,x2:-10,y2:15}).setStroke(v);a=l.createLine({x1:15,y1:a+10,x2:a-15,y2:a+10}).setStroke(v);r(J.rawNode,"left",f,c);r(a.rawNode,"right",f,c);l.applyTransform(g.translate(e,w));d?l.applyTransform(g.rotategAt(-45,h,q)):m.rawNode.style.margin="-15px -15px -18px -15px";return C}})},"esri/widgets/Legend/support/sizeRampUtils":function(){define("require exports ../../../symbols ../../../core/numberUtils ../../../symbols/support/symbolUtils ./utils".split(" "),
function(B,e,b,g,d,k){function l(b,c){var d=null,f=null;if("simple"===b.type)d=b.symbol;else if("unique-value"===b.type||"class-breaks"===b.type)d=(d=(b=b.classBreakInfos||b.uniqueValueInfos)&&b[0])&&d.symbol,f=1<b.length;if(!d||q(d))return null;d=d.clone();if(c||f)-1<d.type.indexOf("3d")?u(d):(c=d,-1!==c.type.indexOf("line")?c.color=a:(c.color=h,"simple-marker"===c.type&&(c.outline={color:a,width:1.5})));return d}function q(a){if(a)return b.isSymbol3D(a)?a.symbolLayers?a.symbolLayers.some(function(a){return a&&
"fill"===a.type}):!1:-1!==a.type.indexOf("fill")}function u(b){d.isVolumetricSymbol(b)||("line-3d"===b.type?b.symbolLayers.forEach(function(b){b.material={color:a}}):b.symbolLayers.forEach(function(b){"icon"!==b.type||b.resource&&b.resource.href?b.material={color:c}:(b.material={color:h},b.outline={color:a,size:1.5})}))}function x(a,b,c,d){var f=a.getSizeRangeAtScale(b,d),e=f&&r(f);if(f||e){for(var h=e.map(function(a){var c=f.minSize,d=f.maxSize,e=b.minDataValue,g=b.maxDataValue;return a<=c?e:a>=
d?g:(a-c)/(d-c)*(g-e)+e}),h=g.round(h),n=1;n<h.length-1;n++){var p=y(a,b,c,h[n],h[n-1],d);p&&(h[n]=p[0],e[n]=p[1])}return h}}function r(a){var b=a.minSize;a=(a.maxSize-b)/4;for(var c=[],d=0;5>d;d++)c.push(b+a*d);return c}function y(a,b,c,d,f,e){var h,n=v(a,b,c,d,e);f=v(a,b,c,f,e);var p=g.numDigits(d),t=p.fractional,k=p.integer,l=p=null;0<d&&1>d&&(p=Math.pow(10,t),d*=p,k=g.numDigits(d).integer);for(t=k-1;0<=t;t--){var w=Math.pow(10,t),k=Math.floor(d/w)*w,w=Math.ceil(d/w)*w;null!=p&&(k/=p,w/=p);h=(k+
w)/2;h=g.round([k,h,w],{indexes:[1]});h=h[1];var q=v(a,b,c,k,e),z=v(a,b,c,w,e),C=v(a,b,c,h,e),y=g.percentChange(n,q,f,null),r=g.percentChange(n,z,f,null),u=g.percentChange(n,C,f,null),x=20>=y.previous,A=20>=r.previous;x&&A&&(y.previous<=r.previous?(x=!0,A=!1):(A=!0,x=!1));x?l=[k,q]:A?l=[w,z]:20>=u.previous&&(l=[h,C]);if(l)break}return l}function v(a,b,c,d,f){return a.getSize(d,{sizeInfo:b,scale:f,shape:-1!==c.type.indexOf("marker-symbol")?c.style:null})}function f(a,c){a=a.clone();if(b.isSymbol3D(a))d.isVolumetricSymbol(a)||
a.symbolLayers.forEach(function(a){"fill"!==a.type&&(a.size=c)});else if("esri.symbols.SimpleMarkerSymbol"===a.declaredClass)a.size=c;else if("esri.symbols.PictureMarkerSymbol"===a.declaredClass){var f=a.width,e=a.height;a.height=c;a.width=f/e*c}else"esri.symbols.SimpleLineSymbol"===a.declaredClass?a.width=c:"esri.symbols.TextSymbol"===a.declaredClass&&a.font&&(a.font.size=c);return a}Object.defineProperty(e,"__esModule",{value:!0});e.REAL_WORLD_MAX_SIZE=30;e.REAL_WORLD_MIN_SIZE=12;var h=[255,255,
255],c=[200,200,200],a=[128,128,128];e.getRampStops=function(a,b,c,h){var n=b.legendOptions,n=n&&n.customValues,p=l(a,c);c=null!=b.minSize&&null!=b.maxSize;var m=b.stops&&1<b.stops.length,t=!!b.target;if(p&&(n||c||m&&!t)){var q=d.isVolumetricSymbol(p),y=null,z=null,r=null,z=q&&!m?[b.minDataValue,b.maxDataValue]:n||x(a,b,p,h);!z&&m&&(z=b.stops.map(function(a){return a.value}),(y=b.stops.some(function(a){return!!a.label}))&&(r=b.stops.map(function(a){return a.label})));n=!q||z&&2===z.length;if(!z||
!n)return null;var u=[e.REAL_WORLD_MIN_SIZE,e.REAL_WORLD_MAX_SIZE];return z.map(function(c,d){var e=q?u[d]:v(a,b,p,c,h),n=f(p,e);d=y?r[d]:k.getLabelPrefix(d,z.length-1)+g.format(c);return{value:c,symbol:n,label:d,size:e}}).reverse()}}})},"esri/widgets/Legend/styles/Card":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/i18n!../../../nls/common dojo/i18n!../../Legend/nls/Legend dojox/gfx ../../../core/lang ../../../core/accessorSupport/decorators ../../Widget ./common ../../Legend/support/styleUtils ../../support/colorUtils ../../support/widget".split(" "),
function(B,e,b,g,d,k,l,q,u,x,r,y,v,f){return function(e){function c(a){a=e.call(this)||this;a._hasIndicators=!1;a._selectedSectionName=null;a._sectionNames=[];a._sectionMap=new Map;a.activeLayerInfos=null;a.view=null;return a}b(c,e);c.prototype.render=function(){var a=this;this._sectionNames.length=0;this._hasIndicators=768>=this.view.container.clientWidth;var b=this.activeLayerInfos,b=b&&b.toArray().map(function(b){return a._renderLegendForLayer(b)}).filter(function(a){return!!a});this._hasIndicators?
this._selectedSectionName&&-1!==this._sectionNames.indexOf(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;var c=this._sectionNames.length,e=this._sectionNames.map(function(b,e){var g;e=q.substitute({index:e+1,total:c},d.pagination.pageText);return f.tsx("div",{key:b,"aria-label":e,title:e,tabIndex:0,onclick:a._selectSection,onkeydown:a._selectSection,bind:a,class:a.classes("esri-legend--card__carousel-indicator",(g=
{},g["esri-legend--card__carousel-indicator--activated"]=a._selectedSectionName===b,g)),"data-section-name":b})}),e=this._hasIndicators?f.tsx("div",{class:"esri-legend--card__carousel-indicator-container",key:"carousel-navigation"},e):null,b=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):b&&b.length?b:null;return f.tsx("div",{class:"esri-legend--card esri-widget"},e,b?b:f.tsx("div",{class:"esri-legend--card__message"},k.noLegend))};c.prototype._selectSection=function(a){if(a=
a.target.getAttribute("data-section-name"))this._selectedSectionName=a};c.prototype._renderLegendForLayer=function(a){var b=this,c;if(!a.ready)return null;var d="esri-legend--card__"+a.layer.uid+"-version-"+a.version;if(a.children.length)return c=a.children.map(function(a){return b._renderLegendForLayer(a)}).toArray(),this._sectionNames.push(d),f.tsx("div",{key:a.layer.uid,class:this.classes("esri-legend--card__service","esri-legend--card__group-layer")},f.tsx("div",{class:"esri-legend--card__service-caption-container"},
a.title),c);if((d=a.legendElements)&&!d.length)return null;var e=d.some(function(a){return"relationship-ramp"===a.type}),d=d.map(function(c){return b._renderLegendForElement(c,a.layer,e)}).filter(function(a){return!!a});if(!d.length)return null;var g=(c={},c["esri-legend--card__group-layer-child"]=!!a.parent,c);return f.tsx("div",{key:a.layer.uid,class:this.classes("esri-legend--card__service",g)},f.tsx("div",{class:"esri-legend--card__service-caption-container"},f.tsx("div",{class:"esri-legend--card__service-caption-text"},
a.title)),f.tsx("div",{class:"esri-legend--card__service-content"},d))};c.prototype._renderLegendForElement=function(a,b,c){var d=this;void 0===c&&(c=!1);var e,g="color-ramp"===a.type,h="opacity-ramp"===a.type,n="size-ramp"===a.type,k=a.title,p=null;"string"===typeof k?p=k:k&&(p=y.getTitle(k,g||h),p=k.title?k.title+" ("+p+")":p);k="esri-legend--card__"+b.uid+"-type-"+a.type;p=this._hasIndicators?f.tsx("div",null,f.tsx("h3",{class:this.classes("esri-widget__header","esri-legend--card__carousel-title")},
b.title),f.tsx("h4",{class:this.classes("esri-widget__header","esri-legend--card__layer-caption")},p)):p?f.tsx("h4",{class:this.classes("esri-widget__header","esri-legend--card__layer-caption")},p):null;g=null;"symbol-table"===a.type?(n=a.infos.map(function(c){return d._renderLegendForElementInfo(c,b,a.legendType)}).filter(function(a){return!!a}),n.length&&(g=n[0].properties.classes&&n[0].properties.classes["esri-legend--card__symbol-row"],c=(e={},e["esri-legend--card__label-container"]=!g&&!c,e["esri-legend--card__relationship-label-container"]=
c,e),g=f.tsx("div",{key:k,class:"esri-legend--card__section"},p,f.tsx("div",{class:this.classes(c)},n)))):"color-ramp"===a.type||"opacity-ramp"===a.type||"heatmap-ramp"===a.type?g=f.tsx("div",{key:k,class:"esri-legend--card__section"},p,this._renderLegendForRamp(a)):n?g=f.tsx("div",{key:k,class:"esri-legend--card__section"},p,this._renderSizeRamps(a.infos)):"relationship-ramp"===a.type&&(g=f.tsx("div",{key:k,class:this.classes("esri-legend--card__section","esri-legend--card__relationship-section")},
p,r.renderRelationshipRamp(a,this.id)));if(!g)return null;this._sectionNames.push(k);this._sectionMap.set(k,g);return g};c.prototype._renderLegendForElementInfo=function(a,b,c){var d,e,g;if(a.type)return this._renderLegendForElement(a,b);c=y.isImageryStretchedLegend(b,c);if(a.symbol&&a.preview){if(-1===a.symbol.type.indexOf("simple-fill")){if(!a.label)return f.tsx("div",{bind:a.preview,afterCreate:y.attachToNode});b=(d={},d["esri-legend--card__symbol-cell"]=this._hasIndicators,d);return f.tsx("div",
{class:this.classes("esri-legend--card__layer-row",(e={},e["esri-legend--card__symbol-row"]=this._hasIndicators,e))},f.tsx("div",{class:this.classes(b),bind:a.preview,afterCreate:y.attachToNode}),f.tsx("div",{class:this.classes("esri-legend--card__image-label",(g={},g["esri-legend--card__label-cell"]=this._hasIndicators,g))},y.getTitle(a.label,!1)||""))}g=e=d=255;b=0;var h=c=255,k=255,n=0,p=a.symbol.color&&a.symbol.color.a,l=a.symbol.outline&&a.symbol.outline.color.a;p&&(d=a.symbol.color.r,e=a.symbol.color.g,
g=a.symbol.color.b,b=a.symbol.color.a);l&&(c=a.symbol.outline.color.r,h=a.symbol.outline.color.g,k=a.symbol.outline.color.b,n=a.symbol.outline.color.a);var q=v.isBright(a.symbol.color),r=q?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)";return f.tsx("div",{class:"esri-legend--card__layer-row"},f.tsx("div",{key:a.label,class:"esri-legend--card__label-element",styles:{background:p?"rgba("+d+", "+e+", "+g+", "+b+")":"none",color:q?"black":"white",textShadow:"-1px -1px 0 "+r+",\n                                              1px -1px 0 "+
r+",\n                                              -1px 1px 0 "+r+",\n                                              1px 1px 0 "+r,border:l?"1px solid rgba("+c+", "+h+", "+k+", "+n+")":"none"}}," ",a.label," "))}if(a.src)return d=this._renderImage(a,b,c),f.tsx("div",{class:"esri-legend--card__layer-row"},d,f.tsx("div",{class:"esri-legend--card__image-label"},a.label||""))};c.prototype._renderImage=function(a,b,c){var d,e=a.label,g=a.src,h=a.opacity;c=(d={},d["esri-legend--card__imagery-layer-image--stretched"]=
c,d["esri-legend--card__symbol"]=!c,d);b={opacity:""+(null!=h?h:b.opacity)};return f.tsx("img",{alt:e,src:g,border:0,width:a.width,height:a.height,class:this.classes(c),styles:b})};c.prototype._renderSizeRamps=function(a){var b,c=document.createElement("div"),d,e=a[a.length-1].symbol.color,g,h,k=a[0].label,q=a[a.length-1].label,v=a[0].symbol.style&&"circle"===a[0].symbol.style;try{if(this._hasIndicators)if(h=100,v){var r=a[0].symbol.size/2,u=a[a.length-1].symbol.size/2;g=2*r;var x=h-r-u,B=Math.sqrt(Math.pow(x,
2)-Math.pow(r-u,2)),G=r*B/x,L=r+G,M=r+Math.sqrt(Math.pow(r,2)-Math.pow(G,2)),F=u*G/r,N=r+F,K=h-(u-Math.sqrt(Math.pow(u,2)-Math.pow(F,2))),G=r-G,F=r-F;d=l.createSurface(c,g,h);d.createCircle({cx:r,cy:r,r:r}).setFill(e).setStroke({color:"#ddd",width:1});d.createCircle({cx:r,cy:h-u,r:u}).setFill(e).setStroke({color:"#ddd",width:1});d.createLine({x1:L,y1:M,x2:N,y2:K}).setStroke({color:"#ddd",width:1});d.createLine({x1:G,y1:M,x2:F,y2:K}).setStroke({color:"#ddd",width:1})}else{var D=Math.max(a[0].symbol.height,
a[0].symbol.width),A=Math.max(a[a.length-1].symbol.height,a[a.length-1].symbol.width);g=D;d=l.createSurface(c,g,h);d.createRect({x:0,y:0,height:D,width:D}).setStroke({color:"#ddd",width:1});d.createRect({x:D/2-A/2,y:h-A,height:A,width:A}).setStroke({color:"#ddd",width:1});d.createImage({src:a[0].symbol.url,height:D,width:D});d.createImage({src:a[a.length-1].symbol.url,height:A,width:A,y:h-A,x:D/2-A/2});d.createLine({x1:0,y1:D,x2:D/2-A/2,y2:h-A}).setStroke({color:"#ddd",width:1});d.createLine({x1:g,
y1:D,x2:D/2+A/2,y2:h-A}).setStroke({color:"#ddd",width:1})}else g=180,v?(r=a[0].symbol.size/2,u=a[a.length-1].symbol.size/2,h=2*r,x=g-r-u,B=Math.sqrt(Math.pow(x,2)-Math.pow(r-u,2)),G=r*B/x,M=r-G,L=g-(r+Math.sqrt(Math.pow(r,2)-Math.pow(G,2))),F=u*G/r,K=r-F,N=u-Math.sqrt(Math.pow(u,2)-Math.pow(F,2)),G=r+G,F=r+F,d=l.createSurface(c,g,h),d.createCircle({cx:g-r,cy:r,r:r}).setFill(e).setStroke({color:"#ddd",width:1}),d.createCircle({cx:u,cy:r,r:u}).setFill(e).setStroke({color:"#ddd",width:1}),d.createLine({x1:L,
y1:M,x2:N,y2:K}).setStroke({color:"#ddd",width:1}),d.createLine({x1:L,y1:G,x2:N,y2:F}).setStroke({color:"#ddd",width:1})):(D=Math.max(a[0].symbol.height,a[0].symbol.width),A=Math.max(a[a.length-1].symbol.height,a[a.length-1].symbol.width),d=l.createSurface(c,g,D),d.createRect({x:0,y:D/2-A/2,height:A,width:A}).setStroke({color:"#ddd",width:1}),d.createRect({x:g-D,y:0,height:D,width:D}).setStroke({color:"#ddd",width:1}),d.createImage({src:a[a.length-1].symbol.url,height:A,width:A,y:D/2-A/2}),d.createImage({src:a[0].symbol.url,
height:D,width:D,x:g-D}),d.createLine({x1:A,y1:D/2-A/2,x2:g-D,y2:0}).setStroke({color:"#ddd",width:1}),d.createLine({x1:A,y1:D/2+A/2,x2:g-D,y2:D}).setStroke({color:"#ddd",width:1})),e=k,k=q,q=e}catch(R){d.clear(),d.destroy()}return d?f.tsx("div",{class:this.classes("esri-legend--card__layer-row",(b={},b["esri-legend--card__size-ramp-row"]=this._hasIndicators,b))},f.tsx("div",{class:"esri-legend--card__ramp-label"},k),f.tsx("div",{class:"esri-legend--card__size-ramp-container"},f.tsx("div",{bind:c,
afterCreate:y.attachToNode})),f.tsx("div",{class:"esri-legend--card__ramp-label"},q)):null};c.prototype._renderLegendForRamp=function(a){var b=a.infos,c="heatmap-ramp"===a.type,d=b.length-1,e=2<d&&!c?25*d:100,g=e+20;a=document.createElement("div");a.style.width=g+"px";var h=l.createSurface(a,g,25),m=b.slice(0).reverse();try{m.forEach(function(a,b){a.offset=c?a.ratio:b/d}),c||h.createPath("M0 12.5 L10 0 L10 25 Z").setFill(m[0].color).setStroke(null),h.createRect({x:10,y:0,width:e,height:25}).setFill({type:"linear",
x1:10,y1:0,x2:e+10,y2:0,colors:m}).setStroke(null),c||h.createPath("M"+(e+10)+" 0 L"+g+" 12.5 L"+(e+10)+" 25 Z").setFill(m[m.length-1].color).setStroke(null)}catch(E){h.clear(),h.destroy()}if(!h)return null;e=m.filter(function(a,b){return!!a.label&&0!==b&&b!==m.length-1}).map(function(a){return f.tsx("div",{class:"esri-legend--card__interval-separators-container"},f.tsx("div",{class:"esri-legend--card__interval-separator"},"|"),f.tsx("div",{class:"esri-legend--card__ramp-label"},a.label))});g=b[b.length-
1].label;b=b[0].label;return f.tsx("div",{class:"esri-legend--card__layer-row"},f.tsx("div",{class:"esri-legend--card__ramp-label"},c?k[g]:g),f.tsx("div",{class:"esri-legend--card__symbol-container"},f.tsx("div",{bind:a,afterCreate:y.attachToNode}),e),f.tsx("div",{class:"esri-legend--card__ramp-label"},c?k[b]:b))};g([f.renderable(),u.property()],c.prototype,"activeLayerInfos",void 0);g([u.property()],c.prototype,"view",void 0);g([f.accessibleHandler()],c.prototype,"_selectSection",null);return c=
g([u.subclass("esri.widgets.Legend.styles.Card")],c)}(u.declared(x))})},"esri/widgets/Legend/styles/common":function(){define(["require","exports","../support/relationshipRampUtils","../support/styleUtils","../../support/widget"],function(B,e,b,g,d){Object.defineProperty(e,"__esModule",{value:!0});e.renderRelationshipRamp=function(e,l){var k=e.labels,u=!!e.focus;e=b.renderRamp(e,l);return u?d.tsx("div",{class:"esri-relationship-ramp--diamond__container"},d.tsx("div",{class:"esri-relationship-ramp--diamond__left-column"},
k.left),d.tsx("div",{class:"esri-relationship-ramp--diamond__middle-column"},d.tsx("div",{class:"esri-relationship-ramp--diamond__middle-column--label"},k.top),d.tsx("div",{class:"esri-relationship-ramp--diamond__middle-column--ramp",bind:e,afterCreate:g.attachToNode}),d.tsx("div",{class:"esri-relationship-ramp--diamond__middle-column--label"},k.bottom)),d.tsx("div",{class:"esri-relationship-ramp--diamond__right-column"},k.right)):d.tsx("div",{class:"esri-relationship-ramp--square__table"},d.tsx("div",
{class:"esri-relationship-ramp--square__table-row"},d.tsx("div",{class:d.classes("esri-relationship-ramp--square__table-cell","esri-relationship-ramp--square__table-label","esri-relationship-ramp--square__table-label--right-bottom")},k.left),d.tsx("div",{class:"esri-relationship-ramp--square__table-cell"}),d.tsx("div",{class:d.classes("esri-relationship-ramp--square__table-cell","esri-relationship-ramp--square__table-label","esri-relationship-ramp--square__table-label--left-bottom")},k.top)),d.tsx("div",
{class:"esri-relationship-ramp--square__table-row"},d.tsx("div",{class:"esri-relationship-ramp--square__table-cell"}),d.tsx("div",{class:"esri-relationship-ramp--square__table-cell",bind:e,afterCreate:g.attachToNode}),d.tsx("div",{class:"esri-relationship-ramp--square__table-cell"})),d.tsx("div",{class:"esri-relationship-ramp--square__table-row"},d.tsx("div",{class:d.classes("esri-relationship-ramp--square__table-cell","esri-relationship-ramp--square__table-label","esri-relationship-ramp--square__table-label--right-top")},
k.bottom),d.tsx("div",{class:"esri-relationship-ramp--square__table-cell"}),d.tsx("div",{class:d.classes("esri-relationship-ramp--square__table-cell","esri-relationship-ramp--square__table-label","esri-relationship-ramp--square__table-label--left-top")},k.right)))}})},"esri/widgets/Legend/support/styleUtils":function(){define(["require","exports","dojo/i18n!../../Legend/nls/Legend","../../../core/lang"],function(B,e,b,g){Object.defineProperty(e,"__esModule",{value:!0});e.attachToNode=function(b){b.appendChild(this)};
e.getTitle=function(d,e){if(d){if("string"===typeof d)return d;var k=null;e?k=d.ratioPercentTotal?"showRatioPercentTotal":d.ratioPercent?"showRatioPercent":d.ratio?"showRatio":d.normField?"showNormField":d.field?"showField":null:e||(k=d.normField?"showNormField":d.normByPct?"showNormPct":d.field?"showField":null);return k?g.substitute({field:d.field,normField:d.normField},b[k]):null}};e.isRendererTitle=function(b,e){return!e};e.isImageryStretchedLegend=function(b,e){return!!(e&&"Stretched"===e&&10.3<=
b.version&&"esri.layers.ImageryLayer"===b.declaredClass)}})},"esri/widgets/support/colorUtils":function(){define(["require","exports","../../Color"],function(B,e,b){function g(d){return new b(d)}function d(b){return!!b&&4===b.length&&x.test(b)}function k(b){return!!b&&7===b.length&&r.test(b)}function l(b){return 127<=.299*b.r+.587*b.g+.114*b.b}function q(d,e){void 0===e&&(e=1);e=Math.pow(.7,e);return new b([Math.round(d.r*e),Math.round(d.g*e),Math.round(d.b*e),d.a])}function u(d,e){void 0===e&&(e=
1);e=Math.pow(.7,e);var f=d.r,g=d.g,c=d.b;30>f&&(f=30);30>g&&(g=30);30>c&&(c=30);return new b([Math.min(255,Math.round(f/e)),Math.min(255,Math.round(g/e)),Math.min(255,Math.round(c/e)),d.a])}Object.defineProperty(e,"__esModule",{value:!0});var x=/^#[0-9A-F]{3}$/i,r=/^#[0-9A-F]{6}$/i;e.equal=function(b,d){return b&&d&&b.r===d.r&&b.g===d.g&&b.b===d.b&&b.a===d.a};e.normalizeHex=function(b){return b?"#"+b.trim().replace(/#/g,"").substr(0,6):""};e.normalizeColor=g;e.isValidHex=function(b){return d(b)||
k(b)};e.isShorthandHex=d;e.isLonghandHex=k;e.toHex=function(b){return g(b).toHex()};e.getContrastingColor=function(b){return l(b)?q(b):u(b,3)};e.isBright=l;e.darker=q;e.brighter=u})},"esri/widgets/Legend/styles/Classic":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/i18n!../../Legend/nls/Legend dojox/gfx ../../../core/accessorSupport/decorators ../../Widget ./common ../../Legend/support/styleUtils ../../support/widget".split(" "),
function(B,e,b,g,d,k,l,q,u,x,r){return function(e){function q(b){b=e.call(this)||this;b.activeLayerInfos=null;return b}b(q,e);q.prototype.render=function(){var b=this,e=this.activeLayerInfos,c=this.classes("esri-legend esri-widget--panel","esri-widget"),e=e&&e.toArray().map(function(a){return b._renderLegendForLayer(a)}).filter(function(a){return!!a});return r.tsx("div",{class:c},e&&e.length?e:r.tsx("div",{class:"esri-legend__message"},d.noLegend))};q.prototype._renderLegendForLayer=function(b){var d=
this,c;if(!b.ready)return null;var a=!!b.children.length,e="esri-legend__"+b.layer.uid+"-version-"+b.version,f=b.title?r.tsx("h3",{class:this.classes("esri-widget__header","esri-legend__service-label")},b.title):null;if(a)return c=b.children.map(function(a){return d._renderLegendForLayer(a)}).toArray(),r.tsx("div",{key:e,class:this.classes("esri-legend__service","esri-legend__group-layer")},f,c);if((a=b.legendElements)&&!a.length)return null;a=a.map(function(a){return d._renderLegendForElement(a,
b.layer)}).filter(function(a){return!!a});if(!a.length)return null;var g=(c={},c["esri-legend__group-layer-child"]=!!b.parent,c);return r.tsx("div",{key:e,class:this.classes("esri-legend__service",g)},f,r.tsx("div",{class:"esri-legend__layer"},a))};q.prototype._renderLegendForElement=function(b,d,c){var a=this,e,f="color-ramp"===b.type,g="opacity-ramp"===b.type,h="size-ramp"===b.type,k=null;if("symbol-table"===b.type||h){var l=b.infos.map(function(c){return a._renderLegendForElementInfo(c,d,h,b.legendType)}).filter(function(a){return!!a});
l.length&&(k=r.tsx("div",{class:"esri-legend__layer-body"},l))}else"color-ramp"===b.type||"opacity-ramp"===b.type||"heatmap-ramp"===b.type?k=this._renderLegendForRamp(b):"relationship-ramp"===b.type&&(k=u.renderRelationshipRamp(b,this.id));if(!k)return null;var l=b.title,m=null;"string"===typeof l?m=l:l&&(m=x.getTitle(l,f||g),m=x.isRendererTitle(l,f||g)&&l.title?l.title+" ("+m+")":m);f=c?"esri-legend__layer-child-table":"esri-legend__layer-table";g=m?r.tsx("div",{class:"esri-legend__layer-caption"},
m):null;c=(e={},e["esri-legend__layer-table--size-ramp"]=h||!c,e);return r.tsx("div",{class:this.classes(f,c)},g,k)};q.prototype._renderLegendForRamp=function(b){var e=b.infos,c="opacity-ramp"===b.type,a="heatmap-ramp"===b.type,f=e.length-1,g=null;2<f&&!a?g=25*f:g=a?75:50;var l=document.createElement("div");l.className="esri-legend__color-ramp "+(c?"esri-legend__opacity-ramp":"");l.style.height=g+"px";c=k.createSurface(l,"100%",g);try{if(a||e.forEach(function(a,b){a.offset=b/f}),c.createRect({x:0,
y:0,width:"100%",height:g}).setFill({type:"linear",x1:0,y1:0,x2:0,y2:g,colors:e}).setStroke(null),"color-ramp"===b.type||"opacity-ramp"===b.type){var q=b.overlayColor;q&&0<q.a&&c.createRect({x:0,y:0,width:"100%",height:g}).setFill(q).setStroke(null)}}catch(w){c.clear(),c.destroy()}if(!c)return null;b=e.filter(function(a){return!!a.label}).map(function(b){return r.tsx("div",{class:"esri-legend__ramp-label"},a?d[b.label]:b.label)});g={height:g+"px"};return r.tsx("div",{class:"esri-legend__layer-row"},
r.tsx("div",{class:"esri-legend__layer-cell esri-legend__layer-cell--symbols",styles:{width:"24px"}},r.tsx("div",{class:"esri-legend__ramps",bind:l,afterCreate:x.attachToNode})),r.tsx("div",{class:"esri-legend__layer-cell esri-legend__layer-cell--info"},r.tsx("div",{class:"esri-legend__ramp-labels",styles:g},b)))};q.prototype._renderLegendForElementInfo=function(b,d,c,a){var e,f;if(b.type)return this._renderLegendForElement(b,d,!0);var g=null;a=x.isImageryStretchedLegend(d,a);b.symbol&&b.preview?
g=r.tsx("div",{class:"esri-legend__symbol",bind:b.preview,afterCreate:x.attachToNode}):b.src&&(g=this._renderImage(b,d,a));if(!g)return null;d=(e={},e["esri-legend__imagery-layer-info--stretched"]=a,e);c=(f={},f["esri-legend__imagery-layer-info--stretched"]=a,f["esri-legend__size-ramp"]=!a&&c,f);return r.tsx("div",{class:"esri-legend__layer-row"},r.tsx("div",{class:this.classes("esri-legend__layer-cell esri-legend__layer-cell--symbols",c)},g),r.tsx("div",{class:this.classes("esri-legend__layer-cell esri-legend__layer-cell--info",
d)},x.getTitle(b.label,!1)||""))};q.prototype._renderImage=function(b,d,c){var a,e=b.label,f=b.src,g=b.opacity;c=(a={},a["esri-legend__imagery-layer-image--stretched"]=c,a["esri-legend__symbol"]=!c,a);d={opacity:""+(null!=g?g:d.opacity)};return r.tsx("img",{alt:e,src:f,border:0,width:b.width,height:b.height,class:this.classes(c),styles:d})};g([r.renderable(),l.property()],q.prototype,"activeLayerInfos",void 0);return q=g([l.subclass("esri.widgets.Legend.styles.Classic")],q)}(l.declared(q))})},"*now":function(B){B(['dojo/i18n!*preload*esri/widgets/nls/Legend*["ar","ca","cs","da","de","el","en-gb","en-us","es-es","fi-fi","fr-fr","he-il","hu","it-it","ja-jp","ko-kr","nl-nl","nb","pl","pt-br","pt-pt","ru","sk","sl","sv","th","tr","zh-tw","zh-cn","ROOT"]'])},
"*noref":1}});
define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Legend/nls/Legend ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./Legend/LegendViewModel ./Legend/styles/Card ./Legend/styles/Classic ./support/widget".split(" "),function(B,e,b,g,d,k,l,q,u,x,r,y,v){return function(e){function f(b){b=e.call(this)||this;b._handles=new k;b._styleRenderer=null;b.activeLayerInfos=null;b.basemapLegendVisible=!1;b.groundLegendVisible=!1;
b.iconClass="esri-icon-layer-list";b.label=d.widgetLabel;b.layerInfos=null;b.view=null;b.viewModel=new x;return b}b(f,e);f.prototype.postInitialize=function(){var b=this;this._updateStyleRenderer(this.style);this.own(l.on(this,"activeLayerInfos","change",function(){return b._refreshActiveLayerInfos(b.activeLayerInfos)}))};f.prototype.destroy=function(){this._handles.destroy();this._handles=null};Object.defineProperty(f.prototype,"style",{get:function(){return this._get("style")},set:function(b){this._updateStyleRenderer(b);
this._set("style",b)},enumerable:!0,configurable:!0});f.prototype.render=function(){return this._styleRenderer.render()};f.prototype._updateStyleRenderer=function(b){this._styleRenderer&&this._styleRenderer.destroy();this._styleRenderer="card"===b?new r({activeLayerInfos:this.activeLayerInfos,view:this.view}):new y({activeLayerInfos:this.activeLayerInfos})};f.prototype._refreshActiveLayerInfos=function(b){var a=this;this._handles.removeAll();b.forEach(function(b){return a._renderOnActiveLayerInfoChange(b)});
this.scheduleRender()};f.prototype._renderOnActiveLayerInfoChange=function(b){var a=this,c=l.init(b,"version",function(){return a.scheduleRender()});this._handles.add(c,"version_"+b.layer.uid);b.children.forEach(function(b){return a._renderOnActiveLayerInfoChange(b)})};g([q.aliasOf("viewModel.activeLayerInfos"),v.renderable()],f.prototype,"activeLayerInfos",void 0);g([q.aliasOf("viewModel.basemapLegendVisible"),v.renderable()],f.prototype,"basemapLegendVisible",void 0);g([q.aliasOf("viewModel.groundLegendVisible"),
v.renderable()],f.prototype,"groundLegendVisible",void 0);g([q.property()],f.prototype,"iconClass",void 0);g([q.property()],f.prototype,"label",void 0);g([q.aliasOf("viewModel.layerInfos"),v.renderable()],f.prototype,"layerInfos",void 0);g([q.property({value:"classic",dependsOn:["activeLayerInfos"]}),v.renderable()],f.prototype,"style",null);g([q.aliasOf("viewModel.view"),v.renderable()],f.prototype,"view",void 0);g([q.property(),v.renderable(["view.size"])],f.prototype,"viewModel",void 0);return f=
g([q.subclass("esri.widgets.Legend")],f)}(q.declared(u))});