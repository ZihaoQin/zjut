// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define(["require","exports","../../lib/glMatrix","./primitiveIntersectionUtils","../../support/mathUtils"],function(H,e,a,k,u){function v(b,c,d,f,g){void 0===g&&(g=!1);var h=p;k.createRay(c,d,h,g);return k.intersectSphere(b,h,f)?a.vec3d.dist2(b.center,h.origin)<b.radius*b.radius&&(c=x(b,h.origin),h=-q(h.origin,f,l)-c,0<h)?(c=y,a.mat4d.identity(c),a.mat4d.rotate(c,-h,l),a.vec3d.subtract(f,b.center),a.mat4d.multiplyVec3(c,f,f),a.vec3d.add(f,b.center),!1):!0:(w(b,h,f),!1)}function x(b,c){var d=l;a.vec3d.subtract(c,
b.center,d);c=Math.abs(a.vec3d.length(d)-b.radius);return Math.acos(b.radius/(c+b.radius))}function r(b,a,d,f){var c=p;k.createRay(a,d,c,!0);return k.intersectSphere(b,c,f)}function q(b,c,d){a.vec3d.cross(b,c,d);b=a.vec3d.dot(b,c)/(a.vec3d.length(b)*a.vec3d.length(c));return-u.acos(b)}function z(b,c,d,f){var g=y;a.mat4d.identity(g);a.mat4d.rotate(g,f,d);a.vec3d.subtract(b.eye,c);a.mat4d.multiplyVec3(g,b.eye,b.eye);a.vec3d.add(b.eye,c);a.vec3d.subtract(b.center,c);a.mat4d.multiplyVec3(g,b.center,b.center);
a.vec3d.add(b.center,c);a.mat4d.multiplyVec3(g,b.up,b.up);b.markViewDirty()}function w(b,c,d){var f=l,g=A,h=F;a.vec3d.subtract(c.origin,b.center,g);a.vec3d.cross(g,c.direction,f);a.vec3d.cross(f,g,d);a.vec3d.scale(d,1/a.vec3d.length(d)*b.radius);b=-u.asin(b.radius/a.vec3d.length(c.origin));a.mat4d.identity(h);a.mat4d.rotate(h,b,f);a.mat4d.multiplyVec3(h,d)}function B(b,c){a.vec3d.set3(0,0,0,c);for(var d=0;d<b.length;d++)a.vec3d.add(c,b[d]);a.vec3d.scale(c,1/b.length)}Object.defineProperty(e,"__esModule",
{value:!0});e.Earth={center:a.vec3d.create(),radius:6378137};e.normalizeCoordinate=function(b,a,d){d[0]=a[0]/b.fullWidth;d[1]=a[1]/b.fullHeight;return d};e.sphereOrSilhouettePointFromScreenPoint=v;e.computeHorizonSphereCapAngle=x;e.intersectSphereFromScreenPoint=r;e.rotationAndAxisFromPoints=q;e.rotationFromPointsAroundAxis=function(b,c,d){var f=l,g=A,h=G;a.vec3d.set(b,g);a.vec3d.set(c,h);b=a.vec3d.dot(g,d);c=a.vec3d.dot(h,d);a.vec3d.scale(d,b,f);a.vec3d.subtract(g,f);a.vec3d.normalize(g);a.vec3d.scale(d,
c,f);a.vec3d.subtract(h,f);a.vec3d.normalize(h);b=a.vec3d.dot(g,h);a.vec3d.cross(d,g,f);d=a.vec3d.dot(h,f);return Math.atan2(d,b)};e.setPlane=function(b,c,d){a.vec3d.set(c,d.normal);d.d=-a.vec3d.dot(c,b)};e.setPlaneD=function(b,c){c.d=-a.vec3d.dot(c.normal,b)};e.normalizeRotationDelta=function(b){for(;b>Math.PI;)b-=2*Math.PI;for(;b<-Math.PI;)b+=2*Math.PI;return b};e.applyRotation=z;e.closestPointOnSphereSilhouette=w;e.intersectPlaneFromScreenPoint=function(b,a,d,f){var c=p;k.createRay(a,d,c);return k.intersectPlane(b,
c,f)};e.applyZoomToPoint=function(b,c,d,f){var g=m;d=1-d;a.vec3d.subtract(c,b.eye,g);var h=a.vec3d.length(g),e=h*(1-d);0<=d&&e<f&&(e=f,d=-(e-h)/h);1E-6>Math.abs(h-e)||(a.vec3d.scale(g,d),a.vec3d.add(b.eye,g),a.vec3d.lerp(b.center,c,d))};e.applyZoomOnSphere=function(b,c,d){a.vec2d.set2(c.padding[3]+c.width/2,c.padding[2]+c.height/2,C);r(b,c,C,c.center);a.vec3d.subtract(c.center,c.eye,m);b=a.vec3d.length(m);1E-6>Math.abs(b-b*d)||(a.vec3d.scale(m,d),a.vec3d.subtract(c.center,m,c.eye),c.markViewDirty())};
var C=a.vec2d.create();e.navPointToScreenPoint=function(b,c,d){a.vec2d.set2(c.x,b.fullHeight-c.y,d)};e.centroidOnSphere=function(b,c,d){B(c,d);a.vec3d.normalize(d);a.vec3d.scale(d,b)};e.centroid=B;var n;(function(a){a[a.Vertical=0]="Vertical";a[a.Horizontal=1]="Horizontal"})(n=e.PanMode||(e.PanMode={}));e.VerticalPanTresholds={Elevation:3E4,Angle:8/180*Math.PI};e.pickPointAndInitSphere=function(b,c,d,f){var g=a.vec3d.create(),h={center:a.vec3d.create(),radius:0},k=!0;b.pickPointInScreen(d,g)?h.radius=
a.vec3d.length(g):(h.radius=c.aboveGround?Math.max(a.vec3d.length(c.center),.9*e.Earth.radius):a.vec3d.length(c.eye)-c.relativeElevation,f?v(h,c,d,g):k=r(h,c,d,g));return{sphere:h,scenePickPoint:k?g:null}};e.decidePanMode=function(b,c,d){var f=a.vec3d.length(b.eye);if(Math.abs(f-e.Earth.radius)>e.VerticalPanTresholds.Elevation)return n.Horizontal;if(b.aboveGround===c.radius>f)return n.Vertical;a.vec3d.normalize(a.vec3d.subtract(b.eye,d,D));return Math.abs(.5*Math.PI-Math.acos(a.vec3d.dot(d,D)/a.vec3d.length(d)))<
e.VerticalPanTresholds.Angle?n.Vertical:n.Horizontal};var D=a.vec3d.create();e.applyPanPlanar=function(b,c,d){a.vec3d.subtract(d,c,t);a.vec3d.subtract(b.eye,t);a.vec3d.subtract(b.center,t);b.markViewDirty()};var t=a.vec3d.create();e.applyPanSpherical=function(a,c,d,e){d=q(d,e,E);z(c,a.center,E,d)};var E=a.vec3d.create(),F=a.mat4d.create(),y=a.mat4d.create(),m=a.vec3d.create(),l=a.vec3d.create(),A=a.vec3d.create(),G=a.vec3d.create(),p={origin:a.vec3d.create(),direction:a.vec3d.create()}});