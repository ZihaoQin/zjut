// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../lib/glMatrix ./earthUtils ./geometryUtils ./intersectionUtils ./mathUtils ./projectionUtils".split(" "),function(p,l,r,x,c,m,g,y,t,u){Object.defineProperty(l,"__esModule",{value:!0});p=.5*Math.PI;var z=p/Math.PI*180,A=p*m.earthRadius,B=.9*m.earthRadius;m=function(){function h(a){this.renderCoordsHelper=a.renderCoordsHelper;this.extent=Array(4);this.planes=Array(6);this.maxSpan=0;this.center=
{origin:c.vec3d.create(),direction:c.vec3d.create()};for(a=0;4>a;a++)this.extent[a]={origin:c.vec3d.create(),direction:c.vec3d.create(),cap:{next:null,direction:c.vec3d.create()}},this.planes[a]=g.plane.create();this.planes[4]=g.plane.create();this.planes[5]=g.plane.create();this.planesWithoutFar=this.planes.slice(0,5)}h.prototype.update=function(a,q,d,k){void 0===k&&(k=!0);var b=this.extent;this.toRenderBoundingExtent(a,q,d);c.vec3d.add(b[0].origin,b[2].origin,this.center.origin);c.vec3d.scale(this.center.origin,
.5);this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction);k||c.vec3d.scale(this.center.direction,-1);for(d=0;4>d;d++){var e=b[d];this.renderCoordsHelper.worldUpAtPosition(e.origin,e.direction);var f=b[3===d?0:d+1];e.cap.next=f.origin;c.vec3d.direction(f.origin,e.origin,e.cap.direction);g.plane.fromVectorsAndPoint(e.direction,e.cap.direction,e.origin,this.planes[d]);k||c.vec3d.scale(e.direction,-1)}g.plane.fromVectorsAndPoint(b[0].cap.direction,b[1].cap.direction,b[0].origin,
this.planes[4]);k?g.plane.negate(this.planes[4],this.planes[5]):(g.plane.set(this.planes[5],this.planes[4]),g.plane.negate(this.planes[4]));this.maxSpan=Math.max(Math.abs(a[0]-a[2]),Math.abs(a[1]-a[3]));this.maxSpanSpatialReference=q};h.prototype.isVisibleInFrustum=function(a,c){void 0===c&&(c=!1);if("global"===this.renderCoordsHelper.type){if(this.maxSpan>(this.maxSpanSpatialReference.isWGS84?z:A))return!0;if(a.altitude>=B)return this.isVisibleInFrustumGlobal(a)}for(var d=0;d<this.extent.length;d++){var b=
this.extent[d];if(!c&&a.intersectsRay(b.origin,null,b.direction)||a.intersectsLineSegment(b.origin,b.cap.next,b.cap.direction))return!0}c=c?this.planes:this.planesWithoutFar;for(d=0;d<a.lines.length;d++)if(b=a.lines[d],y.frustumLineSegment(c,b.origin,b.endpoint,b.direction))return!0;return!1};h.prototype.toRenderBoundingExtentGlobal=function(a,q,d){x.center(a,f);f[2]=d;u.computeLinearTransformation(q,f,n,this.renderCoordsHelper.spatialReference);c.mat4d.inverse(n,v);r.empty(b);for(var k=0,g=C;k<g.length;k++)for(var e=
g[k],h=e.x0,m=e.x1,p=e.y0,e=e.y1,l=0;5>l;l++){var w=l/4;f[0]=t.lerp(a[h],a[m],w);f[1]=t.lerp(a[p],a[e],w);f[2]=d;u.vectorToVector(f,q,f,this.renderCoordsHelper.spatialReference);c.mat4d.multiplyVec3(v,f);r.expandPointInPlace(b,f)}c.mat4d.multiplyVec3(n,c.vec3d.set3(b[0],b[1],b[2],this.extent[0].origin));c.mat4d.multiplyVec3(n,c.vec3d.set3(b[3],b[1],b[2],this.extent[1].origin));c.mat4d.multiplyVec3(n,c.vec3d.set3(b[3],b[4],b[2],this.extent[2].origin));c.mat4d.multiplyVec3(n,c.vec3d.set3(b[0],b[4],
b[2],this.extent[3].origin))};h.prototype.toRenderBoundingExtentLocal=function(a,b,d){c.vec3d.set3(a[0],a[1],d,this.extent[0].origin);c.vec3d.set3(a[2],a[1],d,this.extent[1].origin);c.vec3d.set3(a[2],a[3],d,this.extent[2].origin);c.vec3d.set3(a[0],a[3],d,this.extent[3].origin)};h.prototype.toRenderBoundingExtent=function(a,c,b){switch(this.renderCoordsHelper.type){case "global":this.toRenderBoundingExtentGlobal(a,c,b);break;case "local":this.toRenderBoundingExtentLocal(a,c,b)}};h.prototype.isVisibleInFrustumGlobal=
function(a){if(0>c.vec3d.dot(this.center.direction,a.direction))return!0;for(var b=0;4>b;b++)if(0>c.vec3d.dot(this.extent[b].direction,a.direction))return!0;return!1};return h}();l.FrustumExtentIntersection=m;var C=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],f=c.vec3d.create(),n=c.mat4d.create(),v=c.mat4d.create(),b=r.create();l.default=m});