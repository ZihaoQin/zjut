// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define(["require","exports","./gl-matrix","./Util"],function(y,z,x,n){var p=x.vec3d;return function(){function e(c,h,e,d){n.assert(1<=c.length);n.assert(0===e.length%h);n.assert(e.length>=c.length*h);n.assert(3===d.size||4===d.size);this.primitiveIndices=c;this.indices=e;this._position=d;this._numIndexPerPrimitive=h;var a=d.data,l=d.offsetIdx;d=d.strideIdx;var u=c.length,f=l+d*e[h*c[0]];this.bbMin=p.createFrom(a[f],a[f+1],a[f+2]);this.bbMax=p.create(this.bbMin);for(f=0;f<u;++f)for(var k=h*c[f],m=
0;m<h;++m){var b=l+d*e[k+m];this.bbMin[0]=Math.min(a[b],this.bbMin[0]);this.bbMax[0]=Math.max(a[b],this.bbMax[0]);++b;this.bbMin[1]=Math.min(a[b],this.bbMin[1]);this.bbMax[1]=Math.max(a[b],this.bbMax[1]);++b;this.bbMin[2]=Math.min(a[b],this.bbMin[2]);this.bbMax[2]=Math.max(a[b],this.bbMax[2])}this.center=p.create();p.lerp(this.bbMin,this.bbMax,.5,this.center);this.bsRadius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);for(var t=this.bsRadius*
this.bsRadius,f=0;f<u;++f)for(k=h*c[f],m=0;m<h;++m){var b=l+d*e[k+m],q=a[b]-this.center[0],r=a[b+1]-this.center[1],b=a[b+2]-this.center[2],g=q*q+r*r+b*b;if(!(g<=t)){var g=Math.sqrt(g),v=.5*(g-this.bsRadius);this.bsRadius+=v;t=this.bsRadius*this.bsRadius;g=v/g;this.center[0]+=q*g;this.center[1]+=r*g;this.center[2]+=b*g}}}e.prototype.getCenter=function(){return this.center};e.prototype.getBSRadius=function(){return this.bsRadius};e.prototype.getBBMin=function(){return this.bbMin};e.prototype.getBBMax=
function(){return this.bbMax};e.prototype.getPrimitiveIndices=function(){return this.primitiveIndices};e.prototype.getIndices=function(){return this.indices};e.prototype.getPosition=function(){return this._position};e.prototype.getChildren=function(){if(this.children)return this.children;if(1<p.dist2(this.bbMin,this.bbMax)){for(var c=p.lerp(this.bbMin,this.bbMax,.5,p.create()),h=this.primitiveIndices.length,n=new Uint8Array(h),d=Array(8),a=0;8>a;++a)d[a]=0;for(var a=this._position,l=a.data,u=a.offsetIdx,
f=a.strideIdx,a=0;a<h;++a){for(var k=0,m=this._numIndexPerPrimitive*this.primitiveIndices[a],b=u+f*this.indices[m],t=l[b],q=l[b+1],r=l[b+2],g=1;g<this._numIndexPerPrimitive;++g){var b=u+f*this.indices[m+g],v=l[b],w=l[b+1],b=l[b+2];v<t&&(t=v);w<q&&(q=w);b<r&&(r=b)}t<c[0]&&(k|=1);q<c[1]&&(k|=2);r<c[2]&&(k|=4);n[a]=k;++d[k]}for(a=c=0;8>a;++a)0<d[a]&&++c;if(2>c)return;c=Array(8);for(a=0;8>a;++a)c[a]=0<d[a]?new Uint32Array(d[a]):void 0;for(a=0;8>a;++a)d[a]=0;for(a=0;a<h;++a)k=n[a],c[k][d[k]++]=this.primitiveIndices[a];
this.children=Array(8);for(a=0;8>a;++a)void 0!==c[a]&&(this.children[a]=new e(c[a],this._numIndexPerPrimitive,this.indices,this._position))}return this.children};return e}()});