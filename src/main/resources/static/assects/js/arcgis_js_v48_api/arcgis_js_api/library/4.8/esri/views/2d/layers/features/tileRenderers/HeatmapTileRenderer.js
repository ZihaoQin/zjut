// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
require({cache:{"esri/renderers/support/heatmapUtils":function(){define(["require","exports","../../core/global","../../views/3d/support/mathUtils"],function(e,c,m,a){function k(g,d,b,l,h){g=new Uint32Array(g*g);d="buffer"in d?d:new Float64Array(d);b="buffer"in b?new Uint32Array(b.buffer):new Uint32Array((new Uint8Array(b)).buffer);h=b.length/(h-l);for(var f=0;f<d.length;f++)g[f]=b[a.clamp(Math.floor((d[f]-l)*h),0,b.length-1)];return g.buffer}function n(a){for(var d=Math.round(4.5*a),b=a*a,l=new Float64Array(2*
d+1),h=0;h<=l.length;h++)l[h]=Math.exp(-Math.pow(h-d,2)/(2*b))/Math.sqrt(2*Math.PI)*(a/2);return l}function f(a,d){return"function"===typeof a?a:a?"string"===typeof d?function(b){return-1*+b[a]}:function(b){return+b[a]+d}:function(b){return 1}}Object.defineProperty(c,"__esModule",{value:!0});c.generateGradient=function(){if(!("document"in m))return function(a){return null};var a=document.createElement("canvas"),d=a.getContext("2d");a.height=512;a.width=1;return function(b){var l=d.createLinearGradient(0,
0,0,a.height),h=0;for(b=b.colorStops;h<b.length;h++){var f=b[h],g=f.color;l.addColorStop(f.ratio,"rgba("+g[0]+", "+g[1]+", "+g[2]+", "+g[3]+")")}d.fillStyle=l;d.fillRect(0,0,1,a.height);return d.getImageData(0,0,1,a.height).data}}();c.calculateHeatmapIntensityInfo=function(a,d,b,l){var h=d.blurRadius,g=d.fieldOffset,c=d.field;d=new Float64Array(b*l);for(var k=n(h),h=Math.round(4.5*h),m=Number.NEGATIVE_INFINITY,e,g=f(c,g),c=0;c<a.length;c++){var q=a[c],p=q.geometry,u=p.x-h,w=p.y-h,A=Math.max(0,u);
e=Math.max(0,w);for(var B=Math.min(l,p.y+h),p=Math.min(b,p.x+h),q=+g(q.attributes),r=e;r<B;r++)for(var C=k[r-w],t=A;t<p;t++)e=d[r*b+t]+=C*k[t-u]*q,e>m&&(m=e)}return{matrix:d.buffer,max:m}};c.drawHeatmap=function(a,d,b,l,h,f){var c=a.getContext("2d");c.clearRect(0,0,d,d);var g=c.getImageData(0,0,d,d);g.data.set(new Uint8ClampedArray(k(d,b,l,h,f)));c.putImageData(g,0,0);return a};c.createHeatmapImageData=k;c.createKernel=n;c.createValueFunction=f})},"esri/views/2d/layers/features/tileRenderers/BaseTileRenderer":function(){define("require exports ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/tsSupport/decorateHelper ../../../../../core/Accessor ../../../../../core/HandleOwner ../../../../../core/accessorSupport/decorators ../../../tiling/enums".split(" "),
function(e,c,m,a,k,n,f,g){Object.defineProperty(c,"__esModule",{value:!0});e=function(d){function b(a){a=d.call(this)||this;a.tiles=new Map;a.layer=null;return a}m(b,d);b.prototype.destroy=function(){this.tiles.clear();this.layer=this.layerView=this.tileInfoView=this.highlightOptions=this.configuration=this.tiles=null};Object.defineProperty(b.prototype,"updating",{get:function(){return this.isUpdating()},enumerable:!0,configurable:!0});b.prototype.acquireTile=function(a){var b=this,d=this.createTile(a);
d.once("attach",function(){return b.notifyChange("updating")});this.tiles.set(a.id,d);return d};b.prototype.forEachTile=function(a){this.tiles.forEach(a)};b.prototype.releaseTile=function(a){this.tiles.delete(a.key.id);this.disposeTile(a)};b.prototype.isUpdating=function(){var a=!0;this.tiles.forEach(function(b){a=a&&b.status!==g.TileStatus.INITIALIZED});return!a};b.prototype.requestUpdate=function(){this.layerView.requestUpdate()};a([f.property()],b.prototype,"configuration",void 0);a([f.property()],
b.prototype,"highlightOptions",void 0);a([f.property()],b.prototype,"layer",void 0);a([f.property()],b.prototype,"layerView",void 0);a([f.property()],b.prototype,"tileInfoView",void 0);a([f.property()],b.prototype,"updating",null);return b=a([f.subclass()],b)}(f.declared(k,n));c.default=e})},"esri/core/HandleOwner":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ./Accessor ./Handles ./accessorSupport/decorators".split(" "),function(e,c,m,
a,k,n,f){return function(c){function d(){var a=c.call(this)||this;a.handles=new n;return a}m(d,c);d.prototype.destroy=function(){this.handles.destroy()};a([f.property({readOnly:!0})],d.prototype,"handles",void 0);return d=a([f.subclass("esri.core.HandleOwner")],d)}(f.declared(k))})},"esri/views/2d/layers/features/tileRenderers/support/HeatmapSource":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/tsSupport/decorateHelper ../../../../../../core/ObjectFactory ../../../../../../core/ObjectPool ../../../../../../renderers/support/heatmapUtils ../../../../engine/BitmapSource".split(" "),
function(e,c,m,a,k,n,f,g){Object.defineProperty(c,"__esModule",{value:!0});var d=new k.default(function(){var a=document.createElement("canvas");a.width=a.height=512;return a},function(a){a.width=a.height=512});e=function(a){function b(){var b=a.call(this,d.acquire())||this;b._invalidated=!0;b._gradient=null;return b}m(b,a);Object.defineProperty(b.prototype,"gradient",{get:function(){return this._gradient},set:function(a){this._gradient=a;this.invalidate()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"intensities",{get:function(){return this._intensities},set:function(a){this._intensities=a;this.invalidate()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"minPixelIntensity",{get:function(){return this._minPixelIntensity},set:function(a){this._minPixelIntensity=a;this.invalidate()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"maxPixelIntensity",{get:function(){return this._maxPixelIntensity},set:function(a){this._maxPixelIntensity=a;this.invalidate()},
enumerable:!0,configurable:!0});b.prototype.acquire=function(){this.data=d.acquire()};b.prototype.release=function(){d.release(this.data);this.gradient=this.intensities=this.data=null};b.prototype.draw=function(b,d,c,g,k,e,q,p,u){if(this._invalidated){this._invalidated=!1;if(!this._gradient||!this._intensities)return;f.drawHeatmap(this.data,512,this._intensities,this._gradient,this._minPixelIntensity,this._maxPixelIntensity)}a.prototype.draw.call(this,b,d,c,g,k,e,q,p,u)};b.prototype.invalidate=function(){this._invalidated=
!0;this.emit("update",this)};b.pool=new n(b,!0);return b}(g.default);c.default=e})},"esri/core/ObjectFactory":function(){define(["require","exports"],function(e,c){Object.defineProperty(c,"__esModule",{value:!0});e=function(){function c(a,c,e,f){void 0===e&&(e=1);void 0===f&&(f=0);this.acquireFunction=a;this.releaseFunction=c;this.growthSize=e;this._pool=Array(f);this._set=new Set;this._initialSize=f;for(a=0;a<f;a++)this._pool[a]=this.acquireFunction();this.growthSize=Math.max(e,1)}c.prototype.acquire=
function(){var a;if(0===this._pool.length){a=this.growthSize;for(var c=0;c<a;c++)this._pool[c]=this.acquireFunction()}(a=this._pool.shift())&&a.acquire&&"function"===typeof a.acquire&&a.acquire();this._set.delete(a);return a};c.prototype.release=function(a){a&&!this._set.has(a)&&(this.releaseFunction?this.releaseFunction(a):a&&a.release&&"function"===typeof a.release&&a.release(),this._pool.push(a),this._set.add(a))};c.prototype.prune=function(){if(!(this._pool.length<=this._initialSize))for(var a;this._initialSize>
this._pool.length;)a=this._pool.shift(),this._set.delete(a),a.dispose&&"function"===typeof a.dispose&&a.dispose()};return c}();c.default=e})},"*noref":1}});
define("require exports ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/tsSupport/decorateHelper ../../../../../renderers ../../../../../core/Accessor ../../../../../core/promiseUtils ../../../../../core/accessorSupport/decorators ../../../../../renderers/support/diffUtils ../../../../../renderers/support/heatmapUtils ../../../engine/BitmapContainer ../../../engine/BitmapTile ../../../engine/Canvas2DContainer ./BaseTileRenderer ./support/HeatmapSource ../../../tiling/enums".split(" "),function(e,
c,m,a,k,n,f,g,d,b,l,h,x,y,v,z){Object.defineProperty(c,"__esModule",{value:!0});e=function(c){function e(a){a=c.call(this)||this;a._canvas=new x;a._bitmaps=new l;a._canvas.addChild(a._bitmaps);return a}m(e,c);Object.defineProperty(e.prototype,"gradient",{get:function(){return b.generateGradient(this.configuration.renderer)},enumerable:!0,configurable:!0});e.prototype.createTile=function(a){var b=h.default.pool.acquire();b.key.set(a);this.tileInfoView.getTileCoords(b,a);b.resolution=this.tileInfoView.getTileResolution(a);
b.height=b.width=512;return b};e.prototype.applyConfiguration=function(a,b){this.configuration=a;a=a.renderer;var d=a.minPixelIntensity,p=a.maxPixelIntensity,c=this.gradient;b||this.tiles.forEach(function(a){if(a=a.source)a.minPixelIntensity=d,a.maxPixelIntensity=p,a.gradient=c})};e.prototype.getProcessorConfiguration=function(){var a=this.layer;return{type:"heatmap",renderer:a.renderer.toJSON(),definitionExpression:a.definitionExpression,outFields:a.outFields,gdbVersion:a.gdbVersion,historicMoment:a.historicMoment&&
a.historicMoment.getTime()}};e.prototype.hitTest=function(a,b){return f.resolve([])};e.prototype.highlight=function(a){return{remove:function(){}}};e.prototype.install=function(a){a.addChild(this._canvas)};e.prototype.uninstall=function(a){a.removeChild(this._canvas)};e.prototype.needsProcessorReconfiguration=function(a){var b=this.configuration;if(!b||b.definitionExpression!==a.definitionExpression||b.outFields.join()!==a.outFields.join())return!0;b=this.configuration&&k.fromJSON(this.configuration.renderer)||
null;a=a&&k.fromJSON(a.renderer)||null;a=d.diff(b,a);if(!a)return!1;switch(a.type){case "complete":return!0;case "partial":for(var c in a.diff)if("colorStops"!==c&&"minPixelIntensity"!==c&&"maxPixelIntensity"!==c)return!0}return!1};e.prototype.disposeTile=function(a){a.source&&v.default.pool.release(a.source);this._bitmaps.removeChild(a);h.default.pool.release(a)};e.prototype.supportsRenderer=function(a){return a&&"heatmap"===a.type};e.prototype.onTileData=function(a){var b=this.tiles.get(a.tileKey);
if(b){a=a.intensityInfo;var c=this.configuration.renderer,d=c.minPixelIntensity,c=c.maxPixelIntensity;if(b.source)b.source.minPixelIntensity=d,b.source.maxPixelIntensity=c,b.source.gradient=this.gradient,b.source.intensities=a&&a.matrix||null;else{var e=v.default.pool.acquire();e.intensities=a&&a.matrix||null;e.minPixelIntensity=d;e.maxPixelIntensity=c;e.gradient=this.gradient;b.source=e;b.source.x=b.x;b.source.y=b.y;b.status=z.TileStatus.READY;this._bitmaps.addChild(b);this.requestUpdate()}}};e.prototype.onTileError=
function(a){console.error(a)};a([g.property({readOnly:!0,dependsOn:["configuration"]})],e.prototype,"gradient",null);return e=a([g.subclass()],e)}(g.declared(n,y.default));c.default=e});