// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports dojox/gfx/_base ../../core/Error ../../core/promiseUtils ../../core/screenUtils ../SimpleMarkerSymbol ./gfxUtils ./previewUtils ./renderUtils".split(" "),function(C,q,w,x,u,n,m,t,y,z){function A(e,f){var b=B.getContext("2d"),k=[];f&&(f.weight&&k.push(f.weight),f.size&&k.push(f.size+"px"),f.family&&k.push(f.family));b.font=k.join(" ");return b.measureText(e).width}Object.defineProperty(q,"__esModule",{value:!0});var B=document.createElement("canvas");q.previewSymbol2D=function(e,
f){var b=f&&f.size?n.pt2px(f.size):null,k=f&&f.maxSize?n.pt2px(f.maxSize):null,c=t.getStroke(e),h={shape:null,fill:null,stroke:c};c&&c.width&&(c.width=Math.min(c.width,80));var g=0,d=0,l=c&&c.width||0,q=!1,v=null;switch(e.type){case "simple-marker":var a=m.defaultProps,c=e.style,d=g=b=Math.min(b||n.pt2px(e.size||a.size),k||120);switch(c){case m.STYLE_CIRCLE:h.shape={type:"circle",cx:0,cy:0,r:.5*b};break;case m.STYLE_CROSS:h.shape={type:"path",path:[{command:"M",values:[0,.5*d]},{command:"L",values:[g,
.5*d]},{command:"M",values:[.5*g,0]},{command:"L",values:[.5*g,d]},{command:"E",values:[]}]};break;case m.STYLE_DIAMOND:h.shape={type:"path",path:[{command:"M",values:[0,.5*d]},{command:"L",values:[.5*g,0]},{command:"L",values:[g,.5*d]},{command:"L",values:[.5*g,d]},{command:"Z",values:[]}]};break;case m.STYLE_SQUARE:h.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[g,0]},{command:"L",values:[g,d]},{command:"L",values:[0,d]},{command:"Z",values:[]}]};break;case m.STYLE_X:h.shape=
{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[g,d]},{command:"M",values:[g,0]},{command:"L",values:[0,d]},{command:"E",values:[]}]};break;case m.STYLE_PATH:q=!0,h.shape={type:"path",path:e.path||""}}break;case "simple-line":l=Math.min(b||l,k||80);g=22<l?2*l:40;d=l;c.width=l;l=0;h.shape={type:"path",path:[{command:"M",values:[0,.5*d]},{command:"L",values:[g,.5*d]},{command:"E",values:[]}]};break;case "picture-fill":case "simple-fill":h.shape=y.shapes.fill[0];break;case "picture-marker":k=
k||120;c=n.pt2px(e.width);a=n.pt2px(e.height);b=Math.min(b||Math.max(c,a),k);a=c/a;c=1>=a?Math.ceil(b*a):b;a=1>=a?b:Math.ceil(b/a);g=c;d=a;v=f.opacity;h.shape={type:"image",x:-Math.round(c/2),y:-Math.round(a/2),width:c,height:a,src:e.url||""};break;case "text":var c=e.text||"Aa",a=e.font,b=Math.min(b||n.pt2px(a.size),k||120),r=A(c,{weight:a.weight,size:b,family:a.family}),g=(k=/[\uE600-\uE6FF]/.test(c))?b:r,d=b,r=.25*w.normalizedLength((a?b:0).toString());k&&(r+=5);h.shape={type:"text",text:c,x:0,
y:r,align:"middle",decoration:e.decoration||a&&a.decoration,rotated:e.rotated,kerning:e.kerning};h.font=a&&{size:b,style:a.style,decoration:a.decoration,weight:a.weight,family:a.family}}if(!h.shape)return u.reject(new x("symbolPreview: renderPreviewHTML2D","symbol not supported."));var g=(g||22)+2*l,d=(d||22)+2*l,p=t.getFill(e),l=e.color,b=null;p&&"pattern"===p.type&&l&&"picture-fill"!==e.type?b=t.getPatternUrlWithColor(p.src,l.toCss(!0)).then(function(a){p.src=a;h.fill=p;return h}):(h.fill=p,b=u.resolve(h));
return b.then(function(a){return z.renderSymbol([[a]],[g,d],{node:f&&f.node,scale:q,opacity:v,rotation:f.rotation})})}});