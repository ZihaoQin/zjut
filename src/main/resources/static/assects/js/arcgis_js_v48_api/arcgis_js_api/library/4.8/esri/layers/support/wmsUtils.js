// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports ../../core/Error ../../core/urlUtils ../../geometry/Extent ../../geometry/SpatialReference".split(" "),function(K,n,H,I,x,u){function p(a){return J.some(function(d){var b=d[1];return a>=d[0]&&a<=b})}function A(a){var d=[];a.forEach(function(a){d.push(a);a.sublayers&&a.sublayers.length&&(d=d.concat(A(a.sublayers)),delete a.sublayers)});return d}function k(a,d){return(a=d&&d.getElementsByTagName(a))&&0<a.length?a[0]:null}function m(a,d,b){return(a=k(a,d))?a.textContent:b}function q(a,
d,b){if(!a)return null;var c=parseFloat(a.getAttribute("minx")),h=parseFloat(a.getAttribute("miny")),f=parseFloat(a.getAttribute("maxx"));a=parseFloat(a.getAttribute("maxy"));b?(b=isNaN(h)?-Number.MAX_VALUE:h,c=isNaN(c)?-Number.MAX_VALUE:c,h=isNaN(a)?Number.MAX_VALUE:a,f=isNaN(f)?Number.MAX_VALUE:f):(b=isNaN(c)?-Number.MAX_VALUE:c,c=isNaN(h)?-Number.MAX_VALUE:h,h=isNaN(f)?Number.MAX_VALUE:f,f=isNaN(a)?Number.MAX_VALUE:a);d=new u({wkid:d});return new x({xmin:b,ymin:c,xmax:h,ymax:f,spatialReference:d})}
function B(a,d){a=k(d,a);if(a=k("DCPType",a))if(a=k("HTTP",a))if(a=k("Get",a)){var b;if(b=(a=k("OnlineResource",a))?a.getAttribute("xlink:href"):null){b.indexOf("\x26")===b.length-1&&(b=b.substring(0,b.length-1));a=["service","request"];d=[];b=I.urlToObject(b);for(var c in b.query)b.query.hasOwnProperty(c)&&-1===a.indexOf(c.toLowerCase())&&d.push(c+"\x3d"+b.query[c]);return b.path+(d.length?"?"+d.join("\x26"):"")}}return null}function C(a,d){var b=a.getElementsByTagName("Operation");if(b&&b.length){var c=
[];Array.prototype.slice.call(b).forEach(function(a){a.getAttribute("name")===d&&(a=a.getElementsByTagName("Format"),Array.prototype.slice.call(a).forEach(function(a){c.push(a.textContent)}))});return c}a=k(d,a).getElementsByTagName("Format");return Array.prototype.slice.call(a).map(function(a){return a.textContent})}function y(a,d,b){if(!a)return null;var c={id:D++,fullExtents:[],parentLayerId:null,queryable:"1"===a.getAttribute("queryable"),spatialReferences:[],sublayers:null},h=k("LatLonBoundingBox",
a),f=k("EX_GeographicBoundingBox",a),g=null;h&&(g=q(h,4326));f&&(g=new x(0,0,0,0,new u({wkid:4326})),g.xmin=parseFloat(m("westBoundLongitude",f,0)),g.ymin=parseFloat(m("southBoundLatitude",f,0)),g.xmax=parseFloat(m("eastBoundLongitude",f,0)),g.ymax=parseFloat(m("northBoundLatitude",f,0)));h||f||(g=new x(-180,-90,180,90,new u({wkid:4326})));var n=-1<["1.0.0","1.1.0","1.1.1"].indexOf(d)?"SRS":"CRS";Array.prototype.slice.call(a.childNodes).forEach(function(a){if("Name"===a.nodeName)c.name=a.textContent||
"";else if("Title"===a.nodeName)c.title=a.textContent||"";else if("Abstract"===a.nodeName)c.description=a.textContent||"";else if("BoundingBox"===a.nodeName){var f=a.getAttribute(n);if(f&&0===f.indexOf("EPSG:")){var e=parseInt(f.substring(5),10);0===e||isNaN(e)||g||(g="1.3.0"===d?q(a,e,p(e)):q(a,e))}(e=f&&f.indexOf(":"))&&-1<e&&(e=parseInt(f.substring(e+1,f.length),10),0===e||isNaN(e)||(e=r[e]?r[e]:e),a="1.3.0"===d?q(a,e,p(e)):q(a,e),c.fullExtents.push(a))}else if(a.nodeName===n)a.textContent.split(" ").forEach(function(a){a=
-1<a.indexOf(":")?parseInt(a.split(":")[1],10):parseInt(a,10);0===a||isNaN(a)||(r[a]&&(a=r[a]),-1===c.spatialReferences.indexOf(a)&&c.spatialReferences.push(a))});else if("Style"!==a.nodeName||c.legendURL)"Layer"===a.nodeName&&(a=y(a,d,b))&&(a.parentLayerId=c.id,c.sublayers||(c.sublayers=[]),c.sublayers.push(a));else if(a=k("LegendURL",a))if(a=k("OnlineResource",a))c.legendURL=a.getAttribute("xlink:href"),b&&(c.legendURL=c.legendURL.replace(/^http:/i,"https:"))});c.extent=g&&g.toJSON();return c}Object.defineProperty(n,
"__esModule",{value:!0});var J=[[4001,4999],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3416,3416],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],
[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]],r={84:4326,83:4269,27:4267},D;n.parseCapabilities=function(a,d){if(a){D=-1;"string"===typeof a&&(a=(new DOMParser).parseFromString(a,"text/xml"));var b=a.documentElement;if("ServiceExceptionReport"===b.nodeName){var c=Array.prototype.slice.call(b.childNodes).map(function(a){return a.textContent}).join("\r\n");throw new H("wmslayer:wms-capabilities-xml-is-not-valid",
"The server returned errors when the WMS capabilities were requested.",c);}var h=k("Layer",b);if(h){var f="WMS_Capabilities"===b.nodeName||"WMT_MS_Capabilities"===b.nodeName?b.getAttribute("version"):"1.3.0",g=k("Service",b);a=m("Title",g,"")||m("Name",g,"");var n=m("AccessConstraints",g,""),q=m("Abstract",g,""),r=parseInt(m("MaxWidth",g,5E3),10),g=parseInt(m("MaxHeight",g,5E3),10),e=k("Capability",b),u=C(b,"GetMap"),v=d&&-1<d.toLowerCase().indexOf("https");d=B(b,"GetMap");v&&(d=d.replace(/^http:/i,
"https:"));var l=y(h,f,v),p=0,E;Array.prototype.slice.call(e.childNodes).forEach(function(a){"Layer"===a.nodeName&&(0===p?E=a:(1===p&&l.name&&(l.name="",l.sublayers.push(y(E,f,v))),l.sublayers.push(y(a,f,v))),p++)});if(!l)return null;var e=[],t,w,h=l.fullExtents;(e=l.sublayers)||(e=[]);0===e.length&&e.push(l);t=l.extent;t||(t=new x(e[0].extent),l.extent=t.toJSON(),t=l.extent);w=l.spatialReferences;if(!w.length&&0<e.length){var F=function(a){var b=[];a.sublayers.forEach(function(a){!b.length&&a.spatialReferences.length&&
(b=a.spatialReferences||F(a))});return b};e.forEach(function(a){w.length||(w=a.spatialReferences||F(a))})}var z=B(b,"GetFeatureInfo");z&&(b=C(b,"GetFeatureInfo"),-1<b.indexOf("text/html")?c="text/html":-1<b.indexOf("text/plain")&&(c="text/plain"),v&&(z=z.replace(/^http:/i,"https:")));if(!c){var G=function(a){a&&(a.queryable=!1,a.sublayers&&a.sublayers.forEach(function(a){G(a)}))};G(l)}b=A(e);return{copyright:n,description:q,extent:t,fullExtents:h,featureInfoFormat:c,featureInfoUrl:z,mapUrl:d,maxImageWidth:r,
maxImageHeight:g,layers:b,spatialReferences:w,supportedImageFormatTypes:u,title:a,version:f}}}};n.coordsReversed=p;n.getPopupLayers=function(a){return a.length?a.filter(function(a){return a.popupEnabled&&a.name&&a.queryable}).map(function(a){return a.name}).join(","):""}});