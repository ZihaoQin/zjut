// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../lib/glMatrix ../PointToPointAnimationController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../animation/easing".split(" "),function(h,l,p,m,c,q,k,n,r){Object.defineProperty(l,"__esModule",{value:!0});h=function(h){function d(b,a,e){a=h.call(this,b.state,a,"interaction"===e?null:void 0)||this;a.view=b;a.mode=e;a.zoomLocation=c.vec3d.create();a.tmpCamera=new n;a.panAxis=
c.vec3d.create();a.tmpViewDir=c.vec3d.create();a.targetOnSphere=c.vec3d.create();a.tmpCenter=c.vec3d.create();a.constraintOptions={selection:7,interactionType:1,interactionFactor:null,interactionStartCamera:new n,interactionDirection:null};a.sphere={center:c.vec3d.create(),radius:0};return a}p(d,h);Object.defineProperty(d.prototype,"isInteractive",{get:function(){return"interaction"===this.mode},enumerable:!0,configurable:!0});d.prototype.zoomStep=function(b,a){if(this.active){var e=this.view.state,
f=this.constraintOptions.interactionStartCamera;this.animation.finished?f.copyFrom(e.camera):this.animation.cameraAt(1,f);f=!1;0<b&&this.pickingHelper.pickPointInScreen(a,this.zoomLocation)&&(f=!0);this.tmpCamera.copyFrom(e.camera);f?this.pickingHelper.pickRaySegment(this.tmpCamera.eye,this.tmpCamera.center,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter):this.pickingHelper.pickRaySegment(this.tmpCamera.eye,this.tmpCamera.center,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:c.vec3d.set(this.tmpCamera.center,
this.zoomLocation);this.updateCamera(this.tmpCamera,Math.pow(.6,b),this.zoomLocation,a);this.begin(this.tmpCamera)}};d.prototype.animationSettings=function(){return{apex:null,duration:.6,easing:r.outExpo}};d.prototype.updateCamera=function(b,a,e,f){this.sphere.radius=c.vec3d.length(e);c.vec3d.subtract(b.center,b.eye,this.tmpViewDir);var g=c.vec3d.length(this.tmpViewDir),d=g*a;1>=a&&4>d&&(d=4,a=d/g);1E-6>Math.abs(g-d)||(g=c.vec3d.length(b.center),this.sphere.radius!==g&&c.vec3d.scale(b.center,(this.sphere.radius+
a*(g-this.sphere.radius))/g),c.vec3d.scale(this.tmpViewDir,-a),c.vec3d.add(b.center,this.tmpViewDir,b.eye),m.applyAll(this.view,b,this.constraintOptions),1E-12<c.vec3d.dist2(e,b.center)&&k.intersectSphereFromScreenPoint(this.sphere,b,f,this.targetOnSphere)&&(a=k.rotationAndAxisFromPoints(e,this.targetOnSphere,this.panAxis),k.applyRotation(b,this.sphere.center,this.panAxis,a)),m.applySurfaceCollision(this.view,b))};return d}(q.PointToPointAnimationController);l.ZoomStepController=h});