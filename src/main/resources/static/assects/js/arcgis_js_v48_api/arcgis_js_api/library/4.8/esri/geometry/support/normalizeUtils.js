// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports ../../config ../../core/Error ../../core/Logger ../../core/promiseUtils ../Polygon ../Polyline ../SpatialReference ./spatialReferenceUtils ./webMercatorUtils ../../tasks/GeometryService".split(" "),function(S,w,L,M,N,O,A,v,x,D,y,P){function u(a){return"polygon"===a.type?a.rings:a.paths}function r(a,f){return Math.ceil((a-f)/(2*f))}function E(a,f){for(var c=0,b=u(a);c<b.length;c++)for(var e=0,g=b[c];e<g.length;e++)g[e][0]+=f;return a}function F(a){for(var f=[],c=0,b=0,e=0;e<
a.length;e++){for(var g=a[e],l=null,h=0;h<g.length;h++)l=g[h],f.push(l),0===h?b=c=l[0]:(c=Math.min(c,l[0]),b=Math.max(b,l[0]));l&&f.push([(c+b)/2,0])}return f}function G(a,f){if(!(a instanceof v||a instanceof A))throw Q.error("straightLineDensify: the input geometry is neither polyline nor polygon"),new M("straightLineDensify: the input geometry is neither polyline nor polygon");for(var c=[],b=0,e=u(a);b<e.length;b++){var g=e[b],l=[];c.push(l);l.push([g[0][0],g[0][1]]);for(var h=0;h<g.length-1;h++){var m=
g[h][0],k=g[h][1],t=g[h+1][0],n=g[h+1][1],q=Math.sqrt((t-m)*(t-m)+(n-k)*(n-k)),d=(n-k)/q,p=(t-m)/q,r=q/f;if(1<r){for(var B=1;B<=r-1;B++){var H=B*f;l.push([p*H+m,d*H+k])}q=(q+Math.floor(r-1)*f)/2;l.push([p*q+m,d*q+k])}l.push([t,n])}}return"polygon"===a.type?new A({rings:c,spatialReference:a.spatialReference}):new v({paths:c,spatialReference:a.spatialReference})}function I(a,f,c){f&&(a=G(a,1E6),a=y.webMercatorToGeographic(a,!0));c&&(a=E(a,c));return a}function J(a,f,c){if(Array.isArray(a)){var b=a[0];
if(b>f){var e=r(b,f);a[0]=b+-2*e*f}else b<c&&(e=r(b,c),a[0]=b+-2*e*c)}else b=a.x,b>f?(e=r(b,f),a=a.clone().offset(-2*e*f,0)):b<c&&(e=r(b,c),a=a.clone().offset(-2*e*c,0));return a}function R(a,f){for(var c=-1,b=function(b){var e=f.cutIndexes[b],h=f.geometries[b],g=u(h);b=function(a){var b=g[a];b.some(function(c){if(!(180>c[0])){for(var d=c=0;d<b.length;d++){var e=b[d][0];c=e>c?e:c}c=Number(c.toFixed(9));c=-360*r(c,180);for(d=0;d<b.length;d++)e=h.getPoint(a,d),h.setPoint(a,d,e.clone().offset(c,0))}return!0})};
for(var k=0;k<g.length;k++)b(k);if(e===c)if("polygon"===a[0].type)for(b=0,k=u(h);b<k.length;b++)a[e]=a[e].addRing(k[b]);else{if("polyline"===a[0].type)for(b=0,k=u(h);b<k.length;b++)a[e]=a[e].addPath(k[b])}else c=e,a[e]=h},e=0;e<f.cutIndexes.length;e++)b(e);return a}function K(a,f){if(!Array.isArray(a))return K([a],f);f||(C||(C=new P({url:L.geometryServiceUrl})),f=C);for(var c,b,e,g,l,h,m,k=0,t=[],n=[],q=0;q<a.length;q++){var d=a[q];if(d)if(c||(c=d.spatialReference,b=D.getInfo(c),h=(e=c.isWebMercator)?
102100:4326,g=z[h].maxX,l=z[h].minX,m=z[h].plus180Line,h=z[h].minus180Line),b)if("mesh"===d.type)n.push(d);else if("point"===d.type)n.push(J(d.clone(),g,l));else if("multipoint"===d.type)d=d.clone(),d.points=d.points.map(function(a){return J(a,g,l)}),n.push(d);else if("extent"===d.type){var p=d.clone(),d=p._normalize(!1,!1,b);n.push(d.rings?new A(d):d)}else if(d.extent){var p=d.extent,u=2*r(p.xmin,l)*g,d=0===u?d.clone():E(d.clone(),u);p.offset(u,0);p.intersects(m)&&p.xmax!==g?(k=p.xmax>k?p.xmax:k,
d=I(d,e),t.push(d),n.push("cut")):p.intersects(h)&&p.xmin!==l?(k=2*p.xmax*g>k?2*p.xmax*g:k,d=I(d,e,360),t.push(d),n.push("cut")):n.push(d)}else n.push(d.clone());else n.push(d);else n.push(d)}c=r(k,g);b=-90;m=c;for(k=new v;0<c;)q=-180+360*c,k.addPath([[q,b],[q,-1*b]]),b*=-1,c--;if(0<t.length&&0<m)return f.cut(t,k).then(function(a){return R(t,a)}).then(function(b){for(var c=[],d=[],h=0;h<n.length;h++){var g=n[h];if("cut"!==g)d.push(g);else{var g=b.shift(),k=a[h];"polygon"===k.type&&k.rings&&1<k.rings.length&&
g.rings.length>=k.rings.length?(c.push(g),d.push("simplify")):d.push(e?y.geographicToWebMercator(g):g)}}return c.length?f.simplify(c).then(function(a){for(var b=[],c=0;c<d.length;c++){var f=d[c];"simplify"!==f?b.push(f):b.push(e?y.geographicToWebMercator(a.shift()):a.shift())}return b}):d});c=[];for(b=0;b<n.length;b++)m=n[b],"cut"!==m?c.push(m):(m=t.shift(),c.push(!0===e?y.geographicToWebMercator(m):m));return O.resolve(c)}Object.defineProperty(w,"__esModule",{value:!0});var Q=N.getLogger("esri.geometry.support.normalizeUtils"),
z={102100:{maxX:2.0037508342788905E7,minX:-2.0037508342788905E7,plus180Line:new v({paths:[[[2.0037508342788905E7,-2.0037508342788905E7],[2.0037508342788905E7,2.0037508342788905E7]]],spatialReference:x.WebMercator}),minus180Line:new v({paths:[[[-2.0037508342788905E7,-2.0037508342788905E7],[-2.0037508342788905E7,2.0037508342788905E7]]],spatialReference:x.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new v({paths:[[[180,-180],[180,180]]],spatialReference:x.WebMercator}),minus180Line:new v({paths:[[[-180,
-180],[-180,180]]],spatialReference:x.WebMercator})}};w.straightLineDensify=G;var C;w.normalizeCentralMeridian=K;w.getDenormalizedExtent=function(a){var f;if(!a)return null;var c=a.extent;if(!c)return null;var b=a.spatialReference&&D.getInfo(a.spatialReference);if(!b)return c;var b=b.valid,e=b[0],b=b[1],g=c.width,l=c.xmin;f=c.xmax;f=[f,l];l=f[0];f=f[1];if("extent"===a.type||0===g||g<=b||g>2*b||l<e||f>b)return c;var h;switch(a.type){case "polygon":if(1<a.rings.length)h=F(a.rings);else return c;break;
case "polyline":if(1<a.paths.length)h=F(a.paths);else return c;break;case "multipoint":h=a.points}a=c.clone();for(e=0;e<h.length;e++){var m=h[e][0];0>m?(m+=b,f=Math.max(m,f)):(m-=b,l=Math.min(m,l))}a.xmin=l;a.xmax=f;return a.width<g?(a.xmin-=b,a.xmax-=b,a):c}});