// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../core/arrayUtils ../../../lib/glMatrix ../../../support/mathUtils ../../../support/buffer/typedArrayUtil".split(" "),function(T,w,M,d,F,N){function O(b,r){var f=Math.acos(b.cosAngle),a=B.fwd,c=B.ortho;d.vec3d.normalize(d.vec3d.direction(b.position0,b.position1,a));b=0<d.vec3d.dot(d.vec3d.cross(b.faceNormal0,b.faceNormal1,c),a)?-1:1;return f*b>r}function P(b){var d=b.faces.length/3,f=b.faces;b=b.neighbors;for(var a=0,c=0;c<d;c++)var l=b[3*c+0],k=b[3*c+1],h=b[3*
c+2],m=f[3*c+0],e=f[3*c+1],n=f[3*c+2],a=a+(-1===l||m<e?1:0),a=a+(-1===k||e<n?1:0),a=a+(-1===h||n<m?1:0);for(var a=new Int32Array(4*a),g=0,c=0;c<d;c++){l=b[3*c+0];k=b[3*c+1];h=b[3*c+2];m=f[3*c+0];e=f[3*c+1];n=f[3*c+2];if(-1===l||m<e)a[g++]=m,a[g++]=e,a[g++]=c,a[g++]=l;if(-1===k||e<n)a[g++]=e,a[g++]=n,a[g++]=c,a[g++]=k;if(-1===h||n<m)a[g++]=n,a[g++]=m,a[g++]=c,a[g++]=h}return a}function Q(b){var r=b.faces.length/3,f=b.vertices.position;b=b.faces;for(var a=u.v0,c=u.v1,l=u.v2,k=new Float32Array(3*r),
h=0;h<r;h++){var m=b[3*h+1],e=b[3*h+2];f.getVec(b[3*h+0],a);f.getVec(m,c);f.getVec(e,l);d.vec3d.subtract(c,a);d.vec3d.subtract(l,a);d.vec3d.normalize(d.vec3d.cross(c,l,a));k[3*h+0]=a[0];k[3*h+1]=a[1];k[3*h+2]=a[2]}return k}Object.defineProperty(w,"__esModule",{value:!0});w.extractEdges=function(b,r,f,a){void 0===a&&(a=R);var c=b.vertices.position,l=b.vertices.componentIndex,k=F.deg2rad(a.anglePlanar);a=F.deg2rad(a.angleSignificantEdge);var h=Math.cos(a),m=Math.cos(k),e=B.edge,n=e.position0,g=e.position1,
x=e.faceNormal0,z=e.faceNormal1,q=Q(b),t=P(b),y=t.length/4;b=r.allocate(y);a=0;var u=f.allocate(y),w=0,G=0,H=0,I=M.range(0,y),A=new Float32Array(y);N.forEach(A,function(a,b,e){c.getVec(t[4*b+0],n);c.getVec(t[4*b+1],g);e[b]=d.vec3d.dist(n,g)});I.sort(function(a,b){return A[b]-A[a]});for(var J=[],K=[],C=0;C<y;C++){var p=I[C],D=A[p],E=t[4*p+0],S=t[4*p+1],v=t[4*p+2],p=t[4*p+3],L=-1===p;c.getVec(E,n);c.getVec(S,g);if(L)d.vec3d.set3(q[3*v+0],q[3*v+1],q[3*v+2],x),d.vec3d.set(x,z),e.componentIndex=l.get(E),
e.cosAngle=d.vec3d.dot(x,z);else if(d.vec3d.set3(q[3*v+0],q[3*v+1],q[3*v+2],x),d.vec3d.set3(q[3*p+0],q[3*p+1],q[3*p+2],z),e.componentIndex=l.get(E),e.cosAngle=d.vec3d.dot(x,z),e.cosAngle>m)continue;G+=D;H++;L||e.cosAngle<h?(r.write(b,a++,e),J.push(D)):O(e,k)&&(f.write(u,w++,e),K.push(D))}l=new Float32Array(J.reverse());k=new Float32Array(K.reverse());return{regular:{instancesData:r.trim(b,a),lodInfo:{lengths:l}},silhouette:{instancesData:f.trim(u,w),lodInfo:{lengths:k}},averageEdgeLength:G/H}};var B=
{edge:{position0:d.vec3d.create(),position1:d.vec3d.create(),faceNormal0:d.vec3d.create(),faceNormal1:d.vec3d.create(),componentIndex:0,cosAngle:0},ortho:d.vec3d.create(),fwd:d.vec3d.create()},u={v0:d.vec3d.create(),v1:d.vec3d.create(),v2:d.vec3d.create()},R={anglePlanar:4,angleSignificantEdge:35}});