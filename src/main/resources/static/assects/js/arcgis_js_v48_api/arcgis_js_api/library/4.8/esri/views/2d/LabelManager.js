// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Handles ../../core/promiseUtils ../../core/throttle ../../core/accessorSupport/decorators ../../layers/support/TileInfo ./engine/webgl/collisions/CollisionEngine ./engine/webgl/collisions/LayerViewSorter ./tiling/TileInfoView".split(" "),function(d,g,h,e,k,l,m,n,c,p,q,r,t){Object.defineProperty(g,"__esModule",{value:!0});d=function(d){function b(a){a=d.call(this)||this;
a._handles=new l;a._applyVisivilityPassThrottled=n.throttle(a._applyVisivilityPass,64,a);a._previousResolution=Number.POSITIVE_INFINITY;a.lastUpdateId=-1;a.updateRequested=!1;a.view=null;return a}h(b,d);b.prototype.initialize=function(){var a=this;this._layerViewSorter=new r.default(function(f,b){a._getCollisionEngine().then(function(c){c.registerLayer(f.layer,b);(c=f.get("featuresView.tileRenderer"))&&c.forEachTile(function(b){b.isDirty=!0;a.addTile(f.layer.uid,b)});a.requestUpdate()})},function(b){a._getCollisionEngine().then(function(f){f.unregisterLayer(b.layer);
a.requestUpdate()})},function(a){(a=a.get("featuresView.tileRenderer.featuresView"))&&a.fadeInLabels()});this._handles.add(this.view.allLayerViews.on("change",function(b){a._layerViewSorter.update(b)}))};b.prototype.destroy=function(){this._layerViewSorter.destroy();this._collisionEngine=this._layerViewSorter=null;this._handles.removeAll()};Object.defineProperty(b.prototype,"updating",{get:function(){return this.updateRequested},enumerable:!0,configurable:!0});b.prototype.update=function(a){var b=
this._previousResolution,c=a.state.resolution;this._previousResolution=c;c===b&&(this._applyVisivilityPassThrottled(a),this.updateRequested=!1,this.notifyChange("updating"))};b.prototype.viewChange=function(){this.requestUpdate()};b.prototype.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate(this))};b.prototype.processUpdate=function(a){this._set("updateParameters",a);this.updateRequested&&(this.updateRequested=!1,this.update(a))};b.prototype.addTile=
function(a,b){this._collisionEngine.addTile(a,b)};b.prototype.removeTile=function(a,b){this._collisionEngine.removeTile(a,b)};b.prototype._getCollisionEngine=function(){var a=this;return this._collisionEngine?m.resolve(this._collisionEngine):this.view.when(function(){var b=p.create({spatialReference:a.view.spatialReference,size:512});a._tileInfoView=new t(b);a._collisionEngine=new q.default(b);return a._collisionEngine})};b.prototype._applyVisivilityPass=function(a){var b=this;this._getCollisionEngine().then(function(c){var d=
b._tileInfoView.getClosestInfoForScale(a.state.scale).level;c.run(a,d)})};e([c.property()],b.prototype,"updateRequested",void 0);e([c.property({readOnly:!0})],b.prototype,"updateParameters",void 0);e([c.property({dependsOn:["updateRequested"]})],b.prototype,"updating",null);e([c.property()],b.prototype,"view",void 0);return b=e([c.subclass("esri.views.2d.layers.labels.LabelManager")],b)}(c.declared(k));g.default=d});