// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports ./tsSupport/assignHelper dojo/io-query dojo/_base/url ../config ./Error ./global ./lang ./Logger ./sniff".split(" "),function(ha,d,U,A,n,V,W,X,B,Y,t){function u(a){var b={path:null,query:null},c=new n(a),e=a.indexOf("?");null===c.query?b.path=a:(b.path=a.substring(0,e),b.query=A.queryToObject(c.query));c.fragment&&(b.hash=c.fragment,null===c.query&&(b.path=b.path.substring(0,b.path.length-(c.fragment.length+1))));return b}function G(a,b){void 0===a&&(a=!1);void 0===b&&(b=!0);
var c,e=l.proxyUrl;if("string"===typeof a){if(c=H(a),a=v(a))e=a.proxyUrl}else c=!!a;if(!e)throw Z.warn("esri/config: esriConfig.request.proxyUrl is not set. If making a request to a CORS-enabled\n server, please push the domain into esriConfig.request.corsEnabledServers."),new W("urlutils:proxy-not-set","esri/config: esriConfig.request.proxyUrl is not set. If making a request to a CORS-enabled\n server, please push the domain into esriConfig.request.corsEnabledServers.");var d;c&&b&&t("esri-secure-context")&&
(b=C(e),w(b)&&(e=b,d=1));e=u(e);e._xo=d;return e}function D(a){var b=a.indexOf("?");-1!==b?(r.path=a.slice(0,b),r.query=a.slice(b+1)):(r.path=a,r.query=null);return r}function I(a){a=D(a).path;a&&"/"===a[a.length-1]||(a+="/");a=E(a,!0);return a=a.toLowerCase()}function v(a){var b=l.proxyRules;a=I(a);for(var c=0;c<b.length;c++)if(0===a.indexOf(b[c].urlPrefix))return b[c]}function J(a){a=p(a);var b=a.indexOf("/sharing");return 0<b?a.substring(0,b):a.replace(/\/+$/,"")}function x(a,b,c){void 0===c&&
(c=!1);a=F(a);b=F(b);return c||a.scheme===b.scheme?a.host.toLowerCase()===b.host.toLowerCase()&&a.port===b.port:!1}function w(a){return t("esri-phonegap")?!0:t("esri-cors")?null!=K(a):!1}function K(a,b){void 0===b&&(b=!1);"string"===typeof a&&(a=m(a)?F(a):d.appUrl);for(var c=l.corsEnabledServers||[],e=0;e<c.length;e++){var f=c[e],h=void 0,k=void 0;f instanceof RegExp?k=f:"string"===typeof f?h=L(f):f.host?f.host instanceof RegExp?k=f.host:h=L(f.host):h=[];if(k){if(k.test(a.uri))return b?e:f}else for(k=
0;k<h.length;k++)if(x(a,h[k]))return b?e:f}return b?-1:null}function L(a){d.corsServersUrlCache[a]||(y(a)||g(a)?d.corsServersUrlCache[a]=[new n(q(a))]:d.corsServersUrlCache[a]=[new n("http://"+a),new n("https://"+a)]);return d.corsServersUrlCache[a]}function q(a,b,c){void 0===b&&(b=d.appBaseUrl);if(g(a))return c&&c.preserveProtocolRelative?a:"http"===d.appUrl.scheme&&d.appUrl.authority===M(a).slice(2)?"http:"+a:"https:"+a;if(y(a))return a;c=N;if("/"===a[0]){var e=b.indexOf("//"),e=b.indexOf("/",e+
2);b=-1===e?b:b.slice(0,e)}return c(b,a)}function O(a,b,c){void 0===b&&(b=d.appBaseUrl);if(!m(a))return a;var e=p(a),f=e.toLowerCase();b=p(b).toLowerCase().replace(/\/+$/,"");if((c=c?p(c).toLowerCase().replace(/\/+$/,""):null)&&0!==b.indexOf(c))return a;for(var h=function(a,b,c){c=a.indexOf(b,c);return-1===c?a.length:c},k=h(f,"/",f.indexOf("//")+2),g=-1;f.slice(0,k+1)===b.slice(0,k)+"/";){g=k+1;if(k===f.length)break;k=h(f,"/",k+1)}if(-1===g||c&&g<c.length)return a;a=e.slice(g);e=b.slice(g-1).replace(/[^/]+/g,
"").length;if(0<e)for(f=0;f<e;f++)a="../"+a;else a="./"+a;return a}function p(a){a=a.trim();a=q(a);if(/^https?:\/\//i.test(a)){var b=D(a);a=b.path.replace(/\/{2,}/g,"/");a=a.replace("/","//");b.query&&(a+="?"+b.query)}a=a.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2");a="http"===d.appUrl.scheme&&H(a)&&x(d.appBaseUrl,a,!0)&&!w(a)?g(a)?"http:"+a:a.replace(P,"http:"):a;return a=aa(a)}function N(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];if(a&&a.length){b=[];if(m(a[0])){var c=a[0],
e=c.indexOf("//");b.push(c.slice(0,e+1));ba.test(a[0])&&(b[0]+="/");a[0]=c.slice(e+2)}else"/"===a[0][0]&&b.push("");a=a.reduce(function(a,b){return b?a.concat(b.split("/")):a},[]);for(c=0;c<a.length;c++)e=a[c],".."===e&&0<b.length?b.pop():!e||"."===e&&0!==b.length||b.push(e);return b.join("/")}}function M(a){if(Q(a)||R(a))return null;var b=a.indexOf("://");if(-1===b&&g(a))b=2;else if(-1!==b)b+=3;else return null;b=a.indexOf("/",b);return-1===b?a:a.slice(0,b)}function m(a){return g(a)||y(a)}function Q(a){return"blob:"===
a.slice(0,5)}function R(a){return"data:"===a.slice(0,5)}function g(a){return a&&"/"===a[0]&&"/"===a[1]}function y(a){return S.test(a)}function H(a){return P.test(a)||"https"===d.appUrl.scheme&&g(a)}function ca(a){return T.test(a)||"http"===d.appUrl.scheme&&g(a)}function C(a){return g(a)?"https:"+a:a.replace(T,"https:")}function E(a,b){void 0===b&&(b=!1);if(g(a))return a.slice(2);a=a.replace(S,"");b&&1<a.length&&"/"===a[0]&&"/"===a[1]&&(a=a.slice(2));return a}function aa(a){var b=l.httpsDomains;if(!ca(a))return a;
var c=a.indexOf("/",7),e;e=-1===c?a:a.slice(0,c);e=e.toLowerCase().slice(7);if(da.test(e))if(B.endsWith(e,":80"))e=e.slice(0,-3),a=a.replace(":80","");else return a;if(!("http"!==d.appUrl.scheme||e!==d.appUrl.authority||ea.test(a)&&w(a)))return a;if("https"===d.appUrl.scheme&&e===d.appUrl.authority||b&&b.some(function(a){return e===a||B.endsWith(e,"."+a)})||t("esri-secure-context")&&!l.forceProxy&&!v(a))a=C(a);return a}function z(a,b,c){if(!(b&&c&&a&&m(a)))return a;var e=a.indexOf("//"),d=a.indexOf("/",
e+2),h=a.indexOf(":",e+2),d=Math.min(0>d?a.length:d,0>h?a.length:h);if(a.slice(e+2,d).toLowerCase()!==b.toLowerCase())return a;b=a.slice(0,e+2);a=a.slice(d);return""+b+c+a}function F(a){if("string"===typeof a)return new n(q(a));a.scheme||(a.scheme=d.appUrl.scheme);return a}Object.defineProperty(d,"__esModule",{value:!0});var Z=Y.getLogger("esri.core.urlUtils"),l=V.request,S=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,T=/^\s*http:/i,P=/^\s*https:/i,ba=/^\s*file:/i,da=/:\d+$/,ea=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i;
d.appUrl=new n(X.location);d.corsServersUrlCache={};d.appBaseUrl=function(){var a=d.appUrl.path,a=a.substring(0,a.lastIndexOf(a.split("/")[a.split("/").length-1]));return""+(d.appUrl.scheme+"://"+d.appUrl.host+(null!=d.appUrl.port?":"+d.appUrl.port:""))+a}();d.urlToObject=u;d.getProxyUrl=G;d.addProxy=function(a){var b=v(a),c,e;b?(e=D(b.proxyUrl),c=e.path,e=e.query?A.queryToObject(e.query):null):l.forceProxy&&(e=G(),c=e.path,e=e.query);c&&(b=u(a),a=c+"?"+b.path,(c=A.objectToQuery(U({},e,b.query)))&&
(a=a+"?"+c));return a};var r={path:"",query:""};d.addProxyRule=function(a){a={proxyUrl:a.proxyUrl,urlPrefix:I(a.urlPrefix)};for(var b=l.proxyRules,c=a.urlPrefix,e=b.length,d=0;d<b.length;d++){var h=b[d].urlPrefix;if(0===c.indexOf(h)){if(c.length===h.length)return-1;e=d;break}0===h.indexOf(c)&&(e=d+1)}b.splice(e,0,a);return e};d.getProxyRule=v;d.hasSamePortal=function(a,b){a=J(a);b=J(b);return E(a)===E(b)};d.getInterceptor=function(a){var b=function(b){return null==b||b instanceof RegExp&&b.test(a)||
"string"===typeof b&&B.startsWith(a,b)},c=l.interceptors;if(c)for(var e=0;e<c.length;e++){var d=c[e];if(Array.isArray(d.urls)){if(d.urls.some(b))return d}else if(b(d.urls))return d}return null};d.hasSameOrigin=x;d.canUseXhr=w;d.getCorsConfig=K;d.makeAbsolute=q;d.makeRelative=O;d.normalize=p;d.join=N;d.getOrigin=M;d.isAbsolute=m;d.isBlobProtocol=Q;d.isDataProtocol=R;var fa=/^data:(.*?)(;base64)?,(.*)$/;d.dataComponents=function(a){return(a=a.match(fa))?{mediaType:a[1],isBase64:!!a[2],data:a[3]}:null};
d.makeData=function(a){return a.isBase64?"data:"+a.mediaType+";base64,"+a.data:"data:"+a.mediaType+","+a.data};d.isProtocolRelative=g;d.hasProtocol=y;d.toHTTPS=C;d.removeFile=function(a){var b=0;if(m(a)){var c=a.indexOf("//");-1!==c&&(b=c+2)}c=a.lastIndexOf("/");return c<b?a:a.slice(0,c+1)};d.removeTrailingSlash=function(a){return a.replace(/\/+$/,"")};d.changeDomain=z;d.read=function(a,b){var c=b&&b.url&&b.url.path;a&&c&&(a=q(a,c,{preserveProtocolRelative:!0}));(b=b&&b.portal)&&!b.isPortal&&b.urlKey&&
b.customBaseUrl?(c=b.urlKey+"."+b.customBaseUrl,b=x(d.appUrl,d.appUrl.scheme+"://"+c)?z(a,b.portalHostname,c):z(a,c,b.portalHostname)):b=a;return b};d.write=function(a,b){if(!a)return a;!m(a)&&b&&b.blockedRelativeUrls&&b.blockedRelativeUrls.push(a);var c=q(a);if(b){var d=b.verifyItemRelativeUrls&&b.verifyItemRelativeUrls.rootPath||b.url&&b.url.path;d&&(c=O(c,d,d),c!==a&&b.verifyItemRelativeUrls&&b.verifyItemRelativeUrls.writtenUrls.push(c))}a=c;c=(b=b&&b.portal)&&!b.isPortal&&b.urlKey&&b.customBaseUrl?
z(a,b.urlKey+"."+b.customBaseUrl,b.portalHostname):a;return c};d.writeOperationalLayerUrl=function(a,b){a&&g(a)&&(a="https:"+a);b.url=a?p(a):a};d.isSVG=function(a){return ga.test(a)};d.removeQueryParameters=function(a,b){a=u(a);var c=Object.keys(a.query||{});0<c.length&&b&&b.warn("removeQueryParameters()","Url query parameters are not supported, the following parameters have been removed: "+c.join(", ")+".");return a.path};var ga=/(^data:image\/svg|\.svg$)/i});