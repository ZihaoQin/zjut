// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ./drawUtils".split(" "),function(A,B,n,h,p,q,l,r,g,t){var u=function(){return function(f,c,b,a){this.graphic=f;this.index=c;this.screenPoint=b;this.viewEvent=a;this.type="graphic-click"}}(),v=function(){return function(f,c,b,a){this.graphic=
f;this.index=c;this.screenPoint=b;this.viewEvent=a;this.type="graphic-double-click"}}(),w=function(){function f(c,b,a,d,e,k){this.graphic=c;this.index=b;this.dx=a;this.dy=d;this.screenPoint=e;this.viewEvent=k;this.defaultPrevented=!1;this.type="graphic-move-start"}f.prototype.preventDefault=function(){this.defaultPrevented=!0};return f}(),x=function(){function f(c,b,a,d,e,k){this.graphic=c;this.index=b;this.dx=a;this.dy=d;this.screenPoint=e;this.viewEvent=k;this.defaultPrevented=!1;this.type="graphic-move"}
f.prototype.preventDefault=function(){this.defaultPrevented=!0};return f}(),y=function(){function f(c,b,a,d,e,k){this.graphic=c;this.index=b;this.dx=a;this.dy=d;this.screenPoint=e;this.viewEvent=k;this.defaultPrevented=!1;this.type="graphic-move-stop"}f.prototype.preventDefault=function(){this.defaultPrevented=!0};return f}(),z=function(){return function(f,c,b,a){this.graphic=f;this.index=c;this.screenPoint=b;this.viewEvent=a;this.type="graphic-pointer-over"}}(),m=function(){return function(f,c,b,
a){this.graphic=f;this.index=c;this.screenPoint=b;this.viewEvent=a;this.type="graphic-pointer-out"}}();return function(f){function c(b){b=f.call(this,b)||this;b._activeGraphic=null;b._dragEvent=null;b._handles=new l;b._hoverGraphic=null;b._initialDragGeometry=null;b._pointerDownEvent=null;b._viewHandles=new l;b.callbacks={onGraphicClick:function(a){},onGraphicDoubleClick:function(a){},onGraphicMoveStart:function(a){},onGraphicMove:function(a){},onGraphicMoveStop:function(a){},onGraphicPointerOver:function(a){},
onGraphicPointerOut:function(a){}};b.graphics=[];b.view=null;return b}n(c,f);c.prototype.initialize=function(){var b=this;this._handles.add([r.whenOnce(this,"view.ready",function(){b._viewHandles.add([b.view.on("click",function(a){return b._clickHandler(a)}),b.view.on("double-click",function(a){return b._doubleClickHandler(a)}),b.view.on("pointer-down",function(a){return b._pointerDownHandler(a)}),b.view.on("pointer-move",function(a){return b._pointerMoveHandler(a)}),b.view.on("pointer-up",function(a){return b._pointerUpHandler(a)}),
b.view.on("drag",function(a){return b._dragHandler(a)}),b.view.on("key-down",function(a){return b._keyDownHandler(a)})])})])};c.prototype.destroy=function(){this.reset();this._viewHandles.removeAll();this._handles.removeAll()};Object.defineProperty(c.prototype,"state",{get:function(){var b=!!this.get("view.ready"),a=!!this.get("graphics.length"),d=this._activeGraphic;return b&&a?d?"moving":"active":b?"ready":"disabled"},enumerable:!0,configurable:!0});c.prototype.reset=function(){this._dragEvent=
this._hoverGraphic=this._activeGraphic=null};c.prototype.updateGeometry=function(b,a){(b=this.graphics[b])&&b.set("geometry",a)};c.prototype._clickHandler=function(b){var a=this;this.view.hitTest(b).then(function(d){var e=d.results;e.length&&e[0].graphic&&(e=e[0].graphic,-1<a.graphics.indexOf(e)&&(d=new u(e,a.graphics.indexOf(e),d.screenPoint,b),a.emit("graphic-click",d),a.callbacks.onGraphicClick(d)))})};c.prototype._doubleClickHandler=function(b){var a=this;this.view.hitTest(b).then(function(d){var e=
d.results;e.length&&e[0].graphic&&(e=e[0].graphic,-1<a.graphics.indexOf(e)&&(d=new v(e,a.graphics.indexOf(e),d.screenPoint,b),a.emit("graphic-double-click",d),a.callbacks.onGraphicDoubleClick(d)))})};c.prototype._pointerDownHandler=function(b){var a=this;this._pointerDownEvent=b;this.view.hitTest(b).then(function(b){b=b.results;b.length&&b[0].graphic?(b=b[0].graphic,-1<a.graphics.indexOf(b)?a._activeGraphic=b:b!==a._activeGraphic&&(a._pointerDownEvent=null,a._activeGraphic=null)):(a._pointerDownEvent=
null,a._activeGraphic=null)})};c.prototype._pointerUpHandler=function(b){this._pointerDownEvent=null;this._dragEvent||(this._activeGraphic=null)};c.prototype._pointerMoveHandler=function(b){var a=this;this._dragEvent||this.view.hitTest(b).then(function(d){var e=d.results;if(e.length&&e[0].graphic){e=e[0].graphic;if(e===a._hoverGraphic)return;if(-1<a.graphics.indexOf(e)){if(a._hoverGraphic){var c=a.graphics.indexOf(a._hoverGraphic),c=new m(a.graphics[c],c,d.screenPoint,b);a._hoverGraphic=null;a.emit("graphic-pointer-out",
c);a.callbacks.onGraphicPointerOut(c)}c=a.graphics.indexOf(e);d=new z(e,c,d.screenPoint,b);a._hoverGraphic=e;a.emit("graphic-pointer-over",d);a.callbacks.onGraphicPointerOver(d);return}}a._hoverGraphic&&(c=a.graphics.indexOf(a._hoverGraphic),d=new m(a.graphics[c],c,d.screenPoint,b),a._hoverGraphic=null,a.emit("graphic-pointer-out",d),a.callbacks.onGraphicPointerOut(d))})};c.prototype._dragHandler=function(b){var a=this;this._pointerDownEvent&&(this._activeGraphic||this._hoverGraphic)&&b.stopPropagation();
this.view.hitTest(b).then(function(d){if(a._activeGraphic){var c=a.graphics.indexOf(a._activeGraphic),f=a._activeGraphic.geometry,g=a._dragEvent?b.x-a._dragEvent.x:0,h=a._dragEvent?b.y-a._dragEvent.y:0,l=f.clone();a._activeGraphic.set("geometry",t.move(l,g,h,a.view));a._dragEvent=b;"start"===b.action?(a._initialDragGeometry=f.clone(),d=new w(a._activeGraphic,c,g,h,d.screenPoint,b),a.emit("graphic-move-start",d),a.callbacks.onGraphicMoveStart(d),d.defaultPrevented&&a._activeGraphic.set("geometry",
f)):"update"===b.action?(d=new x(a._activeGraphic,c,g,h,d.screenPoint,b),a.emit("graphic-move",d),a.callbacks.onGraphicMove&&a.callbacks.onGraphicMove(d),d.defaultPrevented&&a._activeGraphic.set("geometry",f)):(a._activeGraphic=null,a._dragEvent=null,d=new y(a.graphics[c],c,g,h,d.screenPoint,b),a.emit("graphic-move-stop",d),a.callbacks.onGraphicMoveStop(d),d.defaultPrevented&&a.graphics[c].set("geometry",a._initialDragGeometry),a._initialDragGeometry=null)}})};c.prototype._keyDownHandler=function(b){"a"!==
b.key&&"d"!==b.key&&"n"!==b.key||"moving"!==this.state||b.stopPropagation()};h([g.property()],c.prototype,"_activeGraphic",void 0);h([g.property()],c.prototype,"callbacks",void 0);h([g.property()],c.prototype,"graphics",void 0);h([g.property({dependsOn:["view.ready","graphics.length","_activeGraphic"],readOnly:!0})],c.prototype,"state",null);h([g.property()],c.prototype,"view",void 0);return c=h([g.subclass("esri.views.2d.draw.support.GraphicMover")],c)}(g.declared(p,q))});