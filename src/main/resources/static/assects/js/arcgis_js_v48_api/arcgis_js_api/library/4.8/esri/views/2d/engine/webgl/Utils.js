// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports ../../../../arcade/Dictionary ../../../../arcade/Feature ../../../../core/Error ../../../../core/Logger ../../../../core/screenUtils ../../../../support/arcadeUtils ./color ./enums ./SymbolProperties".split(" "),function(m,a,B,C,q,D,r,t,u,c,E){function g(b){for(var a={},e=0;e<b.length;e++){var h=b[e];a[h.name]=h.strideInBytes}return a}function v(b){switch(b){case c.WGLGeometryType.MARKER:return F;case c.WGLGeometryType.FILL:return G;case c.WGLGeometryType.LINE:return H;case c.WGLGeometryType.TEXT:return I;
case c.WGLGeometryType.LABEL:return J}return null}function k(b){switch(b){case "esriSMS":return"simple-marker";case "esriPMS":return"picture-marker";case "esriSLS":return"simple-line";case "esriPLS":return"picture-line";case "esriSFS":return"simple-fill";case "esriPFS":return"picture-fill";case "esriTS":return"text"}return b}function w(b){if(b=k(b.type)){switch(b){case "simple-marker":case "picture-marker":return!0;case "CIMPointSymbol":return!0}return!1}}function x(b){if(b=k(b.type)){switch(b){case "simple-fill":case "picture-fill":return!0;
case "CIMPolygonSymbol":return!0}return!1}}function y(b){if(b=k(b.type)){switch(b){case "simple-line":case "picture-line":return!0;case "CIMLineSymbol":return!0}return!1}}function z(b){if(b=k(b.type)){switch(b){case "text":return!0;case "CIMTextSymbol":return!0}return!1}}function n(b){return b&&b.length||0}function A(b){return"string"===typeof b}Object.defineProperty(a,"__esModule",{value:!0});var l,p=D.getLogger("esri.views.2d.engine.webgl.Utils");a.C_HITTEST_SEARCH_SIZE=4;a.C_VBO_GEOMETRY="geometry";
a.C_VBO_PERINSTANCE="per_instance";a.C_VBO_PERINSTANCE_VV="per_instance_vv";a.C_VBO_VISIBILITY="visibility";a.C_VBO_VISIBILITY_RANGE="visibilityRange";a.C_ICON_VERTEX_DEF=[{name:a.C_VBO_GEOMETRY,strideInBytes:24,divisor:0}];a.C_ICON_VERTEX_DEF_VV=[{name:a.C_VBO_GEOMETRY,strideInBytes:40,divisor:0}];a.C_ICON_HEATMAP=[{name:a.C_VBO_GEOMETRY,strideInBytes:28,divisor:0}];a.C_FILL_VERTEX_DEF=[{name:a.C_VBO_GEOMETRY,strideInBytes:24,divisor:0}];a.C_FILL_VERTEX_DEF_VV=[{name:a.C_VBO_GEOMETRY,strideInBytes:32,
divisor:0}];a.C_LINE_VERTEX_DEF=[{name:a.C_VBO_GEOMETRY,strideInBytes:32,divisor:0}];a.C_LINE_VERTEX_DEF_VV=[{name:a.C_VBO_GEOMETRY,strideInBytes:44,divisor:0}];a.C_TEXT_VERTEX_DEF=[{name:a.C_VBO_GEOMETRY,strideInBytes:20,divisor:0},{name:a.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}];a.C_TEXT_VERTEX_DEF_VV=[{name:a.C_VBO_GEOMETRY,strideInBytes:36,divisor:0},{name:a.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}];a.C_LABEL_VERTEX_DEF=[{name:a.C_VBO_GEOMETRY,strideInBytes:20,divisor:0},{name:a.C_VBO_VISIBILITY,
strideInBytes:1,divisor:0},{name:a.C_VBO_VISIBILITY_RANGE,strideInBytes:2,divisor:0}];a.C_ICON_STRIDE_SPEC=g(a.C_ICON_VERTEX_DEF);a.C_ICON_STRIDE_SPEC_VV=g(a.C_ICON_VERTEX_DEF_VV);a.C_ICON_STRIDE_SPEC_HEATMAP=g(a.C_ICON_HEATMAP);a.C_FILL_STRIDE_SPEC=g(a.C_FILL_VERTEX_DEF);a.C_FILL_STRIDE_SPEC_VV=g(a.C_FILL_VERTEX_DEF_VV);a.C_LINE_STRIDE_SPEC=g(a.C_LINE_VERTEX_DEF);a.C_LINE_STRIDE_SPEC_VV=g(a.C_LINE_VERTEX_DEF_VV);a.C_TEXT_STRIDE_SPEC=g(a.C_TEXT_VERTEX_DEF);a.C_TEXT_STRIDE_SPEC_VV=g(a.C_TEXT_VERTEX_DEF_VV);
a.C_LABEL_STRIDE_SPEC=g(a.C_LABEL_VERTEX_DEF);a.getStrides=function(b,d,e){void 0===e&&(e=!1);switch(b){case c.WGLGeometryType.MARKER:return d?a.C_ICON_STRIDE_SPEC_VV:e?a.C_ICON_STRIDE_SPEC_HEATMAP:a.C_ICON_STRIDE_SPEC;case c.WGLGeometryType.FILL:return d?a.C_FILL_STRIDE_SPEC_VV:a.C_FILL_STRIDE_SPEC;case c.WGLGeometryType.LINE:return d?a.C_LINE_STRIDE_SPEC_VV:a.C_LINE_STRIDE_SPEC;case c.WGLGeometryType.TEXT:return d?a.C_TEXT_STRIDE_SPEC_VV:a.C_TEXT_STRIDE_SPEC;case c.WGLGeometryType.LABEL:return a.C_LABEL_STRIDE_SPEC}return null};
var F=[a.C_VBO_GEOMETRY],G=[a.C_VBO_GEOMETRY],H=[a.C_VBO_GEOMETRY],I=[a.C_VBO_GEOMETRY,a.C_VBO_VISIBILITY],J=[a.C_VBO_GEOMETRY,a.C_VBO_VISIBILITY,a.C_VBO_VISIBILITY_RANGE];a.getNamedBuffers=v;a.getSymbolGeometryType=function(b){return w(b)?c.WGLGeometryType.MARKER:y(b)?c.WGLGeometryType.LINE:x(b)?c.WGLGeometryType.FILL:z(b)?c.WGLGeometryType.TEXT:c.WGLGeometryType.UNKNOWN};a.normalizeSymbolType=k;a.isMarkerSymbol=w;a.isFillSymbol=x;a.isLineSymbol=y;a.isPictureSymbol=function(b){if(b=k(b.type))switch(b){case "picture-marker":case "picture-line":case "picture-fill":return!0}return!1};
a.isTextSymbol=z;a.getTextProperties=function(b){return E.TextProperties.pool.acquire(b.color?u.copyAndPremultiply(b.color):[255,255,255,255],b.haloColor?u.copyAndPremultiply(b.haloColor):[255,255,255,255],r.pt2px(b.haloSize),r.pt2px(b.font.size),b.angle*Math.PI/180,b.xoffset/b.font.size,b.yoffset/b.font.size,"left"===b.horizontalAlignment?0:"right"===b.horizontalAlignment?1:.5,"top"===b.verticalAlignment?0:"bottom"===b.verticalAlignment?1:.5)};a.isSameUniformValue=function(b,a){return!1};a.isSameMaterialInfo=
function(b,a){if(b.materialKey!==a.materialKey||n(b.texBindingInfo)!==n(a.texBindingInfo)||n(b.materialParams)!==n(a.materialParams))return!1;for(var d=b.texBindingInfo.length,h=0;h<d;++h){var c=b.texBindingInfo[h],f=a.texBindingInfo[h];if(c.unit!==f.unit||c.pageId!==f.pageId||c.semantic!==f.semantic)return!1}b=b.materialParams.length;for(h=0;h<b;)return!1;return!0};a.serializeString=function(a,c,e){for(var b=0,d=a.length,f=0;f<d;++f)c&&(c[e+b]=a.charCodeAt(f)),++b;c&&(c[e+b]=0);++b;return b};a.deserializeString=
function(a,c,e){var b=0;a.s="";for(var d=!0;d;){var f=c[e+b];++b;0!==f?a.s+=String.fromCharCode(f):d=!1}return b};a.isDefined=function(a){return null!==a&&void 0!==a};a.isNumber=function(a){return"number"===typeof a};a.isString=A;a.isStringOrNull=function(a){return null==a||A(a)};a.lerp=function(a,c,e){return a+(c-a)*e};m=function(){function a(){this._arr=[];this._push=this._push.bind(this)}a.prototype._push=function(a,b){this._arr.push(b)};a.prototype.getKeys=function(a){this._arr.length=0;a&&a.forEach(this._push);
return this._arr};return a}();a.KeysGetter=m;m=function(){function a(){this._arr=[];this._push=this._push.bind(this)}a.prototype._push=function(a,b){this._arr.push(a)};a.prototype.getValues=function(a){this._arr.length=0;a&&a.forEach(this._push);return this._arr};return a}();a.ValuesGetter=m;a.getCapType=function(a){switch(a){case "butt":return c.CapType.BUTT;case "round":return c.CapType.ROUND;case "square":return c.CapType.SQUARE;default:return p.error(new q("mapview-invalid-type","Cap type "+a+
" is not a valid option. Defaulting to round")),c.CapType.ROUND}};a.getJoinType=function(a){switch(a){case "miter":return c.JoinType.MITER;case "bevel":return c.JoinType.BEVEL;case "round":return c.JoinType.ROUND;default:return p.error(new q("mapview-invalid-type","Join type "+a+" is not a valid option. Defaulting to round")),c.JoinType.ROUND}};a.getVVType=function(a){switch(a){case "opacity":return c.VVType.OPACITY;case "color":return c.VVType.COLOR;case "rotation":return c.VVType.ROTATION;case "size":return c.VVType.SIZE;
default:return p.error("Cannot interpret unknown vv: "+a),null}};a.createArcadeFunction=function(a,c){var b=a.spatialReference,h=a.layer,d=t.createFunction(a.valueExpression),f=new C;return function(a,e){f.repurposeFromGraphicLikeObject(a.geometry,a.attributes,h);a=e&&new B({viewingMode:e.viewingMode,scale:e.scale});a=t.executeFunction(d,{vars:{$feature:f,$view:a||{}},spatialReference:b});return c?c(a):a}};a.copyMeshData=function(a,c,e,h,g,f,k){for(var b in f)for(var d=f[b].stride,l=f[b].data,m=e[b].data,
n=d*g.vertexCount/4,p=d*a/4,q=d*g.vertexFrom/4,d=0;d<n;++d)m[d+p]=l[d+q];e=g.indexCount;for(d=0;d<e;++d)h[d+c]=k[d+g.indexFrom]-g.vertexFrom+a};a.C_VBO_INFO=(l={},l[a.C_VBO_GEOMETRY]=35044,l[a.C_VBO_VISIBILITY]=35044,l[a.C_VBO_VISIBILITY_RANGE]=35048,l);a.createGeometryData=function(a,c){for(var b=[],d=0;5>d;++d){for(var g={},f=0,k=v(d);f<k.length;f++){var l=k[f];g[l]={data:c(d,l)}}b.push({data:a(d),buffers:g})}return b}});