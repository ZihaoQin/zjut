// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/i18n!../../../nls/common dojo/i18n!../../Legend/nls/Legend dojox/gfx ../../../core/lang ../../../core/accessorSupport/decorators ../../Widget ./common ../../Legend/support/styleUtils ../../support/colorUtils ../../support/widget".split(" "),function(M,N,G,w,H,D,y,I,v,J,K,x,L,e){return function(E){function f(a){a=E.call(this)||this;a._hasIndicators=!1;a._selectedSectionName=null;a._sectionNames=
[];a._sectionMap=new Map;a.activeLayerInfos=null;a.view=null;return a}G(f,E);f.prototype.render=function(){var a=this;this._sectionNames.length=0;this._hasIndicators=768>=this.view.container.clientWidth;var d=this.activeLayerInfos,d=d&&d.toArray().map(function(b){return a._renderLegendForLayer(b)}).filter(function(a){return!!a});this._hasIndicators?this._selectedSectionName&&-1!==this._sectionNames.indexOf(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):
this._selectedSectionName=null;var g=this._sectionNames.length,b=this._sectionNames.map(function(b,c){var d;c=I.substitute({index:c+1,total:g},H.pagination.pageText);return e.tsx("div",{key:b,"aria-label":c,title:c,tabIndex:0,onclick:a._selectSection,onkeydown:a._selectSection,bind:a,class:a.classes("esri-legend--card__carousel-indicator",(d={},d["esri-legend--card__carousel-indicator--activated"]=a._selectedSectionName===b,d)),"data-section-name":b})}),b=this._hasIndicators?e.tsx("div",{class:"esri-legend--card__carousel-indicator-container",
key:"carousel-navigation"},b):null,d=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):d&&d.length?d:null;return e.tsx("div",{class:"esri-legend--card esri-widget"},b,d?d:e.tsx("div",{class:"esri-legend--card__message"},D.noLegend))};f.prototype._selectSection=function(a){if(a=a.target.getAttribute("data-section-name"))this._selectedSectionName=a};f.prototype._renderLegendForLayer=function(a){var d=this,g;if(!a.ready)return null;var b="esri-legend--card__"+a.layer.uid+"-version-"+
a.version;if(a.children.length)return g=a.children.map(function(a){return d._renderLegendForLayer(a)}).toArray(),this._sectionNames.push(b),e.tsx("div",{key:a.layer.uid,class:this.classes("esri-legend--card__service","esri-legend--card__group-layer")},e.tsx("div",{class:"esri-legend--card__service-caption-container"},a.title),g);if((b=a.legendElements)&&!b.length)return null;var n=b.some(function(a){return"relationship-ramp"===a.type}),b=b.map(function(b){return d._renderLegendForElement(b,a.layer,
n)}).filter(function(a){return!!a});if(!b.length)return null;var c=(g={},g["esri-legend--card__group-layer-child"]=!!a.parent,g);return e.tsx("div",{key:a.layer.uid,class:this.classes("esri-legend--card__service",c)},e.tsx("div",{class:"esri-legend--card__service-caption-container"},e.tsx("div",{class:"esri-legend--card__service-caption-text"},a.title)),e.tsx("div",{class:"esri-legend--card__service-content"},b))};f.prototype._renderLegendForElement=function(a,d,g){var b=this;void 0===g&&(g=!1);var n,
c="color-ramp"===a.type,k="opacity-ramp"===a.type,p="size-ramp"===a.type,q=a.title,r=null;"string"===typeof q?r=q:q&&(r=x.getTitle(q,c||k),r=q.title?q.title+" ("+r+")":r);q="esri-legend--card__"+d.uid+"-type-"+a.type;r=this._hasIndicators?e.tsx("div",null,e.tsx("h3",{class:this.classes("esri-widget__header","esri-legend--card__carousel-title")},d.title),e.tsx("h4",{class:this.classes("esri-widget__header","esri-legend--card__layer-caption")},r)):r?e.tsx("h4",{class:this.classes("esri-widget__header",
"esri-legend--card__layer-caption")},r):null;c=null;"symbol-table"===a.type?(p=a.infos.map(function(c){return b._renderLegendForElementInfo(c,d,a.legendType)}).filter(function(a){return!!a}),p.length&&(c=p[0].properties.classes&&p[0].properties.classes["esri-legend--card__symbol-row"],g=(n={},n["esri-legend--card__label-container"]=!c&&!g,n["esri-legend--card__relationship-label-container"]=g,n),c=e.tsx("div",{key:q,class:"esri-legend--card__section"},r,e.tsx("div",{class:this.classes(g)},p)))):"color-ramp"===
a.type||"opacity-ramp"===a.type||"heatmap-ramp"===a.type?c=e.tsx("div",{key:q,class:"esri-legend--card__section"},r,this._renderLegendForRamp(a)):p?c=e.tsx("div",{key:q,class:"esri-legend--card__section"},r,this._renderSizeRamps(a.infos)):"relationship-ramp"===a.type&&(c=e.tsx("div",{key:q,class:this.classes("esri-legend--card__section","esri-legend--card__relationship-section")},r,K.renderRelationshipRamp(a,this.id)));if(!c)return null;this._sectionNames.push(q);this._sectionMap.set(q,c);return c};
f.prototype._renderLegendForElementInfo=function(a,d,g){var b,n,c;if(a.type)return this._renderLegendForElement(a,d);g=x.isImageryStretchedLegend(d,g);if(a.symbol&&a.preview){if(-1===a.symbol.type.indexOf("simple-fill")){if(!a.label)return e.tsx("div",{bind:a.preview,afterCreate:x.attachToNode});d=(b={},b["esri-legend--card__symbol-cell"]=this._hasIndicators,b);return e.tsx("div",{class:this.classes("esri-legend--card__layer-row",(n={},n["esri-legend--card__symbol-row"]=this._hasIndicators,n))},e.tsx("div",
{class:this.classes(d),bind:a.preview,afterCreate:x.attachToNode}),e.tsx("div",{class:this.classes("esri-legend--card__image-label",(c={},c["esri-legend--card__label-cell"]=this._hasIndicators,c))},x.getTitle(a.label,!1)||""))}c=n=b=255;d=0;var k=g=255,p=255,q=0,r=a.symbol.color&&a.symbol.color.a,h=a.symbol.outline&&a.symbol.outline.color.a;r&&(b=a.symbol.color.r,n=a.symbol.color.g,c=a.symbol.color.b,d=a.symbol.color.a);h&&(g=a.symbol.outline.color.r,k=a.symbol.outline.color.g,p=a.symbol.outline.color.b,
q=a.symbol.outline.color.a);var F=L.isBright(a.symbol.color),f=F?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)";return e.tsx("div",{class:"esri-legend--card__layer-row"},e.tsx("div",{key:a.label,class:"esri-legend--card__label-element",styles:{background:r?"rgba("+b+", "+n+", "+c+", "+d+")":"none",color:F?"black":"white",textShadow:"-1px -1px 0 "+f+",\n                                              1px -1px 0 "+f+",\n                                              -1px 1px 0 "+f+",\n                                              1px 1px 0 "+
f,border:h?"1px solid rgba("+g+", "+k+", "+p+", "+q+")":"none"}}," ",a.label," "))}if(a.src)return b=this._renderImage(a,d,g),e.tsx("div",{class:"esri-legend--card__layer-row"},b,e.tsx("div",{class:"esri-legend--card__image-label"},a.label||""))};f.prototype._renderImage=function(a,d,g){var b,n=a.label,c=a.src,k=a.opacity;g=(b={},b["esri-legend--card__imagery-layer-image--stretched"]=g,b["esri-legend--card__symbol"]=!g,b);d={opacity:""+(null!=k?k:d.opacity)};return e.tsx("img",{alt:n,src:c,border:0,
width:a.width,height:a.height,class:this.classes(g),styles:d})};f.prototype._renderSizeRamps=function(a){var d,g=document.createElement("div"),b,n=a[a.length-1].symbol.color,c,k,p=a[0].label,q=a[a.length-1].label,r=a[0].symbol.style&&"circle"===a[0].symbol.style;try{if(this._hasIndicators)if(k=100,r){var h=a[0].symbol.size/2,f=a[a.length-1].symbol.size/2;c=2*h;var z=k-h-f,w=Math.sqrt(Math.pow(z,2)-Math.pow(h-f,2)),t=h*w/z,v=h+t,A=h+Math.sqrt(Math.pow(h,2)-Math.pow(t,2)),u=f*t/h,B=h+u,C=k-(f-Math.sqrt(Math.pow(f,
2)-Math.pow(u,2))),t=h-t,u=h-u;b=y.createSurface(g,c,k);b.createCircle({cx:h,cy:h,r:h}).setFill(n).setStroke({color:"#ddd",width:1});b.createCircle({cx:h,cy:k-f,r:f}).setFill(n).setStroke({color:"#ddd",width:1});b.createLine({x1:v,y1:A,x2:B,y2:C}).setStroke({color:"#ddd",width:1});b.createLine({x1:t,y1:A,x2:u,y2:C}).setStroke({color:"#ddd",width:1})}else{var l=Math.max(a[0].symbol.height,a[0].symbol.width),m=Math.max(a[a.length-1].symbol.height,a[a.length-1].symbol.width);c=l;b=y.createSurface(g,
c,k);b.createRect({x:0,y:0,height:l,width:l}).setStroke({color:"#ddd",width:1});b.createRect({x:l/2-m/2,y:k-m,height:m,width:m}).setStroke({color:"#ddd",width:1});b.createImage({src:a[0].symbol.url,height:l,width:l});b.createImage({src:a[a.length-1].symbol.url,height:m,width:m,y:k-m,x:l/2-m/2});b.createLine({x1:0,y1:l,x2:l/2-m/2,y2:k-m}).setStroke({color:"#ddd",width:1});b.createLine({x1:c,y1:l,x2:l/2+m/2,y2:k-m}).setStroke({color:"#ddd",width:1})}else c=180,r?(h=a[0].symbol.size/2,f=a[a.length-1].symbol.size/
2,k=2*h,z=c-h-f,w=Math.sqrt(Math.pow(z,2)-Math.pow(h-f,2)),t=h*w/z,A=h-t,v=c-(h+Math.sqrt(Math.pow(h,2)-Math.pow(t,2))),u=f*t/h,C=h-u,B=f-Math.sqrt(Math.pow(f,2)-Math.pow(u,2)),t=h+t,u=h+u,b=y.createSurface(g,c,k),b.createCircle({cx:c-h,cy:h,r:h}).setFill(n).setStroke({color:"#ddd",width:1}),b.createCircle({cx:f,cy:h,r:f}).setFill(n).setStroke({color:"#ddd",width:1}),b.createLine({x1:v,y1:A,x2:B,y2:C}).setStroke({color:"#ddd",width:1}),b.createLine({x1:v,y1:t,x2:B,y2:u}).setStroke({color:"#ddd",width:1})):
(l=Math.max(a[0].symbol.height,a[0].symbol.width),m=Math.max(a[a.length-1].symbol.height,a[a.length-1].symbol.width),b=y.createSurface(g,c,l),b.createRect({x:0,y:l/2-m/2,height:m,width:m}).setStroke({color:"#ddd",width:1}),b.createRect({x:c-l,y:0,height:l,width:l}).setStroke({color:"#ddd",width:1}),b.createImage({src:a[a.length-1].symbol.url,height:m,width:m,y:l/2-m/2}),b.createImage({src:a[0].symbol.url,height:l,width:l,x:c-l}),b.createLine({x1:m,y1:l/2-m/2,x2:c-l,y2:0}).setStroke({color:"#ddd",
width:1}),b.createLine({x1:m,y1:l/2+m/2,x2:c-l,y2:l}).setStroke({color:"#ddd",width:1})),n=p,p=q,q=n}catch(O){b.clear(),b.destroy()}return b?e.tsx("div",{class:this.classes("esri-legend--card__layer-row",(d={},d["esri-legend--card__size-ramp-row"]=this._hasIndicators,d))},e.tsx("div",{class:"esri-legend--card__ramp-label"},p),e.tsx("div",{class:"esri-legend--card__size-ramp-container"},e.tsx("div",{bind:g,afterCreate:x.attachToNode})),e.tsx("div",{class:"esri-legend--card__ramp-label"},q)):null};
f.prototype._renderLegendForRamp=function(a){var d=a.infos,g="heatmap-ramp"===a.type,b=d.length-1,f=2<b&&!g?25*b:100,c=f+20;a=document.createElement("div");a.style.width=c+"px";var k=y.createSurface(a,c,25),p=d.slice(0).reverse();try{p.forEach(function(a,c){a.offset=g?a.ratio:c/b}),g||k.createPath("M0 12.5 L10 0 L10 25 Z").setFill(p[0].color).setStroke(null),k.createRect({x:10,y:0,width:f,height:25}).setFill({type:"linear",x1:10,y1:0,x2:f+10,y2:0,colors:p}).setStroke(null),g||k.createPath("M"+(f+
10)+" 0 L"+c+" 12.5 L"+(f+10)+" 25 Z").setFill(p[p.length-1].color).setStroke(null)}catch(q){k.clear(),k.destroy()}if(!k)return null;f=p.filter(function(a,b){return!!a.label&&0!==b&&b!==p.length-1}).map(function(a){return e.tsx("div",{class:"esri-legend--card__interval-separators-container"},e.tsx("div",{class:"esri-legend--card__interval-separator"},"|"),e.tsx("div",{class:"esri-legend--card__ramp-label"},a.label))});c=d[d.length-1].label;d=d[0].label;return e.tsx("div",{class:"esri-legend--card__layer-row"},
e.tsx("div",{class:"esri-legend--card__ramp-label"},g?D[c]:c),e.tsx("div",{class:"esri-legend--card__symbol-container"},e.tsx("div",{bind:a,afterCreate:x.attachToNode}),f),e.tsx("div",{class:"esri-legend--card__ramp-label"},g?D[d]:d))};w([e.renderable(),v.property()],f.prototype,"activeLayerInfos",void 0);w([v.property()],f.prototype,"view",void 0);w([e.accessibleHandler()],f.prototype,"_selectSection",null);return f=w([v.subclass("esri.widgets.Legend.styles.Card")],f)}(v.declared(J))});