// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
require({cache:{"esri/widgets/Search/SearchResultRenderer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/i18n!./nls/Search ../../core/accessorSupport/decorators ../Widget ./SearchViewModel ../support/widget".split(" "),function(A,r,w,a,q,n,c,x,g){return function(c){function p(a){a=c.call(this)||this;a.showMoreResultsOpen=!1;a.viewModel=null;return a}w(p,c);p.prototype.render=function(){var a=this,b,c=this.get("viewModel.selectedResult"),
e=this.get("viewModel.results"),c=c&&c.name||"",v=1<this._countResults(e),h=v&&e.map(function(b){return a._moreResultsList(b)}),e=v?g.tsx("div",{key:"esri-search-renderer__more-results-button",class:"esri-search-result-renderer__more-results-item"},g.tsx("a",{class:"esri-widget__anchor",href:"#",bind:this,onclick:this._showMoreResultsClick,onkeydown:this._showMoreResultsClick},this.showMoreResultsOpen?q.hideMoreResults:q.showMoreResults)):null,v=v?g.tsx("div",{key:"esri-search-renderer__more-results-container",
class:"esri-search-result-renderer__more-results-list"},h):null,h=(b={},b["esri-search-result-renderer__more-results--show-more-results"]=this.showMoreResultsOpen,b);return g.tsx("div",{class:"esri-search-result-renderer esri-widget"},g.tsx("div",{key:"esri-search-renderer__container",class:this.classes("esri-search-result-renderer__more-results",h)},g.tsx("div",{key:"esri-search-renderer__result-name",class:"esri-search-result-renderer__more-results-item"},c),g.tsx("div",{key:"esri-search-renderer__more-results"},
e,v)))};p.prototype._showMoreResultsClick=function(a){a.preventDefault();this.showMoreResultsOpen=!this.showMoreResultsOpen;(a=this.get("viewModel.view.popup"))&&a.reposition()};p.prototype._selectResultClick=function(a){a.preventDefault();a=a.currentTarget["data-result"];this.viewModel&&this.viewModel.select(a)};p.prototype._moreResultsList=function(a){var b=this,c=a.results,e=c.length,v=!!e,h=this.get("viewModel.selectedResult"),e=1===e&&c[0]===h,h=this._getSourceName(a.source,a.sourceIndex),h=
1<this.get("viewModel.results").length&&!e?g.tsx("div",{key:"esri-search-result-renderer__header-"+a.sourceIndex,class:"esri-search-result-renderer__more-results-list-header"},h):null,c=v&&c.map(function(a,c){return b._moreResultsListItem(a,c)}),c=v&&!e?g.tsx("ul",{key:"esri-search-result-renderer__list-"+a.sourceIndex},c):null;return v?g.tsx("div",{key:"esri-search-result-renderer__results-"+a.sourceIndex},h,c):null};p.prototype._moreResultsListItem=function(a,b){var c=this.get("viewModel.selectedResult");
return a!==c?g.tsx("li",{key:"esri-search-result-renderer__list-item-"+b},g.tsx("a",{class:"esri-widget__anchor",href:"#",tabindex:"0",bind:this,"data-result":a,onclick:this._selectResultClick,onkeydown:this._selectResultClick},a.name)):null};p.prototype._getSourceName=function(a,b){return b===x.ALL_INDEX?q.all:a.name};p.prototype._countResults=function(a){return a?a.reduce(function(a,c){return a+c.results.length},0):0};a([g.renderable(),n.property()],p.prototype,"showMoreResultsOpen",void 0);a([n.property(),
g.renderable(["viewModel.results","viewModel.selectedResult"])],p.prototype,"viewModel",void 0);a([g.accessibleHandler()],p.prototype,"_showMoreResultsClick",null);a([g.accessibleHandler()],p.prototype,"_selectResultClick",null);return p=a([n.subclass("esri.widgets.Search.SearchResultRenderer")],p)}(n.declared(c))})},"esri/widgets/Search/SearchViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/has dojo/i18n!./nls/Search ../../Graphic ../../PopupTemplate ../../core/Accessor ../../core/Collection ../../core/Error ../../core/Evented ../../core/geolocationUtils ../../core/Handles ../../core/Logger ../../core/promiseUtils ../../core/requireUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../../geometry/Point ../../geometry/SpatialReference ../../portal/Portal ../../styles/basic ../../symbols/PictureMarkerSymbol ../../symbols/SimpleFillSymbol ../../symbols/SimpleLineSymbol ../../symbols/SimpleMarkerSymbol ../../symbols/TextSymbol ./FeatureLayerSearchSource ./LocatorSearchSource ./SearchSource ./support/geometryUtils ./support/locatorUtils ../support/GoTo".split(" "),
function(A,r,w,a,q,n,c,x,g,y,p,l,b,z,e,v,h,E,t,m,k,F,C,D,H,N,P,Q,J,L,R,M,S,O){function B(a,f){return a.hasOwnProperty(f)&&null!=a[f]&&""!==a[f]}var G=e.getLogger("esri.widgets.Search.SearchViewModel"),I=y.ofType({key:function(a){return a.featureLayer?"feature-layer":"locator"},base:R,typeMap:{"feature-layer":J,locator:L}}),K=k.WGS84,T=/<(?:.|\s)*?>/g;return function(k){function f(d){d=k.call(this)||this;d._handles=new z;d._gotoPromise=null;d._popupTemplate=new x({title:n.searchResult,content:"{Match_addr}"});
d._searching=null;d._loadingDefaultSources=null;d.activeSourceIndex=0;d.allPlaceholder=n.allPlaceholder;d.autoNavigate=!0;d.autoSelect=!0;d.defaultSources=new I;d.defaultSymbol=new D({url:A.toUrl(q("trident")?"../../images/search/search-symbol-32.png":"../../images/search/search-symbol-32.svg"),size:24,width:24,height:24});d.includeDefaultSources=!0;d.locationToAddressDistance=1500;d.maxInputLength=128;d.maxResults=6;d.maxSuggestions=6;d.minSuggestCharacters=1;d.popupOpenOnSelect=!0;d.popupTemplate=
null;d.popupEnabled=!0;d.portal=F.getDefault();d.resultGraphicEnabled=!0;d.resultGraphic=null;d.results=null;d.selectedSuggestion=null;d.searchAllEnabled=!0;d.selectedResult=null;d.sources=new I;d.suggestionDelay=150;d.suggestions=null;d.suggestionsEnabled=!0;d.view=null;return d}w(f,k);f.prototype.initialize=function(){var d=this;this._handles.add([E.init(this,"searchAllEnabled",function(){return d._setDefaultActiveSourceIndex()}),E.init(this,"portal",function(d){d&&!d.loaded&&d.load()}),E.init(this,
["view","portal","includeDefaultSources"],function(){return d._loadDefaultSources()}),E.on(this,["defaultSources","sources"],"change",function(){return d.notifyChange("allSources")}),E.on(this,"allSources","change",function(a){return d._allSourcesChanged(a)})])};f.prototype.destroy=function(){this.clearGraphics();this._cancelLoadingDefaultSources();this._clearLoadingDefaultSources();this._handles.destroy();this._handles=null};Object.defineProperty(f.prototype,"activeSource",{get:function(){return this.allSources.getItemAt(this.activeSourceIndex)||
null},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"allSources",{get:function(){var d=this.sources,a=this.defaultSources,f=this.includeDefaultSources,d="function"===typeof f?f.call(null,{sources:d,defaultSources:a}):f?a.concat(d):d,b=this._get("allSources")||new I;b.removeAll();d.filter(Boolean).forEach(function(d){return b.add(d)});return b},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"locationEnabled",{get:function(){return this._get("locationEnabled")||
b.supported()},set:function(d){if(void 0===d)this._clearOverride("locationEnabled");else{var a=b.supported();if(d&&!a){var f=new p("locationEnabled:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});G.error(f)}this._override("locationEnabled",d&&a)}},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"placeholder",{get:function(){var d=this.activeSourceIndex,a=this.allPlaceholder,a=void 0===a?n.allPlaceholder:a;return-1===d?a:(d=this.allSources.getItemAt(d))?
d.placeholder:""},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"popup",{get:function(){return this.get("view.popup")||null},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"searchTerm",{get:function(){return this._get("searchTerm")||""},set:function(d){this._set("searchTerm",d||"");this.clearGraphics();this.selectedSuggestion&&this.selectedSuggestion.text!==d&&this._set("selectedSuggestion",null);""===d&&this._clear()},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,
"state",{get:function(){return this._searching?"searching":this._loadingDefaultSources?"loading":0===this.allSources.length?"disabled":"ready"},enumerable:!0,configurable:!0});f.prototype.clear=function(){this.searchTerm=""};f.prototype.clearGraphics=function(){this._closePopup();this.view&&this.view.graphics.remove(this.resultGraphic);this._set("resultGraphic",null)};f.prototype.search=function(d){var a=this;this.emit("search-start");this.clearGraphics();var f=this._createSuggestionForSearch(d);
this._searching=d=this._loadDefaultSources().then(function(){return a._getResultsFromSources(f).then(function(d){var b={activeSourceIndex:a.activeSourceIndex,searchTerm:f.text,numResults:0,numErrors:0,errors:[],results:[]};a._formatResponse(b,d,f);d=a._getFirstResult(b.results);var k=(f.location&&d?d.name:f.text).replace(T,"");a._set("searchTerm",k);(f.key&&"number"===typeof f.sourceIndex||f.location)&&a._set("selectedSuggestion",f);a._set("results",b.results);a.emit("search-complete",b);return a._selectFirstResult(d).then(function(){return b})})});
this.notifyChange("state");d.then(function(){return a._clearSearching()}).catch(function(){return a._clearSearching()});return d};f.prototype.searchNearby=function(){var d=this;if(!this.locationEnabled){var a=new p("searchNearby:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});G.error(a);return v.reject(a)}this._searching=a=b.getCurrentPosition().then(function(a){return b.positionToPoint(a,d.view).then(function(a){return d.search(a)})});this.notifyChange("state");
a.then(function(){return d._clearSearching()}).catch(function(){return d._clearSearching()});return a};f.prototype.select=function(d){var a=this;this.clearGraphics();if(!d){var f=new p("select:missing-parameter","Cannot select without a searchResult.",{searchResult:d});G.error(f);return v.reject(f)}var b=this.view,k=B(d,"sourceIndex")?d.sourceIndex:this._getSourceIndexOfResult(d),h=this.allSources.getItemAt(k);if(!h)return f=new p("select:missing-source","Cannot select without a source.",{source:h}),
G.error(f),v.reject(f);var f=h instanceof J?this._getSourcePopupTemplate(h):null,C=h.resultSymbol||this._getDefaultSymbol(d),e=B(h,"resultGraphicEnabled")?h.resultGraphicEnabled:this.resultGraphicEnabled,F=B(h,"autoNavigate")?h.autoNavigate:this.autoNavigate,l=B(h,"popupOpenOnSelect")?h.popupOpenOnSelect:this.popupOpenOnSelect,m=B(h,"popupEnabled")?h.popupEnabled:this.popupEnabled,g=m?f||this.popupTemplate||this._popupTemplate:null,f=d.feature,z=this.popup;if(!f)return f=new p("select:missing-feature",
"Cannot select without a feature.",{feature:f}),G.error(f),v.reject(f);var E=f.attributes,D=f.geometry,n=f.sourceLayer,f=M.getPointFromGeometry(D);return(b&&f?M.getPointWithElevation(f,b):v.resolve(f)).then(function(f){C instanceof Q&&(C.text=d.name);var U=new c({geometry:D,symbol:C,attributes:E,sourceLayer:n,popupTemplate:g});return(b&&F?a._goToSearchResult(b,d.extent):v.resolve()).then(function(){a._gotoPromise=null;e&&b&&b.graphics.push(U);z&&m&&l&&z.open({features:[U],location:f});a._set("selectedResult",
d);a._set("resultGraphic",U);a.emit("select-result",{result:d,source:h,sourceIndex:k});return d})})};f.prototype.suggest=function(d,a){var f=this,b=d||this.searchTerm;this.emit("suggest-start",{searchTerm:b});return this._suggestTimer(a).then(function(){return f._suggestImmediate(b).then(function(d){f._set("suggestions",d.results);f.emit("suggest-complete",d);return d})})};f.prototype._cancelLoadingDefaultSources=function(){var d=this._loadingDefaultSources;d&&d.cancel()};f.prototype._clearLoadingDefaultSources=
function(){this._loadingDefaultSources=null;this.notifyChange("state")};f.prototype._clearSearching=function(){this._searching=null;this.notifyChange("state")};f.prototype._convertHelperServices=function(){var d=this.get("portal.helperServices.geocode");return d?d.map(function(d){if(!1!==d.placefinding&&(d=L.fromJSON(d),S.isArcGISWorldGeocoder(d.get("locator.url"))&&d.set({singleLineFieldName:"SingleLine",outFields:["Addr_type","Match_addr","StAddr","City"],localSearchOptions:{minScale:3E5,distance:5E4},
placeholder:n.placeholder}),d.singleLineFieldName))return d}).filter(Boolean):[]};f.prototype._convertApplicationProperties=function(){var d=this,a=this.get("view.map.applicationProperties.viewing.search"),f=this.get("view.map");if(!f||!a)return[];var b=a.hintText;return a.enabled?a.layers.map(function(a){var k=f.findLayerById(a.id);if(k){a=d._getLayerJSON(a);var h=J.fromJSON(a);h.placeholder=b;d._getFeatureLayer(k,a).then(function(d){h.featureLayer=d});return h}}).filter(Boolean):[]};f.prototype._getFeatureLayer=
function(d,a){if("feature"===d.type||"scene"===d.type)return v.resolve(d);if("map-image"===d.type)return h.when(A,"../../layers/FeatureLayer").then(function(f){return new f({url:d.url+"/"+a.subLayer})})};f.prototype._getLayerJSON=function(d){return"function"===typeof d.toJSON?d.toJSON():d};f.prototype._updateDefaultSources=function(){var d=this.defaultSources,a=this.includeDefaultSources;d.removeAll();a&&d.addMany(this._convertApplicationProperties().concat(this._convertHelperServices()));this.notifyChange("allSources")};
f.prototype._clear=function(){this._gotoPromise&&(this._gotoPromise.cancel(),this._gotoPromise=null);this._set("results",null);this._set("suggestions",null);this._set("selectedResult",null);this._set("selectedSuggestion",null);this.emit("search-clear")};f.prototype._closePopup=function(){var d=this.get("view.popup"),a=this.resultGraphic;if(d&&this.popupEnabled&&a){var f=d.selectedFeature;f&&f===a&&d.close()}};f.prototype._suggestTimer=function(d){return v.after(null!=d?d:this.suggestionDelay)};f.prototype._createLocationForSearch=
function(d){if(d instanceof c)return M.getPointFromGeometry(d.geometry);if(d instanceof m)return d;if(Array.isArray(d)&&2===d.length)return new m({longitude:d[0],latitude:d[1]})};f.prototype._createSuggestionForSearch=function(d){if(d&&B(d,"key")&&B(d,"text")&&B(d,"sourceIndex"))return d;var a=this._createLocationForSearch(d)||null,f="string"===typeof d?d:this.searchTerm,b=this.selectedSuggestion,k=this.selectedResult,h=(d=!d&&b&&k)&&b.location;return d&&b.key===k.key&&b.sourceIndex===k.sourceIndex||
h?b:{location:a,text:a?"":f,sourceIndex:null,key:null}};f.prototype._getFirstResult=function(d){var a=null;d&&d.some(function(d){d=d.results[0];var f=!!d;f&&(a=d);return f});return a};f.prototype._selectFirstResult=function(d){return this.autoSelect&&d?this.select(d):v.resolve()};f.prototype._suggestImmediate=function(d){var a=this;return this._loadDefaultSources().then(function(){return a._getSuggestionsFromSources(d)}).then(function(f){var b={activeSourceIndex:a.activeSourceIndex,searchTerm:d,numResults:0,
numErrors:0,errors:[],results:[]};a._formatResponse(b,f);return b})};f.prototype._formatSourceResponse=function(d,a,f){var b=a&&a.value||[];a=a&&a.error;var k=this.allSources.getItemAt(f);a?(d.errors.push({sourceIndex:f,source:k,error:a}),d.numErrors++):(d.results.push({sourceIndex:f,source:k,results:b}),d.numResults+=b.length)};f.prototype._formatResponse=function(d,a,f){var b=this;if(a)if(-1===d.activeSourceIndex){var k=f&&B(f,"sourceIndex")&&-1!==f.sourceIndex?f.sourceIndex:void 0;a.forEach(function(a,
f){b._formatSourceResponse(d,a,void 0!==k?k:f)})}else this._formatSourceResponse(d,a[0],d.activeSourceIndex)};f.prototype._getResultsFromSources=function(d){var a=this,f=this.allSources,b=!d.location&&B(d,"sourceIndex")?d.sourceIndex:this.activeSourceIndex,k=[];if(!f.length)return f=new p("search:no-sources-defined","At least one source is required.",{allSources:f}),G.error(f),v.reject(f);-1===b?f.forEach(function(f,b){k.push(a._getResultsFromSource(d,b))}):k.push(this._getResultsFromSource(d,b));
return v.eachAlways(k)};f.prototype._getSuggestionsFromSources=function(a){var d=this,f=this.allSources,b=this.activeSourceIndex,k=[];if(!f.length)return f=new p("suggest:no-sources-defined","At least one source is required.",{allSources:f}),G.error(f),v.reject(f);-1===b?f.forEach(function(f,b){k.push(d._getSuggestionsFromSource(a,b))}):k.push(this._getSuggestionsFromSource(a,b));return v.eachAlways(k)};f.prototype._getResultsFromSource=function(a,f){var d=this.allSources.getItemAt(f),b=a.location,
b=void 0===b?null:b,k=this.get("view.spatialReference")||K,h=B(d,"maxResults")?d.maxResults:this.maxResults,c=d instanceof J&&B(d,"exactMatch")?d.exactMatch:!1,C=d instanceof L&&B(d,"locationToAddressDistance")?d.locationToAddressDistance:this.locationToAddressDistance;return d.getResults({view:this.view,sourceIndex:f,location:b,suggestResult:a,spatialReference:k,exactMatch:c,maxResults:h,distance:C})};f.prototype._getSuggestionsFromSource=function(a,f){var d=this.allSources.getItemAt(f),b=B(d,"suggestionsEnabled")?
d.suggestionsEnabled:this.suggestionsEnabled,k=a.trim().length,h=B(d,"minSuggestCharacters")?d.minSuggestCharacters:this.minSuggestCharacters;return b&&k>=h?(b=this.get("view.spatialReference")||K,k=B(d,"maxSuggestions")?d.maxSuggestions:this.maxSuggestions,d.getSuggestions({view:this.view,sourceIndex:f,suggestTerm:a,spatialReference:b,maxSuggestions:k})):v.resolve()};f.prototype.createDefaultSymbol=function(d,a){if("point"===a)return new P({color:d.color,size:d.size,outline:{color:d.outline.color,
width:d.outline.width}});if("polyline"===a)return new N({color:d.color,width:d.width});if("polygon"===a)return new H({color:d.color,outline:{color:d.outline.color,width:d.outline.width}})};f.prototype._setDefaultActiveSourceIndex=function(){this.activeSourceIndex=1!==this.allSources.length&&this.searchAllEnabled?-1:0;this.notifyChange("activeSource")};f.prototype._getSourcePopupTemplate=function(a){var d=a.featureLayer;if(d)return B(a,"popupTemplate")?a.popupTemplate:d.popupTemplate};f.prototype._getSourceIndexOfResult=
function(a){var d=null;this.results.some(function(f){return f.results.some(function(b){if(b===a)return d=f.sourceIndex,!0})});return d};f.prototype._goToSearchResult=function(a,f){var d=!!f;f={target:{target:f},options:{animate:d}};"3d"===a.type&&(f.target.tilt=0);a=this.callGoTo(f);d&&(this._gotoPromise=a);return a};f.prototype._whenViewAndPortalLoaded=function(){var a=this.portal,f=this.view,f=f?f.when():v.resolve(),a=a?a.when():v.resolve();return v.eachAlways([f,a]).then(function(){})};f.prototype._loadDefaultSources=
function(){var a=this,f=this.includeDefaultSources;this._cancelLoadingDefaultSources();this._clearLoadingDefaultSources();var f=f?this._whenViewAndPortalLoaded():v.resolve(),b=!1;f.catch(function(){}).then(function(){b=!0;a._clearLoadingDefaultSources();a._updateDefaultSources()});b||(this._loadingDefaultSources=f,this.notifyChange("state"));return f};f.prototype._getDefaultSymbol=function(a){var f=this.get("view.map.basemap.id");if(a=a&&a.feature&&a.feature.geometry&&a.feature.geometry.type)if(f=
(f=C.getSchemes({theme:"default",basemap:f||"topo",geometryType:a}))&&f.primaryScheme)return f.color&&B(f,"opacity")&&(f.color.a=f.opacity),this.createDefaultSymbol(f,a);return this.defaultSymbol};f.prototype._allSourcesChanged=function(a){var f=a.target.length;a=f-a.added.length+a.removed.length;a!==f&&(1>=a&&1<f||1>=f&&1<a||this._setDefaultActiveSourceIndex())};f.ALL_INDEX=-1;a([t.property({readOnly:!0,dependsOn:["activeSourceIndex","allSources.length"],value:null})],f.prototype,"activeSource",
null);a([t.property()],f.prototype,"activeSourceIndex",void 0);a([t.property()],f.prototype,"allPlaceholder",void 0);a([t.property({dependsOn:["defaultSources.length","sources.length","includeDefaultSources"],readOnly:!0})],f.prototype,"allSources",null);a([t.property()],f.prototype,"autoNavigate",void 0);a([t.property()],f.prototype,"autoSelect",void 0);a([t.property({readOnly:!0})],f.prototype,"defaultSources",void 0);a([t.property()],f.prototype,"defaultSymbol",void 0);a([t.property()],f.prototype,
"includeDefaultSources",void 0);a([t.property()],f.prototype,"locationEnabled",null);a([t.property()],f.prototype,"locationToAddressDistance",void 0);a([t.property()],f.prototype,"maxInputLength",void 0);a([t.property()],f.prototype,"maxResults",void 0);a([t.property()],f.prototype,"maxSuggestions",void 0);a([t.property()],f.prototype,"minSuggestCharacters",void 0);a([t.property({readOnly:!0,dependsOn:["activeSourceIndex","activeSource.placeholder","allPlaceholder","allSources"]})],f.prototype,"placeholder",
null);a([t.property({dependsOn:["view.popup"],readOnly:!0})],f.prototype,"popup",null);a([t.property()],f.prototype,"popupOpenOnSelect",void 0);a([t.property()],f.prototype,"popupTemplate",void 0);a([t.property()],f.prototype,"popupEnabled",void 0);a([t.property({type:F})],f.prototype,"portal",void 0);a([t.property()],f.prototype,"resultGraphicEnabled",void 0);a([t.property({readOnly:!0})],f.prototype,"resultGraphic",void 0);a([t.property({readOnly:!0})],f.prototype,"results",void 0);a([t.property({readOnly:!0})],
f.prototype,"selectedSuggestion",void 0);a([t.property()],f.prototype,"searchAllEnabled",void 0);a([t.property({readOnly:!0})],f.prototype,"selectedResult",void 0);a([t.property()],f.prototype,"searchTerm",null);a([t.property({type:I})],f.prototype,"sources",void 0);a([t.property({readOnly:!0,dependsOn:["allSources.length"]})],f.prototype,"state",null);a([t.property()],f.prototype,"suggestionDelay",void 0);a([t.property({readOnly:!0})],f.prototype,"suggestions",void 0);a([t.property()],f.prototype,
"suggestionsEnabled",void 0);a([t.property()],f.prototype,"view",void 0);a([t.property()],f.prototype,"clear",null);return f=a([t.subclass("esri.widgets.Search.SearchViewModel")],f)}(t.declared(g,l,O))})},"esri/core/geolocationUtils":function(){define("require exports ./tsSupport/assignHelper ../config ./Error ./Logger ./promiseUtils ./sniff ../geometry/Point ../geometry/support/webMercatorUtils ../portal/Portal ../tasks/GeometryService ../tasks/support/ProjectParameters".split(" "),function(A,r,
w,a,q,n,c,x,g,y,p,l,b){function z(a,h){var v=h.spatialReference;return v.isWGS84?c.resolve(a):v.isWebMercator?c.resolve(y.geographicToWebMercator(a)):e().then(function(k){if(!k)return c.reject(new q("geometry-service:missing-url","Geometry service URL is missing"));k=new l({url:k});var h=new b({geometries:[a],outSR:v});return k.project(h).then(function(a){return a[0]})})}function e(){if(a.geometryServiceUrl)return c.resolve(a.geometryServiceUrl);var b=p.getDefault();return b.load().always(function(){return b.get("helperServices.geometry.url")})}
Object.defineProperty(r,"__esModule",{value:!0});var v=n.getLogger("esri.core.geolocationUtils"),h={maximumAge:0,timeout:15E3,enableHighAccuracy:!0};r.supported=function(){var a=x("esri-geolocation");a||v.warn("geolocation-unsupported","Geolocation unsupported.");a&&((a=x("esri-secure-context"))||v.warn("insecure-context","Geolocation requires a secure origin."));return a};r.getCurrentPosition=function(a){a||(a=h);var b=c.create(function(b,k){navigator.geolocation.getCurrentPosition(b,k,a)});return c.timeout(b,
15E3,void 0)};r.positionToPoint=function(a,b){var h=a&&a.coords||{},h={accuracy:h.accuracy,altitude:h.altitude,altitudeAccuracy:h.altitudeAccuracy,heading:h.heading,latitude:h.latitude,longitude:h.longitude,speed:h.speed};a=a?{coords:h,timestamp:a.timestamp}:a;a=(a=a&&a.coords)?new g({longitude:a.longitude,latitude:a.latitude,z:a.altitude||null,spatialReference:{wkid:4326}}):null;return z(a,b)}})},"esri/styles/basic":function(){define(["../core/lang","../Color"],function(A,r){function w(a,c){var n;
if(a)switch(n={},n.color=new r(a.color),c){case "point":n.outline={color:new r(a.outline.color),width:a.outline.width};n.size=a.size;break;case "polyline":n.width=a.width;break;case "polygon":n.outline={color:new r(a.outline.color),width:a.outline.width}}return n}var a={"default":{name:"default",label:"Default",description:"Default theme for basic visualization of features.",basemapGroups:{light:"streets gray topo terrain national-geographic oceans osm gray-vector streets-vector topo-vector streets-relief-vector streets-navigation-vector".split(" "),
dark:["satellite","hybrid","dark-gray","dark-gray-vector","streets-night-vector"]},pointSchemes:{light:{primary:{color:[77,77,77,1],outline:{color:[255,255,255,1],width:1},size:8},secondary:[{color:[226,119,40,1],outline:{color:[255,255,255,1],width:1},size:8},{color:[255,255,255,1],outline:{color:[51,51,51,1],width:1},size:8}]},dark:{primary:{color:[255,255,255,1],outline:{color:[26,26,26,1],width:1},size:8},secondary:[{color:[226,119,40,1],outline:{color:[255,255,255,1],width:1},size:8},{color:[26,
26,26,1],outline:{color:[178,178,178,1],width:1},size:8}]}},lineSchemes:{light:{primary:{color:[77,77,77,1],width:2},secondary:[{color:[226,119,40,1],width:2},{color:[255,255,255,1],width:2}]},dark:{primary:{color:[255,255,255,1],width:2},secondary:[{color:[226,119,40,1],width:2},{color:[26,26,26,1],width:2}]}},polygonSchemes:{light:{primary:{color:[227,139,79,.8],outline:{color:[255,255,255,1],width:1}},secondary:[{color:[128,128,128,.8],outline:{color:[255,255,255,1],width:1}},{color:[255,255,255,
.8],outline:{color:[128,128,128,1],width:1}}]},dark:{primary:{color:[227,139,79,.8],outline:{color:[51,51,51,1],width:1}},secondary:[{color:[178,178,178,.8],outline:{color:[51,51,51,1],width:1}},{color:[26,26,26,.8],outline:{color:[128,128,128,1],width:1}}]}}}},q={};(function(){var n,c,x,g,y,p,l,b;for(n in a)for(g in c=a[n],x=c.basemapGroups,y=q[n]={basemaps:[].concat(x.light).concat(x.dark),point:{},polyline:{},polygon:{}},x)for(p=x[g],l=0;l<p.length;l++)b=p[l],c.pointSchemes&&(y.point[b]=c.pointSchemes[g]),
c.lineSchemes&&(y.polyline[b]=c.lineSchemes[g]),c.polygonSchemes&&(y.polygon[b]=c.polygonSchemes[g])})();return{getAvailableThemes:function(n){var c=[],x,g,y;for(x in a)g=a[x],y=q[x],n&&y.basemaps&&-1===y.basemaps.indexOf(n)||c.push({name:g.name,label:g.label,description:g.description,basemaps:y.basemaps.slice(0)});return c},getSchemes:function(a){var c=a.basemap,n=a.geometryType;a=q[a.theme];var g;(a=(a=a&&a[n])&&a[c])&&(g={primaryScheme:w(a.primary,n),secondarySchemes:a.secondary.map(function(a){return w(a,
n)})});return g},cloneScheme:function(a){var c;a&&(c=A.mixin({},a),c.color&&(c.color=new r(c.color)),c.outline&&(c.outline={color:c.outline.color&&new r(c.outline.color),width:c.outline.width}));return c}}})},"esri/widgets/Search/FeatureLayerSearchSource":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/lang ../../core/accessorSupport/decorators ../../layers/CSVLayer ../../layers/FeatureLayer ../../layers/Layer ../../layers/SceneLayer ./SearchSource ./support/featureLayerUtils".split(" "),
function(A,r,w,a,q,n,c,x,g,y,p,l,b){return function(l){function e(){var a=null!==l&&l.apply(this,arguments)||this;a.displayField=null;a.exactMatch=null;a.searchFields=null;a.searchQueryParams=null;a.searchTemplate=null;a.suggestionTemplate=null;a.suggestQueryParams=null;return a}w(e,l);v=e;Object.defineProperty(e.prototype,"featureLayer",{set:function(a){this._set("featureLayer",a);this._loadFeatureLayer()},enumerable:!0,configurable:!0});e.prototype.clone=function(){return new v({autoNavigate:this.autoNavigate,
filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?n.clone(this.outFields):null,placeholder:this.placeholder,popup:this.popup,popupEnabled:this.popupEnabled,popupOpenOnSelect:this.popupOpenOnSelect,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,searchExtent:this.searchExtent?this.searchExtent.clone():null,suggestionsEnabled:this.suggestionsEnabled,
suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,displayField:this.displayField,exactMatch:this.exactMatch,featureLayer:this.featureLayer,searchFields:this.searchFields?n.clone(this.searchFields):null,searchQueryParams:this.searchQueryParams?n.clone(this.searchQueryParams):null,suggestionTemplate:this.suggestionTemplate,suggestQueryParams:this.suggestQueryParams?n.clone(this.suggestQueryParams):null,zoomScale:this.zoomScale})};e.prototype.getResults=function(a){return b.getResults(q({source:this},
a))};e.prototype.getSuggestions=function(a){return b.getSuggestions(q({source:this},a))};e.prototype._getFirstStringField=function(){var a=this.featureLayer,b="";a&&a.fields&&a.fields.some(function(a){if("string"===a.type)return b=a.name,!0});return b};e.prototype._getDisplayField=function(){return this.displayField||this.featureLayer.displayField||this._getFirstStringField()};e.prototype._setFallbackNameFromFeatureLayer=function(a){(a=this._getFeatureLayerTitle(a))&&!this.name&&this._set("name",
a)};e.prototype._loadFeatureLayer=function(){var a=this,b=this.featureLayer;b&&b.load().then(function(){a.featureLayer===b&&a._setFallbackNameFromFeatureLayer(b)})};e.prototype._getFeatureLayerTitle=function(a){var b=a.title,c="";(this.searchFields||[this._getDisplayField()]).forEach(function(b,k){c+=0===k?": ":", ";k=a.getField(b);c+=k&&k.alias||b});return b+c};var v;a([c.property({json:{read:{source:"field.name"},write:{target:"field.name"}}})],e.prototype,"displayField",void 0);a([c.property({json:{read:{source:"field.exactMatch"},
write:{target:"field.exactMatch"}}})],e.prototype,"exactMatch",void 0);a([c.property({types:{key:"type",base:y,defaultKeyValue:"feature",typeMap:{feature:g,csv:x,scene:p}},value:null})],e.prototype,"featureLayer",null);a([c.property()],e.prototype,"searchFields",void 0);a([c.property()],e.prototype,"searchQueryParams",void 0);a([c.property()],e.prototype,"searchTemplate",void 0);a([c.property()],e.prototype,"suggestionTemplate",void 0);a([c.property()],e.prototype,"suggestQueryParams",void 0);return e=
v=a([c.subclass("esri.widgets.Search.FeatureLayerSearchSource")],e)}(c.declared(l))})},"esri/layers/CSVLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper ../core/tsSupport/paramHelper ../geometry ../core/urlUtils ../core/accessorSupport/decorators ./FeatureLayer ./graphics/data/FeatureStoreCapabilities ./graphics/sources/CSVSource ../tasks/support/Query".split(" "),function(A,r,w,a,q,n,c,x,g,y,p,l,b){return function(z){function e(a,
b){a=z.call(this)||this;a.delimiter=null;a.fields=null;a.latitudeField=null;a.locationType="coordinates";a.longitudeField=null;a.operationalLayerType="CSV";a.outFields=["*"];a.portalItem=null;a.spatialReference=c.SpatialReference.WGS84;a.source=null;a.type="csv";return a}w(e,z);e.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?q({url:a},b):a};Object.defineProperty(e.prototype,"capabilities",{get:function(){return{data:{supportsAttachment:!1,supportsM:!1,supportsZ:!1},operations:{supportsCalculate:!1,
supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsQuery:!0,supportsResizeAttachments:!1,supportsUpdate:!1},query:p.queryCapabilities,queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1},editing:{supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1}}},
enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"hasService",{get:function(){return!1},enumerable:!0,configurable:!0});e.prototype.readWebMapLabelsVisible=function(a,b){return null!=b.showLabels?b.showLabels:!!(b.layerDefinition&&b.layerDefinition.drawingInfo&&b.layerDefinition.drawingInfo.labelingInfo)};Object.defineProperty(e.prototype,"url",{set:function(a){this._set("url",a)},enumerable:!0,configurable:!0});e.prototype.readUrl=function(a,b,c){return x.read(a,c)};e.prototype.writeUrl=
function(a,b,c,e){a=x.write(a,e);b.url=a?x.normalize(a):a};e.prototype.createGraphicsSource=function(){var a=this,b=new l.default({delimiter:this.delimiter,fields:this.fields,latitudeField:this.latitudeField,longitudeField:this.longitudeField,spatialReference:this.spatialReference,url:this.url});this._set("source",b);return b.when(function(){a.read({locationInfo:b.locationInfo,columnDelimiter:b.columnDelimiter},{origin:"service",url:a.parsedUrl});return b})};e.prototype.queryFeatures=function(a,b){var c=
this;return this.load().then(function(){return c.source.queryFeatures(a||c.createQuery())}).then(function(a){if(a&&a.features)for(var b=0,k=a.features;b<k.length;b++){var h=k[b];h.layer=h.sourceLayer=c}return a})};e.prototype.queryFeaturesJSON=function(a,b){var c=this;return this.load().then(function(){return c.source.queryFeaturesJSON(a||c.createQuery())})};e.prototype.queryObjectIds=function(a,b){var c=this;return this.load().then(function(){return c.source.queryObjectIds(a||c.createQuery())})};
e.prototype.queryFeatureCount=function(a,b){var c=this;return this.load().then(function(){return c.source.queryFeatureCount(a||c.createQuery())})};e.prototype.queryExtent=function(a,b){var c=this;return this.load().then(function(){return c.source.queryExtent(a||c.createQuery())})};e.prototype._verifyFields=function(){};e.prototype._verifySource=function(){};e.prototype._hasMemorySource=function(){return!0};a([g.property({readOnly:!0,dependsOn:["loaded"],json:{read:!1}})],e.prototype,"capabilities",
null);a([g.property({type:String,json:{write:{target:"columnDelimiter"},read:{source:"columnDelimiter"}}})],e.prototype,"delimiter",void 0);a([g.property({json:{read:{source:"layerDefinition.fields"}}})],e.prototype,"fields",void 0);a([g.property({readOnly:!0})],e.prototype,"hasService",null);a([g.reader("web-map","labelsVisible",["layerDefinition.drawingInfo.labelingInfo","showLabels"])],e.prototype,"readWebMapLabelsVisible",null);a([g.property({type:String,json:{write:{target:"locationInfo.latitudeFieldName"},
read:{source:"locationInfo.latitudeFieldName"}}})],e.prototype,"latitudeField",void 0);a([g.property({type:String,json:{write:{target:"locationInfo.locationType"},read:{source:"locationInfo.locationType"}}})],e.prototype,"locationType",void 0);a([g.property({type:String,json:{write:{target:"locationInfo.longitudeFieldName"},read:{source:"locationInfo.longitudeFieldName"}}})],e.prototype,"longitudeField",void 0);a([g.property()],e.prototype,"operationalLayerType",void 0);a([g.property()],e.prototype,
"outFields",void 0);a([g.property({json:{read:!1,write:!1}})],e.prototype,"portalItem",void 0);a([g.property({json:{read:!1},cast:null,type:l.default,readOnly:!0})],e.prototype,"source",void 0);a([g.property({json:{read:!1},value:"csv",readOnly:!0})],e.prototype,"type",void 0);a([g.property({json:{write:!0}})],e.prototype,"url",null);a([g.reader("url")],e.prototype,"readUrl",null);a([g.writer("url")],e.prototype,"writeUrl",null);a([n(0,g.cast(b))],e.prototype,"queryFeatures",null);a([n(0,g.cast(b))],
e.prototype,"queryFeaturesJSON",null);a([n(0,g.cast(b))],e.prototype,"queryObjectIds",null);a([n(0,g.cast(b))],e.prototype,"queryFeatureCount",null);a([n(0,g.cast(b))],e.prototype,"queryExtent",null);return e=a([g.subclass("esri.layers.CSVLayer")],e)}(g.declared(y))})},"esri/layers/graphics/data/FeatureStoreCapabilities":function(){define(["require","exports"],function(A,r){Object.defineProperty(r,"__esModule",{value:!0});r.queryCapabilities={supportsStatistics:!0,supportsCentroid:!0,supportsDistance:!0,
supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!1,supportsHistoricMoment:!1,supportsFormatPBF:!1}})},"esri/layers/graphics/sources/CSVSource":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper dojo/has ../../../geometry ../../../core/Accessor ../../../core/Promise ../../../core/requireUtils ../../../core/workers ../../../core/accessorSupport/decorators ../../../tasks/support/FeatureSet module".split(" "),
function(A,r,w,a,q,n,c,x,g,y,p,l,b){Object.defineProperty(r,"__esModule",{value:!0});q.add("esri-workers-for-memory-layers",!1);c=function(c){function e(){return null!==c&&c.apply(this,arguments)||this}w(e,c);e.prototype.initialize=function(){var a=this;this.addResolvingPromise(y.open(g.getAbsMid("./support/CSVSourceWorker",A,b),{client:this,strategy:q("esri-workers-for-memory-layers")?"dedicated":"local"}).then(function(b){a._connection=b;return b.invoke("load",{url:a.url,parsing:{columnDelimiter:a.delimiter,
fields:a.fields&&a.fields.map(function(a){return a.toJSON()}),latitudeField:a.latitudeField,longitudeField:a.longitudeField,spatialReference:a.spatialReference&&a.spatialReference.toJSON()}})}).then(function(b){a.locationInfo=b.locationInfo;a.layerDefinition=b.layerDefinition;a.columnDelimiter=b.columnDelimiter}))};e.prototype.openPorts=function(){var a=this;return this.when().then(function(){return a._connection.openPorts()})};e.prototype.queryFeatures=function(a){return this.queryFeaturesJSON(a).then(function(a){return l.fromJSON(a)})};
e.prototype.queryFeaturesJSON=function(a){var b=this;return this.when().then(function(){return b._connection.invoke("queryFeatures",a?a.toJSON():null)})};e.prototype.queryFeatureCount=function(a){var b=this;return this.when().then(function(){return b._connection.invoke("queryFeatureCount",a?a.toJSON():null)})};e.prototype.queryObjectIds=function(a){var b=this;return this.when().then(function(){return b._connection.invoke("queryObjectIds",a?a.toJSON():null)})};e.prototype.queryExtent=function(a){var b=
this;return this.when().then(function(){return b._connection.invoke("queryExtent",a?a.toJSON():null)}).then(function(a){return{count:a.count,extent:n.Extent.fromJSON(a.extent)}})};a([p.property()],e.prototype,"url",void 0);a([p.property()],e.prototype,"delimiter",void 0);a([p.property()],e.prototype,"fields",void 0);a([p.property()],e.prototype,"latitudeField",void 0);a([p.property()],e.prototype,"longitudeField",void 0);a([p.property()],e.prototype,"spatialReference",void 0);a([p.property()],e.prototype,
"locationInfo",void 0);a([p.property()],e.prototype,"layerDefinition",void 0);a([p.property()],e.prototype,"columnDelimiter",void 0);return e=a([p.subclass("esri.layers.graphics.sources.CSVSource")],e)}(p.declared(c,x));r.default=c})},"esri/layers/SceneLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/promise/all ../PopupTemplate ../request ../core/Error ../core/Logger ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators ../core/accessorSupport/PropertyOrigin ../core/accessorSupport/utils ./FeatureLayer ./Layer ./mixins/SceneService ./support/commonProperties ./support/commonProperties ./support/FeatureReduction ./support/FeatureReductionSelection ./support/Field ./support/fieldUtils ./support/LabelClass ./support/labelingInfo ./support/RangeInfo ../portal/PortalItem ../renderers/support/jsonUtils ../renderers/support/styleUtils ../renderers/support/typeUtils ../symbols/support/ElevationInfo ../tasks/support/Query".split(" "),
function(A,r,w,a,q,n,c,x,g,y,p,l,b,z,e,v,h,E,t,m,k,F,C,D,H,N,P,Q,J,L,R,M,S){function O(a,b,f){a&&((a=J.read(a,b,f)||void 0)||G.error("Failed to create renderer",{rendererDefinition:a,layer:this,context:f}));return a}var B=["3DObject","Point"],G=y.getLogger("esri.layers.SceneLayer"),I={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},
K={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"};return function(h){function u(a,b){a=h.call(this)||this;a.featureReduction=null;a.rangeInfos=null;a.operationalLayerType="ArcGISSceneServiceLayer";a.type="scene";a.fields=[];a.definitionExpression=null;a.elevationInfo=null;a.labelsVisible=!0;a.labelingInfo=null;a.legendEnabled=!0;a.cachedDrawingInfo={color:!1};a.popupEnabled=!0;a.popupTemplate=null;a.objectIdField=null;a.objectIdFilter=null;a._fieldUsageInfo={};a.screenSizePerspectiveEnabled=
!0;return a}a(u,h);u.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?w({url:a},b):a};u.prototype.getField=function(a){return D.getField(a,this.fields)};Object.defineProperty(u.prototype,"geometryType",{get:function(){return K[this.profile]||"mesh"},enumerable:!0,configurable:!0});Object.defineProperty(u.prototype,"renderer",{set:function(a){D.fixRendererFields(a,this.fields);this._set("renderer",a)},enumerable:!0,configurable:!0});u.prototype.readCachedDrawingInfo=function(a,b){if(null==
a||"object"!==typeof a)a={};null==a.color&&(a.color=!1);return a};u.prototype.readObjectIdField=function(a,b){!a&&b.fields&&b.fields.some(function(b){"esriFieldTypeOID"===b.type&&(a=b.name);return!!a});return a||void 0};u.prototype.readProfile=function(a,b){a=b.store.profile;if(null!=a&&I[a])return I[a];G.error("Unknown or missing profile",{profile:a,layer:this});return"mesh-pyramids"};u.prototype.readNormalReferenceFrame=function(a,b){return b.store.normalReferenceFrame};u.prototype.load=function(){var a=
this,b=this.loadFromPortal({supportedTypes:["Scene Service"]}).always(function(){return a._fetchService()}).then(function(){return n([a._verifyRootNodeAndUpdateExtent(),a._setCompanionFeatureLayer()])}).then(function(){return a._applyCompanionOverrides()}).then(function(){return a._populateFieldUsageInfo()}).then(function(){return L.loadStyleRenderer(a,{origin:"service"})}).then(function(){return D.fixRendererFields(a.renderer,a.fields)});this.addResolvingPromise(b);return this.when()};u.prototype.createLayerView=
function(a){var b=this;return(null==this.profile||"mesh-pyramids"===this.profile?p.create(function(a){return A(["../views/3d/layers/SceneLayerView3D"],a)}):p.create(function(a){return A(["../views/3d/layers/SceneLayerGraphicsView3D"],a)})).then(function(d){return new d({view:a,layer:b})})};u.prototype.createQuery=function(){var a=new S;"mesh"!==this.geometryType&&(a.returnGeometry=!0,a.returnZ=!0);a.where=this.definitionExpression||"1\x3d1";a.sqlFormat="standard";return a};u.prototype.queryExtent=
function(a){var b=this;return this._getAssociatedLayerForQuery().then(function(d){return d.queryExtent(a||b.createQuery())})};u.prototype.queryFeatureCount=function(a){var b=this;return this._getAssociatedLayerForQuery().then(function(d){return d.queryFeatureCount(a||b.createQuery())})};u.prototype.queryFeatures=function(a){var b=this;return this._getAssociatedLayerForQuery().then(function(d){return d.queryFeatures(a||b.createQuery())}).then(function(a){if(a&&a.features)for(var d=0,f=a.features;d<
f.length;d++){var k=f[d];k.layer=b;k.sourceLayer=b}return a})};u.prototype.queryFeaturesJSON=function(a){var b=this;return this._getAssociatedLayerForQuery().then(function(d){return d.queryFeaturesJSON(a||b.createQuery())})};u.prototype.queryObjectIds=function(a){var b=this;return this._getAssociatedLayerForQuery().then(function(d){return d.queryObjectIds(a||b.createQuery())})};u.prototype.getFieldUsageInfo=function(a){return this._fieldUsageInfo[a]||{supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,
supportsLayerQuery:!1}};u.prototype._getAssociatedLayerForQuery=function(){var a=this;if(!this.loaded)return this.load().then(function(){return a._getAssociatedLayerForQuery()});var b=this.associatedLayer;return null!=b?p.resolve(b):p.reject(new g("scenelayer:query-not-available","SceneLayer queries are not available without associated feature layer"))};u.prototype.hasCachedStatistics=function(a){return null!=this.statisticsInfo&&this.statisticsInfo.some(function(b){return b.name===a})};u.prototype.queryCachedStatistics=
function(a){if(!this.hasCachedStatistics(a))return p.reject(new g("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available"));for(var b=0,f=this.statisticsInfo;b<f.length;b++){var k=f[b];if(k.name===a)return a=l.join(this.parsedUrl.path,k.href),x(a,{query:{f:"json"},responseType:"json"}).then(function(a){return a.data})}};u.prototype.graphicChanged=function(a){this.emit("graphic-update",a)};u.prototype._validateLayer=function(a){if(a.layerType&&-1===B.indexOf(a.layerType))throw new g("scenelayer:layer-type-not-supported",
"SceneLayer does not support this layer type",{layerType:a.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new g("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});if(1<this.version.major)throw new g("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});a=this.normalReferenceFrame;var b=this.spatialReference,
f=!1,k=!1;if(null==a)k=f=!0;else switch(b=b&&b.isGeographic,a){case "east-north-up":case "earth-centered":f=!0;k=b;break;case "vertex-reference-frame":f=!0;k=!b;break;default:f=!1}if(!f)throw new g("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!k)throw new g("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.");};u.prototype._populateFieldUsageInfo=function(){this._fieldUsageInfo={};if(this.fields)for(var a=
function(a){var d=!(!b.attributeStorageInfo||!b.attributeStorageInfo.some(function(b){return b.name===a.name})),f=!!(b.associatedLayer&&b.associatedLayer.fields&&b.associatedLayer.fields.some(function(b){return b&&a.name===b.name}));b._fieldUsageInfo[a.name]={supportsLabelingInfo:d,supportsRenderer:d,supportsPopupTemplate:d||f,supportsLayerQuery:f}},b=this,k=0,c=this.fields;k<c.length;k++)a(c[k])};u.prototype._applyCompanionOverrides=function(){if(this.associatedLayer){if(this.associatedLayer.fields)for(var a=
0,b=this.associatedLayer.fields;a<b.length;a++){var k=b[a];this.getField(k.name)||this.fields.push(k.clone())}a=["popupTemplate","popupEnabled"];b=e.getProperties(this);for(k=0;k<a.length;k++){var c=a[k];this._buddyIsMoreImportant(c)&&(b.setDefaultOrigin(this.associatedLayer.originOf(c)),b.set(c,this.associatedLayer[c]),b.setDefaultOrigin("user"))}}};u.prototype._setCompanionFeatureLayer=function(){var a=this;return this._fetchCompanionFeatureLayer().then(function(b){a.associatedLayer=b})};u.prototype._fetchCompanionFeatureLayer=
function(){var a=this;return-1===["mesh-pyramids","points"].indexOf(this.profile)?p.resolve(null):(this.portalItem&&this.portalItem.isResolved()?this._fetchCompanionFeatureLayerFromRelatedItems(this.portalItem):this._fetchCompanionFeatureLayerFromUrl()).then(function(a){return a.load()}).catch(function(b){null==a.attributeStorageInfo?G.warn("Companion FeatureLayer could not be loaded and no binary attributes found. Popups will not work for this SceneLayer: "+a.title):G.info("Companion FeatureLayer could not be loaded. Falling back to binary attributes for Popups on this SceneLayer: "+
a.title);return null})};u.prototype._fetchCompanionFeatureLayerFromRelatedItems=function(a){var b=this;return a.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"}).then(function(a){return(a=a.filter(function(a){return"Feature Service"===a.type})[0])?b._fetchCompanionFeatureLayerFromPortalItem(new Q({id:a.id,portal:a.portal})):p.reject()}).catch(function(){return b._fetchCompanionFeatureLayerFromUrl()})};u.prototype._fetchCompanionFeatureLayerFromPortalItem=function(a){var b=
this;return a.load().then(function(a){return b._findMatchingCompanionSublayerUrl(a.url)}).then(function(b){return p.resolve(new v({url:b,portalItem:a}))})};u.prototype._fetchCompanionFeatureLayerFromUrl=function(){return this._findMatchingCompanionSublayerUrl().then(function(a){return p.resolve(new v({url:a}))})};u.prototype._findMatchingCompanionSublayerUrl=function(a){var b=this.parsedUrl.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i);if(!b)return p.reject();null==a&&(a=b[1]+"/FeatureServer");
var k=a.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1");a={query:{f:"json"},responseType:"json"};var f=b[1]+"/SceneServer",c=parseInt(b[2],10),b=x(f,a).catch(function(a){return{layers:null}});a=x(k,a);return n([a,b]).then(function(a){var b=a[0];a=a[1];a=a.data&&a.data.layers;b=b.data&&b.data.layers;if(!Array.isArray(b))throw Error("expected layers array");if(Array.isArray(a))for(var d=0;d<Math.min(a.length,b.length);d++){if(a[d].id===c)return k+"/"+b[d].id}else if(c<b.length)return k+"/"+b[c].id;
throw Error("could not find matching associated sublayer");})};u.prototype._buddyIsMoreImportant=function(a){if(!this.associatedLayer)return!1;var b=z.nameToId(this.originOf(a));a=z.nameToId(this.associatedLayer.originOf(a));return null!=a&&a<=z.OriginId.SERVICE?null==b||b<z.OriginId.SERVICE:null!=a&&a<=z.OriginId.PORTAL_ITEM?null==b||b<z.OriginId.PORTAL_ITEM:!1};q([b.shared("esri.layers.SceneLayer")],u.prototype,"declaredClass",void 0);q([b.property({types:{key:"type",base:k.default,typeMap:{selection:F.default}},
json:{origins:{"web-scene":{read:{source:"layerDefinition.featureReduction"},write:{target:"layerDefinition.featureReduction"}}}}})],u.prototype,"featureReduction",void 0);q([b.property({type:[P.default],json:{read:!1,origins:{"web-scene":{read:{source:"layerDefinition.rangeInfos"},write:{target:"layerDefinition.rangeInfos"}}}}})],u.prototype,"rangeInfos",void 0);q([b.property()],u.prototype,"associatedLayer",void 0);q([b.property()],u.prototype,"operationalLayerType",void 0);q([b.property({json:{read:!1},
readOnly:!0})],u.prototype,"type",void 0);q([b.property({type:[C]})],u.prototype,"fields",void 0);q([b.property({readOnly:!0})],u.prototype,"attributeStorageInfo",void 0);q([b.property({readOnly:!0})],u.prototype,"statisticsInfo",void 0);q([b.property({type:String,json:{origins:{service:{read:!1,write:!1}},read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression"}}})],u.prototype,"definitionExpression",void 0);q([b.property({type:M,json:{origins:{service:{read:{source:"elevationInfo"}}},
read:{source:"layerDefinition.elevationInfo"},write:{target:"layerDefinition.elevationInfo"}}})],u.prototype,"elevationInfo",void 0);q([b.property({type:String,dependsOn:["profile"]})],u.prototype,"geometryType",null);q([b.property(t.labelsVisible)],u.prototype,"labelsVisible",void 0);q([b.property({type:[H],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:N.reader},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",
reader:N.reader},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],u.prototype,"labelingInfo",void 0);q([b.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],u.prototype,"legendEnabled",void 0);q([b.property({types:R.types,json:{origins:{service:{read:{source:"drawingInfo.renderer",reader:O}}},read:{source:"layerDefinition.drawingInfo.renderer",reader:O},write:{target:"layerDefinition.drawingInfo.renderer"}},value:null})],
u.prototype,"renderer",null);q([b.property({json:{read:!1}})],u.prototype,"cachedDrawingInfo",void 0);q([b.reader("service","cachedDrawingInfo")],u.prototype,"readCachedDrawingInfo",null);q([b.property(t.popupEnabled)],u.prototype,"popupEnabled",void 0);q([b.property({type:c,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],u.prototype,"popupTemplate",void 0);q([b.property({type:String,json:{read:!1}})],u.prototype,"objectIdField",void 0);q([b.reader("service","objectIdField",["objectIdField",
"fields"])],u.prototype,"readObjectIdField",null);q([b.property()],u.prototype,"objectIdFilter",void 0);q([b.property({type:String,json:{read:!1}})],u.prototype,"profile",void 0);q([b.reader("service","profile",["store.profile"])],u.prototype,"readProfile",null);q([b.property({readOnly:!0,type:String,json:{read:!1}})],u.prototype,"normalReferenceFrame",void 0);q([b.reader("service","normalReferenceFrame",["store.normalReferenceFrame"])],u.prototype,"readNormalReferenceFrame",null);q([b.property(m.screenSizePerspectiveEnabled)],
u.prototype,"screenSizePerspectiveEnabled",void 0);return u=q([b.subclass()],u)}(b.declared(h,E))})},"esri/layers/mixins/SceneService":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../request ../../core/Error ../../core/Logger ../../core/MultiOriginJSONSupport ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators ../../geometry/Extent ../../geometry/HeightModelInfo ../../geometry/SpatialReference ../Layer ./ArcGISService ./OperationalLayer ./PortalLayer ../support/arcgisLayerUrl".split(" "),
function(A,r,w,a,q,n,c,x,g,y,p,l,b,z,e,v,h,E,t){var m=c.getLogger("esri.layers.mixins.SceneService");return function(k){function c(){var a=null!==k&&k.apply(this,arguments)||this;a.blendMode=null;a.spatialReference=null;a.fullExtent=null;a.heightModelInfo=null;a.version={major:Number.NaN,minor:Number.NaN,versionString:""};a.copyright=null;a.sublayerTitleMode="item-title";a.title=null;a.layerId=null;return a}w(c,k);c.prototype.readSpatialReference=function(a,b){return this._readSpatialReference(b)};
c.prototype._readSpatialReference=function(a){if(null!=a.spatialReference)return z.fromJSON(a.spatialReference);a=a.store;a=(a=a.indexCRS||a.geographicCRS)&&parseInt(a.substring(a.lastIndexOf("/")+1,a.length),10);return null!=a?new z(a):null};c.prototype.readFullExtent=function(a,b){a=b.store;b=this._readSpatialReference(b);return null==b||null==a||null==a.extent?null:new l({xmin:a.extent[0],ymin:a.extent[1],xmax:a.extent[2],ymax:a.extent[3],spatialReference:b})};c.prototype.readVersion=function(a,
b){a=b.store;b=null!=a.version?a.version.toString():"";a={major:Number.NaN,minor:Number.NaN,versionString:b};b=b.split(".");2<=b.length&&(a.major=parseInt(b[0],10),a.minor=parseInt(b[1],10));return a};c.prototype.readTitlePortalItem=function(a,b){return"item-title"!==this.sublayerTitleMode?void 0:a};c.prototype.readTitleService=function(a,b){a=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return t.titleFromUrlAndName(this.url,b.name);b=b.name||t.parse(this.url).title;
"item-title-and-service-name"===this.sublayerTitleMode&&a&&(b=a+" - "+b);return t.cleanTitle(b)};c.prototype.readLayerId=function(a,b){return b.id};Object.defineProperty(c.prototype,"url",{set:function(a){a=t.sanitizeUrlWithLayerId(this,a,m);this._set("url",a.url);null!=a.layerId&&this._set("layerId",a.layerId)},enumerable:!0,configurable:!0});c.prototype.writeUrl=function(a,b){t.writeUrlWithLayerId(this,a,"layers",b)};Object.defineProperty(c.prototype,"parsedUrl",{get:function(){var a=this._get("url");
if(!a)return null;a=y.urlToObject(a);null!=this.layerId&&t.match.test(a.path)&&(a.path=a.path+"/layers/"+this.layerId);return a},enumerable:!0,configurable:!0});c.prototype.readRootNode=function(a,b){return b.store.rootNode};c.prototype._verifyRootNodeAndUpdateExtent=function(){var a=this;return this._fetchRootNode().then(function(b){return a._updateExtentFromRootNode(b)})};c.prototype._updateExtentFromRootNode=function(a){if(null!=this.fullExtent&&!this.fullExtent.hasZ&&null!=a&&Array.isArray(a.mbs)&&
4===a.mbs.length){var b=a.mbs[2];a=a.mbs[3];this.fullExtent.zmin=b-a;this.fullExtent.zmax=b+a}};c.prototype._fetchRootNode=function(){if(!this.rootNode)return g.resolve();var a=y.join(this.parsedUrl.path,this.rootNode);return q(a,{query:{f:"json"},responseType:"json"}).then(function(a){return a.data}).catch(function(b){throw new n("sceneservice:root-node-missing","Root node missing.",{error:b,url:a});})};c.prototype._fetchService=function(){var a=this;return(null==this.layerId&&/SceneServer\/*$/i.test(this.url)?
this._fetchFirstLayerId().then(function(b){null!=b&&(a.layerId=b)}):g.resolve()).then(function(){return a._fetchServiceLayer()})};c.prototype._fetchFirstLayerId=function(){return q(this.url,{query:{f:"json"},callbackParamName:"callback",responseType:"json"}).then(function(a){if(a.data&&Array.isArray(a.data.layers)&&0<a.data.layers.length)return a.data.layers[0].id})};c.prototype._fetchServiceLayer=function(){var a=this;return q(this.parsedUrl.path,{query:{f:"json"},responseType:"json"}).then(function(b){b.ssl&&
(a.url=a.url.replace(/^http:/i,"https:"));b=b.data;a.read(b,{origin:"service",url:a.parsedUrl});a._validateLayer(b)})};c.prototype._validateLayer=function(a){};c.prototype.createGraphicsController=function(a){var b=this;a.layer=this;var c=g.create(function(a){return A(["../graphics/controllers/I3SOnDemandController"],a)}).then(function(b){return new b(a)});c.then(function(a){b.emit("graphics-controller-create",{graphicsController:a})});return c};a([p.shared({id:{json:{origins:{service:{read:!1},"portal-item":{read:!1}}}}})],
c.prototype,"properties",void 0);a([p.property({type:z})],c.prototype,"spatialReference",void 0);a([p.reader("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],c.prototype,"readSpatialReference",null);a([p.property({type:l})],c.prototype,"fullExtent",void 0);a([p.reader("fullExtent",["store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],c.prototype,"readFullExtent",null);a([p.property({readOnly:!0,type:b})],c.prototype,"heightModelInfo",void 0);
a([p.property({readOnly:!0})],c.prototype,"version",void 0);a([p.reader("version",["store.version"])],c.prototype,"readVersion",null);a([p.property({type:String,json:{read:{source:"copyrightText"}}})],c.prototype,"copyright",void 0);a([p.property({type:String})],c.prototype,"sublayerTitleMode",void 0);a([p.property({type:String})],c.prototype,"title",void 0);a([p.reader("portal-item","title")],c.prototype,"readTitlePortalItem",null);a([p.reader("service","title",["name"])],c.prototype,"readTitleService",
null);a([p.property({type:Number})],c.prototype,"layerId",void 0);a([p.reader("service","layerId",["id"])],c.prototype,"readLayerId",null);a([p.property()],c.prototype,"url",null);a([p.writer("url")],c.prototype,"writeUrl",null);a([p.property({dependsOn:["layerId"]})],c.prototype,"parsedUrl",null);a([p.property()],c.prototype,"store",void 0);a([p.property({type:String})],c.prototype,"rootNode",void 0);a([p.reader("rootNode",["store.rootNode"])],c.prototype,"readRootNode",null);return c=a([p.subclass("esri.layers.mixins.SceneService")],
c)}(p.declared(e,v,x,h,E))})},"esri/layers/support/RangeInfo":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(A,r,w,a,q,n){Object.defineProperty(r,"__esModule",{value:!0});A=function(c){function q(){var a=null!==c&&c.apply(this,arguments)||this;a.name=null;a.field=null;a.currentRangeExtent=null;a.fullRangeExtent=null;a.type="rangeInfo";return a}w(q,c);
a([n.property({type:String,json:{read:!0,write:!0}})],q.prototype,"name",void 0);a([n.property({type:String,json:{read:!0,write:!0}})],q.prototype,"field",void 0);a([n.property({type:[Number],json:{read:!0,write:!0}})],q.prototype,"currentRangeExtent",void 0);a([n.property({type:[Number],json:{read:!0,write:!0}})],q.prototype,"fullRangeExtent",void 0);a([n.property({type:String,readOnly:!0,json:{read:!1,write:!0}})],q.prototype,"type",void 0);return q=a([n.subclass("esri.layers.support.RangeInfo")],
q)}(n.declared(q));r.RangeInfo=A;r.default=A})},"esri/widgets/Search/SearchSource":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Identifiable ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(A,r,w,a,q,n,c){return function(n){function g(a){a=n.call(this)||this;a.autoNavigate=null;a.filter=null;a.maxResults=null;a.maxSuggestions=null;a.minSuggestCharacters=null;a.name="";a.outFields=null;a.placeholder=
"";a.popup=null;a.popupEnabled=null;a.popupTemplate=null;a.popupOpenOnSelect=null;a.prefix="";a.resultGraphicEnabled=null;a.resultSymbol=null;a.searchExtent=null;a.suggestionsEnabled=null;a.suffix="";a.withinViewEnabled=!1;a.zoomScale=null;return a}w(g,n);a([c.property()],g.prototype,"autoNavigate",void 0);a([c.property()],g.prototype,"filter",void 0);a([c.property()],g.prototype,"maxResults",void 0);a([c.property()],g.prototype,"maxSuggestions",void 0);a([c.property()],g.prototype,"minSuggestCharacters",
void 0);a([c.property()],g.prototype,"name",void 0);a([c.property()],g.prototype,"outFields",void 0);a([c.property()],g.prototype,"placeholder",void 0);a([c.property()],g.prototype,"popup",void 0);a([c.property()],g.prototype,"popupEnabled",void 0);a([c.property()],g.prototype,"popupTemplate",void 0);a([c.property()],g.prototype,"popupOpenOnSelect",void 0);a([c.property()],g.prototype,"prefix",void 0);a([c.property()],g.prototype,"resultGraphicEnabled",void 0);a([c.property()],g.prototype,"resultSymbol",
void 0);a([c.property()],g.prototype,"searchExtent",void 0);a([c.property()],g.prototype,"suggestionsEnabled",void 0);a([c.property()],g.prototype,"suffix",void 0);a([c.property()],g.prototype,"withinViewEnabled",void 0);a([c.property()],g.prototype,"zoomScale",void 0);return g=a([c.subclass("esri.widgets.Search.SearchSource")],g)}(c.declared(n,q))})},"esri/widgets/Search/support/featureLayerUtils":function(){define("require exports dojo/date/locale ../../../core/Error ../../../core/lang ../../../core/Logger ../../../core/promiseUtils ../../../geometry/support/scaleUtils ./geometryUtils".split(" "),
function(A,r,w,a,q,n,c,x,g){function y(a,b){var c=a.filter,k=a.searchExtent;b=b&&b.extent;a=a.withinViewEnabled&&b?b:void 0;return c&&c.geometry||k||a}function p(a){return a?a.load().then(c.resolve).catch(c.reject):c.resolve()}function l(a){return a&&!!a.get("capabilities.query.supportsPagination")}function b(a){var b="";a&&(a=a.fields)&&a.some(function(a){if("string"===a.type)return b=a.name,!0});return b}function z(a,b){return a&&b?b.every(function(b){return!!a.getField(b)}):!1}function e(a){for(var b=
0;b<a.length;b++)if(255<a.charCodeAt(b))return!0;return!1}function v(a,b,c){var k=null;(a=a.codedValues)&&a.some(function(a){var e=a.name,e=c?e:e.toLowerCase();if((c?b:b.toLowerCase())===e)return k=a.code.toString(),!0});return k}function h(a,b){return(b=b&&b.where)?"("+a+") AND ("+b+")":a}function E(a,b,c,k,l){var p="";if(a){var m=C.test(b.url)&&e(a)?"N":"";c&&c.forEach(function(c){var e=b.getField(c);c=((c="function"===typeof b.getFieldDomain&&b.getFieldDomain(c))&&"coded-value"===c.type?v(c,a,
l):null)||a||null;if(null!==c){var g=e.type,e=e.name;"string"===g||"date"===g?l?e=h(e+" \x3d "+m+"'"+c+"'",k):(c=c.toUpperCase(),e=h("UPPER("+e+") LIKE "+m+"'%"+c+"%'",k)):"oid"===g||"small-integer"===g||"integer"===g||"single"===g||"double"===g?(c=parseFloat(c),e=isNaN(c)?null:h(e+" \x3d "+c,k)):e=h(e+" \x3d "+c,k);e&&(p+=p?" OR ("+e+")":"("+e+")")}})}return p}function t(a,b){var c=null;(a=a.codedValues)&&a.length&&a.some(function(a){if(a.code===b)return c=a.name,!0});return c}function m(a,b,c,k){var e=
a.layer,h=a.attributes;k="function"===typeof e.getFieldDomain&&e.getFieldDomain(c);return b?q.substitute(h,b):c&&a.hasOwnProperty("attributes")&&h.hasOwnProperty(c)?(a=h[c],c=e.getField(c),k&&"coded-value"===k.type?t(k,a):c&&"date"===c.type?w.format(new Date(a)):a):""}function k(a,b,c,k){return a.features.map(function(a){var e=a.attributes[a.layer.objectIdField];return{text:m(a,b.suggestionTemplate,k,b),key:e,sourceIndex:c}})}function F(a,b,c,k,e,h,l){return a.features.map(function(a){var p=a.clone(),
z=a.layer,z=(z=z&&z.objectIdField)&&a.attributes[z];a=m(a,c.searchTemplate,e,c);var F=g.createExtentFromGeometry(p.geometry,b,h);return{extent:l?g.scaleExtent(F.clone(),b,l):F,feature:p,key:z,name:a,sourceIndex:k}})}Object.defineProperty(r,"__esModule",{value:!0});var C=/https?:\/\/services.*\.arcgis\.com/i,D=/(?:\{([^}]+)\})/g,H=n.getLogger("esri.widgets.Search.support.featureLayerUtils");r.getResults=function(k){var e=k.exactMatch,h=void 0===e?!1:e,g=k.location,m=k.maxResults,n=k.spatialReference,
v=k.source,q=k.sourceIndex,t=k.suggestResult,C=k.view,D=v.featureLayer,r=v.filter,w=v.zoomScale,A=C&&C.scale,u=y(v,C);return p(D).then(function(){var k=v.displayField||v.featureLayer.displayField||b(v.featureLayer);if(!D.getField(k))return H.error("invalid-field: displayField is invalid."),c.reject(new a("searchfeaturelayerutils:invalid-field","displayField is invalid."));var d=D.get("popupTemplate.requiredFields"),d=d&&d.length?d:null,e=v.outFields||d||[k],d=e&&-1!==e.indexOf("*");-1!==e.indexOf(D.objectIdField)||
d||e.push(D.objectIdField);if(!d&&!z(D,e))return H.error("invalid-field: outField is invalid."),c.reject(new a("searchfeaturelayerutils:invalid-field","outField is invalid."));var d=D.createQuery(),p=v.searchQueryParams;p&&d.set(p);n&&(d.outSpatialReference=n,p=x.getMetersPerUnitForSR(n))&&(d.maxAllowableOffset=p);d.returnGeometry=!0;e&&(d.outFields=e);if(g)d.geometry=g;else if(t.key)d.objectIds=[parseInt(t.key,10)];else{e=v.searchFields||[k];if(!z(D,e))return H.error("invalid-field: search field is invalid."),
c.reject(new a("searchfeaturelayerutils:invalid-field","search field is invalid."));l(D)&&(d.num=m);u&&(d.geometry=u);p=t.text.trim();if(!p)return c.resolve();var y=v.prefix,B=v.suffix,p=(""+(void 0===y?"":y)+p+(void 0===B?"":B)).replace(/\'/g,"''"),e=E(p,D,e,r,h);if(!e)return c.resolve();d.where=e}return D.queryFeatures(d).then(function(a){return F(a,C,v,q,k,A,w)})})};r.getSuggestions=function(e){var h=e.source,g=e.spatialReference,m=e.suggestTerm,F=e.maxSuggestions,v=e.sourceIndex,n=h.featureLayer,
q=h.filter,t=y(h,e.view);return p(n).then(function(){if(!l(n))return c.resolve();var e=h.displayField||h.featureLayer.displayField||b(h.featureLayer),p=h.searchFields||[e],C=[];h.suggestionTemplate?h.suggestionTemplate.replace(D,function(a,b){C.push(b);return a}):C.push(e);var r=C&&-1!==C.indexOf("*");-1!==C.indexOf(n.objectIdField)||r||C.push(n.objectIdField);var w=!!n.getField(e),r=r||z(n,C),u=z(n,p);if(!w)return H.error("invalid-field: displayField is invalid."),c.reject(new a("searchfeaturelayerutils:invalid-field",
"displayField is invalid."));if(!r)return H.error("invalid-field: outField is invalid."),c.reject(new a("searchfeaturelayerutils:invalid-field","outField is invalid."));if(!u)return H.error("invalid-field: search field is invalid."),c.reject(new a("searchfeaturelayerutils:invalid-field","search field is invalid."));w=n.createQuery();(r=h.suggestQueryParams)&&w.set(r);w.outSpatialReference=g;w.returnGeometry=!1;w.num=F;w.outFields=C;t&&(w.geometry=t);r=m.trim();if(!r)return c.resolve();var u=h.prefix,
f=h.suffix,r=(""+(void 0===u?"":u)+r+(void 0===f?"":f)).replace(/\'/g,"''"),p=E(r,n,p,q,!1);if(!p)return c.resolve();w.where=p;return n.queryFeatures(w).then(function(a){return k(a,h,v,e)})})}})},"esri/widgets/Search/support/geometryUtils":function(){define("require exports ../../../geometry ../../../core/Error ../../../core/Logger ../../../core/promiseUtils ../../../geometry/support/scaleUtils ../../../views/MapView".split(" "),function(A,r,w,a,q,n,c,x){function g(a,l,b){return l&&l.map?(b?c.getExtentForScale(l,
b):l.extent).clone().centerAt(a):new w.Extent({xmin:a.x-.25,ymin:a.y-.25,xmax:a.x+.25,ymax:a.y+.25,spatialReference:a.spatialReference})}Object.defineProperty(r,"__esModule",{value:!0});var y=q.getLogger("esri.widgets.Search.support.geometryUtils");r.getPointWithElevation=function(c,l){return l?c?c.hasZ||l instanceof x?n.resolve(c):(l=l.get("map.ground"))&&l.layers.length?l.queryElevation(c).then(function(a){return a.geometry}):n.resolve(c):(y.error("missing-parameter: point is missing."),n.reject(new a("searchgeometryutils:missing-parameter",
"point is missing."))):(y.error("missing-parameter: view is missing."),n.reject(new a("searchgeometryutils:missing-parameter","view is missing.")))};r.getPointFromGeometry=function(a){if(a instanceof w.Point)return a;if(a instanceof w.Extent)return a.center;if(a instanceof w.Polygon)return a.centroid;if(a instanceof w.Multipoint)return a.getPoint(0);if(a instanceof w.Polyline)return a.getPoint(0,0)};r.createExtentFromGeometry=function(a,c,b){if(a){if(a instanceof w.Extent)return a;if(a instanceof
w.Multipoint||a instanceof w.Polygon||a instanceof w.Polyline)return a.extent;if(a instanceof w.Point)return g(a,c,b)}};r.scaleExtent=function(a,c,b){if(a&&c)return g(a.center,c,b)}})},"esri/widgets/Search/LocatorSearchSource":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/lang ../../core/accessorSupport/decorators ../../tasks/Locator ./SearchSource ./support/locatorUtils".split(" "),function(A,
r,w,a,q,n,c,x,g,y){return function(g){function l(){var a=null!==g&&g.apply(this,arguments)||this;a.categories=null;a.countryCode=null;a.localSearchOptions=null;a.locationToAddressDistance=1500;a.locator=null;a.name="";a.placeholder="";a.searchTemplate="";a.singleLineFieldName=null;a.suggestionsEnabled=null;a.zoomScale=null;return a}w(l,g);b=l;l.prototype.readLocator=function(a,b){return(a=b.url)?new x({url:a}):null};l.prototype.writeLocator=function(a,b){b.url=a?a.url:null};l.prototype.clone=function(){return new b({autoNavigate:this.autoNavigate,
filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?n.clone(this.outFields):null,placeholder:this.placeholder,popup:this.popup,popupEnabled:this.popupEnabled,popupOpenOnSelect:this.popupOpenOnSelect,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,searchExtent:this.searchExtent?this.searchExtent.clone():null,suggestionsEnabled:this.suggestionsEnabled,
suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,categories:this.categories?n.clone(this.categories):null,countryCode:this.countryCode,localSearchOptions:this.localSearchOptions?n.clone(this.localSearchOptions):null,locationToAddressDistance:this.locationToAddressDistance,locator:this.locator,searchTemplate:this.searchTemplate,singleLineFieldName:this.singleLineFieldName,zoomScale:this.zoomScale})};l.prototype.getResults=function(a){return y.getResults(q({source:this},a))};l.prototype.getSuggestions=
function(a){return y.getSuggestions(q({source:this},a))};var b;a([c.property()],l.prototype,"categories",void 0);a([c.property()],l.prototype,"countryCode",void 0);a([c.property()],l.prototype,"localSearchOptions",void 0);a([c.property()],l.prototype,"locationToAddressDistance",void 0);a([c.property({type:x})],l.prototype,"locator",void 0);a([c.reader("locator",["url"])],l.prototype,"readLocator",null);a([c.writer("locator")],l.prototype,"writeLocator",null);a([c.property({json:{write:!0}})],l.prototype,
"name",void 0);a([c.property({json:{write:!0}})],l.prototype,"placeholder",void 0);a([c.property()],l.prototype,"searchTemplate",void 0);a([c.property({json:{write:!0}})],l.prototype,"singleLineFieldName",void 0);a([c.property({json:{read:{source:"suggest"},write:{target:"suggest"}}})],l.prototype,"suggestionsEnabled",void 0);a([c.property({json:{write:!0}})],l.prototype,"zoomScale",void 0);return l=b=a([c.subclass("esri.widgets.Search.LocatorSearchSource")],l)}(c.declared(g))})},"esri/tasks/Locator":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper ../request ../core/accessorSupport/decorators ../geometry/SpatialReference ./Task ./support/AddressCandidate".split(" "),
function(A,r,w,a,q,n,c,x,g,y){return function(g){function l(a){a=g.call(this,a)||this;a.categories=null;a.countryCode=null;a.outSpatialReference=null;a.url=null;return a}w(l,g);l.prototype.addressToLocations=function(a,c){var b=a.address,l=a.categories,h=a.countryCode,g=a.distance,p=a.forStorage,m=a.location,k=a.magicKey,F=a.maxLocations,z=a.outFields;a=a.searchExtent;var D=m?m.clone().normalize():null,r=a?a.shiftCentralMeridian():null,w=this.outSpatialReference,m=this.parsedUrl;a=this.requestOptions;
l={f:"json",outSR:w?JSON.stringify(w.toJSON()):null,outFields:z?z.join(","):null,searchExtent:r?JSON.stringify(r.toJSON()):null,category:l?l.join(","):null,countryCode:h||null,magicKey:k||null,distance:g||null,location:D,maxLocations:F||null,forStorage:p||null};b={query:this._encode(q({},m.query,b,l)),callbackParamName:"callback"};c=q({},a,c,b);return n(m.path+"/findAddressCandidates",c).then(this._handleAddressToLocationsResponse)};l.prototype.suggestLocations=function(a,c){var b=this.parsedUrl,
l=this.requestOptions,h=a.location,g=a.searchExtent,h=h?h.clone().normalize():null,g=g?g.shiftCentralMeridian():null;a={f:"json",text:a.text,maxSuggestions:a.maxSuggestions,searchExtent:g?JSON.stringify(g.toJSON()):null,category:a.categories?a.categories.join(","):null,countryCode:a.countryCode||null,location:h,distance:a.distance||null};a={query:this._encode(q({},b.query,a)),callbackParamName:"callback"};c=q({},l,c,a);return n(b.path+"/suggest",c).then(this._handleSuggestLocationsResponse)};l.prototype.addressesToLocations=
function(a,c){var b=this.outSpatialReference,l=this.parsedUrl,h=this.requestOptions,g=a.addresses,p=a.categories;a=a.countryCode;var m=[];Array.isArray(g)&&g.forEach(function(a){m.push({attributes:a})});b={category:p?p.join(","):null,sourceCountry:a||null,addresses:JSON.stringify({records:m}),f:"json",outSR:b?JSON.stringify(b):null};b={query:this._encode(q({},l.query,b)),callbackParamName:"callback"};c=q({},h,c,b);return n(l.path+"/geocodeAddresses",c).then(this._handleAddressesToLocationsResponse)};
l.prototype.locationToAddress=function(a,c,e){var b=a?a.clone().normalize():null,h="undefined"!==typeof b,l="undefined"!==typeof c&&h,g=this.outSpatialReference;a=this.parsedUrl;var m=this.requestOptions;c={outSR:g?JSON.stringify(g.toJSON()):null,location:h?JSON.stringify(b.toJSON()):null,distance:l?c:null,f:"json"};c={query:this._encode(q({},a.query,c)),callbackParamName:"callback"};e=q({},m,e,c);return n(a.path+"/reverseGeocode",e).then(this._handleLocationToAddressResponse)};l.prototype._handleAddressToLocationsResponse=
function(a){a=a.data;if(!a)return[];var b=a.candidates,c=a.spatialReference;return b?b.map(function(a){if(a){var b=a.extent,e=a.location,l=b?b&&"number"===typeof b.xmin&&"number"===typeof b.ymin&&"number"===typeof b.xmax&&"number"===typeof b.ymax:!0;if(e&&"number"===typeof e.x&&"number"===typeof e.x&&l)return b&&(b.spatialReference=c),e.spatialReference=c,y.fromJSON(a)}}):[]};l.prototype._handleSuggestLocationsResponse=function(a){return(a=a.data)?a.suggestions||[]:[]};l.prototype._handleAddressesToLocationsResponse=
function(a){a=a.data;if(!a)return[];var b=a.locations,c=a.spatialReference;return b?b.map(function(a){var b=a.location;b&&(b.spatialReference=c);return y.fromJSON(a)}):[]};l.prototype._handleLocationToAddressResponse=function(a){if(a=a.data){var b=a.address;return y.fromJSON({address:b&&b.Match_addr||"",attributes:b||{},location:a.location,score:100})}};a([c.property()],l.prototype,"categories",void 0);a([c.property()],l.prototype,"countryCode",void 0);a([c.property({type:x})],l.prototype,"outSpatialReference",
void 0);a([c.property()],l.prototype,"url",void 0);return l=a([c.subclass("esri.tasks.Locator")],l)}(c.declared(g))})},"esri/tasks/support/AddressCandidate":function(){define(["../../core/JSONSupport","../../geometry/Extent","../../geometry/Point"],function(A,r,w){return A.createSubclass({declaredClass:"esri.tasks.support.AddressCandidate",properties:{address:{value:null,json:{write:!0}},attributes:{value:null,json:{write:!0}},extent:{value:null,type:r,json:{write:!0}},location:{value:null,type:w,
json:{write:!0}},score:{value:null,json:{write:!0}}}})})},"esri/widgets/Search/support/locatorUtils":function(){define(["require","exports","../../../Graphic","../../../core/promiseUtils","./geometryUtils"],function(A,r,w,a,q){function n(a){var b=a.source,c=a.spatialReference,e=a.location,l=a.distance,h=a.sourceIndex,g=a.view;a=b.locator;var p=b.zoomScale,m=g&&g.scale;c&&(a.outSpatialReference=c);return a.locationToAddress(e,l).then(function(a){return y([a],{sourceIndex:h,scale:m,view:g,zoomScale:p})})}
function c(a,b){var c=a.filter,e=a.searchExtent;a=a.withinViewEnabled;var g=b&&b.extent;return(b=q.createExtentFromGeometry(c&&c.geometry,b,b&&b.scale))||e||(a&&g?g:void 0)}function x(g){var b=g.source,l=g.suggestResult,e=g.spatialReference,n=g.view,h=g.maxResults,q=g.sourceIndex,t=b&&b.zoomScale;g=l.text.trim();if(!g)return a.resolve();g=""+(!l.key&&b.prefix?b.prefix:"")+g+(!l.key&&b.suffix?b.suffix:"");var m={},k=b.locator,F=n&&n.scale,C=c(b,n);if(!k)return a.resolve();b.categories&&(m.categories=
b.categories);e&&(k.outSpatialReference=e);if(e=p(n,b,F))m.location=e.location,m.distance=e.distance;m.maxLocations=h;C&&(m.searchExtent=C);b.countryCode&&(m.countryCode=b.countryCode);var D=l.key;D&&(m.magicKey=D);m.address={};m.address[b.singleLineFieldName||"Single Line Input"]=g;b.outFields&&(m.outFields=b.outFields);return k.addressToLocations(m).then(function(a){return y(a,{key:D,scale:F,sourceIndex:q,view:n,zoomScale:t})})}function g(a,b){return a.map(function(a){return{text:a.text,key:a.magicKey,
sourceIndex:b}})}function y(a,b){return a.map(function(a){var c=b.key,g=b.scale,h=b.sourceIndex,l=b.view,n=b.zoomScale,m=a.extent,k=a.location,p=a.address;a=new w({geometry:k,attributes:a.attributes});g=q.createExtentFromGeometry(m||k,l,g);l=n?q.scaleExtent(g,l,n):g;k=k?k.x+","+k.y:"";return{extent:l,feature:a,key:c,name:p||k,sourceIndex:h}})}function p(a,b,c){var e=b.localSearchOptions;if(a&&e&&e.hasOwnProperty("distance")&&e.hasOwnProperty("minScale")&&(b=e.minScale,e=e.distance,!b||c&&c<=b))return{location:a.get("extent.center"),
distance:e}}Object.defineProperty(r,"__esModule",{value:!0});r.getResults=function(a){return a.location?n(a):x(a)};r.getSuggestions=function(l){var b=l.source,n=l.spatialReference,e=l.view,q=l.suggestTerm,h=l.maxSuggestions,r=l.sourceIndex;l={};var t=b.locator,m=e&&e.scale,k=c(b,e);if(!t)return a.resolve();b.categories&&(l.categories=b.categories);t.outSpatialReference=n;if(n=p(e,b,m))l.location=n.location,l.distance=n.distance;q=q.trim();if(!q)return a.resolve();n=b.prefix;e=b.suffix;l.text=""+(void 0===
n?"":n)+q+(void 0===e?"":e);k&&(l.searchExtent=k);l.maxSuggestions=h;b.countryCode&&(l.countryCode=b.countryCode);return t.suggestLocations(l).then(function(a){return g(a,r)})};r.isArcGISWorldGeocoder=function(a){return a?/(?:arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/gi.test(a)||/(?:\/servers\/[\da-z\.-]+\/rest\/services\/world\/geocodeserver).*/gi.test(a):!1}})},"*now":function(A){A(['dojo/i18n!*preload*esri/widgets/nls/Search*["ar","ca","cs","da","de","el","en-gb","en-us","es-es","fi-fi","fr-fr","he-il","hu","it-it","ja-jp","ko-kr","nl-nl","nb","pl","pt-br","pt-pt","ru","sk","sl","sv","th","tr","zh-tw","zh-cn","ROOT"]'])},
"*noref":1}});
define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!../nls/common dojo/i18n!./Search/nls/Search dojo/keys dojo/query dojo/regexp ../PopupTemplate ../core/lang ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./Search/SearchResultRenderer ./Search/SearchViewModel ./support/widget".split(" "),function(A,r,w,a,q,n,c,x,g,y,p,l,b,z,e,v,h){var E=/<[a-z/][\s\S]*>/i;return function(r){function m(a){a=r.call(this)||this;a._inputNode=null;
a._sourceMenuButtonNode=null;a._sourceListNode=null;a._suggestionListNode=null;a._searchResultRenderer=new e({container:document.createElement("div")});a._suggestPromise=null;a._popupTemplate=new y({title:n.searchResult,content:a._renderSearchResultsContent.bind(a)});a._relatedTarget=null;a.activeMenu="none";a.activeSource=null;a.activeSourceIndex=null;a.allPlaceholder=null;a.autoNavigate=null;a.autoSelect=null;a.goToOverride=null;a.iconClass="esri-icon-search";a.includeDefaultSources=null;a.label=
n.widgetLabel;a.locationEnabled=null;a.locationToAddressDistance=null;a.maxResults=null;a.maxSuggestions=null;a.minSuggestCharacters=null;a.popupEnabled=null;a.popupOpenOnSelect=null;a.popupTemplate=null;a.portal=null;a.resultGraphic=null;a.resultGraphicEnabled=null;a.results=null;a.searchAllEnabled=null;a.searchTerm=null;a.selectedResult=null;a.sources=null;a.suggestions=null;a.suggestionsEnabled=null;a.view=null;a.viewModel=new v;return a}w(m,r);m.prototype.postInitialize=function(){var a=this;
this.viewModel.popupTemplate=this._popupTemplate;this.own(l.watch(this,"searchTerm",function(b){if(b&&"warning"===a.activeMenu||!b&&!a.get("viewModel.selectedSuggestion.location"))a.activeMenu="none"}))};m.prototype.destroy=function(){this._cancelSuggest();this._searchResultRenderer&&(this._searchResultRenderer.viewModel=null,this._searchResultRenderer.destroy(),this._searchResultRenderer=null)};m.prototype.clear=function(){};m.prototype.focus=function(){this._inputNode&&(this.activeMenu="suggestion",
this._inputNode.focus(),this.emit("search-focus"))};m.prototype.blur=function(a){this._inputNode&&(this._inputNode.blur(),this._inputBlur(a),this.emit("search-blur"))};m.prototype.search=function(a){var b=this;this.activeMenu="none";this._cancelSuggest();return this.viewModel.search(a).catch(function(a){b.activeMenu="none";return a}).then(function(a){b.activeMenu=a.numResults?"none":"warning";return a})};m.prototype.suggest=function(a){var b=this;this._cancelSuggest();return this._suggestPromise=
a=this.viewModel.suggest(a).then(function(a){a.numResults&&(b.activeMenu="suggestion");b._scrollToTopSuggestion();return a}).catch(function(){return null})};m.prototype.render=function(){var a=this,b,c,e=this.viewModel,g=e.activeSourceIndex,l=e.suggestions,m=e.maxInputLength,r=e.placeholder,t=e.searchTerm,w=e.searchAllEnabled,x=e.allSources,y=this._getSourceName(g),z=(""+t).trim(),A=this.activeMenu,B=this.id,G=this.viewModel.state,E=this.id+"-suggest-menu",m=h.tsx("input",{bind:this,placeholder:r,
"aria-label":n.searchButtonTitle,maxlength:m,autocomplete:"off",type:"text",tabindex:"0",class:this.classes("esri-input","esri-search__input"),"aria-autocomplete":"list",value:t,"aria-haspopup":"true","aria-owns":E,role:"textbox",onkeydown:this._handleInputKeydown,onkeyup:this._handleInputKeyup,onclick:this._handleInputClick,oninput:this._handleInputPaste,onpaste:this._handleInputPaste,afterCreate:h.storeNode,"data-node-ref":"_inputNode",onfocusout:this._storeRelatedTarget,onfocus:this.focus,onblur:this.blur,
title:t?"":r}),m=h.tsx("form",{key:"esri-search__form",bind:this,class:"esri-search__form",onsubmit:this._formSubmit,role:"search"},m),r=t?h.tsx("div",{key:"esri-search__clear-button",bind:this,role:"button",class:this.classes("esri-search__clear-button","esri-widget--button"),tabindex:"0",title:n.clearButtonTitle,onfocus:this._clearButtonFocus,onclick:this._handleClearButtonClick,onkeydown:this._handleClearButtonClick},h.tsx("span",{"aria-hidden":"true",class:"esri-icon-close"})):null,K=this.locationEnabled&&
!z?h.tsx("ul",{key:"esri-search__suggestion-list-current-location",class:this.classes("esri-search__suggestions-list","esri-search__suggestions-list--current-location")},h.tsx("li",{bind:this,onclick:this._handleUseCurrentLocationClick,onkeydown:this._handleUseCurrentLocationClick,onkeyup:this._handleSuggestionKeyup,role:"menuitem",tabindex:"-1"},h.tsx("span",{"aria-hidden":"true",role:"presentation",class:"esri-icon-locate-circled"})," ",n.useCurrentLocation)):null,T=1<x.length&&g===v.ALL_INDEX,
g=l?l.map(function(b,c){var d=b.sourceIndex,f=b.results.length;c=f&&T?a._getSuggestionHeaderNode(d):null;b=b.results.map(function(b,c){return a._getSuggestionNode(b,c,d)});b=f?h.tsx("ul",{key:"esri-search__suggestion-list-"+d,class:"esri-search__suggestions-list"},b):null;return[c,b]}):null,E=h.tsx("div",{id:E,"aria-expanded":"suggestion"===A,key:"esri-search__suggestions-menu",class:this.classes("esri-menu","esri-search__suggestions-menu"),role:"menu",bind:this,afterCreate:h.storeNode,"data-node-ref":"_suggestionListNode"},
K,g),E=h.tsx("div",{key:"esri-search__input-container",class:"esri-search__input-container"},m,E,r),g=h.tsx("div",{key:"esri-search__submit-button",bind:this,role:"button",title:n.searchButtonTitle,class:this.classes("esri-search__submit-button","esri-widget--button"),tabindex:"0",onclick:this._handleSearchButtonClick,onkeydown:this._handleSearchButtonClick},h.tsx("span",{"aria-hidden":"true",role:"presentation",class:"esri-icon-search"}),h.tsx("span",{class:"esri-icon-font-fallback-text"},n.searchButtonTitle)),
t=z?p.substitute({value:'"'+t+'"'},n.noResultsFoundForValue):n.noResultsFound,t=e.get("selectedSuggestion.location")||z?h.tsx("div",{key:"esri-search__no_results"},h.tsx("div",{class:"esri-search__warning-header"},n.noResults),h.tsx("div",{class:"esri-search__warning-text"},t)):null,e=e.get("selectedSuggestion.location")||z?null:h.tsx("div",{key:"esri-search__empty-search"},h.tsx("span",{"aria-hidden":"true",class:"esri-icon-notice-triangle"}),h.tsx("span",{class:"esri-search__no-value-text"},n.emptyValue)),
e=h.tsx("div",{key:"esri-search__error-menu",class:this.classes("esri-menu","esri-search__warning-menu")},h.tsx("div",{class:"esri-search__warning-body"},t,e)),z=1<x.length,x=x&&x.toArray(),w=w?this._getSourceNode(v.ALL_INDEX):null,B=B+"-source-menu",y=z?h.tsx("div",{key:"esri-search__source-menu-button",bind:this,role:"button",title:n.searchIn,"aria-haspopup":"true","aria-expanded":"source"===A,"aria-controls":B,class:this.classes("esri-search__sources-button","esri-widget--button"),tabindex:"0",
onkeydown:this._handleSourceMenuButtonKeydown,onclick:this._handleSourcesMenuToggleClick,onkeyup:this._handleSourceMenuButtonKeyup,onblur:this._sourcesButtonBlur,afterCreate:h.storeNode,"data-node-ref":"_sourceMenuButtonNode"},h.tsx("span",{"aria-hidden":"true",role:"presentation",class:"esri-icon-down-arrow esri-search__sources-button--down"}),h.tsx("span",{"aria-hidden":"true",role:"presentation",class:"esri-icon-up-arrow esri-search__sources-button--up"}),h.tsx("span",{class:"esri-search__source-name"},
y)):null,w=z?h.tsx("ul",{bind:this,afterCreate:h.storeNode,"data-node-ref":"_sourceListNode"},w,x.map(function(b,c){return a._getSourceNode(c)})):null,B=h.tsx("div",{id:B,key:"esri-search__source-menu",class:this.classes("esri-menu","esri-search__sources-menu"),role:"menu"},w),A=(b={},b["esri-search--multiple-sources"]=z,b["esri-search--loading"]="loading"===G,b["esri-search--searching"]="searching"===G,b["esri-search--warning"]="warning"===A,b["esri-search--sources"]="source"===A,b["esri-search--show-suggestions"]=
"suggestion"===A,b);b=(c={},c["esri-disabled"]="disabled"===G,c);c="loading"===G?h.tsx("div",{role:"presentation",class:"esri-widget__loader",key:"base-loader"},h.tsx("span",{"aria-hidden":"true",role:"presentation",class:"esri-widget__loader-animation"}),h.tsx("span",{class:"esri-icon-font-fallback-text"},n.searchButtonTitle),h.tsx("span",{class:"esri-widget__loader-text"},q.loading)):h.tsx("div",{role:"presentation",class:this.classes(A,"esri-search__container"),key:"base-container"},y,B,E,g,e);
return h.tsx("div",{class:this.classes("esri-search esri-widget",b)},c)};m.prototype._handleSourceMenuButtonKeydown=function(a){var b=a.keyCode;b===c.UP_ARROW||b===c.DOWN_ARROW||b===c.END||b===c.HOME?(a.preventDefault(),a.stopPropagation(),this.activeMenu="source"):this._handleSourcesMenuToggleClick(a)};m.prototype._handleSourcesMenuToggleClick=function(a){var b="source"===this.activeMenu;this.activeMenu=b?"none":"source";this.renderNow();b?this._sourceMenuButtonNode&&this._sourceMenuButtonNode.focus():
(b=this._sourceListNode?x("li",this._sourceListNode):null)&&(a=a.keyCode===c.END?b[b.length-1]:b[0])&&a.focus()};m.prototype._handleClearButtonClick=function(){this.viewModel.clear();this._focus()};m.prototype._handleSearchButtonClick=function(){this.search()};m.prototype._handleSuggestionClick=function(a){if(a=a.currentTarget["data-suggestion"])this._focus(),this.search(a)};m.prototype._handleUseCurrentLocationClick=function(){this._focus("none");this.viewModel.searchNearby()};m.prototype._handleSourceClick=
function(a){this.viewModel.activeSourceIndex=a.currentTarget["data-source-index"];this._focus("none")};m.prototype._sourcesButtonBlur=function(a){this._removeActiveMenu(a&&a.relatedTarget,this._sourceListNode)};m.prototype._inputBlur=function(a){a=a&&a.relatedTarget;this._removeActiveMenu(a?a:this._relatedTarget,this._suggestionListNode)};m.prototype._storeRelatedTarget=function(a){this._relatedTarget=a.relatedTarget};m.prototype._clearButtonFocus=function(){this.activeMenu="none"};m.prototype._removeActiveMenu=
function(a,b){a&&b&&b.contains(a)||(this.activeMenu="none")};m.prototype._cancelSuggest=function(){var a=this._suggestPromise;a&&a.cancel();this._suggestPromise=null};m.prototype._handleInputKeydown=function(a){var b=a.keyCode;(b===c.TAB||b===c.ESCAPE||a.shiftKey&&b===c.TAB)&&this._cancelSuggest()};m.prototype._handleInputKeyup=function(a){var b=a.keyCode,e=a.ctrlKey||a.metaKey||b===c.copyKey||b===c.LEFT_ARROW||b===c.RIGHT_ARROW||b===c.ENTER||b===c.SHIFT,k=this._suggestionListNode?x("li",this._suggestionListNode):
null;e||(b===c.TAB||b===c.ESCAPE||a.shiftKey&&b===c.TAB?(this._cancelSuggest(),b===c.ESCAPE&&(this.activeMenu="none")):b!==c.UP_ARROW&&b!==c.DOWN_ARROW||!k?this.viewModel.searchTerm&&this.suggest():(this.activeMenu="suggestion",a.stopPropagation(),a.preventDefault(),this._cancelSuggest(),(a=k[b===c.UP_ARROW?k.length-1:0])&&a.focus()))};m.prototype._scrollToTopSuggestion=function(){this._suggestionListNode&&(this._suggestionListNode.scrollTop=0)};m.prototype._handleInputClick=function(a){this.activeMenu=
"suggestion"};m.prototype._handleInputPaste=function(a){var b=this.get("viewModel.searchTerm");a=a.target;b!==a.value&&(this.viewModel.searchTerm=a.value);b&&this.suggest()};m.prototype._handleSourceMenuButtonKeyup=function(a){var b=a.keyCode;if(b===c.UP_ARROW||b===c.DOWN_ARROW||b===c.HOME||b===c.END)a.stopPropagation(),a.preventDefault(),(a=this._sourceListNode?x("li",this._sourceListNode):null)&&(b=a[b===c.UP_ARROW||b===c.END?a.length-1:0])&&b.focus()};m.prototype._handleSourceKeyup=function(a){var b=
a.target,e=this._sourceListNode?x("li",this._sourceListNode):null,g=a.keyCode;if(g===c.ESCAPE)this._focus("none"),this._sourceMenuButtonNode&&this._sourceMenuButtonNode.focus();else if(e){b=e.indexOf(b);if(g===c.HOME||g===c.END||g===c.UP_ARROW||g===c.DOWN_ARROW)a.stopPropagation(),a.preventDefault();g===c.HOME?(e=e[0])&&e.focus():g===c.END?(e=e[e.length-1])&&e.focus():g===c.UP_ARROW?(a=b-1,(e=0>a?this._sourceMenuButtonNode:e[a])&&e.focus()):g===c.DOWN_ARROW&&(a=b+1,(e=a>=e.length?this._sourceMenuButtonNode:
e[a])&&e.focus())}};m.prototype._handleSuggestionKeyup=function(a){var b=a.target,e=this._suggestionListNode?x("li",this._suggestionListNode):null,b=e.indexOf(b),g=a.keyCode;this._cancelSuggest();if(g===c.BACKSPACE||g===c.DELETE)this._focus();else if(g===c.ESCAPE)this._focus("none");else if(e){if(g===c.HOME||g===c.END||g===c.UP_ARROW||g===c.DOWN_ARROW)a.stopPropagation(),a.preventDefault();g===c.HOME&&(a=e[0])&&a.focus();g===c.END&&(a=e[e.length-1])&&a.focus();g===c.UP_ARROW?(--b,(e=0>b?e[e.length-
1]:e[b])&&e.focus()):g===c.DOWN_ARROW&&(b+=1,(e=b>=e.length?e[0]:e[b])&&e.focus())}};m.prototype._focus=function(a){this.focus();a&&(this.activeMenu=a)};m.prototype._formSubmit=function(a){a.preventDefault();this.search()};m.prototype._getSourceName=function(a){var b=this.viewModel.allSources.getItemAt(a);return a===v.ALL_INDEX?n.all:b?b.name||n.untitledSource:n.untitledSource};m.prototype._getSuggestionHeaderNode=function(a){var b=this._getSourceName(a);return h.tsx("div",{key:"esri-search__suggestion-header-"+
a,class:"esri-header"},b)};m.prototype._splitResult=function(a,b){b=g.escapeString(b);return a.replace(new RegExp("(^|)("+b+")(|$)","ig"),"$1|$2|$3").split("|")};m.prototype._getSuggestionNode=function(a,b,c){if(c=this.viewModel.searchTerm){var e=a.text||n.untitledResult,g=[];if(E.test(e))g.push(h.tsx("div",{innerHTML:e}));else{var e=this._splitResult(e,c),k=c.toLowerCase();e.forEach(function(a,b){a&&a.length&&(a.toLowerCase()===k?g.push(h.tsx("strong",{key:b},a)):g.push(a))})}return h.tsx("li",{bind:this,
onclick:this._handleSuggestionClick,onkeydown:this._handleSuggestionClick,onkeyup:this._handleSuggestionKeyup,key:"esri-search__suggestion$-{sourceIndex}_"+b,"data-suggestion":a,role:"menuitem",tabindex:"-1"},g)}};m.prototype._getSourceNode=function(a){var b,c=(b={},b["esri-search__source--active"]=a===this.viewModel.activeSourceIndex,b);return h.tsx("li",{bind:this,key:"esri-search__source-"+a,onclick:this._handleSourceClick,onkeydown:this._handleSourceClick,onkeyup:this._handleSourceKeyup,"data-source-index":a,
role:"menuitem",class:this.classes("esri-search__source",c),tabindex:"-1"},this._getSourceName(a))};m.prototype._renderSearchResultsContent=function(){this._searchResultRenderer.showMoreResultsOpen=!1;this._searchResultRenderer.viewModel=this.viewModel;return this._searchResultRenderer};a([b.property(),h.renderable()],m.prototype,"activeMenu",void 0);a([b.aliasOf("viewModel.activeSource"),h.renderable()],m.prototype,"activeSource",void 0);a([b.aliasOf("viewModel.activeSourceIndex"),h.renderable()],
m.prototype,"activeSourceIndex",void 0);a([b.aliasOf("viewModel.allPlaceholder"),h.renderable()],m.prototype,"allPlaceholder",void 0);a([b.aliasOf("viewModel.autoNavigate")],m.prototype,"autoNavigate",void 0);a([b.aliasOf("viewModel.autoSelect")],m.prototype,"autoSelect",void 0);a([b.aliasOf("viewModel.goToOverride")],m.prototype,"goToOverride",void 0);a([b.property()],m.prototype,"iconClass",void 0);a([b.aliasOf("viewModel.includeDefaultSources")],m.prototype,"includeDefaultSources",void 0);a([b.property()],
m.prototype,"label",void 0);a([h.renderable(),b.aliasOf("viewModel.locationEnabled")],m.prototype,"locationEnabled",void 0);a([b.aliasOf("viewModel.locationToAddressDistance")],m.prototype,"locationToAddressDistance",void 0);a([b.aliasOf("viewModel.maxResults")],m.prototype,"maxResults",void 0);a([b.aliasOf("viewModel.maxSuggestions")],m.prototype,"maxSuggestions",void 0);a([b.aliasOf("viewModel.minSuggestCharacters")],m.prototype,"minSuggestCharacters",void 0);a([b.aliasOf("viewModel.popupEnabled")],
m.prototype,"popupEnabled",void 0);a([b.aliasOf("viewModel.popupOpenOnSelect")],m.prototype,"popupOpenOnSelect",void 0);a([b.aliasOf("viewModel.popupTemplate")],m.prototype,"popupTemplate",void 0);a([b.aliasOf("viewModel.portal")],m.prototype,"portal",void 0);a([b.aliasOf("viewModel.resultGraphic")],m.prototype,"resultGraphic",void 0);a([b.aliasOf("viewModel.resultGraphicEnabled")],m.prototype,"resultGraphicEnabled",void 0);a([b.aliasOf("viewModel.results"),h.renderable()],m.prototype,"results",void 0);
a([b.aliasOf("viewModel.searchAllEnabled"),h.renderable()],m.prototype,"searchAllEnabled",void 0);a([b.aliasOf("viewModel.searchTerm"),h.renderable()],m.prototype,"searchTerm",void 0);a([b.aliasOf("viewModel.selectedResult")],m.prototype,"selectedResult",void 0);a([b.aliasOf("viewModel.sources")],m.prototype,"sources",void 0);a([b.aliasOf("viewModel.suggestions"),h.renderable()],m.prototype,"suggestions",void 0);a([b.aliasOf("viewModel.suggestionsEnabled")],m.prototype,"suggestionsEnabled",void 0);
a([b.aliasOf("viewModel.view"),h.renderable()],m.prototype,"view",void 0);a([h.vmEvent("search-complete search-clear search-start select-result suggest-start suggest-complete".split(" ")),b.property({type:v}),h.renderable(["viewModel.allSources","viewModel.activeSource.placeholder","viewModel.activeSource.name","viewModel.state"])],m.prototype,"viewModel",void 0);a([b.aliasOf("viewModel.clear")],m.prototype,"clear",null);a([h.accessibleHandler()],m.prototype,"_handleSourcesMenuToggleClick",null);
a([h.accessibleHandler()],m.prototype,"_handleClearButtonClick",null);a([h.accessibleHandler()],m.prototype,"_handleSearchButtonClick",null);a([h.accessibleHandler()],m.prototype,"_handleSuggestionClick",null);a([h.accessibleHandler()],m.prototype,"_handleUseCurrentLocationClick",null);a([h.accessibleHandler()],m.prototype,"_handleSourceClick",null);return m=a([b.subclass("esri.widgets.Search")],m)}(b.declared(z))});