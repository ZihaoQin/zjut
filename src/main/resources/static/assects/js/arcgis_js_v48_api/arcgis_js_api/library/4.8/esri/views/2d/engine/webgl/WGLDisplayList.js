// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/Logger ./enums ./MaterialInfo ./Utils ./util/serializationUtils".split(" "),function(r,z,v,w,f,m,x,d){var y=w.getLogger("esri.views.2d.engine.webgl.WGLDisplayList");r=function(){function b(){this.symbolLevels=[]}Object.defineProperty(b.prototype,"empty",{get:function(){return!this.symbolLevels||0===this.symbolLevels.length},enumerable:!0,configurable:!0});b.prototype.addToList=function(a){var c=this;Array.isArray(a)?
a.forEach(function(a){c._addToList(a)}):this._addToList(a)};b.prototype.removeFromList=function(a){var c=this;Array.isArray(a)||(a=[a]);a.forEach(function(a){c._removeFromList(a)})};b.prototype.ofType=function(a){var c,k,b,n,e,g,p,f,d,l,m;return v(this,function(h){switch(h.label){case 0:c=0,k=this.symbolLevels,h.label=1;case 1:if(!(c<k.length))return[3,8];b=k[c];n=0;e=b.zLevels;h.label=2;case 2:if(!(n<e.length))return[3,7];g=e[n];p=g.geometryDPInfo;f=this._getDPInfoType(a);if(!p[f])return[3,6];d=
0;l=p[f];h.label=3;case 3:if(!(d<l.length))return[3,6];m=l[d];return[4,m];case 4:h.sent(),h.label=5;case 5:return d++,[3,3];case 6:return n++,[3,2];case 7:return c++,[3,1];case 8:return[2]}})};b.prototype.clone=function(){for(var a=new b,c=0,k=this.symbolLevels;c<k.length;c++)a.symbolLevels.push(k[c].clone());return a};b.prototype._addToList=function(a){var c=this._getDisplayList(a.symbolLevel,a.zOrder,a.geometryType),b=0<c.length?c[c.length-1]:null;null!==b&&x.isSameMaterialInfo(b.materialInfo,a.materialInfo)&&
b.indexFrom+b.indexCount===a.indexFrom?b.indexCount+=a.indexCount:(b=new l,b.indexFrom=a.indexFrom,b.indexCount=a.indexCount,b.materialInfo=a.materialInfo,b.geometryType=a.geometryType,c.push(b))};b.prototype._removeFromList=function(a){for(var c=this._getDisplayList(a.symbolLevel,a.zOrder,a.geometryType),b=c.length,h=void 0,f=0;f<b;++f){var e=c[f];a.indexFrom+a.indexCount>e.indexFrom&&a.indexFrom<e.indexFrom+e.indexCount&&(h=f)}if(void 0!==h)if(e=c[h],a.indexFrom===e.indexFrom)e.indexCount-=a.indexCount,
e.indexFrom+=a.indexCount,0===e.indexCount&&c.splice(h,1);else if(a.indexFrom+a.indexCount===e.indexFrom+e.indexCount)e.indexCount-=a.indexCount,0===e.indexCount&&c.splice(h,1);else{var b=e.indexFrom,f=a.indexFrom-e.indexFrom,g=a.indexCount;a=e.indexFrom+e.indexCount-(a.indexFrom+a.indexCount);e.indexCount=f;var d=new l;d.geometryType=e.geometryType;d.materialInfo=new m.default;d.materialInfo.copy(e.materialInfo);d.indexFrom=b+f+g;d.indexCount=a;c.splice(h+1,0,d)}};b.prototype._getDisplayList=function(a,
b,k){for(var c,d=this.symbolLevels.length,e=0;e<d;e++)if(this.symbolLevels[e].symbolLevel===a){c=this.symbolLevels[e];break}c||(c=new t,c.symbolLevel=a,this.symbolLevels.push(c));var g;a=c.zLevels.length;for(d=0;d<a;d++)if(c.zLevels[d].zLevel===b){g=c.zLevels[d];break}g||(g=new u,g.geometryDPInfo=new q,g.zLevel=b,c.zLevels.push(g));var l;switch(k){case f.WGLGeometryType.FILL:g.geometryDPInfo.fill||(g.geometryDPInfo.fill=[]);l=g.geometryDPInfo.fill;break;case f.WGLGeometryType.LINE:g.geometryDPInfo.line||
(g.geometryDPInfo.line=[]);l=g.geometryDPInfo.line;break;case f.WGLGeometryType.MARKER:g.geometryDPInfo.marker||(g.geometryDPInfo.marker=[]);l=g.geometryDPInfo.marker;break;case f.WGLGeometryType.TEXT:g.geometryDPInfo.text||(g.geometryDPInfo.text=[]);l=g.geometryDPInfo.text;break;case f.WGLGeometryType.LABEL:g.geometryDPInfo.label||(g.geometryDPInfo.label=[]);l=g.geometryDPInfo.label;break;default:console.error("Trying to add a record with geometry type '"+k+"'.")}return l};b.prototype.serialize=
function(a){d.serializeList(a,this.symbolLevels);return a};b.deserialize=function(a){var c=new b;c.symbolLevels=d.deserializeList(a,t);return c};b.prototype._getDPInfoType=function(a){switch(a){case f.WGLGeometryType.FILL:return"fill";case f.WGLGeometryType.LINE:return"line";case f.WGLGeometryType.MARKER:return"marker";case f.WGLGeometryType.TEXT:return"text";case f.WGLGeometryType.LABEL:return"label";default:y.error("DisplayList: Tried to convert unknown geometryType: "+a)}};return b}();var l=function(){function b(){this.materialInfo=
null;this.indexCount=this.indexFrom=0}b.prototype.clone=function(){var a=new b;a.geometryType=this.geometryType;a.materialInfo=new m.default;a.materialInfo.copy(this.materialInfo);a.indexFrom=this.indexFrom;a.indexCount=this.indexCount;return a};b.prototype.serialize=function(a){this.materialInfo.serialize(a);a.writeInt32(this.indexFrom);a.writeInt32(this.indexCount);return a};b.deserialize=function(a,c){var d=new b;d.geometryType=c.geometryType;d.materialInfo=m.default.deserialize(a);d.indexFrom=
a.readInt32();d.indexCount=a.readInt32();return d};return b}(),q=function(){function b(){this.label=this.text=this.marker=this.line=this.fill=null}b.prototype.clone=function(){var a=new b;a.fill=this.fill&&this.fill.map(function(a){return a.clone()});a.line=this.line&&this.line.map(function(a){return a.clone()});a.marker=this.marker&&this.marker.map(function(a){return a.clone()});a.text=this.text&&this.text.map(function(a){return a.clone()});a.label=this.label&&this.label.map(function(a){return a.clone()});
return a};b.prototype.serialize=function(a){d.serializeList(a,this.fill);d.serializeList(a,this.line);d.serializeList(a,this.marker);d.serializeList(a,this.text);d.serializeList(a,this.label);return a};b.deserialize=function(a){var c=new b,k={geometryType:f.WGLGeometryType.FILL},h=d.deserializeList(a,l,k);h.length&&(c.fill=h);k.geometryType=f.WGLGeometryType.LINE;h=d.deserializeList(a,l,k);h.length&&(c.line=h);k.geometryType=f.WGLGeometryType.MARKER;h=d.deserializeList(a,l,k);h.length&&(c.marker=
h);k.geometryType=f.WGLGeometryType.TEXT;h=d.deserializeList(a,l,k);h.length&&(c.text=h);k.geometryType=f.WGLGeometryType.LABEL;a=d.deserializeList(a,l,k);a.length&&(c.label=a);return c};return b}(),u=function(){function b(){this.geometryDPInfo=new q}b.prototype.clone=function(){var a=new b;a.zLevel=this.zLevel;a.geometryDPInfo=this.geometryDPInfo.clone();return a};b.prototype.serialize=function(a){a.writeInt32(this.zLevel);this.geometryDPInfo.serialize(a);return a};b.deserialize=function(a){var c=
new b;c.zLevel=a.readInt32();c.geometryDPInfo=q.deserialize(a);return c};return b}(),t=function(){function b(){this.zLevels=[]}b.prototype.clone=function(){var a=new b;a.symbolLevel=this.symbolLevel;for(var c=0,d=this.zLevels;c<d.length;c++)a.zLevels.push(d[c].clone());return a};b.prototype.serialize=function(a){a.writeInt32(this.symbolLevel);d.serializeList(a,this.zLevels);return a};b.deserialize=function(a){var c=new b;c.symbolLevel=a.readInt32();c.zLevels=d.deserializeList(a,u);return c};return b}();
return r});