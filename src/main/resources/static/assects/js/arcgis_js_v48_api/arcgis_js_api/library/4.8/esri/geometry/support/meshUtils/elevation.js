// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../geometry ../../../Ground ../../../core/promiseUtils ../scaleUtils ../../../layers/ElevationLayer ../../../layers/support/types".split(" "),function(H,l,m,n,B,C,w,D,E,F){function G(b){return n(this,void 0,void 0,function(){return m(this,function(a){switch(a.label){case 0:return F.isOfType(b,"elevation")?[4,b.load()]:[3,2];case 1:return[2,a.sent()];case 2:return[4,b.load()];case 3:return a.sent(),
[4,w.eachAlways(b.layers.map(function(a){return a.load()}))];case 4:return a.sent(),[2,b]}})})}Object.defineProperty(l,"__esModule",{value:!0});l.create=function(b,a,r){return n(this,void 0,void 0,function(){var x,l;return m(this,function(d){switch(d.label){case 0:return b instanceof E||b instanceof C?[4,G(b)]:[3,3];case 1:return l=d.sent(),[4,l.createElevationSampler(a,{demResolution:r&&r.demResolution||"finest-contiguous"})];case 2:return x=d.sent(),[3,4];case 3:x=b,d.label=4;case 4:d=x;var e=D.getMetersPerUnitForSR(a.spatialReference),
c=d.demResolution.min/e,e=Math.round(a.width/c),c=Math.round(a.height/c),h=e+1,y=c+1,t=new Float64Array(h*y*3),z=new Float32Array(h*y*2),A=0,m=0,f=new Uint32Array(e*c*6),g=0,k=0;u.spatialReference=a.spatialReference;for(var p=0;p<y;p++)for(var n=a.ymin+p/c*a.height,q=0;q<h;q++){var v=a.xmin+q/e*a.width;u.x=v;u.y=n;t[A++]=v;t[A++]=n;t[A++]=d.elevationAt(u)||0;var v=q/e,w=p/c;z[m++]=v;z[m++]=w;p!==c&&q!==e&&(f[k++]=g+1,f[k++]=g+h+1,f[k++]=g+h,f[k++]=g,f[k++]=g+1,f[k++]=g+h);g++}return[2,new B.Mesh({vertexAttributes:{position:t,
uv:z},components:[{faces:f,shading:"smooth",material:r&&r.material||null}],spatialReference:a.spatialReference})]}})})};var u=new B.Point});