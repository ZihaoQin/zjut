// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define(["require","exports","../../camera/intersectionUtils","../../lib/glMatrix","../../webgl-engine/lib/Selector"],function(g,h,k,d,l){Object.defineProperty(h,"__esModule",{value:!0});g=function(){function e(b){this.view=b;this.tmpR0=d.vec3d.create();this.tmpR1=d.vec3d.create();this.tmpSelector=new l(this.view.viewingMode)}e.prototype.pickPointInScreen=function(b,a){return this.pickedIntersectionPoint(this.pickInScreen(b,!1),a)};e.prototype.pickFreePointFromSegment=function(b,a,e){d.vec3d.set(b,
this.tmpR0);d.vec3d.set(a,this.tmpR1);d.vec3d.subtract(this.tmpR1,this.tmpR0);d.vec3d.normalize(this.tmpR1);var c=this.view.dataExtent;b=Math.max(c.xmax-c.xmin,c.ymax-c.ymin,8*Math.max(c.xmax-c.xmin,c.ymax-c.ymin));a=this.view.state.camera;var f=Math.max(0,c.xmin-a.eye[0],a.eye[0]-c.xmax),c=Math.max(0,c.ymin-a.eye[1],a.eye[1]-c.ymax),f=Math.sqrt(f*f+c*c),c=this.view.renderCoordsHelper.getAltitude(a.eye);a=k.surfaceElevationBelowEye(this.view,a);a=b/Math.max(1,Math.pow(Math.max(0,Math.log(b/(Math.abs(c-
a)+Number.MIN_VALUE))),2));a=Math.max(a,Math.min(f,b));d.vec3d.scale(this.tmpR1,a);d.vec3d.add(this.tmpR0,this.tmpR1,e)};e.prototype.pickFreePointInScreen=function(b,a){this.view._pickRayWithBeginPoint(b,void 0,this.view.state.camera.viewMatrix,this.tmpR0,this.tmpR1);this.pickFreePointFromSegment(this.tmpR0,this.tmpR1,a)};e.prototype.pickRaySegment=function(b,a,d){return this.pickedIntersectionPoint(this.view._pickRay(b,a,null,null,null,null,this.tmpSelector),d)};e.prototype.pickInScreen=function(b,
a){this.view._pickRayWithBeginPoint(b,void 0,this.view.state.camera.viewMatrix,this.tmpR0,this.tmpR1);a&&d.vec3d.set(this.view.state.camera.eye,this.tmpR0);return this.view._pickRay(this.tmpR0,this.tmpR1,b,b,null,null,this.tmpSelector)};e.prototype.pickedIntersectionPoint=function(b,a){return b?b.getMinResult().getIntersectionPoint(a):!1};return e}();h.PickingHelper=g});