// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.8/esri/copyright.txt for details.
//>>built
define("require exports ../ArrayPool ../lang ../ObjectPool ../scheduling ./get ./utils ./wire".split(" "),function(E,f,z,r,A,B,k,m,t){function u(a){l.has(a)?c.splice(c.indexOf(a),1):l.add(a);c.push(a);n||(n=B.schedule(v))}function w(a){if(!a.removed){var e=a.callback,b=a.path,d=a.oldValue,c=a.target,p=k.valueOf(c,a.propertyPath,!0);r.equals(d,p)||(a.oldValue=p,e.call(c,p,d,b,c))}}function v(){if(n){n=null;var a=c;c=h.acquire();l.clear();for(var e=h.acquire(),b=0;b<a.length;b++){var d=a[b];w(d);d.removed&&
e.push(d)}for(b=0;b<c.length;b++)d=c[b],d.removed&&(e.push(d),l.delete(d),c.splice(b,1),--b);for(b=0;b<e.length;b++)x.pool.release(e[b]);h.release(a);h.release(e);q.forEach(function(a){return a()})}}function C(a,e,b){var d=m.parse(a,e,b,function(a,b,e){var c=k.valueOf(a,b,!0),g,f=t.wire(a,b,function(a,b){a.__accessor__.destroyed?d.remove():(g||(g=x.pool.acquire(a,b,c,e),c=null),u(g))});return{remove:m.once(function(){f.remove();g&&(g.removed=!0,u(g),g=null);d=f=c=null})}});return d}function D(a,e,
b){var d=m.parse(a,e,b,function(a,b,e){var c=k.valueOf(a,b,!0),f=!1;return t.wire(a,b,function(a,b){if(a.__accessor__.destroyed)d.remove();else if(!f){f=!0;var g=k.valueOf(a,b,!0);r.equals(c,g)||e.call(a,g,c,b,a);c=k.valueOf(a,b,!0);f=!1}})});return d}function y(a,e,b,d){void 0===d&&(d=!1);return!a.__accessor__||a.__accessor__.destroyed?{remove:function(){}}:d?D(a,e,b):C(a,e,b)}Object.defineProperty(f,"__esModule",{value:!0});var x=function(){function a(a,b,d,c){this.target=a;this.path=b;this.oldValue=
d;this.callback=c;this.removed=!1;this.propertyPath=m.pathToStringOrArray(b)}a.prototype.release=function(){this.target=this.path=this.propertyPath=this.callback=this.oldValue=null;this.removed=!0};a.pool=new A(a,!0);return a}(),h=new z,l=new Set,c=h.acquire(),n;f.dispatchTarget=function(a){for(var e=h.copy(c),b=0;b<e.length;b++){var d=e[b];d.target===a&&(w(d),l.delete(d),c.splice(c.indexOf(d),1))}};f.removeTarget=function(a){for(var e=0;e<c.length;e++){var b=c[e];b.target===a&&(b.removed=!0)}};f.dispatch=
v;var q=new Set;f.afterDispatch=function(a){q.add(a);return{remove:function(){q.delete(a)}}};f.watch=y;f.isValueInUse=function(a){return c.some(function(c){return c.oldValue===a})};f.default=y});